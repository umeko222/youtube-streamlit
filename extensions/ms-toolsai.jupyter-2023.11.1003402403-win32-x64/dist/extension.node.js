"use strict";var uQ=Object.create;var CS=Object.defineProperty;var GU=Object.getOwnPropertyDescriptor;var pQ=Object.getOwnPropertyNames;var dQ=Object.getPrototypeOf,mQ=Object.prototype.hasOwnProperty;var fQ=(r,e)=>()=>(r&&(e=r(r=0)),e);var M=(r,e)=>()=>(e||r((e={exports:{}}).exports,e),e.exports),zU=(r,e)=>{for(var t in e)CS(r,t,{get:e[t],enumerable:!0})},QU=(r,e,t,n)=>{if(e&&typeof e=="object"||typeof e=="function")for(let i of pQ(e))!mQ.call(r,i)&&i!==t&&CS(r,i,{get:()=>e[i],enumerable:!(n=GU(e,i))||n.enumerable});return r};var k=(r,e,t)=>(t=r!=null?uQ(dQ(r)):{},QU(e||!r||!r.__esModule?CS(t,"default",{value:r,enumerable:!0}):t,r)),YU=r=>QU(CS({},"__esModule",{value:!0}),r),g=(r,e,t,n)=>{for(var i=n>1?void 0:n?GU(e,t):e,o=r.length-1,s;o>=0;o--)(s=r[o])&&(i=(n?s(e,t,i):s(i))||i);return n&&i&&CS(e,t,i),i},p=(r,e)=>(t,n)=>e(t,n,r);var ZU=M(()=>{var XU;(function(r){(function(e){var t=typeof global=="object"?global:typeof self=="object"?self:typeof this=="object"?this:Function("return this;")(),n=i(r);typeof t.Reflect>"u"?t.Reflect=r:n=i(t.Reflect,n),e(n);function i(o,s){return function(a,l){typeof o[a]!="function"&&Object.defineProperty(o,a,{configurable:!0,writable:!0,value:l}),s&&s(a,l)}}})(function(e){var t=Object.prototype.hasOwnProperty,n=typeof Symbol=="function",i=n&&typeof Symbol.toPrimitive<"u"?Symbol.toPrimitive:"@@toPrimitive",o=n&&typeof Symbol.iterator<"u"?Symbol.iterator:"@@iterator",s=typeof Object.create=="function",a={__proto__:[]}instanceof Array,l=!s&&!a,c={create:s?function(){return dn(Object.create(null))}:a?function(){return dn({__proto__:null})}:function(){return dn({})},has:l?function($,re){return t.call($,re)}:function($,re){return re in $},get:l?function($,re){return t.call($,re)?$[re]:void 0}:function($,re){return $[re]}},u=Object.getPrototypeOf(Function),d=typeof process=="object"&&process.env&&process.env.REFLECT_METADATA_USE_MAP_POLYFILL==="true",f=!d&&typeof Map=="function"&&typeof Map.prototype.entries=="function"?Map:Ar(),h=!d&&typeof Set=="function"&&typeof Set.prototype.entries=="function"?Set:Xr(),v=!d&&typeof WeakMap=="function"?WeakMap:Ur(),S=new v;function b($,re,ve,ke){if(kt(ve)){if(!kc($))throw new TypeError;if(!j(re))throw new TypeError;return Me($,re)}else{if(!kc($))throw new TypeError;if(!qt(re))throw new TypeError;if(!qt(ke)&&!kt(ke)&&!Yr(ke))throw new TypeError;return Yr(ke)&&(ke=void 0),ve=mi(ve),Ge($,re,ve,ke)}}e("decorate",b);function D($,re){function ve(ke,Qe){if(!qt(ke))throw new TypeError;if(!kt(Qe)&&!Ce(Qe))throw new TypeError;Y($,re,ke,Qe)}return ve}e("metadata",D);function _($,re,ve,ke){if(!qt(ve))throw new TypeError;return kt(ke)||(ke=mi(ke)),Y($,re,ve,ke)}e("defineMetadata",_);function L($,re,ve){if(!qt(re))throw new TypeError;return kt(ve)||(ve=mi(ve)),vt($,re,ve)}e("hasMetadata",L);function Z($,re,ve){if(!qt(re))throw new TypeError;return kt(ve)||(ve=mi(ve)),ot($,re,ve)}e("hasOwnMetadata",Z);function Se($,re,ve){if(!qt(re))throw new TypeError;return kt(ve)||(ve=mi(ve)),oe($,re,ve)}e("getMetadata",Se);function ie($,re,ve){if(!qt(re))throw new TypeError;return kt(ve)||(ve=mi(ve)),Pe($,re,ve)}e("getOwnMetadata",ie);function fe($,re){if(!qt($))throw new TypeError;return kt(re)||(re=mi(re)),be($,re)}e("getMetadataKeys",fe);function de($,re){if(!qt($))throw new TypeError;return kt(re)||(re=mi(re)),Je($,re)}e("getOwnMetadataKeys",de);function ae($,re,ve){if(!qt(re))throw new TypeError;kt(ve)||(ve=mi(ve));var ke=St(re,ve,!1);if(kt(ke)||!ke.delete($))return!1;if(ke.size>0)return!0;var Qe=S.get(re);return Qe.delete(ve),Qe.size>0||S.delete(re),!0}e("deleteMetadata",ae);function Me($,re){for(var ve=$.length-1;ve>=0;--ve){var ke=$[ve],Qe=ke(re);if(!kt(Qe)&&!Yr(Qe)){if(!j(Qe))throw new TypeError;re=Qe}}return re}function Ge($,re,ve,ke){for(var Qe=$.length-1;Qe>=0;--Qe){var mn=$[Qe],Pt=mn(re,ve,ke);if(!kt(Pt)&&!Yr(Pt)){if(!qt(Pt))throw new TypeError;ke=Pt}}return ke}function St($,re,ve){var ke=S.get($);if(kt(ke)){if(!ve)return;ke=new f,S.set($,ke)}var Qe=ke.get(re);if(kt(Qe)){if(!ve)return;Qe=new f,ke.set(re,Qe)}return Qe}function vt($,re,ve){var ke=ot($,re,ve);if(ke)return!0;var Qe=Ot(re);return Yr(Qe)?!1:vt($,Qe,ve)}function ot($,re,ve){var ke=St(re,ve,!1);return kt(ke)?!1:Mt(ke.has($))}function oe($,re,ve){var ke=ot($,re,ve);if(ke)return Pe($,re,ve);var Qe=Ot(re);if(!Yr(Qe))return oe($,Qe,ve)}function Pe($,re,ve){var ke=St(re,ve,!1);if(!kt(ke))return ke.get($)}function Y($,re,ve,ke){var Qe=St(ve,ke,!0);Qe.set($,re)}function be($,re){var ve=Je($,re),ke=Ot($);if(ke===null)return ve;var Qe=be(ke,re);if(Qe.length<=0)return ve;if(ve.length<=0)return Qe;for(var mn=new h,Pt=[],_t=0,at=ve;_t<at.length;_t++){var Lt=at[_t],ne=mn.has(Lt);ne||(mn.add(Lt),Pt.push(Lt))}for(var he=0,B=Qe;he<B.length;he++){var Lt=B[he],ne=mn.has(Lt);ne||(mn.add(Lt),Pt.push(Lt))}return Pt}function Je($,re){var ve=[],ke=St($,re,!1);if(kt(ke))return ve;for(var Qe=ke.keys(),mn=st(Qe),Pt=0;;){var _t=zt(mn);if(!_t)return ve.length=Pt,ve;var at=pn(_t);try{ve[Pt]=at}catch(Lt){try{jt(mn)}finally{throw Lt}}Pt++}}function yn($){if($===null)return 1;switch(typeof $){case"undefined":return 0;case"boolean":return 2;case"string":return 3;case"symbol":return 4;case"number":return 5;case"object":return $===null?1:6;default:return 6}}function kt($){return $===void 0}function Yr($){return $===null}function vs($){return typeof $=="symbol"}function qt($){return typeof $=="object"?$!==null:typeof $=="function"}function un($,re){switch(yn($)){case 0:return $;case 1:return $;case 2:return $;case 3:return $;case 4:return $;case 5:return $}var ve=re===3?"string":re===5?"number":"default",ke=Oe($,i);if(ke!==void 0){var Qe=ke.call($,ve);if(qt(Qe))throw new TypeError;return Qe}return Yi($,ve==="default"?"number":ve)}function Yi($,re){if(re==="string"){var ve=$.toString;if(F(ve)){var ke=ve.call($);if(!qt(ke))return ke}var Qe=$.valueOf;if(F(Qe)){var ke=Qe.call($);if(!qt(ke))return ke}}else{var Qe=$.valueOf;if(F(Qe)){var ke=Qe.call($);if(!qt(ke))return ke}var mn=$.toString;if(F(mn)){var ke=mn.call($);if(!qt(ke))return ke}}throw new TypeError}function Mt($){return!!$}function mr($){return""+$}function mi($){var re=un($,3);return vs(re)?re:mr(re)}function kc($){return Array.isArray?Array.isArray($):$ instanceof Object?$ instanceof Array:Object.prototype.toString.call($)==="[object Array]"}function F($){return typeof $=="function"}function j($){return typeof $=="function"}function Ce($){switch(yn($)){case 3:return!0;case 4:return!0;default:return!1}}function Oe($,re){var ve=$[re];if(ve!=null){if(!F(ve))throw new TypeError;return ve}}function st($){var re=Oe($,o);if(!F(re))throw new TypeError;var ve=re.call($);if(!qt(ve))throw new TypeError;return ve}function pn($){return $.value}function zt($){var re=$.next();return re.done?!1:re}function jt($){var re=$.return;re&&re.call($)}function Ot($){var re=Object.getPrototypeOf($);if(typeof $!="function"||$===u||re!==u)return re;var ve=$.prototype,ke=ve&&Object.getPrototypeOf(ve);if(ke==null||ke===Object.prototype)return re;var Qe=ke.constructor;return typeof Qe!="function"||Qe===$?re:Qe}function Ar(){var $={},re=[],ve=function(){function Pt(_t,at,Lt){this._index=0,this._keys=_t,this._values=at,this._selector=Lt}return Pt.prototype["@@iterator"]=function(){return this},Pt.prototype[o]=function(){return this},Pt.prototype.next=function(){var _t=this._index;if(_t>=0&&_t<this._keys.length){var at=this._selector(this._keys[_t],this._values[_t]);return _t+1>=this._keys.length?(this._index=-1,this._keys=re,this._values=re):this._index++,{value:at,done:!1}}return{value:void 0,done:!0}},Pt.prototype.throw=function(_t){throw this._index>=0&&(this._index=-1,this._keys=re,this._values=re),_t},Pt.prototype.return=function(_t){return this._index>=0&&(this._index=-1,this._keys=re,this._values=re),{value:_t,done:!0}},Pt}();return function(){function Pt(){this._keys=[],this._values=[],this._cacheKey=$,this._cacheIndex=-2}return Object.defineProperty(Pt.prototype,"size",{get:function(){return this._keys.length},enumerable:!0,configurable:!0}),Pt.prototype.has=function(_t){return this._find(_t,!1)>=0},Pt.prototype.get=function(_t){var at=this._find(_t,!1);return at>=0?this._values[at]:void 0},Pt.prototype.set=function(_t,at){var Lt=this._find(_t,!0);return this._values[Lt]=at,this},Pt.prototype.delete=function(_t){var at=this._find(_t,!1);if(at>=0){for(var Lt=this._keys.length,ne=at+1;ne<Lt;ne++)this._keys[ne-1]=this._keys[ne],this._values[ne-1]=this._values[ne];return this._keys.length--,this._values.length--,_t===this._cacheKey&&(this._cacheKey=$,this._cacheIndex=-2),!0}return!1},Pt.prototype.clear=function(){this._keys.length=0,this._values.length=0,this._cacheKey=$,this._cacheIndex=-2},Pt.prototype.keys=function(){return new ve(this._keys,this._values,ke)},Pt.prototype.values=function(){return new ve(this._keys,this._values,Qe)},Pt.prototype.entries=function(){return new ve(this._keys,this._values,mn)},Pt.prototype["@@iterator"]=function(){return this.entries()},Pt.prototype[o]=function(){return this.entries()},Pt.prototype._find=function(_t,at){return this._cacheKey!==_t&&(this._cacheIndex=this._keys.indexOf(this._cacheKey=_t)),this._cacheIndex<0&&at&&(this._cacheIndex=this._keys.length,this._keys.push(_t),this._values.push(void 0)),this._cacheIndex},Pt}();function ke(Pt,_t){return Pt}function Qe(Pt,_t){return _t}function mn(Pt,_t){return[Pt,_t]}}function Xr(){return function(){function $(){this._map=new f}return Object.defineProperty($.prototype,"size",{get:function(){return this._map.size},enumerable:!0,configurable:!0}),$.prototype.has=function(re){return this._map.has(re)},$.prototype.add=function(re){return this._map.set(re,re),this},$.prototype.delete=function(re){return this._map.delete(re)},$.prototype.clear=function(){this._map.clear()},$.prototype.keys=function(){return this._map.keys()},$.prototype.values=function(){return this._map.values()},$.prototype.entries=function(){return this._map.entries()},$.prototype["@@iterator"]=function(){return this.keys()},$.prototype[o]=function(){return this.keys()},$}()}function Ur(){var $=16,re=c.create(),ve=ke();return function(){function at(){this._key=ke()}return at.prototype.has=function(Lt){var ne=Qe(Lt,!1);return ne!==void 0?c.has(ne,this._key):!1},at.prototype.get=function(Lt){var ne=Qe(Lt,!1);return ne!==void 0?c.get(ne,this._key):void 0},at.prototype.set=function(Lt,ne){var he=Qe(Lt,!0);return he[this._key]=ne,this},at.prototype.delete=function(Lt){var ne=Qe(Lt,!1);return ne!==void 0?delete ne[this._key]:!1},at.prototype.clear=function(){this._key=ke()},at}();function ke(){var at;do at="@@WeakMap@@"+_t();while(c.has(re,at));return re[at]=!0,at}function Qe(at,Lt){if(!t.call(at,ve)){if(!Lt)return;Object.defineProperty(at,ve,{value:c.create()})}return at[ve]}function mn(at,Lt){for(var ne=0;ne<Lt;++ne)at[ne]=Math.random()*255|0;return at}function Pt(at){return typeof Uint8Array=="function"?typeof crypto<"u"?crypto.getRandomValues(new Uint8Array(at)):typeof msCrypto<"u"?msCrypto.getRandomValues(new Uint8Array(at)):mn(new Uint8Array(at),at):mn(new Array(at),at)}function _t(){var at=Pt($);at[6]=at[6]&79|64,at[8]=at[8]&191|128;for(var Lt="",ne=0;ne<$;++ne){var he=at[ne];(ne===4||ne===6||ne===8)&&(Lt+="-"),he<16&&(Lt+="0"),Lt+=he.toString(16).toLowerCase()}return Lt}}function dn($){return $.__=void 0,delete $.__,$}})})(XU||(XU={}))});var eW={};zU(eW,{isPreRelesVersionOfJupyterExtension:()=>hQ});var hQ,tW=fQ(()=>{"use strict";hQ=!1});var Rn=M(tr=>{"use strict";Object.defineProperty(tr,"__esModule",{value:!0});tr.NON_CUSTOM_TAG_KEYS=tr.PRE_DESTROY=tr.POST_CONSTRUCT=tr.DESIGN_PARAM_TYPES=tr.PARAM_TYPES=tr.TAGGED_PROP=tr.TAGGED=tr.MULTI_INJECT_TAG=tr.INJECT_TAG=tr.OPTIONAL_TAG=tr.UNMANAGED_TAG=tr.NAME_TAG=tr.NAMED_TAG=void 0;tr.NAMED_TAG="named";tr.NAME_TAG="name";tr.UNMANAGED_TAG="unmanaged";tr.OPTIONAL_TAG="optional";tr.INJECT_TAG="inject";tr.MULTI_INJECT_TAG="multi_inject";tr.TAGGED="inversify:tagged";tr.TAGGED_PROP="inversify:tagged_props";tr.PARAM_TYPES="inversify:paramtypes";tr.DESIGN_PARAM_TYPES="design:paramtypes";tr.POST_CONSTRUCT="post_construct";tr.PRE_DESTROY="pre_destroy";function HQ(){return[tr.INJECT_TAG,tr.MULTI_INJECT_TAG,tr.NAME_TAG,tr.UNMANAGED_TAG,tr.NAMED_TAG,tr.OPTIONAL_TAG]}tr.NON_CUSTOM_TAG_KEYS=HQ()});var fa=M(Zu=>{"use strict";Object.defineProperty(Zu,"__esModule",{value:!0});Zu.TargetTypeEnum=Zu.BindingTypeEnum=Zu.BindingScopeEnum=void 0;var GQ={Request:"Request",Singleton:"Singleton",Transient:"Transient"};Zu.BindingScopeEnum=GQ;var zQ={ConstantValue:"ConstantValue",Constructor:"Constructor",DynamicValue:"DynamicValue",Factory:"Factory",Function:"Function",Instance:"Instance",Invalid:"Invalid",Provider:"Provider"};Zu.BindingTypeEnum=zQ;var QQ={ClassProperty:"ClassProperty",ConstructorArgument:"ConstructorArgument",Variable:"Variable"};Zu.TargetTypeEnum=QQ});var ep=M(YE=>{"use strict";Object.defineProperty(YE,"__esModule",{value:!0});YE.id=void 0;var YQ=0;function XQ(){return YQ++}YE.id=XQ});var LW=M(XE=>{"use strict";Object.defineProperty(XE,"__esModule",{value:!0});XE.Binding=void 0;var FW=fa(),ZQ=ep(),eY=function(){function r(e,t){this.id=(0,ZQ.id)(),this.activated=!1,this.serviceIdentifier=e,this.scope=t,this.type=FW.BindingTypeEnum.Invalid,this.constraint=function(n){return!0},this.implementationType=null,this.cache=null,this.factory=null,this.provider=null,this.onActivation=null,this.onDeactivation=null,this.dynamicValue=null}return r.prototype.clone=function(){var e=new r(this.serviceIdentifier,this.scope);return e.activated=e.scope===FW.BindingScopeEnum.Singleton?this.activated:!1,e.implementationType=this.implementationType,e.dynamicValue=this.dynamicValue,e.scope=this.scope,e.type=this.type,e.factory=this.factory,e.provider=this.provider,e.constraint=this.constraint,e.onActivation=this.onActivation,e.onDeactivation=this.onDeactivation,e.cache=this.cache,e},r}();XE.Binding=eY});var Oi=M(Ve=>{"use strict";Object.defineProperty(Ve,"__esModule",{value:!0});Ve.STACK_OVERFLOW=Ve.CIRCULAR_DEPENDENCY_IN_FACTORY=Ve.ON_DEACTIVATION_ERROR=Ve.PRE_DESTROY_ERROR=Ve.POST_CONSTRUCT_ERROR=Ve.ASYNC_UNBIND_REQUIRED=Ve.MULTIPLE_POST_CONSTRUCT_METHODS=Ve.MULTIPLE_PRE_DESTROY_METHODS=Ve.CONTAINER_OPTIONS_INVALID_SKIP_BASE_CHECK=Ve.CONTAINER_OPTIONS_INVALID_AUTO_BIND_INJECTABLE=Ve.CONTAINER_OPTIONS_INVALID_DEFAULT_SCOPE=Ve.CONTAINER_OPTIONS_MUST_BE_AN_OBJECT=Ve.ARGUMENTS_LENGTH_MISMATCH=Ve.INVALID_DECORATOR_OPERATION=Ve.INVALID_TO_SELF_VALUE=Ve.LAZY_IN_SYNC=Ve.INVALID_FUNCTION_BINDING=Ve.INVALID_MIDDLEWARE_RETURN=Ve.NO_MORE_SNAPSHOTS_AVAILABLE=Ve.INVALID_BINDING_TYPE=Ve.NOT_IMPLEMENTED=Ve.CIRCULAR_DEPENDENCY=Ve.UNDEFINED_INJECT_ANNOTATION=Ve.MISSING_INJECT_ANNOTATION=Ve.MISSING_INJECTABLE_ANNOTATION=Ve.NOT_REGISTERED=Ve.CANNOT_UNBIND=Ve.AMBIGUOUS_MATCH=Ve.KEY_NOT_FOUND=Ve.NULL_ARGUMENT=Ve.DUPLICATED_METADATA=Ve.DUPLICATED_INJECTABLE_DECORATOR=void 0;Ve.DUPLICATED_INJECTABLE_DECORATOR="Cannot apply @injectable decorator multiple times.";Ve.DUPLICATED_METADATA="Metadata key was used more than once in a parameter:";Ve.NULL_ARGUMENT="NULL argument";Ve.KEY_NOT_FOUND="Key Not Found";Ve.AMBIGUOUS_MATCH="Ambiguous match found for serviceIdentifier:";Ve.CANNOT_UNBIND="Could not unbind serviceIdentifier:";Ve.NOT_REGISTERED="No matching bindings found for serviceIdentifier:";Ve.MISSING_INJECTABLE_ANNOTATION="Missing required @injectable annotation in:";Ve.MISSING_INJECT_ANNOTATION="Missing required @inject or @multiInject annotation in:";var tY=function(r){return"@inject called with undefined this could mean that the class "+r+" has a circular dependency problem. You can use a LazyServiceIdentifer to  overcome this limitation."};Ve.UNDEFINED_INJECT_ANNOTATION=tY;Ve.CIRCULAR_DEPENDENCY="Circular dependency found:";Ve.NOT_IMPLEMENTED="Sorry, this feature is not fully implemented yet.";Ve.INVALID_BINDING_TYPE="Invalid binding type:";Ve.NO_MORE_SNAPSHOTS_AVAILABLE="No snapshot available to restore.";Ve.INVALID_MIDDLEWARE_RETURN="Invalid return type in middleware. Middleware must return!";Ve.INVALID_FUNCTION_BINDING="Value provided to function binding must be a function!";var rY=function(r){return"You are attempting to construct '"+r+`' in a synchronous way
 but it has asynchronous dependencies.`};Ve.LAZY_IN_SYNC=rY;Ve.INVALID_TO_SELF_VALUE="The toSelf function can only be applied when a constructor is used as service identifier";Ve.INVALID_DECORATOR_OPERATION="The @inject @multiInject @tagged and @named decorators must be applied to the parameters of a class constructor or a class property.";var nY=function(){for(var r=[],e=0;e<arguments.length;e++)r[e]=arguments[e];return"The number of constructor arguments in the derived class "+(r[0]+" must be >= than the number of constructor arguments of its base class.")};Ve.ARGUMENTS_LENGTH_MISMATCH=nY;Ve.CONTAINER_OPTIONS_MUST_BE_AN_OBJECT="Invalid Container constructor argument. Container options must be an object.";Ve.CONTAINER_OPTIONS_INVALID_DEFAULT_SCOPE="Invalid Container option. Default scope must be a string ('singleton' or 'transient').";Ve.CONTAINER_OPTIONS_INVALID_AUTO_BIND_INJECTABLE="Invalid Container option. Auto bind injectable must be a boolean";Ve.CONTAINER_OPTIONS_INVALID_SKIP_BASE_CHECK="Invalid Container option. Skip base check must be a boolean";Ve.MULTIPLE_PRE_DESTROY_METHODS="Cannot apply @preDestroy decorator multiple times in the same class";Ve.MULTIPLE_POST_CONSTRUCT_METHODS="Cannot apply @postConstruct decorator multiple times in the same class";Ve.ASYNC_UNBIND_REQUIRED="Attempting to unbind dependency with asynchronous destruction (@preDestroy or onDeactivation)";var iY=function(r,e){return"@postConstruct error in class "+r+": "+e};Ve.POST_CONSTRUCT_ERROR=iY;var oY=function(r,e){return"@preDestroy error in class "+r+": "+e};Ve.PRE_DESTROY_ERROR=oY;var sY=function(r,e){return"onDeactivation() error in class "+r+": "+e};Ve.ON_DEACTIVATION_ERROR=sY;var aY=function(r,e){return"It looks like there is a circular dependency in one of the '"+r+"' bindings. Please investigate bindings with"+("service identifier '"+e+"'.")};Ve.CIRCULAR_DEPENDENCY_IN_FACTORY=aY;Ve.STACK_OVERFLOW="Maximum call stack size exceeded"});var ZR=M(ol=>{"use strict";var lY=ol&&ol.__createBinding||(Object.create?function(r,e,t,n){n===void 0&&(n=t),Object.defineProperty(r,n,{enumerable:!0,get:function(){return e[t]}})}:function(r,e,t,n){n===void 0&&(n=t),r[n]=e[t]}),cY=ol&&ol.__setModuleDefault||(Object.create?function(r,e){Object.defineProperty(r,"default",{enumerable:!0,value:e})}:function(r,e){r.default=e}),uY=ol&&ol.__importStar||function(r){if(r&&r.__esModule)return r;var e={};if(r!=null)for(var t in r)t!=="default"&&Object.prototype.hasOwnProperty.call(r,t)&&lY(e,r,t);return cY(e,r),e};Object.defineProperty(ol,"__esModule",{value:!0});ol.MetadataReader=void 0;var XR=uY(Rn()),pY=function(){function r(){}return r.prototype.getConstructorMetadata=function(e){var t=Reflect.getMetadata(XR.PARAM_TYPES,e),n=Reflect.getMetadata(XR.TAGGED,e);return{compilerGeneratedMetadata:t,userGeneratedMetadata:n||{}}},r.prototype.getPropertiesMetadata=function(e){var t=Reflect.getMetadata(XR.TAGGED_PROP,e)||[];return t},r}();ol.MetadataReader=pY});var UW=M(ZE=>{"use strict";Object.defineProperty(ZE,"__esModule",{value:!0});ZE.BindingCount=void 0;var dY={MultipleBindingsAvailable:2,NoBindingsAvailable:0,OnlyOneBindingAvailable:1};ZE.BindingCount=dY});var eN=M(xs=>{"use strict";var mY=xs&&xs.__createBinding||(Object.create?function(r,e,t,n){n===void 0&&(n=t),Object.defineProperty(r,n,{enumerable:!0,get:function(){return e[t]}})}:function(r,e,t,n){n===void 0&&(n=t),r[n]=e[t]}),fY=xs&&xs.__setModuleDefault||(Object.create?function(r,e){Object.defineProperty(r,"default",{enumerable:!0,value:e})}:function(r,e){r.default=e}),hY=xs&&xs.__importStar||function(r){if(r&&r.__esModule)return r;var e={};if(r!=null)for(var t in r)t!=="default"&&Object.prototype.hasOwnProperty.call(r,t)&&mY(e,r,t);return fY(e,r),e};Object.defineProperty(xs,"__esModule",{value:!0});xs.tryAndThrowErrorIfStackOverflow=xs.isStackOverflowExeption=void 0;var gY=hY(Oi());function WW(r){return r instanceof RangeError||r.message===gY.STACK_OVERFLOW}xs.isStackOverflowExeption=WW;var vY=function(r,e){try{return r()}catch(t){throw WW(t)&&(t=e()),t}};xs.tryAndThrowErrorIfStackOverflow=vY});var yh=M(Nn=>{"use strict";var yY=Nn&&Nn.__createBinding||(Object.create?function(r,e,t,n){n===void 0&&(n=t),Object.defineProperty(r,n,{enumerable:!0,get:function(){return e[t]}})}:function(r,e,t,n){n===void 0&&(n=t),r[n]=e[t]}),bY=Nn&&Nn.__setModuleDefault||(Object.create?function(r,e){Object.defineProperty(r,"default",{enumerable:!0,value:e})}:function(r,e){r.default=e}),IY=Nn&&Nn.__importStar||function(r){if(r&&r.__esModule)return r;var e={};if(r!=null)for(var t in r)t!=="default"&&Object.prototype.hasOwnProperty.call(r,t)&&yY(e,r,t);return bY(e,r),e};Object.defineProperty(Nn,"__esModule",{value:!0});Nn.getSymbolDescription=Nn.circularDependencyToException=Nn.listMetadataForTarget=Nn.listRegisteredBindingsForServiceIdentifier=Nn.getServiceIdentifierAsString=Nn.getFunctionName=void 0;var SY=IY(Oi());function jW(r){if(typeof r=="function"){var e=r;return e.name}else{if(typeof r=="symbol")return r.toString();var e=r;return e}}Nn.getServiceIdentifierAsString=jW;function xY(r,e,t){var n="",i=t(r,e);return i.length!==0&&(n=`
Registered bindings:`,i.forEach(function(o){var s="Object";o.implementationType!==null&&(s=qW(o.implementationType)),n=n+`
 `+s,o.constraint.metaData&&(n=n+" - "+o.constraint.metaData)})),n}Nn.listRegisteredBindingsForServiceIdentifier=xY;function VW(r,e){return r.parentRequest===null?!1:r.parentRequest.serviceIdentifier===e?!0:VW(r.parentRequest,e)}function CY(r){function e(n,i){i===void 0&&(i=[]);var o=jW(n.serviceIdentifier);return i.push(o),n.parentRequest!==null?e(n.parentRequest,i):i}var t=e(r);return t.reverse().join(" --> ")}function BW(r){r.childRequests.forEach(function(e){if(VW(e,e.serviceIdentifier)){var t=CY(e);throw new Error(SY.CIRCULAR_DEPENDENCY+" "+t)}else BW(e)})}Nn.circularDependencyToException=BW;function EY(r,e){if(e.isTagged()||e.isNamed()){var t="",n=e.getNamedTag(),i=e.getCustomTags();return n!==null&&(t+=n.toString()+`
`),i!==null&&i.forEach(function(o){t+=o.toString()+`
`})," "+r+`
 `+r+" - "+t}else return" "+r}Nn.listMetadataForTarget=EY;function qW(r){if(r.name)return r.name;var e=r.toString(),t=e.match(/^function\s*([^\s(]+)/);return t?t[1]:"Anonymous function: "+e}Nn.getFunctionName=qW;function wY(r){return r.toString().slice(7,-1)}Nn.getSymbolDescription=wY});var JW=M(ew=>{"use strict";Object.defineProperty(ew,"__esModule",{value:!0});ew.Context=void 0;var kY=ep(),PY=function(){function r(e){this.id=(0,kY.id)(),this.container=e}return r.prototype.addPlan=function(e){this.plan=e},r.prototype.setCurrentRequest=function(e){this.currentRequest=e},r}();ew.Context=PY});var ha=M(sl=>{"use strict";var DY=sl&&sl.__createBinding||(Object.create?function(r,e,t,n){n===void 0&&(n=t),Object.defineProperty(r,n,{enumerable:!0,get:function(){return e[t]}})}:function(r,e,t,n){n===void 0&&(n=t),r[n]=e[t]}),TY=sl&&sl.__setModuleDefault||(Object.create?function(r,e){Object.defineProperty(r,"default",{enumerable:!0,value:e})}:function(r,e){r.default=e}),_Y=sl&&sl.__importStar||function(r){if(r&&r.__esModule)return r;var e={};if(r!=null)for(var t in r)t!=="default"&&Object.prototype.hasOwnProperty.call(r,t)&&DY(e,r,t);return TY(e,r),e};Object.defineProperty(sl,"__esModule",{value:!0});sl.Metadata=void 0;var RY=_Y(Rn()),NY=function(){function r(e,t){this.key=e,this.value=t}return r.prototype.toString=function(){return this.key===RY.NAMED_TAG?"named: "+String(this.value).toString()+" ":"tagged: { key:"+this.key.toString()+", value: "+String(this.value)+" }"},r}();sl.Metadata=NY});var $W=M(tw=>{"use strict";Object.defineProperty(tw,"__esModule",{value:!0});tw.Plan=void 0;var AY=function(){function r(e,t){this.parentContext=e,this.rootRequest=t}return r}();tw.Plan=AY});var tN=M(rw=>{"use strict";Object.defineProperty(rw,"__esModule",{value:!0});rw.LazyServiceIdentifer=void 0;var MY=function(){function r(e){this._cb=e}return r.prototype.unwrap=function(){return this._cb()},r}();rw.LazyServiceIdentifer=MY});var HW=M(nw=>{"use strict";Object.defineProperty(nw,"__esModule",{value:!0});nw.QueryableString=void 0;var OY=function(){function r(e){this.str=e}return r.prototype.startsWith=function(e){return this.str.indexOf(e)===0},r.prototype.endsWith=function(e){var t="",n=e.split("").reverse().join("");return t=this.str.split("").reverse().join(""),this.startsWith.call({str:t},n)},r.prototype.contains=function(e){return this.str.indexOf(e)!==-1},r.prototype.equals=function(e){return this.str===e},r.prototype.value=function(){return this.str},r}();nw.QueryableString=OY});var rN=M(al=>{"use strict";var KY=al&&al.__createBinding||(Object.create?function(r,e,t,n){n===void 0&&(n=t),Object.defineProperty(r,n,{enumerable:!0,get:function(){return e[t]}})}:function(r,e,t,n){n===void 0&&(n=t),r[n]=e[t]}),FY=al&&al.__setModuleDefault||(Object.create?function(r,e){Object.defineProperty(r,"default",{enumerable:!0,value:e})}:function(r,e){r.default=e}),LY=al&&al.__importStar||function(r){if(r&&r.__esModule)return r;var e={};if(r!=null)for(var t in r)t!=="default"&&Object.prototype.hasOwnProperty.call(r,t)&&KY(e,r,t);return FY(e,r),e};Object.defineProperty(al,"__esModule",{value:!0});al.Target=void 0;var Ac=LY(Rn()),UY=ep(),WY=yh(),GW=ha(),jY=HW(),VY=function(){function r(e,t,n,i){this.id=(0,UY.id)(),this.type=e,this.serviceIdentifier=n;var o=typeof t=="symbol"?(0,WY.getSymbolDescription)(t):t;this.name=new jY.QueryableString(o||""),this.identifier=t,this.metadata=new Array;var s=null;typeof i=="string"?s=new GW.Metadata(Ac.NAMED_TAG,i):i instanceof GW.Metadata&&(s=i),s!==null&&this.metadata.push(s)}return r.prototype.hasTag=function(e){for(var t=0,n=this.metadata;t<n.length;t++){var i=n[t];if(i.key===e)return!0}return!1},r.prototype.isArray=function(){return this.hasTag(Ac.MULTI_INJECT_TAG)},r.prototype.matchesArray=function(e){return this.matchesTag(Ac.MULTI_INJECT_TAG)(e)},r.prototype.isNamed=function(){return this.hasTag(Ac.NAMED_TAG)},r.prototype.isTagged=function(){return this.metadata.some(function(e){return Ac.NON_CUSTOM_TAG_KEYS.every(function(t){return e.key!==t})})},r.prototype.isOptional=function(){return this.matchesTag(Ac.OPTIONAL_TAG)(!0)},r.prototype.getNamedTag=function(){return this.isNamed()?this.metadata.filter(function(e){return e.key===Ac.NAMED_TAG})[0]:null},r.prototype.getCustomTags=function(){return this.isTagged()?this.metadata.filter(function(e){return Ac.NON_CUSTOM_TAG_KEYS.every(function(t){return e.key!==t})}):null},r.prototype.matchesNamedTag=function(e){return this.matchesTag(Ac.NAMED_TAG)(e)},r.prototype.matchesTag=function(e){var t=this;return function(n){for(var i=0,o=t.metadata;i<o.length;i++){var s=o[i];if(s.key===e&&s.value===n)return!0}return!1}},r}();al.Target=VY});var rj=M(Ki=>{"use strict";var BY=Ki&&Ki.__createBinding||(Object.create?function(r,e,t,n){n===void 0&&(n=t),Object.defineProperty(r,n,{enumerable:!0,get:function(){return e[t]}})}:function(r,e,t,n){n===void 0&&(n=t),r[n]=e[t]}),qY=Ki&&Ki.__setModuleDefault||(Object.create?function(r,e){Object.defineProperty(r,"default",{enumerable:!0,value:e})}:function(r,e){r.default=e}),zW=Ki&&Ki.__importStar||function(r){if(r&&r.__esModule)return r;var e={};if(r!=null)for(var t in r)t!=="default"&&Object.prototype.hasOwnProperty.call(r,t)&&BY(e,r,t);return qY(e,r),e},iw=Ki&&Ki.__spreadArray||function(r,e,t){if(t||arguments.length===2)for(var n=0,i=e.length,o;n<i;n++)(o||!(n in e))&&(o||(o=Array.prototype.slice.call(e,0,n)),o[n]=e[n]);return r.concat(o||Array.prototype.slice.call(e))};Object.defineProperty(Ki,"__esModule",{value:!0});Ki.getFunctionName=Ki.getBaseClassDependencyCount=Ki.getDependencies=void 0;var JY=tN(),nN=zW(Oi()),QW=fa(),qS=zW(Rn()),iN=yh();Object.defineProperty(Ki,"getFunctionName",{enumerable:!0,get:function(){return iN.getFunctionName}});var YW=rN();function $Y(r,e){var t=(0,iN.getFunctionName)(e);return XW(r,t,e,!1)}Ki.getDependencies=$Y;function XW(r,e,t,n){var i=r.getConstructorMetadata(t),o=i.compilerGeneratedMetadata;if(o===void 0){var s=nN.MISSING_INJECTABLE_ANNOTATION+" "+e+".";throw new Error(s)}var a=i.userGeneratedMetadata,l=Object.keys(a),c=t.length===0&&l.length>0,u=l.length>t.length,d=c||u?l.length:t.length,f=GY(n,e,o,a,d),h=ZW(r,t,e),v=iw(iw([],f,!0),h,!0);return v}function HY(r,e,t,n,i){var o=i[r.toString()]||[],s=tj(o),a=s.unmanaged!==!0,l=n[r],c=s.inject||s.multiInject;if(l=c||l,l instanceof JY.LazyServiceIdentifer&&(l=l.unwrap()),a){var u=l===Object,d=l===Function,f=l===void 0,h=u||d||f;if(!e&&h){var v=nN.MISSING_INJECT_ANNOTATION+" argument "+r+" in class "+t+".";throw new Error(v)}var S=new YW.Target(QW.TargetTypeEnum.ConstructorArgument,s.targetName,l);return S.metadata=o,S}return null}function GY(r,e,t,n,i){for(var o=[],s=0;s<i;s++){var a=s,l=HY(a,r,e,t,n);l!==null&&o.push(l)}return o}function zY(r,e,t,n){var i=r||e;if(i===void 0){var o=nN.MISSING_INJECTABLE_ANNOTATION+" for property "+String(t)+" in class "+n+".";throw new Error(o)}return i}function ZW(r,e,t){for(var n=r.getPropertiesMetadata(e),i=[],o=Object.getOwnPropertySymbols(n),s=Object.keys(n),a=s.concat(o),l=0,c=a;l<c.length;l++){var u=c[l],d=n[u],f=tj(d),h=f.targetName||u,v=zY(f.inject,f.multiInject,u,t),S=new YW.Target(QW.TargetTypeEnum.ClassProperty,h,v);S.metadata=d,i.push(S)}var b=Object.getPrototypeOf(e.prototype).constructor;if(b!==Object){var D=ZW(r,b,t);i=iw(iw([],i,!0),D,!0)}return i}function ej(r,e){var t=Object.getPrototypeOf(e.prototype).constructor;if(t!==Object){var n=(0,iN.getFunctionName)(t),i=XW(r,n,t,!0),o=i.map(function(l){return l.metadata.filter(function(c){return c.key===qS.UNMANAGED_TAG})}),s=[].concat.apply([],o).length,a=i.length-s;return a>0?a:ej(r,t)}else return 0}Ki.getBaseClassDependencyCount=ej;function tj(r){var e={};return r.forEach(function(t){e[t.key.toString()]=t.value}),{inject:e[qS.INJECT_TAG],multiInject:e[qS.MULTI_INJECT_TAG],targetName:e[qS.NAME_TAG],unmanaged:e[qS.UNMANAGED_TAG]}}});var nj=M(ow=>{"use strict";Object.defineProperty(ow,"__esModule",{value:!0});ow.Request=void 0;var QY=ep(),YY=function(){function r(e,t,n,i,o){this.id=(0,QY.id)(),this.serviceIdentifier=e,this.parentContext=t,this.parentRequest=n,this.target=o,this.childRequests=[],this.bindings=Array.isArray(i)?i:[i],this.requestScope=n===null?new Map:null}return r.prototype.addChildRequest=function(e,t,n){var i=new r(e,this.parentContext,this,t,n);return this.childRequests.push(i),i},r}();ow.Request=YY});var cN=M(Io=>{"use strict";var XY=Io&&Io.__createBinding||(Object.create?function(r,e,t,n){n===void 0&&(n=t),Object.defineProperty(r,n,{enumerable:!0,get:function(){return e[t]}})}:function(r,e,t,n){n===void 0&&(n=t),r[n]=e[t]}),ZY=Io&&Io.__setModuleDefault||(Object.create?function(r,e){Object.defineProperty(r,"default",{enumerable:!0,value:e})}:function(r,e){r.default=e}),sj=Io&&Io.__importStar||function(r){if(r&&r.__esModule)return r;var e={};if(r!=null)for(var t in r)t!=="default"&&Object.prototype.hasOwnProperty.call(r,t)&&XY(e,r,t);return ZY(e,r),e};Object.defineProperty(Io,"__esModule",{value:!0});Io.getBindingDictionary=Io.createMockRequest=Io.plan=void 0;var sw=UW(),sN=sj(Oi()),aj=fa(),ij=sj(Rn()),eX=eN(),bh=yh(),lj=JW(),aN=ha(),tX=$W(),oN=rj(),lN=nj(),cj=rN();function uj(r){return r._bindingDictionary}Io.getBindingDictionary=uj;function rX(r,e,t,n,i,o){var s=r?ij.MULTI_INJECT_TAG:ij.INJECT_TAG,a=new aN.Metadata(s,t),l=new cj.Target(e,n,t,a);if(i!==void 0){var c=new aN.Metadata(i,o);l.metadata.push(c)}return l}function oj(r,e,t,n,i){var o=JS(t.container,i.serviceIdentifier),s=[];return o.length===sw.BindingCount.NoBindingsAvailable&&t.container.options.autoBindInjectable&&typeof i.serviceIdentifier=="function"&&r.getConstructorMetadata(i.serviceIdentifier).compilerGeneratedMetadata&&(t.container.bind(i.serviceIdentifier).toSelf(),o=JS(t.container,i.serviceIdentifier)),e?s=o:s=o.filter(function(a){var l=new lN.Request(a.serviceIdentifier,t,n,a,i);return a.constraint(l)}),nX(i.serviceIdentifier,s,i,t.container),s}function nX(r,e,t,n){switch(e.length){case sw.BindingCount.NoBindingsAvailable:if(t.isOptional())return e;var i=(0,bh.getServiceIdentifierAsString)(r),o=sN.NOT_REGISTERED;throw o+=(0,bh.listMetadataForTarget)(i,t),o+=(0,bh.listRegisteredBindingsForServiceIdentifier)(n,i,JS),new Error(o);case sw.BindingCount.OnlyOneBindingAvailable:return e;case sw.BindingCount.MultipleBindingsAvailable:default:if(t.isArray())return e;var i=(0,bh.getServiceIdentifierAsString)(r),o=sN.AMBIGUOUS_MATCH+" "+i;throw o+=(0,bh.listRegisteredBindingsForServiceIdentifier)(n,i,JS),new Error(o)}}function pj(r,e,t,n,i,o){var s,a;if(i===null){s=oj(r,e,n,null,o),a=new lN.Request(t,n,null,s,o);var l=new tX.Plan(n,a);n.addPlan(l)}else s=oj(r,e,n,i,o),a=i.addChildRequest(o.serviceIdentifier,s,o);s.forEach(function(c){var u=null;if(o.isArray())u=a.addChildRequest(c.serviceIdentifier,c,o);else{if(c.cache)return;u=a}if(c.type===aj.BindingTypeEnum.Instance&&c.implementationType!==null){var d=(0,oN.getDependencies)(r,c.implementationType);if(!n.container.options.skipBaseClassChecks){var f=(0,oN.getBaseClassDependencyCount)(r,c.implementationType);if(d.length<f){var h=sN.ARGUMENTS_LENGTH_MISMATCH((0,oN.getFunctionName)(c.implementationType));throw new Error(h)}}d.forEach(function(v){pj(r,!1,v.serviceIdentifier,n,u,v)})}})}function JS(r,e){var t=[],n=uj(r);return n.hasKey(e)?t=n.get(e):r.parent!==null&&(t=JS(r.parent,e)),t}function iX(r,e,t,n,i,o,s,a){a===void 0&&(a=!1);var l=new lj.Context(e),c=rX(t,n,i,"",o,s);try{return pj(r,a,i,l,null,c),l}catch(u){throw(0,eX.isStackOverflowExeption)(u)&&(0,bh.circularDependencyToException)(l.plan.rootRequest),u}}Io.plan=iX;function oX(r,e,t,n){var i=new cj.Target(aj.TargetTypeEnum.Variable,"",e,new aN.Metadata(t,n)),o=new lj.Context(r),s=new lN.Request(e,o,null,[],i);return s}Io.createMockRequest=oX});var $S=M(Ih=>{"use strict";Object.defineProperty(Ih,"__esModule",{value:!0});Ih.isPromiseOrContainsPromise=Ih.isPromise=void 0;function uN(r){var e=typeof r=="object"&&r!==null||typeof r=="function";return e&&typeof r.then=="function"}Ih.isPromise=uN;function sX(r){return uN(r)?!0:Array.isArray(r)&&r.some(uN)}Ih.isPromiseOrContainsPromise=sX});var dj=M(ll=>{"use strict";var aX=ll&&ll.__awaiter||function(r,e,t,n){function i(o){return o instanceof t?o:new t(function(s){s(o)})}return new(t||(t=Promise))(function(o,s){function a(u){try{c(n.next(u))}catch(d){s(d)}}function l(u){try{c(n.throw(u))}catch(d){s(d)}}function c(u){u.done?o(u.value):i(u.value).then(a,l)}c((n=n.apply(r,e||[])).next())})},lX=ll&&ll.__generator||function(r,e){var t={label:0,sent:function(){if(o[0]&1)throw o[1];return o[1]},trys:[],ops:[]},n,i,o,s;return s={next:a(0),throw:a(1),return:a(2)},typeof Symbol=="function"&&(s[Symbol.iterator]=function(){return this}),s;function a(c){return function(u){return l([c,u])}}function l(c){if(n)throw new TypeError("Generator is already executing.");for(;t;)try{if(n=1,i&&(o=c[0]&2?i.return:c[0]?i.throw||((o=i.return)&&o.call(i),0):i.next)&&!(o=o.call(i,c[1])).done)return o;switch(i=0,o&&(c=[c[0]&2,o.value]),c[0]){case 0:case 1:o=c;break;case 4:return t.label++,{value:c[1],done:!1};case 5:t.label++,i=c[1],c=[0];continue;case 7:c=t.ops.pop(),t.trys.pop();continue;default:if(o=t.trys,!(o=o.length>0&&o[o.length-1])&&(c[0]===6||c[0]===2)){t=0;continue}if(c[0]===3&&(!o||c[1]>o[0]&&c[1]<o[3])){t.label=c[1];break}if(c[0]===6&&t.label<o[1]){t.label=o[1],o=c;break}if(o&&t.label<o[2]){t.label=o[2],t.ops.push(c);break}o[2]&&t.ops.pop(),t.trys.pop();continue}c=e.call(r,t)}catch(u){c=[6,u],i=0}finally{n=o=0}if(c[0]&5)throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}};Object.defineProperty(ll,"__esModule",{value:!0});ll.saveToScope=ll.tryGetFromScope=void 0;var aw=A(),cX=$S(),uX=function(r,e){return e.scope===aw.BindingScopeEnum.Singleton&&e.activated?e.cache:e.scope===aw.BindingScopeEnum.Request&&r.has(e.id)?r.get(e.id):null};ll.tryGetFromScope=uX;var pX=function(r,e,t){e.scope===aw.BindingScopeEnum.Singleton&&mX(e,t),e.scope===aw.BindingScopeEnum.Request&&dX(r,e,t)};ll.saveToScope=pX;var dX=function(r,e,t){r.has(e.id)||r.set(e.id,t)},mX=function(r,e){r.cache=e,r.activated=!0,(0,cX.isPromise)(e)&&fX(r,e)},fX=function(r,e){return aX(void 0,void 0,void 0,function(){var t,n;return lX(this,function(i){switch(i.label){case 0:return i.trys.push([0,2,,3]),[4,e];case 1:return t=i.sent(),r.cache=t,[3,3];case 2:throw n=i.sent(),r.cache=null,r.activated=!1,n;case 3:return[2]}})})}});var mj=M(HS=>{"use strict";Object.defineProperty(HS,"__esModule",{value:!0});HS.FactoryType=void 0;var hX;(function(r){r.DynamicValue="toDynamicValue",r.Factory="toFactory",r.Provider="toProvider"})(hX=HS.FactoryType||(HS.FactoryType={}))});var dN=M(So=>{"use strict";var gX=So&&So.__createBinding||(Object.create?function(r,e,t,n){n===void 0&&(n=t),Object.defineProperty(r,n,{enumerable:!0,get:function(){return e[t]}})}:function(r,e,t,n){n===void 0&&(n=t),r[n]=e[t]}),vX=So&&So.__setModuleDefault||(Object.create?function(r,e){Object.defineProperty(r,"default",{enumerable:!0,value:e})}:function(r,e){r.default=e}),yX=So&&So.__importStar||function(r){if(r&&r.__esModule)return r;var e={};if(r!=null)for(var t in r)t!=="default"&&Object.prototype.hasOwnProperty.call(r,t)&&gX(e,r,t);return vX(e,r),e};Object.defineProperty(So,"__esModule",{value:!0});So.getFactoryDetails=So.ensureFullyBound=So.multiBindToService=void 0;var bX=A(),IX=yX(Oi()),cl=fa(),pN=mj(),SX=function(r){return function(e){return function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];return t.forEach(function(i){return r.bind(i).toService(e)})}}};So.multiBindToService=SX;var xX=function(r){var e=null;switch(r.type){case cl.BindingTypeEnum.ConstantValue:case cl.BindingTypeEnum.Function:e=r.cache;break;case cl.BindingTypeEnum.Constructor:case cl.BindingTypeEnum.Instance:e=r.implementationType;break;case cl.BindingTypeEnum.DynamicValue:e=r.dynamicValue;break;case cl.BindingTypeEnum.Provider:e=r.provider;break;case cl.BindingTypeEnum.Factory:e=r.factory;break}if(e===null){var t=(0,bX.getServiceIdentifierAsString)(r.serviceIdentifier);throw new Error(IX.INVALID_BINDING_TYPE+" "+t)}};So.ensureFullyBound=xX;var CX=function(r){switch(r.type){case cl.BindingTypeEnum.Factory:return{factory:r.factory,factoryType:pN.FactoryType.Factory};case cl.BindingTypeEnum.Provider:return{factory:r.provider,factoryType:pN.FactoryType.Provider};case cl.BindingTypeEnum.DynamicValue:return{factory:r.dynamicValue,factoryType:pN.FactoryType.DynamicValue};default:throw new Error("Unexpected factory type "+r.type)}};So.getFactoryDetails=CX});var bj=M(si=>{"use strict";var Sh=si&&si.__assign||function(){return Sh=Object.assign||function(r){for(var e,t=1,n=arguments.length;t<n;t++){e=arguments[t];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(r[i]=e[i])}return r},Sh.apply(this,arguments)},EX=si&&si.__createBinding||(Object.create?function(r,e,t,n){n===void 0&&(n=t),Object.defineProperty(r,n,{enumerable:!0,get:function(){return e[t]}})}:function(r,e,t,n){n===void 0&&(n=t),r[n]=e[t]}),wX=si&&si.__setModuleDefault||(Object.create?function(r,e){Object.defineProperty(r,"default",{enumerable:!0,value:e})}:function(r,e){r.default=e}),kX=si&&si.__importStar||function(r){if(r&&r.__esModule)return r;var e={};if(r!=null)for(var t in r)t!=="default"&&Object.prototype.hasOwnProperty.call(r,t)&&EX(e,r,t);return wX(e,r),e},gj=si&&si.__awaiter||function(r,e,t,n){function i(o){return o instanceof t?o:new t(function(s){s(o)})}return new(t||(t=Promise))(function(o,s){function a(u){try{c(n.next(u))}catch(d){s(d)}}function l(u){try{c(n.throw(u))}catch(d){s(d)}}function c(u){u.done?o(u.value):i(u.value).then(a,l)}c((n=n.apply(r,e||[])).next())})},vj=si&&si.__generator||function(r,e){var t={label:0,sent:function(){if(o[0]&1)throw o[1];return o[1]},trys:[],ops:[]},n,i,o,s;return s={next:a(0),throw:a(1),return:a(2)},typeof Symbol=="function"&&(s[Symbol.iterator]=function(){return this}),s;function a(c){return function(u){return l([c,u])}}function l(c){if(n)throw new TypeError("Generator is already executing.");for(;t;)try{if(n=1,i&&(o=c[0]&2?i.return:c[0]?i.throw||((o=i.return)&&o.call(i),0):i.next)&&!(o=o.call(i,c[1])).done)return o;switch(i=0,o&&(c=[c[0]&2,o.value]),c[0]){case 0:case 1:o=c;break;case 4:return t.label++,{value:c[1],done:!1};case 5:t.label++,i=c[1],c=[0];continue;case 7:c=t.ops.pop(),t.trys.pop();continue;default:if(o=t.trys,!(o=o.length>0&&o[o.length-1])&&(c[0]===6||c[0]===2)){t=0;continue}if(c[0]===3&&(!o||c[1]>o[0]&&c[1]<o[3])){t.label=c[1];break}if(c[0]===6&&t.label<o[1]){t.label=o[1],o=c;break}if(o&&t.label<o[2]){t.label=o[2],t.ops.push(c);break}o[2]&&t.ops.pop(),t.trys.pop();continue}c=e.call(r,t)}catch(u){c=[6,u],i=0}finally{n=o=0}if(c[0]&5)throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}},PX=si&&si.__spreadArray||function(r,e,t){if(t||arguments.length===2)for(var n=0,i=e.length,o;n<i;n++)(o||!(n in e))&&(o||(o=Array.prototype.slice.call(e,0,n)),o[n]=e[n]);return r.concat(o||Array.prototype.slice.call(e))};Object.defineProperty(si,"__esModule",{value:!0});si.resolveInstance=void 0;var mN=Oi(),hN=fa(),fN=kX(Rn()),gN=$S();function DX(r,e){return r.reduce(function(t,n){var i=e(n),o=n.target.type;return o===hN.TargetTypeEnum.ConstructorArgument?t.constructorInjections.push(i):(t.propertyRequests.push(n),t.propertyInjections.push(i)),t.isAsync||(t.isAsync=(0,gN.isPromiseOrContainsPromise)(i)),t},{constructorInjections:[],propertyInjections:[],propertyRequests:[],isAsync:!1})}function TX(r,e,t){var n;if(e.length>0){var i=DX(e,t),o=Sh(Sh({},i),{constr:r});i.isAsync?n=_X(o):n=yj(o)}else n=new r;return n}function yj(r){var e,t=new((e=r.constr).bind.apply(e,PX([void 0],r.constructorInjections,!1)));return r.propertyRequests.forEach(function(n,i){var o=n.target.identifier,s=r.propertyInjections[i];t[o]=s}),t}function _X(r){return gj(this,void 0,void 0,function(){var e,t;return vj(this,function(n){switch(n.label){case 0:return[4,fj(r.constructorInjections)];case 1:return e=n.sent(),[4,fj(r.propertyInjections)];case 2:return t=n.sent(),[2,yj(Sh(Sh({},r),{constructorInjections:e,propertyInjections:t}))]}})})}function fj(r){return gj(this,void 0,void 0,function(){var e,t,n,i;return vj(this,function(o){for(e=[],t=0,n=r;t<n.length;t++)i=n[t],Array.isArray(i)?e.push(Promise.all(i)):e.push(i);return[2,Promise.all(e)]})})}function hj(r,e){var t=RX(r,e);return(0,gN.isPromise)(t)?t.then(function(){return e}):e}function RX(r,e){var t,n;if(Reflect.hasMetadata(fN.POST_CONSTRUCT,r)){var i=Reflect.getMetadata(fN.POST_CONSTRUCT,r);try{return(n=(t=e)[i.value])===null||n===void 0?void 0:n.call(t)}catch(o){throw new Error((0,mN.POST_CONSTRUCT_ERROR)(r.name,o.message))}}}function NX(r,e){r.scope!==hN.BindingScopeEnum.Singleton&&AX(r,e)}function AX(r,e){var t="Class cannot be instantiated in "+(r.scope===hN.BindingScopeEnum.Request?"request":"transient")+" scope.";if(typeof r.onDeactivation=="function")throw new Error((0,mN.ON_DEACTIVATION_ERROR)(e.name,t));if(Reflect.hasMetadata(fN.PRE_DESTROY,e))throw new Error((0,mN.PRE_DESTROY_ERROR)(e.name,t))}function MX(r,e,t,n){NX(r,e);var i=TX(e,t,n);return(0,gN.isPromise)(i)?i.then(function(o){return hj(e,o)}):hj(e,i)}si.resolveInstance=MX});var Ej=M(xo=>{"use strict";var OX=xo&&xo.__createBinding||(Object.create?function(r,e,t,n){n===void 0&&(n=t),Object.defineProperty(r,n,{enumerable:!0,get:function(){return e[t]}})}:function(r,e,t,n){n===void 0&&(n=t),r[n]=e[t]}),KX=xo&&xo.__setModuleDefault||(Object.create?function(r,e){Object.defineProperty(r,"default",{enumerable:!0,value:e})}:function(r,e){r.default=e}),FX=xo&&xo.__importStar||function(r){if(r&&r.__esModule)return r;var e={};if(r!=null)for(var t in r)t!=="default"&&Object.prototype.hasOwnProperty.call(r,t)&&OX(e,r,t);return KX(e,r),e},LX=xo&&xo.__awaiter||function(r,e,t,n){function i(o){return o instanceof t?o:new t(function(s){s(o)})}return new(t||(t=Promise))(function(o,s){function a(u){try{c(n.next(u))}catch(d){s(d)}}function l(u){try{c(n.throw(u))}catch(d){s(d)}}function c(u){u.done?o(u.value):i(u.value).then(a,l)}c((n=n.apply(r,e||[])).next())})},UX=xo&&xo.__generator||function(r,e){var t={label:0,sent:function(){if(o[0]&1)throw o[1];return o[1]},trys:[],ops:[]},n,i,o,s;return s={next:a(0),throw:a(1),return:a(2)},typeof Symbol=="function"&&(s[Symbol.iterator]=function(){return this}),s;function a(c){return function(u){return l([c,u])}}function l(c){if(n)throw new TypeError("Generator is already executing.");for(;t;)try{if(n=1,i&&(o=c[0]&2?i.return:c[0]?i.throw||((o=i.return)&&o.call(i),0):i.next)&&!(o=o.call(i,c[1])).done)return o;switch(i=0,o&&(c=[c[0]&2,o.value]),c[0]){case 0:case 1:o=c;break;case 4:return t.label++,{value:c[1],done:!1};case 5:t.label++,i=c[1],c=[0];continue;case 7:c=t.ops.pop(),t.trys.pop();continue;default:if(o=t.trys,!(o=o.length>0&&o[o.length-1])&&(c[0]===6||c[0]===2)){t=0;continue}if(c[0]===3&&(!o||c[1]>o[0]&&c[1]<o[3])){t.label=c[1];break}if(c[0]===6&&t.label<o[1]){t.label=o[1],o=c;break}if(o&&t.label<o[2]){t.label=o[2],t.ops.push(c);break}o[2]&&t.ops.pop(),t.trys.pop();continue}c=e.call(r,t)}catch(u){c=[6,u],i=0}finally{n=o=0}if(c[0]&5)throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}};Object.defineProperty(xo,"__esModule",{value:!0});xo.resolve=void 0;var WX=FX(Oi()),lw=fa(),jX=cN(),Ij=dj(),vN=$S(),xj=dN(),VX=eN(),BX=bj(),yN=function(r){return function(e){e.parentContext.setCurrentRequest(e);var t=e.bindings,n=e.childRequests,i=e.target&&e.target.isArray(),o=!e.parentRequest||!e.parentRequest.target||!e.target||!e.parentRequest.target.matchesArray(e.target.serviceIdentifier);if(i&&o)return n.map(function(a){var l=yN(r);return l(a)});if(e.target.isOptional()&&t.length===0)return;var s=t[0];return HX(r,e,s)}},qX=function(r,e){var t=(0,xj.getFactoryDetails)(r);return(0,VX.tryAndThrowErrorIfStackOverflow)(function(){return t.factory.bind(r)(e)},function(){return new Error(WX.CIRCULAR_DEPENDENCY_IN_FACTORY(t.factoryType,e.currentRequest.serviceIdentifier.toString()))})},JX=function(r,e,t){var n,i=e.childRequests;switch((0,xj.ensureFullyBound)(t),t.type){case lw.BindingTypeEnum.ConstantValue:case lw.BindingTypeEnum.Function:n=t.cache;break;case lw.BindingTypeEnum.Constructor:n=t.implementationType;break;case lw.BindingTypeEnum.Instance:n=(0,BX.resolveInstance)(t,t.implementationType,i,yN(r));break;default:n=qX(t,e.parentContext)}return n},$X=function(r,e,t){var n=(0,Ij.tryGetFromScope)(r,e);return n!==null||(n=t(),(0,Ij.saveToScope)(r,e,n)),n},HX=function(r,e,t){return $X(r,t,function(){var n=JX(r,e,t);return(0,vN.isPromise)(n)?n=n.then(function(i){return Sj(e,t,i)}):n=Sj(e,t,n),n})};function Sj(r,e,t){var n=GX(r.parentContext,e,t),i=YX(r.parentContext.container),o,s=i.next();do{o=s.value;var a=r.parentContext,l=r.serviceIdentifier,c=QX(o,l);(0,vN.isPromise)(n)?n=Cj(c,a,n):n=zX(c,a,n),s=i.next()}while(s.done!==!0&&!(0,jX.getBindingDictionary)(o).hasKey(r.serviceIdentifier));return n}var GX=function(r,e,t){var n;return typeof e.onActivation=="function"?n=e.onActivation(r,t):n=t,n},zX=function(r,e,t){for(var n=r.next();!n.done;){if(t=n.value(e,t),(0,vN.isPromise)(t))return Cj(r,e,t);n=r.next()}return t},Cj=function(r,e,t){return LX(void 0,void 0,void 0,function(){var n,i;return UX(this,function(o){switch(o.label){case 0:return[4,t];case 1:n=o.sent(),i=r.next(),o.label=2;case 2:return i.done?[3,4]:[4,i.value(e,n)];case 3:return n=o.sent(),i=r.next(),[3,2];case 4:return[2,n]}})})},QX=function(r,e){var t=r._activations;return t.hasKey(e)?t.get(e).values():[].values()},YX=function(r){for(var e=[r],t=r.parent;t!==null;)e.push(t),t=t.parent;var n=function(){var o=e.pop();return o!==void 0?{done:!1,value:o}:{done:!0,value:void 0}},i={next:n};return i};function XX(r){var e=yN(r.plan.rootRequest.requestScope);return e(r.plan.rootRequest)}xo.resolve=XX});var bN=M(Fi=>{"use strict";var ZX=Fi&&Fi.__createBinding||(Object.create?function(r,e,t,n){n===void 0&&(n=t),Object.defineProperty(r,n,{enumerable:!0,get:function(){return e[t]}})}:function(r,e,t,n){n===void 0&&(n=t),r[n]=e[t]}),eZ=Fi&&Fi.__setModuleDefault||(Object.create?function(r,e){Object.defineProperty(r,"default",{enumerable:!0,value:e})}:function(r,e){r.default=e}),tZ=Fi&&Fi.__importStar||function(r){if(r&&r.__esModule)return r;var e={};if(r!=null)for(var t in r)t!=="default"&&Object.prototype.hasOwnProperty.call(r,t)&&ZX(e,r,t);return eZ(e,r),e};Object.defineProperty(Fi,"__esModule",{value:!0});Fi.typeConstraint=Fi.namedConstraint=Fi.taggedConstraint=Fi.traverseAncerstors=void 0;var rZ=tZ(Rn()),nZ=ha(),wj=function(r,e){var t=r.parentRequest;return t!==null?e(t)?!0:wj(t,e):!1};Fi.traverseAncerstors=wj;var kj=function(r){return function(e){var t=function(n){return n!==null&&n.target!==null&&n.target.matchesTag(r)(e)};return t.metaData=new nZ.Metadata(r,e),t}};Fi.taggedConstraint=kj;var iZ=kj(rZ.NAMED_TAG);Fi.namedConstraint=iZ;var oZ=function(r){return function(e){var t=null;if(e!==null)if(t=e.bindings[0],typeof r=="string"){var n=t.serviceIdentifier;return n===r}else{var i=e.bindings[0].implementationType;return r===i}return!1}};Fi.typeConstraint=oZ});var uw=M(cw=>{"use strict";Object.defineProperty(cw,"__esModule",{value:!0});cw.BindingWhenSyntax=void 0;var eo=pw(),Bn=bN(),sZ=function(){function r(e){this._binding=e}return r.prototype.when=function(e){return this._binding.constraint=e,new eo.BindingOnSyntax(this._binding)},r.prototype.whenTargetNamed=function(e){return this._binding.constraint=(0,Bn.namedConstraint)(e),new eo.BindingOnSyntax(this._binding)},r.prototype.whenTargetIsDefault=function(){return this._binding.constraint=function(e){if(e===null)return!1;var t=e.target!==null&&!e.target.isNamed()&&!e.target.isTagged();return t},new eo.BindingOnSyntax(this._binding)},r.prototype.whenTargetTagged=function(e,t){return this._binding.constraint=(0,Bn.taggedConstraint)(e)(t),new eo.BindingOnSyntax(this._binding)},r.prototype.whenInjectedInto=function(e){return this._binding.constraint=function(t){return t!==null&&(0,Bn.typeConstraint)(e)(t.parentRequest)},new eo.BindingOnSyntax(this._binding)},r.prototype.whenParentNamed=function(e){return this._binding.constraint=function(t){return t!==null&&(0,Bn.namedConstraint)(e)(t.parentRequest)},new eo.BindingOnSyntax(this._binding)},r.prototype.whenParentTagged=function(e,t){return this._binding.constraint=function(n){return n!==null&&(0,Bn.taggedConstraint)(e)(t)(n.parentRequest)},new eo.BindingOnSyntax(this._binding)},r.prototype.whenAnyAncestorIs=function(e){return this._binding.constraint=function(t){return t!==null&&(0,Bn.traverseAncerstors)(t,(0,Bn.typeConstraint)(e))},new eo.BindingOnSyntax(this._binding)},r.prototype.whenNoAncestorIs=function(e){return this._binding.constraint=function(t){return t!==null&&!(0,Bn.traverseAncerstors)(t,(0,Bn.typeConstraint)(e))},new eo.BindingOnSyntax(this._binding)},r.prototype.whenAnyAncestorNamed=function(e){return this._binding.constraint=function(t){return t!==null&&(0,Bn.traverseAncerstors)(t,(0,Bn.namedConstraint)(e))},new eo.BindingOnSyntax(this._binding)},r.prototype.whenNoAncestorNamed=function(e){return this._binding.constraint=function(t){return t!==null&&!(0,Bn.traverseAncerstors)(t,(0,Bn.namedConstraint)(e))},new eo.BindingOnSyntax(this._binding)},r.prototype.whenAnyAncestorTagged=function(e,t){return this._binding.constraint=function(n){return n!==null&&(0,Bn.traverseAncerstors)(n,(0,Bn.taggedConstraint)(e)(t))},new eo.BindingOnSyntax(this._binding)},r.prototype.whenNoAncestorTagged=function(e,t){return this._binding.constraint=function(n){return n!==null&&!(0,Bn.traverseAncerstors)(n,(0,Bn.taggedConstraint)(e)(t))},new eo.BindingOnSyntax(this._binding)},r.prototype.whenAnyAncestorMatches=function(e){return this._binding.constraint=function(t){return t!==null&&(0,Bn.traverseAncerstors)(t,e)},new eo.BindingOnSyntax(this._binding)},r.prototype.whenNoAncestorMatches=function(e){return this._binding.constraint=function(t){return t!==null&&!(0,Bn.traverseAncerstors)(t,e)},new eo.BindingOnSyntax(this._binding)},r}();cw.BindingWhenSyntax=sZ});var pw=M(dw=>{"use strict";Object.defineProperty(dw,"__esModule",{value:!0});dw.BindingOnSyntax=void 0;var Pj=uw(),aZ=function(){function r(e){this._binding=e}return r.prototype.onActivation=function(e){return this._binding.onActivation=e,new Pj.BindingWhenSyntax(this._binding)},r.prototype.onDeactivation=function(e){return this._binding.onDeactivation=e,new Pj.BindingWhenSyntax(this._binding)},r}();dw.BindingOnSyntax=aZ});var IN=M(mw=>{"use strict";Object.defineProperty(mw,"__esModule",{value:!0});mw.BindingWhenOnSyntax=void 0;var lZ=pw(),cZ=uw(),uZ=function(){function r(e){this._binding=e,this._bindingWhenSyntax=new cZ.BindingWhenSyntax(this._binding),this._bindingOnSyntax=new lZ.BindingOnSyntax(this._binding)}return r.prototype.when=function(e){return this._bindingWhenSyntax.when(e)},r.prototype.whenTargetNamed=function(e){return this._bindingWhenSyntax.whenTargetNamed(e)},r.prototype.whenTargetIsDefault=function(){return this._bindingWhenSyntax.whenTargetIsDefault()},r.prototype.whenTargetTagged=function(e,t){return this._bindingWhenSyntax.whenTargetTagged(e,t)},r.prototype.whenInjectedInto=function(e){return this._bindingWhenSyntax.whenInjectedInto(e)},r.prototype.whenParentNamed=function(e){return this._bindingWhenSyntax.whenParentNamed(e)},r.prototype.whenParentTagged=function(e,t){return this._bindingWhenSyntax.whenParentTagged(e,t)},r.prototype.whenAnyAncestorIs=function(e){return this._bindingWhenSyntax.whenAnyAncestorIs(e)},r.prototype.whenNoAncestorIs=function(e){return this._bindingWhenSyntax.whenNoAncestorIs(e)},r.prototype.whenAnyAncestorNamed=function(e){return this._bindingWhenSyntax.whenAnyAncestorNamed(e)},r.prototype.whenAnyAncestorTagged=function(e,t){return this._bindingWhenSyntax.whenAnyAncestorTagged(e,t)},r.prototype.whenNoAncestorNamed=function(e){return this._bindingWhenSyntax.whenNoAncestorNamed(e)},r.prototype.whenNoAncestorTagged=function(e,t){return this._bindingWhenSyntax.whenNoAncestorTagged(e,t)},r.prototype.whenAnyAncestorMatches=function(e){return this._bindingWhenSyntax.whenAnyAncestorMatches(e)},r.prototype.whenNoAncestorMatches=function(e){return this._bindingWhenSyntax.whenNoAncestorMatches(e)},r.prototype.onActivation=function(e){return this._bindingOnSyntax.onActivation(e)},r.prototype.onDeactivation=function(e){return this._bindingOnSyntax.onDeactivation(e)},r}();mw.BindingWhenOnSyntax=uZ});var Dj=M(fw=>{"use strict";Object.defineProperty(fw,"__esModule",{value:!0});fw.BindingInSyntax=void 0;var SN=fa(),xN=IN(),pZ=function(){function r(e){this._binding=e}return r.prototype.inRequestScope=function(){return this._binding.scope=SN.BindingScopeEnum.Request,new xN.BindingWhenOnSyntax(this._binding)},r.prototype.inSingletonScope=function(){return this._binding.scope=SN.BindingScopeEnum.Singleton,new xN.BindingWhenOnSyntax(this._binding)},r.prototype.inTransientScope=function(){return this._binding.scope=SN.BindingScopeEnum.Transient,new xN.BindingWhenOnSyntax(this._binding)},r}();fw.BindingInSyntax=pZ});var Tj=M(hw=>{"use strict";Object.defineProperty(hw,"__esModule",{value:!0});hw.BindingInWhenOnSyntax=void 0;var dZ=Dj(),mZ=pw(),fZ=uw(),hZ=function(){function r(e){this._binding=e,this._bindingWhenSyntax=new fZ.BindingWhenSyntax(this._binding),this._bindingOnSyntax=new mZ.BindingOnSyntax(this._binding),this._bindingInSyntax=new dZ.BindingInSyntax(e)}return r.prototype.inRequestScope=function(){return this._bindingInSyntax.inRequestScope()},r.prototype.inSingletonScope=function(){return this._bindingInSyntax.inSingletonScope()},r.prototype.inTransientScope=function(){return this._bindingInSyntax.inTransientScope()},r.prototype.when=function(e){return this._bindingWhenSyntax.when(e)},r.prototype.whenTargetNamed=function(e){return this._bindingWhenSyntax.whenTargetNamed(e)},r.prototype.whenTargetIsDefault=function(){return this._bindingWhenSyntax.whenTargetIsDefault()},r.prototype.whenTargetTagged=function(e,t){return this._bindingWhenSyntax.whenTargetTagged(e,t)},r.prototype.whenInjectedInto=function(e){return this._bindingWhenSyntax.whenInjectedInto(e)},r.prototype.whenParentNamed=function(e){return this._bindingWhenSyntax.whenParentNamed(e)},r.prototype.whenParentTagged=function(e,t){return this._bindingWhenSyntax.whenParentTagged(e,t)},r.prototype.whenAnyAncestorIs=function(e){return this._bindingWhenSyntax.whenAnyAncestorIs(e)},r.prototype.whenNoAncestorIs=function(e){return this._bindingWhenSyntax.whenNoAncestorIs(e)},r.prototype.whenAnyAncestorNamed=function(e){return this._bindingWhenSyntax.whenAnyAncestorNamed(e)},r.prototype.whenAnyAncestorTagged=function(e,t){return this._bindingWhenSyntax.whenAnyAncestorTagged(e,t)},r.prototype.whenNoAncestorNamed=function(e){return this._bindingWhenSyntax.whenNoAncestorNamed(e)},r.prototype.whenNoAncestorTagged=function(e,t){return this._bindingWhenSyntax.whenNoAncestorTagged(e,t)},r.prototype.whenAnyAncestorMatches=function(e){return this._bindingWhenSyntax.whenAnyAncestorMatches(e)},r.prototype.whenNoAncestorMatches=function(e){return this._bindingWhenSyntax.whenNoAncestorMatches(e)},r.prototype.onActivation=function(e){return this._bindingOnSyntax.onActivation(e)},r.prototype.onDeactivation=function(e){return this._bindingOnSyntax.onDeactivation(e)},r}();hw.BindingInWhenOnSyntax=hZ});var Nj=M(ul=>{"use strict";var gZ=ul&&ul.__createBinding||(Object.create?function(r,e,t,n){n===void 0&&(n=t),Object.defineProperty(r,n,{enumerable:!0,get:function(){return e[t]}})}:function(r,e,t,n){n===void 0&&(n=t),r[n]=e[t]}),vZ=ul&&ul.__setModuleDefault||(Object.create?function(r,e){Object.defineProperty(r,"default",{enumerable:!0,value:e})}:function(r,e){r.default=e}),yZ=ul&&ul.__importStar||function(r){if(r&&r.__esModule)return r;var e={};if(r!=null)for(var t in r)t!=="default"&&Object.prototype.hasOwnProperty.call(r,t)&&gZ(e,r,t);return vZ(e,r),e};Object.defineProperty(ul,"__esModule",{value:!0});ul.BindingToSyntax=void 0;var _j=yZ(Oi()),to=fa(),Rj=Tj(),xh=IN(),bZ=function(){function r(e){this._binding=e}return r.prototype.to=function(e){return this._binding.type=to.BindingTypeEnum.Instance,this._binding.implementationType=e,new Rj.BindingInWhenOnSyntax(this._binding)},r.prototype.toSelf=function(){if(typeof this._binding.serviceIdentifier!="function")throw new Error(""+_j.INVALID_TO_SELF_VALUE);var e=this._binding.serviceIdentifier;return this.to(e)},r.prototype.toConstantValue=function(e){return this._binding.type=to.BindingTypeEnum.ConstantValue,this._binding.cache=e,this._binding.dynamicValue=null,this._binding.implementationType=null,this._binding.scope=to.BindingScopeEnum.Singleton,new xh.BindingWhenOnSyntax(this._binding)},r.prototype.toDynamicValue=function(e){return this._binding.type=to.BindingTypeEnum.DynamicValue,this._binding.cache=null,this._binding.dynamicValue=e,this._binding.implementationType=null,new Rj.BindingInWhenOnSyntax(this._binding)},r.prototype.toConstructor=function(e){return this._binding.type=to.BindingTypeEnum.Constructor,this._binding.implementationType=e,this._binding.scope=to.BindingScopeEnum.Singleton,new xh.BindingWhenOnSyntax(this._binding)},r.prototype.toFactory=function(e){return this._binding.type=to.BindingTypeEnum.Factory,this._binding.factory=e,this._binding.scope=to.BindingScopeEnum.Singleton,new xh.BindingWhenOnSyntax(this._binding)},r.prototype.toFunction=function(e){if(typeof e!="function")throw new Error(_j.INVALID_FUNCTION_BINDING);var t=this.toConstantValue(e);return this._binding.type=to.BindingTypeEnum.Function,this._binding.scope=to.BindingScopeEnum.Singleton,t},r.prototype.toAutoFactory=function(e){return this._binding.type=to.BindingTypeEnum.Factory,this._binding.factory=function(t){var n=function(){return t.container.get(e)};return n},this._binding.scope=to.BindingScopeEnum.Singleton,new xh.BindingWhenOnSyntax(this._binding)},r.prototype.toAutoNamedFactory=function(e){return this._binding.type=to.BindingTypeEnum.Factory,this._binding.factory=function(t){return function(n){return t.container.getNamed(e,n)}},new xh.BindingWhenOnSyntax(this._binding)},r.prototype.toProvider=function(e){return this._binding.type=to.BindingTypeEnum.Provider,this._binding.provider=e,this._binding.scope=to.BindingScopeEnum.Singleton,new xh.BindingWhenOnSyntax(this._binding)},r.prototype.toService=function(e){this.toDynamicValue(function(t){return t.container.get(e)})},r}();ul.BindingToSyntax=bZ});var Aj=M(gw=>{"use strict";Object.defineProperty(gw,"__esModule",{value:!0});gw.ContainerSnapshot=void 0;var IZ=function(){function r(){}return r.of=function(e,t,n,i,o){var s=new r;return s.bindings=e,s.middleware=t,s.deactivations=i,s.activations=n,s.moduleActivationStore=o,s},r}();gw.ContainerSnapshot=IZ});var Mj=M(vw=>{"use strict";Object.defineProperty(vw,"__esModule",{value:!0});vw.isClonable=void 0;function SZ(r){return typeof r=="object"&&r!==null&&"clone"in r&&typeof r.clone=="function"}vw.isClonable=SZ});var CN=M(pl=>{"use strict";var xZ=pl&&pl.__createBinding||(Object.create?function(r,e,t,n){n===void 0&&(n=t),Object.defineProperty(r,n,{enumerable:!0,get:function(){return e[t]}})}:function(r,e,t,n){n===void 0&&(n=t),r[n]=e[t]}),CZ=pl&&pl.__setModuleDefault||(Object.create?function(r,e){Object.defineProperty(r,"default",{enumerable:!0,value:e})}:function(r,e){r.default=e}),EZ=pl&&pl.__importStar||function(r){if(r&&r.__esModule)return r;var e={};if(r!=null)for(var t in r)t!=="default"&&Object.prototype.hasOwnProperty.call(r,t)&&xZ(e,r,t);return CZ(e,r),e};Object.defineProperty(pl,"__esModule",{value:!0});pl.Lookup=void 0;var Qd=EZ(Oi()),wZ=Mj(),kZ=function(){function r(){this._map=new Map}return r.prototype.getMap=function(){return this._map},r.prototype.add=function(e,t){if(e==null)throw new Error(Qd.NULL_ARGUMENT);if(t==null)throw new Error(Qd.NULL_ARGUMENT);var n=this._map.get(e);n!==void 0?n.push(t):this._map.set(e,[t])},r.prototype.get=function(e){if(e==null)throw new Error(Qd.NULL_ARGUMENT);var t=this._map.get(e);if(t!==void 0)return t;throw new Error(Qd.KEY_NOT_FOUND)},r.prototype.remove=function(e){if(e==null)throw new Error(Qd.NULL_ARGUMENT);if(!this._map.delete(e))throw new Error(Qd.KEY_NOT_FOUND)},r.prototype.removeIntersection=function(e){var t=this;this.traverse(function(n,i){var o=e.hasKey(n)?e.get(n):void 0;if(o!==void 0){var s=i.filter(function(a){return!o.some(function(l){return a===l})});t._setValue(n,s)}})},r.prototype.removeByCondition=function(e){var t=this,n=[];return this._map.forEach(function(i,o){for(var s=[],a=0,l=i;a<l.length;a++){var c=l[a],u=e(c);u?n.push(c):s.push(c)}t._setValue(o,s)}),n},r.prototype.hasKey=function(e){if(e==null)throw new Error(Qd.NULL_ARGUMENT);return this._map.has(e)},r.prototype.clone=function(){var e=new r;return this._map.forEach(function(t,n){t.forEach(function(i){return e.add(n,(0,wZ.isClonable)(i)?i.clone():i)})}),e},r.prototype.traverse=function(e){this._map.forEach(function(t,n){e(n,t)})},r.prototype._setValue=function(e,t){t.length>0?this._map.set(e,t):this._map.delete(e)},r}();pl.Lookup=kZ});var Kj=M(yw=>{"use strict";Object.defineProperty(yw,"__esModule",{value:!0});yw.ModuleActivationStore=void 0;var Oj=CN(),PZ=function(){function r(){this._map=new Map}return r.prototype.remove=function(e){if(this._map.has(e)){var t=this._map.get(e);return this._map.delete(e),t}return this._getEmptyHandlersStore()},r.prototype.addDeactivation=function(e,t,n){this._getModuleActivationHandlers(e).onDeactivations.add(t,n)},r.prototype.addActivation=function(e,t,n){this._getModuleActivationHandlers(e).onActivations.add(t,n)},r.prototype.clone=function(){var e=new r;return this._map.forEach(function(t,n){e._map.set(n,{onActivations:t.onActivations.clone(),onDeactivations:t.onDeactivations.clone()})}),e},r.prototype._getModuleActivationHandlers=function(e){var t=this._map.get(e);return t===void 0&&(t=this._getEmptyHandlersStore(),this._map.set(e,t)),t},r.prototype._getEmptyHandlersStore=function(){var e={onActivations:new Oj.Lookup,onDeactivations:new Oj.Lookup};return e},r}();yw.ModuleActivationStore=PZ});var EN=M(ai=>{"use strict";var Iw=ai&&ai.__assign||function(){return Iw=Object.assign||function(r){for(var e,t=1,n=arguments.length;t<n;t++){e=arguments[t];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(r[i]=e[i])}return r},Iw.apply(this,arguments)},DZ=ai&&ai.__createBinding||(Object.create?function(r,e,t,n){n===void 0&&(n=t),Object.defineProperty(r,n,{enumerable:!0,get:function(){return e[t]}})}:function(r,e,t,n){n===void 0&&(n=t),r[n]=e[t]}),TZ=ai&&ai.__setModuleDefault||(Object.create?function(r,e){Object.defineProperty(r,"default",{enumerable:!0,value:e})}:function(r,e){r.default=e}),Fj=ai&&ai.__importStar||function(r){if(r&&r.__esModule)return r;var e={};if(r!=null)for(var t in r)t!=="default"&&Object.prototype.hasOwnProperty.call(r,t)&&DZ(e,r,t);return TZ(e,r),e},Cs=ai&&ai.__awaiter||function(r,e,t,n){function i(o){return o instanceof t?o:new t(function(s){s(o)})}return new(t||(t=Promise))(function(o,s){function a(u){try{c(n.next(u))}catch(d){s(d)}}function l(u){try{c(n.throw(u))}catch(d){s(d)}}function c(u){u.done?o(u.value):i(u.value).then(a,l)}c((n=n.apply(r,e||[])).next())})},Es=ai&&ai.__generator||function(r,e){var t={label:0,sent:function(){if(o[0]&1)throw o[1];return o[1]},trys:[],ops:[]},n,i,o,s;return s={next:a(0),throw:a(1),return:a(2)},typeof Symbol=="function"&&(s[Symbol.iterator]=function(){return this}),s;function a(c){return function(u){return l([c,u])}}function l(c){if(n)throw new TypeError("Generator is already executing.");for(;t;)try{if(n=1,i&&(o=c[0]&2?i.return:c[0]?i.throw||((o=i.return)&&o.call(i),0):i.next)&&!(o=o.call(i,c[1])).done)return o;switch(i=0,o&&(c=[c[0]&2,o.value]),c[0]){case 0:case 1:o=c;break;case 4:return t.label++,{value:c[1],done:!1};case 5:t.label++,i=c[1],c=[0];continue;case 7:c=t.ops.pop(),t.trys.pop();continue;default:if(o=t.trys,!(o=o.length>0&&o[o.length-1])&&(c[0]===6||c[0]===2)){t=0;continue}if(c[0]===3&&(!o||c[1]>o[0]&&c[1]<o[3])){t.label=c[1];break}if(c[0]===6&&t.label<o[1]){t.label=o[1],o=c;break}if(o&&t.label<o[2]){t.label=o[2],t.ops.push(c);break}o[2]&&t.ops.pop(),t.trys.pop();continue}c=e.call(r,t)}catch(u){c=[6,u],i=0}finally{n=o=0}if(c[0]&5)throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}},_Z=ai&&ai.__spreadArray||function(r,e,t){if(t||arguments.length===2)for(var n=0,i=e.length,o;n<i;n++)(o||!(n in e))&&(o||(o=Array.prototype.slice.call(e,0,n)),o[n]=e[n]);return r.concat(o||Array.prototype.slice.call(e))};Object.defineProperty(ai,"__esModule",{value:!0});ai.Container=void 0;var RZ=LW(),ga=Fj(Oi()),Ch=fa(),Yd=Fj(Rn()),NZ=ZR(),bw=cN(),AZ=Ej(),MZ=Nj(),Xd=$S(),OZ=ep(),KZ=yh(),FZ=Aj(),GS=CN(),LZ=Kj(),UZ=function(){function r(e){var t=e||{};if(typeof t!="object")throw new Error(""+ga.CONTAINER_OPTIONS_MUST_BE_AN_OBJECT);if(t.defaultScope===void 0)t.defaultScope=Ch.BindingScopeEnum.Transient;else if(t.defaultScope!==Ch.BindingScopeEnum.Singleton&&t.defaultScope!==Ch.BindingScopeEnum.Transient&&t.defaultScope!==Ch.BindingScopeEnum.Request)throw new Error(""+ga.CONTAINER_OPTIONS_INVALID_DEFAULT_SCOPE);if(t.autoBindInjectable===void 0)t.autoBindInjectable=!1;else if(typeof t.autoBindInjectable!="boolean")throw new Error(""+ga.CONTAINER_OPTIONS_INVALID_AUTO_BIND_INJECTABLE);if(t.skipBaseClassChecks===void 0)t.skipBaseClassChecks=!1;else if(typeof t.skipBaseClassChecks!="boolean")throw new Error(""+ga.CONTAINER_OPTIONS_INVALID_SKIP_BASE_CHECK);this.options={autoBindInjectable:t.autoBindInjectable,defaultScope:t.defaultScope,skipBaseClassChecks:t.skipBaseClassChecks},this.id=(0,OZ.id)(),this._bindingDictionary=new GS.Lookup,this._snapshots=[],this._middleware=null,this._activations=new GS.Lookup,this._deactivations=new GS.Lookup,this.parent=null,this._metadataReader=new NZ.MetadataReader,this._moduleActivationStore=new LZ.ModuleActivationStore}return r.merge=function(e,t){for(var n=[],i=2;i<arguments.length;i++)n[i-2]=arguments[i];var o=new r,s=_Z([e,t],n,!0).map(function(c){return(0,bw.getBindingDictionary)(c)}),a=(0,bw.getBindingDictionary)(o);function l(c,u){c.traverse(function(d,f){f.forEach(function(h){u.add(h.serviceIdentifier,h.clone())})})}return s.forEach(function(c){l(c,a)}),o},r.prototype.load=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];for(var n=this._getContainerModuleHelpersFactory(),i=0,o=e;i<o.length;i++){var s=o[i],a=n(s.id);s.registry(a.bindFunction,a.unbindFunction,a.isboundFunction,a.rebindFunction,a.unbindAsyncFunction,a.onActivationFunction,a.onDeactivationFunction)}},r.prototype.loadAsync=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return Cs(this,void 0,void 0,function(){var n,i,o,s,a;return Es(this,function(l){switch(l.label){case 0:n=this._getContainerModuleHelpersFactory(),i=0,o=e,l.label=1;case 1:return i<o.length?(s=o[i],a=n(s.id),[4,s.registry(a.bindFunction,a.unbindFunction,a.isboundFunction,a.rebindFunction,a.unbindAsyncFunction,a.onActivationFunction,a.onDeactivationFunction)]):[3,4];case 2:l.sent(),l.label=3;case 3:return i++,[3,1];case 4:return[2]}})})},r.prototype.unload=function(){for(var e=this,t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];t.forEach(function(i){var o=e._removeModuleBindings(i.id);e._deactivateSingletons(o),e._removeModuleHandlers(i.id)})},r.prototype.unloadAsync=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return Cs(this,void 0,void 0,function(){var n,i,o,s;return Es(this,function(a){switch(a.label){case 0:n=0,i=e,a.label=1;case 1:return n<i.length?(o=i[n],s=this._removeModuleBindings(o.id),[4,this._deactivateSingletonsAsync(s)]):[3,4];case 2:a.sent(),this._removeModuleHandlers(o.id),a.label=3;case 3:return n++,[3,1];case 4:return[2]}})})},r.prototype.bind=function(e){var t=this.options.defaultScope||Ch.BindingScopeEnum.Transient,n=new RZ.Binding(e,t);return this._bindingDictionary.add(e,n),new MZ.BindingToSyntax(n)},r.prototype.rebind=function(e){return this.unbind(e),this.bind(e)},r.prototype.rebindAsync=function(e){return Cs(this,void 0,void 0,function(){return Es(this,function(t){switch(t.label){case 0:return[4,this.unbindAsync(e)];case 1:return t.sent(),[2,this.bind(e)]}})})},r.prototype.unbind=function(e){if(this._bindingDictionary.hasKey(e)){var t=this._bindingDictionary.get(e);this._deactivateSingletons(t)}this._removeServiceFromDictionary(e)},r.prototype.unbindAsync=function(e){return Cs(this,void 0,void 0,function(){var t;return Es(this,function(n){switch(n.label){case 0:return this._bindingDictionary.hasKey(e)?(t=this._bindingDictionary.get(e),[4,this._deactivateSingletonsAsync(t)]):[3,2];case 1:n.sent(),n.label=2;case 2:return this._removeServiceFromDictionary(e),[2]}})})},r.prototype.unbindAll=function(){var e=this;this._bindingDictionary.traverse(function(t,n){e._deactivateSingletons(n)}),this._bindingDictionary=new GS.Lookup},r.prototype.unbindAllAsync=function(){return Cs(this,void 0,void 0,function(){var e,t=this;return Es(this,function(n){switch(n.label){case 0:return e=[],this._bindingDictionary.traverse(function(i,o){e.push(t._deactivateSingletonsAsync(o))}),[4,Promise.all(e)];case 1:return n.sent(),this._bindingDictionary=new GS.Lookup,[2]}})})},r.prototype.onActivation=function(e,t){this._activations.add(e,t)},r.prototype.onDeactivation=function(e,t){this._deactivations.add(e,t)},r.prototype.isBound=function(e){var t=this._bindingDictionary.hasKey(e);return!t&&this.parent&&(t=this.parent.isBound(e)),t},r.prototype.isCurrentBound=function(e){return this._bindingDictionary.hasKey(e)},r.prototype.isBoundNamed=function(e,t){return this.isBoundTagged(e,Yd.NAMED_TAG,t)},r.prototype.isBoundTagged=function(e,t,n){var i=!1;if(this._bindingDictionary.hasKey(e)){var o=this._bindingDictionary.get(e),s=(0,bw.createMockRequest)(this,e,t,n);i=o.some(function(a){return a.constraint(s)})}return!i&&this.parent&&(i=this.parent.isBoundTagged(e,t,n)),i},r.prototype.snapshot=function(){this._snapshots.push(FZ.ContainerSnapshot.of(this._bindingDictionary.clone(),this._middleware,this._activations.clone(),this._deactivations.clone(),this._moduleActivationStore.clone()))},r.prototype.restore=function(){var e=this._snapshots.pop();if(e===void 0)throw new Error(ga.NO_MORE_SNAPSHOTS_AVAILABLE);this._bindingDictionary=e.bindings,this._activations=e.activations,this._deactivations=e.deactivations,this._middleware=e.middleware,this._moduleActivationStore=e.moduleActivationStore},r.prototype.createChild=function(e){var t=new r(e||this.options);return t.parent=this,t},r.prototype.applyMiddleware=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n=this._middleware?this._middleware:this._planAndResolve();this._middleware=e.reduce(function(i,o){return o(i)},n)},r.prototype.applyCustomMetadataReader=function(e){this._metadataReader=e},r.prototype.get=function(e){var t=this._getNotAllArgs(e,!1);return this._getButThrowIfAsync(t)},r.prototype.getAsync=function(e){return Cs(this,void 0,void 0,function(){var t;return Es(this,function(n){return t=this._getNotAllArgs(e,!1),[2,this._get(t)]})})},r.prototype.getTagged=function(e,t,n){var i=this._getNotAllArgs(e,!1,t,n);return this._getButThrowIfAsync(i)},r.prototype.getTaggedAsync=function(e,t,n){return Cs(this,void 0,void 0,function(){var i;return Es(this,function(o){return i=this._getNotAllArgs(e,!1,t,n),[2,this._get(i)]})})},r.prototype.getNamed=function(e,t){return this.getTagged(e,Yd.NAMED_TAG,t)},r.prototype.getNamedAsync=function(e,t){return this.getTaggedAsync(e,Yd.NAMED_TAG,t)},r.prototype.getAll=function(e){var t=this._getAllArgs(e);return this._getButThrowIfAsync(t)},r.prototype.getAllAsync=function(e){var t=this._getAllArgs(e);return this._getAll(t)},r.prototype.getAllTagged=function(e,t,n){var i=this._getNotAllArgs(e,!0,t,n);return this._getButThrowIfAsync(i)},r.prototype.getAllTaggedAsync=function(e,t,n){var i=this._getNotAllArgs(e,!0,t,n);return this._getAll(i)},r.prototype.getAllNamed=function(e,t){return this.getAllTagged(e,Yd.NAMED_TAG,t)},r.prototype.getAllNamedAsync=function(e,t){return this.getAllTaggedAsync(e,Yd.NAMED_TAG,t)},r.prototype.resolve=function(e){var t=this.isBound(e);t||this.bind(e).toSelf();var n=this.get(e);return t||this.unbind(e),n},r.prototype._preDestroy=function(e,t){if(Reflect.hasMetadata(Yd.PRE_DESTROY,e)){var n=Reflect.getMetadata(Yd.PRE_DESTROY,e);return t[n.value]()}},r.prototype._removeModuleHandlers=function(e){var t=this._moduleActivationStore.remove(e);this._activations.removeIntersection(t.onActivations),this._deactivations.removeIntersection(t.onDeactivations)},r.prototype._removeModuleBindings=function(e){return this._bindingDictionary.removeByCondition(function(t){return t.moduleId===e})},r.prototype._deactivate=function(e,t){var n=this,i=Object.getPrototypeOf(t).constructor;try{if(this._deactivations.hasKey(e.serviceIdentifier)){var o=this._deactivateContainer(t,this._deactivations.get(e.serviceIdentifier).values());if((0,Xd.isPromise)(o))return this._handleDeactivationError(o.then(function(){return n._propagateContainerDeactivationThenBindingAndPreDestroyAsync(e,t,i)}),i)}var s=this._propagateContainerDeactivationThenBindingAndPreDestroy(e,t,i);if((0,Xd.isPromise)(s))return this._handleDeactivationError(s,i)}catch(a){throw new Error(ga.ON_DEACTIVATION_ERROR(i.name,a.message))}},r.prototype._handleDeactivationError=function(e,t){return Cs(this,void 0,void 0,function(){var n;return Es(this,function(i){switch(i.label){case 0:return i.trys.push([0,2,,3]),[4,e];case 1:return i.sent(),[3,3];case 2:throw n=i.sent(),new Error(ga.ON_DEACTIVATION_ERROR(t.name,n.message));case 3:return[2]}})})},r.prototype._deactivateContainer=function(e,t){for(var n=this,i=t.next();i.value;){var o=i.value(e);if((0,Xd.isPromise)(o))return o.then(function(){return n._deactivateContainerAsync(e,t)});i=t.next()}},r.prototype._deactivateContainerAsync=function(e,t){return Cs(this,void 0,void 0,function(){var n;return Es(this,function(i){switch(i.label){case 0:n=t.next(),i.label=1;case 1:return n.value?[4,n.value(e)]:[3,3];case 2:return i.sent(),n=t.next(),[3,1];case 3:return[2]}})})},r.prototype._getContainerModuleHelpersFactory=function(){var e=this,t=function(u,d){u._binding.moduleId=d},n=function(u){return function(d){var f=e.bind(d);return t(f,u),f}},i=function(){return function(u){return e.unbind(u)}},o=function(){return function(u){return e.unbindAsync(u)}},s=function(){return function(u){return e.isBound(u)}},a=function(u){return function(d){var f=e.rebind(d);return t(f,u),f}},l=function(u){return function(d,f){e._moduleActivationStore.addActivation(u,d,f),e.onActivation(d,f)}},c=function(u){return function(d,f){e._moduleActivationStore.addDeactivation(u,d,f),e.onDeactivation(d,f)}};return function(u){return{bindFunction:n(u),isboundFunction:s(),onActivationFunction:l(u),onDeactivationFunction:c(u),rebindFunction:a(u),unbindFunction:i(),unbindAsyncFunction:o()}}},r.prototype._getAll=function(e){return Promise.all(this._get(e))},r.prototype._get=function(e){var t=Iw(Iw({},e),{contextInterceptor:function(i){return i},targetType:Ch.TargetTypeEnum.Variable});if(this._middleware){var n=this._middleware(t);if(n==null)throw new Error(ga.INVALID_MIDDLEWARE_RETURN);return n}return this._planAndResolve()(t)},r.prototype._getButThrowIfAsync=function(e){var t=this._get(e);if((0,Xd.isPromiseOrContainsPromise)(t))throw new Error(ga.LAZY_IN_SYNC(e.serviceIdentifier));return t},r.prototype._getAllArgs=function(e){var t={avoidConstraints:!0,isMultiInject:!0,serviceIdentifier:e};return t},r.prototype._getNotAllArgs=function(e,t,n,i){var o={avoidConstraints:!1,isMultiInject:t,serviceIdentifier:e,key:n,value:i};return o},r.prototype._planAndResolve=function(){var e=this;return function(t){var n=(0,bw.plan)(e._metadataReader,e,t.isMultiInject,t.targetType,t.serviceIdentifier,t.key,t.value,t.avoidConstraints);n=t.contextInterceptor(n);var i=(0,AZ.resolve)(n);return i}},r.prototype._deactivateIfSingleton=function(e){var t=this;if(e.activated)return(0,Xd.isPromise)(e.cache)?e.cache.then(function(n){return t._deactivate(e,n)}):this._deactivate(e,e.cache)},r.prototype._deactivateSingletons=function(e){for(var t=0,n=e;t<n.length;t++){var i=n[t],o=this._deactivateIfSingleton(i);if((0,Xd.isPromise)(o))throw new Error(ga.ASYNC_UNBIND_REQUIRED)}},r.prototype._deactivateSingletonsAsync=function(e){return Cs(this,void 0,void 0,function(){var t=this;return Es(this,function(n){switch(n.label){case 0:return[4,Promise.all(e.map(function(i){return t._deactivateIfSingleton(i)}))];case 1:return n.sent(),[2]}})})},r.prototype._propagateContainerDeactivationThenBindingAndPreDestroy=function(e,t,n){return this.parent?this._deactivate.bind(this.parent)(e,t):this._bindingDeactivationAndPreDestroy(e,t,n)},r.prototype._propagateContainerDeactivationThenBindingAndPreDestroyAsync=function(e,t,n){return Cs(this,void 0,void 0,function(){return Es(this,function(i){switch(i.label){case 0:return this.parent?[4,this._deactivate.bind(this.parent)(e,t)]:[3,2];case 1:return i.sent(),[3,4];case 2:return[4,this._bindingDeactivationAndPreDestroyAsync(e,t,n)];case 3:i.sent(),i.label=4;case 4:return[2]}})})},r.prototype._removeServiceFromDictionary=function(e){try{this._bindingDictionary.remove(e)}catch{throw new Error(ga.CANNOT_UNBIND+" "+(0,KZ.getServiceIdentifierAsString)(e))}},r.prototype._bindingDeactivationAndPreDestroy=function(e,t,n){var i=this;if(typeof e.onDeactivation=="function"){var o=e.onDeactivation(t);if((0,Xd.isPromise)(o))return o.then(function(){return i._preDestroy(n,t)})}return this._preDestroy(n,t)},r.prototype._bindingDeactivationAndPreDestroyAsync=function(e,t,n){return Cs(this,void 0,void 0,function(){return Es(this,function(i){switch(i.label){case 0:return typeof e.onDeactivation!="function"?[3,2]:[4,e.onDeactivation(t)];case 1:i.sent(),i.label=2;case 2:return[4,this._preDestroy(n,t)];case 3:return i.sent(),[2]}})})},r}();ai.Container=UZ});var Uj=M(Eh=>{"use strict";Object.defineProperty(Eh,"__esModule",{value:!0});Eh.AsyncContainerModule=Eh.ContainerModule=void 0;var Lj=ep(),WZ=function(){function r(e){this.id=(0,Lj.id)(),this.registry=e}return r}();Eh.ContainerModule=WZ;var jZ=function(){function r(e){this.id=(0,Lj.id)(),this.registry=e}return r}();Eh.AsyncContainerModule=jZ});var Wj=M(Sw=>{"use strict";Object.defineProperty(Sw,"__esModule",{value:!0});Sw.getFirstArrayDuplicate=void 0;function VZ(r){for(var e=new Set,t=0,n=r;t<n.length;t++){var i=n[t];if(e.has(i))return i;e.add(i)}}Sw.getFirstArrayDuplicate=VZ});var Mc=M(Li=>{"use strict";var BZ=Li&&Li.__createBinding||(Object.create?function(r,e,t,n){n===void 0&&(n=t),Object.defineProperty(r,n,{enumerable:!0,get:function(){return e[t]}})}:function(r,e,t,n){n===void 0&&(n=t),r[n]=e[t]}),qZ=Li&&Li.__setModuleDefault||(Object.create?function(r,e){Object.defineProperty(r,"default",{enumerable:!0,value:e})}:function(r,e){r.default=e}),Vj=Li&&Li.__importStar||function(r){if(r&&r.__esModule)return r;var e={};if(r!=null)for(var t in r)t!=="default"&&Object.prototype.hasOwnProperty.call(r,t)&&BZ(e,r,t);return qZ(e,r),e};Object.defineProperty(Li,"__esModule",{value:!0});Li.createTaggedDecorator=Li.tagProperty=Li.tagParameter=Li.decorate=void 0;var xw=Vj(Oi()),Bj=Vj(Rn()),JZ=Wj();function $Z(r){return r.prototype!==void 0}function HZ(r){if(r!==void 0)throw new Error(xw.INVALID_DECORATOR_OPERATION)}function qj(r,e,t,n){HZ(e),$j(Bj.TAGGED,r,t.toString(),n)}Li.tagParameter=qj;function Jj(r,e,t){if($Z(r))throw new Error(xw.INVALID_DECORATOR_OPERATION);$j(Bj.TAGGED_PROP,r.constructor,e,t)}Li.tagProperty=Jj;function GZ(r){var e=[];if(Array.isArray(r)){e=r;var t=(0,JZ.getFirstArrayDuplicate)(e.map(function(n){return n.key}));if(t!==void 0)throw new Error(xw.DUPLICATED_METADATA+" "+t.toString())}else e=[r];return e}function $j(r,e,t,n){var i=GZ(n),o={};Reflect.hasOwnMetadata(r,e)&&(o=Reflect.getMetadata(r,e));var s=o[t];if(s===void 0)s=[];else for(var a=function(d){if(i.some(function(f){return f.key===d.key}))throw new Error(xw.DUPLICATED_METADATA+" "+d.key.toString())},l=0,c=s;l<c.length;l++){var u=c[l];a(u)}s.push.apply(s,i),o[t]=s,Reflect.defineMetadata(r,o,e)}function zZ(r){return function(e,t,n){typeof n=="number"?qj(e,t,n,r):Jj(e,t,r)}}Li.createTaggedDecorator=zZ;function jj(r,e){Reflect.decorate(r,e)}function QZ(r,e){return function(t,n){e(t,n,r)}}function YZ(r,e,t){typeof t=="number"?jj([QZ(t,r)],e):typeof t=="string"?Reflect.decorate([r],e,t):jj([r],e)}Li.decorate=YZ});var Gj=M(dl=>{"use strict";var XZ=dl&&dl.__createBinding||(Object.create?function(r,e,t,n){n===void 0&&(n=t),Object.defineProperty(r,n,{enumerable:!0,get:function(){return e[t]}})}:function(r,e,t,n){n===void 0&&(n=t),r[n]=e[t]}),ZZ=dl&&dl.__setModuleDefault||(Object.create?function(r,e){Object.defineProperty(r,"default",{enumerable:!0,value:e})}:function(r,e){r.default=e}),Hj=dl&&dl.__importStar||function(r){if(r&&r.__esModule)return r;var e={};if(r!=null)for(var t in r)t!=="default"&&Object.prototype.hasOwnProperty.call(r,t)&&XZ(e,r,t);return ZZ(e,r),e};Object.defineProperty(dl,"__esModule",{value:!0});dl.injectable=void 0;var eee=Hj(Oi()),wN=Hj(Rn());function tee(){return function(r){if(Reflect.hasOwnMetadata(wN.PARAM_TYPES,r))throw new Error(eee.DUPLICATED_INJECTABLE_DECORATOR);var e=Reflect.getMetadata(wN.DESIGN_PARAM_TYPES,r)||[];return Reflect.defineMetadata(wN.PARAM_TYPES,e,r),r}}dl.injectable=tee});var zj=M(Cw=>{"use strict";Object.defineProperty(Cw,"__esModule",{value:!0});Cw.tagged=void 0;var ree=ha(),nee=Mc();function iee(r,e){return(0,nee.createTaggedDecorator)(new ree.Metadata(r,e))}Cw.tagged=iee});var Qj=M(ml=>{"use strict";var oee=ml&&ml.__createBinding||(Object.create?function(r,e,t,n){n===void 0&&(n=t),Object.defineProperty(r,n,{enumerable:!0,get:function(){return e[t]}})}:function(r,e,t,n){n===void 0&&(n=t),r[n]=e[t]}),see=ml&&ml.__setModuleDefault||(Object.create?function(r,e){Object.defineProperty(r,"default",{enumerable:!0,value:e})}:function(r,e){r.default=e}),aee=ml&&ml.__importStar||function(r){if(r&&r.__esModule)return r;var e={};if(r!=null)for(var t in r)t!=="default"&&Object.prototype.hasOwnProperty.call(r,t)&&oee(e,r,t);return see(e,r),e};Object.defineProperty(ml,"__esModule",{value:!0});ml.named=void 0;var lee=aee(Rn()),cee=ha(),uee=Mc();function pee(r){return(0,uee.createTaggedDecorator)(new cee.Metadata(lee.NAMED_TAG,r))}ml.named=pee});var kN=M(Ew=>{"use strict";Object.defineProperty(Ew,"__esModule",{value:!0});Ew.injectBase=void 0;var dee=Oi(),mee=ha(),fee=Mc();function hee(r){return function(e){return function(t,n,i){if(e===void 0){var o=typeof t=="function"?t.name:t.constructor.name;throw new Error((0,dee.UNDEFINED_INJECT_ANNOTATION)(o))}return(0,fee.createTaggedDecorator)(new mee.Metadata(r,e))(t,n,i)}}}Ew.injectBase=hee});var Yj=M(fl=>{"use strict";var gee=fl&&fl.__createBinding||(Object.create?function(r,e,t,n){n===void 0&&(n=t),Object.defineProperty(r,n,{enumerable:!0,get:function(){return e[t]}})}:function(r,e,t,n){n===void 0&&(n=t),r[n]=e[t]}),vee=fl&&fl.__setModuleDefault||(Object.create?function(r,e){Object.defineProperty(r,"default",{enumerable:!0,value:e})}:function(r,e){r.default=e}),yee=fl&&fl.__importStar||function(r){if(r&&r.__esModule)return r;var e={};if(r!=null)for(var t in r)t!=="default"&&Object.prototype.hasOwnProperty.call(r,t)&&gee(e,r,t);return vee(e,r),e};Object.defineProperty(fl,"__esModule",{value:!0});fl.inject=void 0;var bee=yee(Rn()),Iee=kN(),See=(0,Iee.injectBase)(bee.INJECT_TAG);fl.inject=See});var Xj=M(hl=>{"use strict";var xee=hl&&hl.__createBinding||(Object.create?function(r,e,t,n){n===void 0&&(n=t),Object.defineProperty(r,n,{enumerable:!0,get:function(){return e[t]}})}:function(r,e,t,n){n===void 0&&(n=t),r[n]=e[t]}),Cee=hl&&hl.__setModuleDefault||(Object.create?function(r,e){Object.defineProperty(r,"default",{enumerable:!0,value:e})}:function(r,e){r.default=e}),Eee=hl&&hl.__importStar||function(r){if(r&&r.__esModule)return r;var e={};if(r!=null)for(var t in r)t!=="default"&&Object.prototype.hasOwnProperty.call(r,t)&&xee(e,r,t);return Cee(e,r),e};Object.defineProperty(hl,"__esModule",{value:!0});hl.optional=void 0;var wee=Eee(Rn()),kee=ha(),Pee=Mc();function Dee(){return(0,Pee.createTaggedDecorator)(new kee.Metadata(wee.OPTIONAL_TAG,!0))}hl.optional=Dee});var Zj=M(gl=>{"use strict";var Tee=gl&&gl.__createBinding||(Object.create?function(r,e,t,n){n===void 0&&(n=t),Object.defineProperty(r,n,{enumerable:!0,get:function(){return e[t]}})}:function(r,e,t,n){n===void 0&&(n=t),r[n]=e[t]}),_ee=gl&&gl.__setModuleDefault||(Object.create?function(r,e){Object.defineProperty(r,"default",{enumerable:!0,value:e})}:function(r,e){r.default=e}),Ree=gl&&gl.__importStar||function(r){if(r&&r.__esModule)return r;var e={};if(r!=null)for(var t in r)t!=="default"&&Object.prototype.hasOwnProperty.call(r,t)&&Tee(e,r,t);return _ee(e,r),e};Object.defineProperty(gl,"__esModule",{value:!0});gl.unmanaged=void 0;var Nee=Ree(Rn()),Aee=ha(),Mee=Mc();function Oee(){return function(r,e,t){var n=new Aee.Metadata(Nee.UNMANAGED_TAG,!0);(0,Mee.tagParameter)(r,e,t,n)}}gl.unmanaged=Oee});var e2=M(vl=>{"use strict";var Kee=vl&&vl.__createBinding||(Object.create?function(r,e,t,n){n===void 0&&(n=t),Object.defineProperty(r,n,{enumerable:!0,get:function(){return e[t]}})}:function(r,e,t,n){n===void 0&&(n=t),r[n]=e[t]}),Fee=vl&&vl.__setModuleDefault||(Object.create?function(r,e){Object.defineProperty(r,"default",{enumerable:!0,value:e})}:function(r,e){r.default=e}),Lee=vl&&vl.__importStar||function(r){if(r&&r.__esModule)return r;var e={};if(r!=null)for(var t in r)t!=="default"&&Object.prototype.hasOwnProperty.call(r,t)&&Kee(e,r,t);return Fee(e,r),e};Object.defineProperty(vl,"__esModule",{value:!0});vl.multiInject=void 0;var Uee=Lee(Rn()),Wee=kN(),jee=(0,Wee.injectBase)(Uee.MULTI_INJECT_TAG);vl.multiInject=jee});var t2=M(yl=>{"use strict";var Vee=yl&&yl.__createBinding||(Object.create?function(r,e,t,n){n===void 0&&(n=t),Object.defineProperty(r,n,{enumerable:!0,get:function(){return e[t]}})}:function(r,e,t,n){n===void 0&&(n=t),r[n]=e[t]}),Bee=yl&&yl.__setModuleDefault||(Object.create?function(r,e){Object.defineProperty(r,"default",{enumerable:!0,value:e})}:function(r,e){r.default=e}),qee=yl&&yl.__importStar||function(r){if(r&&r.__esModule)return r;var e={};if(r!=null)for(var t in r)t!=="default"&&Object.prototype.hasOwnProperty.call(r,t)&&Vee(e,r,t);return Bee(e,r),e};Object.defineProperty(yl,"__esModule",{value:!0});yl.targetName=void 0;var Jee=qee(Rn()),$ee=ha(),Hee=Mc();function Gee(r){return function(e,t,n){var i=new $ee.Metadata(Jee.NAME_TAG,r);(0,Hee.tagParameter)(e,t,n,i)}}yl.targetName=Gee});var PN=M(ww=>{"use strict";Object.defineProperty(ww,"__esModule",{value:!0});ww.propertyEventDecorator=void 0;var zee=ha();function Qee(r,e){return function(){return function(t,n){var i=new zee.Metadata(r,n);if(Reflect.hasOwnMetadata(r,t.constructor))throw new Error(e);Reflect.defineMetadata(r,i,t.constructor)}}}ww.propertyEventDecorator=Qee});var n2=M(bl=>{"use strict";var Yee=bl&&bl.__createBinding||(Object.create?function(r,e,t,n){n===void 0&&(n=t),Object.defineProperty(r,n,{enumerable:!0,get:function(){return e[t]}})}:function(r,e,t,n){n===void 0&&(n=t),r[n]=e[t]}),Xee=bl&&bl.__setModuleDefault||(Object.create?function(r,e){Object.defineProperty(r,"default",{enumerable:!0,value:e})}:function(r,e){r.default=e}),r2=bl&&bl.__importStar||function(r){if(r&&r.__esModule)return r;var e={};if(r!=null)for(var t in r)t!=="default"&&Object.prototype.hasOwnProperty.call(r,t)&&Yee(e,r,t);return Xee(e,r),e};Object.defineProperty(bl,"__esModule",{value:!0});bl.postConstruct=void 0;var Zee=r2(Oi()),ete=r2(Rn()),tte=PN(),rte=(0,tte.propertyEventDecorator)(ete.POST_CONSTRUCT,Zee.MULTIPLE_POST_CONSTRUCT_METHODS);bl.postConstruct=rte});var o2=M(Il=>{"use strict";var nte=Il&&Il.__createBinding||(Object.create?function(r,e,t,n){n===void 0&&(n=t),Object.defineProperty(r,n,{enumerable:!0,get:function(){return e[t]}})}:function(r,e,t,n){n===void 0&&(n=t),r[n]=e[t]}),ite=Il&&Il.__setModuleDefault||(Object.create?function(r,e){Object.defineProperty(r,"default",{enumerable:!0,value:e})}:function(r,e){r.default=e}),i2=Il&&Il.__importStar||function(r){if(r&&r.__esModule)return r;var e={};if(r!=null)for(var t in r)t!=="default"&&Object.prototype.hasOwnProperty.call(r,t)&&nte(e,r,t);return ite(e,r),e};Object.defineProperty(Il,"__esModule",{value:!0});Il.preDestroy=void 0;var ote=i2(Oi()),ste=i2(Rn()),ate=PN(),lte=(0,ate.propertyEventDecorator)(ste.PRE_DESTROY,ote.MULTIPLE_PRE_DESTROY_METHODS);Il.preDestroy=lte});var s2=M(kw=>{"use strict";Object.defineProperty(kw,"__esModule",{value:!0});kw.interfaces=void 0;var DN;DN||(DN={});kw.interfaces=DN});var A=M(Be=>{"use strict";var cte=Be&&Be.__createBinding||(Object.create?function(r,e,t,n){n===void 0&&(n=t),Object.defineProperty(r,n,{enumerable:!0,get:function(){return e[t]}})}:function(r,e,t,n){n===void 0&&(n=t),r[n]=e[t]}),ute=Be&&Be.__setModuleDefault||(Object.create?function(r,e){Object.defineProperty(r,"default",{enumerable:!0,value:e})}:function(r,e){r.default=e}),pte=Be&&Be.__importStar||function(r){if(r&&r.__esModule)return r;var e={};if(r!=null)for(var t in r)t!=="default"&&Object.prototype.hasOwnProperty.call(r,t)&&cte(e,r,t);return ute(e,r),e};Object.defineProperty(Be,"__esModule",{value:!0});Be.multiBindToService=Be.getServiceIdentifierAsString=Be.typeConstraint=Be.namedConstraint=Be.taggedConstraint=Be.traverseAncerstors=Be.decorate=Be.interfaces=Be.id=Be.MetadataReader=Be.preDestroy=Be.postConstruct=Be.targetName=Be.multiInject=Be.unmanaged=Be.optional=Be.LazyServiceIdentifer=Be.inject=Be.named=Be.tagged=Be.injectable=Be.createTaggedDecorator=Be.ContainerModule=Be.AsyncContainerModule=Be.TargetTypeEnum=Be.BindingTypeEnum=Be.BindingScopeEnum=Be.Container=Be.METADATA_KEY=void 0;var dte=pte(Rn());Be.METADATA_KEY=dte;var mte=EN();Object.defineProperty(Be,"Container",{enumerable:!0,get:function(){return mte.Container}});var TN=fa();Object.defineProperty(Be,"BindingScopeEnum",{enumerable:!0,get:function(){return TN.BindingScopeEnum}});Object.defineProperty(Be,"BindingTypeEnum",{enumerable:!0,get:function(){return TN.BindingTypeEnum}});Object.defineProperty(Be,"TargetTypeEnum",{enumerable:!0,get:function(){return TN.TargetTypeEnum}});var a2=Uj();Object.defineProperty(Be,"AsyncContainerModule",{enumerable:!0,get:function(){return a2.AsyncContainerModule}});Object.defineProperty(Be,"ContainerModule",{enumerable:!0,get:function(){return a2.ContainerModule}});var fte=Mc();Object.defineProperty(Be,"createTaggedDecorator",{enumerable:!0,get:function(){return fte.createTaggedDecorator}});var hte=Gj();Object.defineProperty(Be,"injectable",{enumerable:!0,get:function(){return hte.injectable}});var gte=zj();Object.defineProperty(Be,"tagged",{enumerable:!0,get:function(){return gte.tagged}});var vte=Qj();Object.defineProperty(Be,"named",{enumerable:!0,get:function(){return vte.named}});var yte=Yj();Object.defineProperty(Be,"inject",{enumerable:!0,get:function(){return yte.inject}});var bte=tN();Object.defineProperty(Be,"LazyServiceIdentifer",{enumerable:!0,get:function(){return bte.LazyServiceIdentifer}});var Ite=Xj();Object.defineProperty(Be,"optional",{enumerable:!0,get:function(){return Ite.optional}});var Ste=Zj();Object.defineProperty(Be,"unmanaged",{enumerable:!0,get:function(){return Ste.unmanaged}});var xte=e2();Object.defineProperty(Be,"multiInject",{enumerable:!0,get:function(){return xte.multiInject}});var Cte=t2();Object.defineProperty(Be,"targetName",{enumerable:!0,get:function(){return Cte.targetName}});var Ete=n2();Object.defineProperty(Be,"postConstruct",{enumerable:!0,get:function(){return Ete.postConstruct}});var wte=o2();Object.defineProperty(Be,"preDestroy",{enumerable:!0,get:function(){return wte.preDestroy}});var kte=ZR();Object.defineProperty(Be,"MetadataReader",{enumerable:!0,get:function(){return kte.MetadataReader}});var Pte=ep();Object.defineProperty(Be,"id",{enumerable:!0,get:function(){return Pte.id}});var Dte=s2();Object.defineProperty(Be,"interfaces",{enumerable:!0,get:function(){return Dte.interfaces}});var Tte=Mc();Object.defineProperty(Be,"decorate",{enumerable:!0,get:function(){return Tte.decorate}});var Pw=bN();Object.defineProperty(Be,"traverseAncerstors",{enumerable:!0,get:function(){return Pw.traverseAncerstors}});Object.defineProperty(Be,"taggedConstraint",{enumerable:!0,get:function(){return Pw.taggedConstraint}});Object.defineProperty(Be,"namedConstraint",{enumerable:!0,get:function(){return Pw.namedConstraint}});Object.defineProperty(Be,"typeConstraint",{enumerable:!0,get:function(){return Pw.typeConstraint}});var _te=yh();Object.defineProperty(Be,"getServiceIdentifierAsString",{enumerable:!0,get:function(){return _te.getServiceIdentifierAsString}});var Rte=dN();Object.defineProperty(Be,"multiBindToService",{enumerable:!0,get:function(){return Rte.multiBindToService}})});var g2=M(ex=>{ex.get=function(r){var e=Error.stackTraceLimit;Error.stackTraceLimit=1/0;var t={},n=Error.prepareStackTrace;Error.prepareStackTrace=function(o,s){return s},Error.captureStackTrace(t,r||ex.get);var i=t.stack;return Error.prepareStackTrace=n,Error.stackTraceLimit=e,i};ex.parse=function(r){if(!r.stack)return[];var e=this,t=r.stack.split(`
`).slice(1);return t.map(function(n){if(n.match(/^\s*[-]{4,}$/))return e._createParsedCallSite({fileName:n,lineNumber:null,functionName:null,typeName:null,methodName:null,columnNumber:null,native:null});var i=n.match(/at (?:(.+)\s+\()?(?:(.+?):(\d+)(?::(\d+))?|([^)]+))\)?/);if(i){var o=null,s=null,a=null,l=null,c=null,u=i[5]==="native";if(i[1]){a=i[1];var d=a.lastIndexOf(".");if(a[d-1]=="."&&d--,d>0){o=a.substr(0,d),s=a.substr(d+1);var f=o.indexOf(".Module");f>0&&(a=a.substr(f+1),o=o.substr(0,f))}l=null}s&&(l=o,c=s),s==="<anonymous>"&&(c=null,a=null);var h={fileName:i[2]||null,lineNumber:parseInt(i[3],10)||null,functionName:a,typeName:l,methodName:c,columnNumber:parseInt(i[4],10)||null,native:u};return e._createParsedCallSite(h)}}).filter(function(n){return!!n})};function ZS(r){for(var e in r)this[e]=r[e]}var Ate=["this","typeName","functionName","methodName","fileName","lineNumber","columnNumber","function","evalOrigin"],Mte=["topLevel","eval","native","constructor"];Ate.forEach(function(r){ZS.prototype[r]=null,ZS.prototype["get"+r[0].toUpperCase()+r.substr(1)]=function(){return this[r]}});Mte.forEach(function(r){ZS.prototype[r]=!1,ZS.prototype["is"+r[0].toUpperCase()+r.substr(1)]=function(){return this[r]}});ex._createParsedCallSite=function(r){return new ZS(r)}});var N2=M((oCe,R2)=>{"use strict";R2.exports=function(e,t){if(t=t.split(":")[0],e=+e,!e)return!1;switch(t){case"http":case"ws":return e!==80;case"https":case"wss":return e!==443;case"ftp":return e!==21;case"gopher":return e!==70;case"file":return!1}return e!==0}});var O2=M(BN=>{"use strict";var Hie=Object.prototype.hasOwnProperty,Gie;function A2(r){try{return decodeURIComponent(r.replace(/\+/g," "))}catch{return null}}function M2(r){try{return encodeURIComponent(r)}catch{return null}}function zie(r){for(var e=/([^=?#&]+)=?([^&]*)/g,t={},n;n=e.exec(r);){var i=A2(n[1]),o=A2(n[2]);i===null||o===null||i in t||(t[i]=o)}return t}function Qie(r,e){e=e||"";var t=[],n,i;typeof e!="string"&&(e="?");for(i in r)if(Hie.call(r,i)){if(n=r[i],!n&&(n===null||n===Gie||isNaN(n))&&(n=""),i=M2(i),n=M2(n),i===null||n===null)continue;t.push(i+"="+n)}return t.length?e+t.join("&"):""}BN.stringify=Qie;BN.parse=zie});var B2=M((aCe,V2)=>{"use strict";var F2=N2(),Hw=O2(),Yie=/^[\x00-\x20\u00a0\u1680\u2000-\u200a\u2028\u2029\u202f\u205f\u3000\ufeff]+/,L2=/[\n\r\t]/g,Xie=/^[A-Za-z][A-Za-z0-9+-.]*:\/\//,U2=/:\d+$/,Zie=/^([a-z][a-z0-9.+-]*:)?(\/\/)?([\\/]+)?([\S\s]*)/i,eoe=/^[a-zA-Z]:/;function JN(r){return(r||"").toString().replace(Yie,"")}var qN=[["#","hash"],["?","query"],function(e,t){return wl(t.protocol)?e.replace(/\\/g,"/"):e},["/","pathname"],["@","auth",1],[NaN,"host",void 0,1,1],[/:(\d*)$/,"port",void 0,1],[NaN,"hostname",void 0,1,1]],K2={hash:1,query:1};function W2(r){var e;typeof window<"u"?e=window:typeof global<"u"?e=global:typeof self<"u"?e=self:e={};var t=e.location||{};r=r||t;var n={},i=typeof r,o;if(r.protocol==="blob:")n=new kl(unescape(r.pathname),{});else if(i==="string"){n=new kl(r,{});for(o in K2)delete n[o]}else if(i==="object"){for(o in r)o in K2||(n[o]=r[o]);n.slashes===void 0&&(n.slashes=Xie.test(r.href))}return n}function wl(r){return r==="file:"||r==="ftp:"||r==="http:"||r==="https:"||r==="ws:"||r==="wss:"}function j2(r,e){r=JN(r),r=r.replace(L2,""),e=e||{};var t=Zie.exec(r),n=t[1]?t[1].toLowerCase():"",i=!!t[2],o=!!t[3],s=0,a;return i?o?(a=t[2]+t[3]+t[4],s=t[2].length+t[3].length):(a=t[2]+t[4],s=t[2].length):o?(a=t[3]+t[4],s=t[3].length):a=t[4],n==="file:"?s>=2&&(a=a.slice(2)):wl(n)?a=t[4]:n?i&&(a=a.slice(2)):s>=2&&wl(e.protocol)&&(a=t[4]),{protocol:n,slashes:i||wl(n),slashesCount:s,rest:a}}function toe(r,e){if(r==="")return e;for(var t=(e||"/").split("/").slice(0,-1).concat(r.split("/")),n=t.length,i=t[n-1],o=!1,s=0;n--;)t[n]==="."?t.splice(n,1):t[n]===".."?(t.splice(n,1),s++):s&&(n===0&&(o=!0),t.splice(n,1),s--);return o&&t.unshift(""),(i==="."||i==="..")&&t.push(""),t.join("/")}function kl(r,e,t){if(r=JN(r),r=r.replace(L2,""),!(this instanceof kl))return new kl(r,e,t);var n,i,o,s,a,l,c=qN.slice(),u=typeof e,d=this,f=0;for(u!=="object"&&u!=="string"&&(t=e,e=null),t&&typeof t!="function"&&(t=Hw.parse),e=W2(e),i=j2(r||"",e),n=!i.protocol&&!i.slashes,d.slashes=i.slashes||n&&e.slashes,d.protocol=i.protocol||e.protocol||"",r=i.rest,(i.protocol==="file:"&&(i.slashesCount!==2||eoe.test(r))||!i.slashes&&(i.protocol||i.slashesCount<2||!wl(d.protocol)))&&(c[3]=[/(.*)/,"pathname"]);f<c.length;f++){if(s=c[f],typeof s=="function"){r=s(r,d);continue}o=s[0],l=s[1],o!==o?d[l]=r:typeof o=="string"?(a=o==="@"?r.lastIndexOf(o):r.indexOf(o),~a&&(typeof s[2]=="number"?(d[l]=r.slice(0,a),r=r.slice(a+s[2])):(d[l]=r.slice(a),r=r.slice(0,a)))):(a=o.exec(r))&&(d[l]=a[1],r=r.slice(0,a.index)),d[l]=d[l]||n&&s[3]&&e[l]||"",s[4]&&(d[l]=d[l].toLowerCase())}t&&(d.query=t(d.query)),n&&e.slashes&&d.pathname.charAt(0)!=="/"&&(d.pathname!==""||e.pathname!=="")&&(d.pathname=toe(d.pathname,e.pathname)),d.pathname.charAt(0)!=="/"&&wl(d.protocol)&&(d.pathname="/"+d.pathname),F2(d.port,d.protocol)||(d.host=d.hostname,d.port=""),d.username=d.password="",d.auth&&(a=d.auth.indexOf(":"),~a?(d.username=d.auth.slice(0,a),d.username=encodeURIComponent(decodeURIComponent(d.username)),d.password=d.auth.slice(a+1),d.password=encodeURIComponent(decodeURIComponent(d.password))):d.username=encodeURIComponent(decodeURIComponent(d.auth)),d.auth=d.password?d.username+":"+d.password:d.username),d.origin=d.protocol!=="file:"&&wl(d.protocol)&&d.host?d.protocol+"//"+d.host:"null",d.href=d.toString()}function roe(r,e,t){var n=this;switch(r){case"query":typeof e=="string"&&e.length&&(e=(t||Hw.parse)(e)),n[r]=e;break;case"port":n[r]=e,F2(e,n.protocol)?e&&(n.host=n.hostname+":"+e):(n.host=n.hostname,n[r]="");break;case"hostname":n[r]=e,n.port&&(e+=":"+n.port),n.host=e;break;case"host":n[r]=e,U2.test(e)?(e=e.split(":"),n.port=e.pop(),n.hostname=e.join(":")):(n.hostname=e,n.port="");break;case"protocol":n.protocol=e.toLowerCase(),n.slashes=!t;break;case"pathname":case"hash":if(e){var i=r==="pathname"?"/":"#";n[r]=e.charAt(0)!==i?i+e:e}else n[r]=e;break;case"username":case"password":n[r]=encodeURIComponent(e);break;case"auth":var o=e.indexOf(":");~o?(n.username=e.slice(0,o),n.username=encodeURIComponent(decodeURIComponent(n.username)),n.password=e.slice(o+1),n.password=encodeURIComponent(decodeURIComponent(n.password))):n.username=encodeURIComponent(decodeURIComponent(e))}for(var s=0;s<qN.length;s++){var a=qN[s];a[4]&&(n[a[1]]=n[a[1]].toLowerCase())}return n.auth=n.password?n.username+":"+n.password:n.username,n.origin=n.protocol!=="file:"&&wl(n.protocol)&&n.host?n.protocol+"//"+n.host:"null",n.href=n.toString(),n}function noe(r){(!r||typeof r!="function")&&(r=Hw.stringify);var e,t=this,n=t.host,i=t.protocol;i&&i.charAt(i.length-1)!==":"&&(i+=":");var o=i+(t.protocol&&t.slashes||wl(t.protocol)?"//":"");return t.username?(o+=t.username,t.password&&(o+=":"+t.password),o+="@"):t.password?(o+=":"+t.password,o+="@"):t.protocol!=="file:"&&wl(t.protocol)&&!n&&t.pathname!=="/"&&(o+="@"),(n[n.length-1]===":"||U2.test(t.hostname)&&!t.port)&&(n+=":"),o+=n+t.pathname,e=typeof t.query=="object"?r(t.query):t.query,e&&(o+=e.charAt(0)!=="?"?"?"+e:e),t.hash&&(o+=t.hash),o}kl.prototype={set:roe,toString:noe};kl.extractProtocol=j2;kl.location=W2;kl.trimLeft=JN;kl.qs=Hw;V2.exports=kl});var Hh=M((Tt,sV)=>{Tt=sV.exports=Zt;var _r;typeof process=="object"&&process.env&&process.env.NODE_DEBUG&&/\bsemver\b/i.test(process.env.NODE_DEBUG)?_r=function(){var r=Array.prototype.slice.call(arguments,0);r.unshift("SEMVER"),console.log.apply(console,r)}:_r=function(){};Tt.SEMVER_SPEC_VERSION="2.0.0";var ix=256,Qw=Number.MAX_SAFE_INTEGER||9007199254740991,$N=16,ioe=ix-6,ox=Tt.re=[],Jr=Tt.safeRe=[],ge=Tt.src=[],Ht=0,YN="[a-zA-Z0-9-]",HN=[["\\s",1],["\\d",ix],[YN,ioe]];function rk(r){for(var e=0;e<HN.length;e++){var t=HN[e][0],n=HN[e][1];r=r.split(t+"*").join(t+"{0,"+n+"}").split(t+"+").join(t+"{1,"+n+"}")}return r}var Wh=Ht++;ge[Wh]="0|[1-9]\\d*";var jh=Ht++;ge[jh]="\\d+";var XN=Ht++;ge[XN]="\\d*[a-zA-Z-]"+YN+"*";var $2=Ht++;ge[$2]="("+ge[Wh]+")\\.("+ge[Wh]+")\\.("+ge[Wh]+")";var H2=Ht++;ge[H2]="("+ge[jh]+")\\.("+ge[jh]+")\\.("+ge[jh]+")";var GN=Ht++;ge[GN]="(?:"+ge[Wh]+"|"+ge[XN]+")";var zN=Ht++;ge[zN]="(?:"+ge[jh]+"|"+ge[XN]+")";var ZN=Ht++;ge[ZN]="(?:-("+ge[GN]+"(?:\\."+ge[GN]+")*))";var eA=Ht++;ge[eA]="(?:-?("+ge[zN]+"(?:\\."+ge[zN]+")*))";var QN=Ht++;ge[QN]=YN+"+";var ax=Ht++;ge[ax]="(?:\\+("+ge[QN]+"(?:\\."+ge[QN]+")*))";var tA=Ht++,G2="v?"+ge[$2]+ge[ZN]+"?"+ge[ax]+"?";ge[tA]="^"+G2+"$";var rA="[v=\\s]*"+ge[H2]+ge[eA]+"?"+ge[ax]+"?",nA=Ht++;ge[nA]="^"+rA+"$";var $h=Ht++;ge[$h]="((?:<|>)?=?)";var Yw=Ht++;ge[Yw]=ge[jh]+"|x|X|\\*";var Xw=Ht++;ge[Xw]=ge[Wh]+"|x|X|\\*";var im=Ht++;ge[im]="[v=\\s]*("+ge[Xw]+")(?:\\.("+ge[Xw]+")(?:\\.("+ge[Xw]+")(?:"+ge[ZN]+")?"+ge[ax]+"?)?)?";var Bh=Ht++;ge[Bh]="[v=\\s]*("+ge[Yw]+")(?:\\.("+ge[Yw]+")(?:\\.("+ge[Yw]+")(?:"+ge[eA]+")?"+ge[ax]+"?)?)?";var z2=Ht++;ge[z2]="^"+ge[$h]+"\\s*"+ge[im]+"$";var Q2=Ht++;ge[Q2]="^"+ge[$h]+"\\s*"+ge[Bh]+"$";var Y2=Ht++;ge[Y2]="(?:^|[^\\d])(\\d{1,"+$N+"})(?:\\.(\\d{1,"+$N+"}))?(?:\\.(\\d{1,"+$N+"}))?(?:$|[^\\d])";var nk=Ht++;ge[nk]="(?:~>?)";var qh=Ht++;ge[qh]="(\\s*)"+ge[nk]+"\\s+";ox[qh]=new RegExp(ge[qh],"g");Jr[qh]=new RegExp(rk(ge[qh]),"g");var ooe="$1~",X2=Ht++;ge[X2]="^"+ge[nk]+ge[im]+"$";var Z2=Ht++;ge[Z2]="^"+ge[nk]+ge[Bh]+"$";var ik=Ht++;ge[ik]="(?:\\^)";var Jh=Ht++;ge[Jh]="(\\s*)"+ge[ik]+"\\s+";ox[Jh]=new RegExp(ge[Jh],"g");Jr[Jh]=new RegExp(rk(ge[Jh]),"g");var soe="$1^",eV=Ht++;ge[eV]="^"+ge[ik]+ge[im]+"$";var tV=Ht++;ge[tV]="^"+ge[ik]+ge[Bh]+"$";var iA=Ht++;ge[iA]="^"+ge[$h]+"\\s*("+rA+")$|^$";var oA=Ht++;ge[oA]="^"+ge[$h]+"\\s*("+G2+")$|^$";var om=Ht++;ge[om]="(\\s*)"+ge[$h]+"\\s*("+rA+"|"+ge[im]+")";ox[om]=new RegExp(ge[om],"g");Jr[om]=new RegExp(rk(ge[om]),"g");var aoe="$1$2$3",rV=Ht++;ge[rV]="^\\s*("+ge[im]+")\\s+-\\s+("+ge[im]+")\\s*$";var nV=Ht++;ge[nV]="^\\s*("+ge[Bh]+")\\s+-\\s+("+ge[Bh]+")\\s*$";var iV=Ht++;ge[iV]="(<|>)?=?\\s*\\*";for(Tl=0;Tl<Ht;Tl++)_r(Tl,ge[Tl]),ox[Tl]||(ox[Tl]=new RegExp(ge[Tl]),Jr[Tl]=new RegExp(rk(ge[Tl])));var Tl;Tt.parse=sm;function sm(r,e){if((!e||typeof e!="object")&&(e={loose:!!e,includePrerelease:!1}),r instanceof Zt)return r;if(typeof r!="string"||r.length>ix)return null;var t=e.loose?Jr[nA]:Jr[tA];if(!t.test(r))return null;try{return new Zt(r,e)}catch{return null}}Tt.valid=loe;function loe(r,e){var t=sm(r,e);return t?t.version:null}Tt.clean=coe;function coe(r,e){var t=sm(r.trim().replace(/^[=v]+/,""),e);return t?t.version:null}Tt.SemVer=Zt;function Zt(r,e){if((!e||typeof e!="object")&&(e={loose:!!e,includePrerelease:!1}),r instanceof Zt){if(r.loose===e.loose)return r;r=r.version}else if(typeof r!="string")throw new TypeError("Invalid Version: "+r);if(r.length>ix)throw new TypeError("version is longer than "+ix+" characters");if(!(this instanceof Zt))return new Zt(r,e);_r("SemVer",r,e),this.options=e,this.loose=!!e.loose;var t=r.trim().match(e.loose?Jr[nA]:Jr[tA]);if(!t)throw new TypeError("Invalid Version: "+r);if(this.raw=r,this.major=+t[1],this.minor=+t[2],this.patch=+t[3],this.major>Qw||this.major<0)throw new TypeError("Invalid major version");if(this.minor>Qw||this.minor<0)throw new TypeError("Invalid minor version");if(this.patch>Qw||this.patch<0)throw new TypeError("Invalid patch version");t[4]?this.prerelease=t[4].split(".").map(function(n){if(/^[0-9]+$/.test(n)){var i=+n;if(i>=0&&i<Qw)return i}return n}):this.prerelease=[],this.build=t[5]?t[5].split("."):[],this.format()}Zt.prototype.format=function(){return this.version=this.major+"."+this.minor+"."+this.patch,this.prerelease.length&&(this.version+="-"+this.prerelease.join(".")),this.version};Zt.prototype.toString=function(){return this.version};Zt.prototype.compare=function(r){return _r("SemVer.compare",this.version,this.options,r),r instanceof Zt||(r=new Zt(r,this.options)),this.compareMain(r)||this.comparePre(r)};Zt.prototype.compareMain=function(r){return r instanceof Zt||(r=new Zt(r,this.options)),Vh(this.major,r.major)||Vh(this.minor,r.minor)||Vh(this.patch,r.patch)};Zt.prototype.comparePre=function(r){if(r instanceof Zt||(r=new Zt(r,this.options)),this.prerelease.length&&!r.prerelease.length)return-1;if(!this.prerelease.length&&r.prerelease.length)return 1;if(!this.prerelease.length&&!r.prerelease.length)return 0;var e=0;do{var t=this.prerelease[e],n=r.prerelease[e];if(_r("prerelease compare",e,t,n),t===void 0&&n===void 0)return 0;if(n===void 0)return 1;if(t===void 0)return-1;if(t===n)continue;return Vh(t,n)}while(++e)};Zt.prototype.inc=function(r,e){switch(r){case"premajor":this.prerelease.length=0,this.patch=0,this.minor=0,this.major++,this.inc("pre",e);break;case"preminor":this.prerelease.length=0,this.patch=0,this.minor++,this.inc("pre",e);break;case"prepatch":this.prerelease.length=0,this.inc("patch",e),this.inc("pre",e);break;case"prerelease":this.prerelease.length===0&&this.inc("patch",e),this.inc("pre",e);break;case"major":(this.minor!==0||this.patch!==0||this.prerelease.length===0)&&this.major++,this.minor=0,this.patch=0,this.prerelease=[];break;case"minor":(this.patch!==0||this.prerelease.length===0)&&this.minor++,this.patch=0,this.prerelease=[];break;case"patch":this.prerelease.length===0&&this.patch++,this.prerelease=[];break;case"pre":if(this.prerelease.length===0)this.prerelease=[0];else{for(var t=this.prerelease.length;--t>=0;)typeof this.prerelease[t]=="number"&&(this.prerelease[t]++,t=-2);t===-1&&this.prerelease.push(0)}e&&(this.prerelease[0]===e?isNaN(this.prerelease[1])&&(this.prerelease=[e,0]):this.prerelease=[e,0]);break;default:throw new Error("invalid increment argument: "+r)}return this.format(),this.raw=this.version,this};Tt.inc=uoe;function uoe(r,e,t,n){typeof t=="string"&&(n=t,t=void 0);try{return new Zt(r,t).inc(e,n).version}catch{return null}}Tt.diff=poe;function poe(r,e){if(sA(r,e))return null;var t=sm(r),n=sm(e),i="";if(t.prerelease.length||n.prerelease.length){i="pre";var o="prerelease"}for(var s in t)if((s==="major"||s==="minor"||s==="patch")&&t[s]!==n[s])return i+s;return o}Tt.compareIdentifiers=Vh;var J2=/^[0-9]+$/;function Vh(r,e){var t=J2.test(r),n=J2.test(e);return t&&n&&(r=+r,e=+e),r===e?0:t&&!n?-1:n&&!t?1:r<e?-1:1}Tt.rcompareIdentifiers=doe;function doe(r,e){return Vh(e,r)}Tt.major=moe;function moe(r,e){return new Zt(r,e).major}Tt.minor=foe;function foe(r,e){return new Zt(r,e).minor}Tt.patch=hoe;function hoe(r,e){return new Zt(r,e).patch}Tt.compare=Fc;function Fc(r,e,t){return new Zt(r,t).compare(new Zt(e,t))}Tt.compareLoose=goe;function goe(r,e){return Fc(r,e,!0)}Tt.rcompare=voe;function voe(r,e,t){return Fc(e,r,t)}Tt.sort=yoe;function yoe(r,e){return r.sort(function(t,n){return Tt.compare(t,n,e)})}Tt.rsort=boe;function boe(r,e){return r.sort(function(t,n){return Tt.rcompare(t,n,e)})}Tt.gt=sx;function sx(r,e,t){return Fc(r,e,t)>0}Tt.lt=Zw;function Zw(r,e,t){return Fc(r,e,t)<0}Tt.eq=sA;function sA(r,e,t){return Fc(r,e,t)===0}Tt.neq=oV;function oV(r,e,t){return Fc(r,e,t)!==0}Tt.gte=aA;function aA(r,e,t){return Fc(r,e,t)>=0}Tt.lte=lA;function lA(r,e,t){return Fc(r,e,t)<=0}Tt.cmp=ek;function ek(r,e,t,n){switch(e){case"===":return typeof r=="object"&&(r=r.version),typeof t=="object"&&(t=t.version),r===t;case"!==":return typeof r=="object"&&(r=r.version),typeof t=="object"&&(t=t.version),r!==t;case"":case"=":case"==":return sA(r,t,n);case"!=":return oV(r,t,n);case">":return sx(r,t,n);case">=":return aA(r,t,n);case"<":return Zw(r,t,n);case"<=":return lA(r,t,n);default:throw new TypeError("Invalid operator: "+e)}}Tt.Comparator=Ds;function Ds(r,e){if((!e||typeof e!="object")&&(e={loose:!!e,includePrerelease:!1}),r instanceof Ds){if(r.loose===!!e.loose)return r;r=r.value}if(!(this instanceof Ds))return new Ds(r,e);r=r.trim().split(/\s+/).join(" "),_r("comparator",r,e),this.options=e,this.loose=!!e.loose,this.parse(r),this.semver===lx?this.value="":this.value=this.operator+this.semver.version,_r("comp",this)}var lx={};Ds.prototype.parse=function(r){var e=this.options.loose?Jr[iA]:Jr[oA],t=r.match(e);if(!t)throw new TypeError("Invalid comparator: "+r);this.operator=t[1],this.operator==="="&&(this.operator=""),t[2]?this.semver=new Zt(t[2],this.options.loose):this.semver=lx};Ds.prototype.toString=function(){return this.value};Ds.prototype.test=function(r){return _r("Comparator.test",r,this.options.loose),this.semver===lx?!0:(typeof r=="string"&&(r=new Zt(r,this.options)),ek(r,this.operator,this.semver,this.options))};Ds.prototype.intersects=function(r,e){if(!(r instanceof Ds))throw new TypeError("a Comparator is required");(!e||typeof e!="object")&&(e={loose:!!e,includePrerelease:!1});var t;if(this.operator==="")return t=new gn(r.value,e),tk(this.value,t,e);if(r.operator==="")return t=new gn(this.value,e),tk(r.semver,t,e);var n=(this.operator===">="||this.operator===">")&&(r.operator===">="||r.operator===">"),i=(this.operator==="<="||this.operator==="<")&&(r.operator==="<="||r.operator==="<"),o=this.semver.version===r.semver.version,s=(this.operator===">="||this.operator==="<=")&&(r.operator===">="||r.operator==="<="),a=ek(this.semver,"<",r.semver,e)&&(this.operator===">="||this.operator===">")&&(r.operator==="<="||r.operator==="<"),l=ek(this.semver,">",r.semver,e)&&(this.operator==="<="||this.operator==="<")&&(r.operator===">="||r.operator===">");return n||i||o&&s||a||l};Tt.Range=gn;function gn(r,e){if((!e||typeof e!="object")&&(e={loose:!!e,includePrerelease:!1}),r instanceof gn)return r.loose===!!e.loose&&r.includePrerelease===!!e.includePrerelease?r:new gn(r.raw,e);if(r instanceof Ds)return new gn(r.value,e);if(!(this instanceof gn))return new gn(r,e);if(this.options=e,this.loose=!!e.loose,this.includePrerelease=!!e.includePrerelease,this.raw=r.trim().split(/\s+/).join(" "),this.set=this.raw.split("||").map(function(t){return this.parseRange(t.trim())},this).filter(function(t){return t.length}),!this.set.length)throw new TypeError("Invalid SemVer Range: "+this.raw);this.format()}gn.prototype.format=function(){return this.range=this.set.map(function(r){return r.join(" ").trim()}).join("||").trim(),this.range};gn.prototype.toString=function(){return this.range};gn.prototype.parseRange=function(r){var e=this.options.loose,t=e?Jr[nV]:Jr[rV];r=r.replace(t,Toe),_r("hyphen replace",r),r=r.replace(Jr[om],aoe),_r("comparator trim",r,Jr[om]),r=r.replace(Jr[qh],ooe),r=r.replace(Jr[Jh],soe);var n=e?Jr[iA]:Jr[oA],i=r.split(" ").map(function(o){return Soe(o,this.options)},this).join(" ").split(/\s+/);return this.options.loose&&(i=i.filter(function(o){return!!o.match(n)})),i=i.map(function(o){return new Ds(o,this.options)},this),i};gn.prototype.intersects=function(r,e){if(!(r instanceof gn))throw new TypeError("a Range is required");return this.set.some(function(t){return t.every(function(n){return r.set.some(function(i){return i.every(function(o){return n.intersects(o,e)})})})})};Tt.toComparators=Ioe;function Ioe(r,e){return new gn(r,e).set.map(function(t){return t.map(function(n){return n.value}).join(" ").trim().split(" ")})}function Soe(r,e){return _r("comp",r,e),r=Eoe(r,e),_r("caret",r),r=xoe(r,e),_r("tildes",r),r=koe(r,e),_r("xrange",r),r=Doe(r,e),_r("stars",r),r}function no(r){return!r||r.toLowerCase()==="x"||r==="*"}function xoe(r,e){return r.trim().split(/\s+/).map(function(t){return Coe(t,e)}).join(" ")}function Coe(r,e){var t=e.loose?Jr[Z2]:Jr[X2];return r.replace(t,function(n,i,o,s,a){_r("tilde",r,n,i,o,s,a);var l;return no(i)?l="":no(o)?l=">="+i+".0.0 <"+(+i+1)+".0.0":no(s)?l=">="+i+"."+o+".0 <"+i+"."+(+o+1)+".0":a?(_r("replaceTilde pr",a),l=">="+i+"."+o+"."+s+"-"+a+" <"+i+"."+(+o+1)+".0"):l=">="+i+"."+o+"."+s+" <"+i+"."+(+o+1)+".0",_r("tilde return",l),l})}function Eoe(r,e){return r.trim().split(/\s+/).map(function(t){return woe(t,e)}).join(" ")}function woe(r,e){_r("caret",r,e);var t=e.loose?Jr[tV]:Jr[eV];return r.replace(t,function(n,i,o,s,a){_r("caret",r,n,i,o,s,a);var l;return no(i)?l="":no(o)?l=">="+i+".0.0 <"+(+i+1)+".0.0":no(s)?i==="0"?l=">="+i+"."+o+".0 <"+i+"."+(+o+1)+".0":l=">="+i+"."+o+".0 <"+(+i+1)+".0.0":a?(_r("replaceCaret pr",a),i==="0"?o==="0"?l=">="+i+"."+o+"."+s+"-"+a+" <"+i+"."+o+"."+(+s+1):l=">="+i+"."+o+"."+s+"-"+a+" <"+i+"."+(+o+1)+".0":l=">="+i+"."+o+"."+s+"-"+a+" <"+(+i+1)+".0.0"):(_r("no pr"),i==="0"?o==="0"?l=">="+i+"."+o+"."+s+" <"+i+"."+o+"."+(+s+1):l=">="+i+"."+o+"."+s+" <"+i+"."+(+o+1)+".0":l=">="+i+"."+o+"."+s+" <"+(+i+1)+".0.0"),_r("caret return",l),l})}function koe(r,e){return _r("replaceXRanges",r,e),r.split(/\s+/).map(function(t){return Poe(t,e)}).join(" ")}function Poe(r,e){r=r.trim();var t=e.loose?Jr[Q2]:Jr[z2];return r.replace(t,function(n,i,o,s,a,l){_r("xRange",r,n,i,o,s,a,l);var c=no(o),u=c||no(s),d=u||no(a),f=d;return i==="="&&f&&(i=""),c?i===">"||i==="<"?n="<0.0.0":n="*":i&&f?(u&&(s=0),a=0,i===">"?(i=">=",u?(o=+o+1,s=0,a=0):(s=+s+1,a=0)):i==="<="&&(i="<",u?o=+o+1:s=+s+1),n=i+o+"."+s+"."+a):u?n=">="+o+".0.0 <"+(+o+1)+".0.0":d&&(n=">="+o+"."+s+".0 <"+o+"."+(+s+1)+".0"),_r("xRange return",n),n})}function Doe(r,e){return _r("replaceStars",r,e),r.trim().replace(Jr[iV],"")}function Toe(r,e,t,n,i,o,s,a,l,c,u,d,f){return no(t)?e="":no(n)?e=">="+t+".0.0":no(i)?e=">="+t+"."+n+".0":e=">="+e,no(l)?a="":no(c)?a="<"+(+l+1)+".0.0":no(u)?a="<"+l+"."+(+c+1)+".0":d?a="<="+l+"."+c+"."+u+"-"+d:a="<="+a,(e+" "+a).trim()}gn.prototype.test=function(r){if(!r)return!1;typeof r=="string"&&(r=new Zt(r,this.options));for(var e=0;e<this.set.length;e++)if(_oe(this.set[e],r,this.options))return!0;return!1};function _oe(r,e,t){for(var n=0;n<r.length;n++)if(!r[n].test(e))return!1;if(e.prerelease.length&&!t.includePrerelease){for(n=0;n<r.length;n++)if(_r(r[n].semver),r[n].semver!==lx&&r[n].semver.prerelease.length>0){var i=r[n].semver;if(i.major===e.major&&i.minor===e.minor&&i.patch===e.patch)return!0}return!1}return!0}Tt.satisfies=tk;function tk(r,e,t){try{e=new gn(e,t)}catch{return!1}return e.test(r)}Tt.maxSatisfying=Roe;function Roe(r,e,t){var n=null,i=null;try{var o=new gn(e,t)}catch{return null}return r.forEach(function(s){o.test(s)&&(!n||i.compare(s)===-1)&&(n=s,i=new Zt(n,t))}),n}Tt.minSatisfying=Noe;function Noe(r,e,t){var n=null,i=null;try{var o=new gn(e,t)}catch{return null}return r.forEach(function(s){o.test(s)&&(!n||i.compare(s)===1)&&(n=s,i=new Zt(n,t))}),n}Tt.minVersion=Aoe;function Aoe(r,e){r=new gn(r,e);var t=new Zt("0.0.0");if(r.test(t)||(t=new Zt("0.0.0-0"),r.test(t)))return t;t=null;for(var n=0;n<r.set.length;++n){var i=r.set[n];i.forEach(function(o){var s=new Zt(o.semver.version);switch(o.operator){case">":s.prerelease.length===0?s.patch++:s.prerelease.push(0),s.raw=s.format();case"":case">=":(!t||sx(t,s))&&(t=s);break;case"<":case"<=":break;default:throw new Error("Unexpected operation: "+o.operator)}})}return t&&r.test(t)?t:null}Tt.validRange=Moe;function Moe(r,e){try{return new gn(r,e).range||"*"}catch{return null}}Tt.ltr=Ooe;function Ooe(r,e,t){return cA(r,e,"<",t)}Tt.gtr=Koe;function Koe(r,e,t){return cA(r,e,">",t)}Tt.outside=cA;function cA(r,e,t,n){r=new Zt(r,n),e=new gn(e,n);var i,o,s,a,l;switch(t){case">":i=sx,o=lA,s=Zw,a=">",l=">=";break;case"<":i=Zw,o=aA,s=sx,a="<",l="<=";break;default:throw new TypeError('Must provide a hilo val of "<" or ">"')}if(tk(r,e,n))return!1;for(var c=0;c<e.set.length;++c){var u=e.set[c],d=null,f=null;if(u.forEach(function(h){h.semver===lx&&(h=new Ds(">=0.0.0")),d=d||h,f=f||h,i(h.semver,d.semver,n)?d=h:s(h.semver,f.semver,n)&&(f=h)}),d.operator===a||d.operator===l||(!f.operator||f.operator===a)&&o(r,f.semver))return!1;if(f.operator===l&&s(r,f.semver))return!1}return!0}Tt.prerelease=Foe;function Foe(r,e){var t=sm(r,e);return t&&t.prerelease.length?t.prerelease:null}Tt.intersects=Loe;function Loe(r,e,t){return r=new gn(r,t),e=new gn(e,t),r.intersects(e)}Tt.coerce=Uoe;function Uoe(r){if(r instanceof Zt)return r;if(typeof r!="string")return null;var e=r.match(Jr[Y2]);return e==null?null:sm(e[1]+"."+(e[2]||"0")+"."+(e[3]||"0"))}});var uA=M((QCe,uV)=>{"use strict";var lV=Array.isArray,cV=Object.keys,Voe=Object.prototype.hasOwnProperty;uV.exports=function r(e,t){if(e===t)return!0;if(e&&t&&typeof e=="object"&&typeof t=="object"){var n=lV(e),i=lV(t),o,s,a;if(n&&i){if(s=e.length,s!=t.length)return!1;for(o=s;o--!==0;)if(!r(e[o],t[o]))return!1;return!0}if(n!=i)return!1;var l=e instanceof Date,c=t instanceof Date;if(l!=c)return!1;if(l&&c)return e.getTime()==t.getTime();var u=e instanceof RegExp,d=t instanceof RegExp;if(u!=d)return!1;if(u&&d)return e.toString()==t.toString();var f=cV(e);if(s=f.length,s!==cV(t).length)return!1;for(o=s;o--!==0;)if(!Voe.call(t,f[o]))return!1;for(o=s;o--!==0;)if(a=f[o],!r(e[a],t[a]))return!1;return!0}return e!==e&&t!==t}});var RV=M(Nl=>{"use strict";Object.defineProperty(Nl,"__esModule",{value:!0});Nl.EventEmitter=Nl.once=Nl.toPromise=void 0;function dse(r,e){return e?e.aborted?Promise.resolve(void 0):new Promise(t=>{let n=(0,Nl.once)(r,o=>{e.removeEventListener("abort",i),t(o)}),i=()=>{n.dispose(),e.removeEventListener("abort",i),t(void 0)};e.addEventListener("abort",i)}):new Promise(t=>(0,Nl.once)(r,t))}Nl.toPromise=dse;var mse=(r,e)=>{let t=r(n=>{e(n),t.dispose()});return t};Nl.once=mse;var vA=class{constructor(){this.event=(e,t,n)=>{let i=this.add(t?e.bind(t):e);return n?.push(i),i}}get size(){return this.listeners?typeof this.listeners=="function"?1:this.listeners.length:0}fire(e){if(this.listeners)if(typeof this.listeners=="function")this.listeners(e);else for(let t of this.listeners)t(e)}dispose(){this.listeners=void 0}add(e){return this.listeners?typeof this.listeners=="function"?this.listeners=[this.listeners,e]:this.listeners.push(e):this.listeners=e,{dispose:()=>this.rm(e)}}rm(e){if(!this.listeners)return;if(typeof this.listeners=="function"){this.listeners===e&&(this.listeners=void 0);return}let t=this.listeners.indexOf(e);t!==-1&&(this.listeners.length===2?this.listeners=t===0?this.listeners[1]:this.listeners[0]:this.listeners=this.listeners.slice(0,t).concat(this.listeners.slice(t+1)))}};Nl.EventEmitter=vA});var NA=M(xp=>{"use strict";Object.defineProperty(xp,"__esModule",{value:!0});xp.TargetPopulation=xp.Filters=xp.VSCodeFilterProvider=void 0;var Lk=require("vscode"),RA=class r{constructor(e,t,n){this.extensionName=e,this.extensionVersion=t,this.targetPopulation=n}static trimVersionSuffix(e){let t=/\-[a-zA-Z0-9]+$/;return e.split(t)[0]}getFilterValue(e){switch(e){case Wl.ApplicationVersion:return r.trimVersionSuffix(Lk.version);case Wl.Build:return Lk.env.appName;case Wl.ClientId:return Lk.env.machineId;case Wl.ExtensionName:return this.extensionName;case Wl.ExtensionVersion:return r.trimVersionSuffix(this.extensionVersion);case Wl.Language:return Lk.env.language;case Wl.TargetPopulation:return this.targetPopulation;default:return""}}getFilters(){let e=new Map,t=Object.values(Wl);for(let n of t)e.set(n,this.getFilterValue(n));return e}};xp.VSCodeFilterProvider=RA;var Wl;(function(r){r.Market="X-MSEdge-Market",r.CorpNet="X-FD-Corpnet",r.ApplicationVersion="X-VSCode-AppVersion",r.Build="X-VSCode-Build",r.ClientId="X-MSEdge-ClientId",r.ExtensionName="X-VSCode-ExtensionName",r.ExtensionVersion="X-VSCode-ExtensionVersion",r.Language="X-VSCode-Language",r.TargetPopulation="X-VSCode-TargetPopulation"})(Wl||(xp.Filters=Wl={}));var m9;(function(r){r.Team="team",r.Internal="internal",r.Insiders="insider",r.Public="public"})(m9||(xp.TargetPopulation=m9={}))});var f9=M(Uk=>{"use strict";Object.defineProperty(Uk,"__esModule",{value:!0});Uk.BaseFeatureProvider=void 0;var AA=class{constructor(e){this.telemetry=e,this.isFetching=!1}async getFeatures(){if(this.isFetching&&this.fetchPromise)return this.fetchPromise;this.fetchPromise=this.fetch();let e=await this.fetchPromise;return this.isFetching=!1,this.fetchPromise=void 0,e}};Uk.BaseFeatureProvider=AA});var h9=M(Wk=>{"use strict";Object.defineProperty(Wk,"__esModule",{value:!0});Wk.FilteredFeatureProvider=void 0;var Ise=f9(),MA=class extends Ise.BaseFeatureProvider{constructor(e,t){super(e),this.telemetry=e,this.filterProviders=t,this.cachedTelemetryEvents=[]}getFilters(){let e=new Map;for(let t of this.filterProviders){let n=t.getFilters();for(let i of n.keys()){let o=n.get(i);e.set(i,o)}}return e}PostEventToTelemetry(e){if(this.cachedTelemetryEvents.includes(e))return;let t=JSON.stringify(e);this.telemetry.postEvent("report-headers",new Map([["ABExp.headers",t]])),this.cachedTelemetryEvents.push(e)}};Wk.FilteredFeatureProvider=MA});var g9=M(Cp=>{"use strict";Object.defineProperty(Cp,"__esModule",{value:!0});Cp.TasApiFeatureProvider=Cp.TASAPI_FETCHERROR_EVENTNAME=void 0;var Sse=h9();Cp.TASAPI_FETCHERROR_EVENTNAME="call-tas-error";var OA="ErrorType",KA=class extends Sse.FilteredFeatureProvider{constructor(e,t,n){super(t,n),this.httpClient=e,this.telemetry=t,this.filterProviders=n}async fetch(){let e=this.getFilters(),t={};for(let a of e.keys()){let l=e.get(a);t[a]=l}let n;try{n=await this.httpClient.get({headers:t})}catch(a){let l=a,c=new Map;l.response?c.set(OA,"ServerError"):l.request?c.set(OA,"NoResponse"):c.set(OA,"GenericError"),this.telemetry.postEvent(Cp.TASAPI_FETCHERROR_EVENTNAME,c)}if(!n)throw Error(Cp.TASAPI_FETCHERROR_EVENTNAME);e.keys.length>0&&this.PostEventToTelemetry(t);let i=n.data,o=i.Configs,s=[];for(let a of o)if(a.Parameters)for(let l of Object.keys(a.Parameters)){let c=l+(a.Parameters[l]?"":"cf");s.includes(c)||s.push(c)}return{features:s,assignmentContext:i.AssignmentContext,configs:o}}};Cp.TasApiFeatureProvider=KA});var b9=M((h_e,y9)=>{var v9=require("stream").Stream,xse=require("util");y9.exports=wa;function wa(){this.source=null,this.dataSize=0,this.maxDataSize=1024*1024,this.pauseStream=!0,this._maxDataSizeExceeded=!1,this._released=!1,this._bufferedEvents=[]}xse.inherits(wa,v9);wa.create=function(r,e){var t=new this;e=e||{};for(var n in e)t[n]=e[n];t.source=r;var i=r.emit;return r.emit=function(){return t._handleEmit(arguments),i.apply(r,arguments)},r.on("error",function(){}),t.pauseStream&&r.pause(),t};Object.defineProperty(wa.prototype,"readable",{configurable:!0,enumerable:!0,get:function(){return this.source.readable}});wa.prototype.setEncoding=function(){return this.source.setEncoding.apply(this.source,arguments)};wa.prototype.resume=function(){this._released||this.release(),this.source.resume()};wa.prototype.pause=function(){this.source.pause()};wa.prototype.release=function(){this._released=!0,this._bufferedEvents.forEach(function(r){this.emit.apply(this,r)}.bind(this)),this._bufferedEvents=[]};wa.prototype.pipe=function(){var r=v9.prototype.pipe.apply(this,arguments);return this.resume(),r};wa.prototype._handleEmit=function(r){if(this._released){this.emit.apply(this,r);return}r[0]==="data"&&(this.dataSize+=r[1].length,this._checkIfMaxDataSizeExceeded()),this._bufferedEvents.push(r)};wa.prototype._checkIfMaxDataSizeExceeded=function(){if(!this._maxDataSizeExceeded&&!(this.dataSize<=this.maxDataSize)){this._maxDataSizeExceeded=!0;var r="DelayedStream#maxDataSize of "+this.maxDataSize+" bytes exceeded.";this.emit("error",new Error(r))}}});var C9=M((g_e,x9)=>{var Cse=require("util"),S9=require("stream").Stream,I9=b9();x9.exports=En;function En(){this.writable=!1,this.readable=!0,this.dataSize=0,this.maxDataSize=2*1024*1024,this.pauseStreams=!0,this._released=!1,this._streams=[],this._currentStream=null,this._insideLoop=!1,this._pendingNext=!1}Cse.inherits(En,S9);En.create=function(r){var e=new this;r=r||{};for(var t in r)e[t]=r[t];return e};En.isStreamLike=function(r){return typeof r!="function"&&typeof r!="string"&&typeof r!="boolean"&&typeof r!="number"&&!Buffer.isBuffer(r)};En.prototype.append=function(r){var e=En.isStreamLike(r);if(e){if(!(r instanceof I9)){var t=I9.create(r,{maxDataSize:1/0,pauseStream:this.pauseStreams});r.on("data",this._checkDataSize.bind(this)),r=t}this._handleErrors(r),this.pauseStreams&&r.pause()}return this._streams.push(r),this};En.prototype.pipe=function(r,e){return S9.prototype.pipe.call(this,r,e),this.resume(),r};En.prototype._getNext=function(){if(this._currentStream=null,this._insideLoop){this._pendingNext=!0;return}this._insideLoop=!0;try{do this._pendingNext=!1,this._realGetNext();while(this._pendingNext)}finally{this._insideLoop=!1}};En.prototype._realGetNext=function(){var r=this._streams.shift();if(typeof r>"u"){this.end();return}if(typeof r!="function"){this._pipeNext(r);return}var e=r;e(function(t){var n=En.isStreamLike(t);n&&(t.on("data",this._checkDataSize.bind(this)),this._handleErrors(t)),this._pipeNext(t)}.bind(this))};En.prototype._pipeNext=function(r){this._currentStream=r;var e=En.isStreamLike(r);if(e){r.on("end",this._getNext.bind(this)),r.pipe(this,{end:!1});return}var t=r;this.write(t),this._getNext()};En.prototype._handleErrors=function(r){var e=this;r.on("error",function(t){e._emitError(t)})};En.prototype.write=function(r){this.emit("data",r)};En.prototype.pause=function(){this.pauseStreams&&(this.pauseStreams&&this._currentStream&&typeof this._currentStream.pause=="function"&&this._currentStream.pause(),this.emit("pause"))};En.prototype.resume=function(){this._released||(this._released=!0,this.writable=!0,this._getNext()),this.pauseStreams&&this._currentStream&&typeof this._currentStream.resume=="function"&&this._currentStream.resume(),this.emit("resume")};En.prototype.end=function(){this._reset(),this.emit("end")};En.prototype.destroy=function(){this._reset(),this.emit("close")};En.prototype._reset=function(){this.writable=!1,this._streams=[],this._currentStream=null};En.prototype._checkDataSize=function(){if(this._updateDataSize(),!(this.dataSize<=this.maxDataSize)){var r="DelayedStream#maxDataSize of "+this.maxDataSize+" bytes exceeded.";this._emitError(new Error(r))}};En.prototype._updateDataSize=function(){this.dataSize=0;var r=this;this._streams.forEach(function(e){e.dataSize&&(r.dataSize+=e.dataSize)}),this._currentStream&&this._currentStream.dataSize&&(this.dataSize+=this._currentStream.dataSize)};En.prototype._emitError=function(r){this._reset(),this.emit("error",r)}});var E9=M((v_e,Ese)=>{Ese.exports={"application/1d-interleaved-parityfec":{source:"iana"},"application/3gpdash-qoe-report+xml":{source:"iana",charset:"UTF-8",compressible:!0},"application/3gpp-ims+xml":{source:"iana",compressible:!0},"application/3gpphal+json":{source:"iana",compressible:!0},"application/3gpphalforms+json":{source:"iana",compressible:!0},"application/a2l":{source:"iana"},"application/ace+cbor":{source:"iana"},"application/activemessage":{source:"iana"},"application/activity+json":{source:"iana",compressible:!0},"application/alto-costmap+json":{source:"iana",compressible:!0},"application/alto-costmapfilter+json":{source:"iana",compressible:!0},"application/alto-directory+json":{source:"iana",compressible:!0},"application/alto-endpointcost+json":{source:"iana",compressible:!0},"application/alto-endpointcostparams+json":{source:"iana",compressible:!0},"application/alto-endpointprop+json":{source:"iana",compressible:!0},"application/alto-endpointpropparams+json":{source:"iana",compressible:!0},"application/alto-error+json":{source:"iana",compressible:!0},"application/alto-networkmap+json":{source:"iana",compressible:!0},"application/alto-networkmapfilter+json":{source:"iana",compressible:!0},"application/alto-updatestreamcontrol+json":{source:"iana",compressible:!0},"application/alto-updatestreamparams+json":{source:"iana",compressible:!0},"application/aml":{source:"iana"},"application/andrew-inset":{source:"iana",extensions:["ez"]},"application/applefile":{source:"iana"},"application/applixware":{source:"apache",extensions:["aw"]},"application/at+jwt":{source:"iana"},"application/atf":{source:"iana"},"application/atfx":{source:"iana"},"application/atom+xml":{source:"iana",compressible:!0,extensions:["atom"]},"application/atomcat+xml":{source:"iana",compressible:!0,extensions:["atomcat"]},"application/atomdeleted+xml":{source:"iana",compressible:!0,extensions:["atomdeleted"]},"application/atomicmail":{source:"iana"},"application/atomsvc+xml":{source:"iana",compressible:!0,extensions:["atomsvc"]},"application/atsc-dwd+xml":{source:"iana",compressible:!0,extensions:["dwd"]},"application/atsc-dynamic-event-message":{source:"iana"},"application/atsc-held+xml":{source:"iana",compressible:!0,extensions:["held"]},"application/atsc-rdt+json":{source:"iana",compressible:!0},"application/atsc-rsat+xml":{source:"iana",compressible:!0,extensions:["rsat"]},"application/atxml":{source:"iana"},"application/auth-policy+xml":{source:"iana",compressible:!0},"application/bacnet-xdd+zip":{source:"iana",compressible:!1},"application/batch-smtp":{source:"iana"},"application/bdoc":{compressible:!1,extensions:["bdoc"]},"application/beep+xml":{source:"iana",charset:"UTF-8",compressible:!0},"application/calendar+json":{source:"iana",compressible:!0},"application/calendar+xml":{source:"iana",compressible:!0,extensions:["xcs"]},"application/call-completion":{source:"iana"},"application/cals-1840":{source:"iana"},"application/captive+json":{source:"iana",compressible:!0},"application/cbor":{source:"iana"},"application/cbor-seq":{source:"iana"},"application/cccex":{source:"iana"},"application/ccmp+xml":{source:"iana",compressible:!0},"application/ccxml+xml":{source:"iana",compressible:!0,extensions:["ccxml"]},"application/cdfx+xml":{source:"iana",compressible:!0,extensions:["cdfx"]},"application/cdmi-capability":{source:"iana",extensions:["cdmia"]},"application/cdmi-container":{source:"iana",extensions:["cdmic"]},"application/cdmi-domain":{source:"iana",extensions:["cdmid"]},"application/cdmi-object":{source:"iana",extensions:["cdmio"]},"application/cdmi-queue":{source:"iana",extensions:["cdmiq"]},"application/cdni":{source:"iana"},"application/cea":{source:"iana"},"application/cea-2018+xml":{source:"iana",compressible:!0},"application/cellml+xml":{source:"iana",compressible:!0},"application/cfw":{source:"iana"},"application/city+json":{source:"iana",compressible:!0},"application/clr":{source:"iana"},"application/clue+xml":{source:"iana",compressible:!0},"application/clue_info+xml":{source:"iana",compressible:!0},"application/cms":{source:"iana"},"application/cnrp+xml":{source:"iana",compressible:!0},"application/coap-group+json":{source:"iana",compressible:!0},"application/coap-payload":{source:"iana"},"application/commonground":{source:"iana"},"application/conference-info+xml":{source:"iana",compressible:!0},"application/cose":{source:"iana"},"application/cose-key":{source:"iana"},"application/cose-key-set":{source:"iana"},"application/cpl+xml":{source:"iana",compressible:!0,extensions:["cpl"]},"application/csrattrs":{source:"iana"},"application/csta+xml":{source:"iana",compressible:!0},"application/cstadata+xml":{source:"iana",compressible:!0},"application/csvm+json":{source:"iana",compressible:!0},"application/cu-seeme":{source:"apache",extensions:["cu"]},"application/cwt":{source:"iana"},"application/cybercash":{source:"iana"},"application/dart":{compressible:!0},"application/dash+xml":{source:"iana",compressible:!0,extensions:["mpd"]},"application/dash-patch+xml":{source:"iana",compressible:!0,extensions:["mpp"]},"application/dashdelta":{source:"iana"},"application/davmount+xml":{source:"iana",compressible:!0,extensions:["davmount"]},"application/dca-rft":{source:"iana"},"application/dcd":{source:"iana"},"application/dec-dx":{source:"iana"},"application/dialog-info+xml":{source:"iana",compressible:!0},"application/dicom":{source:"iana"},"application/dicom+json":{source:"iana",compressible:!0},"application/dicom+xml":{source:"iana",compressible:!0},"application/dii":{source:"iana"},"application/dit":{source:"iana"},"application/dns":{source:"iana"},"application/dns+json":{source:"iana",compressible:!0},"application/dns-message":{source:"iana"},"application/docbook+xml":{source:"apache",compressible:!0,extensions:["dbk"]},"application/dots+cbor":{source:"iana"},"application/dskpp+xml":{source:"iana",compressible:!0},"application/dssc+der":{source:"iana",extensions:["dssc"]},"application/dssc+xml":{source:"iana",compressible:!0,extensions:["xdssc"]},"application/dvcs":{source:"iana"},"application/ecmascript":{source:"iana",compressible:!0,extensions:["es","ecma"]},"application/edi-consent":{source:"iana"},"application/edi-x12":{source:"iana",compressible:!1},"application/edifact":{source:"iana",compressible:!1},"application/efi":{source:"iana"},"application/elm+json":{source:"iana",charset:"UTF-8",compressible:!0},"application/elm+xml":{source:"iana",compressible:!0},"application/emergencycalldata.cap+xml":{source:"iana",charset:"UTF-8",compressible:!0},"application/emergencycalldata.comment+xml":{source:"iana",compressible:!0},"application/emergencycalldata.control+xml":{source:"iana",compressible:!0},"application/emergencycalldata.deviceinfo+xml":{source:"iana",compressible:!0},"application/emergencycalldata.ecall.msd":{source:"iana"},"application/emergencycalldata.providerinfo+xml":{source:"iana",compressible:!0},"application/emergencycalldata.serviceinfo+xml":{source:"iana",compressible:!0},"application/emergencycalldata.subscriberinfo+xml":{source:"iana",compressible:!0},"application/emergencycalldata.veds+xml":{source:"iana",compressible:!0},"application/emma+xml":{source:"iana",compressible:!0,extensions:["emma"]},"application/emotionml+xml":{source:"iana",compressible:!0,extensions:["emotionml"]},"application/encaprtp":{source:"iana"},"application/epp+xml":{source:"iana",compressible:!0},"application/epub+zip":{source:"iana",compressible:!1,extensions:["epub"]},"application/eshop":{source:"iana"},"application/exi":{source:"iana",extensions:["exi"]},"application/expect-ct-report+json":{source:"iana",compressible:!0},"application/express":{source:"iana",extensions:["exp"]},"application/fastinfoset":{source:"iana"},"application/fastsoap":{source:"iana"},"application/fdt+xml":{source:"iana",compressible:!0,extensions:["fdt"]},"application/fhir+json":{source:"iana",charset:"UTF-8",compressible:!0},"application/fhir+xml":{source:"iana",charset:"UTF-8",compressible:!0},"application/fido.trusted-apps+json":{compressible:!0},"application/fits":{source:"iana"},"application/flexfec":{source:"iana"},"application/font-sfnt":{source:"iana"},"application/font-tdpfr":{source:"iana",extensions:["pfr"]},"application/font-woff":{source:"iana",compressible:!1},"application/framework-attributes+xml":{source:"iana",compressible:!0},"application/geo+json":{source:"iana",compressible:!0,extensions:["geojson"]},"application/geo+json-seq":{source:"iana"},"application/geopackage+sqlite3":{source:"iana"},"application/geoxacml+xml":{source:"iana",compressible:!0},"application/gltf-buffer":{source:"iana"},"application/gml+xml":{source:"iana",compressible:!0,extensions:["gml"]},"application/gpx+xml":{source:"apache",compressible:!0,extensions:["gpx"]},"application/gxf":{source:"apache",extensions:["gxf"]},"application/gzip":{source:"iana",compressible:!1,extensions:["gz"]},"application/h224":{source:"iana"},"application/held+xml":{source:"iana",compressible:!0},"application/hjson":{extensions:["hjson"]},"application/http":{source:"iana"},"application/hyperstudio":{source:"iana",extensions:["stk"]},"application/ibe-key-request+xml":{source:"iana",compressible:!0},"application/ibe-pkg-reply+xml":{source:"iana",compressible:!0},"application/ibe-pp-data":{source:"iana"},"application/iges":{source:"iana"},"application/im-iscomposing+xml":{source:"iana",charset:"UTF-8",compressible:!0},"application/index":{source:"iana"},"application/index.cmd":{source:"iana"},"application/index.obj":{source:"iana"},"application/index.response":{source:"iana"},"application/index.vnd":{source:"iana"},"application/inkml+xml":{source:"iana",compressible:!0,extensions:["ink","inkml"]},"application/iotp":{source:"iana"},"application/ipfix":{source:"iana",extensions:["ipfix"]},"application/ipp":{source:"iana"},"application/isup":{source:"iana"},"application/its+xml":{source:"iana",compressible:!0,extensions:["its"]},"application/java-archive":{source:"apache",compressible:!1,extensions:["jar","war","ear"]},"application/java-serialized-object":{source:"apache",compressible:!1,extensions:["ser"]},"application/java-vm":{source:"apache",compressible:!1,extensions:["class"]},"application/javascript":{source:"iana",charset:"UTF-8",compressible:!0,extensions:["js","mjs"]},"application/jf2feed+json":{source:"iana",compressible:!0},"application/jose":{source:"iana"},"application/jose+json":{source:"iana",compressible:!0},"application/jrd+json":{source:"iana",compressible:!0},"application/jscalendar+json":{source:"iana",compressible:!0},"application/json":{source:"iana",charset:"UTF-8",compressible:!0,extensions:["json","map"]},"application/json-patch+json":{source:"iana",compressible:!0},"application/json-seq":{source:"iana"},"application/json5":{extensions:["json5"]},"application/jsonml+json":{source:"apache",compressible:!0,extensions:["jsonml"]},"application/jwk+json":{source:"iana",compressible:!0},"application/jwk-set+json":{source:"iana",compressible:!0},"application/jwt":{source:"iana"},"application/kpml-request+xml":{source:"iana",compressible:!0},"application/kpml-response+xml":{source:"iana",compressible:!0},"application/ld+json":{source:"iana",compressible:!0,extensions:["jsonld"]},"application/lgr+xml":{source:"iana",compressible:!0,extensions:["lgr"]},"application/link-format":{source:"iana"},"application/load-control+xml":{source:"iana",compressible:!0},"application/lost+xml":{source:"iana",compressible:!0,extensions:["lostxml"]},"application/lostsync+xml":{source:"iana",compressible:!0},"application/lpf+zip":{source:"iana",compressible:!1},"application/lxf":{source:"iana"},"application/mac-binhex40":{source:"iana",extensions:["hqx"]},"application/mac-compactpro":{source:"apache",extensions:["cpt"]},"application/macwriteii":{source:"iana"},"application/mads+xml":{source:"iana",compressible:!0,extensions:["mads"]},"application/manifest+json":{source:"iana",charset:"UTF-8",compressible:!0,extensions:["webmanifest"]},"application/marc":{source:"iana",extensions:["mrc"]},"application/marcxml+xml":{source:"iana",compressible:!0,extensions:["mrcx"]},"application/mathematica":{source:"iana",extensions:["ma","nb","mb"]},"application/mathml+xml":{source:"iana",compressible:!0,extensions:["mathml"]},"application/mathml-content+xml":{source:"iana",compressible:!0},"application/mathml-presentation+xml":{source:"iana",compressible:!0},"application/mbms-associated-procedure-description+xml":{source:"iana",compressible:!0},"application/mbms-deregister+xml":{source:"iana",compressible:!0},"application/mbms-envelope+xml":{source:"iana",compressible:!0},"application/mbms-msk+xml":{source:"iana",compressible:!0},"application/mbms-msk-response+xml":{source:"iana",compressible:!0},"application/mbms-protection-description+xml":{source:"iana",compressible:!0},"application/mbms-reception-report+xml":{source:"iana",compressible:!0},"application/mbms-register+xml":{source:"iana",compressible:!0},"application/mbms-register-response+xml":{source:"iana",compressible:!0},"application/mbms-schedule+xml":{source:"iana",compressible:!0},"application/mbms-user-service-description+xml":{source:"iana",compressible:!0},"application/mbox":{source:"iana",extensions:["mbox"]},"application/media-policy-dataset+xml":{source:"iana",compressible:!0,extensions:["mpf"]},"application/media_control+xml":{source:"iana",compressible:!0},"application/mediaservercontrol+xml":{source:"iana",compressible:!0,extensions:["mscml"]},"application/merge-patch+json":{source:"iana",compressible:!0},"application/metalink+xml":{source:"apache",compressible:!0,extensions:["metalink"]},"application/metalink4+xml":{source:"iana",compressible:!0,extensions:["meta4"]},"application/mets+xml":{source:"iana",compressible:!0,extensions:["mets"]},"application/mf4":{source:"iana"},"application/mikey":{source:"iana"},"application/mipc":{source:"iana"},"application/missing-blocks+cbor-seq":{source:"iana"},"application/mmt-aei+xml":{source:"iana",compressible:!0,extensions:["maei"]},"application/mmt-usd+xml":{source:"iana",compressible:!0,extensions:["musd"]},"application/mods+xml":{source:"iana",compressible:!0,extensions:["mods"]},"application/moss-keys":{source:"iana"},"application/moss-signature":{source:"iana"},"application/mosskey-data":{source:"iana"},"application/mosskey-request":{source:"iana"},"application/mp21":{source:"iana",extensions:["m21","mp21"]},"application/mp4":{source:"iana",extensions:["mp4s","m4p"]},"application/mpeg4-generic":{source:"iana"},"application/mpeg4-iod":{source:"iana"},"application/mpeg4-iod-xmt":{source:"iana"},"application/mrb-consumer+xml":{source:"iana",compressible:!0},"application/mrb-publish+xml":{source:"iana",compressible:!0},"application/msc-ivr+xml":{source:"iana",charset:"UTF-8",compressible:!0},"application/msc-mixer+xml":{source:"iana",charset:"UTF-8",compressible:!0},"application/msword":{source:"iana",compressible:!1,extensions:["doc","dot"]},"application/mud+json":{source:"iana",compressible:!0},"application/multipart-core":{source:"iana"},"application/mxf":{source:"iana",extensions:["mxf"]},"application/n-quads":{source:"iana",extensions:["nq"]},"application/n-triples":{source:"iana",extensions:["nt"]},"application/nasdata":{source:"iana"},"application/news-checkgroups":{source:"iana",charset:"US-ASCII"},"application/news-groupinfo":{source:"iana",charset:"US-ASCII"},"application/news-transmission":{source:"iana"},"application/nlsml+xml":{source:"iana",compressible:!0},"application/node":{source:"iana",extensions:["cjs"]},"application/nss":{source:"iana"},"application/oauth-authz-req+jwt":{source:"iana"},"application/oblivious-dns-message":{source:"iana"},"application/ocsp-request":{source:"iana"},"application/ocsp-response":{source:"iana"},"application/octet-stream":{source:"iana",compressible:!1,extensions:["bin","dms","lrf","mar","so","dist","distz","pkg","bpk","dump","elc","deploy","exe","dll","deb","dmg","iso","img","msi","msp","msm","buffer"]},"application/oda":{source:"iana",extensions:["oda"]},"application/odm+xml":{source:"iana",compressible:!0},"application/odx":{source:"iana"},"application/oebps-package+xml":{source:"iana",compressible:!0,extensions:["opf"]},"application/ogg":{source:"iana",compressible:!1,extensions:["ogx"]},"application/omdoc+xml":{source:"apache",compressible:!0,extensions:["omdoc"]},"application/onenote":{source:"apache",extensions:["onetoc","onetoc2","onetmp","onepkg"]},"application/opc-nodeset+xml":{source:"iana",compressible:!0},"application/oscore":{source:"iana"},"application/oxps":{source:"iana",extensions:["oxps"]},"application/p21":{source:"iana"},"application/p21+zip":{source:"iana",compressible:!1},"application/p2p-overlay+xml":{source:"iana",compressible:!0,extensions:["relo"]},"application/parityfec":{source:"iana"},"application/passport":{source:"iana"},"application/patch-ops-error+xml":{source:"iana",compressible:!0,extensions:["xer"]},"application/pdf":{source:"iana",compressible:!1,extensions:["pdf"]},"application/pdx":{source:"iana"},"application/pem-certificate-chain":{source:"iana"},"application/pgp-encrypted":{source:"iana",compressible:!1,extensions:["pgp"]},"application/pgp-keys":{source:"iana",extensions:["asc"]},"application/pgp-signature":{source:"iana",extensions:["asc","sig"]},"application/pics-rules":{source:"apache",extensions:["prf"]},"application/pidf+xml":{source:"iana",charset:"UTF-8",compressible:!0},"application/pidf-diff+xml":{source:"iana",charset:"UTF-8",compressible:!0},"application/pkcs10":{source:"iana",extensions:["p10"]},"application/pkcs12":{source:"iana"},"application/pkcs7-mime":{source:"iana",extensions:["p7m","p7c"]},"application/pkcs7-signature":{source:"iana",extensions:["p7s"]},"application/pkcs8":{source:"iana",extensions:["p8"]},"application/pkcs8-encrypted":{source:"iana"},"application/pkix-attr-cert":{source:"iana",extensions:["ac"]},"application/pkix-cert":{source:"iana",extensions:["cer"]},"application/pkix-crl":{source:"iana",extensions:["crl"]},"application/pkix-pkipath":{source:"iana",extensions:["pkipath"]},"application/pkixcmp":{source:"iana",extensions:["pki"]},"application/pls+xml":{source:"iana",compressible:!0,extensions:["pls"]},"application/poc-settings+xml":{source:"iana",charset:"UTF-8",compressible:!0},"application/postscript":{source:"iana",compressible:!0,extensions:["ai","eps","ps"]},"application/ppsp-tracker+json":{source:"iana",compressible:!0},"application/problem+json":{source:"iana",compressible:!0},"application/problem+xml":{source:"iana",compressible:!0},"application/provenance+xml":{source:"iana",compressible:!0,extensions:["provx"]},"application/prs.alvestrand.titrax-sheet":{source:"iana"},"application/prs.cww":{source:"iana",extensions:["cww"]},"application/prs.cyn":{source:"iana",charset:"7-BIT"},"application/prs.hpub+zip":{source:"iana",compressible:!1},"application/prs.nprend":{source:"iana"},"application/prs.plucker":{source:"iana"},"application/prs.rdf-xml-crypt":{source:"iana"},"application/prs.xsf+xml":{source:"iana",compressible:!0},"application/pskc+xml":{source:"iana",compressible:!0,extensions:["pskcxml"]},"application/pvd+json":{source:"iana",compressible:!0},"application/qsig":{source:"iana"},"application/raml+yaml":{compressible:!0,extensions:["raml"]},"application/raptorfec":{source:"iana"},"application/rdap+json":{source:"iana",compressible:!0},"application/rdf+xml":{source:"iana",compressible:!0,extensions:["rdf","owl"]},"application/reginfo+xml":{source:"iana",compressible:!0,extensions:["rif"]},"application/relax-ng-compact-syntax":{source:"iana",extensions:["rnc"]},"application/remote-printing":{source:"iana"},"application/reputon+json":{source:"iana",compressible:!0},"application/resource-lists+xml":{source:"iana",compressible:!0,extensions:["rl"]},"application/resource-lists-diff+xml":{source:"iana",compressible:!0,extensions:["rld"]},"application/rfc+xml":{source:"iana",compressible:!0},"application/riscos":{source:"iana"},"application/rlmi+xml":{source:"iana",compressible:!0},"application/rls-services+xml":{source:"iana",compressible:!0,extensions:["rs"]},"application/route-apd+xml":{source:"iana",compressible:!0,extensions:["rapd"]},"application/route-s-tsid+xml":{source:"iana",compressible:!0,extensions:["sls"]},"application/route-usd+xml":{source:"iana",compressible:!0,extensions:["rusd"]},"application/rpki-ghostbusters":{source:"iana",extensions:["gbr"]},"application/rpki-manifest":{source:"iana",extensions:["mft"]},"application/rpki-publication":{source:"iana"},"application/rpki-roa":{source:"iana",extensions:["roa"]},"application/rpki-updown":{source:"iana"},"application/rsd+xml":{source:"apache",compressible:!0,extensions:["rsd"]},"application/rss+xml":{source:"apache",compressible:!0,extensions:["rss"]},"application/rtf":{source:"iana",compressible:!0,extensions:["rtf"]},"application/rtploopback":{source:"iana"},"application/rtx":{source:"iana"},"application/samlassertion+xml":{source:"iana",compressible:!0},"application/samlmetadata+xml":{source:"iana",compressible:!0},"application/sarif+json":{source:"iana",compressible:!0},"application/sarif-external-properties+json":{source:"iana",compressible:!0},"application/sbe":{source:"iana"},"application/sbml+xml":{source:"iana",compressible:!0,extensions:["sbml"]},"application/scaip+xml":{source:"iana",compressible:!0},"application/scim+json":{source:"iana",compressible:!0},"application/scvp-cv-request":{source:"iana",extensions:["scq"]},"application/scvp-cv-response":{source:"iana",extensions:["scs"]},"application/scvp-vp-request":{source:"iana",extensions:["spq"]},"application/scvp-vp-response":{source:"iana",extensions:["spp"]},"application/sdp":{source:"iana",extensions:["sdp"]},"application/secevent+jwt":{source:"iana"},"application/senml+cbor":{source:"iana"},"application/senml+json":{source:"iana",compressible:!0},"application/senml+xml":{source:"iana",compressible:!0,extensions:["senmlx"]},"application/senml-etch+cbor":{source:"iana"},"application/senml-etch+json":{source:"iana",compressible:!0},"application/senml-exi":{source:"iana"},"application/sensml+cbor":{source:"iana"},"application/sensml+json":{source:"iana",compressible:!0},"application/sensml+xml":{source:"iana",compressible:!0,extensions:["sensmlx"]},"application/sensml-exi":{source:"iana"},"application/sep+xml":{source:"iana",compressible:!0},"application/sep-exi":{source:"iana"},"application/session-info":{source:"iana"},"application/set-payment":{source:"iana"},"application/set-payment-initiation":{source:"iana",extensions:["setpay"]},"application/set-registration":{source:"iana"},"application/set-registration-initiation":{source:"iana",extensions:["setreg"]},"application/sgml":{source:"iana"},"application/sgml-open-catalog":{source:"iana"},"application/shf+xml":{source:"iana",compressible:!0,extensions:["shf"]},"application/sieve":{source:"iana",extensions:["siv","sieve"]},"application/simple-filter+xml":{source:"iana",compressible:!0},"application/simple-message-summary":{source:"iana"},"application/simplesymbolcontainer":{source:"iana"},"application/sipc":{source:"iana"},"application/slate":{source:"iana"},"application/smil":{source:"iana"},"application/smil+xml":{source:"iana",compressible:!0,extensions:["smi","smil"]},"application/smpte336m":{source:"iana"},"application/soap+fastinfoset":{source:"iana"},"application/soap+xml":{source:"iana",compressible:!0},"application/sparql-query":{source:"iana",extensions:["rq"]},"application/sparql-results+xml":{source:"iana",compressible:!0,extensions:["srx"]},"application/spdx+json":{source:"iana",compressible:!0},"application/spirits-event+xml":{source:"iana",compressible:!0},"application/sql":{source:"iana"},"application/srgs":{source:"iana",extensions:["gram"]},"application/srgs+xml":{source:"iana",compressible:!0,extensions:["grxml"]},"application/sru+xml":{source:"iana",compressible:!0,extensions:["sru"]},"application/ssdl+xml":{source:"apache",compressible:!0,extensions:["ssdl"]},"application/ssml+xml":{source:"iana",compressible:!0,extensions:["ssml"]},"application/stix+json":{source:"iana",compressible:!0},"application/swid+xml":{source:"iana",compressible:!0,extensions:["swidtag"]},"application/tamp-apex-update":{source:"iana"},"application/tamp-apex-update-confirm":{source:"iana"},"application/tamp-community-update":{source:"iana"},"application/tamp-community-update-confirm":{source:"iana"},"application/tamp-error":{source:"iana"},"application/tamp-sequence-adjust":{source:"iana"},"application/tamp-sequence-adjust-confirm":{source:"iana"},"application/tamp-status-query":{source:"iana"},"application/tamp-status-response":{source:"iana"},"application/tamp-update":{source:"iana"},"application/tamp-update-confirm":{source:"iana"},"application/tar":{compressible:!0},"application/taxii+json":{source:"iana",compressible:!0},"application/td+json":{source:"iana",compressible:!0},"application/tei+xml":{source:"iana",compressible:!0,extensions:["tei","teicorpus"]},"application/tetra_isi":{source:"iana"},"application/thraud+xml":{source:"iana",compressible:!0,extensions:["tfi"]},"application/timestamp-query":{source:"iana"},"application/timestamp-reply":{source:"iana"},"application/timestamped-data":{source:"iana",extensions:["tsd"]},"application/tlsrpt+gzip":{source:"iana"},"application/tlsrpt+json":{source:"iana",compressible:!0},"application/tnauthlist":{source:"iana"},"application/token-introspection+jwt":{source:"iana"},"application/toml":{compressible:!0,extensions:["toml"]},"application/trickle-ice-sdpfrag":{source:"iana"},"application/trig":{source:"iana",extensions:["trig"]},"application/ttml+xml":{source:"iana",compressible:!0,extensions:["ttml"]},"application/tve-trigger":{source:"iana"},"application/tzif":{source:"iana"},"application/tzif-leap":{source:"iana"},"application/ubjson":{compressible:!1,extensions:["ubj"]},"application/ulpfec":{source:"iana"},"application/urc-grpsheet+xml":{source:"iana",compressible:!0},"application/urc-ressheet+xml":{source:"iana",compressible:!0,extensions:["rsheet"]},"application/urc-targetdesc+xml":{source:"iana",compressible:!0,extensions:["td"]},"application/urc-uisocketdesc+xml":{source:"iana",compressible:!0},"application/vcard+json":{source:"iana",compressible:!0},"application/vcard+xml":{source:"iana",compressible:!0},"application/vemmi":{source:"iana"},"application/vividence.scriptfile":{source:"apache"},"application/vnd.1000minds.decision-model+xml":{source:"iana",compressible:!0,extensions:["1km"]},"application/vnd.3gpp-prose+xml":{source:"iana",compressible:!0},"application/vnd.3gpp-prose-pc3ch+xml":{source:"iana",compressible:!0},"application/vnd.3gpp-v2x-local-service-information":{source:"iana"},"application/vnd.3gpp.5gnas":{source:"iana"},"application/vnd.3gpp.access-transfer-events+xml":{source:"iana",compressible:!0},"application/vnd.3gpp.bsf+xml":{source:"iana",compressible:!0},"application/vnd.3gpp.gmop+xml":{source:"iana",compressible:!0},"application/vnd.3gpp.gtpc":{source:"iana"},"application/vnd.3gpp.interworking-data":{source:"iana"},"application/vnd.3gpp.lpp":{source:"iana"},"application/vnd.3gpp.mc-signalling-ear":{source:"iana"},"application/vnd.3gpp.mcdata-affiliation-command+xml":{source:"iana",compressible:!0},"application/vnd.3gpp.mcdata-info+xml":{source:"iana",compressible:!0},"application/vnd.3gpp.mcdata-payload":{source:"iana"},"application/vnd.3gpp.mcdata-service-config+xml":{source:"iana",compressible:!0},"application/vnd.3gpp.mcdata-signalling":{source:"iana"},"application/vnd.3gpp.mcdata-ue-config+xml":{source:"iana",compressible:!0},"application/vnd.3gpp.mcdata-user-profile+xml":{source:"iana",compressible:!0},"application/vnd.3gpp.mcptt-affiliation-command+xml":{source:"iana",compressible:!0},"application/vnd.3gpp.mcptt-floor-request+xml":{source:"iana",compressible:!0},"application/vnd.3gpp.mcptt-info+xml":{source:"iana",compressible:!0},"application/vnd.3gpp.mcptt-location-info+xml":{source:"iana",compressible:!0},"application/vnd.3gpp.mcptt-mbms-usage-info+xml":{source:"iana",compressible:!0},"application/vnd.3gpp.mcptt-service-config+xml":{source:"iana",compressible:!0},"application/vnd.3gpp.mcptt-signed+xml":{source:"iana",compressible:!0},"application/vnd.3gpp.mcptt-ue-config+xml":{source:"iana",compressible:!0},"application/vnd.3gpp.mcptt-ue-init-config+xml":{source:"iana",compressible:!0},"application/vnd.3gpp.mcptt-user-profile+xml":{source:"iana",compressible:!0},"application/vnd.3gpp.mcvideo-affiliation-command+xml":{source:"iana",compressible:!0},"application/vnd.3gpp.mcvideo-affiliation-info+xml":{source:"iana",compressible:!0},"application/vnd.3gpp.mcvideo-info+xml":{source:"iana",compressible:!0},"application/vnd.3gpp.mcvideo-location-info+xml":{source:"iana",compressible:!0},"application/vnd.3gpp.mcvideo-mbms-usage-info+xml":{source:"iana",compressible:!0},"application/vnd.3gpp.mcvideo-service-config+xml":{source:"iana",compressible:!0},"application/vnd.3gpp.mcvideo-transmission-request+xml":{source:"iana",compressible:!0},"application/vnd.3gpp.mcvideo-ue-config+xml":{source:"iana",compressible:!0},"application/vnd.3gpp.mcvideo-user-profile+xml":{source:"iana",compressible:!0},"application/vnd.3gpp.mid-call+xml":{source:"iana",compressible:!0},"application/vnd.3gpp.ngap":{source:"iana"},"application/vnd.3gpp.pfcp":{source:"iana"},"application/vnd.3gpp.pic-bw-large":{source:"iana",extensions:["plb"]},"application/vnd.3gpp.pic-bw-small":{source:"iana",extensions:["psb"]},"application/vnd.3gpp.pic-bw-var":{source:"iana",extensions:["pvb"]},"application/vnd.3gpp.s1ap":{source:"iana"},"application/vnd.3gpp.sms":{source:"iana"},"application/vnd.3gpp.sms+xml":{source:"iana",compressible:!0},"application/vnd.3gpp.srvcc-ext+xml":{source:"iana",compressible:!0},"application/vnd.3gpp.srvcc-info+xml":{source:"iana",compressible:!0},"application/vnd.3gpp.state-and-event-info+xml":{source:"iana",compressible:!0},"application/vnd.3gpp.ussd+xml":{source:"iana",compressible:!0},"application/vnd.3gpp2.bcmcsinfo+xml":{source:"iana",compressible:!0},"application/vnd.3gpp2.sms":{source:"iana"},"application/vnd.3gpp2.tcap":{source:"iana",extensions:["tcap"]},"application/vnd.3lightssoftware.imagescal":{source:"iana"},"application/vnd.3m.post-it-notes":{source:"iana",extensions:["pwn"]},"application/vnd.accpac.simply.aso":{source:"iana",extensions:["aso"]},"application/vnd.accpac.simply.imp":{source:"iana",extensions:["imp"]},"application/vnd.acucobol":{source:"iana",extensions:["acu"]},"application/vnd.acucorp":{source:"iana",extensions:["atc","acutc"]},"application/vnd.adobe.air-application-installer-package+zip":{source:"apache",compressible:!1,extensions:["air"]},"application/vnd.adobe.flash.movie":{source:"iana"},"application/vnd.adobe.formscentral.fcdt":{source:"iana",extensions:["fcdt"]},"application/vnd.adobe.fxp":{source:"iana",extensions:["fxp","fxpl"]},"application/vnd.adobe.partial-upload":{source:"iana"},"application/vnd.adobe.xdp+xml":{source:"iana",compressible:!0,extensions:["xdp"]},"application/vnd.adobe.xfdf":{source:"iana",extensions:["xfdf"]},"application/vnd.aether.imp":{source:"iana"},"application/vnd.afpc.afplinedata":{source:"iana"},"application/vnd.afpc.afplinedata-pagedef":{source:"iana"},"application/vnd.afpc.cmoca-cmresource":{source:"iana"},"application/vnd.afpc.foca-charset":{source:"iana"},"application/vnd.afpc.foca-codedfont":{source:"iana"},"application/vnd.afpc.foca-codepage":{source:"iana"},"application/vnd.afpc.modca":{source:"iana"},"application/vnd.afpc.modca-cmtable":{source:"iana"},"application/vnd.afpc.modca-formdef":{source:"iana"},"application/vnd.afpc.modca-mediummap":{source:"iana"},"application/vnd.afpc.modca-objectcontainer":{source:"iana"},"application/vnd.afpc.modca-overlay":{source:"iana"},"application/vnd.afpc.modca-pagesegment":{source:"iana"},"application/vnd.age":{source:"iana",extensions:["age"]},"application/vnd.ah-barcode":{source:"iana"},"application/vnd.ahead.space":{source:"iana",extensions:["ahead"]},"application/vnd.airzip.filesecure.azf":{source:"iana",extensions:["azf"]},"application/vnd.airzip.filesecure.azs":{source:"iana",extensions:["azs"]},"application/vnd.amadeus+json":{source:"iana",compressible:!0},"application/vnd.amazon.ebook":{source:"apache",extensions:["azw"]},"application/vnd.amazon.mobi8-ebook":{source:"iana"},"application/vnd.americandynamics.acc":{source:"iana",extensions:["acc"]},"application/vnd.amiga.ami":{source:"iana",extensions:["ami"]},"application/vnd.amundsen.maze+xml":{source:"iana",compressible:!0},"application/vnd.android.ota":{source:"iana"},"application/vnd.android.package-archive":{source:"apache",compressible:!1,extensions:["apk"]},"application/vnd.anki":{source:"iana"},"application/vnd.anser-web-certificate-issue-initiation":{source:"iana",extensions:["cii"]},"application/vnd.anser-web-funds-transfer-initiation":{source:"apache",extensions:["fti"]},"application/vnd.antix.game-component":{source:"iana",extensions:["atx"]},"application/vnd.apache.arrow.file":{source:"iana"},"application/vnd.apache.arrow.stream":{source:"iana"},"application/vnd.apache.thrift.binary":{source:"iana"},"application/vnd.apache.thrift.compact":{source:"iana"},"application/vnd.apache.thrift.json":{source:"iana"},"application/vnd.api+json":{source:"iana",compressible:!0},"application/vnd.aplextor.warrp+json":{source:"iana",compressible:!0},"application/vnd.apothekende.reservation+json":{source:"iana",compressible:!0},"application/vnd.apple.installer+xml":{source:"iana",compressible:!0,extensions:["mpkg"]},"application/vnd.apple.keynote":{source:"iana",extensions:["key"]},"application/vnd.apple.mpegurl":{source:"iana",extensions:["m3u8"]},"application/vnd.apple.numbers":{source:"iana",extensions:["numbers"]},"application/vnd.apple.pages":{source:"iana",extensions:["pages"]},"application/vnd.apple.pkpass":{compressible:!1,extensions:["pkpass"]},"application/vnd.arastra.swi":{source:"iana"},"application/vnd.aristanetworks.swi":{source:"iana",extensions:["swi"]},"application/vnd.artisan+json":{source:"iana",compressible:!0},"application/vnd.artsquare":{source:"iana"},"application/vnd.astraea-software.iota":{source:"iana",extensions:["iota"]},"application/vnd.audiograph":{source:"iana",extensions:["aep"]},"application/vnd.autopackage":{source:"iana"},"application/vnd.avalon+json":{source:"iana",compressible:!0},"application/vnd.avistar+xml":{source:"iana",compressible:!0},"application/vnd.balsamiq.bmml+xml":{source:"iana",compressible:!0,extensions:["bmml"]},"application/vnd.balsamiq.bmpr":{source:"iana"},"application/vnd.banana-accounting":{source:"iana"},"application/vnd.bbf.usp.error":{source:"iana"},"application/vnd.bbf.usp.msg":{source:"iana"},"application/vnd.bbf.usp.msg+json":{source:"iana",compressible:!0},"application/vnd.bekitzur-stech+json":{source:"iana",compressible:!0},"application/vnd.bint.med-content":{source:"iana"},"application/vnd.biopax.rdf+xml":{source:"iana",compressible:!0},"application/vnd.blink-idb-value-wrapper":{source:"iana"},"application/vnd.blueice.multipass":{source:"iana",extensions:["mpm"]},"application/vnd.bluetooth.ep.oob":{source:"iana"},"application/vnd.bluetooth.le.oob":{source:"iana"},"application/vnd.bmi":{source:"iana",extensions:["bmi"]},"application/vnd.bpf":{source:"iana"},"application/vnd.bpf3":{source:"iana"},"application/vnd.businessobjects":{source:"iana",extensions:["rep"]},"application/vnd.byu.uapi+json":{source:"iana",compressible:!0},"application/vnd.cab-jscript":{source:"iana"},"application/vnd.canon-cpdl":{source:"iana"},"application/vnd.canon-lips":{source:"iana"},"application/vnd.capasystems-pg+json":{source:"iana",compressible:!0},"application/vnd.cendio.thinlinc.clientconf":{source:"iana"},"application/vnd.century-systems.tcp_stream":{source:"iana"},"application/vnd.chemdraw+xml":{source:"iana",compressible:!0,extensions:["cdxml"]},"application/vnd.chess-pgn":{source:"iana"},"application/vnd.chipnuts.karaoke-mmd":{source:"iana",extensions:["mmd"]},"application/vnd.ciedi":{source:"iana"},"application/vnd.cinderella":{source:"iana",extensions:["cdy"]},"application/vnd.cirpack.isdn-ext":{source:"iana"},"application/vnd.citationstyles.style+xml":{source:"iana",compressible:!0,extensions:["csl"]},"application/vnd.claymore":{source:"iana",extensions:["cla"]},"application/vnd.cloanto.rp9":{source:"iana",extensions:["rp9"]},"application/vnd.clonk.c4group":{source:"iana",extensions:["c4g","c4d","c4f","c4p","c4u"]},"application/vnd.cluetrust.cartomobile-config":{source:"iana",extensions:["c11amc"]},"application/vnd.cluetrust.cartomobile-config-pkg":{source:"iana",extensions:["c11amz"]},"application/vnd.coffeescript":{source:"iana"},"application/vnd.collabio.xodocuments.document":{source:"iana"},"application/vnd.collabio.xodocuments.document-template":{source:"iana"},"application/vnd.collabio.xodocuments.presentation":{source:"iana"},"application/vnd.collabio.xodocuments.presentation-template":{source:"iana"},"application/vnd.collabio.xodocuments.spreadsheet":{source:"iana"},"application/vnd.collabio.xodocuments.spreadsheet-template":{source:"iana"},"application/vnd.collection+json":{source:"iana",compressible:!0},"application/vnd.collection.doc+json":{source:"iana",compressible:!0},"application/vnd.collection.next+json":{source:"iana",compressible:!0},"application/vnd.comicbook+zip":{source:"iana",compressible:!1},"application/vnd.comicbook-rar":{source:"iana"},"application/vnd.commerce-battelle":{source:"iana"},"application/vnd.commonspace":{source:"iana",extensions:["csp"]},"application/vnd.contact.cmsg":{source:"iana",extensions:["cdbcmsg"]},"application/vnd.coreos.ignition+json":{source:"iana",compressible:!0},"application/vnd.cosmocaller":{source:"iana",extensions:["cmc"]},"application/vnd.crick.clicker":{source:"iana",extensions:["clkx"]},"application/vnd.crick.clicker.keyboard":{source:"iana",extensions:["clkk"]},"application/vnd.crick.clicker.palette":{source:"iana",extensions:["clkp"]},"application/vnd.crick.clicker.template":{source:"iana",extensions:["clkt"]},"application/vnd.crick.clicker.wordbank":{source:"iana",extensions:["clkw"]},"application/vnd.criticaltools.wbs+xml":{source:"iana",compressible:!0,extensions:["wbs"]},"application/vnd.cryptii.pipe+json":{source:"iana",compressible:!0},"application/vnd.crypto-shade-file":{source:"iana"},"application/vnd.cryptomator.encrypted":{source:"iana"},"application/vnd.cryptomator.vault":{source:"iana"},"application/vnd.ctc-posml":{source:"iana",extensions:["pml"]},"application/vnd.ctct.ws+xml":{source:"iana",compressible:!0},"application/vnd.cups-pdf":{source:"iana"},"application/vnd.cups-postscript":{source:"iana"},"application/vnd.cups-ppd":{source:"iana",extensions:["ppd"]},"application/vnd.cups-raster":{source:"iana"},"application/vnd.cups-raw":{source:"iana"},"application/vnd.curl":{source:"iana"},"application/vnd.curl.car":{source:"apache",extensions:["car"]},"application/vnd.curl.pcurl":{source:"apache",extensions:["pcurl"]},"application/vnd.cyan.dean.root+xml":{source:"iana",compressible:!0},"application/vnd.cybank":{source:"iana"},"application/vnd.cyclonedx+json":{source:"iana",compressible:!0},"application/vnd.cyclonedx+xml":{source:"iana",compressible:!0},"application/vnd.d2l.coursepackage1p0+zip":{source:"iana",compressible:!1},"application/vnd.d3m-dataset":{source:"iana"},"application/vnd.d3m-problem":{source:"iana"},"application/vnd.dart":{source:"iana",compressible:!0,extensions:["dart"]},"application/vnd.data-vision.rdz":{source:"iana",extensions:["rdz"]},"application/vnd.datapackage+json":{source:"iana",compressible:!0},"application/vnd.dataresource+json":{source:"iana",compressible:!0},"application/vnd.dbf":{source:"iana",extensions:["dbf"]},"application/vnd.debian.binary-package":{source:"iana"},"application/vnd.dece.data":{source:"iana",extensions:["uvf","uvvf","uvd","uvvd"]},"application/vnd.dece.ttml+xml":{source:"iana",compressible:!0,extensions:["uvt","uvvt"]},"application/vnd.dece.unspecified":{source:"iana",extensions:["uvx","uvvx"]},"application/vnd.dece.zip":{source:"iana",extensions:["uvz","uvvz"]},"application/vnd.denovo.fcselayout-link":{source:"iana",extensions:["fe_launch"]},"application/vnd.desmume.movie":{source:"iana"},"application/vnd.dir-bi.plate-dl-nosuffix":{source:"iana"},"application/vnd.dm.delegation+xml":{source:"iana",compressible:!0},"application/vnd.dna":{source:"iana",extensions:["dna"]},"application/vnd.document+json":{source:"iana",compressible:!0},"application/vnd.dolby.mlp":{source:"apache",extensions:["mlp"]},"application/vnd.dolby.mobile.1":{source:"iana"},"application/vnd.dolby.mobile.2":{source:"iana"},"application/vnd.doremir.scorecloud-binary-document":{source:"iana"},"application/vnd.dpgraph":{source:"iana",extensions:["dpg"]},"application/vnd.dreamfactory":{source:"iana",extensions:["dfac"]},"application/vnd.drive+json":{source:"iana",compressible:!0},"application/vnd.ds-keypoint":{source:"apache",extensions:["kpxx"]},"application/vnd.dtg.local":{source:"iana"},"application/vnd.dtg.local.flash":{source:"iana"},"application/vnd.dtg.local.html":{source:"iana"},"application/vnd.dvb.ait":{source:"iana",extensions:["ait"]},"application/vnd.dvb.dvbisl+xml":{source:"iana",compressible:!0},"application/vnd.dvb.dvbj":{source:"iana"},"application/vnd.dvb.esgcontainer":{source:"iana"},"application/vnd.dvb.ipdcdftnotifaccess":{source:"iana"},"application/vnd.dvb.ipdcesgaccess":{source:"iana"},"application/vnd.dvb.ipdcesgaccess2":{source:"iana"},"application/vnd.dvb.ipdcesgpdd":{source:"iana"},"application/vnd.dvb.ipdcroaming":{source:"iana"},"application/vnd.dvb.iptv.alfec-base":{source:"iana"},"application/vnd.dvb.iptv.alfec-enhancement":{source:"iana"},"application/vnd.dvb.notif-aggregate-root+xml":{source:"iana",compressible:!0},"application/vnd.dvb.notif-container+xml":{source:"iana",compressible:!0},"application/vnd.dvb.notif-generic+xml":{source:"iana",compressible:!0},"application/vnd.dvb.notif-ia-msglist+xml":{source:"iana",compressible:!0},"application/vnd.dvb.notif-ia-registration-request+xml":{source:"iana",compressible:!0},"application/vnd.dvb.notif-ia-registration-response+xml":{source:"iana",compressible:!0},"application/vnd.dvb.notif-init+xml":{source:"iana",compressible:!0},"application/vnd.dvb.pfr":{source:"iana"},"application/vnd.dvb.service":{source:"iana",extensions:["svc"]},"application/vnd.dxr":{source:"iana"},"application/vnd.dynageo":{source:"iana",extensions:["geo"]},"application/vnd.dzr":{source:"iana"},"application/vnd.easykaraoke.cdgdownload":{source:"iana"},"application/vnd.ecdis-update":{source:"iana"},"application/vnd.ecip.rlp":{source:"iana"},"application/vnd.eclipse.ditto+json":{source:"iana",compressible:!0},"application/vnd.ecowin.chart":{source:"iana",extensions:["mag"]},"application/vnd.ecowin.filerequest":{source:"iana"},"application/vnd.ecowin.fileupdate":{source:"iana"},"application/vnd.ecowin.series":{source:"iana"},"application/vnd.ecowin.seriesrequest":{source:"iana"},"application/vnd.ecowin.seriesupdate":{source:"iana"},"application/vnd.efi.img":{source:"iana"},"application/vnd.efi.iso":{source:"iana"},"application/vnd.emclient.accessrequest+xml":{source:"iana",compressible:!0},"application/vnd.enliven":{source:"iana",extensions:["nml"]},"application/vnd.enphase.envoy":{source:"iana"},"application/vnd.eprints.data+xml":{source:"iana",compressible:!0},"application/vnd.epson.esf":{source:"iana",extensions:["esf"]},"application/vnd.epson.msf":{source:"iana",extensions:["msf"]},"application/vnd.epson.quickanime":{source:"iana",extensions:["qam"]},"application/vnd.epson.salt":{source:"iana",extensions:["slt"]},"application/vnd.epson.ssf":{source:"iana",extensions:["ssf"]},"application/vnd.ericsson.quickcall":{source:"iana"},"application/vnd.espass-espass+zip":{source:"iana",compressible:!1},"application/vnd.eszigno3+xml":{source:"iana",compressible:!0,extensions:["es3","et3"]},"application/vnd.etsi.aoc+xml":{source:"iana",compressible:!0},"application/vnd.etsi.asic-e+zip":{source:"iana",compressible:!1},"application/vnd.etsi.asic-s+zip":{source:"iana",compressible:!1},"application/vnd.etsi.cug+xml":{source:"iana",compressible:!0},"application/vnd.etsi.iptvcommand+xml":{source:"iana",compressible:!0},"application/vnd.etsi.iptvdiscovery+xml":{source:"iana",compressible:!0},"application/vnd.etsi.iptvprofile+xml":{source:"iana",compressible:!0},"application/vnd.etsi.iptvsad-bc+xml":{source:"iana",compressible:!0},"application/vnd.etsi.iptvsad-cod+xml":{source:"iana",compressible:!0},"application/vnd.etsi.iptvsad-npvr+xml":{source:"iana",compressible:!0},"application/vnd.etsi.iptvservice+xml":{source:"iana",compressible:!0},"application/vnd.etsi.iptvsync+xml":{source:"iana",compressible:!0},"application/vnd.etsi.iptvueprofile+xml":{source:"iana",compressible:!0},"application/vnd.etsi.mcid+xml":{source:"iana",compressible:!0},"application/vnd.etsi.mheg5":{source:"iana"},"application/vnd.etsi.overload-control-policy-dataset+xml":{source:"iana",compressible:!0},"application/vnd.etsi.pstn+xml":{source:"iana",compressible:!0},"application/vnd.etsi.sci+xml":{source:"iana",compressible:!0},"application/vnd.etsi.simservs+xml":{source:"iana",compressible:!0},"application/vnd.etsi.timestamp-token":{source:"iana"},"application/vnd.etsi.tsl+xml":{source:"iana",compressible:!0},"application/vnd.etsi.tsl.der":{source:"iana"},"application/vnd.eu.kasparian.car+json":{source:"iana",compressible:!0},"application/vnd.eudora.data":{source:"iana"},"application/vnd.evolv.ecig.profile":{source:"iana"},"application/vnd.evolv.ecig.settings":{source:"iana"},"application/vnd.evolv.ecig.theme":{source:"iana"},"application/vnd.exstream-empower+zip":{source:"iana",compressible:!1},"application/vnd.exstream-package":{source:"iana"},"application/vnd.ezpix-album":{source:"iana",extensions:["ez2"]},"application/vnd.ezpix-package":{source:"iana",extensions:["ez3"]},"application/vnd.f-secure.mobile":{source:"iana"},"application/vnd.familysearch.gedcom+zip":{source:"iana",compressible:!1},"application/vnd.fastcopy-disk-image":{source:"iana"},"application/vnd.fdf":{source:"iana",extensions:["fdf"]},"application/vnd.fdsn.mseed":{source:"iana",extensions:["mseed"]},"application/vnd.fdsn.seed":{source:"iana",extensions:["seed","dataless"]},"application/vnd.ffsns":{source:"iana"},"application/vnd.ficlab.flb+zip":{source:"iana",compressible:!1},"application/vnd.filmit.zfc":{source:"iana"},"application/vnd.fints":{source:"iana"},"application/vnd.firemonkeys.cloudcell":{source:"iana"},"application/vnd.flographit":{source:"iana",extensions:["gph"]},"application/vnd.fluxtime.clip":{source:"iana",extensions:["ftc"]},"application/vnd.font-fontforge-sfd":{source:"iana"},"application/vnd.framemaker":{source:"iana",extensions:["fm","frame","maker","book"]},"application/vnd.frogans.fnc":{source:"iana",extensions:["fnc"]},"application/vnd.frogans.ltf":{source:"iana",extensions:["ltf"]},"application/vnd.fsc.weblaunch":{source:"iana",extensions:["fsc"]},"application/vnd.fujifilm.fb.docuworks":{source:"iana"},"application/vnd.fujifilm.fb.docuworks.binder":{source:"iana"},"application/vnd.fujifilm.fb.docuworks.container":{source:"iana"},"application/vnd.fujifilm.fb.jfi+xml":{source:"iana",compressible:!0},"application/vnd.fujitsu.oasys":{source:"iana",extensions:["oas"]},"application/vnd.fujitsu.oasys2":{source:"iana",extensions:["oa2"]},"application/vnd.fujitsu.oasys3":{source:"iana",extensions:["oa3"]},"application/vnd.fujitsu.oasysgp":{source:"iana",extensions:["fg5"]},"application/vnd.fujitsu.oasysprs":{source:"iana",extensions:["bh2"]},"application/vnd.fujixerox.art-ex":{source:"iana"},"application/vnd.fujixerox.art4":{source:"iana"},"application/vnd.fujixerox.ddd":{source:"iana",extensions:["ddd"]},"application/vnd.fujixerox.docuworks":{source:"iana",extensions:["xdw"]},"application/vnd.fujixerox.docuworks.binder":{source:"iana",extensions:["xbd"]},"application/vnd.fujixerox.docuworks.container":{source:"iana"},"application/vnd.fujixerox.hbpl":{source:"iana"},"application/vnd.fut-misnet":{source:"iana"},"application/vnd.futoin+cbor":{source:"iana"},"application/vnd.futoin+json":{source:"iana",compressible:!0},"application/vnd.fuzzysheet":{source:"iana",extensions:["fzs"]},"application/vnd.genomatix.tuxedo":{source:"iana",extensions:["txd"]},"application/vnd.gentics.grd+json":{source:"iana",compressible:!0},"application/vnd.geo+json":{source:"iana",compressible:!0},"application/vnd.geocube+xml":{source:"iana",compressible:!0},"application/vnd.geogebra.file":{source:"iana",extensions:["ggb"]},"application/vnd.geogebra.slides":{source:"iana"},"application/vnd.geogebra.tool":{source:"iana",extensions:["ggt"]},"application/vnd.geometry-explorer":{source:"iana",extensions:["gex","gre"]},"application/vnd.geonext":{source:"iana",extensions:["gxt"]},"application/vnd.geoplan":{source:"iana",extensions:["g2w"]},"application/vnd.geospace":{source:"iana",extensions:["g3w"]},"application/vnd.gerber":{source:"iana"},"application/vnd.globalplatform.card-content-mgt":{source:"iana"},"application/vnd.globalplatform.card-content-mgt-response":{source:"iana"},"application/vnd.gmx":{source:"iana",extensions:["gmx"]},"application/vnd.google-apps.document":{compressible:!1,extensions:["gdoc"]},"application/vnd.google-apps.presentation":{compressible:!1,extensions:["gslides"]},"application/vnd.google-apps.spreadsheet":{compressible:!1,extensions:["gsheet"]},"application/vnd.google-earth.kml+xml":{source:"iana",compressible:!0,extensions:["kml"]},"application/vnd.google-earth.kmz":{source:"iana",compressible:!1,extensions:["kmz"]},"application/vnd.gov.sk.e-form+xml":{source:"iana",compressible:!0},"application/vnd.gov.sk.e-form+zip":{source:"iana",compressible:!1},"application/vnd.gov.sk.xmldatacontainer+xml":{source:"iana",compressible:!0},"application/vnd.grafeq":{source:"iana",extensions:["gqf","gqs"]},"application/vnd.gridmp":{source:"iana"},"application/vnd.groove-account":{source:"iana",extensions:["gac"]},"application/vnd.groove-help":{source:"iana",extensions:["ghf"]},"application/vnd.groove-identity-message":{source:"iana",extensions:["gim"]},"application/vnd.groove-injector":{source:"iana",extensions:["grv"]},"application/vnd.groove-tool-message":{source:"iana",extensions:["gtm"]},"application/vnd.groove-tool-template":{source:"iana",extensions:["tpl"]},"application/vnd.groove-vcard":{source:"iana",extensions:["vcg"]},"application/vnd.hal+json":{source:"iana",compressible:!0},"application/vnd.hal+xml":{source:"iana",compressible:!0,extensions:["hal"]},"application/vnd.handheld-entertainment+xml":{source:"iana",compressible:!0,extensions:["zmm"]},"application/vnd.hbci":{source:"iana",extensions:["hbci"]},"application/vnd.hc+json":{source:"iana",compressible:!0},"application/vnd.hcl-bireports":{source:"iana"},"application/vnd.hdt":{source:"iana"},"application/vnd.heroku+json":{source:"iana",compressible:!0},"application/vnd.hhe.lesson-player":{source:"iana",extensions:["les"]},"application/vnd.hl7cda+xml":{source:"iana",charset:"UTF-8",compressible:!0},"application/vnd.hl7v2+xml":{source:"iana",charset:"UTF-8",compressible:!0},"application/vnd.hp-hpgl":{source:"iana",extensions:["hpgl"]},"application/vnd.hp-hpid":{source:"iana",extensions:["hpid"]},"application/vnd.hp-hps":{source:"iana",extensions:["hps"]},"application/vnd.hp-jlyt":{source:"iana",extensions:["jlt"]},"application/vnd.hp-pcl":{source:"iana",extensions:["pcl"]},"application/vnd.hp-pclxl":{source:"iana",extensions:["pclxl"]},"application/vnd.httphone":{source:"iana"},"application/vnd.hydrostatix.sof-data":{source:"iana",extensions:["sfd-hdstx"]},"application/vnd.hyper+json":{source:"iana",compressible:!0},"application/vnd.hyper-item+json":{source:"iana",compressible:!0},"application/vnd.hyperdrive+json":{source:"iana",compressible:!0},"application/vnd.hzn-3d-crossword":{source:"iana"},"application/vnd.ibm.afplinedata":{source:"iana"},"application/vnd.ibm.electronic-media":{source:"iana"},"application/vnd.ibm.minipay":{source:"iana",extensions:["mpy"]},"application/vnd.ibm.modcap":{source:"iana",extensions:["afp","listafp","list3820"]},"application/vnd.ibm.rights-management":{source:"iana",extensions:["irm"]},"application/vnd.ibm.secure-container":{source:"iana",extensions:["sc"]},"application/vnd.iccprofile":{source:"iana",extensions:["icc","icm"]},"application/vnd.ieee.1905":{source:"iana"},"application/vnd.igloader":{source:"iana",extensions:["igl"]},"application/vnd.imagemeter.folder+zip":{source:"iana",compressible:!1},"application/vnd.imagemeter.image+zip":{source:"iana",compressible:!1},"application/vnd.immervision-ivp":{source:"iana",extensions:["ivp"]},"application/vnd.immervision-ivu":{source:"iana",extensions:["ivu"]},"application/vnd.ims.imsccv1p1":{source:"iana"},"application/vnd.ims.imsccv1p2":{source:"iana"},"application/vnd.ims.imsccv1p3":{source:"iana"},"application/vnd.ims.lis.v2.result+json":{source:"iana",compressible:!0},"application/vnd.ims.lti.v2.toolconsumerprofile+json":{source:"iana",compressible:!0},"application/vnd.ims.lti.v2.toolproxy+json":{source:"iana",compressible:!0},"application/vnd.ims.lti.v2.toolproxy.id+json":{source:"iana",compressible:!0},"application/vnd.ims.lti.v2.toolsettings+json":{source:"iana",compressible:!0},"application/vnd.ims.lti.v2.toolsettings.simple+json":{source:"iana",compressible:!0},"application/vnd.informedcontrol.rms+xml":{source:"iana",compressible:!0},"application/vnd.informix-visionary":{source:"iana"},"application/vnd.infotech.project":{source:"iana"},"application/vnd.infotech.project+xml":{source:"iana",compressible:!0},"application/vnd.innopath.wamp.notification":{source:"iana"},"application/vnd.insors.igm":{source:"iana",extensions:["igm"]},"application/vnd.intercon.formnet":{source:"iana",extensions:["xpw","xpx"]},"application/vnd.intergeo":{source:"iana",extensions:["i2g"]},"application/vnd.intertrust.digibox":{source:"iana"},"application/vnd.intertrust.nncp":{source:"iana"},"application/vnd.intu.qbo":{source:"iana",extensions:["qbo"]},"application/vnd.intu.qfx":{source:"iana",extensions:["qfx"]},"application/vnd.iptc.g2.catalogitem+xml":{source:"iana",compressible:!0},"application/vnd.iptc.g2.conceptitem+xml":{source:"iana",compressible:!0},"application/vnd.iptc.g2.knowledgeitem+xml":{source:"iana",compressible:!0},"application/vnd.iptc.g2.newsitem+xml":{source:"iana",compressible:!0},"application/vnd.iptc.g2.newsmessage+xml":{source:"iana",compressible:!0},"application/vnd.iptc.g2.packageitem+xml":{source:"iana",compressible:!0},"application/vnd.iptc.g2.planningitem+xml":{source:"iana",compressible:!0},"application/vnd.ipunplugged.rcprofile":{source:"iana",extensions:["rcprofile"]},"application/vnd.irepository.package+xml":{source:"iana",compressible:!0,extensions:["irp"]},"application/vnd.is-xpr":{source:"iana",extensions:["xpr"]},"application/vnd.isac.fcs":{source:"iana",extensions:["fcs"]},"application/vnd.iso11783-10+zip":{source:"iana",compressible:!1},"application/vnd.jam":{source:"iana",extensions:["jam"]},"application/vnd.japannet-directory-service":{source:"iana"},"application/vnd.japannet-jpnstore-wakeup":{source:"iana"},"application/vnd.japannet-payment-wakeup":{source:"iana"},"application/vnd.japannet-registration":{source:"iana"},"application/vnd.japannet-registration-wakeup":{source:"iana"},"application/vnd.japannet-setstore-wakeup":{source:"iana"},"application/vnd.japannet-verification":{source:"iana"},"application/vnd.japannet-verification-wakeup":{source:"iana"},"application/vnd.jcp.javame.midlet-rms":{source:"iana",extensions:["rms"]},"application/vnd.jisp":{source:"iana",extensions:["jisp"]},"application/vnd.joost.joda-archive":{source:"iana",extensions:["joda"]},"application/vnd.jsk.isdn-ngn":{source:"iana"},"application/vnd.kahootz":{source:"iana",extensions:["ktz","ktr"]},"application/vnd.kde.karbon":{source:"iana",extensions:["karbon"]},"application/vnd.kde.kchart":{source:"iana",extensions:["chrt"]},"application/vnd.kde.kformula":{source:"iana",extensions:["kfo"]},"application/vnd.kde.kivio":{source:"iana",extensions:["flw"]},"application/vnd.kde.kontour":{source:"iana",extensions:["kon"]},"application/vnd.kde.kpresenter":{source:"iana",extensions:["kpr","kpt"]},"application/vnd.kde.kspread":{source:"iana",extensions:["ksp"]},"application/vnd.kde.kword":{source:"iana",extensions:["kwd","kwt"]},"application/vnd.kenameaapp":{source:"iana",extensions:["htke"]},"application/vnd.kidspiration":{source:"iana",extensions:["kia"]},"application/vnd.kinar":{source:"iana",extensions:["kne","knp"]},"application/vnd.koan":{source:"iana",extensions:["skp","skd","skt","skm"]},"application/vnd.kodak-descriptor":{source:"iana",extensions:["sse"]},"application/vnd.las":{source:"iana"},"application/vnd.las.las+json":{source:"iana",compressible:!0},"application/vnd.las.las+xml":{source:"iana",compressible:!0,extensions:["lasxml"]},"application/vnd.laszip":{source:"iana"},"application/vnd.leap+json":{source:"iana",compressible:!0},"application/vnd.liberty-request+xml":{source:"iana",compressible:!0},"application/vnd.llamagraphics.life-balance.desktop":{source:"iana",extensions:["lbd"]},"application/vnd.llamagraphics.life-balance.exchange+xml":{source:"iana",compressible:!0,extensions:["lbe"]},"application/vnd.logipipe.circuit+zip":{source:"iana",compressible:!1},"application/vnd.loom":{source:"iana"},"application/vnd.lotus-1-2-3":{source:"iana",extensions:["123"]},"application/vnd.lotus-approach":{source:"iana",extensions:["apr"]},"application/vnd.lotus-freelance":{source:"iana",extensions:["pre"]},"application/vnd.lotus-notes":{source:"iana",extensions:["nsf"]},"application/vnd.lotus-organizer":{source:"iana",extensions:["org"]},"application/vnd.lotus-screencam":{source:"iana",extensions:["scm"]},"application/vnd.lotus-wordpro":{source:"iana",extensions:["lwp"]},"application/vnd.macports.portpkg":{source:"iana",extensions:["portpkg"]},"application/vnd.mapbox-vector-tile":{source:"iana",extensions:["mvt"]},"application/vnd.marlin.drm.actiontoken+xml":{source:"iana",compressible:!0},"application/vnd.marlin.drm.conftoken+xml":{source:"iana",compressible:!0},"application/vnd.marlin.drm.license+xml":{source:"iana",compressible:!0},"application/vnd.marlin.drm.mdcf":{source:"iana"},"application/vnd.mason+json":{source:"iana",compressible:!0},"application/vnd.maxar.archive.3tz+zip":{source:"iana",compressible:!1},"application/vnd.maxmind.maxmind-db":{source:"iana"},"application/vnd.mcd":{source:"iana",extensions:["mcd"]},"application/vnd.medcalcdata":{source:"iana",extensions:["mc1"]},"application/vnd.mediastation.cdkey":{source:"iana",extensions:["cdkey"]},"application/vnd.meridian-slingshot":{source:"iana"},"application/vnd.mfer":{source:"iana",extensions:["mwf"]},"application/vnd.mfmp":{source:"iana",extensions:["mfm"]},"application/vnd.micro+json":{source:"iana",compressible:!0},"application/vnd.micrografx.flo":{source:"iana",extensions:["flo"]},"application/vnd.micrografx.igx":{source:"iana",extensions:["igx"]},"application/vnd.microsoft.portable-executable":{source:"iana"},"application/vnd.microsoft.windows.thumbnail-cache":{source:"iana"},"application/vnd.miele+json":{source:"iana",compressible:!0},"application/vnd.mif":{source:"iana",extensions:["mif"]},"application/vnd.minisoft-hp3000-save":{source:"iana"},"application/vnd.mitsubishi.misty-guard.trustweb":{source:"iana"},"application/vnd.mobius.daf":{source:"iana",extensions:["daf"]},"application/vnd.mobius.dis":{source:"iana",extensions:["dis"]},"application/vnd.mobius.mbk":{source:"iana",extensions:["mbk"]},"application/vnd.mobius.mqy":{source:"iana",extensions:["mqy"]},"application/vnd.mobius.msl":{source:"iana",extensions:["msl"]},"application/vnd.mobius.plc":{source:"iana",extensions:["plc"]},"application/vnd.mobius.txf":{source:"iana",extensions:["txf"]},"application/vnd.mophun.application":{source:"iana",extensions:["mpn"]},"application/vnd.mophun.certificate":{source:"iana",extensions:["mpc"]},"application/vnd.motorola.flexsuite":{source:"iana"},"application/vnd.motorola.flexsuite.adsi":{source:"iana"},"application/vnd.motorola.flexsuite.fis":{source:"iana"},"application/vnd.motorola.flexsuite.gotap":{source:"iana"},"application/vnd.motorola.flexsuite.kmr":{source:"iana"},"application/vnd.motorola.flexsuite.ttc":{source:"iana"},"application/vnd.motorola.flexsuite.wem":{source:"iana"},"application/vnd.motorola.iprm":{source:"iana"},"application/vnd.mozilla.xul+xml":{source:"iana",compressible:!0,extensions:["xul"]},"application/vnd.ms-3mfdocument":{source:"iana"},"application/vnd.ms-artgalry":{source:"iana",extensions:["cil"]},"application/vnd.ms-asf":{source:"iana"},"application/vnd.ms-cab-compressed":{source:"iana",extensions:["cab"]},"application/vnd.ms-color.iccprofile":{source:"apache"},"application/vnd.ms-excel":{source:"iana",compressible:!1,extensions:["xls","xlm","xla","xlc","xlt","xlw"]},"application/vnd.ms-excel.addin.macroenabled.12":{source:"iana",extensions:["xlam"]},"application/vnd.ms-excel.sheet.binary.macroenabled.12":{source:"iana",extensions:["xlsb"]},"application/vnd.ms-excel.sheet.macroenabled.12":{source:"iana",extensions:["xlsm"]},"application/vnd.ms-excel.template.macroenabled.12":{source:"iana",extensions:["xltm"]},"application/vnd.ms-fontobject":{source:"iana",compressible:!0,extensions:["eot"]},"application/vnd.ms-htmlhelp":{source:"iana",extensions:["chm"]},"application/vnd.ms-ims":{source:"iana",extensions:["ims"]},"application/vnd.ms-lrm":{source:"iana",extensions:["lrm"]},"application/vnd.ms-office.activex+xml":{source:"iana",compressible:!0},"application/vnd.ms-officetheme":{source:"iana",extensions:["thmx"]},"application/vnd.ms-opentype":{source:"apache",compressible:!0},"application/vnd.ms-outlook":{compressible:!1,extensions:["msg"]},"application/vnd.ms-package.obfuscated-opentype":{source:"apache"},"application/vnd.ms-pki.seccat":{source:"apache",extensions:["cat"]},"application/vnd.ms-pki.stl":{source:"apache",extensions:["stl"]},"application/vnd.ms-playready.initiator+xml":{source:"iana",compressible:!0},"application/vnd.ms-powerpoint":{source:"iana",compressible:!1,extensions:["ppt","pps","pot"]},"application/vnd.ms-powerpoint.addin.macroenabled.12":{source:"iana",extensions:["ppam"]},"application/vnd.ms-powerpoint.presentation.macroenabled.12":{source:"iana",extensions:["pptm"]},"application/vnd.ms-powerpoint.slide.macroenabled.12":{source:"iana",extensions:["sldm"]},"application/vnd.ms-powerpoint.slideshow.macroenabled.12":{source:"iana",extensions:["ppsm"]},"application/vnd.ms-powerpoint.template.macroenabled.12":{source:"iana",extensions:["potm"]},"application/vnd.ms-printdevicecapabilities+xml":{source:"iana",compressible:!0},"application/vnd.ms-printing.printticket+xml":{source:"apache",compressible:!0},"application/vnd.ms-printschematicket+xml":{source:"iana",compressible:!0},"application/vnd.ms-project":{source:"iana",extensions:["mpp","mpt"]},"application/vnd.ms-tnef":{source:"iana"},"application/vnd.ms-windows.devicepairing":{source:"iana"},"application/vnd.ms-windows.nwprinting.oob":{source:"iana"},"application/vnd.ms-windows.printerpairing":{source:"iana"},"application/vnd.ms-windows.wsd.oob":{source:"iana"},"application/vnd.ms-wmdrm.lic-chlg-req":{source:"iana"},"application/vnd.ms-wmdrm.lic-resp":{source:"iana"},"application/vnd.ms-wmdrm.meter-chlg-req":{source:"iana"},"application/vnd.ms-wmdrm.meter-resp":{source:"iana"},"application/vnd.ms-word.document.macroenabled.12":{source:"iana",extensions:["docm"]},"application/vnd.ms-word.template.macroenabled.12":{source:"iana",extensions:["dotm"]},"application/vnd.ms-works":{source:"iana",extensions:["wps","wks","wcm","wdb"]},"application/vnd.ms-wpl":{source:"iana",extensions:["wpl"]},"application/vnd.ms-xpsdocument":{source:"iana",compressible:!1,extensions:["xps"]},"application/vnd.msa-disk-image":{source:"iana"},"application/vnd.mseq":{source:"iana",extensions:["mseq"]},"application/vnd.msign":{source:"iana"},"application/vnd.multiad.creator":{source:"iana"},"application/vnd.multiad.creator.cif":{source:"iana"},"application/vnd.music-niff":{source:"iana"},"application/vnd.musician":{source:"iana",extensions:["mus"]},"application/vnd.muvee.style":{source:"iana",extensions:["msty"]},"application/vnd.mynfc":{source:"iana",extensions:["taglet"]},"application/vnd.nacamar.ybrid+json":{source:"iana",compressible:!0},"application/vnd.ncd.control":{source:"iana"},"application/vnd.ncd.reference":{source:"iana"},"application/vnd.nearst.inv+json":{source:"iana",compressible:!0},"application/vnd.nebumind.line":{source:"iana"},"application/vnd.nervana":{source:"iana"},"application/vnd.netfpx":{source:"iana"},"application/vnd.neurolanguage.nlu":{source:"iana",extensions:["nlu"]},"application/vnd.nimn":{source:"iana"},"application/vnd.nintendo.nitro.rom":{source:"iana"},"application/vnd.nintendo.snes.rom":{source:"iana"},"application/vnd.nitf":{source:"iana",extensions:["ntf","nitf"]},"application/vnd.noblenet-directory":{source:"iana",extensions:["nnd"]},"application/vnd.noblenet-sealer":{source:"iana",extensions:["nns"]},"application/vnd.noblenet-web":{source:"iana",extensions:["nnw"]},"application/vnd.nokia.catalogs":{source:"iana"},"application/vnd.nokia.conml+wbxml":{source:"iana"},"application/vnd.nokia.conml+xml":{source:"iana",compressible:!0},"application/vnd.nokia.iptv.config+xml":{source:"iana",compressible:!0},"application/vnd.nokia.isds-radio-presets":{source:"iana"},"application/vnd.nokia.landmark+wbxml":{source:"iana"},"application/vnd.nokia.landmark+xml":{source:"iana",compressible:!0},"application/vnd.nokia.landmarkcollection+xml":{source:"iana",compressible:!0},"application/vnd.nokia.n-gage.ac+xml":{source:"iana",compressible:!0,extensions:["ac"]},"application/vnd.nokia.n-gage.data":{source:"iana",extensions:["ngdat"]},"application/vnd.nokia.n-gage.symbian.install":{source:"iana",extensions:["n-gage"]},"application/vnd.nokia.ncd":{source:"iana"},"application/vnd.nokia.pcd+wbxml":{source:"iana"},"application/vnd.nokia.pcd+xml":{source:"iana",compressible:!0},"application/vnd.nokia.radio-preset":{source:"iana",extensions:["rpst"]},"application/vnd.nokia.radio-presets":{source:"iana",extensions:["rpss"]},"application/vnd.novadigm.edm":{source:"iana",extensions:["edm"]},"application/vnd.novadigm.edx":{source:"iana",extensions:["edx"]},"application/vnd.novadigm.ext":{source:"iana",extensions:["ext"]},"application/vnd.ntt-local.content-share":{source:"iana"},"application/vnd.ntt-local.file-transfer":{source:"iana"},"application/vnd.ntt-local.ogw_remote-access":{source:"iana"},"application/vnd.ntt-local.sip-ta_remote":{source:"iana"},"application/vnd.ntt-local.sip-ta_tcp_stream":{source:"iana"},"application/vnd.oasis.opendocument.chart":{source:"iana",extensions:["odc"]},"application/vnd.oasis.opendocument.chart-template":{source:"iana",extensions:["otc"]},"application/vnd.oasis.opendocument.database":{source:"iana",extensions:["odb"]},"application/vnd.oasis.opendocument.formula":{source:"iana",extensions:["odf"]},"application/vnd.oasis.opendocument.formula-template":{source:"iana",extensions:["odft"]},"application/vnd.oasis.opendocument.graphics":{source:"iana",compressible:!1,extensions:["odg"]},"application/vnd.oasis.opendocument.graphics-template":{source:"iana",extensions:["otg"]},"application/vnd.oasis.opendocument.image":{source:"iana",extensions:["odi"]},"application/vnd.oasis.opendocument.image-template":{source:"iana",extensions:["oti"]},"application/vnd.oasis.opendocument.presentation":{source:"iana",compressible:!1,extensions:["odp"]},"application/vnd.oasis.opendocument.presentation-template":{source:"iana",extensions:["otp"]},"application/vnd.oasis.opendocument.spreadsheet":{source:"iana",compressible:!1,extensions:["ods"]},"application/vnd.oasis.opendocument.spreadsheet-template":{source:"iana",extensions:["ots"]},"application/vnd.oasis.opendocument.text":{source:"iana",compressible:!1,extensions:["odt"]},"application/vnd.oasis.opendocument.text-master":{source:"iana",extensions:["odm"]},"application/vnd.oasis.opendocument.text-template":{source:"iana",extensions:["ott"]},"application/vnd.oasis.opendocument.text-web":{source:"iana",extensions:["oth"]},"application/vnd.obn":{source:"iana"},"application/vnd.ocf+cbor":{source:"iana"},"application/vnd.oci.image.manifest.v1+json":{source:"iana",compressible:!0},"application/vnd.oftn.l10n+json":{source:"iana",compressible:!0},"application/vnd.oipf.contentaccessdownload+xml":{source:"iana",compressible:!0},"application/vnd.oipf.contentaccessstreaming+xml":{source:"iana",compressible:!0},"application/vnd.oipf.cspg-hexbinary":{source:"iana"},"application/vnd.oipf.dae.svg+xml":{source:"iana",compressible:!0},"application/vnd.oipf.dae.xhtml+xml":{source:"iana",compressible:!0},"application/vnd.oipf.mippvcontrolmessage+xml":{source:"iana",compressible:!0},"application/vnd.oipf.pae.gem":{source:"iana"},"application/vnd.oipf.spdiscovery+xml":{source:"iana",compressible:!0},"application/vnd.oipf.spdlist+xml":{source:"iana",compressible:!0},"application/vnd.oipf.ueprofile+xml":{source:"iana",compressible:!0},"application/vnd.oipf.userprofile+xml":{source:"iana",compressible:!0},"application/vnd.olpc-sugar":{source:"iana",extensions:["xo"]},"application/vnd.oma-scws-config":{source:"iana"},"application/vnd.oma-scws-http-request":{source:"iana"},"application/vnd.oma-scws-http-response":{source:"iana"},"application/vnd.oma.bcast.associated-procedure-parameter+xml":{source:"iana",compressible:!0},"application/vnd.oma.bcast.drm-trigger+xml":{source:"iana",compressible:!0},"application/vnd.oma.bcast.imd+xml":{source:"iana",compressible:!0},"application/vnd.oma.bcast.ltkm":{source:"iana"},"application/vnd.oma.bcast.notification+xml":{source:"iana",compressible:!0},"application/vnd.oma.bcast.provisioningtrigger":{source:"iana"},"application/vnd.oma.bcast.sgboot":{source:"iana"},"application/vnd.oma.bcast.sgdd+xml":{source:"iana",compressible:!0},"application/vnd.oma.bcast.sgdu":{source:"iana"},"application/vnd.oma.bcast.simple-symbol-container":{source:"iana"},"application/vnd.oma.bcast.smartcard-trigger+xml":{source:"iana",compressible:!0},"application/vnd.oma.bcast.sprov+xml":{source:"iana",compressible:!0},"application/vnd.oma.bcast.stkm":{source:"iana"},"application/vnd.oma.cab-address-book+xml":{source:"iana",compressible:!0},"application/vnd.oma.cab-feature-handler+xml":{source:"iana",compressible:!0},"application/vnd.oma.cab-pcc+xml":{source:"iana",compressible:!0},"application/vnd.oma.cab-subs-invite+xml":{source:"iana",compressible:!0},"application/vnd.oma.cab-user-prefs+xml":{source:"iana",compressible:!0},"application/vnd.oma.dcd":{source:"iana"},"application/vnd.oma.dcdc":{source:"iana"},"application/vnd.oma.dd2+xml":{source:"iana",compressible:!0,extensions:["dd2"]},"application/vnd.oma.drm.risd+xml":{source:"iana",compressible:!0},"application/vnd.oma.group-usage-list+xml":{source:"iana",compressible:!0},"application/vnd.oma.lwm2m+cbor":{source:"iana"},"application/vnd.oma.lwm2m+json":{source:"iana",compressible:!0},"application/vnd.oma.lwm2m+tlv":{source:"iana"},"application/vnd.oma.pal+xml":{source:"iana",compressible:!0},"application/vnd.oma.poc.detailed-progress-report+xml":{source:"iana",compressible:!0},"application/vnd.oma.poc.final-report+xml":{source:"iana",compressible:!0},"application/vnd.oma.poc.groups+xml":{source:"iana",compressible:!0},"application/vnd.oma.poc.invocation-descriptor+xml":{source:"iana",compressible:!0},"application/vnd.oma.poc.optimized-progress-report+xml":{source:"iana",compressible:!0},"application/vnd.oma.push":{source:"iana"},"application/vnd.oma.scidm.messages+xml":{source:"iana",compressible:!0},"application/vnd.oma.xcap-directory+xml":{source:"iana",compressible:!0},"application/vnd.omads-email+xml":{source:"iana",charset:"UTF-8",compressible:!0},"application/vnd.omads-file+xml":{source:"iana",charset:"UTF-8",compressible:!0},"application/vnd.omads-folder+xml":{source:"iana",charset:"UTF-8",compressible:!0},"application/vnd.omaloc-supl-init":{source:"iana"},"application/vnd.onepager":{source:"iana"},"application/vnd.onepagertamp":{source:"iana"},"application/vnd.onepagertamx":{source:"iana"},"application/vnd.onepagertat":{source:"iana"},"application/vnd.onepagertatp":{source:"iana"},"application/vnd.onepagertatx":{source:"iana"},"application/vnd.openblox.game+xml":{source:"iana",compressible:!0,extensions:["obgx"]},"application/vnd.openblox.game-binary":{source:"iana"},"application/vnd.openeye.oeb":{source:"iana"},"application/vnd.openofficeorg.extension":{source:"apache",extensions:["oxt"]},"application/vnd.openstreetmap.data+xml":{source:"iana",compressible:!0,extensions:["osm"]},"application/vnd.opentimestamps.ots":{source:"iana"},"application/vnd.openxmlformats-officedocument.custom-properties+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.customxmlproperties+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.drawing+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.drawingml.chart+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.drawingml.chartshapes+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.drawingml.diagramcolors+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.drawingml.diagramdata+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.drawingml.diagramlayout+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.drawingml.diagramstyle+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.extended-properties+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.presentationml.commentauthors+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.presentationml.comments+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.presentationml.handoutmaster+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.presentationml.notesmaster+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.presentationml.notesslide+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.presentationml.presentation":{source:"iana",compressible:!1,extensions:["pptx"]},"application/vnd.openxmlformats-officedocument.presentationml.presentation.main+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.presentationml.presprops+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.presentationml.slide":{source:"iana",extensions:["sldx"]},"application/vnd.openxmlformats-officedocument.presentationml.slide+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.presentationml.slidelayout+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.presentationml.slidemaster+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.presentationml.slideshow":{source:"iana",extensions:["ppsx"]},"application/vnd.openxmlformats-officedocument.presentationml.slideshow.main+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.presentationml.slideupdateinfo+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.presentationml.tablestyles+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.presentationml.tags+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.presentationml.template":{source:"iana",extensions:["potx"]},"application/vnd.openxmlformats-officedocument.presentationml.template.main+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.presentationml.viewprops+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.spreadsheetml.calcchain+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.spreadsheetml.chartsheet+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.spreadsheetml.comments+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.spreadsheetml.connections+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.spreadsheetml.dialogsheet+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.spreadsheetml.externallink+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.spreadsheetml.pivotcachedefinition+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.spreadsheetml.pivotcacherecords+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.spreadsheetml.pivottable+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.spreadsheetml.querytable+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.spreadsheetml.revisionheaders+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.spreadsheetml.revisionlog+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.spreadsheetml.sharedstrings+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet":{source:"iana",compressible:!1,extensions:["xlsx"]},"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet.main+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.spreadsheetml.sheetmetadata+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.spreadsheetml.styles+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.spreadsheetml.table+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.spreadsheetml.tablesinglecells+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.spreadsheetml.template":{source:"iana",extensions:["xltx"]},"application/vnd.openxmlformats-officedocument.spreadsheetml.template.main+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.spreadsheetml.usernames+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.spreadsheetml.volatiledependencies+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.spreadsheetml.worksheet+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.theme+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.themeoverride+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.vmldrawing":{source:"iana"},"application/vnd.openxmlformats-officedocument.wordprocessingml.comments+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.wordprocessingml.document":{source:"iana",compressible:!1,extensions:["docx"]},"application/vnd.openxmlformats-officedocument.wordprocessingml.document.glossary+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.wordprocessingml.document.main+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.wordprocessingml.endnotes+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.wordprocessingml.fonttable+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.wordprocessingml.footer+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.wordprocessingml.footnotes+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.wordprocessingml.numbering+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.wordprocessingml.settings+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.wordprocessingml.styles+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.wordprocessingml.template":{source:"iana",extensions:["dotx"]},"application/vnd.openxmlformats-officedocument.wordprocessingml.template.main+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.wordprocessingml.websettings+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-package.core-properties+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-package.digital-signature-xmlsignature+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-package.relationships+xml":{source:"iana",compressible:!0},"application/vnd.oracle.resource+json":{source:"iana",compressible:!0},"application/vnd.orange.indata":{source:"iana"},"application/vnd.osa.netdeploy":{source:"iana"},"application/vnd.osgeo.mapguide.package":{source:"iana",extensions:["mgp"]},"application/vnd.osgi.bundle":{source:"iana"},"application/vnd.osgi.dp":{source:"iana",extensions:["dp"]},"application/vnd.osgi.subsystem":{source:"iana",extensions:["esa"]},"application/vnd.otps.ct-kip+xml":{source:"iana",compressible:!0},"application/vnd.oxli.countgraph":{source:"iana"},"application/vnd.pagerduty+json":{source:"iana",compressible:!0},"application/vnd.palm":{source:"iana",extensions:["pdb","pqa","oprc"]},"application/vnd.panoply":{source:"iana"},"application/vnd.paos.xml":{source:"iana"},"application/vnd.patentdive":{source:"iana"},"application/vnd.patientecommsdoc":{source:"iana"},"application/vnd.pawaafile":{source:"iana",extensions:["paw"]},"application/vnd.pcos":{source:"iana"},"application/vnd.pg.format":{source:"iana",extensions:["str"]},"application/vnd.pg.osasli":{source:"iana",extensions:["ei6"]},"application/vnd.piaccess.application-licence":{source:"iana"},"application/vnd.picsel":{source:"iana",extensions:["efif"]},"application/vnd.pmi.widget":{source:"iana",extensions:["wg"]},"application/vnd.poc.group-advertisement+xml":{source:"iana",compressible:!0},"application/vnd.pocketlearn":{source:"iana",extensions:["plf"]},"application/vnd.powerbuilder6":{source:"iana",extensions:["pbd"]},"application/vnd.powerbuilder6-s":{source:"iana"},"application/vnd.powerbuilder7":{source:"iana"},"application/vnd.powerbuilder7-s":{source:"iana"},"application/vnd.powerbuilder75":{source:"iana"},"application/vnd.powerbuilder75-s":{source:"iana"},"application/vnd.preminet":{source:"iana"},"application/vnd.previewsystems.box":{source:"iana",extensions:["box"]},"application/vnd.proteus.magazine":{source:"iana",extensions:["mgz"]},"application/vnd.psfs":{source:"iana"},"application/vnd.publishare-delta-tree":{source:"iana",extensions:["qps"]},"application/vnd.pvi.ptid1":{source:"iana",extensions:["ptid"]},"application/vnd.pwg-multiplexed":{source:"iana"},"application/vnd.pwg-xhtml-print+xml":{source:"iana",compressible:!0},"application/vnd.qualcomm.brew-app-res":{source:"iana"},"application/vnd.quarantainenet":{source:"iana"},"application/vnd.quark.quarkxpress":{source:"iana",extensions:["qxd","qxt","qwd","qwt","qxl","qxb"]},"application/vnd.quobject-quoxdocument":{source:"iana"},"application/vnd.radisys.moml+xml":{source:"iana",compressible:!0},"application/vnd.radisys.msml+xml":{source:"iana",compressible:!0},"application/vnd.radisys.msml-audit+xml":{source:"iana",compressible:!0},"application/vnd.radisys.msml-audit-conf+xml":{source:"iana",compressible:!0},"application/vnd.radisys.msml-audit-conn+xml":{source:"iana",compressible:!0},"application/vnd.radisys.msml-audit-dialog+xml":{source:"iana",compressible:!0},"application/vnd.radisys.msml-audit-stream+xml":{source:"iana",compressible:!0},"application/vnd.radisys.msml-conf+xml":{source:"iana",compressible:!0},"application/vnd.radisys.msml-dialog+xml":{source:"iana",compressible:!0},"application/vnd.radisys.msml-dialog-base+xml":{source:"iana",compressible:!0},"application/vnd.radisys.msml-dialog-fax-detect+xml":{source:"iana",compressible:!0},"application/vnd.radisys.msml-dialog-fax-sendrecv+xml":{source:"iana",compressible:!0},"application/vnd.radisys.msml-dialog-group+xml":{source:"iana",compressible:!0},"application/vnd.radisys.msml-dialog-speech+xml":{source:"iana",compressible:!0},"application/vnd.radisys.msml-dialog-transform+xml":{source:"iana",compressible:!0},"application/vnd.rainstor.data":{source:"iana"},"application/vnd.rapid":{source:"iana"},"application/vnd.rar":{source:"iana",extensions:["rar"]},"application/vnd.realvnc.bed":{source:"iana",extensions:["bed"]},"application/vnd.recordare.musicxml":{source:"iana",extensions:["mxl"]},"application/vnd.recordare.musicxml+xml":{source:"iana",compressible:!0,extensions:["musicxml"]},"application/vnd.renlearn.rlprint":{source:"iana"},"application/vnd.resilient.logic":{source:"iana"},"application/vnd.restful+json":{source:"iana",compressible:!0},"application/vnd.rig.cryptonote":{source:"iana",extensions:["cryptonote"]},"application/vnd.rim.cod":{source:"apache",extensions:["cod"]},"application/vnd.rn-realmedia":{source:"apache",extensions:["rm"]},"application/vnd.rn-realmedia-vbr":{source:"apache",extensions:["rmvb"]},"application/vnd.route66.link66+xml":{source:"iana",compressible:!0,extensions:["link66"]},"application/vnd.rs-274x":{source:"iana"},"application/vnd.ruckus.download":{source:"iana"},"application/vnd.s3sms":{source:"iana"},"application/vnd.sailingtracker.track":{source:"iana",extensions:["st"]},"application/vnd.sar":{source:"iana"},"application/vnd.sbm.cid":{source:"iana"},"application/vnd.sbm.mid2":{source:"iana"},"application/vnd.scribus":{source:"iana"},"application/vnd.sealed.3df":{source:"iana"},"application/vnd.sealed.csf":{source:"iana"},"application/vnd.sealed.doc":{source:"iana"},"application/vnd.sealed.eml":{source:"iana"},"application/vnd.sealed.mht":{source:"iana"},"application/vnd.sealed.net":{source:"iana"},"application/vnd.sealed.ppt":{source:"iana"},"application/vnd.sealed.tiff":{source:"iana"},"application/vnd.sealed.xls":{source:"iana"},"application/vnd.sealedmedia.softseal.html":{source:"iana"},"application/vnd.sealedmedia.softseal.pdf":{source:"iana"},"application/vnd.seemail":{source:"iana",extensions:["see"]},"application/vnd.seis+json":{source:"iana",compressible:!0},"application/vnd.sema":{source:"iana",extensions:["sema"]},"application/vnd.semd":{source:"iana",extensions:["semd"]},"application/vnd.semf":{source:"iana",extensions:["semf"]},"application/vnd.shade-save-file":{source:"iana"},"application/vnd.shana.informed.formdata":{source:"iana",extensions:["ifm"]},"application/vnd.shana.informed.formtemplate":{source:"iana",extensions:["itp"]},"application/vnd.shana.informed.interchange":{source:"iana",extensions:["iif"]},"application/vnd.shana.informed.package":{source:"iana",extensions:["ipk"]},"application/vnd.shootproof+json":{source:"iana",compressible:!0},"application/vnd.shopkick+json":{source:"iana",compressible:!0},"application/vnd.shp":{source:"iana"},"application/vnd.shx":{source:"iana"},"application/vnd.sigrok.session":{source:"iana"},"application/vnd.simtech-mindmapper":{source:"iana",extensions:["twd","twds"]},"application/vnd.siren+json":{source:"iana",compressible:!0},"application/vnd.smaf":{source:"iana",extensions:["mmf"]},"application/vnd.smart.notebook":{source:"iana"},"application/vnd.smart.teacher":{source:"iana",extensions:["teacher"]},"application/vnd.snesdev-page-table":{source:"iana"},"application/vnd.software602.filler.form+xml":{source:"iana",compressible:!0,extensions:["fo"]},"application/vnd.software602.filler.form-xml-zip":{source:"iana"},"application/vnd.solent.sdkm+xml":{source:"iana",compressible:!0,extensions:["sdkm","sdkd"]},"application/vnd.spotfire.dxp":{source:"iana",extensions:["dxp"]},"application/vnd.spotfire.sfs":{source:"iana",extensions:["sfs"]},"application/vnd.sqlite3":{source:"iana"},"application/vnd.sss-cod":{source:"iana"},"application/vnd.sss-dtf":{source:"iana"},"application/vnd.sss-ntf":{source:"iana"},"application/vnd.stardivision.calc":{source:"apache",extensions:["sdc"]},"application/vnd.stardivision.draw":{source:"apache",extensions:["sda"]},"application/vnd.stardivision.impress":{source:"apache",extensions:["sdd"]},"application/vnd.stardivision.math":{source:"apache",extensions:["smf"]},"application/vnd.stardivision.writer":{source:"apache",extensions:["sdw","vor"]},"application/vnd.stardivision.writer-global":{source:"apache",extensions:["sgl"]},"application/vnd.stepmania.package":{source:"iana",extensions:["smzip"]},"application/vnd.stepmania.stepchart":{source:"iana",extensions:["sm"]},"application/vnd.street-stream":{source:"iana"},"application/vnd.sun.wadl+xml":{source:"iana",compressible:!0,extensions:["wadl"]},"application/vnd.sun.xml.calc":{source:"apache",extensions:["sxc"]},"application/vnd.sun.xml.calc.template":{source:"apache",extensions:["stc"]},"application/vnd.sun.xml.draw":{source:"apache",extensions:["sxd"]},"application/vnd.sun.xml.draw.template":{source:"apache",extensions:["std"]},"application/vnd.sun.xml.impress":{source:"apache",extensions:["sxi"]},"application/vnd.sun.xml.impress.template":{source:"apache",extensions:["sti"]},"application/vnd.sun.xml.math":{source:"apache",extensions:["sxm"]},"application/vnd.sun.xml.writer":{source:"apache",extensions:["sxw"]},"application/vnd.sun.xml.writer.global":{source:"apache",extensions:["sxg"]},"application/vnd.sun.xml.writer.template":{source:"apache",extensions:["stw"]},"application/vnd.sus-calendar":{source:"iana",extensions:["sus","susp"]},"application/vnd.svd":{source:"iana",extensions:["svd"]},"application/vnd.swiftview-ics":{source:"iana"},"application/vnd.sycle+xml":{source:"iana",compressible:!0},"application/vnd.syft+json":{source:"iana",compressible:!0},"application/vnd.symbian.install":{source:"apache",extensions:["sis","sisx"]},"application/vnd.syncml+xml":{source:"iana",charset:"UTF-8",compressible:!0,extensions:["xsm"]},"application/vnd.syncml.dm+wbxml":{source:"iana",charset:"UTF-8",extensions:["bdm"]},"application/vnd.syncml.dm+xml":{source:"iana",charset:"UTF-8",compressible:!0,extensions:["xdm"]},"application/vnd.syncml.dm.notification":{source:"iana"},"application/vnd.syncml.dmddf+wbxml":{source:"iana"},"application/vnd.syncml.dmddf+xml":{source:"iana",charset:"UTF-8",compressible:!0,extensions:["ddf"]},"application/vnd.syncml.dmtnds+wbxml":{source:"iana"},"application/vnd.syncml.dmtnds+xml":{source:"iana",charset:"UTF-8",compressible:!0},"application/vnd.syncml.ds.notification":{source:"iana"},"application/vnd.tableschema+json":{source:"iana",compressible:!0},"application/vnd.tao.intent-module-archive":{source:"iana",extensions:["tao"]},"application/vnd.tcpdump.pcap":{source:"iana",extensions:["pcap","cap","dmp"]},"application/vnd.think-cell.ppttc+json":{source:"iana",compressible:!0},"application/vnd.tmd.mediaflex.api+xml":{source:"iana",compressible:!0},"application/vnd.tml":{source:"iana"},"application/vnd.tmobile-livetv":{source:"iana",extensions:["tmo"]},"application/vnd.tri.onesource":{source:"iana"},"application/vnd.trid.tpt":{source:"iana",extensions:["tpt"]},"application/vnd.triscape.mxs":{source:"iana",extensions:["mxs"]},"application/vnd.trueapp":{source:"iana",extensions:["tra"]},"application/vnd.truedoc":{source:"iana"},"application/vnd.ubisoft.webplayer":{source:"iana"},"application/vnd.ufdl":{source:"iana",extensions:["ufd","ufdl"]},"application/vnd.uiq.theme":{source:"iana",extensions:["utz"]},"application/vnd.umajin":{source:"iana",extensions:["umj"]},"application/vnd.unity":{source:"iana",extensions:["unityweb"]},"application/vnd.uoml+xml":{source:"iana",compressible:!0,extensions:["uoml"]},"application/vnd.uplanet.alert":{source:"iana"},"application/vnd.uplanet.alert-wbxml":{source:"iana"},"application/vnd.uplanet.bearer-choice":{source:"iana"},"application/vnd.uplanet.bearer-choice-wbxml":{source:"iana"},"application/vnd.uplanet.cacheop":{source:"iana"},"application/vnd.uplanet.cacheop-wbxml":{source:"iana"},"application/vnd.uplanet.channel":{source:"iana"},"application/vnd.uplanet.channel-wbxml":{source:"iana"},"application/vnd.uplanet.list":{source:"iana"},"application/vnd.uplanet.list-wbxml":{source:"iana"},"application/vnd.uplanet.listcmd":{source:"iana"},"application/vnd.uplanet.listcmd-wbxml":{source:"iana"},"application/vnd.uplanet.signal":{source:"iana"},"application/vnd.uri-map":{source:"iana"},"application/vnd.valve.source.material":{source:"iana"},"application/vnd.vcx":{source:"iana",extensions:["vcx"]},"application/vnd.vd-study":{source:"iana"},"application/vnd.vectorworks":{source:"iana"},"application/vnd.vel+json":{source:"iana",compressible:!0},"application/vnd.verimatrix.vcas":{source:"iana"},"application/vnd.veritone.aion+json":{source:"iana",compressible:!0},"application/vnd.veryant.thin":{source:"iana"},"application/vnd.ves.encrypted":{source:"iana"},"application/vnd.vidsoft.vidconference":{source:"iana"},"application/vnd.visio":{source:"iana",extensions:["vsd","vst","vss","vsw"]},"application/vnd.visionary":{source:"iana",extensions:["vis"]},"application/vnd.vividence.scriptfile":{source:"iana"},"application/vnd.vsf":{source:"iana",extensions:["vsf"]},"application/vnd.wap.sic":{source:"iana"},"application/vnd.wap.slc":{source:"iana"},"application/vnd.wap.wbxml":{source:"iana",charset:"UTF-8",extensions:["wbxml"]},"application/vnd.wap.wmlc":{source:"iana",extensions:["wmlc"]},"application/vnd.wap.wmlscriptc":{source:"iana",extensions:["wmlsc"]},"application/vnd.webturbo":{source:"iana",extensions:["wtb"]},"application/vnd.wfa.dpp":{source:"iana"},"application/vnd.wfa.p2p":{source:"iana"},"application/vnd.wfa.wsc":{source:"iana"},"application/vnd.windows.devicepairing":{source:"iana"},"application/vnd.wmc":{source:"iana"},"application/vnd.wmf.bootstrap":{source:"iana"},"application/vnd.wolfram.mathematica":{source:"iana"},"application/vnd.wolfram.mathematica.package":{source:"iana"},"application/vnd.wolfram.player":{source:"iana",extensions:["nbp"]},"application/vnd.wordperfect":{source:"iana",extensions:["wpd"]},"application/vnd.wqd":{source:"iana",extensions:["wqd"]},"application/vnd.wrq-hp3000-labelled":{source:"iana"},"application/vnd.wt.stf":{source:"iana",extensions:["stf"]},"application/vnd.wv.csp+wbxml":{source:"iana"},"application/vnd.wv.csp+xml":{source:"iana",compressible:!0},"application/vnd.wv.ssp+xml":{source:"iana",compressible:!0},"application/vnd.xacml+json":{source:"iana",compressible:!0},"application/vnd.xara":{source:"iana",extensions:["xar"]},"application/vnd.xfdl":{source:"iana",extensions:["xfdl"]},"application/vnd.xfdl.webform":{source:"iana"},"application/vnd.xmi+xml":{source:"iana",compressible:!0},"application/vnd.xmpie.cpkg":{source:"iana"},"application/vnd.xmpie.dpkg":{source:"iana"},"application/vnd.xmpie.plan":{source:"iana"},"application/vnd.xmpie.ppkg":{source:"iana"},"application/vnd.xmpie.xlim":{source:"iana"},"application/vnd.yamaha.hv-dic":{source:"iana",extensions:["hvd"]},"application/vnd.yamaha.hv-script":{source:"iana",extensions:["hvs"]},"application/vnd.yamaha.hv-voice":{source:"iana",extensions:["hvp"]},"application/vnd.yamaha.openscoreformat":{source:"iana",extensions:["osf"]},"application/vnd.yamaha.openscoreformat.osfpvg+xml":{source:"iana",compressible:!0,extensions:["osfpvg"]},"application/vnd.yamaha.remote-setup":{source:"iana"},"application/vnd.yamaha.smaf-audio":{source:"iana",extensions:["saf"]},"application/vnd.yamaha.smaf-phrase":{source:"iana",extensions:["spf"]},"application/vnd.yamaha.through-ngn":{source:"iana"},"application/vnd.yamaha.tunnel-udpencap":{source:"iana"},"application/vnd.yaoweme":{source:"iana"},"application/vnd.yellowriver-custom-menu":{source:"iana",extensions:["cmp"]},"application/vnd.youtube.yt":{source:"iana"},"application/vnd.zul":{source:"iana",extensions:["zir","zirz"]},"application/vnd.zzazz.deck+xml":{source:"iana",compressible:!0,extensions:["zaz"]},"application/voicexml+xml":{source:"iana",compressible:!0,extensions:["vxml"]},"application/voucher-cms+json":{source:"iana",compressible:!0},"application/vq-rtcpxr":{source:"iana"},"application/wasm":{source:"iana",compressible:!0,extensions:["wasm"]},"application/watcherinfo+xml":{source:"iana",compressible:!0,extensions:["wif"]},"application/webpush-options+json":{source:"iana",compressible:!0},"application/whoispp-query":{source:"iana"},"application/whoispp-response":{source:"iana"},"application/widget":{source:"iana",extensions:["wgt"]},"application/winhlp":{source:"apache",extensions:["hlp"]},"application/wita":{source:"iana"},"application/wordperfect5.1":{source:"iana"},"application/wsdl+xml":{source:"iana",compressible:!0,extensions:["wsdl"]},"application/wspolicy+xml":{source:"iana",compressible:!0,extensions:["wspolicy"]},"application/x-7z-compressed":{source:"apache",compressible:!1,extensions:["7z"]},"application/x-abiword":{source:"apache",extensions:["abw"]},"application/x-ace-compressed":{source:"apache",extensions:["ace"]},"application/x-amf":{source:"apache"},"application/x-apple-diskimage":{source:"apache",extensions:["dmg"]},"application/x-arj":{compressible:!1,extensions:["arj"]},"application/x-authorware-bin":{source:"apache",extensions:["aab","x32","u32","vox"]},"application/x-authorware-map":{source:"apache",extensions:["aam"]},"application/x-authorware-seg":{source:"apache",extensions:["aas"]},"application/x-bcpio":{source:"apache",extensions:["bcpio"]},"application/x-bdoc":{compressible:!1,extensions:["bdoc"]},"application/x-bittorrent":{source:"apache",extensions:["torrent"]},"application/x-blorb":{source:"apache",extensions:["blb","blorb"]},"application/x-bzip":{source:"apache",compressible:!1,extensions:["bz"]},"application/x-bzip2":{source:"apache",compressible:!1,extensions:["bz2","boz"]},"application/x-cbr":{source:"apache",extensions:["cbr","cba","cbt","cbz","cb7"]},"application/x-cdlink":{source:"apache",extensions:["vcd"]},"application/x-cfs-compressed":{source:"apache",extensions:["cfs"]},"application/x-chat":{source:"apache",extensions:["chat"]},"application/x-chess-pgn":{source:"apache",extensions:["pgn"]},"application/x-chrome-extension":{extensions:["crx"]},"application/x-cocoa":{source:"nginx",extensions:["cco"]},"application/x-compress":{source:"apache"},"application/x-conference":{source:"apache",extensions:["nsc"]},"application/x-cpio":{source:"apache",extensions:["cpio"]},"application/x-csh":{source:"apache",extensions:["csh"]},"application/x-deb":{compressible:!1},"application/x-debian-package":{source:"apache",extensions:["deb","udeb"]},"application/x-dgc-compressed":{source:"apache",extensions:["dgc"]},"application/x-director":{source:"apache",extensions:["dir","dcr","dxr","cst","cct","cxt","w3d","fgd","swa"]},"application/x-doom":{source:"apache",extensions:["wad"]},"application/x-dtbncx+xml":{source:"apache",compressible:!0,extensions:["ncx"]},"application/x-dtbook+xml":{source:"apache",compressible:!0,extensions:["dtb"]},"application/x-dtbresource+xml":{source:"apache",compressible:!0,extensions:["res"]},"application/x-dvi":{source:"apache",compressible:!1,extensions:["dvi"]},"application/x-envoy":{source:"apache",extensions:["evy"]},"application/x-eva":{source:"apache",extensions:["eva"]},"application/x-font-bdf":{source:"apache",extensions:["bdf"]},"application/x-font-dos":{source:"apache"},"application/x-font-framemaker":{source:"apache"},"application/x-font-ghostscript":{source:"apache",extensions:["gsf"]},"application/x-font-libgrx":{source:"apache"},"application/x-font-linux-psf":{source:"apache",extensions:["psf"]},"application/x-font-pcf":{source:"apache",extensions:["pcf"]},"application/x-font-snf":{source:"apache",extensions:["snf"]},"application/x-font-speedo":{source:"apache"},"application/x-font-sunos-news":{source:"apache"},"application/x-font-type1":{source:"apache",extensions:["pfa","pfb","pfm","afm"]},"application/x-font-vfont":{source:"apache"},"application/x-freearc":{source:"apache",extensions:["arc"]},"application/x-futuresplash":{source:"apache",extensions:["spl"]},"application/x-gca-compressed":{source:"apache",extensions:["gca"]},"application/x-glulx":{source:"apache",extensions:["ulx"]},"application/x-gnumeric":{source:"apache",extensions:["gnumeric"]},"application/x-gramps-xml":{source:"apache",extensions:["gramps"]},"application/x-gtar":{source:"apache",extensions:["gtar"]},"application/x-gzip":{source:"apache"},"application/x-hdf":{source:"apache",extensions:["hdf"]},"application/x-httpd-php":{compressible:!0,extensions:["php"]},"application/x-install-instructions":{source:"apache",extensions:["install"]},"application/x-iso9660-image":{source:"apache",extensions:["iso"]},"application/x-iwork-keynote-sffkey":{extensions:["key"]},"application/x-iwork-numbers-sffnumbers":{extensions:["numbers"]},"application/x-iwork-pages-sffpages":{extensions:["pages"]},"application/x-java-archive-diff":{source:"nginx",extensions:["jardiff"]},"application/x-java-jnlp-file":{source:"apache",compressible:!1,extensions:["jnlp"]},"application/x-javascript":{compressible:!0},"application/x-keepass2":{extensions:["kdbx"]},"application/x-latex":{source:"apache",compressible:!1,extensions:["latex"]},"application/x-lua-bytecode":{extensions:["luac"]},"application/x-lzh-compressed":{source:"apache",extensions:["lzh","lha"]},"application/x-makeself":{source:"nginx",extensions:["run"]},"application/x-mie":{source:"apache",extensions:["mie"]},"application/x-mobipocket-ebook":{source:"apache",extensions:["prc","mobi"]},"application/x-mpegurl":{compressible:!1},"application/x-ms-application":{source:"apache",extensions:["application"]},"application/x-ms-shortcut":{source:"apache",extensions:["lnk"]},"application/x-ms-wmd":{source:"apache",extensions:["wmd"]},"application/x-ms-wmz":{source:"apache",extensions:["wmz"]},"application/x-ms-xbap":{source:"apache",extensions:["xbap"]},"application/x-msaccess":{source:"apache",extensions:["mdb"]},"application/x-msbinder":{source:"apache",extensions:["obd"]},"application/x-mscardfile":{source:"apache",extensions:["crd"]},"application/x-msclip":{source:"apache",extensions:["clp"]},"application/x-msdos-program":{extensions:["exe"]},"application/x-msdownload":{source:"apache",extensions:["exe","dll","com","bat","msi"]},"application/x-msmediaview":{source:"apache",extensions:["mvb","m13","m14"]},"application/x-msmetafile":{source:"apache",extensions:["wmf","wmz","emf","emz"]},"application/x-msmoney":{source:"apache",extensions:["mny"]},"application/x-mspublisher":{source:"apache",extensions:["pub"]},"application/x-msschedule":{source:"apache",extensions:["scd"]},"application/x-msterminal":{source:"apache",extensions:["trm"]},"application/x-mswrite":{source:"apache",extensions:["wri"]},"application/x-netcdf":{source:"apache",extensions:["nc","cdf"]},"application/x-ns-proxy-autoconfig":{compressible:!0,extensions:["pac"]},"application/x-nzb":{source:"apache",extensions:["nzb"]},"application/x-perl":{source:"nginx",extensions:["pl","pm"]},"application/x-pilot":{source:"nginx",extensions:["prc","pdb"]},"application/x-pkcs12":{source:"apache",compressible:!1,extensions:["p12","pfx"]},"application/x-pkcs7-certificates":{source:"apache",extensions:["p7b","spc"]},"application/x-pkcs7-certreqresp":{source:"apache",extensions:["p7r"]},"application/x-pki-message":{source:"iana"},"application/x-rar-compressed":{source:"apache",compressible:!1,extensions:["rar"]},"application/x-redhat-package-manager":{source:"nginx",extensions:["rpm"]},"application/x-research-info-systems":{source:"apache",extensions:["ris"]},"application/x-sea":{source:"nginx",extensions:["sea"]},"application/x-sh":{source:"apache",compressible:!0,extensions:["sh"]},"application/x-shar":{source:"apache",extensions:["shar"]},"application/x-shockwave-flash":{source:"apache",compressible:!1,extensions:["swf"]},"application/x-silverlight-app":{source:"apache",extensions:["xap"]},"application/x-sql":{source:"apache",extensions:["sql"]},"application/x-stuffit":{source:"apache",compressible:!1,extensions:["sit"]},"application/x-stuffitx":{source:"apache",extensions:["sitx"]},"application/x-subrip":{source:"apache",extensions:["srt"]},"application/x-sv4cpio":{source:"apache",extensions:["sv4cpio"]},"application/x-sv4crc":{source:"apache",extensions:["sv4crc"]},"application/x-t3vm-image":{source:"apache",extensions:["t3"]},"application/x-tads":{source:"apache",extensions:["gam"]},"application/x-tar":{source:"apache",compressible:!0,extensions:["tar"]},"application/x-tcl":{source:"apache",extensions:["tcl","tk"]},"application/x-tex":{source:"apache",extensions:["tex"]},"application/x-tex-tfm":{source:"apache",extensions:["tfm"]},"application/x-texinfo":{source:"apache",extensions:["texinfo","texi"]},"application/x-tgif":{source:"apache",extensions:["obj"]},"application/x-ustar":{source:"apache",extensions:["ustar"]},"application/x-virtualbox-hdd":{compressible:!0,extensions:["hdd"]},"application/x-virtualbox-ova":{compressible:!0,extensions:["ova"]},"application/x-virtualbox-ovf":{compressible:!0,extensions:["ovf"]},"application/x-virtualbox-vbox":{compressible:!0,extensions:["vbox"]},"application/x-virtualbox-vbox-extpack":{compressible:!1,extensions:["vbox-extpack"]},"application/x-virtualbox-vdi":{compressible:!0,extensions:["vdi"]},"application/x-virtualbox-vhd":{compressible:!0,extensions:["vhd"]},"application/x-virtualbox-vmdk":{compressible:!0,extensions:["vmdk"]},"application/x-wais-source":{source:"apache",extensions:["src"]},"application/x-web-app-manifest+json":{compressible:!0,extensions:["webapp"]},"application/x-www-form-urlencoded":{source:"iana",compressible:!0},"application/x-x509-ca-cert":{source:"iana",extensions:["der","crt","pem"]},"application/x-x509-ca-ra-cert":{source:"iana"},"application/x-x509-next-ca-cert":{source:"iana"},"application/x-xfig":{source:"apache",extensions:["fig"]},"application/x-xliff+xml":{source:"apache",compressible:!0,extensions:["xlf"]},"application/x-xpinstall":{source:"apache",compressible:!1,extensions:["xpi"]},"application/x-xz":{source:"apache",extensions:["xz"]},"application/x-zmachine":{source:"apache",extensions:["z1","z2","z3","z4","z5","z6","z7","z8"]},"application/x400-bp":{source:"iana"},"application/xacml+xml":{source:"iana",compressible:!0},"application/xaml+xml":{source:"apache",compressible:!0,extensions:["xaml"]},"application/xcap-att+xml":{source:"iana",compressible:!0,extensions:["xav"]},"application/xcap-caps+xml":{source:"iana",compressible:!0,extensions:["xca"]},"application/xcap-diff+xml":{source:"iana",compressible:!0,extensions:["xdf"]},"application/xcap-el+xml":{source:"iana",compressible:!0,extensions:["xel"]},"application/xcap-error+xml":{source:"iana",compressible:!0},"application/xcap-ns+xml":{source:"iana",compressible:!0,extensions:["xns"]},"application/xcon-conference-info+xml":{source:"iana",compressible:!0},"application/xcon-conference-info-diff+xml":{source:"iana",compressible:!0},"application/xenc+xml":{source:"iana",compressible:!0,extensions:["xenc"]},"application/xhtml+xml":{source:"iana",compressible:!0,extensions:["xhtml","xht"]},"application/xhtml-voice+xml":{source:"apache",compressible:!0},"application/xliff+xml":{source:"iana",compressible:!0,extensions:["xlf"]},"application/xml":{source:"iana",compressible:!0,extensions:["xml","xsl","xsd","rng"]},"application/xml-dtd":{source:"iana",compressible:!0,extensions:["dtd"]},"application/xml-external-parsed-entity":{source:"iana"},"application/xml-patch+xml":{source:"iana",compressible:!0},"application/xmpp+xml":{source:"iana",compressible:!0},"application/xop+xml":{source:"iana",compressible:!0,extensions:["xop"]},"application/xproc+xml":{source:"apache",compressible:!0,extensions:["xpl"]},"application/xslt+xml":{source:"iana",compressible:!0,extensions:["xsl","xslt"]},"application/xspf+xml":{source:"apache",compressible:!0,extensions:["xspf"]},"application/xv+xml":{source:"iana",compressible:!0,extensions:["mxml","xhvml","xvml","xvm"]},"application/yang":{source:"iana",extensions:["yang"]},"application/yang-data+json":{source:"iana",compressible:!0},"application/yang-data+xml":{source:"iana",compressible:!0},"application/yang-patch+json":{source:"iana",compressible:!0},"application/yang-patch+xml":{source:"iana",compressible:!0},"application/yin+xml":{source:"iana",compressible:!0,extensions:["yin"]},"application/zip":{source:"iana",compressible:!1,extensions:["zip"]},"application/zlib":{source:"iana"},"application/zstd":{source:"iana"},"audio/1d-interleaved-parityfec":{source:"iana"},"audio/32kadpcm":{source:"iana"},"audio/3gpp":{source:"iana",compressible:!1,extensions:["3gpp"]},"audio/3gpp2":{source:"iana"},"audio/aac":{source:"iana"},"audio/ac3":{source:"iana"},"audio/adpcm":{source:"apache",extensions:["adp"]},"audio/amr":{source:"iana",extensions:["amr"]},"audio/amr-wb":{source:"iana"},"audio/amr-wb+":{source:"iana"},"audio/aptx":{source:"iana"},"audio/asc":{source:"iana"},"audio/atrac-advanced-lossless":{source:"iana"},"audio/atrac-x":{source:"iana"},"audio/atrac3":{source:"iana"},"audio/basic":{source:"iana",compressible:!1,extensions:["au","snd"]},"audio/bv16":{source:"iana"},"audio/bv32":{source:"iana"},"audio/clearmode":{source:"iana"},"audio/cn":{source:"iana"},"audio/dat12":{source:"iana"},"audio/dls":{source:"iana"},"audio/dsr-es201108":{source:"iana"},"audio/dsr-es202050":{source:"iana"},"audio/dsr-es202211":{source:"iana"},"audio/dsr-es202212":{source:"iana"},"audio/dv":{source:"iana"},"audio/dvi4":{source:"iana"},"audio/eac3":{source:"iana"},"audio/encaprtp":{source:"iana"},"audio/evrc":{source:"iana"},"audio/evrc-qcp":{source:"iana"},"audio/evrc0":{source:"iana"},"audio/evrc1":{source:"iana"},"audio/evrcb":{source:"iana"},"audio/evrcb0":{source:"iana"},"audio/evrcb1":{source:"iana"},"audio/evrcnw":{source:"iana"},"audio/evrcnw0":{source:"iana"},"audio/evrcnw1":{source:"iana"},"audio/evrcwb":{source:"iana"},"audio/evrcwb0":{source:"iana"},"audio/evrcwb1":{source:"iana"},"audio/evs":{source:"iana"},"audio/flexfec":{source:"iana"},"audio/fwdred":{source:"iana"},"audio/g711-0":{source:"iana"},"audio/g719":{source:"iana"},"audio/g722":{source:"iana"},"audio/g7221":{source:"iana"},"audio/g723":{source:"iana"},"audio/g726-16":{source:"iana"},"audio/g726-24":{source:"iana"},"audio/g726-32":{source:"iana"},"audio/g726-40":{source:"iana"},"audio/g728":{source:"iana"},"audio/g729":{source:"iana"},"audio/g7291":{source:"iana"},"audio/g729d":{source:"iana"},"audio/g729e":{source:"iana"},"audio/gsm":{source:"iana"},"audio/gsm-efr":{source:"iana"},"audio/gsm-hr-08":{source:"iana"},"audio/ilbc":{source:"iana"},"audio/ip-mr_v2.5":{source:"iana"},"audio/isac":{source:"apache"},"audio/l16":{source:"iana"},"audio/l20":{source:"iana"},"audio/l24":{source:"iana",compressible:!1},"audio/l8":{source:"iana"},"audio/lpc":{source:"iana"},"audio/melp":{source:"iana"},"audio/melp1200":{source:"iana"},"audio/melp2400":{source:"iana"},"audio/melp600":{source:"iana"},"audio/mhas":{source:"iana"},"audio/midi":{source:"apache",extensions:["mid","midi","kar","rmi"]},"audio/mobile-xmf":{source:"iana",extensions:["mxmf"]},"audio/mp3":{compressible:!1,extensions:["mp3"]},"audio/mp4":{source:"iana",compressible:!1,extensions:["m4a","mp4a"]},"audio/mp4a-latm":{source:"iana"},"audio/mpa":{source:"iana"},"audio/mpa-robust":{source:"iana"},"audio/mpeg":{source:"iana",compressible:!1,extensions:["mpga","mp2","mp2a","mp3","m2a","m3a"]},"audio/mpeg4-generic":{source:"iana"},"audio/musepack":{source:"apache"},"audio/ogg":{source:"iana",compressible:!1,extensions:["oga","ogg","spx","opus"]},"audio/opus":{source:"iana"},"audio/parityfec":{source:"iana"},"audio/pcma":{source:"iana"},"audio/pcma-wb":{source:"iana"},"audio/pcmu":{source:"iana"},"audio/pcmu-wb":{source:"iana"},"audio/prs.sid":{source:"iana"},"audio/qcelp":{source:"iana"},"audio/raptorfec":{source:"iana"},"audio/red":{source:"iana"},"audio/rtp-enc-aescm128":{source:"iana"},"audio/rtp-midi":{source:"iana"},"audio/rtploopback":{source:"iana"},"audio/rtx":{source:"iana"},"audio/s3m":{source:"apache",extensions:["s3m"]},"audio/scip":{source:"iana"},"audio/silk":{source:"apache",extensions:["sil"]},"audio/smv":{source:"iana"},"audio/smv-qcp":{source:"iana"},"audio/smv0":{source:"iana"},"audio/sofa":{source:"iana"},"audio/sp-midi":{source:"iana"},"audio/speex":{source:"iana"},"audio/t140c":{source:"iana"},"audio/t38":{source:"iana"},"audio/telephone-event":{source:"iana"},"audio/tetra_acelp":{source:"iana"},"audio/tetra_acelp_bb":{source:"iana"},"audio/tone":{source:"iana"},"audio/tsvcis":{source:"iana"},"audio/uemclip":{source:"iana"},"audio/ulpfec":{source:"iana"},"audio/usac":{source:"iana"},"audio/vdvi":{source:"iana"},"audio/vmr-wb":{source:"iana"},"audio/vnd.3gpp.iufp":{source:"iana"},"audio/vnd.4sb":{source:"iana"},"audio/vnd.audiokoz":{source:"iana"},"audio/vnd.celp":{source:"iana"},"audio/vnd.cisco.nse":{source:"iana"},"audio/vnd.cmles.radio-events":{source:"iana"},"audio/vnd.cns.anp1":{source:"iana"},"audio/vnd.cns.inf1":{source:"iana"},"audio/vnd.dece.audio":{source:"iana",extensions:["uva","uvva"]},"audio/vnd.digital-winds":{source:"iana",extensions:["eol"]},"audio/vnd.dlna.adts":{source:"iana"},"audio/vnd.dolby.heaac.1":{source:"iana"},"audio/vnd.dolby.heaac.2":{source:"iana"},"audio/vnd.dolby.mlp":{source:"iana"},"audio/vnd.dolby.mps":{source:"iana"},"audio/vnd.dolby.pl2":{source:"iana"},"audio/vnd.dolby.pl2x":{source:"iana"},"audio/vnd.dolby.pl2z":{source:"iana"},"audio/vnd.dolby.pulse.1":{source:"iana"},"audio/vnd.dra":{source:"iana",extensions:["dra"]},"audio/vnd.dts":{source:"iana",extensions:["dts"]},"audio/vnd.dts.hd":{source:"iana",extensions:["dtshd"]},"audio/vnd.dts.uhd":{source:"iana"},"audio/vnd.dvb.file":{source:"iana"},"audio/vnd.everad.plj":{source:"iana"},"audio/vnd.hns.audio":{source:"iana"},"audio/vnd.lucent.voice":{source:"iana",extensions:["lvp"]},"audio/vnd.ms-playready.media.pya":{source:"iana",extensions:["pya"]},"audio/vnd.nokia.mobile-xmf":{source:"iana"},"audio/vnd.nortel.vbk":{source:"iana"},"audio/vnd.nuera.ecelp4800":{source:"iana",extensions:["ecelp4800"]},"audio/vnd.nuera.ecelp7470":{source:"iana",extensions:["ecelp7470"]},"audio/vnd.nuera.ecelp9600":{source:"iana",extensions:["ecelp9600"]},"audio/vnd.octel.sbc":{source:"iana"},"audio/vnd.presonus.multitrack":{source:"iana"},"audio/vnd.qcelp":{source:"iana"},"audio/vnd.rhetorex.32kadpcm":{source:"iana"},"audio/vnd.rip":{source:"iana",extensions:["rip"]},"audio/vnd.rn-realaudio":{compressible:!1},"audio/vnd.sealedmedia.softseal.mpeg":{source:"iana"},"audio/vnd.vmx.cvsd":{source:"iana"},"audio/vnd.wave":{compressible:!1},"audio/vorbis":{source:"iana",compressible:!1},"audio/vorbis-config":{source:"iana"},"audio/wav":{compressible:!1,extensions:["wav"]},"audio/wave":{compressible:!1,extensions:["wav"]},"audio/webm":{source:"apache",compressible:!1,extensions:["weba"]},"audio/x-aac":{source:"apache",compressible:!1,extensions:["aac"]},"audio/x-aiff":{source:"apache",extensions:["aif","aiff","aifc"]},"audio/x-caf":{source:"apache",compressible:!1,extensions:["caf"]},"audio/x-flac":{source:"apache",extensions:["flac"]},"audio/x-m4a":{source:"nginx",extensions:["m4a"]},"audio/x-matroska":{source:"apache",extensions:["mka"]},"audio/x-mpegurl":{source:"apache",extensions:["m3u"]},"audio/x-ms-wax":{source:"apache",extensions:["wax"]},"audio/x-ms-wma":{source:"apache",extensions:["wma"]},"audio/x-pn-realaudio":{source:"apache",extensions:["ram","ra"]},"audio/x-pn-realaudio-plugin":{source:"apache",extensions:["rmp"]},"audio/x-realaudio":{source:"nginx",extensions:["ra"]},"audio/x-tta":{source:"apache"},"audio/x-wav":{source:"apache",extensions:["wav"]},"audio/xm":{source:"apache",extensions:["xm"]},"chemical/x-cdx":{source:"apache",extensions:["cdx"]},"chemical/x-cif":{source:"apache",extensions:["cif"]},"chemical/x-cmdf":{source:"apache",extensions:["cmdf"]},"chemical/x-cml":{source:"apache",extensions:["cml"]},"chemical/x-csml":{source:"apache",extensions:["csml"]},"chemical/x-pdb":{source:"apache"},"chemical/x-xyz":{source:"apache",extensions:["xyz"]},"font/collection":{source:"iana",extensions:["ttc"]},"font/otf":{source:"iana",compressible:!0,extensions:["otf"]},"font/sfnt":{source:"iana"},"font/ttf":{source:"iana",compressible:!0,extensions:["ttf"]},"font/woff":{source:"iana",extensions:["woff"]},"font/woff2":{source:"iana",extensions:["woff2"]},"image/aces":{source:"iana",extensions:["exr"]},"image/apng":{compressible:!1,extensions:["apng"]},"image/avci":{source:"iana",extensions:["avci"]},"image/avcs":{source:"iana",extensions:["avcs"]},"image/avif":{source:"iana",compressible:!1,extensions:["avif"]},"image/bmp":{source:"iana",compressible:!0,extensions:["bmp"]},"image/cgm":{source:"iana",extensions:["cgm"]},"image/dicom-rle":{source:"iana",extensions:["drle"]},"image/emf":{source:"iana",extensions:["emf"]},"image/fits":{source:"iana",extensions:["fits"]},"image/g3fax":{source:"iana",extensions:["g3"]},"image/gif":{source:"iana",compressible:!1,extensions:["gif"]},"image/heic":{source:"iana",extensions:["heic"]},"image/heic-sequence":{source:"iana",extensions:["heics"]},"image/heif":{source:"iana",extensions:["heif"]},"image/heif-sequence":{source:"iana",extensions:["heifs"]},"image/hej2k":{source:"iana",extensions:["hej2"]},"image/hsj2":{source:"iana",extensions:["hsj2"]},"image/ief":{source:"iana",extensions:["ief"]},"image/jls":{source:"iana",extensions:["jls"]},"image/jp2":{source:"iana",compressible:!1,extensions:["jp2","jpg2"]},"image/jpeg":{source:"iana",compressible:!1,extensions:["jpeg","jpg","jpe"]},"image/jph":{source:"iana",extensions:["jph"]},"image/jphc":{source:"iana",extensions:["jhc"]},"image/jpm":{source:"iana",compressible:!1,extensions:["jpm"]},"image/jpx":{source:"iana",compressible:!1,extensions:["jpx","jpf"]},"image/jxr":{source:"iana",extensions:["jxr"]},"image/jxra":{source:"iana",extensions:["jxra"]},"image/jxrs":{source:"iana",extensions:["jxrs"]},"image/jxs":{source:"iana",extensions:["jxs"]},"image/jxsc":{source:"iana",extensions:["jxsc"]},"image/jxsi":{source:"iana",extensions:["jxsi"]},"image/jxss":{source:"iana",extensions:["jxss"]},"image/ktx":{source:"iana",extensions:["ktx"]},"image/ktx2":{source:"iana",extensions:["ktx2"]},"image/naplps":{source:"iana"},"image/pjpeg":{compressible:!1},"image/png":{source:"iana",compressible:!1,extensions:["png"]},"image/prs.btif":{source:"iana",extensions:["btif"]},"image/prs.pti":{source:"iana",extensions:["pti"]},"image/pwg-raster":{source:"iana"},"image/sgi":{source:"apache",extensions:["sgi"]},"image/svg+xml":{source:"iana",compressible:!0,extensions:["svg","svgz"]},"image/t38":{source:"iana",extensions:["t38"]},"image/tiff":{source:"iana",compressible:!1,extensions:["tif","tiff"]},"image/tiff-fx":{source:"iana",extensions:["tfx"]},"image/vnd.adobe.photoshop":{source:"iana",compressible:!0,extensions:["psd"]},"image/vnd.airzip.accelerator.azv":{source:"iana",extensions:["azv"]},"image/vnd.cns.inf2":{source:"iana"},"image/vnd.dece.graphic":{source:"iana",extensions:["uvi","uvvi","uvg","uvvg"]},"image/vnd.djvu":{source:"iana",extensions:["djvu","djv"]},"image/vnd.dvb.subtitle":{source:"iana",extensions:["sub"]},"image/vnd.dwg":{source:"iana",extensions:["dwg"]},"image/vnd.dxf":{source:"iana",extensions:["dxf"]},"image/vnd.fastbidsheet":{source:"iana",extensions:["fbs"]},"image/vnd.fpx":{source:"iana",extensions:["fpx"]},"image/vnd.fst":{source:"iana",extensions:["fst"]},"image/vnd.fujixerox.edmics-mmr":{source:"iana",extensions:["mmr"]},"image/vnd.fujixerox.edmics-rlc":{source:"iana",extensions:["rlc"]},"image/vnd.globalgraphics.pgb":{source:"iana"},"image/vnd.microsoft.icon":{source:"iana",compressible:!0,extensions:["ico"]},"image/vnd.mix":{source:"iana"},"image/vnd.mozilla.apng":{source:"iana"},"image/vnd.ms-dds":{compressible:!0,extensions:["dds"]},"image/vnd.ms-modi":{source:"iana",extensions:["mdi"]},"image/vnd.ms-photo":{source:"apache",extensions:["wdp"]},"image/vnd.net-fpx":{source:"iana",extensions:["npx"]},"image/vnd.pco.b16":{source:"iana",extensions:["b16"]},"image/vnd.radiance":{source:"iana"},"image/vnd.sealed.png":{source:"iana"},"image/vnd.sealedmedia.softseal.gif":{source:"iana"},"image/vnd.sealedmedia.softseal.jpg":{source:"iana"},"image/vnd.svf":{source:"iana"},"image/vnd.tencent.tap":{source:"iana",extensions:["tap"]},"image/vnd.valve.source.texture":{source:"iana",extensions:["vtf"]},"image/vnd.wap.wbmp":{source:"iana",extensions:["wbmp"]},"image/vnd.xiff":{source:"iana",extensions:["xif"]},"image/vnd.zbrush.pcx":{source:"iana",extensions:["pcx"]},"image/webp":{source:"apache",extensions:["webp"]},"image/wmf":{source:"iana",extensions:["wmf"]},"image/x-3ds":{source:"apache",extensions:["3ds"]},"image/x-cmu-raster":{source:"apache",extensions:["ras"]},"image/x-cmx":{source:"apache",extensions:["cmx"]},"image/x-freehand":{source:"apache",extensions:["fh","fhc","fh4","fh5","fh7"]},"image/x-icon":{source:"apache",compressible:!0,extensions:["ico"]},"image/x-jng":{source:"nginx",extensions:["jng"]},"image/x-mrsid-image":{source:"apache",extensions:["sid"]},"image/x-ms-bmp":{source:"nginx",compressible:!0,extensions:["bmp"]},"image/x-pcx":{source:"apache",extensions:["pcx"]},"image/x-pict":{source:"apache",extensions:["pic","pct"]},"image/x-portable-anymap":{source:"apache",extensions:["pnm"]},"image/x-portable-bitmap":{source:"apache",extensions:["pbm"]},"image/x-portable-graymap":{source:"apache",extensions:["pgm"]},"image/x-portable-pixmap":{source:"apache",extensions:["ppm"]},"image/x-rgb":{source:"apache",extensions:["rgb"]},"image/x-tga":{source:"apache",extensions:["tga"]},"image/x-xbitmap":{source:"apache",extensions:["xbm"]},"image/x-xcf":{compressible:!1},"image/x-xpixmap":{source:"apache",extensions:["xpm"]},"image/x-xwindowdump":{source:"apache",extensions:["xwd"]},"message/cpim":{source:"iana"},"message/delivery-status":{source:"iana"},"message/disposition-notification":{source:"iana",extensions:["disposition-notification"]},"message/external-body":{source:"iana"},"message/feedback-report":{source:"iana"},"message/global":{source:"iana",extensions:["u8msg"]},"message/global-delivery-status":{source:"iana",extensions:["u8dsn"]},"message/global-disposition-notification":{source:"iana",extensions:["u8mdn"]},"message/global-headers":{source:"iana",extensions:["u8hdr"]},"message/http":{source:"iana",compressible:!1},"message/imdn+xml":{source:"iana",compressible:!0},"message/news":{source:"iana"},"message/partial":{source:"iana",compressible:!1},"message/rfc822":{source:"iana",compressible:!0,extensions:["eml","mime"]},"message/s-http":{source:"iana"},"message/sip":{source:"iana"},"message/sipfrag":{source:"iana"},"message/tracking-status":{source:"iana"},"message/vnd.si.simp":{source:"iana"},"message/vnd.wfa.wsc":{source:"iana",extensions:["wsc"]},"model/3mf":{source:"iana",extensions:["3mf"]},"model/e57":{source:"iana"},"model/gltf+json":{source:"iana",compressible:!0,extensions:["gltf"]},"model/gltf-binary":{source:"iana",compressible:!0,extensions:["glb"]},"model/iges":{source:"iana",compressible:!1,extensions:["igs","iges"]},"model/mesh":{source:"iana",compressible:!1,extensions:["msh","mesh","silo"]},"model/mtl":{source:"iana",extensions:["mtl"]},"model/obj":{source:"iana",extensions:["obj"]},"model/step":{source:"iana"},"model/step+xml":{source:"iana",compressible:!0,extensions:["stpx"]},"model/step+zip":{source:"iana",compressible:!1,extensions:["stpz"]},"model/step-xml+zip":{source:"iana",compressible:!1,extensions:["stpxz"]},"model/stl":{source:"iana",extensions:["stl"]},"model/vnd.collada+xml":{source:"iana",compressible:!0,extensions:["dae"]},"model/vnd.dwf":{source:"iana",extensions:["dwf"]},"model/vnd.flatland.3dml":{source:"iana"},"model/vnd.gdl":{source:"iana",extensions:["gdl"]},"model/vnd.gs-gdl":{source:"apache"},"model/vnd.gs.gdl":{source:"iana"},"model/vnd.gtw":{source:"iana",extensions:["gtw"]},"model/vnd.moml+xml":{source:"iana",compressible:!0},"model/vnd.mts":{source:"iana",extensions:["mts"]},"model/vnd.opengex":{source:"iana",extensions:["ogex"]},"model/vnd.parasolid.transmit.binary":{source:"iana",extensions:["x_b"]},"model/vnd.parasolid.transmit.text":{source:"iana",extensions:["x_t"]},"model/vnd.pytha.pyox":{source:"iana"},"model/vnd.rosette.annotated-data-model":{source:"iana"},"model/vnd.sap.vds":{source:"iana",extensions:["vds"]},"model/vnd.usdz+zip":{source:"iana",compressible:!1,extensions:["usdz"]},"model/vnd.valve.source.compiled-map":{source:"iana",extensions:["bsp"]},"model/vnd.vtu":{source:"iana",extensions:["vtu"]},"model/vrml":{source:"iana",compressible:!1,extensions:["wrl","vrml"]},"model/x3d+binary":{source:"apache",compressible:!1,extensions:["x3db","x3dbz"]},"model/x3d+fastinfoset":{source:"iana",extensions:["x3db"]},"model/x3d+vrml":{source:"apache",compressible:!1,extensions:["x3dv","x3dvz"]},"model/x3d+xml":{source:"iana",compressible:!0,extensions:["x3d","x3dz"]},"model/x3d-vrml":{source:"iana",extensions:["x3dv"]},"multipart/alternative":{source:"iana",compressible:!1},"multipart/appledouble":{source:"iana"},"multipart/byteranges":{source:"iana"},"multipart/digest":{source:"iana"},"multipart/encrypted":{source:"iana",compressible:!1},"multipart/form-data":{source:"iana",compressible:!1},"multipart/header-set":{source:"iana"},"multipart/mixed":{source:"iana"},"multipart/multilingual":{source:"iana"},"multipart/parallel":{source:"iana"},"multipart/related":{source:"iana",compressible:!1},"multipart/report":{source:"iana"},"multipart/signed":{source:"iana",compressible:!1},"multipart/vnd.bint.med-plus":{source:"iana"},"multipart/voice-message":{source:"iana"},"multipart/x-mixed-replace":{source:"iana"},"text/1d-interleaved-parityfec":{source:"iana"},"text/cache-manifest":{source:"iana",compressible:!0,extensions:["appcache","manifest"]},"text/calendar":{source:"iana",extensions:["ics","ifb"]},"text/calender":{compressible:!0},"text/cmd":{compressible:!0},"text/coffeescript":{extensions:["coffee","litcoffee"]},"text/cql":{source:"iana"},"text/cql-expression":{source:"iana"},"text/cql-identifier":{source:"iana"},"text/css":{source:"iana",charset:"UTF-8",compressible:!0,extensions:["css"]},"text/csv":{source:"iana",compressible:!0,extensions:["csv"]},"text/csv-schema":{source:"iana"},"text/directory":{source:"iana"},"text/dns":{source:"iana"},"text/ecmascript":{source:"iana"},"text/encaprtp":{source:"iana"},"text/enriched":{source:"iana"},"text/fhirpath":{source:"iana"},"text/flexfec":{source:"iana"},"text/fwdred":{source:"iana"},"text/gff3":{source:"iana"},"text/grammar-ref-list":{source:"iana"},"text/html":{source:"iana",compressible:!0,extensions:["html","htm","shtml"]},"text/jade":{extensions:["jade"]},"text/javascript":{source:"iana",compressible:!0},"text/jcr-cnd":{source:"iana"},"text/jsx":{compressible:!0,extensions:["jsx"]},"text/less":{compressible:!0,extensions:["less"]},"text/markdown":{source:"iana",compressible:!0,extensions:["markdown","md"]},"text/mathml":{source:"nginx",extensions:["mml"]},"text/mdx":{compressible:!0,extensions:["mdx"]},"text/mizar":{source:"iana"},"text/n3":{source:"iana",charset:"UTF-8",compressible:!0,extensions:["n3"]},"text/parameters":{source:"iana",charset:"UTF-8"},"text/parityfec":{source:"iana"},"text/plain":{source:"iana",compressible:!0,extensions:["txt","text","conf","def","list","log","in","ini"]},"text/provenance-notation":{source:"iana",charset:"UTF-8"},"text/prs.fallenstein.rst":{source:"iana"},"text/prs.lines.tag":{source:"iana",extensions:["dsc"]},"text/prs.prop.logic":{source:"iana"},"text/raptorfec":{source:"iana"},"text/red":{source:"iana"},"text/rfc822-headers":{source:"iana"},"text/richtext":{source:"iana",compressible:!0,extensions:["rtx"]},"text/rtf":{source:"iana",compressible:!0,extensions:["rtf"]},"text/rtp-enc-aescm128":{source:"iana"},"text/rtploopback":{source:"iana"},"text/rtx":{source:"iana"},"text/sgml":{source:"iana",extensions:["sgml","sgm"]},"text/shaclc":{source:"iana"},"text/shex":{source:"iana",extensions:["shex"]},"text/slim":{extensions:["slim","slm"]},"text/spdx":{source:"iana",extensions:["spdx"]},"text/strings":{source:"iana"},"text/stylus":{extensions:["stylus","styl"]},"text/t140":{source:"iana"},"text/tab-separated-values":{source:"iana",compressible:!0,extensions:["tsv"]},"text/troff":{source:"iana",extensions:["t","tr","roff","man","me","ms"]},"text/turtle":{source:"iana",charset:"UTF-8",extensions:["ttl"]},"text/ulpfec":{source:"iana"},"text/uri-list":{source:"iana",compressible:!0,extensions:["uri","uris","urls"]},"text/vcard":{source:"iana",compressible:!0,extensions:["vcard"]},"text/vnd.a":{source:"iana"},"text/vnd.abc":{source:"iana"},"text/vnd.ascii-art":{source:"iana"},"text/vnd.curl":{source:"iana",extensions:["curl"]},"text/vnd.curl.dcurl":{source:"apache",extensions:["dcurl"]},"text/vnd.curl.mcurl":{source:"apache",extensions:["mcurl"]},"text/vnd.curl.scurl":{source:"apache",extensions:["scurl"]},"text/vnd.debian.copyright":{source:"iana",charset:"UTF-8"},"text/vnd.dmclientscript":{source:"iana"},"text/vnd.dvb.subtitle":{source:"iana",extensions:["sub"]},"text/vnd.esmertec.theme-descriptor":{source:"iana",charset:"UTF-8"},"text/vnd.familysearch.gedcom":{source:"iana",extensions:["ged"]},"text/vnd.ficlab.flt":{source:"iana"},"text/vnd.fly":{source:"iana",extensions:["fly"]},"text/vnd.fmi.flexstor":{source:"iana",extensions:["flx"]},"text/vnd.gml":{source:"iana"},"text/vnd.graphviz":{source:"iana",extensions:["gv"]},"text/vnd.hans":{source:"iana"},"text/vnd.hgl":{source:"iana"},"text/vnd.in3d.3dml":{source:"iana",extensions:["3dml"]},"text/vnd.in3d.spot":{source:"iana",extensions:["spot"]},"text/vnd.iptc.newsml":{source:"iana"},"text/vnd.iptc.nitf":{source:"iana"},"text/vnd.latex-z":{source:"iana"},"text/vnd.motorola.reflex":{source:"iana"},"text/vnd.ms-mediapackage":{source:"iana"},"text/vnd.net2phone.commcenter.command":{source:"iana"},"text/vnd.radisys.msml-basic-layout":{source:"iana"},"text/vnd.senx.warpscript":{source:"iana"},"text/vnd.si.uricatalogue":{source:"iana"},"text/vnd.sosi":{source:"iana"},"text/vnd.sun.j2me.app-descriptor":{source:"iana",charset:"UTF-8",extensions:["jad"]},"text/vnd.trolltech.linguist":{source:"iana",charset:"UTF-8"},"text/vnd.wap.si":{source:"iana"},"text/vnd.wap.sl":{source:"iana"},"text/vnd.wap.wml":{source:"iana",extensions:["wml"]},"text/vnd.wap.wmlscript":{source:"iana",extensions:["wmls"]},"text/vtt":{source:"iana",charset:"UTF-8",compressible:!0,extensions:["vtt"]},"text/x-asm":{source:"apache",extensions:["s","asm"]},"text/x-c":{source:"apache",extensions:["c","cc","cxx","cpp","h","hh","dic"]},"text/x-component":{source:"nginx",extensions:["htc"]},"text/x-fortran":{source:"apache",extensions:["f","for","f77","f90"]},"text/x-gwt-rpc":{compressible:!0},"text/x-handlebars-template":{extensions:["hbs"]},"text/x-java-source":{source:"apache",extensions:["java"]},"text/x-jquery-tmpl":{compressible:!0},"text/x-lua":{extensions:["lua"]},"text/x-markdown":{compressible:!0,extensions:["mkd"]},"text/x-nfo":{source:"apache",extensions:["nfo"]},"text/x-opml":{source:"apache",extensions:["opml"]},"text/x-org":{compressible:!0,extensions:["org"]},"text/x-pascal":{source:"apache",extensions:["p","pas"]},"text/x-processing":{compressible:!0,extensions:["pde"]},"text/x-sass":{extensions:["sass"]},"text/x-scss":{extensions:["scss"]},"text/x-setext":{source:"apache",extensions:["etx"]},"text/x-sfv":{source:"apache",extensions:["sfv"]},"text/x-suse-ymp":{compressible:!0,extensions:["ymp"]},"text/x-uuencode":{source:"apache",extensions:["uu"]},"text/x-vcalendar":{source:"apache",extensions:["vcs"]},"text/x-vcard":{source:"apache",extensions:["vcf"]},"text/xml":{source:"iana",compressible:!0,extensions:["xml"]},"text/xml-external-parsed-entity":{source:"iana"},"text/yaml":{compressible:!0,extensions:["yaml","yml"]},"video/1d-interleaved-parityfec":{source:"iana"},"video/3gpp":{source:"iana",extensions:["3gp","3gpp"]},"video/3gpp-tt":{source:"iana"},"video/3gpp2":{source:"iana",extensions:["3g2"]},"video/av1":{source:"iana"},"video/bmpeg":{source:"iana"},"video/bt656":{source:"iana"},"video/celb":{source:"iana"},"video/dv":{source:"iana"},"video/encaprtp":{source:"iana"},"video/ffv1":{source:"iana"},"video/flexfec":{source:"iana"},"video/h261":{source:"iana",extensions:["h261"]},"video/h263":{source:"iana",extensions:["h263"]},"video/h263-1998":{source:"iana"},"video/h263-2000":{source:"iana"},"video/h264":{source:"iana",extensions:["h264"]},"video/h264-rcdo":{source:"iana"},"video/h264-svc":{source:"iana"},"video/h265":{source:"iana"},"video/iso.segment":{source:"iana",extensions:["m4s"]},"video/jpeg":{source:"iana",extensions:["jpgv"]},"video/jpeg2000":{source:"iana"},"video/jpm":{source:"apache",extensions:["jpm","jpgm"]},"video/jxsv":{source:"iana"},"video/mj2":{source:"iana",extensions:["mj2","mjp2"]},"video/mp1s":{source:"iana"},"video/mp2p":{source:"iana"},"video/mp2t":{source:"iana",extensions:["ts"]},"video/mp4":{source:"iana",compressible:!1,extensions:["mp4","mp4v","mpg4"]},"video/mp4v-es":{source:"iana"},"video/mpeg":{source:"iana",compressible:!1,extensions:["mpeg","mpg","mpe","m1v","m2v"]},"video/mpeg4-generic":{source:"iana"},"video/mpv":{source:"iana"},"video/nv":{source:"iana"},"video/ogg":{source:"iana",compressible:!1,extensions:["ogv"]},"video/parityfec":{source:"iana"},"video/pointer":{source:"iana"},"video/quicktime":{source:"iana",compressible:!1,extensions:["qt","mov"]},"video/raptorfec":{source:"iana"},"video/raw":{source:"iana"},"video/rtp-enc-aescm128":{source:"iana"},"video/rtploopback":{source:"iana"},"video/rtx":{source:"iana"},"video/scip":{source:"iana"},"video/smpte291":{source:"iana"},"video/smpte292m":{source:"iana"},"video/ulpfec":{source:"iana"},"video/vc1":{source:"iana"},"video/vc2":{source:"iana"},"video/vnd.cctv":{source:"iana"},"video/vnd.dece.hd":{source:"iana",extensions:["uvh","uvvh"]},"video/vnd.dece.mobile":{source:"iana",extensions:["uvm","uvvm"]},"video/vnd.dece.mp4":{source:"iana"},"video/vnd.dece.pd":{source:"iana",extensions:["uvp","uvvp"]},"video/vnd.dece.sd":{source:"iana",extensions:["uvs","uvvs"]},"video/vnd.dece.video":{source:"iana",extensions:["uvv","uvvv"]},"video/vnd.directv.mpeg":{source:"iana"},"video/vnd.directv.mpeg-tts":{source:"iana"},"video/vnd.dlna.mpeg-tts":{source:"iana"},"video/vnd.dvb.file":{source:"iana",extensions:["dvb"]},"video/vnd.fvt":{source:"iana",extensions:["fvt"]},"video/vnd.hns.video":{source:"iana"},"video/vnd.iptvforum.1dparityfec-1010":{source:"iana"},"video/vnd.iptvforum.1dparityfec-2005":{source:"iana"},"video/vnd.iptvforum.2dparityfec-1010":{source:"iana"},"video/vnd.iptvforum.2dparityfec-2005":{source:"iana"},"video/vnd.iptvforum.ttsavc":{source:"iana"},"video/vnd.iptvforum.ttsmpeg2":{source:"iana"},"video/vnd.motorola.video":{source:"iana"},"video/vnd.motorola.videop":{source:"iana"},"video/vnd.mpegurl":{source:"iana",extensions:["mxu","m4u"]},"video/vnd.ms-playready.media.pyv":{source:"iana",extensions:["pyv"]},"video/vnd.nokia.interleaved-multimedia":{source:"iana"},"video/vnd.nokia.mp4vr":{source:"iana"},"video/vnd.nokia.videovoip":{source:"iana"},"video/vnd.objectvideo":{source:"iana"},"video/vnd.radgamettools.bink":{source:"iana"},"video/vnd.radgamettools.smacker":{source:"iana"},"video/vnd.sealed.mpeg1":{source:"iana"},"video/vnd.sealed.mpeg4":{source:"iana"},"video/vnd.sealed.swf":{source:"iana"},"video/vnd.sealedmedia.softseal.mov":{source:"iana"},"video/vnd.uvvu.mp4":{source:"iana",extensions:["uvu","uvvu"]},"video/vnd.vivo":{source:"iana",extensions:["viv"]},"video/vnd.youtube.yt":{source:"iana"},"video/vp8":{source:"iana"},"video/vp9":{source:"iana"},"video/webm":{source:"apache",compressible:!1,extensions:["webm"]},"video/x-f4v":{source:"apache",extensions:["f4v"]},"video/x-fli":{source:"apache",extensions:["fli"]},"video/x-flv":{source:"apache",compressible:!1,extensions:["flv"]},"video/x-m4v":{source:"apache",extensions:["m4v"]},"video/x-matroska":{source:"apache",compressible:!1,extensions:["mkv","mk3d","mks"]},"video/x-mng":{source:"apache",extensions:["mng"]},"video/x-ms-asf":{source:"apache",extensions:["asf","asx"]},"video/x-ms-vob":{source:"apache",extensions:["vob"]},"video/x-ms-wm":{source:"apache",extensions:["wm"]},"video/x-ms-wmv":{source:"apache",compressible:!1,extensions:["wmv"]},"video/x-ms-wmx":{source:"apache",extensions:["wmx"]},"video/x-ms-wvx":{source:"apache",extensions:["wvx"]},"video/x-msvideo":{source:"apache",extensions:["avi"]},"video/x-sgi-movie":{source:"apache",extensions:["movie"]},"video/x-smv":{source:"apache",extensions:["smv"]},"x-conference/x-cooltalk":{source:"apache",extensions:["ice"]},"x-shader/x-fragment":{compressible:!0},"x-shader/x-vertex":{compressible:!0}}});var k9=M((y_e,w9)=>{w9.exports=E9()});var T9=M(ko=>{"use strict";var jk=k9(),wse=require("path").extname,P9=/^\s*([^;\s]*)(?:;|\s|$)/,kse=/^text\//i;ko.charset=D9;ko.charsets={lookup:D9};ko.contentType=Pse;ko.extension=Dse;ko.extensions=Object.create(null);ko.lookup=Tse;ko.types=Object.create(null);_se(ko.extensions,ko.types);function D9(r){if(!r||typeof r!="string")return!1;var e=P9.exec(r),t=e&&jk[e[1].toLowerCase()];return t&&t.charset?t.charset:e&&kse.test(e[1])?"UTF-8":!1}function Pse(r){if(!r||typeof r!="string")return!1;var e=r.indexOf("/")===-1?ko.lookup(r):r;if(!e)return!1;if(e.indexOf("charset")===-1){var t=ko.charset(e);t&&(e+="; charset="+t.toLowerCase())}return e}function Dse(r){if(!r||typeof r!="string")return!1;var e=P9.exec(r),t=e&&ko.extensions[e[1].toLowerCase()];return!t||!t.length?!1:t[0]}function Tse(r){if(!r||typeof r!="string")return!1;var e=wse("x."+r).toLowerCase().substr(1);return e&&ko.types[e]||!1}function _se(r,e){var t=["nginx","apache",void 0,"iana"];Object.keys(jk).forEach(function(i){var o=jk[i],s=o.extensions;if(!(!s||!s.length)){r[i]=s;for(var a=0;a<s.length;a++){var l=s[a];if(e[l]){var c=t.indexOf(jk[e[l]].source),u=t.indexOf(o.source);if(e[l]!=="application/octet-stream"&&(c>u||c===u&&e[l].substr(0,12)==="application/"))continue}e[l]=i}}})}});var R9=M((I_e,_9)=>{_9.exports=Rse;function Rse(r){var e=typeof setImmediate=="function"?setImmediate:typeof process=="object"&&typeof process.nextTick=="function"?process.nextTick:null;e?e(r):setTimeout(r,0)}});var FA=M((S_e,A9)=>{var N9=R9();A9.exports=Nse;function Nse(r){var e=!1;return N9(function(){e=!0}),function(n,i){e?r(n,i):N9(function(){r(n,i)})}}});var LA=M((x_e,M9)=>{M9.exports=Ase;function Ase(r){Object.keys(r.jobs).forEach(Mse.bind(r)),r.jobs={}}function Mse(r){typeof this.jobs[r]=="function"&&this.jobs[r]()}});var UA=M((C_e,K9)=>{var O9=FA(),Ose=LA();K9.exports=Kse;function Kse(r,e,t,n){var i=t.keyedList?t.keyedList[t.index]:t.index;t.jobs[i]=Fse(e,i,r[i],function(o,s){i in t.jobs&&(delete t.jobs[i],o?Ose(t):t.results[i]=s,n(o,t.results))})}function Fse(r,e,t,n){var i;return r.length==2?i=r(t,O9(n)):i=r(t,e,O9(n)),i}});var WA=M((E_e,F9)=>{F9.exports=Lse;function Lse(r,e){var t=!Array.isArray(r),n={index:0,keyedList:t||e?Object.keys(r):null,jobs:{},results:t?{}:[],size:t?Object.keys(r).length:r.length};return e&&n.keyedList.sort(t?e:function(i,o){return e(r[i],r[o])}),n}});var jA=M((w_e,L9)=>{var Use=LA(),Wse=FA();L9.exports=jse;function jse(r){Object.keys(this.jobs).length&&(this.index=this.size,Use(this),Wse(r)(null,this.results))}});var W9=M((k_e,U9)=>{var Vse=UA(),Bse=WA(),qse=jA();U9.exports=Jse;function Jse(r,e,t){for(var n=Bse(r);n.index<(n.keyedList||r).length;)Vse(r,e,n,function(i,o){if(i){t(i,o);return}if(Object.keys(n.jobs).length===0){t(null,n.results);return}}),n.index++;return qse.bind(n,t)}});var VA=M((P_e,Vk)=>{var j9=UA(),$se=WA(),Hse=jA();Vk.exports=Gse;Vk.exports.ascending=V9;Vk.exports.descending=zse;function Gse(r,e,t,n){var i=$se(r,t);return j9(r,e,i,function o(s,a){if(s){n(s,a);return}if(i.index++,i.index<(i.keyedList||r).length){j9(r,e,i,o);return}n(null,i.results)}),Hse.bind(i,n)}function V9(r,e){return r<e?-1:r>e?1:0}function zse(r,e){return-1*V9(r,e)}});var q9=M((D_e,B9)=>{var Qse=VA();B9.exports=Yse;function Yse(r,e,t){return Qse(r,e,null,t)}});var $9=M((T_e,J9)=>{J9.exports={parallel:W9(),serial:q9(),serialOrdered:VA()}});var G9=M((__e,H9)=>{H9.exports=function(r,e){return Object.keys(e).forEach(function(t){r[t]=r[t]||e[t]}),r}});var Y9=M((R_e,Q9)=>{var $A=C9(),z9=require("util"),BA=require("path"),Xse=require("http"),Zse=require("https"),eae=require("url").parse,tae=require("fs"),rae=require("stream").Stream,qA=T9(),nae=$9(),JA=G9();Q9.exports=or;z9.inherits(or,$A);function or(r){if(!(this instanceof or))return new or(r);this._overheadLength=0,this._valueLength=0,this._valuesToMeasure=[],$A.call(this),r=r||{};for(var e in r)this[e]=r[e]}or.LINE_BREAK=`\r
`;or.DEFAULT_CONTENT_TYPE="application/octet-stream";or.prototype.append=function(r,e,t){t=t||{},typeof t=="string"&&(t={filename:t});var n=$A.prototype.append.bind(this);if(typeof e=="number"&&(e=""+e),z9.isArray(e)){this._error(new Error("Arrays are not supported."));return}var i=this._multiPartHeader(r,e,t),o=this._multiPartFooter();n(i),n(e),n(o),this._trackLength(i,e,t)};or.prototype._trackLength=function(r,e,t){var n=0;t.knownLength!=null?n+=+t.knownLength:Buffer.isBuffer(e)?n=e.length:typeof e=="string"&&(n=Buffer.byteLength(e)),this._valueLength+=n,this._overheadLength+=Buffer.byteLength(r)+or.LINE_BREAK.length,!(!e||!e.path&&!(e.readable&&e.hasOwnProperty("httpVersion"))&&!(e instanceof rae))&&(t.knownLength||this._valuesToMeasure.push(e))};or.prototype._lengthRetriever=function(r,e){r.hasOwnProperty("fd")?r.end!=null&&r.end!=1/0&&r.start!=null?e(null,r.end+1-(r.start?r.start:0)):tae.stat(r.path,function(t,n){var i;if(t){e(t);return}i=n.size-(r.start?r.start:0),e(null,i)}):r.hasOwnProperty("httpVersion")?e(null,+r.headers["content-length"]):r.hasOwnProperty("httpModule")?(r.on("response",function(t){r.pause(),e(null,+t.headers["content-length"])}),r.resume()):e("Unknown stream")};or.prototype._multiPartHeader=function(r,e,t){if(typeof t.header=="string")return t.header;var n=this._getContentDisposition(e,t),i=this._getContentType(e,t),o="",s={"Content-Disposition":["form-data",'name="'+r+'"'].concat(n||[]),"Content-Type":[].concat(i||[])};typeof t.header=="object"&&JA(s,t.header);var a;for(var l in s)s.hasOwnProperty(l)&&(a=s[l],a!=null&&(Array.isArray(a)||(a=[a]),a.length&&(o+=l+": "+a.join("; ")+or.LINE_BREAK)));return"--"+this.getBoundary()+or.LINE_BREAK+o+or.LINE_BREAK};or.prototype._getContentDisposition=function(r,e){var t,n;return typeof e.filepath=="string"?t=BA.normalize(e.filepath).replace(/\\/g,"/"):e.filename||r.name||r.path?t=BA.basename(e.filename||r.name||r.path):r.readable&&r.hasOwnProperty("httpVersion")&&(t=BA.basename(r.client._httpMessage.path||"")),t&&(n='filename="'+t+'"'),n};or.prototype._getContentType=function(r,e){var t=e.contentType;return!t&&r.name&&(t=qA.lookup(r.name)),!t&&r.path&&(t=qA.lookup(r.path)),!t&&r.readable&&r.hasOwnProperty("httpVersion")&&(t=r.headers["content-type"]),!t&&(e.filepath||e.filename)&&(t=qA.lookup(e.filepath||e.filename)),!t&&typeof r=="object"&&(t=or.DEFAULT_CONTENT_TYPE),t};or.prototype._multiPartFooter=function(){return function(r){var e=or.LINE_BREAK,t=this._streams.length===0;t&&(e+=this._lastBoundary()),r(e)}.bind(this)};or.prototype._lastBoundary=function(){return"--"+this.getBoundary()+"--"+or.LINE_BREAK};or.prototype.getHeaders=function(r){var e,t={"content-type":"multipart/form-data; boundary="+this.getBoundary()};for(e in r)r.hasOwnProperty(e)&&(t[e.toLowerCase()]=r[e]);return t};or.prototype.setBoundary=function(r){this._boundary=r};or.prototype.getBoundary=function(){return this._boundary||this._generateBoundary(),this._boundary};or.prototype.getBuffer=function(){for(var r=new Buffer.alloc(0),e=this.getBoundary(),t=0,n=this._streams.length;t<n;t++)typeof this._streams[t]!="function"&&(Buffer.isBuffer(this._streams[t])?r=Buffer.concat([r,this._streams[t]]):r=Buffer.concat([r,Buffer.from(this._streams[t])]),(typeof this._streams[t]!="string"||this._streams[t].substring(2,e.length+2)!==e)&&(r=Buffer.concat([r,Buffer.from(or.LINE_BREAK)])));return Buffer.concat([r,Buffer.from(this._lastBoundary())])};or.prototype._generateBoundary=function(){for(var r="--------------------------",e=0;e<24;e++)r+=Math.floor(Math.random()*10).toString(16);this._boundary=r};or.prototype.getLengthSync=function(){var r=this._overheadLength+this._valueLength;return this._streams.length&&(r+=this._lastBoundary().length),this.hasKnownLength()||this._error(new Error("Cannot calculate proper length in synchronous way.")),r};or.prototype.hasKnownLength=function(){var r=!0;return this._valuesToMeasure.length&&(r=!1),r};or.prototype.getLength=function(r){var e=this._overheadLength+this._valueLength;if(this._streams.length&&(e+=this._lastBoundary().length),!this._valuesToMeasure.length){process.nextTick(r.bind(this,null,e));return}nae.parallel(this._valuesToMeasure,this._lengthRetriever,function(t,n){if(t){r(t);return}n.forEach(function(i){e+=i}),r(null,e)})};or.prototype.submit=function(r,e){var t,n,i={method:"post"};return typeof r=="string"?(r=eae(r),n=JA({port:r.port,path:r.pathname,host:r.hostname,protocol:r.protocol},i)):(n=JA(r,i),n.port||(n.port=n.protocol=="https:"?443:80)),n.headers=this.getHeaders(r.headers),n.protocol=="https:"?t=Zse.request(n):t=Xse.request(n),this.getLength(function(o,s){if(o&&o!=="Unknown stream"){this._error(o);return}if(s&&t.setHeader("Content-Length",s),this.pipe(t),e){var a,l=function(c,u){return t.removeListener("error",l),t.removeListener("response",a),e.call(this,c,u)};a=l.bind(this,null),t.on("error",l),t.on("response",a)}}.bind(this)),t};or.prototype._error=function(r){this.error||(this.error=r,this.pause(),this.emit("error",r))};or.prototype.toString=function(){return"[object FormData]"}});var Z9=M(X9=>{"use strict";var iae=require("url").parse,oae={ftp:21,gopher:70,http:80,https:443,ws:80,wss:443},sae=String.prototype.endsWith||function(r){return r.length<=this.length&&this.indexOf(r,this.length-r.length)!==-1};function aae(r){var e=typeof r=="string"?iae(r):r||{},t=e.protocol,n=e.host,i=e.port;if(typeof n!="string"||!n||typeof t!="string"||(t=t.split(":",1)[0],n=n.replace(/:\d*$/,""),i=parseInt(i)||oae[t]||0,!lae(n,i)))return"";var o=hg("npm_config_"+t+"_proxy")||hg(t+"_proxy")||hg("npm_config_proxy")||hg("all_proxy");return o&&o.indexOf("://")===-1&&(o=t+"://"+o),o}function lae(r,e){var t=(hg("npm_config_no_proxy")||hg("no_proxy")).toLowerCase();return t?t==="*"?!1:t.split(/[,\s]/).every(function(n){if(!n)return!0;var i=n.match(/^(.+):(\d+)$/),o=i?i[1]:n,s=i?parseInt(i[2]):0;return s&&s!==e?!0:/^[.*]/.test(o)?(o.charAt(0)==="*"&&(o=o.slice(1)),!sae.call(r,o)):r!==o}):!0}function hg(r){return process.env[r.toLowerCase()]||process.env[r.toUpperCase()]||""}X9.getProxyForUrl=aae});var qk=M((A_e,e3)=>{var gg=1e3,vg=gg*60,yg=vg*60,hm=yg*24,cae=hm*7,uae=hm*365.25;e3.exports=function(r,e){e=e||{};var t=typeof r;if(t==="string"&&r.length>0)return pae(r);if(t==="number"&&isFinite(r))return e.long?mae(r):dae(r);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(r))};function pae(r){if(r=String(r),!(r.length>100)){var e=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(r);if(e){var t=parseFloat(e[1]),n=(e[2]||"ms").toLowerCase();switch(n){case"years":case"year":case"yrs":case"yr":case"y":return t*uae;case"weeks":case"week":case"w":return t*cae;case"days":case"day":case"d":return t*hm;case"hours":case"hour":case"hrs":case"hr":case"h":return t*yg;case"minutes":case"minute":case"mins":case"min":case"m":return t*vg;case"seconds":case"second":case"secs":case"sec":case"s":return t*gg;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return t;default:return}}}}function dae(r){var e=Math.abs(r);return e>=hm?Math.round(r/hm)+"d":e>=yg?Math.round(r/yg)+"h":e>=vg?Math.round(r/vg)+"m":e>=gg?Math.round(r/gg)+"s":r+"ms"}function mae(r){var e=Math.abs(r);return e>=hm?Bk(r,e,hm,"day"):e>=yg?Bk(r,e,yg,"hour"):e>=vg?Bk(r,e,vg,"minute"):e>=gg?Bk(r,e,gg,"second"):r+" ms"}function Bk(r,e,t,n){var i=e>=t*1.5;return Math.round(r/t)+" "+n+(i?"s":"")}});var HA=M((M_e,t3)=>{function fae(r){t.debug=t,t.default=t,t.coerce=l,t.disable=o,t.enable=i,t.enabled=s,t.humanize=qk(),t.destroy=c,Object.keys(r).forEach(u=>{t[u]=r[u]}),t.names=[],t.skips=[],t.formatters={};function e(u){let d=0;for(let f=0;f<u.length;f++)d=(d<<5)-d+u.charCodeAt(f),d|=0;return t.colors[Math.abs(d)%t.colors.length]}t.selectColor=e;function t(u){let d,f=null,h,v;function S(...b){if(!S.enabled)return;let D=S,_=Number(new Date),L=_-(d||_);D.diff=L,D.prev=d,D.curr=_,d=_,b[0]=t.coerce(b[0]),typeof b[0]!="string"&&b.unshift("%O");let Z=0;b[0]=b[0].replace(/%([a-zA-Z%])/g,(ie,fe)=>{if(ie==="%%")return"%";Z++;let de=t.formatters[fe];if(typeof de=="function"){let ae=b[Z];ie=de.call(D,ae),b.splice(Z,1),Z--}return ie}),t.formatArgs.call(D,b),(D.log||t.log).apply(D,b)}return S.namespace=u,S.useColors=t.useColors(),S.color=t.selectColor(u),S.extend=n,S.destroy=t.destroy,Object.defineProperty(S,"enabled",{enumerable:!0,configurable:!1,get:()=>f!==null?f:(h!==t.namespaces&&(h=t.namespaces,v=t.enabled(u)),v),set:b=>{f=b}}),typeof t.init=="function"&&t.init(S),S}function n(u,d){let f=t(this.namespace+(typeof d>"u"?":":d)+u);return f.log=this.log,f}function i(u){t.save(u),t.namespaces=u,t.names=[],t.skips=[];let d,f=(typeof u=="string"?u:"").split(/[\s,]+/),h=f.length;for(d=0;d<h;d++)f[d]&&(u=f[d].replace(/\*/g,".*?"),u[0]==="-"?t.skips.push(new RegExp("^"+u.slice(1)+"$")):t.names.push(new RegExp("^"+u+"$")))}function o(){let u=[...t.names.map(a),...t.skips.map(a).map(d=>"-"+d)].join(",");return t.enable(""),u}function s(u){if(u[u.length-1]==="*")return!0;let d,f;for(d=0,f=t.skips.length;d<f;d++)if(t.skips[d].test(u))return!1;for(d=0,f=t.names.length;d<f;d++)if(t.names[d].test(u))return!0;return!1}function a(u){return u.toString().substring(2,u.toString().length-2).replace(/\.\*\?$/,"*")}function l(u){return u instanceof Error?u.stack||u.message:u}function c(){console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.")}return t.enable(t.load()),t}t3.exports=fae});var r3=M((Ho,Jk)=>{Ho.formatArgs=gae;Ho.save=vae;Ho.load=yae;Ho.useColors=hae;Ho.storage=bae();Ho.destroy=(()=>{let r=!1;return()=>{r||(r=!0,console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`."))}})();Ho.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"];function hae(){return typeof window<"u"&&window.process&&(window.process.type==="renderer"||window.process.__nwjs)?!0:typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/)?!1:typeof document<"u"&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||typeof window<"u"&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31||typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)}function gae(r){if(r[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+r[0]+(this.useColors?"%c ":" ")+"+"+Jk.exports.humanize(this.diff),!this.useColors)return;let e="color: "+this.color;r.splice(1,0,e,"color: inherit");let t=0,n=0;r[0].replace(/%[a-zA-Z%]/g,i=>{i!=="%%"&&(t++,i==="%c"&&(n=t))}),r.splice(n,0,e)}Ho.log=console.debug||console.log||(()=>{});function vae(r){try{r?Ho.storage.setItem("debug",r):Ho.storage.removeItem("debug")}catch{}}function yae(){let r;try{r=Ho.storage.getItem("debug")}catch{}return!r&&typeof process<"u"&&"env"in process&&(r=process.env.DEBUG),r}function bae(){try{return localStorage}catch{}}Jk.exports=HA()(Ho);var{formatters:Iae}=Jk.exports;Iae.j=function(r){try{return JSON.stringify(r)}catch(e){return"[UnexpectedJSONParseError]: "+e.message}}});var i3=M((O_e,n3)=>{"use strict";n3.exports=(r,e)=>{e=e||process.argv;let t=r.startsWith("-")?"":r.length===1?"-":"--",n=e.indexOf(t+r),i=e.indexOf("--");return n!==-1&&(i===-1?!0:n<i)}});var $k=M((K_e,o3)=>{"use strict";var Sae=require("os"),ka=i3(),Bi=process.env,bg;ka("no-color")||ka("no-colors")||ka("color=false")?bg=!1:(ka("color")||ka("colors")||ka("color=true")||ka("color=always"))&&(bg=!0);"FORCE_COLOR"in Bi&&(bg=Bi.FORCE_COLOR.length===0||parseInt(Bi.FORCE_COLOR,10)!==0);function xae(r){return r===0?!1:{level:r,hasBasic:!0,has256:r>=2,has16m:r>=3}}function Cae(r){if(bg===!1)return 0;if(ka("color=16m")||ka("color=full")||ka("color=truecolor"))return 3;if(ka("color=256"))return 2;if(r&&!r.isTTY&&bg!==!0)return 0;let e=bg?1:0;if(process.platform==="win32"){let t=Sae.release().split(".");return Number(process.versions.node.split(".")[0])>=8&&Number(t[0])>=10&&Number(t[2])>=10586?Number(t[2])>=14931?3:2:1}if("CI"in Bi)return["TRAVIS","CIRCLECI","APPVEYOR","GITLAB_CI"].some(t=>t in Bi)||Bi.CI_NAME==="codeship"?1:e;if("TEAMCITY_VERSION"in Bi)return/^(9\.(0*[1-9]\d*)\.|\d{2,}\.)/.test(Bi.TEAMCITY_VERSION)?1:0;if(Bi.COLORTERM==="truecolor")return 3;if("TERM_PROGRAM"in Bi){let t=parseInt((Bi.TERM_PROGRAM_VERSION||"").split(".")[0],10);switch(Bi.TERM_PROGRAM){case"iTerm.app":return t>=3?3:2;case"Apple_Terminal":return 2}}return/-256(color)?$/i.test(Bi.TERM)?2:/^screen|^xterm|^vt100|^vt220|^rxvt|color|ansi|cygwin|linux/i.test(Bi.TERM)||"COLORTERM"in Bi?1:(Bi.TERM==="dumb",e)}function GA(r){let e=Cae(r);return xae(e)}o3.exports={supportsColor:GA,stdout:GA(process.stdout),stderr:GA(process.stderr)}});var a3=M((Ii,Gk)=>{var Eae=require("tty"),Hk=require("util");Ii.init=Rae;Ii.log=Dae;Ii.formatArgs=kae;Ii.save=Tae;Ii.load=_ae;Ii.useColors=wae;Ii.destroy=Hk.deprecate(()=>{},"Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.");Ii.colors=[6,2,3,4,5,1];try{let r=$k();r&&(r.stderr||r).level>=2&&(Ii.colors=[20,21,26,27,32,33,38,39,40,41,42,43,44,45,56,57,62,63,68,69,74,75,76,77,78,79,80,81,92,93,98,99,112,113,128,129,134,135,148,149,160,161,162,163,164,165,166,167,168,169,170,171,172,173,178,179,184,185,196,197,198,199,200,201,202,203,204,205,206,207,208,209,214,215,220,221])}catch{}Ii.inspectOpts=Object.keys(process.env).filter(r=>/^debug_/i.test(r)).reduce((r,e)=>{let t=e.substring(6).toLowerCase().replace(/_([a-z])/g,(i,o)=>o.toUpperCase()),n=process.env[e];return/^(yes|on|true|enabled)$/i.test(n)?n=!0:/^(no|off|false|disabled)$/i.test(n)?n=!1:n==="null"?n=null:n=Number(n),r[t]=n,r},{});function wae(){return"colors"in Ii.inspectOpts?!!Ii.inspectOpts.colors:Eae.isatty(process.stderr.fd)}function kae(r){let{namespace:e,useColors:t}=this;if(t){let n=this.color,i="\x1B[3"+(n<8?n:"8;5;"+n),o=`  ${i};1m${e} \x1B[0m`;r[0]=o+r[0].split(`
`).join(`
`+o),r.push(i+"m+"+Gk.exports.humanize(this.diff)+"\x1B[0m")}else r[0]=Pae()+e+" "+r[0]}function Pae(){return Ii.inspectOpts.hideDate?"":new Date().toISOString()+" "}function Dae(...r){return process.stderr.write(Hk.format(...r)+`
`)}function Tae(r){r?process.env.DEBUG=r:delete process.env.DEBUG}function _ae(){return process.env.DEBUG}function Rae(r){r.inspectOpts={};let e=Object.keys(Ii.inspectOpts);for(let t=0;t<e.length;t++)r.inspectOpts[e[t]]=Ii.inspectOpts[e[t]]}Gk.exports=HA()(Ii);var{formatters:s3}=Gk.exports;s3.o=function(r){return this.inspectOpts.colors=this.useColors,Hk.inspect(r,this.inspectOpts).split(`
`).map(e=>e.trim()).join(" ")};s3.O=function(r){return this.inspectOpts.colors=this.useColors,Hk.inspect(r,this.inspectOpts)}});var l3=M((F_e,zA)=>{typeof process>"u"||process.type==="renderer"||process.browser===!0||process.__nwjs?zA.exports=r3():zA.exports=a3()});var u3=M((L_e,c3)=>{var Ex;c3.exports=function(){if(!Ex){try{Ex=l3()("follow-redirects")}catch{}typeof Ex!="function"&&(Ex=function(){})}Ex.apply(null,arguments)}});var v3=M((U_e,rM)=>{var gm=require("url"),QA=gm.URL,Nae=require("http"),Aae=require("https"),XA=require("stream").Writable,m3=require("assert"),f3=u3(),ZA=["abort","aborted","connect","error","socket","timeout"],eM=Object.create(null);ZA.forEach(function(r){eM[r]=function(e,t,n){this._redirectable.emit(r,e,t,n)}});var Mae=kx("ERR_INVALID_URL","Invalid URL",TypeError),p3=kx("ERR_FR_REDIRECTION_FAILURE","Redirected request failed"),Oae=kx("ERR_FR_TOO_MANY_REDIRECTS","Maximum number of redirects exceeded"),Kae=kx("ERR_FR_MAX_BODY_LENGTH_EXCEEDED","Request body larger than maxBodyLength limit"),Fae=kx("ERR_STREAM_WRITE_AFTER_END","write after end"),Lae=XA.prototype.destroy||g3;function Po(r,e){XA.call(this),this._sanitizeOptions(r),this._options=r,this._ended=!1,this._ending=!1,this._redirectCount=0,this._redirects=[],this._requestBodyLength=0,this._requestBodyBuffers=[],e&&this.on("response",e);var t=this;this._onNativeResponse=function(n){t._processResponse(n)},this._performRequest()}Po.prototype=Object.create(XA.prototype);Po.prototype.abort=function(){tM(this._currentRequest),this._currentRequest.abort(),this.emit("abort")};Po.prototype.destroy=function(r){return tM(this._currentRequest,r),Lae.call(this,r),this};Po.prototype.write=function(r,e,t){if(this._ending)throw new Fae;if(!vm(r)&&!Wae(r))throw new TypeError("data should be a string, Buffer or Uint8Array");if(wx(e)&&(t=e,e=null),r.length===0){t&&t();return}this._requestBodyLength+r.length<=this._options.maxBodyLength?(this._requestBodyLength+=r.length,this._requestBodyBuffers.push({data:r,encoding:e}),this._currentRequest.write(r,e,t)):(this.emit("error",new Kae),this.abort())};Po.prototype.end=function(r,e,t){if(wx(r)?(t=r,r=e=null):wx(e)&&(t=e,e=null),!r)this._ended=this._ending=!0,this._currentRequest.end(null,null,t);else{var n=this,i=this._currentRequest;this.write(r,e,function(){n._ended=!0,i.end(null,null,t)}),this._ending=!0}};Po.prototype.setHeader=function(r,e){this._options.headers[r]=e,this._currentRequest.setHeader(r,e)};Po.prototype.removeHeader=function(r){delete this._options.headers[r],this._currentRequest.removeHeader(r)};Po.prototype.setTimeout=function(r,e){var t=this;function n(s){s.setTimeout(r),s.removeListener("timeout",s.destroy),s.addListener("timeout",s.destroy)}function i(s){t._timeout&&clearTimeout(t._timeout),t._timeout=setTimeout(function(){t.emit("timeout"),o()},r),n(s)}function o(){t._timeout&&(clearTimeout(t._timeout),t._timeout=null),t.removeListener("abort",o),t.removeListener("error",o),t.removeListener("response",o),t.removeListener("close",o),e&&t.removeListener("timeout",e),t.socket||t._currentRequest.removeListener("socket",i)}return e&&this.on("timeout",e),this.socket?i(this.socket):this._currentRequest.once("socket",i),this.on("socket",n),this.on("abort",o),this.on("error",o),this.on("response",o),this.on("close",o),this};["flushHeaders","getHeader","setNoDelay","setSocketKeepAlive"].forEach(function(r){Po.prototype[r]=function(e,t){return this._currentRequest[r](e,t)}});["aborted","connection","socket"].forEach(function(r){Object.defineProperty(Po.prototype,r,{get:function(){return this._currentRequest[r]}})});Po.prototype._sanitizeOptions=function(r){if(r.headers||(r.headers={}),r.host&&(r.hostname||(r.hostname=r.host),delete r.host),!r.pathname&&r.path){var e=r.path.indexOf("?");e<0?r.pathname=r.path:(r.pathname=r.path.substring(0,e),r.search=r.path.substring(e))}};Po.prototype._performRequest=function(){var r=this._options.protocol,e=this._options.nativeProtocols[r];if(!e){this.emit("error",new TypeError("Unsupported protocol "+r));return}if(this._options.agents){var t=r.slice(0,-1);this._options.agent=this._options.agents[t]}var n=this._currentRequest=e.request(this._options,this._onNativeResponse);n._redirectable=this;for(var i of ZA)n.on(i,eM[i]);if(this._currentUrl=/^\//.test(this._options.path)?gm.format(this._options):this._options.path,this._isRedirect){var o=0,s=this,a=this._requestBodyBuffers;(function l(c){if(n===s._currentRequest)if(c)s.emit("error",c);else if(o<a.length){var u=a[o++];n.finished||n.write(u.data,u.encoding,l)}else s._ended&&n.end()})()}};Po.prototype._processResponse=function(r){var e=r.statusCode;this._options.trackRedirects&&this._redirects.push({url:this._currentUrl,headers:r.headers,statusCode:e});var t=r.headers.location;if(!t||this._options.followRedirects===!1||e<300||e>=400){r.responseUrl=this._currentUrl,r.redirects=this._redirects,this.emit("response",r),this._requestBodyBuffers=[];return}if(tM(this._currentRequest),r.destroy(),++this._redirectCount>this._options.maxRedirects){this.emit("error",new Oae);return}var n,i=this._options.beforeRedirect;i&&(n=Object.assign({Host:r.req.getHeader("host")},this._options.headers));var o=this._options.method;((e===301||e===302)&&this._options.method==="POST"||e===303&&!/^(?:GET|HEAD)$/.test(this._options.method))&&(this._options.method="GET",this._requestBodyBuffers=[],YA(/^content-/i,this._options.headers));var s=YA(/^host$/i,this._options.headers),a=gm.parse(this._currentUrl),l=s||a.host,c=/^\w+:/.test(t)?this._currentUrl:gm.format(Object.assign(a,{host:l})),u;try{u=gm.resolve(c,t)}catch(v){this.emit("error",new p3({cause:v}));return}f3("redirecting to",u),this._isRedirect=!0;var d=gm.parse(u);if(Object.assign(this._options,d),(d.protocol!==a.protocol&&d.protocol!=="https:"||d.host!==l&&!Uae(d.host,l))&&YA(/^(?:authorization|cookie)$/i,this._options.headers),wx(i)){var f={headers:r.headers,statusCode:e},h={url:c,method:o,headers:n};try{i(this._options,f,h)}catch(v){this.emit("error",v);return}this._sanitizeOptions(this._options)}try{this._performRequest()}catch(v){this.emit("error",new p3({cause:v}))}};function h3(r){var e={maxRedirects:21,maxBodyLength:10485760},t={};return Object.keys(r).forEach(function(n){var i=n+":",o=t[i]=r[n],s=e[n]=Object.create(o);function a(c,u,d){if(vm(c)){var f;try{f=d3(new QA(c))}catch{f=gm.parse(c)}if(!vm(f.protocol))throw new Mae({input:c});c=f}else QA&&c instanceof QA?c=d3(c):(d=u,u=c,c={protocol:i});return wx(u)&&(d=u,u=null),u=Object.assign({maxRedirects:e.maxRedirects,maxBodyLength:e.maxBodyLength},c,u),u.nativeProtocols=t,!vm(u.host)&&!vm(u.hostname)&&(u.hostname="::1"),m3.equal(u.protocol,i,"protocol mismatch"),f3("options",u),new Po(u,d)}function l(c,u,d){var f=s.request(c,u,d);return f.end(),f}Object.defineProperties(s,{request:{value:a,configurable:!0,enumerable:!0,writable:!0},get:{value:l,configurable:!0,enumerable:!0,writable:!0}})}),e}function g3(){}function d3(r){var e={protocol:r.protocol,hostname:r.hostname.startsWith("[")?r.hostname.slice(1,-1):r.hostname,hash:r.hash,search:r.search,pathname:r.pathname,path:r.pathname+r.search,href:r.href};return r.port!==""&&(e.port=Number(r.port)),e}function YA(r,e){var t;for(var n in e)r.test(n)&&(t=e[n],delete e[n]);return t===null||typeof t>"u"?void 0:String(t).trim()}function kx(r,e,t){function n(i){Error.captureStackTrace(this,this.constructor),Object.assign(this,i||{}),this.code=r,this.message=this.cause?e+": "+this.cause.message:e}return n.prototype=new(t||Error),n.prototype.constructor=n,n.prototype.name="Error ["+r+"]",n}function tM(r,e){for(var t of ZA)r.removeListener(t,eM[t]);r.on("error",g3),r.destroy(e)}function Uae(r,e){m3(vm(r)&&vm(e));var t=r.length-e.length-1;return t>0&&r[t]==="."&&r.endsWith(e)}function vm(r){return typeof r=="string"||r instanceof String}function wx(r){return typeof r=="function"}function Wae(r){return typeof r=="object"&&"length"in r}rM.exports=h3({http:Nae,https:Aae});rM.exports.wrap=h3});var aB=M((W_e,sB)=>{"use strict";var jae=Y9(),Vae=require("url"),Bae=Z9(),qae=require("http"),Jae=require("https"),O3=require("util"),$ae=v3(),Hae=require("zlib"),K3=require("stream"),Gae=require("events");function jc(r){return r&&typeof r=="object"&&"default"in r?r:{default:r}}var F3=jc(jae),zae=jc(Vae),Qae=jc(qae),Yae=jc(Jae),Xae=jc(O3),Zae=jc($ae),Pp=jc(Hae),wp=jc(K3),ele=jc(Gae);function L3(r,e){return function(){return r.apply(e,arguments)}}var{toString:tle}=Object.prototype,{getPrototypeOf:vM}=Object,eP=(r=>e=>{let t=tle.call(e);return r[t]||(r[t]=t.slice(8,-1).toLowerCase())})(Object.create(null)),jl=r=>(r=r.toLowerCase(),e=>eP(e)===r),tP=r=>e=>typeof e===r,{isArray:Cg}=Array,Tx=tP("undefined");function rle(r){return r!==null&&!Tx(r)&&r.constructor!==null&&!Tx(r.constructor)&&Os(r.constructor.isBuffer)&&r.constructor.isBuffer(r)}var U3=jl("ArrayBuffer");function nle(r){let e;return typeof ArrayBuffer<"u"&&ArrayBuffer.isView?e=ArrayBuffer.isView(r):e=r&&r.buffer&&U3(r.buffer),e}var ile=tP("string"),Os=tP("function"),W3=tP("number"),rP=r=>r!==null&&typeof r=="object",ole=r=>r===!0||r===!1,Qk=r=>{if(eP(r)!=="object")return!1;let e=vM(r);return(e===null||e===Object.prototype||Object.getPrototypeOf(e)===null)&&!(Symbol.toStringTag in r)&&!(Symbol.iterator in r)},sle=jl("Date"),ale=jl("File"),lle=jl("Blob"),cle=jl("FileList"),ule=r=>rP(r)&&Os(r.pipe),ple=r=>{let e;return r&&(typeof FormData=="function"&&r instanceof FormData||Os(r.append)&&((e=eP(r))==="formdata"||e==="object"&&Os(r.toString)&&r.toString()==="[object FormData]"))},dle=jl("URLSearchParams"),mle=r=>r.trim?r.trim():r.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"");function Rx(r,e,{allOwnKeys:t=!1}={}){if(r===null||typeof r>"u")return;let n,i;if(typeof r!="object"&&(r=[r]),Cg(r))for(n=0,i=r.length;n<i;n++)e.call(null,r[n],n,r);else{let o=t?Object.getOwnPropertyNames(r):Object.keys(r),s=o.length,a;for(n=0;n<s;n++)a=o[n],e.call(null,r[a],a,r)}}function j3(r,e){e=e.toLowerCase();let t=Object.keys(r),n=t.length,i;for(;n-- >0;)if(i=t[n],e===i.toLowerCase())return i;return null}var V3=(()=>typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:global)(),B3=r=>!Tx(r)&&r!==V3;function aM(){let{caseless:r}=B3(this)&&this||{},e={},t=(n,i)=>{let o=r&&j3(e,i)||i;Qk(e[o])&&Qk(n)?e[o]=aM(e[o],n):Qk(n)?e[o]=aM({},n):Cg(n)?e[o]=n.slice():e[o]=n};for(let n=0,i=arguments.length;n<i;n++)arguments[n]&&Rx(arguments[n],t);return e}var fle=(r,e,t,{allOwnKeys:n}={})=>(Rx(e,(i,o)=>{t&&Os(i)?r[o]=L3(i,t):r[o]=i},{allOwnKeys:n}),r),hle=r=>(r.charCodeAt(0)===65279&&(r=r.slice(1)),r),gle=(r,e,t,n)=>{r.prototype=Object.create(e.prototype,n),r.prototype.constructor=r,Object.defineProperty(r,"super",{value:e.prototype}),t&&Object.assign(r.prototype,t)},vle=(r,e,t,n)=>{let i,o,s,a={};if(e=e||{},r==null)return e;do{for(i=Object.getOwnPropertyNames(r),o=i.length;o-- >0;)s=i[o],(!n||n(s,r,e))&&!a[s]&&(e[s]=r[s],a[s]=!0);r=t!==!1&&vM(r)}while(r&&(!t||t(r,e))&&r!==Object.prototype);return e},yle=(r,e,t)=>{r=String(r),(t===void 0||t>r.length)&&(t=r.length),t-=e.length;let n=r.indexOf(e,t);return n!==-1&&n===t},ble=r=>{if(!r)return null;if(Cg(r))return r;let e=r.length;if(!W3(e))return null;let t=new Array(e);for(;e-- >0;)t[e]=r[e];return t},Ile=(r=>e=>r&&e instanceof r)(typeof Uint8Array<"u"&&vM(Uint8Array)),Sle=(r,e)=>{let n=(r&&r[Symbol.iterator]).call(r),i;for(;(i=n.next())&&!i.done;){let o=i.value;e.call(r,o[0],o[1])}},xle=(r,e)=>{let t,n=[];for(;(t=r.exec(e))!==null;)n.push(t);return n},Cle=jl("HTMLFormElement"),Ele=r=>r.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,function(t,n,i){return n.toUpperCase()+i}),y3=(({hasOwnProperty:r})=>(e,t)=>r.call(e,t))(Object.prototype),wle=jl("RegExp"),q3=(r,e)=>{let t=Object.getOwnPropertyDescriptors(r),n={};Rx(t,(i,o)=>{let s;(s=e(i,o,r))!==!1&&(n[o]=s||i)}),Object.defineProperties(r,n)},kle=r=>{q3(r,(e,t)=>{if(Os(r)&&["arguments","caller","callee"].indexOf(t)!==-1)return!1;let n=r[t];if(Os(n)){if(e.enumerable=!1,"writable"in e){e.writable=!1;return}e.set||(e.set=()=>{throw Error("Can not rewrite read-only method '"+t+"'")})}})},Ple=(r,e)=>{let t={},n=i=>{i.forEach(o=>{t[o]=!0})};return Cg(r)?n(r):n(String(r).split(e)),t},Dle=()=>{},Tle=(r,e)=>(r=+r,Number.isFinite(r)?r:e),nM="abcdefghijklmnopqrstuvwxyz",b3="0123456789",J3={DIGIT:b3,ALPHA:nM,ALPHA_DIGIT:nM+nM.toUpperCase()+b3},_le=(r=16,e=J3.ALPHA_DIGIT)=>{let t="",{length:n}=e;for(;r--;)t+=e[Math.random()*n|0];return t};function Rle(r){return!!(r&&Os(r.append)&&r[Symbol.toStringTag]==="FormData"&&r[Symbol.iterator])}var Nle=r=>{let e=new Array(10),t=(n,i)=>{if(rP(n)){if(e.indexOf(n)>=0)return;if(!("toJSON"in n)){e[i]=n;let o=Cg(n)?[]:{};return Rx(n,(s,a)=>{let l=t(s,i+1);!Tx(l)&&(o[a]=l)}),e[i]=void 0,o}}return n};return t(r,0)},Ale=jl("AsyncFunction"),Mle=r=>r&&(rP(r)||Os(r))&&Os(r.then)&&Os(r.catch),X={isArray:Cg,isArrayBuffer:U3,isBuffer:rle,isFormData:ple,isArrayBufferView:nle,isString:ile,isNumber:W3,isBoolean:ole,isObject:rP,isPlainObject:Qk,isUndefined:Tx,isDate:sle,isFile:ale,isBlob:lle,isRegExp:wle,isFunction:Os,isStream:ule,isURLSearchParams:dle,isTypedArray:Ile,isFileList:cle,forEach:Rx,merge:aM,extend:fle,trim:mle,stripBOM:hle,inherits:gle,toFlatObject:vle,kindOf:eP,kindOfTest:jl,endsWith:yle,toArray:ble,forEachEntry:Sle,matchAll:xle,isHTMLForm:Cle,hasOwnProperty:y3,hasOwnProp:y3,reduceDescriptors:q3,freezeMethods:kle,toObjectSet:Ple,toCamelCase:Ele,noop:Dle,toFiniteNumber:Tle,findKey:j3,global:V3,isContextDefined:B3,ALPHABET:J3,generateString:_le,isSpecCompliantForm:Rle,toJSONObject:Nle,isAsyncFn:Ale,isThenable:Mle};function et(r,e,t,n,i){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=new Error().stack,this.message=r,this.name="AxiosError",e&&(this.code=e),t&&(this.config=t),n&&(this.request=n),i&&(this.response=i)}X.inherits(et,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:X.toJSONObject(this.config),code:this.code,status:this.response&&this.response.status?this.response.status:null}}});var $3=et.prototype,H3={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach(r=>{H3[r]={value:r}});Object.defineProperties(et,H3);Object.defineProperty($3,"isAxiosError",{value:!0});et.from=(r,e,t,n,i,o)=>{let s=Object.create($3);return X.toFlatObject(r,s,function(l){return l!==Error.prototype},a=>a!=="isAxiosError"),et.call(s,r.message,e,t,n,i),s.cause=r,s.name=r.name,o&&Object.assign(s,o),s};function lM(r){return X.isPlainObject(r)||X.isArray(r)}function G3(r){return X.endsWith(r,"[]")?r.slice(0,-2):r}function I3(r,e,t){return r?r.concat(e).map(function(i,o){return i=G3(i),!t&&o?"["+i+"]":i}).join(t?".":""):e}function Ole(r){return X.isArray(r)&&!r.some(lM)}var Kle=X.toFlatObject(X,{},null,function(e){return/^is[A-Z]/.test(e)});function nP(r,e,t){if(!X.isObject(r))throw new TypeError("target must be an object");e=e||new(F3.default||FormData),t=X.toFlatObject(t,{metaTokens:!0,dots:!1,indexes:!1},!1,function(S,b){return!X.isUndefined(b[S])});let n=t.metaTokens,i=t.visitor||u,o=t.dots,s=t.indexes,l=(t.Blob||typeof Blob<"u"&&Blob)&&X.isSpecCompliantForm(e);if(!X.isFunction(i))throw new TypeError("visitor must be a function");function c(v){if(v===null)return"";if(X.isDate(v))return v.toISOString();if(!l&&X.isBlob(v))throw new et("Blob is not supported. Use a Buffer instead.");return X.isArrayBuffer(v)||X.isTypedArray(v)?l&&typeof Blob=="function"?new Blob([v]):Buffer.from(v):v}function u(v,S,b){let D=v;if(v&&!b&&typeof v=="object"){if(X.endsWith(S,"{}"))S=n?S:S.slice(0,-2),v=JSON.stringify(v);else if(X.isArray(v)&&Ole(v)||(X.isFileList(v)||X.endsWith(S,"[]"))&&(D=X.toArray(v)))return S=G3(S),D.forEach(function(L,Z){!(X.isUndefined(L)||L===null)&&e.append(s===!0?I3([S],Z,o):s===null?S:S+"[]",c(L))}),!1}return lM(v)?!0:(e.append(I3(b,S,o),c(v)),!1)}let d=[],f=Object.assign(Kle,{defaultVisitor:u,convertValue:c,isVisitable:lM});function h(v,S){if(!X.isUndefined(v)){if(d.indexOf(v)!==-1)throw Error("Circular reference detected in "+S.join("."));d.push(v),X.forEach(v,function(D,_){(!(X.isUndefined(D)||D===null)&&i.call(e,D,X.isString(_)?_.trim():_,S,f))===!0&&h(D,S?S.concat(_):[_])}),d.pop()}}if(!X.isObject(r))throw new TypeError("data must be an object");return h(r),e}function S3(r){let e={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(r).replace(/[!'()~]|%20|%00/g,function(n){return e[n]})}function z3(r,e){this._pairs=[],r&&nP(r,this,e)}var Q3=z3.prototype;Q3.append=function(e,t){this._pairs.push([e,t])};Q3.toString=function(e){let t=e?function(n){return e.call(this,n,S3)}:S3;return this._pairs.map(function(i){return t(i[0])+"="+t(i[1])},"").join("&")};function Fle(r){return encodeURIComponent(r).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}function yM(r,e,t){if(!e)return r;let n=t&&t.encode||Fle,i=t&&t.serialize,o;if(i?o=i(e,t):o=X.isURLSearchParams(e)?e.toString():new z3(e,t).toString(n),o){let s=r.indexOf("#");s!==-1&&(r=r.slice(0,s)),r+=(r.indexOf("?")===-1?"?":"&")+o}return r}var cM=class{constructor(){this.handlers=[]}use(e,t,n){return this.handlers.push({fulfilled:e,rejected:t,synchronous:n?n.synchronous:!1,runWhen:n?n.runWhen:null}),this.handlers.length-1}eject(e){this.handlers[e]&&(this.handlers[e]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(e){X.forEach(this.handlers,function(n){n!==null&&e(n)})}},x3=cM,bM={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},Lle=zae.default.URLSearchParams,Ule={isNode:!0,classes:{URLSearchParams:Lle,FormData:F3.default,Blob:typeof Blob<"u"&&Blob||null},protocols:["http","https","file","data"]},Y3=typeof window<"u"&&typeof document<"u",Wle=(r=>Y3&&["ReactNative","NativeScript","NS"].indexOf(r)<0)(typeof navigator<"u"&&navigator.product),jle=(()=>typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&typeof self.importScripts=="function")(),Vle=Object.freeze({__proto__:null,hasBrowserEnv:Y3,hasStandardBrowserWebWorkerEnv:jle,hasStandardBrowserEnv:Wle}),Ms={...Vle,...Ule};function Ble(r,e){return nP(r,new Ms.classes.URLSearchParams,Object.assign({visitor:function(t,n,i,o){return Ms.isNode&&X.isBuffer(t)?(this.append(n,t.toString("base64")),!1):o.defaultVisitor.apply(this,arguments)}},e))}function qle(r){return X.matchAll(/\w+|\[(\w*)]/g,r).map(e=>e[0]==="[]"?"":e[1]||e[0])}function Jle(r){let e={},t=Object.keys(r),n,i=t.length,o;for(n=0;n<i;n++)o=t[n],e[o]=r[o];return e}function X3(r){function e(t,n,i,o){let s=t[o++],a=Number.isFinite(+s),l=o>=t.length;return s=!s&&X.isArray(i)?i.length:s,l?(X.hasOwnProp(i,s)?i[s]=[i[s],n]:i[s]=n,!a):((!i[s]||!X.isObject(i[s]))&&(i[s]=[]),e(t,n,i[s],o)&&X.isArray(i[s])&&(i[s]=Jle(i[s])),!a)}if(X.isFormData(r)&&X.isFunction(r.entries)){let t={};return X.forEachEntry(r,(n,i)=>{e(qle(n),i,t,0)}),t}return null}function $le(r,e,t){if(X.isString(r))try{return(e||JSON.parse)(r),X.trim(r)}catch(n){if(n.name!=="SyntaxError")throw n}return(t||JSON.stringify)(r)}var IM={transitional:bM,adapter:["xhr","http"],transformRequest:[function(e,t){let n=t.getContentType()||"",i=n.indexOf("application/json")>-1,o=X.isObject(e);if(o&&X.isHTMLForm(e)&&(e=new FormData(e)),X.isFormData(e))return i&&i?JSON.stringify(X3(e)):e;if(X.isArrayBuffer(e)||X.isBuffer(e)||X.isStream(e)||X.isFile(e)||X.isBlob(e))return e;if(X.isArrayBufferView(e))return e.buffer;if(X.isURLSearchParams(e))return t.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),e.toString();let a;if(o){if(n.indexOf("application/x-www-form-urlencoded")>-1)return Ble(e,this.formSerializer).toString();if((a=X.isFileList(e))||n.indexOf("multipart/form-data")>-1){let l=this.env&&this.env.FormData;return nP(a?{"files[]":e}:e,l&&new l,this.formSerializer)}}return o||i?(t.setContentType("application/json",!1),$le(e)):e}],transformResponse:[function(e){let t=this.transitional||IM.transitional,n=t&&t.forcedJSONParsing,i=this.responseType==="json";if(e&&X.isString(e)&&(n&&!this.responseType||i)){let s=!(t&&t.silentJSONParsing)&&i;try{return JSON.parse(e)}catch(a){if(s)throw a.name==="SyntaxError"?et.from(a,et.ERR_BAD_RESPONSE,this,null,this.response):a}}return e}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:Ms.classes.FormData,Blob:Ms.classes.Blob},validateStatus:function(e){return e>=200&&e<300},headers:{common:{Accept:"application/json, text/plain, */*","Content-Type":void 0}}};X.forEach(["delete","get","head","post","put","patch"],r=>{IM.headers[r]={}});var SM=IM,Hle=X.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),Gle=r=>{let e={},t,n,i;return r&&r.split(`
`).forEach(function(s){i=s.indexOf(":"),t=s.substring(0,i).trim().toLowerCase(),n=s.substring(i+1).trim(),!(!t||e[t]&&Hle[t])&&(t==="set-cookie"?e[t]?e[t].push(n):e[t]=[n]:e[t]=e[t]?e[t]+", "+n:n)}),e},C3=Symbol("internals");function Px(r){return r&&String(r).trim().toLowerCase()}function Yk(r){return r===!1||r==null?r:X.isArray(r)?r.map(Yk):String(r)}function zle(r){let e=Object.create(null),t=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g,n;for(;n=t.exec(r);)e[n[1]]=n[2];return e}var Qle=r=>/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(r.trim());function iM(r,e,t,n,i){if(X.isFunction(n))return n.call(this,e,t);if(i&&(e=t),!!X.isString(e)){if(X.isString(n))return e.indexOf(n)!==-1;if(X.isRegExp(n))return n.test(e)}}function Yle(r){return r.trim().toLowerCase().replace(/([a-z\d])(\w*)/g,(e,t,n)=>t.toUpperCase()+n)}function Xle(r,e){let t=X.toCamelCase(" "+e);["get","set","has"].forEach(n=>{Object.defineProperty(r,n+t,{value:function(i,o,s){return this[n].call(this,e,i,o,s)},configurable:!0})})}var Ig=class{constructor(e){e&&this.set(e)}set(e,t,n){let i=this;function o(a,l,c){let u=Px(l);if(!u)throw new Error("header name must be a non-empty string");let d=X.findKey(i,u);(!d||i[d]===void 0||c===!0||c===void 0&&i[d]!==!1)&&(i[d||l]=Yk(a))}let s=(a,l)=>X.forEach(a,(c,u)=>o(c,u,l));return X.isPlainObject(e)||e instanceof this.constructor?s(e,t):X.isString(e)&&(e=e.trim())&&!Qle(e)?s(Gle(e),t):e!=null&&o(t,e,n),this}get(e,t){if(e=Px(e),e){let n=X.findKey(this,e);if(n){let i=this[n];if(!t)return i;if(t===!0)return zle(i);if(X.isFunction(t))return t.call(this,i,n);if(X.isRegExp(t))return t.exec(i);throw new TypeError("parser must be boolean|regexp|function")}}}has(e,t){if(e=Px(e),e){let n=X.findKey(this,e);return!!(n&&this[n]!==void 0&&(!t||iM(this,this[n],n,t)))}return!1}delete(e,t){let n=this,i=!1;function o(s){if(s=Px(s),s){let a=X.findKey(n,s);a&&(!t||iM(n,n[a],a,t))&&(delete n[a],i=!0)}}return X.isArray(e)?e.forEach(o):o(e),i}clear(e){let t=Object.keys(this),n=t.length,i=!1;for(;n--;){let o=t[n];(!e||iM(this,this[o],o,e,!0))&&(delete this[o],i=!0)}return i}normalize(e){let t=this,n={};return X.forEach(this,(i,o)=>{let s=X.findKey(n,o);if(s){t[s]=Yk(i),delete t[o];return}let a=e?Yle(o):String(o).trim();a!==o&&delete t[o],t[a]=Yk(i),n[a]=!0}),this}concat(...e){return this.constructor.concat(this,...e)}toJSON(e){let t=Object.create(null);return X.forEach(this,(n,i)=>{n!=null&&n!==!1&&(t[i]=e&&X.isArray(n)?n.join(", "):n)}),t}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map(([e,t])=>e+": "+t).join(`
`)}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(e){return e instanceof this?e:new this(e)}static concat(e,...t){let n=new this(e);return t.forEach(i=>n.set(i)),n}static accessor(e){let n=(this[C3]=this[C3]={accessors:{}}).accessors,i=this.prototype;function o(s){let a=Px(s);n[a]||(Xle(i,s),n[a]=!0)}return X.isArray(e)?e.forEach(o):o(e),this}};Ig.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]);X.reduceDescriptors(Ig.prototype,({value:r},e)=>{let t=e[0].toUpperCase()+e.slice(1);return{get:()=>r,set(n){this[t]=n}}});X.freezeMethods(Ig);var Ks=Ig;function oM(r,e){let t=this||SM,n=e||t,i=Ks.from(n.headers),o=n.data;return X.forEach(r,function(a){o=a.call(t,o,i.normalize(),e?e.status:void 0)}),i.normalize(),o}function Z3(r){return!!(r&&r.__CANCEL__)}function ym(r,e,t){et.call(this,r??"canceled",et.ERR_CANCELED,e,t),this.name="CanceledError"}X.inherits(ym,et,{__CANCEL__:!0});function Dx(r,e,t){let n=t.config.validateStatus;!t.status||!n||n(t.status)?r(t):e(new et("Request failed with status code "+t.status,[et.ERR_BAD_REQUEST,et.ERR_BAD_RESPONSE][Math.floor(t.status/100)-4],t.config,t.request,t))}function Zle(r){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(r)}function ece(r,e){return e?r.replace(/\/+$/,"")+"/"+e.replace(/^\/+/,""):r}function xM(r,e){return r&&!Zle(e)?ece(r,e):e}var Zk="1.6.1";function eB(r){let e=/^([-+\w]{1,25})(:?\/\/|:)/.exec(r);return e&&e[1]||""}var tce=/^(?:([^;]+);)?(?:[^;]+;)?(base64|),([\s\S]*)$/;function rce(r,e,t){let n=t&&t.Blob||Ms.classes.Blob,i=eB(r);if(e===void 0&&n&&(e=!0),i==="data"){r=i.length?r.slice(i.length+1):r;let o=tce.exec(r);if(!o)throw new et("Invalid URL",et.ERR_INVALID_URL);let s=o[1],a=o[2],l=o[3],c=Buffer.from(decodeURIComponent(l),a?"base64":"utf8");if(e){if(!n)throw new et("Blob is not supported",et.ERR_NOT_SUPPORT);return new n([c],{type:s})}return c}throw new et("Unsupported protocol "+i,et.ERR_NOT_SUPPORT)}function nce(r,e){let t=0,n=1e3/e,i=null;return function(s,a){let l=Date.now();if(s||l-t>n)return i&&(clearTimeout(i),i=null),t=l,r.apply(null,a);i||(i=setTimeout(()=>(i=null,t=Date.now(),r.apply(null,a)),n-(l-t)))}}function tB(r,e){r=r||10;let t=new Array(r),n=new Array(r),i=0,o=0,s;return e=e!==void 0?e:1e3,function(l){let c=Date.now(),u=n[o];s||(s=c),t[i]=l,n[i]=c;let d=o,f=0;for(;d!==i;)f+=t[d++],d=d%r;if(i=(i+1)%r,i===o&&(o=(o+1)%r),c-s<e)return;let h=u&&c-u;return h?Math.round(f*1e3/h):void 0}}var zk=Symbol("internals"),uM=class extends wp.default.Transform{constructor(e){e=X.toFlatObject(e,{maxRate:0,chunkSize:64*1024,minChunkSize:100,timeWindow:500,ticksRate:2,samplesCount:15},null,(a,l)=>!X.isUndefined(l[a])),super({readableHighWaterMark:e.chunkSize});let t=this,n=this[zk]={length:e.length,timeWindow:e.timeWindow,ticksRate:e.ticksRate,chunkSize:e.chunkSize,maxRate:e.maxRate,minChunkSize:e.minChunkSize,bytesSeen:0,isCaptured:!1,notifiedBytesLoaded:0,ts:Date.now(),bytes:0,onReadCallback:null},i=tB(n.ticksRate*e.samplesCount,n.timeWindow);this.on("newListener",a=>{a==="progress"&&(n.isCaptured||(n.isCaptured=!0))});let o=0;n.updateProgress=nce(function(){let l=n.length,c=n.bytesSeen,u=c-o;if(!u||t.destroyed)return;let d=i(u);o=c,process.nextTick(()=>{t.emit("progress",{loaded:c,total:l,progress:l?c/l:void 0,bytes:u,rate:d||void 0,estimated:d&&l&&c<=l?(l-c)/d:void 0})})},n.ticksRate);let s=()=>{n.updateProgress(!0)};this.once("end",s),this.once("error",s)}_read(e){let t=this[zk];return t.onReadCallback&&t.onReadCallback(),super._read(e)}_transform(e,t,n){let i=this,o=this[zk],s=o.maxRate,a=this.readableHighWaterMark,l=o.timeWindow,c=1e3/l,u=s/c,d=o.minChunkSize!==!1?Math.max(o.minChunkSize,u*.01):0;function f(v,S){let b=Buffer.byteLength(v);o.bytesSeen+=b,o.bytes+=b,o.isCaptured&&o.updateProgress(),i.push(v)?process.nextTick(S):o.onReadCallback=()=>{o.onReadCallback=null,process.nextTick(S)}}let h=(v,S)=>{let b=Buffer.byteLength(v),D=null,_=a,L,Z=0;if(s){let Se=Date.now();(!o.ts||(Z=Se-o.ts)>=l)&&(o.ts=Se,L=u-o.bytes,o.bytes=L<0?-L:0,Z=0),L=u-o.bytes}if(s){if(L<=0)return setTimeout(()=>{S(null,v)},l-Z);L<_&&(_=L)}_&&b>_&&b-_>d&&(D=v.subarray(_),v=v.subarray(0,_)),f(v,D?()=>{process.nextTick(S,null,D)}:S)};h(e,function v(S,b){if(S)return n(S);b?h(b,v):n(null)})}setLength(e){return this[zk].length=+e,this}},E3=uM,{asyncIterator:w3}=Symbol,ice=async function*(r){r.stream?yield*r.stream():r.arrayBuffer?yield await r.arrayBuffer():r[w3]?yield*r[w3]():yield r},rB=ice,oce=X.ALPHABET.ALPHA_DIGIT+"-_",_x=new O3.TextEncoder,kp=`\r
`,sce=_x.encode(kp),ace=2,pM=class{constructor(e,t){let{escapeName:n}=this.constructor,i=X.isString(t),o=`Content-Disposition: form-data; name="${n(e)}"${!i&&t.name?`; filename="${n(t.name)}"`:""}${kp}`;i?t=_x.encode(String(t).replace(/\r?\n|\r\n?/g,kp)):o+=`Content-Type: ${t.type||"application/octet-stream"}${kp}`,this.headers=_x.encode(o+kp),this.contentLength=i?t.byteLength:t.size,this.size=this.headers.byteLength+this.contentLength+ace,this.name=e,this.value=t}async*encode(){yield this.headers;let{value:e}=this;X.isTypedArray(e)?yield e:yield*rB(e),yield sce}static escapeName(e){return String(e).replace(/[\r\n"]/g,t=>({"\r":"%0D","\n":"%0A",'"':"%22"})[t])}},lce=(r,e,t)=>{let{tag:n="form-data-boundary",size:i=25,boundary:o=n+"-"+X.generateString(i,oce)}=t||{};if(!X.isFormData(r))throw TypeError("FormData instance required");if(o.length<1||o.length>70)throw Error("boundary must be 10-70 characters long");let s=_x.encode("--"+o+kp),a=_x.encode("--"+o+"--"+kp+kp),l=a.byteLength,c=Array.from(r.entries()).map(([d,f])=>{let h=new pM(d,f);return l+=h.size,h});l+=s.byteLength*c.length,l=X.toFiniteNumber(l);let u={"Content-Type":`multipart/form-data; boundary=${o}`};return Number.isFinite(l)&&(u["Content-Length"]=l),e&&e(u),K3.Readable.from(async function*(){for(let d of c)yield s,yield*d.encode();yield a}())},cce=lce,dM=class extends wp.default.Transform{__transform(e,t,n){this.push(e),n()}_transform(e,t,n){if(e.length!==0&&(this._transform=this.__transform,e[0]!==120)){let i=Buffer.alloc(2);i[0]=120,i[1]=156,this.push(i,t)}this.__transform(e,t,n)}},uce=dM,pce=(r,e)=>X.isAsyncFn(r)?function(...t){let n=t.pop();r.apply(this,t).then(i=>{try{e?n(null,...e(i)):n(null,i)}catch(o){n(o)}},n)}:r,dce=pce,k3={flush:Pp.default.constants.Z_SYNC_FLUSH,finishFlush:Pp.default.constants.Z_SYNC_FLUSH},mce={flush:Pp.default.constants.BROTLI_OPERATION_FLUSH,finishFlush:Pp.default.constants.BROTLI_OPERATION_FLUSH},P3=X.isFunction(Pp.default.createBrotliDecompress),{http:fce,https:hce}=Zae.default,gce=/https:?/,D3=Ms.protocols.map(r=>r+":");function vce(r){r.beforeRedirects.proxy&&r.beforeRedirects.proxy(r),r.beforeRedirects.config&&r.beforeRedirects.config(r)}function nB(r,e,t){let n=e;if(!n&&n!==!1){let i=Bae.getProxyForUrl(t);i&&(n=new URL(i))}if(n){if(n.username&&(n.auth=(n.username||"")+":"+(n.password||"")),n.auth){(n.auth.username||n.auth.password)&&(n.auth=(n.auth.username||"")+":"+(n.auth.password||""));let o=Buffer.from(n.auth,"utf8").toString("base64");r.headers["Proxy-Authorization"]="Basic "+o}r.headers.host=r.hostname+(r.port?":"+r.port:"");let i=n.hostname||n.host;r.hostname=i,r.host=i,r.port=n.port,r.path=t,n.protocol&&(r.protocol=n.protocol.includes(":")?n.protocol:`${n.protocol}:`)}r.beforeRedirects.proxy=function(o){nB(o,e,o.href)}}var yce=typeof process<"u"&&X.kindOf(process)==="process",bce=r=>new Promise((e,t)=>{let n,i,o=(l,c)=>{i||(i=!0,n&&n(l,c))},s=l=>{o(l),e(l)},a=l=>{o(l,!0),t(l)};r(s,a,l=>n=l).catch(a)}),Ice=({address:r,family:e})=>{if(!X.isString(r))throw TypeError("address must be a string");return{address:r,family:e||(r.indexOf(".")<0?6:4)}},T3=(r,e)=>Ice(X.isObject(r)?r:{address:r,family:e}),Sce=yce&&function(e){return bce(async function(n,i,o){let{data:s,lookup:a,family:l}=e,{responseType:c,responseEncoding:u}=e,d=e.method.toUpperCase(),f,h=!1,v;if(a){let Y=dce(a,be=>X.isArray(be)?be:[be]);a=(be,Je,yn)=>{Y(be,Je,(kt,Yr,vs)=>{let qt=X.isArray(Yr)?Yr.map(un=>T3(un)):[T3(Yr,vs)];Je.all?yn(kt,qt):yn(kt,qt[0].address,qt[0].family)})}}let S=new ele.default,b=()=>{e.cancelToken&&e.cancelToken.unsubscribe(D),e.signal&&e.signal.removeEventListener("abort",D),S.removeAllListeners()};o((Y,be)=>{f=!0,be&&(h=!0,b())});function D(Y){S.emit("abort",!Y||Y.type?new ym(null,e,v):Y)}S.once("abort",i),(e.cancelToken||e.signal)&&(e.cancelToken&&e.cancelToken.subscribe(D),e.signal&&(e.signal.aborted?D():e.signal.addEventListener("abort",D)));let _=xM(e.baseURL,e.url),L=new URL(_,"http://localhost"),Z=L.protocol||D3[0];if(Z==="data:"){let Y;if(d!=="GET")return Dx(n,i,{status:405,statusText:"method not allowed",headers:{},config:e});try{Y=rce(e.url,c==="blob",{Blob:e.env&&e.env.Blob})}catch(be){throw et.from(be,et.ERR_BAD_REQUEST,e)}return c==="text"?(Y=Y.toString(u),(!u||u==="utf8")&&(Y=X.stripBOM(Y))):c==="stream"&&(Y=wp.default.Readable.from(Y)),Dx(n,i,{data:Y,status:200,statusText:"OK",headers:new Ks,config:e})}if(D3.indexOf(Z)===-1)return i(new et("Unsupported protocol "+Z,et.ERR_BAD_REQUEST,e));let Se=Ks.from(e.headers).normalize();Se.set("User-Agent","axios/"+Zk,!1);let ie=e.onDownloadProgress,fe=e.onUploadProgress,de=e.maxRate,ae,Me;if(X.isSpecCompliantForm(s)){let Y=Se.getContentType(/boundary=([-_\w\d]{10,70})/i);s=cce(s,be=>{Se.set(be)},{tag:`axios-${Zk}-boundary`,boundary:Y&&Y[1]||void 0})}else if(X.isFormData(s)&&X.isFunction(s.getHeaders)){if(Se.set(s.getHeaders()),!Se.hasContentLength())try{let Y=await Xae.default.promisify(s.getLength).call(s);Number.isFinite(Y)&&Y>=0&&Se.setContentLength(Y)}catch{}}else if(X.isBlob(s))s.size&&Se.setContentType(s.type||"application/octet-stream"),Se.setContentLength(s.size||0),s=wp.default.Readable.from(rB(s));else if(s&&!X.isStream(s)){if(!Buffer.isBuffer(s))if(X.isArrayBuffer(s))s=Buffer.from(new Uint8Array(s));else if(X.isString(s))s=Buffer.from(s,"utf-8");else return i(new et("Data after transformation must be a string, an ArrayBuffer, a Buffer, or a Stream",et.ERR_BAD_REQUEST,e));if(Se.setContentLength(s.length,!1),e.maxBodyLength>-1&&s.length>e.maxBodyLength)return i(new et("Request body larger than maxBodyLength limit",et.ERR_BAD_REQUEST,e))}let Ge=X.toFiniteNumber(Se.getContentLength());X.isArray(de)?(ae=de[0],Me=de[1]):ae=Me=de,s&&(fe||ae)&&(X.isStream(s)||(s=wp.default.Readable.from(s,{objectMode:!1})),s=wp.default.pipeline([s,new E3({length:Ge,maxRate:X.toFiniteNumber(ae)})],X.noop),fe&&s.on("progress",Y=>{fe(Object.assign(Y,{upload:!0}))}));let St;if(e.auth){let Y=e.auth.username||"",be=e.auth.password||"";St=Y+":"+be}if(!St&&L.username){let Y=L.username,be=L.password;St=Y+":"+be}St&&Se.delete("authorization");let vt;try{vt=yM(L.pathname+L.search,e.params,e.paramsSerializer).replace(/^\?/,"")}catch(Y){let be=new Error(Y.message);return be.config=e,be.url=e.url,be.exists=!0,i(be)}Se.set("Accept-Encoding","gzip, compress, deflate"+(P3?", br":""),!1);let ot={path:vt,method:d,headers:Se.toJSON(),agents:{http:e.httpAgent,https:e.httpsAgent},auth:St,protocol:Z,family:l,beforeRedirect:vce,beforeRedirects:{}};!X.isUndefined(a)&&(ot.lookup=a),e.socketPath?ot.socketPath=e.socketPath:(ot.hostname=L.hostname,ot.port=L.port,nB(ot,e.proxy,Z+"//"+L.hostname+(L.port?":"+L.port:"")+ot.path));let oe,Pe=gce.test(ot.protocol);if(ot.agent=Pe?e.httpsAgent:e.httpAgent,e.transport?oe=e.transport:e.maxRedirects===0?oe=Pe?Yae.default:Qae.default:(e.maxRedirects&&(ot.maxRedirects=e.maxRedirects),e.beforeRedirect&&(ot.beforeRedirects.config=e.beforeRedirect),oe=Pe?hce:fce),e.maxBodyLength>-1?ot.maxBodyLength=e.maxBodyLength:ot.maxBodyLength=1/0,e.insecureHTTPParser&&(ot.insecureHTTPParser=e.insecureHTTPParser),v=oe.request(ot,function(be){if(v.destroyed)return;let Je=[be],yn=+be.headers["content-length"];if(ie){let un=new E3({length:X.toFiniteNumber(yn),maxRate:X.toFiniteNumber(Me)});ie&&un.on("progress",Yi=>{ie(Object.assign(Yi,{download:!0}))}),Je.push(un)}let kt=be,Yr=be.req||v;if(e.decompress!==!1&&be.headers["content-encoding"])switch((d==="HEAD"||be.statusCode===204)&&delete be.headers["content-encoding"],(be.headers["content-encoding"]||"").toLowerCase()){case"gzip":case"x-gzip":case"compress":case"x-compress":Je.push(Pp.default.createUnzip(k3)),delete be.headers["content-encoding"];break;case"deflate":Je.push(new uce),Je.push(Pp.default.createUnzip(k3)),delete be.headers["content-encoding"];break;case"br":P3&&(Je.push(Pp.default.createBrotliDecompress(mce)),delete be.headers["content-encoding"])}kt=Je.length>1?wp.default.pipeline(Je,X.noop):Je[0];let vs=wp.default.finished(kt,()=>{vs(),b()}),qt={status:be.statusCode,statusText:be.statusMessage,headers:new Ks(be.headers),config:e,request:Yr};if(c==="stream")qt.data=kt,Dx(n,i,qt);else{let un=[],Yi=0;kt.on("data",function(mr){un.push(mr),Yi+=mr.length,e.maxContentLength>-1&&Yi>e.maxContentLength&&(h=!0,kt.destroy(),i(new et("maxContentLength size of "+e.maxContentLength+" exceeded",et.ERR_BAD_RESPONSE,e,Yr)))}),kt.on("aborted",function(){if(h)return;let mr=new et("maxContentLength size of "+e.maxContentLength+" exceeded",et.ERR_BAD_RESPONSE,e,Yr);kt.destroy(mr),i(mr)}),kt.on("error",function(mr){v.destroyed||i(et.from(mr,null,e,Yr))}),kt.on("end",function(){try{let mr=un.length===1?un[0]:Buffer.concat(un);c!=="arraybuffer"&&(mr=mr.toString(u),(!u||u==="utf8")&&(mr=X.stripBOM(mr))),qt.data=mr}catch(mr){return i(et.from(mr,null,e,qt.request,qt))}Dx(n,i,qt)})}S.once("abort",un=>{kt.destroyed||(kt.emit("error",un),kt.destroy())})}),S.once("abort",Y=>{i(Y),v.destroy(Y)}),v.on("error",function(be){i(et.from(be,null,e,v))}),v.on("socket",function(be){be.setKeepAlive(!0,1e3*60)}),e.timeout){let Y=parseInt(e.timeout,10);if(Number.isNaN(Y)){i(new et("error trying to parse `config.timeout` to int",et.ERR_BAD_OPTION_VALUE,e,v));return}v.setTimeout(Y,function(){if(f)return;let Je=e.timeout?"timeout of "+e.timeout+"ms exceeded":"timeout exceeded",yn=e.transitional||bM;e.timeoutErrorMessage&&(Je=e.timeoutErrorMessage),i(new et(Je,yn.clarifyTimeoutError?et.ETIMEDOUT:et.ECONNABORTED,e,v)),D()})}if(X.isStream(s)){let Y=!1,be=!1;s.on("end",()=>{Y=!0}),s.once("error",Je=>{be=!0,v.destroy(Je)}),s.on("close",()=>{!Y&&!be&&D(new ym("Request stream has been aborted",e,v))}),s.pipe(v)}else v.end(s)})},xce=Ms.hasStandardBrowserEnv?function(){return{write:function(t,n,i,o,s,a){let l=[];l.push(t+"="+encodeURIComponent(n)),X.isNumber(i)&&l.push("expires="+new Date(i).toGMTString()),X.isString(o)&&l.push("path="+o),X.isString(s)&&l.push("domain="+s),a===!0&&l.push("secure"),document.cookie=l.join("; ")},read:function(t){let n=document.cookie.match(new RegExp("(^|;\\s*)("+t+")=([^;]*)"));return n?decodeURIComponent(n[3]):null},remove:function(t){this.write(t,"",Date.now()-864e5)}}}():function(){return{write:function(){},read:function(){return null},remove:function(){}}}(),Cce=Ms.hasStandardBrowserEnv?function(){let e=/(msie|trident)/i.test(navigator.userAgent),t=document.createElement("a"),n;function i(o){let s=o;return e&&(t.setAttribute("href",s),s=t.href),t.setAttribute("href",s),{href:t.href,protocol:t.protocol?t.protocol.replace(/:$/,""):"",host:t.host,search:t.search?t.search.replace(/^\?/,""):"",hash:t.hash?t.hash.replace(/^#/,""):"",hostname:t.hostname,port:t.port,pathname:t.pathname.charAt(0)==="/"?t.pathname:"/"+t.pathname}}return n=i(window.location.href),function(s){let a=X.isString(s)?i(s):s;return a.protocol===n.protocol&&a.host===n.host}}():function(){return function(){return!0}}();function _3(r,e){let t=0,n=tB(50,250);return i=>{let o=i.loaded,s=i.lengthComputable?i.total:void 0,a=o-t,l=n(a),c=o<=s;t=o;let u={loaded:o,total:s,progress:s?o/s:void 0,bytes:a,rate:l||void 0,estimated:l&&s&&c?(s-o)/l:void 0,event:i};u[e?"download":"upload"]=!0,r(u)}}var Ece=typeof XMLHttpRequest<"u",wce=Ece&&function(r){return new Promise(function(t,n){let i=r.data,o=Ks.from(r.headers).normalize(),s=r.responseType,a;function l(){r.cancelToken&&r.cancelToken.unsubscribe(a),r.signal&&r.signal.removeEventListener("abort",a)}let c;if(X.isFormData(i)){if(Ms.hasStandardBrowserEnv||Ms.hasStandardBrowserWebWorkerEnv)o.setContentType(!1);else if((c=o.getContentType())!==!1){let[v,...S]=c?c.split(";").map(b=>b.trim()).filter(Boolean):[];o.setContentType([v||"multipart/form-data",...S].join("; "))}}let u=new XMLHttpRequest;if(r.auth){let v=r.auth.username||"",S=r.auth.password?unescape(encodeURIComponent(r.auth.password)):"";o.set("Authorization","Basic "+btoa(v+":"+S))}let d=xM(r.baseURL,r.url);u.open(r.method.toUpperCase(),yM(d,r.params,r.paramsSerializer),!0),u.timeout=r.timeout;function f(){if(!u)return;let v=Ks.from("getAllResponseHeaders"in u&&u.getAllResponseHeaders()),b={data:!s||s==="text"||s==="json"?u.responseText:u.response,status:u.status,statusText:u.statusText,headers:v,config:r,request:u};Dx(function(_){t(_),l()},function(_){n(_),l()},b),u=null}if("onloadend"in u?u.onloadend=f:u.onreadystatechange=function(){!u||u.readyState!==4||u.status===0&&!(u.responseURL&&u.responseURL.indexOf("file:")===0)||setTimeout(f)},u.onabort=function(){u&&(n(new et("Request aborted",et.ECONNABORTED,r,u)),u=null)},u.onerror=function(){n(new et("Network Error",et.ERR_NETWORK,r,u)),u=null},u.ontimeout=function(){let S=r.timeout?"timeout of "+r.timeout+"ms exceeded":"timeout exceeded",b=r.transitional||bM;r.timeoutErrorMessage&&(S=r.timeoutErrorMessage),n(new et(S,b.clarifyTimeoutError?et.ETIMEDOUT:et.ECONNABORTED,r,u)),u=null},Ms.hasStandardBrowserEnv){let v=Cce(d)&&r.xsrfCookieName&&xce.read(r.xsrfCookieName);v&&o.set(r.xsrfHeaderName,v)}i===void 0&&o.setContentType(null),"setRequestHeader"in u&&X.forEach(o.toJSON(),function(S,b){u.setRequestHeader(b,S)}),X.isUndefined(r.withCredentials)||(u.withCredentials=!!r.withCredentials),s&&s!=="json"&&(u.responseType=r.responseType),typeof r.onDownloadProgress=="function"&&u.addEventListener("progress",_3(r.onDownloadProgress,!0)),typeof r.onUploadProgress=="function"&&u.upload&&u.upload.addEventListener("progress",_3(r.onUploadProgress)),(r.cancelToken||r.signal)&&(a=v=>{u&&(n(!v||v.type?new ym(null,r,u):v),u.abort(),u=null)},r.cancelToken&&r.cancelToken.subscribe(a),r.signal&&(r.signal.aborted?a():r.signal.addEventListener("abort",a)));let h=eB(d);if(h&&Ms.protocols.indexOf(h)===-1){n(new et("Unsupported protocol "+h+":",et.ERR_BAD_REQUEST,r));return}u.send(i||null)})},mM={http:Sce,xhr:wce};X.forEach(mM,(r,e)=>{if(r){try{Object.defineProperty(r,"name",{value:e})}catch{}Object.defineProperty(r,"adapterName",{value:e})}});var R3=r=>`- ${r}`,kce=r=>X.isFunction(r)||r===null||r===!1,iB={getAdapter:r=>{r=X.isArray(r)?r:[r];let{length:e}=r,t,n,i={};for(let o=0;o<e;o++){t=r[o];let s;if(n=t,!kce(t)&&(n=mM[(s=String(t)).toLowerCase()],n===void 0))throw new et(`Unknown adapter '${s}'`);if(n)break;i[s||"#"+o]=n}if(!n){let o=Object.entries(i).map(([a,l])=>`adapter ${a} `+(l===!1?"is not supported by the environment":"is not available in the build")),s=e?o.length>1?`since :
`+o.map(R3).join(`
`):" "+R3(o[0]):"as no adapter specified";throw new et("There is no suitable adapter to dispatch the request "+s,"ERR_NOT_SUPPORT")}return n},adapters:mM};function sM(r){if(r.cancelToken&&r.cancelToken.throwIfRequested(),r.signal&&r.signal.aborted)throw new ym(null,r)}function N3(r){return sM(r),r.headers=Ks.from(r.headers),r.data=oM.call(r,r.transformRequest),["post","put","patch"].indexOf(r.method)!==-1&&r.headers.setContentType("application/x-www-form-urlencoded",!1),iB.getAdapter(r.adapter||SM.adapter)(r).then(function(n){return sM(r),n.data=oM.call(r,r.transformResponse,n),n.headers=Ks.from(n.headers),n},function(n){return Z3(n)||(sM(r),n&&n.response&&(n.response.data=oM.call(r,r.transformResponse,n.response),n.response.headers=Ks.from(n.response.headers))),Promise.reject(n)})}var A3=r=>r instanceof Ks?r.toJSON():r;function Sg(r,e){e=e||{};let t={};function n(c,u,d){return X.isPlainObject(c)&&X.isPlainObject(u)?X.merge.call({caseless:d},c,u):X.isPlainObject(u)?X.merge({},u):X.isArray(u)?u.slice():u}function i(c,u,d){if(X.isUndefined(u)){if(!X.isUndefined(c))return n(void 0,c,d)}else return n(c,u,d)}function o(c,u){if(!X.isUndefined(u))return n(void 0,u)}function s(c,u){if(X.isUndefined(u)){if(!X.isUndefined(c))return n(void 0,c)}else return n(void 0,u)}function a(c,u,d){if(d in e)return n(c,u);if(d in r)return n(void 0,c)}let l={url:o,method:o,data:o,baseURL:s,transformRequest:s,transformResponse:s,paramsSerializer:s,timeout:s,timeoutMessage:s,withCredentials:s,adapter:s,responseType:s,xsrfCookieName:s,xsrfHeaderName:s,onUploadProgress:s,onDownloadProgress:s,decompress:s,maxContentLength:s,maxBodyLength:s,beforeRedirect:s,transport:s,httpAgent:s,httpsAgent:s,cancelToken:s,socketPath:s,responseEncoding:s,validateStatus:a,headers:(c,u)=>i(A3(c),A3(u),!0)};return X.forEach(Object.keys(Object.assign({},r,e)),function(u){let d=l[u]||i,f=d(r[u],e[u],u);X.isUndefined(f)&&d!==a||(t[u]=f)}),t}var CM={};["object","boolean","number","function","string","symbol"].forEach((r,e)=>{CM[r]=function(n){return typeof n===r||"a"+(e<1?"n ":" ")+r}});var M3={};CM.transitional=function(e,t,n){function i(o,s){return"[Axios v"+Zk+"] Transitional option '"+o+"'"+s+(n?". "+n:"")}return(o,s,a)=>{if(e===!1)throw new et(i(s," has been removed"+(t?" in "+t:"")),et.ERR_DEPRECATED);return t&&!M3[s]&&(M3[s]=!0,console.warn(i(s," has been deprecated since v"+t+" and will be removed in the near future"))),e?e(o,s,a):!0}};function Pce(r,e,t){if(typeof r!="object")throw new et("options must be an object",et.ERR_BAD_OPTION_VALUE);let n=Object.keys(r),i=n.length;for(;i-- >0;){let o=n[i],s=e[o];if(s){let a=r[o],l=a===void 0||s(a,o,r);if(l!==!0)throw new et("option "+o+" must be "+l,et.ERR_BAD_OPTION_VALUE);continue}if(t!==!0)throw new et("Unknown option "+o,et.ERR_BAD_OPTION)}}var fM={assertOptions:Pce,validators:CM},Ep=fM.validators,xg=class{constructor(e){this.defaults=e,this.interceptors={request:new x3,response:new x3}}request(e,t){typeof e=="string"?(t=t||{},t.url=e):t=e||{},t=Sg(this.defaults,t);let{transitional:n,paramsSerializer:i,headers:o}=t;n!==void 0&&fM.assertOptions(n,{silentJSONParsing:Ep.transitional(Ep.boolean),forcedJSONParsing:Ep.transitional(Ep.boolean),clarifyTimeoutError:Ep.transitional(Ep.boolean)},!1),i!=null&&(X.isFunction(i)?t.paramsSerializer={serialize:i}:fM.assertOptions(i,{encode:Ep.function,serialize:Ep.function},!0)),t.method=(t.method||this.defaults.method||"get").toLowerCase();let s=o&&X.merge(o.common,o[t.method]);o&&X.forEach(["delete","get","head","post","put","patch","common"],v=>{delete o[v]}),t.headers=Ks.concat(s,o);let a=[],l=!0;this.interceptors.request.forEach(function(S){typeof S.runWhen=="function"&&S.runWhen(t)===!1||(l=l&&S.synchronous,a.unshift(S.fulfilled,S.rejected))});let c=[];this.interceptors.response.forEach(function(S){c.push(S.fulfilled,S.rejected)});let u,d=0,f;if(!l){let v=[N3.bind(this),void 0];for(v.unshift.apply(v,a),v.push.apply(v,c),f=v.length,u=Promise.resolve(t);d<f;)u=u.then(v[d++],v[d++]);return u}f=a.length;let h=t;for(d=0;d<f;){let v=a[d++],S=a[d++];try{h=v(h)}catch(b){S.call(this,b);break}}try{u=N3.call(this,h)}catch(v){return Promise.reject(v)}for(d=0,f=c.length;d<f;)u=u.then(c[d++],c[d++]);return u}getUri(e){e=Sg(this.defaults,e);let t=xM(e.baseURL,e.url);return yM(t,e.params,e.paramsSerializer)}};X.forEach(["delete","get","head","options"],function(e){xg.prototype[e]=function(t,n){return this.request(Sg(n||{},{method:e,url:t,data:(n||{}).data}))}});X.forEach(["post","put","patch"],function(e){function t(n){return function(o,s,a){return this.request(Sg(a||{},{method:e,headers:n?{"Content-Type":"multipart/form-data"}:{},url:o,data:s}))}}xg.prototype[e]=t(),xg.prototype[e+"Form"]=t(!0)});var Xk=xg,hM=class r{constructor(e){if(typeof e!="function")throw new TypeError("executor must be a function.");let t;this.promise=new Promise(function(o){t=o});let n=this;this.promise.then(i=>{if(!n._listeners)return;let o=n._listeners.length;for(;o-- >0;)n._listeners[o](i);n._listeners=null}),this.promise.then=i=>{let o,s=new Promise(a=>{n.subscribe(a),o=a}).then(i);return s.cancel=function(){n.unsubscribe(o)},s},e(function(o,s,a){n.reason||(n.reason=new ym(o,s,a),t(n.reason))})}throwIfRequested(){if(this.reason)throw this.reason}subscribe(e){if(this.reason){e(this.reason);return}this._listeners?this._listeners.push(e):this._listeners=[e]}unsubscribe(e){if(!this._listeners)return;let t=this._listeners.indexOf(e);t!==-1&&this._listeners.splice(t,1)}static source(){let e;return{token:new r(function(i){e=i}),cancel:e}}},Dce=hM;function Tce(r){return function(t){return r.apply(null,t)}}function _ce(r){return X.isObject(r)&&r.isAxiosError===!0}var gM={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511};Object.entries(gM).forEach(([r,e])=>{gM[e]=r});var Rce=gM;function oB(r){let e=new Xk(r),t=L3(Xk.prototype.request,e);return X.extend(t,Xk.prototype,e,{allOwnKeys:!0}),X.extend(t,e,null,{allOwnKeys:!0}),t.create=function(i){return oB(Sg(r,i))},t}var Fn=oB(SM);Fn.Axios=Xk;Fn.CanceledError=ym;Fn.CancelToken=Dce;Fn.isCancel=Z3;Fn.VERSION=Zk;Fn.toFormData=nP;Fn.AxiosError=et;Fn.Cancel=Fn.CanceledError;Fn.all=function(e){return Promise.all(e)};Fn.spread=Tce;Fn.isAxiosError=_ce;Fn.mergeConfig=Sg;Fn.AxiosHeaders=Ks;Fn.formToJSON=r=>X3(X.isHTMLForm(r)?new FormData(r):r);Fn.getAdapter=iB.getAdapter;Fn.HttpStatusCode=Rce;Fn.default=Fn;sB.exports=Fn});var lB=M(iP=>{"use strict";Object.defineProperty(iP,"__esModule",{value:!0});iP.AxiosHttpClient=void 0;var Nce=aB(),EM=class{constructor(e){this.endpoint=e}get(e){return Nce.default.get(this.endpoint,Object.assign(Object.assign({},e),{proxy:!1}))}};iP.AxiosHttpClient=EM});var cB=M(oP=>{"use strict";Object.defineProperty(oP,"__esModule",{value:!0});oP.MemoryKeyValueStorage=void 0;var wM=class{constructor(){this.storage=new Map}async getValue(e,t){return this.storage.has(e)?await Promise.resolve(this.storage.get(e)):await Promise.resolve(t||void 0)}setValue(e,t){this.storage.set(e,t)}};oP.MemoryKeyValueStorage=wM});var uB=M(sP=>{"use strict";Object.defineProperty(sP,"__esModule",{value:!0});sP.ExperimentationServiceBase=void 0;var Ace=cB(),kM=class{get features(){return this._features}set features(e){this._features=e,this.telemetry&&this.telemetry.setSharedProperty(this.assignmentContextTelemetryPropertyName,this.features.assignmentContext)}constructor(e,t,n,i,o){this.telemetry=e,this.assignmentContextTelemetryPropertyName=t,this.telemetryEventName=n,this.storageKey=i,this.storage=o,this.featuresConsumed=!1,this.cachedTelemetryEvents=[],this._features={features:[],assignmentContext:"",configs:[]},this.storageKey||(this.storageKey="ABExp.Features"),this.storage||(o=new Ace.MemoryKeyValueStorage),this.loadCachePromise=this.loadCachedFeatureData(),this.initializePromise=this.loadCachePromise,this.initialFetch=new Promise((s,a)=>{this.resolveInitialFetchPromise=s})}async getFeaturesAsync(e=!1){if(this.fetchPromise!=null){try{await this.fetchPromise}catch{}return this.features}if(!this.featureProviders||this.featureProviders.length===0)return Promise.resolve({features:[],assignmentContext:"",configs:[]});try{this.fetchPromise=Promise.all(this.featureProviders.map(async n=>await n.getFeatures()));let t=await this.fetchPromise;this.updateFeatures(t,e)}catch{}return this.fetchPromise=void 0,this.resolveInitialFetchPromise&&(this.resolveInitialFetchPromise(),this.resolveInitialFetchPromise=void 0),this.features}updateFeatures(e,t=!1){let n={features:[],assignmentContext:"",configs:[]};for(let i of e){for(let o of i.features)n.features.includes(o)||n.features.push(o);for(let o of i.configs){let s=n.configs.find(a=>a.Id===o.Id);s?s.Parameters=Object.assign(Object.assign({},s.Parameters),o.Parameters):n.configs.push(o)}n.assignmentContext+=i.assignmentContext}(t||!this.featuresConsumed)&&(this.features=n),this.storage&&this.storage.setValue(this.storageKey,n)}async loadCachedFeatureData(){let e;this.storage&&(e=await this.storage.getValue(this.storageKey),e!==void 0&&e.configs===void 0&&(e.configs=[])),this.features.features.length===0&&(this.features=e||{features:[],assignmentContext:"",configs:[]})}isFlightEnabled(e){return this.featuresConsumed=!0,this.PostEventToTelemetry(e),this.features.features.includes(e)}async isCachedFlightEnabled(e){return await this.loadCachePromise,this.featuresConsumed=!0,this.PostEventToTelemetry(e),this.features.features.includes(e)}async isFlightEnabledAsync(e){let t=await this.getFeaturesAsync(!0);return this.featuresConsumed=!0,this.PostEventToTelemetry(e),t.features.includes(e)}getTreatmentVariable(e,t){this.featuresConsumed=!0,this.PostEventToTelemetry(`${e}.${t}`);let n=this.features.configs.find(i=>i.Id===e);return n?.Parameters[t]}async getTreatmentVariableAsync(e,t,n){if(n){let i=this.featuresConsumed,o=this.getTreatmentVariable(e,t);if(o===void 0)this.featuresConsumed=i;else return o}return await this.getFeaturesAsync(!0),this.getTreatmentVariable(e,t)}PostEventToTelemetry(e){this.cachedTelemetryEvents.includes(e)||(this.telemetry.postEvent(this.telemetryEventName,new Map([["ABExp.queriedFeature",e]])),this.cachedTelemetryEvents.push(e))}invokeInit(){this.init()}addFeatureProvider(...e){if(!(e==null||this.featureProviders==null))for(let t of e)this.featureProviders.push(t)}};sP.ExperimentationServiceBase=kM});var pB=M(aP=>{"use strict";Object.defineProperty(aP,"__esModule",{value:!0});aP.PollingService=void 0;var PM=class{constructor(e){this.fetchInterval=e}StopPolling(){clearInterval(this.intervalHandle),this.intervalHandle=void 0}OnPollTick(e){this.onTick=e}StartPolling(e=!1){this.intervalHandle&&this.StopPolling(),this.onTick!=null&&(e&&this.onTick().then(()=>{}).catch(()=>{}),this.intervalHandle=setInterval(async()=>{await this.onTick()},this.fetchInterval),this.intervalHandle.unref&&this.intervalHandle.unref())}};aP.PollingService=PM});var dB=M(lP=>{"use strict";Object.defineProperty(lP,"__esModule",{value:!0});lP.ExperimentationServiceAutoPolling=void 0;var Mce=uB(),Oce=pB(),DM=class extends Mce.ExperimentationServiceBase{constructor(e,t,n,i,o,s,a){if(super(e,i,o,s,a),this.telemetry=e,this.filterProviders=t,this.refreshRateMs=n,this.assignmentContextTelemetryPropertyName=i,this.telemetryEventName=o,this.storageKey=s,this.storage=a,n<1e3&&n!==0)throw new Error("The minimum refresh rate for polling is 1000 ms (1 second). If you wish to deactivate this auto-polling use value of 0.");n>0&&(this.pollingService=new Oce.PollingService(n),this.pollingService.OnPollTick(async()=>{await super.getFeaturesAsync()}))}init(){this.pollingService?this.pollingService.StartPolling(!0):super.getFeaturesAsync()}async getFeaturesAsync(e=!1){if(this.pollingService){this.pollingService.StopPolling();let t=await super.getFeaturesAsync(e);return this.pollingService.StartPolling(),t}else return await super.getFeaturesAsync(e)}};lP.ExperimentationServiceAutoPolling=DM});var mB=M(uP=>{"use strict";Object.defineProperty(uP,"__esModule",{value:!0});uP.ExperimentationService=void 0;var Kce=g9(),Fce=lB(),Lce=dB(),cP=class extends Lce.ExperimentationServiceAutoPolling{constructor(e){super(e.telemetry,e.filterProviders||[],e.refetchInterval!=null?e.refetchInterval:0,e.assignmentContextTelemetryPropertyName,e.telemetryEventName,e.storageKey,e.keyValueStorage),this.options=e,this.invokeInit()}init(){this.featureProviders=[],this.addFeatureProvider(new Kce.TasApiFeatureProvider(new Fce.AxiosHttpClient(this.options.endpoint),this.telemetry,this.filterProviders)),super.init()}};uP.ExperimentationService=cP;cP.REFRESH_RATE_IN_MINUTES=30});var fB=M(pP=>{"use strict";Object.defineProperty(pP,"__esModule",{value:!0});pP.ExperimentationService=void 0;var Uce=mB();Object.defineProperty(pP,"ExperimentationService",{enumerable:!0,get:function(){return Uce.ExperimentationService}})});var hB=M(dP=>{"use strict";Object.defineProperty(dP,"__esModule",{value:!0});dP.MementoKeyValueStorage=void 0;var TM=class{constructor(e){this.mementoGlobalStorage=e}async getValue(e,t){return await this.mementoGlobalStorage.get(e)||t}setValue(e,t){this.mementoGlobalStorage.update(e,t)}};dP.MementoKeyValueStorage=TM});var gB=M(RM=>{"use strict";Object.defineProperty(RM,"__esModule",{value:!0});var _M=class{constructor(){this.initializePromise=Promise.resolve(),this.initialFetch=Promise.resolve()}isFlightEnabled(e){return!1}isCachedFlightEnabled(e){return Promise.resolve(!1)}isFlightEnabledAsync(e){return Promise.resolve(!1)}getTreatmentVariable(e,t){}getTreatmentVariableAsync(e,t){return Promise.resolve(void 0)}};RM.default=_M});var yB=M(Eg=>{"use strict";Object.defineProperty(Eg,"__esModule",{value:!0});Eg.getExperimentationServiceAsync=Eg.getExperimentationService=void 0;var Wce=NA(),jce=fB(),NM=require("vscode"),Vce=hB(),Bce=gB(),qce="https://default.exp-tas.com/vscode/ab",Jce="query-expfeature",$ce="abexp.assignmentcontext",Hce="VSCode.ABExp.FeatureData",Gce=1e3*60*30;function vB(r,e,t,n,i,...o){if(!i)throw new Error("Memento storage was not provided.");let s=NM.workspace.getConfiguration("telemetry");if(!(NM.env.isTelemetryEnabled===void 0?s.get("enableTelemetry",!0):NM.env.isTelemetryEnabled))return new Bce.default;let c=[new Wce.VSCodeFilterProvider(r,e,t),...o],u=new Vce.MementoKeyValueStorage(i);return new jce.ExperimentationService({filterProviders:c,telemetry:n,storageKey:Hce,keyValueStorage:u,featuresTelemetryPropertyName:"",assignmentContextTelemetryPropertyName:$ce,telemetryEventName:Jce,endpoint:qce,refetchInterval:Gce})}Eg.getExperimentationService=vB;async function zce(r,e,t,n,i,...o){let s=vB(r,e,t,n,i,...o);return await s.initializePromise,s}Eg.getExperimentationServiceAsync=zce});var IB=M(Dp=>{"use strict";Object.defineProperty(Dp,"__esModule",{value:!0});Dp.TargetPopulation=Dp.getExperimentationServiceAsync=Dp.getExperimentationService=void 0;var bB=yB();Object.defineProperty(Dp,"getExperimentationService",{enumerable:!0,get:function(){return bB.getExperimentationService}});Object.defineProperty(Dp,"getExperimentationServiceAsync",{enumerable:!0,get:function(){return bB.getExperimentationServiceAsync}});var Qce=NA();Object.defineProperty(Dp,"TargetPopulation",{enumerable:!0,get:function(){return Qce.TargetPopulation}})});var wB=M((Im,EB)=>{var Ax=require("node-fetch"),Zce=Ax.default||Ax,hP=function(r,e){return/^\/\//.test(r)&&(r="https:"+r),Zce.call(this,r,e)};hP.ponyfill=!0;EB.exports=Im=hP;Im.fetch=hP;Im.Headers=Ax.Headers;Im.Request=Ax.Request;Im.Response=Ax.Response;Im.default=hP});var AB=M((t1e,NB)=>{"use strict";function eue(){let r=[].slice.call(arguments).filter(t=>t),e=r.shift();return r.forEach(t=>{Object.keys(t).forEach(n=>{e[n]=t[n]})}),e}NB.exports=eue});var Do=M(OM=>{"use strict";OM.fromCallback=function(r){return Object.defineProperty(function(){if(typeof arguments[arguments.length-1]=="function")r.apply(this,arguments);else return new Promise((e,t)=>{arguments[arguments.length]=(n,i)=>{if(n)return t(n);e(i)},arguments.length++,r.apply(this,arguments)})},"name",{value:r.name})};OM.fromPromise=function(r){return Object.defineProperty(function(){let e=arguments[arguments.length-1];if(typeof e!="function")return r.apply(this,arguments);r.apply(this,arguments).then(t=>e(null,t),e)},"name",{value:r.name})}});var OB=M((n1e,MB)=>{var _p=require("constants"),tue=process.cwd,bP=null,rue=process.env.GRACEFUL_FS_PLATFORM||process.platform;process.cwd=function(){return bP||(bP=tue.call(process)),bP};try{process.cwd()}catch{}typeof process.chdir=="function"&&(KM=process.chdir,process.chdir=function(r){bP=null,KM.call(process,r)},Object.setPrototypeOf&&Object.setPrototypeOf(process.chdir,KM));var KM;MB.exports=nue;function nue(r){_p.hasOwnProperty("O_SYMLINK")&&process.version.match(/^v0\.6\.[0-2]|^v0\.5\./)&&e(r),r.lutimes||t(r),r.chown=o(r.chown),r.fchown=o(r.fchown),r.lchown=o(r.lchown),r.chmod=n(r.chmod),r.fchmod=n(r.fchmod),r.lchmod=n(r.lchmod),r.chownSync=s(r.chownSync),r.fchownSync=s(r.fchownSync),r.lchownSync=s(r.lchownSync),r.chmodSync=i(r.chmodSync),r.fchmodSync=i(r.fchmodSync),r.lchmodSync=i(r.lchmodSync),r.stat=a(r.stat),r.fstat=a(r.fstat),r.lstat=a(r.lstat),r.statSync=l(r.statSync),r.fstatSync=l(r.fstatSync),r.lstatSync=l(r.lstatSync),r.chmod&&!r.lchmod&&(r.lchmod=function(u,d,f){f&&process.nextTick(f)},r.lchmodSync=function(){}),r.chown&&!r.lchown&&(r.lchown=function(u,d,f,h){h&&process.nextTick(h)},r.lchownSync=function(){}),rue==="win32"&&(r.rename=typeof r.rename!="function"?r.rename:function(u){function d(f,h,v){var S=Date.now(),b=0;u(f,h,function D(_){if(_&&(_.code==="EACCES"||_.code==="EPERM")&&Date.now()-S<6e4){setTimeout(function(){r.stat(h,function(L,Z){L&&L.code==="ENOENT"?u(f,h,D):v(_)})},b),b<100&&(b+=10);return}v&&v(_)})}return Object.setPrototypeOf&&Object.setPrototypeOf(d,u),d}(r.rename)),r.read=typeof r.read!="function"?r.read:function(u){function d(f,h,v,S,b,D){var _;if(D&&typeof D=="function"){var L=0;_=function(Z,Se,ie){if(Z&&Z.code==="EAGAIN"&&L<10)return L++,u.call(r,f,h,v,S,b,_);D.apply(this,arguments)}}return u.call(r,f,h,v,S,b,_)}return Object.setPrototypeOf&&Object.setPrototypeOf(d,u),d}(r.read),r.readSync=typeof r.readSync!="function"?r.readSync:function(u){return function(d,f,h,v,S){for(var b=0;;)try{return u.call(r,d,f,h,v,S)}catch(D){if(D.code==="EAGAIN"&&b<10){b++;continue}throw D}}}(r.readSync);function e(u){u.lchmod=function(d,f,h){u.open(d,_p.O_WRONLY|_p.O_SYMLINK,f,function(v,S){if(v){h&&h(v);return}u.fchmod(S,f,function(b){u.close(S,function(D){h&&h(b||D)})})})},u.lchmodSync=function(d,f){var h=u.openSync(d,_p.O_WRONLY|_p.O_SYMLINK,f),v=!0,S;try{S=u.fchmodSync(h,f),v=!1}finally{if(v)try{u.closeSync(h)}catch{}else u.closeSync(h)}return S}}function t(u){_p.hasOwnProperty("O_SYMLINK")&&u.futimes?(u.lutimes=function(d,f,h,v){u.open(d,_p.O_SYMLINK,function(S,b){if(S){v&&v(S);return}u.futimes(b,f,h,function(D){u.close(b,function(_){v&&v(D||_)})})})},u.lutimesSync=function(d,f,h){var v=u.openSync(d,_p.O_SYMLINK),S,b=!0;try{S=u.futimesSync(v,f,h),b=!1}finally{if(b)try{u.closeSync(v)}catch{}else u.closeSync(v)}return S}):u.futimes&&(u.lutimes=function(d,f,h,v){v&&process.nextTick(v)},u.lutimesSync=function(){})}function n(u){return u&&function(d,f,h){return u.call(r,d,f,function(v){c(v)&&(v=null),h&&h.apply(this,arguments)})}}function i(u){return u&&function(d,f){try{return u.call(r,d,f)}catch(h){if(!c(h))throw h}}}function o(u){return u&&function(d,f,h,v){return u.call(r,d,f,h,function(S){c(S)&&(S=null),v&&v.apply(this,arguments)})}}function s(u){return u&&function(d,f,h){try{return u.call(r,d,f,h)}catch(v){if(!c(v))throw v}}}function a(u){return u&&function(d,f,h){typeof f=="function"&&(h=f,f=null);function v(S,b){b&&(b.uid<0&&(b.uid+=4294967296),b.gid<0&&(b.gid+=4294967296)),h&&h.apply(this,arguments)}return f?u.call(r,d,f,v):u.call(r,d,v)}}function l(u){return u&&function(d,f){var h=f?u.call(r,d,f):u.call(r,d);return h&&(h.uid<0&&(h.uid+=4294967296),h.gid<0&&(h.gid+=4294967296)),h}}function c(u){if(!u||u.code==="ENOSYS")return!0;var d=!process.getuid||process.getuid()!==0;return!!(d&&(u.code==="EINVAL"||u.code==="EPERM"))}}});var LB=M((i1e,FB)=>{var KB=require("stream").Stream;FB.exports=iue;function iue(r){return{ReadStream:e,WriteStream:t};function e(n,i){if(!(this instanceof e))return new e(n,i);KB.call(this);var o=this;this.path=n,this.fd=null,this.readable=!0,this.paused=!1,this.flags="r",this.mode=438,this.bufferSize=64*1024,i=i||{};for(var s=Object.keys(i),a=0,l=s.length;a<l;a++){var c=s[a];this[c]=i[c]}if(this.encoding&&this.setEncoding(this.encoding),this.start!==void 0){if(typeof this.start!="number")throw TypeError("start must be a Number");if(this.end===void 0)this.end=1/0;else if(typeof this.end!="number")throw TypeError("end must be a Number");if(this.start>this.end)throw new Error("start must be <= end");this.pos=this.start}if(this.fd!==null){process.nextTick(function(){o._read()});return}r.open(this.path,this.flags,this.mode,function(u,d){if(u){o.emit("error",u),o.readable=!1;return}o.fd=d,o.emit("open",d),o._read()})}function t(n,i){if(!(this instanceof t))return new t(n,i);KB.call(this),this.path=n,this.fd=null,this.writable=!0,this.flags="w",this.encoding="binary",this.mode=438,this.bytesWritten=0,i=i||{};for(var o=Object.keys(i),s=0,a=o.length;s<a;s++){var l=o[s];this[l]=i[l]}if(this.start!==void 0){if(typeof this.start!="number")throw TypeError("start must be a Number");if(this.start<0)throw new Error("start must be >= zero");this.pos=this.start}this.busy=!1,this._queue=[],this.fd===null&&(this._open=r.open,this._queue.push([this._open,this.path,this.flags,this.mode,void 0]),this.flush())}}});var WB=M((o1e,UB)=>{"use strict";UB.exports=sue;var oue=Object.getPrototypeOf||function(r){return r.__proto__};function sue(r){if(r===null||typeof r!="object")return r;if(r instanceof Object)var e={__proto__:oue(r)};else var e=Object.create(null);return Object.getOwnPropertyNames(r).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}),e}});var Ln=M((s1e,UM)=>{var vn=require("fs"),aue=OB(),lue=LB(),cue=WB(),IP=require("util"),Si,xP;typeof Symbol=="function"&&typeof Symbol.for=="function"?(Si=Symbol.for("graceful-fs.queue"),xP=Symbol.for("graceful-fs.previous")):(Si="___graceful-fs.queue",xP="___graceful-fs.previous");function uue(){}function BB(r,e){Object.defineProperty(r,Si,{get:function(){return e}})}var Sm=uue;IP.debuglog?Sm=IP.debuglog("gfs4"):/\bgfs4\b/i.test(process.env.NODE_DEBUG||"")&&(Sm=function(){var r=IP.format.apply(IP,arguments);r="GFS4: "+r.split(/\n/).join(`
GFS4: `),console.error(r)});vn[Si]||(jB=global[Si]||[],BB(vn,jB),vn.close=function(r){function e(t,n){return r.call(vn,t,function(i){i||VB(),typeof n=="function"&&n.apply(this,arguments)})}return Object.defineProperty(e,xP,{value:r}),e}(vn.close),vn.closeSync=function(r){function e(t){r.apply(vn,arguments),VB()}return Object.defineProperty(e,xP,{value:r}),e}(vn.closeSync),/\bgfs4\b/i.test(process.env.NODE_DEBUG||"")&&process.on("exit",function(){Sm(vn[Si]),require("assert").equal(vn[Si].length,0)}));var jB;global[Si]||BB(global,vn[Si]);UM.exports=FM(cue(vn));process.env.TEST_GRACEFUL_FS_GLOBAL_PATCH&&!vn.__patched&&(UM.exports=FM(vn),vn.__patched=!0);function FM(r){aue(r),r.gracefulify=FM,r.createReadStream=Se,r.createWriteStream=ie;var e=r.readFile;r.readFile=t;function t(ae,Me,Ge){return typeof Me=="function"&&(Ge=Me,Me=null),St(ae,Me,Ge);function St(vt,ot,oe,Pe){return e(vt,ot,function(Y){Y&&(Y.code==="EMFILE"||Y.code==="ENFILE")?Ag([St,[vt,ot,oe],Y,Pe||Date.now(),Date.now()]):typeof oe=="function"&&oe.apply(this,arguments)})}}var n=r.writeFile;r.writeFile=i;function i(ae,Me,Ge,St){return typeof Ge=="function"&&(St=Ge,Ge=null),vt(ae,Me,Ge,St);function vt(ot,oe,Pe,Y,be){return n(ot,oe,Pe,function(Je){Je&&(Je.code==="EMFILE"||Je.code==="ENFILE")?Ag([vt,[ot,oe,Pe,Y],Je,be||Date.now(),Date.now()]):typeof Y=="function"&&Y.apply(this,arguments)})}}var o=r.appendFile;o&&(r.appendFile=s);function s(ae,Me,Ge,St){return typeof Ge=="function"&&(St=Ge,Ge=null),vt(ae,Me,Ge,St);function vt(ot,oe,Pe,Y,be){return o(ot,oe,Pe,function(Je){Je&&(Je.code==="EMFILE"||Je.code==="ENFILE")?Ag([vt,[ot,oe,Pe,Y],Je,be||Date.now(),Date.now()]):typeof Y=="function"&&Y.apply(this,arguments)})}}var a=r.copyFile;a&&(r.copyFile=l);function l(ae,Me,Ge,St){return typeof Ge=="function"&&(St=Ge,Ge=0),vt(ae,Me,Ge,St);function vt(ot,oe,Pe,Y,be){return a(ot,oe,Pe,function(Je){Je&&(Je.code==="EMFILE"||Je.code==="ENFILE")?Ag([vt,[ot,oe,Pe,Y],Je,be||Date.now(),Date.now()]):typeof Y=="function"&&Y.apply(this,arguments)})}}var c=r.readdir;r.readdir=d;var u=/^v[0-5]\./;function d(ae,Me,Ge){typeof Me=="function"&&(Ge=Me,Me=null);var St=u.test(process.version)?function(oe,Pe,Y,be){return c(oe,vt(oe,Pe,Y,be))}:function(oe,Pe,Y,be){return c(oe,Pe,vt(oe,Pe,Y,be))};return St(ae,Me,Ge);function vt(ot,oe,Pe,Y){return function(be,Je){be&&(be.code==="EMFILE"||be.code==="ENFILE")?Ag([St,[ot,oe,Pe],be,Y||Date.now(),Date.now()]):(Je&&Je.sort&&Je.sort(),typeof Pe=="function"&&Pe.call(this,be,Je))}}}if(process.version.substr(0,4)==="v0.8"){var f=lue(r);D=f.ReadStream,L=f.WriteStream}var h=r.ReadStream;h&&(D.prototype=Object.create(h.prototype),D.prototype.open=_);var v=r.WriteStream;v&&(L.prototype=Object.create(v.prototype),L.prototype.open=Z),Object.defineProperty(r,"ReadStream",{get:function(){return D},set:function(ae){D=ae},enumerable:!0,configurable:!0}),Object.defineProperty(r,"WriteStream",{get:function(){return L},set:function(ae){L=ae},enumerable:!0,configurable:!0});var S=D;Object.defineProperty(r,"FileReadStream",{get:function(){return S},set:function(ae){S=ae},enumerable:!0,configurable:!0});var b=L;Object.defineProperty(r,"FileWriteStream",{get:function(){return b},set:function(ae){b=ae},enumerable:!0,configurable:!0});function D(ae,Me){return this instanceof D?(h.apply(this,arguments),this):D.apply(Object.create(D.prototype),arguments)}function _(){var ae=this;de(ae.path,ae.flags,ae.mode,function(Me,Ge){Me?(ae.autoClose&&ae.destroy(),ae.emit("error",Me)):(ae.fd=Ge,ae.emit("open",Ge),ae.read())})}function L(ae,Me){return this instanceof L?(v.apply(this,arguments),this):L.apply(Object.create(L.prototype),arguments)}function Z(){var ae=this;de(ae.path,ae.flags,ae.mode,function(Me,Ge){Me?(ae.destroy(),ae.emit("error",Me)):(ae.fd=Ge,ae.emit("open",Ge))})}function Se(ae,Me){return new r.ReadStream(ae,Me)}function ie(ae,Me){return new r.WriteStream(ae,Me)}var fe=r.open;r.open=de;function de(ae,Me,Ge,St){return typeof Ge=="function"&&(St=Ge,Ge=null),vt(ae,Me,Ge,St);function vt(ot,oe,Pe,Y,be){return fe(ot,oe,Pe,function(Je,yn){Je&&(Je.code==="EMFILE"||Je.code==="ENFILE")?Ag([vt,[ot,oe,Pe,Y],Je,be||Date.now(),Date.now()]):typeof Y=="function"&&Y.apply(this,arguments)})}}return r}function Ag(r){Sm("ENQUEUE",r[0].name,r[1]),vn[Si].push(r),LM()}var SP;function VB(){for(var r=Date.now(),e=0;e<vn[Si].length;++e)vn[Si][e].length>2&&(vn[Si][e][3]=r,vn[Si][e][4]=r);LM()}function LM(){if(clearTimeout(SP),SP=void 0,vn[Si].length!==0){var r=vn[Si].shift(),e=r[0],t=r[1],n=r[2],i=r[3],o=r[4];if(i===void 0)Sm("RETRY",e.name,t),e.apply(null,t);else if(Date.now()-i>=6e4){Sm("TIMEOUT",e.name,t);var s=t.pop();typeof s=="function"&&s.call(null,n)}else{var a=Date.now()-o,l=Math.max(o-i,1),c=Math.min(l*1.2,100);a>=c?(Sm("RETRY",e.name,t),e.apply(null,t.concat([i]))):vn[Si].push(r)}SP===void 0&&(SP=setTimeout(LM,0))}}});var WM=M(Mg=>{var pue=Do().fromCallback,Pa=Ln(),due=["access","appendFile","chmod","chown","close","copyFile","fchmod","fchown","fdatasync","fstat","fsync","ftruncate","futimes","lchown","link","lstat","mkdir","mkdtemp","open","readFile","readdir","readlink","realpath","rename","rmdir","stat","symlink","truncate","unlink","utimes","writeFile"].filter(r=>typeof Pa[r]=="function");Object.keys(Pa).forEach(r=>{Mg[r]=Pa[r]});due.forEach(r=>{Mg[r]=pue(Pa[r])});Mg.exists=function(r,e){return typeof e=="function"?Pa.exists(r,e):new Promise(t=>Pa.exists(r,t))};Mg.read=function(r,e,t,n,i,o){return typeof o=="function"?Pa.read(r,e,t,n,i,o):new Promise((s,a)=>{Pa.read(r,e,t,n,i,(l,c,u)=>{if(l)return a(l);s({bytesRead:c,buffer:u})})})};Mg.write=function(r,e,t,n,i,o){return typeof arguments[arguments.length-1]=="function"?Pa.write(r,e,t,n,i,o):typeof e=="string"?new Promise((s,a)=>{Pa.write(r,e,t,n,(l,c,u)=>{if(l)return a(l);s({bytesWritten:c,buffer:u})})}):new Promise((s,a)=>{Pa.write(r,e,t,n,i,(l,c,u)=>{if(l)return a(l);s({bytesWritten:c,buffer:u})})})}});var $B=M((l1e,JB)=>{"use strict";var Go=Ln(),qB=require("os"),CP=require("path");function mue(){let r=CP.join("millis-test-sync"+Date.now().toString()+Math.random().toString().slice(2));r=CP.join(qB.tmpdir(),r);let e=new Date(1435410243862);Go.writeFileSync(r,"https://github.com/jprichardson/node-fs-extra/pull/141");let t=Go.openSync(r,"r+");return Go.futimesSync(t,e,e),Go.closeSync(t),Go.statSync(r).mtime>1435410243e3}function fue(r){let e=CP.join("millis-test"+Date.now().toString()+Math.random().toString().slice(2));e=CP.join(qB.tmpdir(),e);let t=new Date(1435410243862);Go.writeFile(e,"https://github.com/jprichardson/node-fs-extra/pull/141",n=>{if(n)return r(n);Go.open(e,"r+",(i,o)=>{if(i)return r(i);Go.futimes(o,t,t,s=>{if(s)return r(s);Go.close(o,a=>{if(a)return r(a);Go.stat(e,(l,c)=>{if(l)return r(l);r(null,c.mtime>1435410243e3)})})})})})}function hue(r){if(typeof r=="number")return Math.floor(r/1e3)*1e3;if(r instanceof Date)return new Date(Math.floor(r.getTime()/1e3)*1e3);throw new Error("fs-extra: timeRemoveMillis() unknown parameter type")}function gue(r,e,t,n){Go.open(r,"r+",(i,o)=>{if(i)return n(i);Go.futimes(o,e,t,s=>{Go.close(o,a=>{n&&n(s||a)})})})}JB.exports={hasMillisRes:fue,hasMillisResSync:mue,timeRemoveMillis:hue,utimesMillis:gue}});var jM=M((c1e,HB)=>{var zo=Ln(),Kx=require("path"),vue=$B();function yue(r,e,t,n){n||(n=t,t={});var i=process.cwd(),o=Kx.resolve(i,r),s=Kx.resolve(i,e),a=t.filter,l=t.transform,c=t.overwrite;c===void 0&&(c=t.clobber),c===void 0&&(c=!0);var u=t.errorOnExist,d=t.dereference,f=t.preserveTimestamps===!0,h=0,v=0,S=0,b=!1;D(o);function D(oe){if(h++,a){if(a instanceof RegExp){if(console.warn("Warning: fs-extra: Passing a RegExp filter is deprecated, use a function"),!a.test(oe))return ot(!0)}else if(typeof a=="function"&&!a(oe,e))return ot(!0)}return _(oe)}function _(oe){var Pe=d?zo.stat:zo.lstat;S++,Pe(oe,function(Y,be){if(Y)return vt(Y);var Je={name:oe,mode:be.mode,mtime:be.mtime,atime:be.atime,stats:be};if(be.isDirectory())return ie(Je);if(be.isFile()||be.isCharacterDevice()||be.isBlockDevice())return L(Je);if(be.isSymbolicLink())return ae(oe)})}function L(oe){var Pe=oe.name.replace(o,s.replace("$","$$$$"));St(Pe,function(Y){Y?Z(oe,Pe):c?Se(Pe,function(){Z(oe,Pe)}):u?vt(new Error(Pe+" already exists")):ot()})}function Z(oe,Pe){var Y=zo.createReadStream(oe.name),be=zo.createWriteStream(Pe,{mode:oe.mode});Y.on("error",vt),be.on("error",vt),l?l(Y,be,oe):be.on("open",function(){Y.pipe(be)}),be.once("close",function(){zo.chmod(Pe,oe.mode,function(Je){if(Je)return vt(Je);f?vue.utimesMillis(Pe,oe.atime,oe.mtime,function(yn){return yn?vt(yn):ot()}):ot()})})}function Se(oe,Pe){zo.unlink(oe,function(Y){return Y?vt(Y):Pe()})}function ie(oe){var Pe=oe.name.replace(o,s.replace("$","$$$$"));St(Pe,function(Y){if(Y)return fe(oe,Pe);de(oe.name)})}function fe(oe,Pe){zo.mkdir(Pe,oe.mode,function(Y){if(Y)return vt(Y);zo.chmod(Pe,oe.mode,function(be){if(be)return vt(be);de(oe.name)})})}function de(oe){zo.readdir(oe,function(Pe,Y){return Pe?vt(Pe):(Y.forEach(function(be){D(Kx.join(oe,be))}),ot())})}function ae(oe){var Pe=oe.replace(o,s);zo.readlink(oe,function(Y,be){if(Y)return vt(Y);Me(be,Pe)})}function Me(oe,Pe){d&&(oe=Kx.resolve(i,oe)),St(Pe,function(Y){if(Y)return Ge(oe,Pe);zo.readlink(Pe,function(be,Je){return be?vt(be):(d&&(Je=Kx.resolve(i,Je)),Je===oe?ot():Se(Pe,function(){Ge(oe,Pe)}))})})}function Ge(oe,Pe){zo.symlink(oe,Pe,function(Y){return Y?vt(Y):ot()})}function St(oe,Pe){zo.lstat(oe,function(Y){return Y&&Y.code==="ENOENT"?Pe(!0):Pe(!1)})}function vt(oe){if(!b&&n!==void 0)return b=!0,n(oe)}function ot(oe){if(oe||S--,v++,h===v&&S===0&&n!==void 0)return n(null)}}HB.exports=yue});var BM=M((u1e,zB)=>{"use strict";var VM=require("path");function GB(r){return r=VM.normalize(VM.resolve(r)).split(VM.sep),r.length>0?r[0]:null}var bue=/[<>:"|?*]/;function Iue(r){let e=GB(r);return r=r.replace(e,""),bue.test(r)}zB.exports={getRootPath:GB,invalidWin32Path:Iue}});var YB=M((p1e,QB)=>{"use strict";var Sue=Ln(),qM=require("path"),xue=BM().invalidWin32Path,Cue=parseInt("0777",8);function JM(r,e,t,n){if(typeof e=="function"?(t=e,e={}):(!e||typeof e!="object")&&(e={mode:e}),process.platform==="win32"&&xue(r)){let s=new Error(r+" contains invalid WIN32 path characters.");return s.code="EINVAL",t(s)}let i=e.mode,o=e.fs||Sue;i===void 0&&(i=Cue&~process.umask()),n||(n=null),t=t||function(){},r=qM.resolve(r),o.mkdir(r,i,s=>{if(!s)return n=n||r,t(null,n);switch(s.code){case"ENOENT":if(qM.dirname(r)===r)return t(s);JM(qM.dirname(r),e,(a,l)=>{a?t(a,l):JM(r,e,t,l)});break;default:o.stat(r,(a,l)=>{a||!l.isDirectory()?t(s,n):t(null,n)});break}})}QB.exports=JM});var ZB=M((d1e,XB)=>{"use strict";var Eue=Ln(),$M=require("path"),wue=BM().invalidWin32Path,kue=parseInt("0777",8);function HM(r,e,t){(!e||typeof e!="object")&&(e={mode:e});let n=e.mode,i=e.fs||Eue;if(process.platform==="win32"&&wue(r)){let o=new Error(r+" contains invalid WIN32 path characters.");throw o.code="EINVAL",o}n===void 0&&(n=kue&~process.umask()),t||(t=null),r=$M.resolve(r);try{i.mkdirSync(r,n),t=t||r}catch(o){switch(o.code){case"ENOENT":if($M.dirname(r)===r)throw o;t=HM($M.dirname(r),e,t),HM(r,e,t);break;default:let s;try{s=i.statSync(r)}catch{throw o}if(!s.isDirectory())throw o;break}}return t}XB.exports=HM});var Qo=M((m1e,eq)=>{"use strict";var Pue=Do().fromCallback,GM=Pue(YB()),zM=ZB();eq.exports={mkdirs:GM,mkdirsSync:zM,mkdirp:GM,mkdirpSync:zM,ensureDir:GM,ensureDirSync:zM}});var Bc=M((f1e,rq)=>{"use strict";var Due=Do().fromPromise,tq=WM();function Tue(r){return tq.access(r).then(()=>!0).catch(()=>!1)}rq.exports={pathExists:Due(Tue),pathExistsSync:tq.existsSync}});var oq=M((h1e,iq)=>{"use strict";var _ue=Ln(),Fx=require("path"),nq=jM(),Rue=Qo(),Nue=Bc().pathExists;function Aue(r,e,t,n){typeof t=="function"&&!n?(n=t,t={}):(typeof t=="function"||t instanceof RegExp)&&(t={filter:t}),n=n||function(){},t=t||{},t.preserveTimestamps&&process.arch==="ia32"&&console.warn(`fs-extra: Using the preserveTimestamps option in 32-bit node is not recommended;

    see https://github.com/jprichardson/node-fs-extra/issues/269`);let i=process.cwd(),o=Fx.resolve(i,r),s=Fx.resolve(i,e);if(o===s)return n(new Error("Source and destination must not be the same."));_ue.lstat(r,(a,l)=>{if(a)return n(a);let c=null;if(l.isDirectory()){let u=e.split(Fx.sep);u.pop(),c=u.join(Fx.sep)}else c=Fx.dirname(e);Nue(c,(u,d)=>{if(u)return n(u);if(d)return nq(r,e,t,n);Rue.mkdirs(c,f=>{if(f)return n(f);nq(r,e,t,n)})})})}iq.exports=Aue});var aq=M((g1e,sq)=>{var Mue=Do().fromCallback;sq.exports={copy:Mue(oq())}});var QM=M((v1e,lq)=>{lq.exports=function(r){if(typeof Buffer.allocUnsafe=="function")try{return Buffer.allocUnsafe(r)}catch{return new Buffer(r)}return new Buffer(r)}});var dq=M((y1e,pq)=>{"use strict";var Vl=Ln(),uq=64*1024,cq=QM()(uq);function Oue(r,e,t){let n=t.overwrite,i=t.errorOnExist,o=t.preserveTimestamps;if(Vl.existsSync(e))if(n)Vl.unlinkSync(e);else{if(i)throw new Error(`${e} already exists`);return}let s=Vl.openSync(r,"r"),a=Vl.fstatSync(s),l=Vl.openSync(e,"w",a.mode),c=1,u=0;for(;c>0;)c=Vl.readSync(s,cq,0,uq,u),Vl.writeSync(l,cq,0,c),u+=c;o&&Vl.futimesSync(l,a.atime,a.mtime),Vl.closeSync(s),Vl.closeSync(l)}pq.exports=Oue});var gq=M((b1e,hq)=>{"use strict";var xm=Ln(),YM=require("path"),Kue=dq(),mq=Qo();function fq(r,e,t){(typeof t=="function"||t instanceof RegExp)&&(t={filter:t}),t=t||{},t.recursive=!!t.recursive,t.clobber="clobber"in t?!!t.clobber:!0,t.overwrite="overwrite"in t?!!t.overwrite:t.clobber,t.dereference="dereference"in t?!!t.dereference:!1,t.preserveTimestamps="preserveTimestamps"in t?!!t.preserveTimestamps:!1,t.filter=t.filter||function(){return!0},t.preserveTimestamps&&process.arch==="ia32"&&console.warn(`fs-extra: Using the preserveTimestamps option in 32-bit node is not recommended;

    see https://github.com/jprichardson/node-fs-extra/issues/269`);let n=t.recursive&&!t.dereference?xm.lstatSync(r):xm.statSync(r),i=YM.dirname(e),o=xm.existsSync(i),s=!1;if(t.filter instanceof RegExp?(console.warn("Warning: fs-extra: Passing a RegExp filter is deprecated, use a function"),s=t.filter.test(r)):typeof t.filter=="function"&&(s=t.filter(r,e)),n.isFile()&&s)o||mq.mkdirsSync(i),Kue(r,e,{overwrite:t.overwrite,errorOnExist:t.errorOnExist,preserveTimestamps:t.preserveTimestamps});else if(n.isDirectory()&&s)xm.existsSync(e)||mq.mkdirsSync(e),xm.readdirSync(r).forEach(l=>{let c=t;c.recursive=!0,fq(YM.join(r,l),YM.join(e,l),c)});else if(t.recursive&&n.isSymbolicLink()&&s){let a=xm.readlinkSync(r);xm.symlinkSync(a,e)}}hq.exports=fq});var XM=M((I1e,vq)=>{vq.exports={copySync:gq()}});var kq=M((S1e,wq)=>{"use strict";var yq=Ln(),xq=require("path"),hr=require("assert"),Lx=process.platform==="win32";function Cq(r){["unlink","chmod","stat","lstat","rmdir","readdir"].forEach(t=>{r[t]=r[t]||yq[t],t=t+"Sync",r[t]=r[t]||yq[t]}),r.maxBusyTries=r.maxBusyTries||3}function ZM(r,e,t){let n=0;typeof e=="function"&&(t=e,e={}),hr(r,"rimraf: missing path"),hr.equal(typeof r,"string","rimraf: path should be a string"),hr.equal(typeof t,"function","rimraf: callback function required"),hr(e,"rimraf: invalid options argument provided"),hr.equal(typeof e,"object","rimraf: options should be object"),Cq(e),bq(r,e,function i(o){if(o){if((o.code==="EBUSY"||o.code==="ENOTEMPTY"||o.code==="EPERM")&&n<e.maxBusyTries){n++;let s=n*100;return setTimeout(()=>bq(r,e,i),s)}o.code==="ENOENT"&&(o=null)}t(o)})}function bq(r,e,t){hr(r),hr(e),hr(typeof t=="function"),e.lstat(r,(n,i)=>{if(n&&n.code==="ENOENT")return t(null);if(n&&n.code==="EPERM"&&Lx)return Iq(r,e,n,t);if(i&&i.isDirectory())return EP(r,e,n,t);e.unlink(r,o=>{if(o){if(o.code==="ENOENT")return t(null);if(o.code==="EPERM")return Lx?Iq(r,e,o,t):EP(r,e,o,t);if(o.code==="EISDIR")return EP(r,e,o,t)}return t(o)})})}function Iq(r,e,t,n){hr(r),hr(e),hr(typeof n=="function"),t&&hr(t instanceof Error),e.chmod(r,438,i=>{i?n(i.code==="ENOENT"?null:t):e.stat(r,(o,s)=>{o?n(o.code==="ENOENT"?null:t):s.isDirectory()?EP(r,e,t,n):e.unlink(r,n)})})}function Sq(r,e,t){let n;hr(r),hr(e),t&&hr(t instanceof Error);try{e.chmodSync(r,438)}catch(i){if(i.code==="ENOENT")return;throw t}try{n=e.statSync(r)}catch(i){if(i.code==="ENOENT")return;throw t}n.isDirectory()?wP(r,e,t):e.unlinkSync(r)}function EP(r,e,t,n){hr(r),hr(e),t&&hr(t instanceof Error),hr(typeof n=="function"),e.rmdir(r,i=>{i&&(i.code==="ENOTEMPTY"||i.code==="EEXIST"||i.code==="EPERM")?Fue(r,e,n):i&&i.code==="ENOTDIR"?n(t):n(i)})}function Fue(r,e,t){hr(r),hr(e),hr(typeof t=="function"),e.readdir(r,(n,i)=>{if(n)return t(n);let o=i.length,s;if(o===0)return e.rmdir(r,t);i.forEach(a=>{ZM(xq.join(r,a),e,l=>{if(!s){if(l)return t(s=l);--o===0&&e.rmdir(r,t)}})})})}function Eq(r,e){let t;e=e||{},Cq(e),hr(r,"rimraf: missing path"),hr.equal(typeof r,"string","rimraf: path should be a string"),hr(e,"rimraf: missing options"),hr.equal(typeof e,"object","rimraf: options should be object");try{t=e.lstatSync(r)}catch(n){if(n.code==="ENOENT")return;n.code==="EPERM"&&Lx&&Sq(r,e,n)}try{t&&t.isDirectory()?wP(r,e,null):e.unlinkSync(r)}catch(n){if(n.code==="ENOENT")return;if(n.code==="EPERM")return Lx?Sq(r,e,n):wP(r,e,n);if(n.code!=="EISDIR")throw n;wP(r,e,n)}}function wP(r,e,t){hr(r),hr(e),t&&hr(t instanceof Error);try{e.rmdirSync(r)}catch(n){if(n.code==="ENOTDIR")throw t;if(n.code==="ENOTEMPTY"||n.code==="EEXIST"||n.code==="EPERM")Lue(r,e);else if(n.code!=="ENOENT")throw n}}function Lue(r,e){hr(r),hr(e),e.readdirSync(r).forEach(i=>Eq(xq.join(r,i),e));let t=Lx?100:1,n=0;do{let i=!0;try{let o=e.rmdirSync(r,e);return i=!1,o}finally{if(++n<t&&i)continue}}while(!0)}wq.exports=ZM;ZM.sync=Eq});var Ux=M((x1e,Dq)=>{"use strict";var Uue=Do().fromCallback,Pq=kq();Dq.exports={remove:Uue(Pq),removeSync:Pq.sync}});var Nq=M((C1e,Rq)=>{var Og;try{Og=Ln()}catch{Og=require("fs")}function Wue(r,e,t){t==null&&(t=e,e={}),typeof e=="string"&&(e={encoding:e}),e=e||{};var n=e.fs||Og,i=!0;"throws"in e&&(i=e.throws),n.readFile(r,e,function(o,s){if(o)return t(o);s=_q(s);var a;try{a=JSON.parse(s,e?e.reviver:null)}catch(l){return i?(l.message=r+": "+l.message,t(l)):t(null,null)}t(null,a)})}function jue(r,e){e=e||{},typeof e=="string"&&(e={encoding:e});var t=e.fs||Og,n=!0;"throws"in e&&(n=e.throws);try{var i=t.readFileSync(r,e);return i=_q(i),JSON.parse(i,e.reviver)}catch(o){if(n)throw o.message=r+": "+o.message,o;return null}}function Tq(r,e){var t,n=`
`;typeof e=="object"&&e!==null&&(e.spaces&&(t=e.spaces),e.EOL&&(n=e.EOL));var i=JSON.stringify(r,e?e.replacer:null,t);return i.replace(/\n/g,n)+n}function Vue(r,e,t,n){n==null&&(n=t,t={}),t=t||{};var i=t.fs||Og,o="";try{o=Tq(e,t)}catch(s){n&&n(s,null);return}i.writeFile(r,o,t,n)}function Bue(r,e,t){t=t||{};var n=t.fs||Og,i=Tq(e,t);return n.writeFileSync(r,i,t)}function _q(r){return Buffer.isBuffer(r)&&(r=r.toString("utf8")),r=r.replace(/^\uFEFF/,""),r}var que={readFile:Wue,readFileSync:jue,writeFile:Vue,writeFileSync:Bue};Rq.exports=que});var PP=M((E1e,Mq)=>{"use strict";var Aq=Do().fromCallback,kP=Nq();Mq.exports={readJson:Aq(kP.readFile),readJsonSync:kP.readFileSync,writeJson:Aq(kP.writeFile),writeJsonSync:kP.writeFileSync}});var Fq=M((w1e,Kq)=>{"use strict";var Jue=require("path"),$ue=Qo(),Hue=Bc().pathExists,Oq=PP();function Gue(r,e,t,n){typeof t=="function"&&(n=t,t={});let i=Jue.dirname(r);Hue(i,(o,s)=>{if(o)return n(o);if(s)return Oq.writeJson(r,e,t,n);$ue.mkdirs(i,a=>{if(a)return n(a);Oq.writeJson(r,e,t,n)})})}Kq.exports=Gue});var Uq=M((k1e,Lq)=>{"use strict";var zue=Ln(),Que=require("path"),Yue=Qo(),Xue=PP();function Zue(r,e,t){let n=Que.dirname(r);zue.existsSync(n)||Yue.mkdirsSync(n),Xue.writeJsonSync(r,e,t)}Lq.exports=Zue});var jq=M((P1e,Wq)=>{"use strict";var epe=Do().fromCallback,ao=PP();ao.outputJson=epe(Fq());ao.outputJsonSync=Uq();ao.outputJSON=ao.outputJson;ao.outputJSONSync=ao.outputJsonSync;ao.writeJSON=ao.writeJson;ao.writeJSONSync=ao.writeJsonSync;ao.readJSON=ao.readJson;ao.readJSONSync=ao.readJsonSync;Wq.exports=ao});var Jq=M((D1e,qq)=>{"use strict";var tpe=Do().fromCallback,Bl=Ln(),rpe=jM(),Cm=require("path"),DP=Ux().remove,npe=Qo().mkdirs;function eO(r,e,t,n){typeof t=="function"&&(n=t,t={});let i=t.overwrite||t.clobber||!1;ope(r,e,(s,a)=>{if(s)return n(s);if(a)return n(new Error(`Cannot move '${r}' to a subdirectory of itself, '${e}'.`));npe(Cm.dirname(e),l=>{if(l)return n(l);o()})});function o(){Cm.resolve(r)===Cm.resolve(e)?Bl.access(r,n):i?Bl.rename(r,e,s=>{if(!s)return n();if(s.code==="ENOTEMPTY"||s.code==="EEXIST"){DP(e,a=>{if(a)return n(a);t.overwrite=!1,eO(r,e,t,n)});return}if(s.code==="EPERM"){setTimeout(()=>{DP(e,a=>{if(a)return n(a);t.overwrite=!1,eO(r,e,t,n)})},200);return}if(s.code!=="EXDEV")return n(s);Vq(r,e,i,n)}):Bl.link(r,e,s=>s?s.code==="EXDEV"||s.code==="EISDIR"||s.code==="EPERM"||s.code==="ENOTSUP"?Vq(r,e,i,n):n(s):Bl.unlink(r,n))}}function Vq(r,e,t,n){Bl.stat(r,(i,o)=>{if(i)return n(i);o.isDirectory()?Bq(r,e,t,n):ipe(r,e,t,n)})}function ipe(r,e,t,n){let i=t?"w":"wx",o=Bl.createReadStream(r),s=Bl.createWriteStream(e,{flags:i});o.on("error",l=>{o.destroy(),s.destroy(),s.removeListener("close",a),Bl.unlink(e,()=>{l.code==="EISDIR"||l.code==="EPERM"?Bq(r,e,t,n):n(l)})}),s.on("error",l=>{o.destroy(),s.destroy(),s.removeListener("close",a),n(l)}),s.once("close",a),o.pipe(s);function a(){Bl.unlink(r,n)}}function Bq(r,e,t,n){let i={overwrite:!1};t?DP(e,s=>{if(s)return n(s);o()}):o();function o(){rpe(r,e,i,s=>{if(s)return n(s);DP(r,n)})}}function ope(r,e,t){Bl.stat(r,(n,i)=>{if(n)return t(n);if(i.isDirectory()){let o=e.split(Cm.dirname(r)+Cm.sep)[1];if(o){let s=o.split(Cm.sep)[0];return s?t(null,r!==e&&e.indexOf(r)>-1&&s===Cm.basename(r)):t(null,!1)}return t(null,!1)}return t(null,!1)})}qq.exports={move:tpe(eO)}});var zq=M((T1e,Gq)=>{"use strict";var To=Ln(),Em=require("path"),spe=XM().copySync,tO=Ux().removeSync,ape=Qo().mkdirsSync,lpe=QM();function Hq(r,e,t){t=t||{};let n=t.overwrite||t.clobber||!1;if(r=Em.resolve(r),e=Em.resolve(e),r===e)return To.accessSync(r);if(ppe(r,e))throw new Error(`Cannot move '${r}' into itself '${e}'.`);ape(Em.dirname(e)),i();function i(){if(n)try{return To.renameSync(r,e)}catch(o){if(o.code==="ENOTEMPTY"||o.code==="EEXIST"||o.code==="EPERM")return tO(e),t.overwrite=!1,Hq(r,e,t);if(o.code!=="EXDEV")throw o;return $q(r,e,n)}else try{return To.linkSync(r,e),To.unlinkSync(r)}catch(o){if(o.code==="EXDEV"||o.code==="EISDIR"||o.code==="EPERM"||o.code==="ENOTSUP")return $q(r,e,n);throw o}}}function $q(r,e,t){return To.statSync(r).isDirectory()?upe(r,e,t):cpe(r,e,t)}function cpe(r,e,t){let i=lpe(65536),o=t?"w":"wx",s=To.openSync(r,"r"),a=To.fstatSync(s),l=To.openSync(e,o,a.mode),c=1,u=0;for(;c>0;)c=To.readSync(s,i,0,65536,u),To.writeSync(l,i,0,c),u+=c;return To.closeSync(s),To.closeSync(l),To.unlinkSync(r)}function upe(r,e,t){let n={overwrite:!1};t&&tO(e),i();function i(){return spe(r,e,n),tO(r)}}function ppe(r,e){try{return To.statSync(r).isDirectory()&&r!==e&&e.indexOf(r)>-1&&e.split(Em.dirname(r)+Em.sep)[1].split(Em.sep)[0]===Em.basename(r)}catch{return!1}}Gq.exports={moveSync:Hq}});var nJ=M((_1e,rJ)=>{"use strict";var dpe=Do().fromCallback,Xq=require("fs"),Zq=require("path"),eJ=Qo(),tJ=Ux(),Qq=dpe(function(e,t){t=t||function(){},Xq.readdir(e,(n,i)=>{if(n)return eJ.mkdirs(e,t);i=i.map(s=>Zq.join(e,s)),o();function o(){let s=i.pop();if(!s)return t();tJ.remove(s,a=>{if(a)return t(a);o()})}})});function Yq(r){let e;try{e=Xq.readdirSync(r)}catch{return eJ.mkdirsSync(r)}e.forEach(t=>{t=Zq.join(r,t),tJ.removeSync(t)})}rJ.exports={emptyDirSync:Yq,emptydirSync:Yq,emptyDir:Qq,emptydir:Qq}});var aJ=M((R1e,sJ)=>{"use strict";var mpe=Do().fromCallback,iJ=require("path"),Wx=Ln(),oJ=Qo(),fpe=Bc().pathExists;function hpe(r,e){function t(){Wx.writeFile(r,"",n=>{if(n)return e(n);e()})}Wx.stat(r,(n,i)=>{if(!n&&i.isFile())return e();let o=iJ.dirname(r);fpe(o,(s,a)=>{if(s)return e(s);if(a)return t();oJ.mkdirs(o,l=>{if(l)return e(l);t()})})})}function gpe(r){let e;try{e=Wx.statSync(r)}catch{}if(e&&e.isFile())return;let t=iJ.dirname(r);Wx.existsSync(t)||oJ.mkdirsSync(t),Wx.writeFileSync(r,"")}sJ.exports={createFile:mpe(hpe),createFileSync:gpe}});var dJ=M((N1e,pJ)=>{"use strict";var vpe=Do().fromCallback,cJ=require("path"),wm=Ln(),uJ=Qo(),lJ=Bc().pathExists;function ype(r,e,t){function n(i,o){wm.link(i,o,s=>{if(s)return t(s);t(null)})}lJ(e,(i,o)=>{if(i)return t(i);if(o)return t(null);wm.lstat(r,(s,a)=>{if(s)return s.message=s.message.replace("lstat","ensureLink"),t(s);let l=cJ.dirname(e);lJ(l,(c,u)=>{if(c)return t(c);if(u)return n(r,e);uJ.mkdirs(l,d=>{if(d)return t(d);n(r,e)})})})})}function bpe(r,e,t){if(wm.existsSync(e))return;try{wm.lstatSync(r)}catch(s){throw s.message=s.message.replace("lstat","ensureLink"),s}let i=cJ.dirname(e);return wm.existsSync(i)||uJ.mkdirsSync(i),wm.linkSync(r,e)}pJ.exports={createLink:vpe(ype),createLinkSync:bpe}});var fJ=M((A1e,mJ)=>{"use strict";var Rp=require("path"),jx=Ln(),Ipe=Bc().pathExists;function Spe(r,e,t){if(Rp.isAbsolute(r))return jx.lstat(r,(n,i)=>n?(n.message=n.message.replace("lstat","ensureSymlink"),t(n)):t(null,{toCwd:r,toDst:r}));{let n=Rp.dirname(e),i=Rp.join(n,r);return Ipe(i,(o,s)=>o?t(o):s?t(null,{toCwd:i,toDst:r}):jx.lstat(r,(a,l)=>a?(a.message=a.message.replace("lstat","ensureSymlink"),t(a)):t(null,{toCwd:r,toDst:Rp.relative(n,r)})))}}function xpe(r,e){let t;if(Rp.isAbsolute(r)){if(t=jx.existsSync(r),!t)throw new Error("absolute srcpath does not exist");return{toCwd:r,toDst:r}}else{let n=Rp.dirname(e),i=Rp.join(n,r);if(t=jx.existsSync(i),t)return{toCwd:i,toDst:r};if(t=jx.existsSync(r),!t)throw new Error("relative srcpath does not exist");return{toCwd:r,toDst:Rp.relative(n,r)}}}mJ.exports={symlinkPaths:Spe,symlinkPathsSync:xpe}});var vJ=M((M1e,gJ)=>{"use strict";var hJ=Ln();function Cpe(r,e,t){if(t=typeof e=="function"?e:t,e=typeof e=="function"?!1:e,e)return t(null,e);hJ.lstat(r,(n,i)=>{if(n)return t(null,"file");e=i&&i.isDirectory()?"dir":"file",t(null,e)})}function Epe(r,e){let t;if(e)return e;try{t=hJ.lstatSync(r)}catch{return"file"}return t&&t.isDirectory()?"dir":"file"}gJ.exports={symlinkType:Cpe,symlinkTypeSync:Epe}});var EJ=M((O1e,CJ)=>{"use strict";var wpe=Do().fromCallback,bJ=require("path"),Kg=Ln(),IJ=Qo(),kpe=IJ.mkdirs,Ppe=IJ.mkdirsSync,SJ=fJ(),Dpe=SJ.symlinkPaths,Tpe=SJ.symlinkPathsSync,xJ=vJ(),_pe=xJ.symlinkType,Rpe=xJ.symlinkTypeSync,yJ=Bc().pathExists;function Npe(r,e,t,n){n=typeof t=="function"?t:n,t=typeof t=="function"?!1:t,yJ(e,(i,o)=>{if(i)return n(i);if(o)return n(null);Dpe(r,e,(s,a)=>{if(s)return n(s);r=a.toDst,_pe(a.toCwd,t,(l,c)=>{if(l)return n(l);let u=bJ.dirname(e);yJ(u,(d,f)=>{if(d)return n(d);if(f)return Kg.symlink(r,e,c,n);kpe(u,h=>{if(h)return n(h);Kg.symlink(r,e,c,n)})})})})})}function Ape(r,e,t,n){if(n=typeof t=="function"?t:n,t=typeof t=="function"?!1:t,Kg.existsSync(e))return;let o=Tpe(r,e);r=o.toDst,t=Rpe(o.toCwd,t);let s=bJ.dirname(e);return Kg.existsSync(s)||Ppe(s),Kg.symlinkSync(r,e,t)}CJ.exports={createSymlink:wpe(Npe),createSymlinkSync:Ape}});var kJ=M((K1e,wJ)=>{"use strict";var TP=aJ(),_P=dJ(),RP=EJ();wJ.exports={createFile:TP.createFile,createFileSync:TP.createFileSync,ensureFile:TP.createFile,ensureFileSync:TP.createFileSync,createLink:_P.createLink,createLinkSync:_P.createLinkSync,ensureLink:_P.createLink,ensureLinkSync:_P.createLinkSync,createSymlink:RP.createSymlink,createSymlinkSync:RP.createSymlinkSync,ensureSymlink:RP.createSymlink,ensureSymlinkSync:RP.createSymlinkSync}});var _J=M((F1e,TJ)=>{"use strict";var Mpe=Do().fromCallback,km=Ln(),PJ=require("path"),DJ=Qo(),Ope=Bc().pathExists;function Kpe(r,e,t,n){typeof t=="function"&&(n=t,t="utf8");let i=PJ.dirname(r);Ope(i,(o,s)=>{if(o)return n(o);if(s)return km.writeFile(r,e,t,n);DJ.mkdirs(i,a=>{if(a)return n(a);km.writeFile(r,e,t,n)})})}function Fpe(r,e,t){let n=PJ.dirname(r);if(km.existsSync(n))return km.writeFileSync.apply(km,arguments);DJ.mkdirsSync(n),km.writeFileSync.apply(km,arguments)}TJ.exports={outputFile:Mpe(Kpe),outputFileSync:Fpe}});var ql=M((L1e,RJ)=>{"use strict";var Fs=AB(),Yo={};Fs(Yo,WM());Fs(Yo,aq());Fs(Yo,XM());Fs(Yo,Qo());Fs(Yo,Ux());Fs(Yo,jq());Fs(Yo,Jq());Fs(Yo,zq());Fs(Yo,nJ());Fs(Yo,kJ());Fs(Yo,_J());Fs(Yo,Bc());RJ.exports=Yo});var JP=M((rMe,mO)=>{"use strict";function zpe(r){var e=void 0;typeof r=="string"?e=[r]:e=r.raw;for(var t="",n=0;n<e.length;n++)t+=e[n].replace(/\\\n[ \t]*/g,"").replace(/\\`/g,"`"),n<(arguments.length<=1?0:arguments.length-1)&&(t+=arguments.length<=n+1?void 0:arguments[n+1]);var i=t.split(`
`),o=null;return i.forEach(function(s){var a=s.match(/^(\s+)\S+/);if(a){var l=a[1].length;o?o=Math.min(o,l):o=l}}),o!==null&&(t=i.map(function(s){return s[0]===" "?s.slice(o):s}).join(`
`)),t=t.trim(),t.replace(/\\n/g,`
`)}typeof mO<"u"&&(mO.exports=zpe)});var V6=M((JLe,j6)=>{j6.exports=function(r,e){for(var t=[],n=0;n<r.length;n++){var i=e(r[n],n);nde(i)?t.push.apply(t,i):t.push(i)}return t};var nde=Array.isArray||function(r){return Object.prototype.toString.call(r)==="[object Array]"}});var H6=M(($Le,$6)=>{"use strict";$6.exports=q6;function q6(r,e,t){r instanceof RegExp&&(r=B6(r,t)),e instanceof RegExp&&(e=B6(e,t));var n=J6(r,e,t);return n&&{start:n[0],end:n[1],pre:t.slice(0,n[0]),body:t.slice(n[0]+r.length,n[1]),post:t.slice(n[1]+e.length)}}function B6(r,e){var t=e.match(r);return t?t[0]:null}q6.range=J6;function J6(r,e,t){var n,i,o,s,a,l=t.indexOf(r),c=t.indexOf(e,l+1),u=l;if(l>=0&&c>0){if(r===e)return[l,c];for(n=[],o=t.length;u>=0&&!a;)u==l?(n.push(u),l=t.indexOf(r,u+1)):n.length==1?a=[n.pop(),c]:(i=n.pop(),i<o&&(o=i,s=c),c=t.indexOf(e,u+1)),u=l<c&&l>=0?l:c;n.length&&(a=[o,s])}return a}});var t7=M((HLe,e7)=>{var ide=V6(),G6=H6();e7.exports=ade;var z6="\0SLASH"+Math.random()+"\0",Q6="\0OPEN"+Math.random()+"\0",wO="\0CLOSE"+Math.random()+"\0",Y6="\0COMMA"+Math.random()+"\0",X6="\0PERIOD"+Math.random()+"\0";function EO(r){return parseInt(r,10)==r?parseInt(r,10):r.charCodeAt(0)}function ode(r){return r.split("\\\\").join(z6).split("\\{").join(Q6).split("\\}").join(wO).split("\\,").join(Y6).split("\\.").join(X6)}function sde(r){return r.split(z6).join("\\").split(Q6).join("{").split(wO).join("}").split(Y6).join(",").split(X6).join(".")}function Z6(r){if(!r)return[""];var e=[],t=G6("{","}",r);if(!t)return r.split(",");var n=t.pre,i=t.body,o=t.post,s=n.split(",");s[s.length-1]+="{"+i+"}";var a=Z6(o);return o.length&&(s[s.length-1]+=a.shift(),s.push.apply(s,a)),e.push.apply(e,s),e}function ade(r){return r?(r.substr(0,2)==="{}"&&(r="\\{\\}"+r.substr(2)),pv(ode(r),!0).map(sde)):[]}function lde(r){return"{"+r+"}"}function cde(r){return/^-?0\d/.test(r)}function ude(r,e){return r<=e}function pde(r,e){return r>=e}function pv(r,e){var t=[],n=G6("{","}",r);if(!n||/\$$/.test(n.pre))return[r];var i=/^-?\d+\.\.-?\d+(?:\.\.-?\d+)?$/.test(n.body),o=/^[a-zA-Z]\.\.[a-zA-Z](?:\.\.-?\d+)?$/.test(n.body),s=i||o,a=n.body.indexOf(",")>=0;if(!s&&!a)return n.post.match(/,.*\}/)?(r=n.pre+"{"+n.body+wO+n.post,pv(r)):[r];var l;if(s)l=n.body.split(/\.\./);else if(l=Z6(n.body),l.length===1&&(l=pv(l[0],!1).map(lde),l.length===1)){var u=n.post.length?pv(n.post,!1):[""];return u.map(function(Ge){return n.pre+l[0]+Ge})}var c=n.pre,u=n.post.length?pv(n.post,!1):[""],d;if(s){var f=EO(l[0]),h=EO(l[1]),v=Math.max(l[0].length,l[1].length),S=l.length==3?Math.abs(EO(l[2])):1,b=ude,D=h<f;D&&(S*=-1,b=pde);var _=l.some(cde);d=[];for(var L=f;b(L,h);L+=S){var Z;if(o)Z=String.fromCharCode(L),Z==="\\"&&(Z="");else if(Z=String(L),_){var Se=v-Z.length;if(Se>0){var ie=new Array(Se+1).join("0");L<0?Z="-"+ie+Z.slice(1):Z=ie+Z}}d.push(Z)}}else d=ide(l,function(Me){return pv(Me,!1)});for(var fe=0;fe<d.length;fe++)for(var de=0;de<u.length;de++){var ae=c+d[fe]+u[de];(!e||s||ae)&&t.push(ae)}return t}});var Zx=M((GLe,s7)=>{s7.exports=Zo;Zo.Minimatch=Ci;var Xx=function(){try{return require("path")}catch{}}()||{sep:"/"};Zo.sep=Xx.sep;var DO=Zo.GLOBSTAR=Ci.GLOBSTAR={},dde=t7(),r7={"!":{open:"(?:(?!(?:",close:"))[^/]*?)"},"?":{open:"(?:",close:")?"},"+":{open:"(?:",close:")+"},"*":{open:"(?:",close:")*"},"@":{open:"(?:",close:")"}},kO="[^/]",PO=kO+"*?",mde="(?:(?!(?:\\/|^)(?:\\.{1,2})($|\\/)).)*?",fde="(?:(?!(?:\\/|^)\\.).)*?",n7=hde("().*{}+?[]^$\\!");function hde(r){return r.split("").reduce(function(e,t){return e[t]=!0,e},{})}var i7=/\/+/;Zo.filter=gde;function gde(r,e){return e=e||{},function(t,n,i){return Zo(t,r,e)}}function Up(r,e){e=e||{};var t={};return Object.keys(r).forEach(function(n){t[n]=r[n]}),Object.keys(e).forEach(function(n){t[n]=e[n]}),t}Zo.defaults=function(r){if(!r||typeof r!="object"||!Object.keys(r).length)return Zo;var e=Zo,t=function(i,o,s){return e(i,o,Up(r,s))};return t.Minimatch=function(i,o){return new e.Minimatch(i,Up(r,o))},t.Minimatch.defaults=function(i){return e.defaults(Up(r,i)).Minimatch},t.filter=function(i,o){return e.filter(i,Up(r,o))},t.defaults=function(i){return e.defaults(Up(r,i))},t.makeRe=function(i,o){return e.makeRe(i,Up(r,o))},t.braceExpand=function(i,o){return e.braceExpand(i,Up(r,o))},t.match=function(n,i,o){return e.match(n,i,Up(r,o))},t};Ci.defaults=function(r){return Zo.defaults(r).Minimatch};function Zo(r,e,t){return lD(e),t||(t={}),!t.nocomment&&e.charAt(0)==="#"?!1:new Ci(e,t).match(r)}function Ci(r,e){if(!(this instanceof Ci))return new Ci(r,e);lD(r),e||(e={}),r=r.trim(),!e.allowWindowsEscape&&Xx.sep!=="/"&&(r=r.split(Xx.sep).join("/")),this.options=e,this.set=[],this.pattern=r,this.regexp=null,this.negate=!1,this.comment=!1,this.empty=!1,this.partial=!!e.partial,this.make()}Ci.prototype.debug=function(){};Ci.prototype.make=vde;function vde(){var r=this.pattern,e=this.options;if(!e.nocomment&&r.charAt(0)==="#"){this.comment=!0;return}if(!r){this.empty=!0;return}this.parseNegate();var t=this.globSet=this.braceExpand();e.debug&&(this.debug=function(){console.error.apply(console,arguments)}),this.debug(this.pattern,t),t=this.globParts=t.map(function(n){return n.split(i7)}),this.debug(this.pattern,t),t=t.map(function(n,i,o){return n.map(this.parse,this)},this),this.debug(this.pattern,t),t=t.filter(function(n){return n.indexOf(!1)===-1}),this.debug(this.pattern,t),this.set=t}Ci.prototype.parseNegate=yde;function yde(){var r=this.pattern,e=!1,t=this.options,n=0;if(!t.nonegate){for(var i=0,o=r.length;i<o&&r.charAt(i)==="!";i++)e=!e,n++;n&&(this.pattern=r.substr(n)),this.negate=e}}Zo.braceExpand=function(r,e){return o7(r,e)};Ci.prototype.braceExpand=o7;function o7(r,e){return e||(this instanceof Ci?e=this.options:e={}),r=typeof r>"u"?this.pattern:r,lD(r),e.nobrace||!/\{(?:(?!\{).)*\}/.test(r)?[r]:dde(r)}var bde=1024*64,lD=function(r){if(typeof r!="string")throw new TypeError("invalid pattern");if(r.length>bde)throw new TypeError("pattern is too long")};Ci.prototype.parse=Ide;var aD={};function Ide(r,e){lD(r);var t=this.options;if(r==="**")if(t.noglobstar)r="*";else return DO;if(r==="")return"";var n="",i=!!t.nocase,o=!1,s=[],a=[],l,c=!1,u=-1,d=-1,f=r.charAt(0)==="."?"":t.dot?"(?!(?:^|\\/)\\.{1,2}(?:$|\\/))":"(?!\\.)",h=this;function v(){if(l){switch(l){case"*":n+=PO,i=!0;break;case"?":n+=kO,i=!0;break;default:n+="\\"+l;break}h.debug("clearStateChar %j %j",l,n),l=!1}}for(var S=0,b=r.length,D;S<b&&(D=r.charAt(S));S++){if(this.debug("%s	%s %s %j",r,S,n,D),o&&n7[D]){n+="\\"+D,o=!1;continue}switch(D){case"/":return!1;case"\\":v(),o=!0;continue;case"?":case"*":case"+":case"@":case"!":if(this.debug("%s	%s %s %j <-- stateChar",r,S,n,D),c){this.debug("  in class"),D==="!"&&S===d+1&&(D="^"),n+=D;continue}h.debug("call clearStateChar %j",l),v(),l=D,t.noext&&v();continue;case"(":if(c){n+="(";continue}if(!l){n+="\\(";continue}s.push({type:l,start:S-1,reStart:n.length,open:r7[l].open,close:r7[l].close}),n+=l==="!"?"(?:(?!(?:":"(?:",this.debug("plType %j %j",l,n),l=!1;continue;case")":if(c||!s.length){n+="\\)";continue}v(),i=!0;var _=s.pop();n+=_.close,_.type==="!"&&a.push(_),_.reEnd=n.length;continue;case"|":if(c||!s.length||o){n+="\\|",o=!1;continue}v(),n+="|";continue;case"[":if(v(),c){n+="\\"+D;continue}c=!0,d=S,u=n.length,n+=D;continue;case"]":if(S===d+1||!c){n+="\\"+D,o=!1;continue}var L=r.substring(d+1,S);try{RegExp("["+L+"]")}catch{var Z=this.parse(L,aD);n=n.substr(0,u)+"\\["+Z[0]+"\\]",i=i||Z[1],c=!1;continue}i=!0,c=!1,n+=D;continue;default:v(),o?o=!1:n7[D]&&!(D==="^"&&c)&&(n+="\\"),n+=D}}for(c&&(L=r.substr(d+1),Z=this.parse(L,aD),n=n.substr(0,u)+"\\["+Z[0],i=i||Z[1]),_=s.pop();_;_=s.pop()){var Se=n.slice(_.reStart+_.open.length);this.debug("setting tail",n,_),Se=Se.replace(/((?:\\{2}){0,64})(\\?)\|/g,function(yn,kt,Yr){return Yr||(Yr="\\"),kt+kt+Yr+"|"}),this.debug(`tail=%j
   %s`,Se,Se,_,n);var ie=_.type==="*"?PO:_.type==="?"?kO:"\\"+_.type;i=!0,n=n.slice(0,_.reStart)+ie+"\\("+Se}v(),o&&(n+="\\\\");var fe=!1;switch(n.charAt(0)){case"[":case".":case"(":fe=!0}for(var de=a.length-1;de>-1;de--){var ae=a[de],Me=n.slice(0,ae.reStart),Ge=n.slice(ae.reStart,ae.reEnd-8),St=n.slice(ae.reEnd-8,ae.reEnd),vt=n.slice(ae.reEnd);St+=vt;var ot=Me.split("(").length-1,oe=vt;for(S=0;S<ot;S++)oe=oe.replace(/\)[+*?]?/,"");vt=oe;var Pe="";vt===""&&e!==aD&&(Pe="$");var Y=Me+Ge+vt+Pe+St;n=Y}if(n!==""&&i&&(n="(?=.)"+n),fe&&(n=f+n),e===aD)return[n,i];if(!i)return xde(r);var be=t.nocase?"i":"";try{var Je=new RegExp("^"+n+"$",be)}catch{return new RegExp("$.")}return Je._glob=r,Je._src=n,Je}Zo.makeRe=function(r,e){return new Ci(r,e||{}).makeRe()};Ci.prototype.makeRe=Sde;function Sde(){if(this.regexp||this.regexp===!1)return this.regexp;var r=this.set;if(!r.length)return this.regexp=!1,this.regexp;var e=this.options,t=e.noglobstar?PO:e.dot?mde:fde,n=e.nocase?"i":"",i=r.map(function(o){return o.map(function(s){return s===DO?t:typeof s=="string"?Cde(s):s._src}).join("\\/")}).join("|");i="^(?:"+i+")$",this.negate&&(i="^(?!"+i+").*$");try{this.regexp=new RegExp(i,n)}catch{this.regexp=!1}return this.regexp}Zo.match=function(r,e,t){t=t||{};var n=new Ci(e,t);return r=r.filter(function(i){return n.match(i)}),n.options.nonull&&!r.length&&r.push(e),r};Ci.prototype.match=function(e,t){if(typeof t>"u"&&(t=this.partial),this.debug("match",e,this.pattern),this.comment)return!1;if(this.empty)return e==="";if(e==="/"&&t)return!0;var n=this.options;Xx.sep!=="/"&&(e=e.split(Xx.sep).join("/")),e=e.split(i7),this.debug(this.pattern,"split",e);var i=this.set;this.debug(this.pattern,"set",i);var o,s;for(s=e.length-1;s>=0&&(o=e[s],!o);s--);for(s=0;s<i.length;s++){var a=i[s],l=e;n.matchBase&&a.length===1&&(l=[o]);var c=this.matchOne(l,a,t);if(c)return n.flipNegate?!0:!this.negate}return n.flipNegate?!1:this.negate};Ci.prototype.matchOne=function(r,e,t){var n=this.options;this.debug("matchOne",{this:this,file:r,pattern:e}),this.debug("matchOne",r.length,e.length);for(var i=0,o=0,s=r.length,a=e.length;i<s&&o<a;i++,o++){this.debug("matchOne loop");var l=e[o],c=r[i];if(this.debug(e,l,c),l===!1)return!1;if(l===DO){this.debug("GLOBSTAR",[e,l,c]);var u=i,d=o+1;if(d===a){for(this.debug("** at the end");i<s;i++)if(r[i]==="."||r[i]===".."||!n.dot&&r[i].charAt(0)===".")return!1;return!0}for(;u<s;){var f=r[u];if(this.debug(`
globstar while`,r,u,e,d,f),this.matchOne(r.slice(u),e.slice(d),t))return this.debug("globstar found match!",u,s,f),!0;if(f==="."||f===".."||!n.dot&&f.charAt(0)==="."){this.debug("dot detected!",r,u,e,d);break}this.debug("globstar swallow a segment, and continue"),u++}return!!(t&&(this.debug(`
>>> no match, partial?`,r,u,e,d),u===s))}var h;if(typeof l=="string"?(h=c===l,this.debug("string match",l,c,h)):(h=c.match(l),this.debug("pattern match",l,c,h)),!h)return!1}if(i===s&&o===a)return!0;if(i===s)return t;if(o===a)return i===s-1&&r[i]==="";throw new Error("wtf?")};function xde(r){return r.replace(/\\(.)/g,"$1")}function Cde(r){return r.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&")}});var f7=M(AO=>{var Mm=require("path"),Vp=process.platform==="win32",jp=require("fs"),Pde=process.env.NODE_DEBUG&&/fs/.test(process.env.NODE_DEBUG);function Dde(){var r;if(Pde){var e=new Error;r=t}else r=n;return r;function t(i){i&&(e.message=i.message,i=e,n(i))}function n(i){if(i){if(process.throwDeprecation)throw i;if(!process.noDeprecation){var o="fs: missing callback "+(i.stack||i.message);process.traceDeprecation?console.trace(o):console.error(o)}}}}function Tde(r){return typeof r=="function"?r:Dde()}var fje=Mm.normalize;Vp?Yc=/(.*?)(?:[\/\\]+|$)/g:Yc=/(.*?)(?:[\/]+|$)/g;var Yc;Vp?oC=/^(?:[a-zA-Z]:|[\\\/]{2}[^\\\/]+[\\\/][^\\\/]+)?[\\\/]*/:oC=/^[\/]*/;var oC;AO.realpathSync=function(e,t){if(e=Mm.resolve(e),t&&Object.prototype.hasOwnProperty.call(t,e))return t[e];var n=e,i={},o={},s,a,l,c;u();function u(){var b=oC.exec(e);s=b[0].length,a=b[0],l=b[0],c="",Vp&&!o[l]&&(jp.lstatSync(l),o[l]=!0)}for(;s<e.length;){Yc.lastIndex=s;var d=Yc.exec(e);if(c=a,a+=d[0],l=c+d[1],s=Yc.lastIndex,!(o[l]||t&&t[l]===l)){var f;if(t&&Object.prototype.hasOwnProperty.call(t,l))f=t[l];else{var h=jp.lstatSync(l);if(!h.isSymbolicLink()){o[l]=!0,t&&(t[l]=l);continue}var v=null;if(!Vp){var S=h.dev.toString(32)+":"+h.ino.toString(32);i.hasOwnProperty(S)&&(v=i[S])}v===null&&(jp.statSync(l),v=jp.readlinkSync(l)),f=Mm.resolve(c,v),t&&(t[l]=f),Vp||(i[S]=v)}e=Mm.resolve(f,e.slice(s)),u()}}return t&&(t[n]=e),e};AO.realpath=function(e,t,n){if(typeof n!="function"&&(n=Tde(t),t=null),e=Mm.resolve(e),t&&Object.prototype.hasOwnProperty.call(t,e))return process.nextTick(n.bind(null,null,t[e]));var i=e,o={},s={},a,l,c,u;d();function d(){var b=oC.exec(e);a=b[0].length,l=b[0],c=b[0],u="",Vp&&!s[c]?jp.lstat(c,function(D){if(D)return n(D);s[c]=!0,f()}):process.nextTick(f)}function f(){if(a>=e.length)return t&&(t[i]=e),n(null,e);Yc.lastIndex=a;var b=Yc.exec(e);return u=l,l+=b[0],c=u+b[1],a=Yc.lastIndex,s[c]||t&&t[c]===c?process.nextTick(f):t&&Object.prototype.hasOwnProperty.call(t,c)?S(t[c]):jp.lstat(c,h)}function h(b,D){if(b)return n(b);if(!D.isSymbolicLink())return s[c]=!0,t&&(t[c]=c),process.nextTick(f);if(!Vp){var _=D.dev.toString(32)+":"+D.ino.toString(32);if(o.hasOwnProperty(_))return v(null,o[_],c)}jp.stat(c,function(L){if(L)return n(L);jp.readlink(c,function(Z,Se){Vp||(o[_]=Se),v(Z,Se)})})}function v(b,D,_){if(b)return n(b);var L=Mm.resolve(u,D);t&&(t[_]=L),S(L)}function S(b){e=Mm.resolve(b,e.slice(a)),d()}}});var FO=M((gje,y7)=>{y7.exports=Bp;Bp.realpath=Bp;Bp.sync=KO;Bp.realpathSync=KO;Bp.monkeypatch=Rde;Bp.unmonkeypatch=Nde;var Sv=require("fs"),MO=Sv.realpath,OO=Sv.realpathSync,_de=process.version,h7=/^v[0-5]\./.test(_de),g7=f7();function v7(r){return r&&r.syscall==="realpath"&&(r.code==="ELOOP"||r.code==="ENOMEM"||r.code==="ENAMETOOLONG")}function Bp(r,e,t){if(h7)return MO(r,e,t);typeof e=="function"&&(t=e,e=null),MO(r,e,function(n,i){v7(n)?g7.realpath(r,e,t):t(n,i)})}function KO(r,e){if(h7)return OO(r,e);try{return OO(r,e)}catch(t){if(v7(t))return g7.realpathSync(r,e);throw t}}function Rde(){Sv.realpath=Bp,Sv.realpathSync=KO}function Nde(){Sv.realpath=MO,Sv.realpathSync=OO}});var b7=M((vje,LO)=>{typeof Object.create=="function"?LO.exports=function(e,t){t&&(e.super_=t,e.prototype=Object.create(t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}))}:LO.exports=function(e,t){if(t){e.super_=t;var n=function(){};n.prototype=t.prototype,e.prototype=new n,e.prototype.constructor=e}}});var I7=M((yje,WO)=>{try{if(UO=require("util"),typeof UO.inherits!="function")throw"";WO.exports=UO.inherits}catch{WO.exports=b7()}var UO});var gD=M((bje,hD)=>{"use strict";function S7(r){return r.charAt(0)==="/"}function x7(r){var e=/^([a-zA-Z]:|[\\\/]{2}[^\\\/]+[\\\/]+[^\\\/]+)?([\\\/])?([\s\S]*?)$/,t=e.exec(r),n=t[1]||"",i=!!(n&&n.charAt(1)!==":");return!!(t[2]||i)}hD.exports=process.platform==="win32"?x7:S7;hD.exports.posix=S7;hD.exports.win32=x7});var VO=M(qp=>{qp.setopts=Lde;qp.ownProp=C7;qp.makeAbs=sC;qp.finish=Ude;qp.mark=Wde;qp.isIgnored=w7;qp.childrenIgnored=jde;function C7(r,e){return Object.prototype.hasOwnProperty.call(r,e)}var Ade=require("fs"),xv=require("path"),Mde=Zx(),E7=gD(),jO=Mde.Minimatch;function Ode(r,e){return r.localeCompare(e,"en")}function Kde(r,e){r.ignore=e.ignore||[],Array.isArray(r.ignore)||(r.ignore=[r.ignore]),r.ignore.length&&(r.ignore=r.ignore.map(Fde))}function Fde(r){var e=null;if(r.slice(-3)==="/**"){var t=r.replace(/(\/\*\*)+$/,"");e=new jO(t,{dot:!0})}return{matcher:new jO(r,{dot:!0}),gmatcher:e}}function Lde(r,e,t){if(t||(t={}),t.matchBase&&e.indexOf("/")===-1){if(t.noglobstar)throw new Error("base matching requires globstar");e="**/"+e}r.silent=!!t.silent,r.pattern=e,r.strict=t.strict!==!1,r.realpath=!!t.realpath,r.realpathCache=t.realpathCache||Object.create(null),r.follow=!!t.follow,r.dot=!!t.dot,r.mark=!!t.mark,r.nodir=!!t.nodir,r.nodir&&(r.mark=!0),r.sync=!!t.sync,r.nounique=!!t.nounique,r.nonull=!!t.nonull,r.nosort=!!t.nosort,r.nocase=!!t.nocase,r.stat=!!t.stat,r.noprocess=!!t.noprocess,r.absolute=!!t.absolute,r.fs=t.fs||Ade,r.maxLength=t.maxLength||1/0,r.cache=t.cache||Object.create(null),r.statCache=t.statCache||Object.create(null),r.symlinks=t.symlinks||Object.create(null),Kde(r,t),r.changedCwd=!1;var n=process.cwd();C7(t,"cwd")?(r.cwd=xv.resolve(t.cwd),r.changedCwd=r.cwd!==n):r.cwd=n,r.root=t.root||xv.resolve(r.cwd,"/"),r.root=xv.resolve(r.root),process.platform==="win32"&&(r.root=r.root.replace(/\\/g,"/")),r.cwdAbs=E7(r.cwd)?r.cwd:sC(r,r.cwd),process.platform==="win32"&&(r.cwdAbs=r.cwdAbs.replace(/\\/g,"/")),r.nomount=!!t.nomount,t.nonegate=!0,t.nocomment=!0,r.minimatch=new jO(e,t),r.options=r.minimatch.options}function Ude(r){for(var e=r.nounique,t=e?[]:Object.create(null),n=0,i=r.matches.length;n<i;n++){var o=r.matches[n];if(!o||Object.keys(o).length===0){if(r.nonull){var s=r.minimatch.globSet[n];e?t.push(s):t[s]=!0}}else{var a=Object.keys(o);e?t.push.apply(t,a):a.forEach(function(l){t[l]=!0})}}if(e||(t=Object.keys(t)),r.nosort||(t=t.sort(Ode)),r.mark){for(var n=0;n<t.length;n++)t[n]=r._mark(t[n]);r.nodir&&(t=t.filter(function(l){var c=!/\/$/.test(l),u=r.cache[l]||r.cache[sC(r,l)];return c&&u&&(c=u!=="DIR"&&!Array.isArray(u)),c}))}r.ignore.length&&(t=t.filter(function(l){return!w7(r,l)})),r.found=t}function Wde(r,e){var t=sC(r,e),n=r.cache[t],i=e;if(n){var o=n==="DIR"||Array.isArray(n),s=e.slice(-1)==="/";if(o&&!s?i+="/":!o&&s&&(i=i.slice(0,-1)),i!==e){var a=sC(r,i);r.statCache[a]=r.statCache[t],r.cache[a]=r.cache[t]}}return i}function sC(r,e){var t=e;return e.charAt(0)==="/"?t=xv.join(r.root,e):E7(e)||e===""?t=e:r.changedCwd?t=xv.resolve(r.cwd,e):t=xv.resolve(e),process.platform==="win32"&&(t=t.replace(/\\/g,"/")),t}function w7(r,e){return r.ignore.length?r.ignore.some(function(t){return t.matcher.match(e)||!!(t.gmatcher&&t.gmatcher.match(e))}):!1}function jde(r,e){return r.ignore.length?r.ignore.some(function(t){return!!(t.gmatcher&&t.gmatcher.match(e))}):!1}});var _7=M((Eje,T7)=>{T7.exports=D7;D7.GlobSync=$n;var Vde=FO(),k7=Zx(),Sje=k7.Minimatch,xje=JO().Glob,Cje=require("util"),BO=require("path"),P7=require("assert"),vD=gD(),Om=VO(),Bde=Om.setopts,qO=Om.ownProp,qde=Om.childrenIgnored,Jde=Om.isIgnored;function D7(r,e){if(typeof e=="function"||arguments.length===3)throw new TypeError(`callback provided to sync glob
See: https://github.com/isaacs/node-glob/issues/167`);return new $n(r,e).found}function $n(r,e){if(!r)throw new Error("must provide pattern");if(typeof e=="function"||arguments.length===3)throw new TypeError(`callback provided to sync glob
See: https://github.com/isaacs/node-glob/issues/167`);if(!(this instanceof $n))return new $n(r,e);if(Bde(this,r,e),this.noprocess)return this;var t=this.minimatch.set.length;this.matches=new Array(t);for(var n=0;n<t;n++)this._process(this.minimatch.set[n],n,!1);this._finish()}$n.prototype._finish=function(){if(P7(this instanceof $n),this.realpath){var r=this;this.matches.forEach(function(e,t){var n=r.matches[t]=Object.create(null);for(var i in e)try{i=r._makeAbs(i);var o=Vde.realpathSync(i,r.realpathCache);n[o]=!0}catch(s){if(s.syscall==="stat")n[r._makeAbs(i)]=!0;else throw s}})}Om.finish(this)};$n.prototype._process=function(r,e,t){P7(this instanceof $n);for(var n=0;typeof r[n]=="string";)n++;var i;switch(n){case r.length:this._processSimple(r.join("/"),e);return;case 0:i=null;break;default:i=r.slice(0,n).join("/");break}var o=r.slice(n),s;i===null?s=".":((vD(i)||vD(r.join("/")))&&(!i||!vD(i))&&(i="/"+i),s=i);var a=this._makeAbs(s);if(!qde(this,s)){var l=o[0]===k7.GLOBSTAR;l?this._processGlobStar(i,s,a,o,e,t):this._processReaddir(i,s,a,o,e,t)}};$n.prototype._processReaddir=function(r,e,t,n,i,o){var s=this._readdir(t,o);if(s){for(var a=n[0],l=!!this.minimatch.negate,c=a._glob,u=this.dot||c.charAt(0)===".",d=[],f=0;f<s.length;f++){var h=s[f];if(h.charAt(0)!=="."||u){var v;l&&!r?v=!h.match(a):v=h.match(a),v&&d.push(h)}}var S=d.length;if(S!==0){if(n.length===1&&!this.mark&&!this.stat){this.matches[i]||(this.matches[i]=Object.create(null));for(var f=0;f<S;f++){var h=d[f];r&&(r.slice(-1)!=="/"?h=r+"/"+h:h=r+h),h.charAt(0)==="/"&&!this.nomount&&(h=BO.join(this.root,h)),this._emitMatch(i,h)}return}n.shift();for(var f=0;f<S;f++){var h=d[f],b;r?b=[r,h]:b=[h],this._process(b.concat(n),i,o)}}}};$n.prototype._emitMatch=function(r,e){if(!Jde(this,e)){var t=this._makeAbs(e);if(this.mark&&(e=this._mark(e)),this.absolute&&(e=t),!this.matches[r][e]){if(this.nodir){var n=this.cache[t];if(n==="DIR"||Array.isArray(n))return}this.matches[r][e]=!0,this.stat&&this._stat(e)}}};$n.prototype._readdirInGlobStar=function(r){if(this.follow)return this._readdir(r,!1);var e,t,n;try{t=this.fs.lstatSync(r)}catch(o){if(o.code==="ENOENT")return null}var i=t&&t.isSymbolicLink();return this.symlinks[r]=i,!i&&t&&!t.isDirectory()?this.cache[r]="FILE":e=this._readdir(r,!1),e};$n.prototype._readdir=function(r,e){var t;if(e&&!qO(this.symlinks,r))return this._readdirInGlobStar(r);if(qO(this.cache,r)){var n=this.cache[r];if(!n||n==="FILE")return null;if(Array.isArray(n))return n}try{return this._readdirEntries(r,this.fs.readdirSync(r))}catch(i){return this._readdirError(r,i),null}};$n.prototype._readdirEntries=function(r,e){if(!this.mark&&!this.stat)for(var t=0;t<e.length;t++){var n=e[t];r==="/"?n=r+n:n=r+"/"+n,this.cache[n]=!0}return this.cache[r]=e,e};$n.prototype._readdirError=function(r,e){switch(e.code){case"ENOTSUP":case"ENOTDIR":var t=this._makeAbs(r);if(this.cache[t]="FILE",t===this.cwdAbs){var n=new Error(e.code+" invalid cwd "+this.cwd);throw n.path=this.cwd,n.code=e.code,n}break;case"ENOENT":case"ELOOP":case"ENAMETOOLONG":case"UNKNOWN":this.cache[this._makeAbs(r)]=!1;break;default:if(this.cache[this._makeAbs(r)]=!1,this.strict)throw e;this.silent||console.error("glob error",e);break}};$n.prototype._processGlobStar=function(r,e,t,n,i,o){var s=this._readdir(t,o);if(s){var a=n.slice(1),l=r?[r]:[],c=l.concat(a);this._process(c,i,!1);var u=s.length,d=this.symlinks[t];if(!(d&&o))for(var f=0;f<u;f++){var h=s[f];if(!(h.charAt(0)==="."&&!this.dot)){var v=l.concat(s[f],a);this._process(v,i,!0);var S=l.concat(s[f],n);this._process(S,i,!0)}}}};$n.prototype._processSimple=function(r,e){var t=this._stat(r);if(this.matches[e]||(this.matches[e]=Object.create(null)),!!t){if(r&&vD(r)&&!this.nomount){var n=/[\/\\]$/.test(r);r.charAt(0)==="/"?r=BO.join(this.root,r):(r=BO.resolve(this.root,r),n&&(r+="/"))}process.platform==="win32"&&(r=r.replace(/\\/g,"/")),this._emitMatch(e,r)}};$n.prototype._stat=function(r){var e=this._makeAbs(r),t=r.slice(-1)==="/";if(r.length>this.maxLength)return!1;if(!this.stat&&qO(this.cache,e)){var s=this.cache[e];if(Array.isArray(s)&&(s="DIR"),!t||s==="DIR")return s;if(t&&s==="FILE")return!1}var n,i=this.statCache[e];if(!i){var o;try{o=this.fs.lstatSync(e)}catch(a){if(a&&(a.code==="ENOENT"||a.code==="ENOTDIR"))return this.statCache[e]=!1,!1}if(o&&o.isSymbolicLink())try{i=this.fs.statSync(e)}catch{i=o}else i=o}this.statCache[e]=i;var s=!0;return i&&(s=i.isDirectory()?"DIR":"FILE"),this.cache[e]=this.cache[e]||s,t&&s==="FILE"?!1:s};$n.prototype._mark=function(r){return Om.mark(this,r)};$n.prototype._makeAbs=function(r){return Om.makeAbs(this,r)}});var $O=M((wje,N7)=>{N7.exports=R7;function R7(r,e){if(r&&e)return R7(r)(e);if(typeof r!="function")throw new TypeError("need wrapper function");return Object.keys(r).forEach(function(n){t[n]=r[n]}),t;function t(){for(var n=new Array(arguments.length),i=0;i<n.length;i++)n[i]=arguments[i];var o=r.apply(this,n),s=n[n.length-1];return typeof o=="function"&&o!==s&&Object.keys(s).forEach(function(a){o[a]=s[a]}),o}}});var GO=M((kje,HO)=>{var A7=$O();HO.exports=A7(yD);HO.exports.strict=A7(M7);yD.proto=yD(function(){Object.defineProperty(Function.prototype,"once",{value:function(){return yD(this)},configurable:!0}),Object.defineProperty(Function.prototype,"onceStrict",{value:function(){return M7(this)},configurable:!0})});function yD(r){var e=function(){return e.called?e.value:(e.called=!0,e.value=r.apply(this,arguments))};return e.called=!1,e}function M7(r){var e=function(){if(e.called)throw new Error(e.onceError);return e.called=!0,e.value=r.apply(this,arguments)},t=r.name||"Function wrapped with `once`";return e.onceError=t+" shouldn't be called more than once",e.called=!1,e}});var K7=M((Pje,O7)=>{var $de=$O(),aC=Object.create(null),Hde=GO();O7.exports=$de(Gde);function Gde(r,e){return aC[r]?(aC[r].push(e),null):(aC[r]=[e],zde(r))}function zde(r){return Hde(function e(){var t=aC[r],n=t.length,i=Qde(arguments);try{for(var o=0;o<n;o++)t[o].apply(null,i)}finally{t.length>n?(t.splice(0,n),process.nextTick(function(){e.apply(null,i)})):delete aC[r]}})}function Qde(r){for(var e=r.length,t=[],n=0;n<e;n++)t[n]=r[n];return t}});var JO=M((_je,L7)=>{L7.exports=Km;var Yde=FO(),F7=Zx(),Dje=F7.Minimatch,Xde=I7(),Zde=require("events").EventEmitter,zO=require("path"),QO=require("assert"),lC=gD(),XO=_7(),Fm=VO(),eme=Fm.setopts,YO=Fm.ownProp,ZO=K7(),Tje=require("util"),tme=Fm.childrenIgnored,rme=Fm.isIgnored,nme=GO();function Km(r,e,t){if(typeof e=="function"&&(t=e,e={}),e||(e={}),e.sync){if(t)throw new TypeError("callback provided to sync glob");return XO(r,e)}return new xr(r,e,t)}Km.sync=XO;var ime=Km.GlobSync=XO.GlobSync;Km.glob=Km;function ome(r,e){if(e===null||typeof e!="object")return r;for(var t=Object.keys(e),n=t.length;n--;)r[t[n]]=e[t[n]];return r}Km.hasMagic=function(r,e){var t=ome({},e);t.noprocess=!0;var n=new xr(r,t),i=n.minimatch.set;if(!r)return!1;if(i.length>1)return!0;for(var o=0;o<i[0].length;o++)if(typeof i[0][o]!="string")return!0;return!1};Km.Glob=xr;Xde(xr,Zde);function xr(r,e,t){if(typeof e=="function"&&(t=e,e=null),e&&e.sync){if(t)throw new TypeError("callback provided to sync glob");return new ime(r,e)}if(!(this instanceof xr))return new xr(r,e,t);eme(this,r,e),this._didRealPath=!1;var n=this.minimatch.set.length;this.matches=new Array(n),typeof t=="function"&&(t=nme(t),this.on("error",t),this.on("end",function(l){t(null,l)}));var i=this;if(this._processing=0,this._emitQueue=[],this._processQueue=[],this.paused=!1,this.noprocess)return this;if(n===0)return a();for(var o=!0,s=0;s<n;s++)this._process(this.minimatch.set[s],s,!1,a);o=!1;function a(){--i._processing,i._processing<=0&&(o?process.nextTick(function(){i._finish()}):i._finish())}}xr.prototype._finish=function(){if(QO(this instanceof xr),!this.aborted){if(this.realpath&&!this._didRealpath)return this._realpath();Fm.finish(this),this.emit("end",this.found)}};xr.prototype._realpath=function(){if(this._didRealpath)return;this._didRealpath=!0;var r=this.matches.length;if(r===0)return this._finish();for(var e=this,t=0;t<this.matches.length;t++)this._realpathSet(t,n);function n(){--r===0&&e._finish()}};xr.prototype._realpathSet=function(r,e){var t=this.matches[r];if(!t)return e();var n=Object.keys(t),i=this,o=n.length;if(o===0)return e();var s=this.matches[r]=Object.create(null);n.forEach(function(a,l){a=i._makeAbs(a),Yde.realpath(a,i.realpathCache,function(c,u){c?c.syscall==="stat"?s[a]=!0:i.emit("error",c):s[u]=!0,--o===0&&(i.matches[r]=s,e())})})};xr.prototype._mark=function(r){return Fm.mark(this,r)};xr.prototype._makeAbs=function(r){return Fm.makeAbs(this,r)};xr.prototype.abort=function(){this.aborted=!0,this.emit("abort")};xr.prototype.pause=function(){this.paused||(this.paused=!0,this.emit("pause"))};xr.prototype.resume=function(){if(this.paused){if(this.emit("resume"),this.paused=!1,this._emitQueue.length){var r=this._emitQueue.slice(0);this._emitQueue.length=0;for(var e=0;e<r.length;e++){var t=r[e];this._emitMatch(t[0],t[1])}}if(this._processQueue.length){var n=this._processQueue.slice(0);this._processQueue.length=0;for(var e=0;e<n.length;e++){var i=n[e];this._processing--,this._process(i[0],i[1],i[2],i[3])}}}};xr.prototype._process=function(r,e,t,n){if(QO(this instanceof xr),QO(typeof n=="function"),!this.aborted){if(this._processing++,this.paused){this._processQueue.push([r,e,t,n]);return}for(var i=0;typeof r[i]=="string";)i++;var o;switch(i){case r.length:this._processSimple(r.join("/"),e,n);return;case 0:o=null;break;default:o=r.slice(0,i).join("/");break}var s=r.slice(i),a;o===null?a=".":((lC(o)||lC(r.join("/")))&&(!o||!lC(o))&&(o="/"+o),a=o);var l=this._makeAbs(a);if(tme(this,a))return n();var c=s[0]===F7.GLOBSTAR;c?this._processGlobStar(o,a,l,s,e,t,n):this._processReaddir(o,a,l,s,e,t,n)}};xr.prototype._processReaddir=function(r,e,t,n,i,o,s){var a=this;this._readdir(t,o,function(l,c){return a._processReaddir2(r,e,t,n,i,o,c,s)})};xr.prototype._processReaddir2=function(r,e,t,n,i,o,s,a){if(!s)return a();for(var l=n[0],c=!!this.minimatch.negate,u=l._glob,d=this.dot||u.charAt(0)===".",f=[],h=0;h<s.length;h++){var v=s[h];if(v.charAt(0)!=="."||d){var S;c&&!r?S=!v.match(l):S=v.match(l),S&&f.push(v)}}var b=f.length;if(b===0)return a();if(n.length===1&&!this.mark&&!this.stat){this.matches[i]||(this.matches[i]=Object.create(null));for(var h=0;h<b;h++){var v=f[h];r&&(r!=="/"?v=r+"/"+v:v=r+v),v.charAt(0)==="/"&&!this.nomount&&(v=zO.join(this.root,v)),this._emitMatch(i,v)}return a()}n.shift();for(var h=0;h<b;h++){var v=f[h],D;r&&(r!=="/"?v=r+"/"+v:v=r+v),this._process([v].concat(n),i,o,a)}a()};xr.prototype._emitMatch=function(r,e){if(!this.aborted&&!rme(this,e)){if(this.paused){this._emitQueue.push([r,e]);return}var t=lC(e)?e:this._makeAbs(e);if(this.mark&&(e=this._mark(e)),this.absolute&&(e=t),!this.matches[r][e]){if(this.nodir){var n=this.cache[t];if(n==="DIR"||Array.isArray(n))return}this.matches[r][e]=!0;var i=this.statCache[t];i&&this.emit("stat",e,i),this.emit("match",e)}}};xr.prototype._readdirInGlobStar=function(r,e){if(this.aborted)return;if(this.follow)return this._readdir(r,!1,e);var t="lstat\0"+r,n=this,i=ZO(t,o);i&&n.fs.lstat(r,i);function o(s,a){if(s&&s.code==="ENOENT")return e();var l=a&&a.isSymbolicLink();n.symlinks[r]=l,!l&&a&&!a.isDirectory()?(n.cache[r]="FILE",e()):n._readdir(r,!1,e)}};xr.prototype._readdir=function(r,e,t){if(!this.aborted&&(t=ZO("readdir\0"+r+"\0"+e,t),!!t)){if(e&&!YO(this.symlinks,r))return this._readdirInGlobStar(r,t);if(YO(this.cache,r)){var n=this.cache[r];if(!n||n==="FILE")return t();if(Array.isArray(n))return t(null,n)}var i=this;i.fs.readdir(r,sme(this,r,t))}};function sme(r,e,t){return function(n,i){n?r._readdirError(e,n,t):r._readdirEntries(e,i,t)}}xr.prototype._readdirEntries=function(r,e,t){if(!this.aborted){if(!this.mark&&!this.stat)for(var n=0;n<e.length;n++){var i=e[n];r==="/"?i=r+i:i=r+"/"+i,this.cache[i]=!0}return this.cache[r]=e,t(null,e)}};xr.prototype._readdirError=function(r,e,t){if(!this.aborted){switch(e.code){case"ENOTSUP":case"ENOTDIR":var n=this._makeAbs(r);if(this.cache[n]="FILE",n===this.cwdAbs){var i=new Error(e.code+" invalid cwd "+this.cwd);i.path=this.cwd,i.code=e.code,this.emit("error",i),this.abort()}break;case"ENOENT":case"ELOOP":case"ENAMETOOLONG":case"UNKNOWN":this.cache[this._makeAbs(r)]=!1;break;default:this.cache[this._makeAbs(r)]=!1,this.strict&&(this.emit("error",e),this.abort()),this.silent||console.error("glob error",e);break}return t()}};xr.prototype._processGlobStar=function(r,e,t,n,i,o,s){var a=this;this._readdir(t,o,function(l,c){a._processGlobStar2(r,e,t,n,i,o,c,s)})};xr.prototype._processGlobStar2=function(r,e,t,n,i,o,s,a){if(!s)return a();var l=n.slice(1),c=r?[r]:[],u=c.concat(l);this._process(u,i,!1,a);var d=this.symlinks[t],f=s.length;if(d&&o)return a();for(var h=0;h<f;h++){var v=s[h];if(!(v.charAt(0)==="."&&!this.dot)){var S=c.concat(s[h],l);this._process(S,i,!0,a);var b=c.concat(s[h],n);this._process(b,i,!0,a)}}a()};xr.prototype._processSimple=function(r,e,t){var n=this;this._stat(r,function(i,o){n._processSimple2(r,e,i,o,t)})};xr.prototype._processSimple2=function(r,e,t,n,i){if(this.matches[e]||(this.matches[e]=Object.create(null)),!n)return i();if(r&&lC(r)&&!this.nomount){var o=/[\/\\]$/.test(r);r.charAt(0)==="/"?r=zO.join(this.root,r):(r=zO.resolve(this.root,r),o&&(r+="/"))}process.platform==="win32"&&(r=r.replace(/\\/g,"/")),this._emitMatch(e,r),i()};xr.prototype._stat=function(r,e){var t=this._makeAbs(r),n=r.slice(-1)==="/";if(r.length>this.maxLength)return e();if(!this.stat&&YO(this.cache,t)){var i=this.cache[t];if(Array.isArray(i)&&(i="DIR"),!n||i==="DIR")return e(null,i);if(n&&i==="FILE")return e()}var o,s=this.statCache[t];if(s!==void 0){if(s===!1)return e(null,s);var a=s.isDirectory()?"DIR":"FILE";return n&&a==="FILE"?e():e(null,a,s)}var l=this,c=ZO("stat\0"+t,u);c&&l.fs.lstat(t,c);function u(d,f){if(f&&f.isSymbolicLink())return l.fs.stat(t,function(h,v){h?l._stat2(r,t,null,f,e):l._stat2(r,t,h,v,e)});l._stat2(r,t,d,f,e)}};xr.prototype._stat2=function(r,e,t,n,i){if(t&&(t.code==="ENOENT"||t.code==="ENOTDIR"))return this.statCache[e]=!1,i();var o=r.slice(-1)==="/";if(this.statCache[e]=n,e.slice(-1)==="/"&&n&&!n.isDirectory())return i(null,!1,n);var s=!0;return n&&(s=n.isDirectory()?"DIR":"FILE"),this.cache[e]=this.cache[e]||s,o&&s==="FILE"?i():i(null,s,n)}});var j7=M((Rje,W7)=>{"use strict";var U7=process.platform==="win32",ame=U7?/[^:]\\$/:/.\/$/;W7.exports=function(){var r;return U7?r=process.env.TEMP||process.env.TMP||(process.env.SystemRoot||process.env.windir)+"\\temp":r=process.env.TMPDIR||process.env.TMP||process.env.TEMP||"/tmp",ame.test(r)&&(r=r.slice(0,-1)),r}});var t8=M((Nje,Xc)=>{var Ro=require("fs"),eK=require("path"),V7=require("crypto"),lme=j7(),cC=require("constants"),tK=lme(),B7="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz",rK=/XXXXXX/,J7=3,$7=cC.O_CREAT|cC.O_EXCL|cC.O_RDWR,H7=448,G7=384,Cv=[],z7=!1,nK=!1;function q7(r){var e=[],t=null;try{t=V7.randomBytes(r)}catch{t=V7.pseudoRandomBytes(r)}for(var n=0;n<r;n++)e.push(B7[t[n]%B7.length]);return e.join("")}function cme(r){return typeof r>"u"}function Ev(r,e){if(typeof r=="function"){var t=r;r=e||{},e=t}else typeof r>"u"&&(r={});return[r,e]}function Q7(r){if(r.name)return eK.join(r.dir||tK,r.name);if(r.template)return r.template.replace(rK,q7(6));var e=[r.prefix||"tmp-",process.pid,q7(12),r.postfix||""].join("");return eK.join(r.dir||tK,e)}function iK(r,e){var t=Ev(r,e),n=t[0],i=t[1],o=n.tries||J7;if(isNaN(o)||o<0)return i(new Error("Invalid tries"));if(n.template&&!n.template.match(rK))return i(new Error("Invalid template provided"));(function s(){var a=Q7(n);Ro.stat(a,function(l){if(!l)return o-- >0?s():i(new Error("Could not get a unique tmp filename, max tries reached "+a));i(null,a)})})()}function oK(r){var e=Ev(r),t=e[0],n=t.tries||J7;if(isNaN(n)||n<0)throw new Error("Invalid tries");if(t.template&&!t.template.match(rK))throw new Error("Invalid template provided");do{var i=Q7(t);try{Ro.statSync(i)}catch{return i}}while(n-- >0);throw new Error("Could not get a unique tmp filename, max tries reached")}function ume(r,e){var t=Ev(r,e),n=t[0],i=t[1];n.postfix=cme(n.postfix)?".tmp":n.postfix,iK(n,function(s,a){if(s)return i(s);Ro.open(a,$7,n.mode||G7,function(c,u){if(c)return i(c);i(null,a,u,Y7(a,u,n))})})}function pme(r){var e=Ev(r),t=e[0];t.postfix=t.postfix||".tmp";var n=oK(t),i=Ro.openSync(n,$7,t.mode||G7);return{name:n,fd:i,removeCallback:Y7(n,i,t)}}function dme(r){var e=[r];do{for(var t=e.pop(),n=!1,i=Ro.readdirSync(t),o=0,s=i.length;o<s;o++){var a=eK.join(t,i[o]),l=Ro.lstatSync(a);l.isDirectory()?(n||(n=!0,e.push(t)),e.push(a)):Ro.unlinkSync(a)}n||Ro.rmdirSync(t)}while(e.length!==0)}function mme(r,e){var t=Ev(r,e),n=t[0],i=t[1];iK(n,function(s,a){if(s)return i(s);Ro.mkdir(a,n.mode||H7,function(c){if(c)return i(c);i(null,a,X7(a,n))})})}function fme(r){var e=Ev(r),t=e[0],n=oK(t);return Ro.mkdirSync(n,t.mode||H7),{name:n,removeCallback:X7(n,t)}}function Y7(r,e,t){var n=Z7(function(o){try{Ro.closeSync(o[0])}catch(s){if(s.errno!=-cC.EBADF&&s.errno!=-cC.ENOENT)throw s}Ro.unlinkSync(o[1])},[e,r]);return t.keep||Cv.unshift(n),n}function X7(r,e){var t=e.unsafeCleanup?dme:Ro.rmdirSync.bind(Ro),n=Z7(t,r);return e.keep||Cv.unshift(n),n}function Z7(r,e){var t=!1;return function n(){if(!t){var i=Cv.indexOf(n);i>=0&&Cv.splice(i,1),t=!0,r(e)}}}function e8(){if(!(nK&&!z7))for(var r=0,e=Cv.length;r<e;r++)try{Cv[r].call(null)}catch{}}function hme(){z7=!0}var bD=process.versions.node.split(".").map(function(r){return parseInt(r,10)});bD[0]===0&&(bD[1]<9||bD[1]===9&&bD[2]<5)&&process.addListener("uncaughtException",function(e){throw nK=!0,e8(),e});process.addListener("exit",function(e){e&&(nK=!0),e8()});Xc.exports.tmpdir=tK;Xc.exports.dir=mme;Xc.exports.dirSync=fme;Xc.exports.file=ume;Xc.exports.fileSync=pme;Xc.exports.tmpName=iK;Xc.exports.tmpNameSync=oK;Xc.exports.setGracefulCleanup=hme});var M8=M((e7e,A8)=>{var _me=require("crypto");A8.exports=function(){return _me.randomBytes(16)}});var F8=M((t7e,K8)=>{var O8=[];for(hC=0;hC<256;++hC)O8[hC]=(hC+256).toString(16).substr(1);var hC;function Rme(r,e){var t=e||0,n=O8;return[n[r[t++]],n[r[t++]],n[r[t++]],n[r[t++]],"-",n[r[t++]],n[r[t++]],"-",n[r[t++]],n[r[t++]],"-",n[r[t++]],n[r[t++]],"-",n[r[t++]],n[r[t++]],n[r[t++]],n[r[t++]],n[r[t++]],n[r[t++]]].join("")}K8.exports=Rme});var po=M((r7e,L8)=>{var Nme=M8(),Ame=F8();function Mme(r,e,t){var n=e&&t||0;typeof r=="string"&&(e=r==="binary"?new Array(16):null,r=null),r=r||{};var i=r.random||(r.rng||Nme)();if(i[6]=i[6]&15|64,i[8]=i[8]&63|128,e)for(var o=0;o<16;++o)e[n+o]=i[o];return e||Ame(i)}L8.exports=Mme});var J8=M((e$e,q8)=>{"use strict";function zm(r){if(!(this instanceof zm))return new zm(r);r=r||{},this.concurrency=r.concurrency||1/0,this.pending=0,this.jobs=[],this.cbs=[],this._done=Fme.bind(this)}var Kme=["push","unshift","splice"];Kme.forEach(function(r){zm.prototype[r]=function(){var e=Array.prototype[r].apply(this.jobs,arguments);return this._run(),e}});Object.defineProperty(zm.prototype,"length",{get:function(){return this.pending+this.jobs.length}});zm.prototype._run=function(){if(this.pending!==this.concurrency){if(this.jobs.length){var r=this.jobs.shift();this.pending++,r(this._done),this._run()}if(this.pending===0)for(;this.cbs.length!==0;){var e=this.cbs.pop();process.nextTick(e)}}};zm.prototype.onDone=function(r){typeof r=="function"&&(this.cbs.push(r),this._run())};function Fme(){this.pending--,this._run()}q8.exports=zm});var Qm=M((t$e,$8)=>{"use strict";$8.exports={BINARY_TYPES:["nodebuffer","arraybuffer","fragments"],GUID:"258EAFA5-E914-47DA-95CA-C5AB0DC85B11",kStatusCode:Symbol("status-code"),kWebSocket:Symbol("websocket"),EMPTY_BUFFER:Buffer.alloc(0),NOOP:()=>{}}});var l$=M((r$e,a$)=>{var Q8=require("fs"),iu=require("path"),Y8=require("os"),X8=typeof __webpack_require__=="function"?__non_webpack_require__:require,Lme=process.config&&process.config.variables||{},Ume=!!process.env.PREBUILDS_ONLY,H8=process.versions.modules,CK=Vme()?"electron":jme()?"node-webkit":"node",EK=process.env.npm_config_arch||Y8.arch(),wK=process.env.npm_config_platform||Y8.platform(),Z8=process.env.LIBC||(Bme(wK)?"musl":"glibc"),kK=process.env.ARM_VERSION||(EK==="arm64"?"8":Lme.arm_version)||"",e$=(process.versions.uv||"").split(".")[0];a$.exports=ec;function ec(r){return X8(ec.resolve(r))}ec.resolve=ec.path=function(r){r=iu.resolve(r||".");try{var e=X8(iu.join(r,"package.json")).name.toUpperCase().replace(/-/g,"_");process.env[e+"_PREBUILD"]&&(r=process.env[e+"_PREBUILD"])}catch{}if(!Ume){var t=G8(iu.join(r,"build/Release"),z8);if(t)return t;var n=G8(iu.join(r,"build/Debug"),z8);if(n)return n}var i=a(r);if(i)return i;var o=a(iu.dirname(process.execPath));if(o)return o;var s=["platform="+wK,"arch="+EK,"runtime="+CK,"abi="+H8,"uv="+e$,kK?"armv="+kK:"","libc="+Z8,"node="+process.versions.node,process.versions.electron?"electron="+process.versions.electron:"",typeof __webpack_require__=="function"?"webpack=true":""].filter(Boolean).join(" ");throw new Error("No native build was found for "+s+`
    loaded from: `+r+`
`);function a(l){var c=PK(iu.join(l,"prebuilds")).map(t$),u=c.filter(r$(wK,EK)).sort(n$)[0];if(u){var d=iu.join(l,"prebuilds",u.name),f=PK(d).map(i$),h=f.filter(o$(CK,H8)),v=h.sort(s$(CK))[0];if(v)return iu.join(d,v.file)}}};function PK(r){try{return Q8.readdirSync(r)}catch{return[]}}function G8(r,e){var t=PK(r).filter(e);return t[0]&&iu.join(r,t[0])}function z8(r){return/\.node$/.test(r)}function t$(r){var e=r.split("-");if(e.length===2){var t=e[0],n=e[1].split("+");if(t&&n.length&&n.every(Boolean))return{name:r,platform:t,architectures:n}}}function r$(r,e){return function(t){return t==null||t.platform!==r?!1:t.architectures.includes(e)}}function n$(r,e){return r.architectures.length-e.architectures.length}function i$(r){var e=r.split("."),t=e.pop(),n={file:r,specificity:0};if(t==="node"){for(var i=0;i<e.length;i++){var o=e[i];if(o==="node"||o==="electron"||o==="node-webkit")n.runtime=o;else if(o==="napi")n.napi=!0;else if(o.slice(0,3)==="abi")n.abi=o.slice(3);else if(o.slice(0,2)==="uv")n.uv=o.slice(2);else if(o.slice(0,4)==="armv")n.armv=o.slice(4);else if(o==="glibc"||o==="musl")n.libc=o;else continue;n.specificity++}return n}}function o$(r,e){return function(t){return!(t==null||t.runtime!==r&&!Wme(t)||t.abi!==e&&!t.napi||t.uv&&t.uv!==e$||t.armv&&t.armv!==kK||t.libc&&t.libc!==Z8)}}function Wme(r){return r.runtime==="node"&&r.napi}function s$(r){return function(e,t){return e.runtime!==t.runtime?e.runtime===r?-1:1:e.abi!==t.abi?e.abi?-1:1:e.specificity!==t.specificity?e.specificity>t.specificity?-1:1:0}}function jme(){return!!(process.versions&&process.versions.nw)}function Vme(){return process.versions&&process.versions.electron||process.env.ELECTRON_RUN_AS_NODE?!0:typeof window<"u"&&window.process&&window.process.type==="renderer"}function Bme(r){return r==="linux"&&Q8.existsSync("/etc/alpine-release")}ec.parseTags=i$;ec.matchTags=o$;ec.compareTags=s$;ec.parseTuple=t$;ec.matchTuple=r$;ec.compareTuples=n$});var TK=M((n$e,DK)=>{typeof process.addon=="function"?DK.exports=process.addon.bind(process):DK.exports=l$()});var u$=M((i$e,c$)=>{"use strict";var qme=(r,e,t,n,i)=>{for(var o=0;o<i;o++)t[n+o]=r[o]^e[o&3]},Jme=(r,e)=>{let t=r.length;for(var n=0;n<t;n++)r[n]^=e[n&3]};c$.exports={mask:qme,unmask:Jme}});var p$=M((o$e,_K)=>{"use strict";try{_K.exports=TK()(__dirname)}catch{_K.exports=u$()}});var $D=M((s$e,RK)=>{"use strict";var{EMPTY_BUFFER:$me}=Qm();function d$(r,e){if(r.length===0)return $me;if(r.length===1)return r[0];let t=Buffer.allocUnsafe(e);for(var n=0,i=0;i<r.length;i++){let o=r[i];o.copy(t,n),n+=o.length}return t}function m$(r,e,t,n,i){for(var o=0;o<i;o++)t[n+o]=r[o]^e[o&3]}function f$(r,e){let t=r.length;for(var n=0;n<t;n++)r[n]^=e[n&3]}function h$(r){return r.byteLength===r.buffer.byteLength?r.buffer:r.buffer.slice(r.byteOffset,r.byteOffset+r.byteLength)}function JD(r){if(JD.readOnly=!0,Buffer.isBuffer(r))return r;var e;return r instanceof ArrayBuffer?e=Buffer.from(r):ArrayBuffer.isView(r)?e=Hme(r):(e=Buffer.from(r),JD.readOnly=!1),e}function Hme(r){let e=Buffer.from(r.buffer);return r.byteLength!==r.buffer.byteLength?e.slice(r.byteOffset,r.byteOffset+r.byteLength):e}try{let r=p$(),e=r.BufferUtil||r;RK.exports={concat:d$,mask(t,n,i,o,s){s<48?m$(t,n,i,o,s):e.mask(t,n,i,o,s)},toArrayBuffer:h$,toBuffer:JD,unmask(t,n){t.length<32?f$(t,n):e.unmask(t,n)}}}catch{RK.exports={concat:d$,mask:m$,toArrayBuffer:h$,toBuffer:JD,unmask:f$}}});var IC=M((a$e,I$)=>{"use strict";var Gme=J8(),bC=require("zlib"),g$=$D(),{kStatusCode:v$,NOOP:zme}=Qm(),Qme=Buffer.from([0,0,255,255]),Yme=Buffer.from([0]),GD=Symbol("permessage-deflate"),ou=Symbol("total-length"),y$=Symbol("callback"),rd=Symbol("buffers"),NK=Symbol("error"),HD,AK=class{constructor(e,t,n){if(this._maxPayload=n|0,this._options=e||{},this._threshold=this._options.threshold!==void 0?this._options.threshold:1024,this._isServer=!!t,this._deflate=null,this._inflate=null,this.params=null,!HD){let i=this._options.concurrencyLimit!==void 0?this._options.concurrencyLimit:10;HD=new Gme({concurrency:i})}}static get extensionName(){return"permessage-deflate"}offer(){let e={};return this._options.serverNoContextTakeover&&(e.server_no_context_takeover=!0),this._options.clientNoContextTakeover&&(e.client_no_context_takeover=!0),this._options.serverMaxWindowBits&&(e.server_max_window_bits=this._options.serverMaxWindowBits),this._options.clientMaxWindowBits?e.client_max_window_bits=this._options.clientMaxWindowBits:this._options.clientMaxWindowBits==null&&(e.client_max_window_bits=!0),e}accept(e){return e=this.normalizeParams(e),this.params=this._isServer?this.acceptAsServer(e):this.acceptAsClient(e),this.params}cleanup(){this._inflate&&(this._inflate.close(),this._inflate=null),this._deflate&&(this._deflate.close(),this._deflate=null)}acceptAsServer(e){let t=this._options,n=e.find(i=>!(t.serverNoContextTakeover===!1&&i.server_no_context_takeover||i.server_max_window_bits&&(t.serverMaxWindowBits===!1||typeof t.serverMaxWindowBits=="number"&&t.serverMaxWindowBits>i.server_max_window_bits)||typeof t.clientMaxWindowBits=="number"&&!i.client_max_window_bits));if(!n)throw new Error("None of the extension offers can be accepted");return t.serverNoContextTakeover&&(n.server_no_context_takeover=!0),t.clientNoContextTakeover&&(n.client_no_context_takeover=!0),typeof t.serverMaxWindowBits=="number"&&(n.server_max_window_bits=t.serverMaxWindowBits),typeof t.clientMaxWindowBits=="number"?n.client_max_window_bits=t.clientMaxWindowBits:(n.client_max_window_bits===!0||t.clientMaxWindowBits===!1)&&delete n.client_max_window_bits,n}acceptAsClient(e){let t=e[0];if(this._options.clientNoContextTakeover===!1&&t.client_no_context_takeover)throw new Error('Unexpected parameter "client_no_context_takeover"');if(!t.client_max_window_bits)typeof this._options.clientMaxWindowBits=="number"&&(t.client_max_window_bits=this._options.clientMaxWindowBits);else if(this._options.clientMaxWindowBits===!1||typeof this._options.clientMaxWindowBits=="number"&&t.client_max_window_bits>this._options.clientMaxWindowBits)throw new Error('Unexpected or invalid parameter "client_max_window_bits"');return t}normalizeParams(e){return e.forEach(t=>{Object.keys(t).forEach(n=>{var i=t[n];if(i.length>1)throw new Error(`Parameter "${n}" must have only a single value`);if(i=i[0],n==="client_max_window_bits"){if(i!==!0){let o=+i;if(!Number.isInteger(o)||o<8||o>15)throw new TypeError(`Invalid value for parameter "${n}": ${i}`);i=o}else if(!this._isServer)throw new TypeError(`Invalid value for parameter "${n}": ${i}`)}else if(n==="server_max_window_bits"){let o=+i;if(!Number.isInteger(o)||o<8||o>15)throw new TypeError(`Invalid value for parameter "${n}": ${i}`);i=o}else if(n==="client_no_context_takeover"||n==="server_no_context_takeover"){if(i!==!0)throw new TypeError(`Invalid value for parameter "${n}": ${i}`)}else throw new Error(`Unknown parameter "${n}"`);t[n]=i})}),e}decompress(e,t,n){HD.push(i=>{this._decompress(e,t,(o,s)=>{i(),n(o,s)})})}compress(e,t,n){HD.push(i=>{this._compress(e,t,(o,s)=>{i(),n(o,s)})})}_decompress(e,t,n){let i=this._isServer?"client":"server";if(!this._inflate){let o=`${i}_max_window_bits`,s=typeof this.params[o]!="number"?bC.Z_DEFAULT_WINDOWBITS:this.params[o];this._inflate=bC.createInflateRaw(Object.assign({},this._options.zlibInflateOptions,{windowBits:s})),this._inflate[GD]=this,this._inflate[ou]=0,this._inflate[rd]=[],this._inflate.on("error",Zme),this._inflate.on("data",b$)}this._inflate[y$]=n,this._inflate.write(e),t&&this._inflate.write(Qme),this._inflate.flush(()=>{let o=this._inflate[NK];if(o){this._inflate.close(),this._inflate=null,n(o);return}let s=g$.concat(this._inflate[rd],this._inflate[ou]);t&&this.params[`${i}_no_context_takeover`]?(this._inflate.close(),this._inflate=null):(this._inflate[ou]=0,this._inflate[rd]=[]),n(null,s)})}_compress(e,t,n){if(!e||e.length===0){process.nextTick(n,null,Yme);return}let i=this._isServer?"server":"client";if(!this._deflate){let o=`${i}_max_window_bits`,s=typeof this.params[o]!="number"?bC.Z_DEFAULT_WINDOWBITS:this.params[o];this._deflate=bC.createDeflateRaw(Object.assign({},this._options.zlibDeflateOptions,{windowBits:s})),this._deflate[ou]=0,this._deflate[rd]=[],this._deflate.on("error",zme),this._deflate.on("data",Xme)}this._deflate.write(e),this._deflate.flush(bC.Z_SYNC_FLUSH,()=>{if(this._deflate){var o=g$.concat(this._deflate[rd],this._deflate[ou]);t&&(o=o.slice(0,o.length-4)),t&&this.params[`${i}_no_context_takeover`]?(this._deflate.close(),this._deflate=null):(this._deflate[ou]=0,this._deflate[rd]=[]),n(null,o)}})}};I$.exports=AK;function Xme(r){this[rd].push(r),this[ou]+=r.length}function b$(r){if(this[ou]+=r.length,this[GD]._maxPayload<1||this[ou]<=this[GD]._maxPayload){this[rd].push(r);return}this[NK]=new RangeError("Max payload size exceeded"),this[NK][v$]=1009,this.removeListener("data",b$),this.reset()}function Zme(r){this[GD]._inflate=null,r[v$]=1007,this[y$](r)}});var x$=M((l$e,S$)=>{"use strict";var iy=class{constructor(e,t){this.target=t,this.type=e}},MK=class extends iy{constructor(e,t){super("message",t),this.data=e}},OK=class extends iy{constructor(e,t,n){super("close",n),this.wasClean=n._closeFrameReceived&&n._closeFrameSent,this.reason=t,this.code=e}},KK=class extends iy{constructor(e){super("open",e)}},FK=class extends iy{constructor(e,t){super("error",t),this.message=e.message,this.error=e}},efe={addEventListener(r,e){if(typeof e!="function")return;function t(s){e.call(this,new MK(s,this))}function n(s,a){e.call(this,new OK(s,a,this))}function i(s){e.call(this,new FK(s,this))}function o(){e.call(this,new KK(this))}r==="message"?(t._listener=e,this.on(r,t)):r==="close"?(n._listener=e,this.on(r,n)):r==="error"?(i._listener=e,this.on(r,i)):r==="open"?(o._listener=e,this.on(r,o)):this.on(r,e)},removeEventListener(r,e){let t=this.listeners(r);for(var n=0;n<t.length;n++)(t[n]===e||t[n]._listener===e)&&this.removeListener(r,t[n])}};S$.exports=efe});var LK=M((c$e,C$)=>{"use strict";var SC=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,1,1,1,1,1,0,0,1,1,0,1,1,0,1,1,1,1,1,1,1,1,1,1,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,1,0,1,0];function tc(r,e,t){Object.prototype.hasOwnProperty.call(r,e)?r[e].push(t):r[e]=[t]}function tfe(r){let e={};if(r===void 0||r==="")return e;for(var t={},n=!1,i=!1,o=!1,s,a,l=-1,c=-1,u=0;u<r.length;u++){let h=r.charCodeAt(u);if(s===void 0)if(c===-1&&SC[h]===1)l===-1&&(l=u);else if(h===32||h===9)c===-1&&l!==-1&&(c=u);else if(h===59||h===44){if(l===-1)throw new SyntaxError(`Unexpected character at index ${u}`);c===-1&&(c=u);let v=r.slice(l,c);h===44?(tc(e,v,t),t={}):s=v,l=c=-1}else throw new SyntaxError(`Unexpected character at index ${u}`);else if(a===void 0)if(c===-1&&SC[h]===1)l===-1&&(l=u);else if(h===32||h===9)c===-1&&l!==-1&&(c=u);else if(h===59||h===44){if(l===-1)throw new SyntaxError(`Unexpected character at index ${u}`);c===-1&&(c=u),tc(t,r.slice(l,c),!0),h===44&&(tc(e,s,t),t={},s=void 0),l=c=-1}else if(h===61&&l!==-1&&c===-1)a=r.slice(l,u),l=c=-1;else throw new SyntaxError(`Unexpected character at index ${u}`);else if(i){if(SC[h]!==1)throw new SyntaxError(`Unexpected character at index ${u}`);l===-1?l=u:n||(n=!0),i=!1}else if(o)if(SC[h]===1)l===-1&&(l=u);else if(h===34&&l!==-1)o=!1,c=u;else if(h===92)i=!0;else throw new SyntaxError(`Unexpected character at index ${u}`);else if(h===34&&r.charCodeAt(u-1)===61)o=!0;else if(c===-1&&SC[h]===1)l===-1&&(l=u);else if(l!==-1&&(h===32||h===9))c===-1&&(c=u);else if(h===59||h===44){if(l===-1)throw new SyntaxError(`Unexpected character at index ${u}`);c===-1&&(c=u);var d=r.slice(l,c);n&&(d=d.replace(/\\/g,""),n=!1),tc(t,a,d),h===44&&(tc(e,s,t),t={},s=void 0),a=void 0,l=c=-1}else throw new SyntaxError(`Unexpected character at index ${u}`)}if(l===-1||o)throw new SyntaxError("Unexpected end of input");c===-1&&(c=u);let f=r.slice(l,c);return s===void 0?tc(e,f,{}):(a===void 0?tc(t,f,!0):n?tc(t,a,f.replace(/\\/g,"")):tc(t,a,f),tc(e,s,t)),e}function rfe(r){return Object.keys(r).map(e=>{var t=r[e];return Array.isArray(t)||(t=[t]),t.map(n=>[e].concat(Object.keys(n).map(i=>{var o=n[i];return Array.isArray(o)||(o=[o]),o.map(s=>s===!0?i:`${i}=${s}`).join("; ")})).join("; ")).join(", ")}).join(", ")}C$.exports={format:rfe,parse:tfe}});var w$=M((u$e,E$)=>{"use strict";function nfe(r){let e=r.length,t=0;for(;t<e;)if(!(r[t]&128))t++;else if((r[t]&224)===192){if(t+1===e||(r[t+1]&192)!==128||(r[t]&254)===192)return!1;t+=2}else if((r[t]&240)===224){if(t+2>=e||(r[t+1]&192)!==128||(r[t+2]&192)!==128||r[t]===224&&(r[t+1]&224)===128||r[t]===237&&(r[t+1]&224)===160)return!1;t+=3}else if((r[t]&248)===240){if(t+3>=e||(r[t+1]&192)!==128||(r[t+2]&192)!==128||(r[t+3]&192)!==128||r[t]===240&&(r[t+1]&240)===128||r[t]===244&&r[t+1]>143||r[t]>244)return!1;t+=4}else return!1;return!0}E$.exports=nfe});var k$=M((p$e,UK)=>{"use strict";try{UK.exports=TK()(__dirname)}catch{UK.exports=w$()}});var WK=M(zD=>{"use strict";try{let r=k$();zD.isValidUTF8=typeof r=="object"?r.Validation.isValidUTF8:r}catch{zD.isValidUTF8=()=>!0}zD.isValidStatusCode=r=>r>=1e3&&r<=1013&&r!==1004&&r!==1005&&r!==1006||r>=3e3&&r<=4999});var qK=M((m$e,N$)=>{"use strict";var{Writable:ife}=require("stream"),P$=IC(),{BINARY_TYPES:ofe,EMPTY_BUFFER:sfe,kStatusCode:afe,kWebSocket:lfe}=Qm(),{concat:jK,toArrayBuffer:cfe,unmask:ufe}=$D(),{isValidStatusCode:pfe,isValidUTF8:D$}=WK(),xC=0,T$=1,_$=2,R$=3,VK=4,dfe=5,BK=class extends ife{constructor(e,t,n){super(),this._binaryType=e||ofe[0],this[lfe]=void 0,this._extensions=t||{},this._maxPayload=n|0,this._bufferedBytes=0,this._buffers=[],this._compressed=!1,this._payloadLength=0,this._mask=void 0,this._fragmented=0,this._masked=!1,this._fin=!1,this._opcode=0,this._totalPayloadLength=0,this._messageLength=0,this._fragments=[],this._state=xC,this._loop=!1}_write(e,t,n){if(this._opcode===8&&this._state==xC)return n();this._bufferedBytes+=e.length,this._buffers.push(e),this.startLoop(n)}consume(e){if(this._bufferedBytes-=e,e===this._buffers[0].length)return this._buffers.shift();if(e<this._buffers[0].length){let n=this._buffers[0];return this._buffers[0]=n.slice(e),n.slice(0,e)}let t=Buffer.allocUnsafe(e);do{let n=this._buffers[0];e>=n.length?this._buffers.shift().copy(t,t.length-e):(n.copy(t,t.length-e,0,e),this._buffers[0]=n.slice(e)),e-=n.length}while(e>0);return t}startLoop(e){var t;this._loop=!0;do switch(this._state){case xC:t=this.getInfo();break;case T$:t=this.getPayloadLength16();break;case _$:t=this.getPayloadLength64();break;case R$:this.getMask();break;case VK:t=this.getData(e);break;default:this._loop=!1;return}while(this._loop);e(t)}getInfo(){if(this._bufferedBytes<2){this._loop=!1;return}let e=this.consume(2);if(e[0]&48)return this._loop=!1,Pi(RangeError,"RSV2 and RSV3 must be clear",!0,1002);let t=(e[0]&64)===64;if(t&&!this._extensions[P$.extensionName])return this._loop=!1,Pi(RangeError,"RSV1 must be clear",!0,1002);if(this._fin=(e[0]&128)===128,this._opcode=e[0]&15,this._payloadLength=e[1]&127,this._opcode===0){if(t)return this._loop=!1,Pi(RangeError,"RSV1 must be clear",!0,1002);if(!this._fragmented)return this._loop=!1,Pi(RangeError,"invalid opcode 0",!0,1002);this._opcode=this._fragmented}else if(this._opcode===1||this._opcode===2){if(this._fragmented)return this._loop=!1,Pi(RangeError,`invalid opcode ${this._opcode}`,!0,1002);this._compressed=t}else if(this._opcode>7&&this._opcode<11){if(!this._fin)return this._loop=!1,Pi(RangeError,"FIN must be set",!0,1002);if(t)return this._loop=!1,Pi(RangeError,"RSV1 must be clear",!0,1002);if(this._payloadLength>125)return this._loop=!1,Pi(RangeError,`invalid payload length ${this._payloadLength}`,!0,1002)}else return this._loop=!1,Pi(RangeError,`invalid opcode ${this._opcode}`,!0,1002);if(!this._fin&&!this._fragmented&&(this._fragmented=this._opcode),this._masked=(e[1]&128)===128,this._payloadLength===126)this._state=T$;else if(this._payloadLength===127)this._state=_$;else return this.haveLength()}getPayloadLength16(){if(this._bufferedBytes<2){this._loop=!1;return}return this._payloadLength=this.consume(2).readUInt16BE(0),this.haveLength()}getPayloadLength64(){if(this._bufferedBytes<8){this._loop=!1;return}let e=this.consume(8),t=e.readUInt32BE(0);return t>Math.pow(2,53-32)-1?(this._loop=!1,Pi(RangeError,"Unsupported WebSocket frame: payload length > 2^53 - 1",!1,1009)):(this._payloadLength=t*Math.pow(2,32)+e.readUInt32BE(4),this.haveLength())}haveLength(){if(this._payloadLength&&this._opcode<8&&(this._totalPayloadLength+=this._payloadLength,this._totalPayloadLength>this._maxPayload&&this._maxPayload>0))return this._loop=!1,Pi(RangeError,"Max payload size exceeded",!1,1009);this._masked?this._state=R$:this._state=VK}getMask(){if(this._bufferedBytes<4){this._loop=!1;return}this._mask=this.consume(4),this._state=VK}getData(e){var t=sfe;if(this._payloadLength){if(this._bufferedBytes<this._payloadLength){this._loop=!1;return}t=this.consume(this._payloadLength),this._masked&&ufe(t,this._mask)}if(this._opcode>7)return this.controlMessage(t);if(this._compressed){this._state=dfe,this.decompress(t,e);return}return t.length&&(this._messageLength=this._totalPayloadLength,this._fragments.push(t)),this.dataMessage()}decompress(e,t){this._extensions[P$.extensionName].decompress(e,this._fin,(i,o)=>{if(i)return t(i);if(o.length){if(this._messageLength+=o.length,this._messageLength>this._maxPayload&&this._maxPayload>0)return t(Pi(RangeError,"Max payload size exceeded",!1,1009));this._fragments.push(o)}let s=this.dataMessage();if(s)return t(s);this.startLoop(t)})}dataMessage(){if(this._fin){let t=this._messageLength,n=this._fragments;if(this._totalPayloadLength=0,this._messageLength=0,this._fragmented=0,this._fragments=[],this._opcode===2){var e;this._binaryType==="nodebuffer"?e=jK(n,t):this._binaryType==="arraybuffer"?e=cfe(jK(n,t)):e=n,this.emit("message",e)}else{let i=jK(n,t);if(!D$(i))return this._loop=!1,Pi(Error,"invalid UTF-8 sequence",!0,1007);this.emit("message",i.toString())}}this._state=xC}controlMessage(e){if(this._opcode===8)if(this._loop=!1,e.length===0)this.emit("conclude",1005,""),this.end();else{if(e.length===1)return Pi(RangeError,"invalid payload length 1",!0,1002);{let t=e.readUInt16BE(0);if(!pfe(t))return Pi(RangeError,`invalid status code ${t}`,!0,1002);let n=e.slice(2);if(!D$(n))return Pi(Error,"invalid UTF-8 sequence",!0,1007);this.emit("conclude",t,n.toString()),this.end()}}else this._opcode===9?this.emit("ping",e):this.emit("pong",e);this._state=xC}};N$.exports=BK;function Pi(r,e,t,n){let i=new r(t?`Invalid WebSocket frame: ${e}`:e);return Error.captureStackTrace(i,Pi),i[afe]=n,i}});var $K=M((f$e,O$)=>{"use strict";var{randomBytes:mfe}=require("crypto"),A$=IC(),{EMPTY_BUFFER:ffe}=Qm(),{isValidStatusCode:hfe}=WK(),{mask:M$,toBuffer:su}=$D(),JK=class r{constructor(e,t){this._extensions=t||{},this._socket=e,this._firstFragment=!0,this._compress=!1,this._bufferedBytes=0,this._deflating=!1,this._queue=[]}static frame(e,t){let n=t.mask&&t.readOnly;var i=t.mask?6:2,o=e.length;e.length>=65536?(i+=8,o=127):e.length>125&&(i+=2,o=126);let s=Buffer.allocUnsafe(n?e.length+i:i);if(s[0]=t.fin?t.opcode|128:t.opcode,t.rsv1&&(s[0]|=64),s[1]=o,o===126?s.writeUInt16BE(e.length,2):o===127&&(s.writeUInt32BE(0,2),s.writeUInt32BE(e.length,6)),!t.mask)return[s,e];let a=mfe(4);return s[1]|=128,s[i-4]=a[0],s[i-3]=a[1],s[i-2]=a[2],s[i-1]=a[3],n?(M$(e,a,s,i,e.length),[s]):(M$(e,a,e,0,e.length),[s,e])}close(e,t,n,i){var o;if(e===void 0)o=ffe;else{if(typeof e!="number"||!hfe(e))throw new TypeError("First argument must be a valid error code number");t===void 0||t===""?(o=Buffer.allocUnsafe(2),o.writeUInt16BE(e,0)):(o=Buffer.allocUnsafe(2+Buffer.byteLength(t)),o.writeUInt16BE(e,0),o.write(t,2))}this._deflating?this.enqueue([this.doClose,o,n,i]):this.doClose(o,n,i)}doClose(e,t,n){this.sendFrame(r.frame(e,{fin:!0,rsv1:!1,opcode:8,mask:t,readOnly:!1}),n)}ping(e,t,n){let i=su(e);this._deflating?this.enqueue([this.doPing,i,t,su.readOnly,n]):this.doPing(i,t,su.readOnly,n)}doPing(e,t,n,i){this.sendFrame(r.frame(e,{fin:!0,rsv1:!1,opcode:9,mask:t,readOnly:n}),i)}pong(e,t,n){let i=su(e);this._deflating?this.enqueue([this.doPong,i,t,su.readOnly,n]):this.doPong(i,t,su.readOnly,n)}doPong(e,t,n,i){this.sendFrame(r.frame(e,{fin:!0,rsv1:!1,opcode:10,mask:t,readOnly:n}),i)}send(e,t,n){let i=su(e),o=this._extensions[A$.extensionName];var s=t.binary?2:1,a=t.compress;if(this._firstFragment?(this._firstFragment=!1,a&&o&&(a=i.length>=o._threshold),this._compress=a):(a=!1,s=0),t.fin&&(this._firstFragment=!0),o){let l={fin:t.fin,rsv1:a,opcode:s,mask:t.mask,readOnly:su.readOnly};this._deflating?this.enqueue([this.dispatch,i,this._compress,l,n]):this.dispatch(i,this._compress,l,n)}else this.sendFrame(r.frame(i,{fin:t.fin,rsv1:!1,opcode:s,mask:t.mask,readOnly:su.readOnly}),n)}dispatch(e,t,n,i){if(!t){this.sendFrame(r.frame(e,n),i);return}let o=this._extensions[A$.extensionName];this._deflating=!0,o.compress(e,n.fin,(s,a)=>{this._deflating=!1,n.readOnly=!1,this.sendFrame(r.frame(a,n),i),this.dequeue()})}dequeue(){for(;!this._deflating&&this._queue.length;){let e=this._queue.shift();this._bufferedBytes-=e[1].length,e[0].apply(this,e.slice(1))}}enqueue(e){this._bufferedBytes+=e[1].length,this._queue.push(e)}sendFrame(e,t){e.length===2?(this._socket.cork(),this._socket.write(e[0]),this._socket.write(e[1],t),this._socket.uncork()):this._socket.write(e[0],t)}};O$.exports=JK});var zK=M((h$e,$$)=>{"use strict";var gfe=require("events"),K$=require("crypto"),vfe=require("https"),yfe=require("http"),bfe=require("net"),Ife=require("tls"),oy=require("url"),nd=IC(),W$=x$(),F$=LK(),Sfe=qK(),xfe=$K(),{BINARY_TYPES:L$,EMPTY_BUFFER:HK,GUID:Cfe,kStatusCode:Efe,kWebSocket:Ao,NOOP:j$}=Qm(),QD=["CONNECTING","OPEN","CLOSING","CLOSED"],GK=[8,13],wfe=30*1e3,Mo=class r extends gfe{constructor(e,t,n){super(),this.readyState=r.CONNECTING,this.protocol="",this._binaryType=L$[0],this._closeFrameReceived=!1,this._closeFrameSent=!1,this._closeMessage="",this._closeTimer=null,this._closeCode=1006,this._extensions={},this._receiver=null,this._sender=null,this._socket=null,e!==null?(this._isServer=!1,this._redirects=0,Array.isArray(t)?t=t.join(", "):typeof t=="object"&&t!==null&&(n=t,t=void 0),V$(this,e,t,n)):this._isServer=!0}get CONNECTING(){return r.CONNECTING}get CLOSING(){return r.CLOSING}get CLOSED(){return r.CLOSED}get OPEN(){return r.OPEN}get binaryType(){return this._binaryType}set binaryType(e){L$.includes(e)&&(this._binaryType=e,this._receiver&&(this._receiver._binaryType=e))}get bufferedAmount(){return this._socket?(this._socket.bufferSize||0)+this._sender._bufferedBytes:0}get extensions(){return Object.keys(this._extensions).join()}setSocket(e,t,n){let i=new Sfe(this._binaryType,this._extensions,n);this._sender=new xfe(e,this._extensions),this._receiver=i,this._socket=e,i[Ao]=this,e[Ao]=this,i.on("conclude",Dfe),i.on("drain",Tfe),i.on("error",_fe),i.on("message",Rfe),i.on("ping",Nfe),i.on("pong",Afe),e.setTimeout(0),e.setNoDelay(),t.length>0&&e.unshift(t),e.on("close",B$),e.on("data",YD),e.on("end",q$),e.on("error",J$),this.readyState=r.OPEN,this.emit("open")}emitClose(){if(this.readyState=r.CLOSED,!this._socket){this.emit("close",this._closeCode,this._closeMessage);return}this._extensions[nd.extensionName]&&this._extensions[nd.extensionName].cleanup(),this._receiver.removeAllListeners(),this.emit("close",this._closeCode,this._closeMessage)}close(e,t){if(this.readyState!==r.CLOSED){if(this.readyState===r.CONNECTING){let n="WebSocket was closed before the connection was established";return au(this,this._req,n)}if(this.readyState===r.CLOSING){this._closeFrameSent&&this._closeFrameReceived&&this._socket.end();return}this.readyState=r.CLOSING,this._sender.close(e,t,!this._isServer,n=>{n||(this._closeFrameSent=!0,this._closeFrameReceived&&this._socket.end())}),this._closeTimer=setTimeout(this._socket.destroy.bind(this._socket),wfe)}}ping(e,t,n){if(typeof e=="function"?(n=e,e=t=void 0):typeof t=="function"&&(n=t,t=void 0),this.readyState!==r.OPEN){let i=new Error(`WebSocket is not open: readyState ${this.readyState} (${QD[this.readyState]})`);if(n)return n(i);throw i}typeof e=="number"&&(e=e.toString()),t===void 0&&(t=!this._isServer),this._sender.ping(e||HK,t,n)}pong(e,t,n){if(typeof e=="function"?(n=e,e=t=void 0):typeof t=="function"&&(n=t,t=void 0),this.readyState!==r.OPEN){let i=new Error(`WebSocket is not open: readyState ${this.readyState} (${QD[this.readyState]})`);if(n)return n(i);throw i}typeof e=="number"&&(e=e.toString()),t===void 0&&(t=!this._isServer),this._sender.pong(e||HK,t,n)}send(e,t,n){if(typeof t=="function"&&(n=t,t={}),this.readyState!==r.OPEN){let o=new Error(`WebSocket is not open: readyState ${this.readyState} (${QD[this.readyState]})`);if(n)return n(o);throw o}typeof e=="number"&&(e=e.toString());let i=Object.assign({binary:typeof e!="string",mask:!this._isServer,compress:!0,fin:!0},t);this._extensions[nd.extensionName]||(i.compress=!1),this._sender.send(e||HK,i,n)}terminate(){if(this.readyState!==r.CLOSED){if(this.readyState===r.CONNECTING){let e="WebSocket was closed before the connection was established";return au(this,this._req,e)}this._socket&&(this.readyState=r.CLOSING,this._socket.destroy())}}};QD.forEach((r,e)=>{Mo[r]=e});["open","error","close","message"].forEach(r=>{Object.defineProperty(Mo.prototype,`on${r}`,{get(){let e=this.listeners(r);for(var t=0;t<e.length;t++)if(e[t]._listener)return e[t]._listener},set(e){let t=this.listeners(r);for(var n=0;n<t.length;n++)t[n]._listener&&this.removeListener(r,t[n]);this.addEventListener(r,e)}})});Mo.prototype.addEventListener=W$.addEventListener;Mo.prototype.removeEventListener=W$.removeEventListener;$$.exports=Mo;function V$(r,e,t,n){let i=Object.assign({protocolVersion:GK[1],maxPayload:104857600,perMessageDeflate:!0,followRedirects:!1,maxRedirects:10},n,{createConnection:void 0,socketPath:void 0,hostname:void 0,protocol:void 0,timeout:void 0,method:void 0,auth:void 0,host:void 0,path:void 0,port:void 0});if(!GK.includes(i.protocolVersion))throw new RangeError(`Unsupported protocol version: ${i.protocolVersion} (supported versions: ${GK.join(", ")})`);var o;typeof e=="object"&&e.href!==void 0?(o=e,r.url=e.href):(o=oy.URL?new oy.URL(e):oy.parse(e),r.url=e);let s=o.protocol==="ws+unix:";if(!o.host&&(!s||!o.pathname))throw new Error(`Invalid URL: ${r.url}`);let a=o.protocol==="wss:"||o.protocol==="https:",l=a?443:80,c=K$.randomBytes(16).toString("base64"),u=a?vfe.get:yfe.get,d=o.search?`${o.pathname||"/"}${o.search}`:o.pathname||"/";var f;if(i.createConnection=a?Pfe:kfe,i.defaultPort=i.defaultPort||l,i.port=o.port||l,i.host=o.hostname.startsWith("[")?o.hostname.slice(1,-1):o.hostname,i.headers=Object.assign({"Sec-WebSocket-Version":i.protocolVersion,"Sec-WebSocket-Key":c,Connection:"Upgrade",Upgrade:"websocket"},i.headers),i.path=d,i.timeout=i.handshakeTimeout,i.perMessageDeflate&&(f=new nd(i.perMessageDeflate!==!0?i.perMessageDeflate:{},!1,i.maxPayload),i.headers["Sec-WebSocket-Extensions"]=F$.format({[nd.extensionName]:f.offer()})),t&&(i.headers["Sec-WebSocket-Protocol"]=t),i.origin&&(i.protocolVersion<13?i.headers["Sec-WebSocket-Origin"]=i.origin:i.headers.Origin=i.origin),o.auth?i.auth=o.auth:(o.username||o.password)&&(i.auth=`${o.username}:${o.password}`),s){let v=d.split(":");i.socketPath=v[0],i.path=v[1]}var h=r._req=u(i);i.timeout&&h.on("timeout",()=>{au(r,h,"Opening handshake has timed out")}),h.on("error",v=>{r._req.aborted||(h=r._req=null,r.readyState=Mo.CLOSING,r.emit("error",v),r.emitClose())}),h.on("response",v=>{let S=v.headers.location,b=v.statusCode;if(S&&i.followRedirects&&b>=300&&b<400){if(++r._redirects>i.maxRedirects){au(r,h,"Maximum redirects exceeded");return}h.abort();let D=oy.URL?new oy.URL(S,e):oy.resolve(e,S);V$(r,D,t,n)}else r.emit("unexpected-response",h,v)||au(r,h,`Unexpected server response: ${v.statusCode}`)}),h.on("upgrade",(v,S,b)=>{if(r.emit("upgrade",v),r.readyState!==Mo.CONNECTING)return;h=r._req=null;let D=K$.createHash("sha1").update(c+Cfe).digest("base64");if(v.headers["sec-websocket-accept"]!==D){au(r,S,"Invalid Sec-WebSocket-Accept header");return}let _=v.headers["sec-websocket-protocol"],L=(t||"").split(/, */);var Z;if(!t&&_?Z="Server sent a subprotocol but none was requested":t&&!_?Z="Server sent no subprotocol":_&&!L.includes(_)&&(Z="Server sent an invalid subprotocol"),Z){au(r,S,Z);return}if(_&&(r.protocol=_),f)try{let Se=F$.parse(v.headers["sec-websocket-extensions"]);Se[nd.extensionName]&&(f.accept(Se[nd.extensionName]),r._extensions[nd.extensionName]=f)}catch{au(r,S,"Invalid Sec-WebSocket-Extensions header");return}r.setSocket(S,b,i.maxPayload)})}function kfe(r){return r.protocolVersion&&(r.path=r.socketPath),bfe.connect(r)}function Pfe(r){return r.path=void 0,r.servername=r.servername||r.host,Ife.connect(r)}function au(r,e,t){r.readyState=Mo.CLOSING;let n=new Error(t);Error.captureStackTrace(n,au),e.setHeader?(e.abort(),e.once("abort",r.emitClose.bind(r)),r.emit("error",n)):(e.destroy(n),e.once("error",r.emit.bind(r,"error")),e.once("close",r.emitClose.bind(r)))}function Dfe(r,e){let t=this[Ao];t._socket.removeListener("data",YD),t._socket.resume(),t._closeFrameReceived=!0,t._closeMessage=e,t._closeCode=r,r===1005?t.close():t.close(r,e)}function Tfe(){this[Ao]._socket.resume()}function _fe(r){let e=this[Ao];e._socket.removeListener("data",YD),e.readyState=Mo.CLOSING,e._closeCode=r[Efe],e.emit("error",r),e._socket.destroy()}function U$(){this[Ao].emitClose()}function Rfe(r){this[Ao].emit("message",r)}function Nfe(r){let e=this[Ao];e.pong(r,!e._isServer,j$),e.emit("ping",r)}function Afe(r){this[Ao].emit("pong",r)}function B$(){let r=this[Ao];this.removeListener("close",B$),this.removeListener("end",q$),r.readyState=Mo.CLOSING,r._socket.read(),r._receiver.end(),this.removeListener("data",YD),this[Ao]=void 0,clearTimeout(r._closeTimer),r._receiver._writableState.finished||r._receiver._writableState.errorEmitted?r.emitClose():(r._receiver.on("error",U$),r._receiver.on("finish",U$))}function YD(r){this[Ao]._receiver.write(r)||this.pause()}function q$(){let r=this[Ao];r.readyState=Mo.CLOSING,r._receiver.end(),this.end()}function J$(){let r=this[Ao];this.removeListener("error",J$),this.on("error",j$),r.readyState=Mo.CLOSING,this.destroy()}});var z$=M((g$e,G$)=>{"use strict";var Mfe=require("events"),Ofe=require("crypto"),ZD=require("http"),Ym=IC(),H$=LK(),Kfe=zK(),{GUID:Ffe}=Qm(),Lfe=/^[+/0-9A-Za-z]{22}==$/,QK=class extends Mfe{constructor(e,t){if(super(),e=Object.assign({maxPayload:100*1024*1024,perMessageDeflate:!1,handleProtocols:null,clientTracking:!0,verifyClient:null,noServer:!1,backlog:null,server:null,host:null,path:null,port:null},e),e.port==null&&!e.server&&!e.noServer)throw new TypeError('One of the "port", "server", or "noServer" options must be specified');e.port!=null?(this._server=ZD.createServer((n,i)=>{let o=ZD.STATUS_CODES[426];i.writeHead(426,{"Content-Length":o.length,"Content-Type":"text/plain"}),i.end(o)}),this._server.listen(e.port,e.host,e.backlog,t)):e.server&&(this._server=e.server),this._server&&(this._removeListeners=Ufe(this._server,{listening:this.emit.bind(this,"listening"),error:this.emit.bind(this,"error"),upgrade:(n,i,o)=>{this.handleUpgrade(n,i,o,s=>{this.emit("connection",s,n)})}})),e.perMessageDeflate===!0&&(e.perMessageDeflate={}),e.clientTracking&&(this.clients=new Set),this.options=e}address(){if(this.options.noServer)throw new Error('The server is operating in "noServer" mode');return this._server?this._server.address():null}close(e){if(e&&this.once("close",e),this.clients)for(let n of this.clients)n.terminate();let t=this._server;if(t&&(this._removeListeners(),this._removeListeners=this._server=null,this.options.port!=null)){t.close(()=>this.emit("close"));return}process.nextTick(Wfe,this)}shouldHandle(e){if(this.options.path){let t=e.url.indexOf("?");if((t!==-1?e.url.slice(0,t):e.url)!==this.options.path)return!1}return!0}handleUpgrade(e,t,n,i){t.on("error",YK);let o=e.headers["sec-websocket-key"]!==void 0?e.headers["sec-websocket-key"].trim():!1,s=+e.headers["sec-websocket-version"],a={};if(e.method!=="GET"||e.headers.upgrade.toLowerCase()!=="websocket"||!o||!Lfe.test(o)||s!==8&&s!==13||!this.shouldHandle(e))return XD(t,400);if(this.options.perMessageDeflate){let l=new Ym(this.options.perMessageDeflate,!0,this.options.maxPayload);try{let c=H$.parse(e.headers["sec-websocket-extensions"]);c[Ym.extensionName]&&(l.accept(c[Ym.extensionName]),a[Ym.extensionName]=l)}catch{return XD(t,400)}}if(this.options.verifyClient){let l={origin:e.headers[`${s===8?"sec-websocket-origin":"origin"}`],secure:!!(e.connection.authorized||e.connection.encrypted),req:e};if(this.options.verifyClient.length===2){this.options.verifyClient(l,(c,u,d,f)=>{if(!c)return XD(t,u||401,d,f);this.completeUpgrade(o,a,e,t,n,i)});return}if(!this.options.verifyClient(l))return XD(t,401)}this.completeUpgrade(o,a,e,t,n,i)}completeUpgrade(e,t,n,i,o,s){if(!i.readable||!i.writable)return i.destroy();let l=["HTTP/1.1 101 Switching Protocols","Upgrade: websocket","Connection: Upgrade",`Sec-WebSocket-Accept: ${Ofe.createHash("sha1").update(e+Ffe).digest("base64")}`],c=new Kfe(null);var u=n.headers["sec-websocket-protocol"];if(u&&(u=u.split(",").map(jfe),this.options.handleProtocols?u=this.options.handleProtocols(u,n):u=u[0],u&&(l.push(`Sec-WebSocket-Protocol: ${u}`),c.protocol=u)),t[Ym.extensionName]){let d=t[Ym.extensionName].params,f=H$.format({[Ym.extensionName]:[d]});l.push(`Sec-WebSocket-Extensions: ${f}`),c._extensions=t}this.emit("headers",l,n),i.write(l.concat(`\r
`).join(`\r
`)),i.removeListener("error",YK),c.setSocket(i,o,this.options.maxPayload),this.clients&&(this.clients.add(c),c.on("close",()=>this.clients.delete(c))),s(c)}};G$.exports=QK;function Ufe(r,e){for(let t of Object.keys(e))r.on(t,e[t]);return function(){for(let n of Object.keys(e))r.removeListener(n,e[n])}}function Wfe(r){r.emit("close")}function YK(){this.destroy()}function XD(r,e,t,n){r.writable&&(t=t||ZD.STATUS_CODES[e],n=Object.assign({Connection:"close","Content-type":"text/html","Content-Length":Buffer.byteLength(t)},n),r.write(`HTTP/1.1 ${e} ${ZD.STATUS_CODES[e]}\r
`+Object.keys(n).map(i=>`${i}: ${n[i]}`).join(`\r
`)+`\r
\r
`+t)),r.removeListener("error",YK),r.destroy()}function jfe(r){return r.trim()}});var Y$=M((v$e,Q$)=>{"use strict";var eT=zK();eT.Server=z$();eT.Receiver=qK();eT.Sender=$K();Q$.exports=eT});var Z$=M((y$e,X$)=>{"use strict";X$.exports=Y$()});var s5=M((oT,o5)=>{(function(r,e){typeof oT=="object"&&typeof o5<"u"?e(oT):typeof define=="function"&&define.amd?define(["exports"],e):(r=typeof globalThis<"u"?globalThis:r||self,e(r.lumino_algorithm={}))})(oT,function(r){"use strict";r.ArrayExt=void 0,function(F){function j(ne,he,B,q){B===void 0&&(B=0),q===void 0&&(q=-1);var ee=ne.length;if(ee===0)return-1;B<0?B=Math.max(0,B+ee):B=Math.min(B,ee-1),q<0?q=Math.max(0,q+ee):q=Math.min(q,ee-1);var De;q<B?De=q+1+(ee-B):De=q-B+1;for(var We=0;We<De;++We){var vr=(B+We)%ee;if(ne[vr]===he)return vr}return-1}F.firstIndexOf=j;function Ce(ne,he,B,q){B===void 0&&(B=-1),q===void 0&&(q=0);var ee=ne.length;if(ee===0)return-1;B<0?B=Math.max(0,B+ee):B=Math.min(B,ee-1),q<0?q=Math.max(0,q+ee):q=Math.min(q,ee-1);var De;B<q?De=B+1+(ee-q):De=B-q+1;for(var We=0;We<De;++We){var vr=(B-We+ee)%ee;if(ne[vr]===he)return vr}return-1}F.lastIndexOf=Ce;function Oe(ne,he,B,q){B===void 0&&(B=0),q===void 0&&(q=-1);var ee=ne.length;if(ee===0)return-1;B<0?B=Math.max(0,B+ee):B=Math.min(B,ee-1),q<0?q=Math.max(0,q+ee):q=Math.min(q,ee-1);var De;q<B?De=q+1+(ee-B):De=q-B+1;for(var We=0;We<De;++We){var vr=(B+We)%ee;if(he(ne[vr],vr))return vr}return-1}F.findFirstIndex=Oe;function st(ne,he,B,q){B===void 0&&(B=-1),q===void 0&&(q=0);var ee=ne.length;if(ee===0)return-1;B<0?B=Math.max(0,B+ee):B=Math.min(B,ee-1),q<0?q=Math.max(0,q+ee):q=Math.min(q,ee-1);var De;B<q?De=B+1+(ee-q):De=B-q+1;for(var We=0;We<De;++We){var vr=(B-We+ee)%ee;if(he(ne[vr],vr))return vr}return-1}F.findLastIndex=st;function pn(ne,he,B,q){B===void 0&&(B=0),q===void 0&&(q=-1);var ee=Oe(ne,he,B,q);return ee!==-1?ne[ee]:void 0}F.findFirstValue=pn;function zt(ne,he,B,q){B===void 0&&(B=-1),q===void 0&&(q=0);var ee=st(ne,he,B,q);return ee!==-1?ne[ee]:void 0}F.findLastValue=zt;function jt(ne,he,B,q,ee){q===void 0&&(q=0),ee===void 0&&(ee=-1);var De=ne.length;if(De===0)return 0;q<0?q=Math.max(0,q+De):q=Math.min(q,De-1),ee<0?ee=Math.max(0,ee+De):ee=Math.min(ee,De-1);for(var We=q,vr=ee-q+1;vr>0;){var Ni=vr>>1,Pc=We+Ni;B(ne[Pc],he)<0?(We=Pc+1,vr-=Ni+1):vr=Ni}return We}F.lowerBound=jt;function Ot(ne,he,B,q,ee){q===void 0&&(q=0),ee===void 0&&(ee=-1);var De=ne.length;if(De===0)return 0;q<0?q=Math.max(0,q+De):q=Math.min(q,De-1),ee<0?ee=Math.max(0,ee+De):ee=Math.min(ee,De-1);for(var We=q,vr=ee-q+1;vr>0;){var Ni=vr>>1,Pc=We+Ni;B(ne[Pc],he)>0?vr=Ni:(We=Pc+1,vr-=Ni+1)}return We}F.upperBound=Ot;function Ar(ne,he,B){if(ne===he)return!0;if(ne.length!==he.length)return!1;for(var q=0,ee=ne.length;q<ee;++q)if(B?!B(ne[q],he[q]):ne[q]!==he[q])return!1;return!0}F.shallowEqual=Ar;function Xr(ne,he){he===void 0&&(he={});var B=he.start,q=he.stop,ee=he.step;if(ee===void 0&&(ee=1),ee===0)throw new Error("Slice `step` cannot be zero.");var De=ne.length;B===void 0?B=ee<0?De-1:0:B<0?B=Math.max(B+De,ee<0?-1:0):B>=De&&(B=ee<0?De-1:De),q===void 0?q=ee<0?-1:De:q<0?q=Math.max(q+De,ee<0?-1:0):q>=De&&(q=ee<0?De-1:De);var We;ee<0&&q>=B||ee>0&&B>=q?We=0:ee<0?We=Math.floor((q-B+1)/ee+1):We=Math.floor((q-B-1)/ee+1);for(var vr=[],Ni=0;Ni<We;++Ni)vr[Ni]=ne[B+Ni*ee];return vr}F.slice=Xr;function Ur(ne,he,B){var q=ne.length;if(!(q<=1)&&(he<0?he=Math.max(0,he+q):he=Math.min(he,q-1),B<0?B=Math.max(0,B+q):B=Math.min(B,q-1),he!==B)){for(var ee=ne[he],De=he<B?1:-1,We=he;We!==B;We+=De)ne[We]=ne[We+De];ne[B]=ee}}F.move=Ur;function dn(ne,he,B){he===void 0&&(he=0),B===void 0&&(B=-1);var q=ne.length;if(!(q<=1))for(he<0?he=Math.max(0,he+q):he=Math.min(he,q-1),B<0?B=Math.max(0,B+q):B=Math.min(B,q-1);he<B;){var ee=ne[he],De=ne[B];ne[he++]=De,ne[B--]=ee}}F.reverse=dn;function $(ne,he,B,q){B===void 0&&(B=0),q===void 0&&(q=-1);var ee=ne.length;if(!(ee<=1)&&(B<0?B=Math.max(0,B+ee):B=Math.min(B,ee-1),q<0?q=Math.max(0,q+ee):q=Math.min(q,ee-1),!(B>=q))){var De=q-B+1;if(he>0?he=he%De:he<0&&(he=(he%De+De)%De),he!==0){var We=B+he;dn(ne,B,We-1),dn(ne,We,q),dn(ne,B,q)}}}F.rotate=$;function re(ne,he,B,q){B===void 0&&(B=0),q===void 0&&(q=-1);var ee=ne.length;if(ee!==0){B<0?B=Math.max(0,B+ee):B=Math.min(B,ee-1),q<0?q=Math.max(0,q+ee):q=Math.min(q,ee-1);var De;q<B?De=q+1+(ee-B):De=q-B+1;for(var We=0;We<De;++We)ne[(B+We)%ee]=he}}F.fill=re;function ve(ne,he,B){var q=ne.length;he<0?he=Math.max(0,he+q):he=Math.min(he,q);for(var ee=q;ee>he;--ee)ne[ee]=ne[ee-1];ne[he]=B}F.insert=ve;function ke(ne,he){var B=ne.length;if(he<0&&(he+=B),!(he<0||he>=B)){for(var q=ne[he],ee=he+1;ee<B;++ee)ne[ee-1]=ne[ee];return ne.length=B-1,q}}F.removeAt=ke;function Qe(ne,he,B,q){B===void 0&&(B=0),q===void 0&&(q=-1);var ee=j(ne,he,B,q);return ee!==-1&&ke(ne,ee),ee}F.removeFirstOf=Qe;function mn(ne,he,B,q){B===void 0&&(B=-1),q===void 0&&(q=0);var ee=Ce(ne,he,B,q);return ee!==-1&&ke(ne,ee),ee}F.removeLastOf=mn;function Pt(ne,he,B,q){B===void 0&&(B=0),q===void 0&&(q=-1);var ee=ne.length;if(ee===0)return 0;B<0?B=Math.max(0,B+ee):B=Math.min(B,ee-1),q<0?q=Math.max(0,q+ee):q=Math.min(q,ee-1);for(var De=0,We=0;We<ee;++We)B<=q&&We>=B&&We<=q&&ne[We]===he||q<B&&(We<=q||We>=B)&&ne[We]===he?De++:De>0&&(ne[We-De]=ne[We]);return De>0&&(ne.length=ee-De),De}F.removeAllOf=Pt;function _t(ne,he,B,q){B===void 0&&(B=0),q===void 0&&(q=-1);var ee,De=Oe(ne,he,B,q);return De!==-1&&(ee=ke(ne,De)),{index:De,value:ee}}F.removeFirstWhere=_t;function at(ne,he,B,q){B===void 0&&(B=-1),q===void 0&&(q=0);var ee,De=st(ne,he,B,q);return De!==-1&&(ee=ke(ne,De)),{index:De,value:ee}}F.removeLastWhere=at;function Lt(ne,he,B,q){B===void 0&&(B=0),q===void 0&&(q=-1);var ee=ne.length;if(ee===0)return 0;B<0?B=Math.max(0,B+ee):B=Math.min(B,ee-1),q<0?q=Math.max(0,q+ee):q=Math.min(q,ee-1);for(var De=0,We=0;We<ee;++We)B<=q&&We>=B&&We<=q&&he(ne[We],We)||q<B&&(We<=q||We>=B)&&he(ne[We],We)?De++:De>0&&(ne[We-De]=ne[We]);return De>0&&(ne.length=ee-De),De}F.removeAllWhere=Lt}(r.ArrayExt||(r.ArrayExt={}));function e(F){var j;return typeof F.iter=="function"?j=F.iter():j=new d(F),j}function t(F){return new f(F)}function n(F){return new h(F)}function i(F){return new v(F)}function o(F){return new S(F)}function s(F,j){for(var Ce=0,Oe=e(F),st;(st=Oe.next())!==void 0;)if(j(st,Ce++)===!1)return}function a(F,j){for(var Ce=0,Oe=e(F),st;(st=Oe.next())!==void 0;)if(!j(st,Ce++))return!1;return!0}function l(F,j){for(var Ce=0,Oe=e(F),st;(st=Oe.next())!==void 0;)if(j(st,Ce++))return!0;return!1}function c(F){for(var j=0,Ce=[],Oe=e(F),st;(st=Oe.next())!==void 0;)Ce[j++]=st;return Ce}function u(F){for(var j=e(F),Ce,Oe={};(Ce=j.next())!==void 0;)Oe[Ce[0]]=Ce[1];return Oe}var d=function(){function F(j){this._index=0,this._source=j}return F.prototype.iter=function(){return this},F.prototype.clone=function(){var j=new F(this._source);return j._index=this._index,j},F.prototype.next=function(){if(!(this._index>=this._source.length))return this._source[this._index++]},F}(),f=function(){function F(j,Ce){Ce===void 0&&(Ce=Object.keys(j)),this._index=0,this._source=j,this._keys=Ce}return F.prototype.iter=function(){return this},F.prototype.clone=function(){var j=new F(this._source,this._keys);return j._index=this._index,j},F.prototype.next=function(){if(!(this._index>=this._keys.length)){var j=this._keys[this._index++];return j in this._source?j:this.next()}},F}(),h=function(){function F(j,Ce){Ce===void 0&&(Ce=Object.keys(j)),this._index=0,this._source=j,this._keys=Ce}return F.prototype.iter=function(){return this},F.prototype.clone=function(){var j=new F(this._source,this._keys);return j._index=this._index,j},F.prototype.next=function(){if(!(this._index>=this._keys.length)){var j=this._keys[this._index++];return j in this._source?this._source[j]:this.next()}},F}(),v=function(){function F(j,Ce){Ce===void 0&&(Ce=Object.keys(j)),this._index=0,this._source=j,this._keys=Ce}return F.prototype.iter=function(){return this},F.prototype.clone=function(){var j=new F(this._source,this._keys);return j._index=this._index,j},F.prototype.next=function(){if(!(this._index>=this._keys.length)){var j=this._keys[this._index++];return j in this._source?[j,this._source[j]]:this.next()}},F}(),S=function(){function F(j){this._fn=j}return F.prototype.iter=function(){return this},F.prototype.clone=function(){throw new Error("An `FnIterator` cannot be cloned.")},F.prototype.next=function(){return this._fn.call(void 0)},F}();function b(){for(var F=[],j=0;j<arguments.length;j++)F[j]=arguments[j];return new D(e(F.map(e)))}var D=function(){function F(j){this._cloned=!1,this._source=j,this._active=void 0}return F.prototype.iter=function(){return this},F.prototype.clone=function(){var j=new F(this._source.clone());return j._active=this._active&&this._active.clone(),j._cloned=!0,this._cloned=!0,j},F.prototype.next=function(){if(this._active===void 0){var j=this._source.next();if(j===void 0)return;this._active=this._cloned?j.clone():j}var Ce=this._active.next();return Ce!==void 0?Ce:(this._active=void 0,this.next())},F}();function _(){return new L}var L=function(){function F(){}return F.prototype.iter=function(){return this},F.prototype.clone=function(){return new F},F.prototype.next=function(){},F}();function Z(F,j){return j===void 0&&(j=0),new Se(e(F),j)}var Se=function(){function F(j,Ce){this._source=j,this._index=Ce}return F.prototype.iter=function(){return this},F.prototype.clone=function(){return new F(this._source.clone(),this._index)},F.prototype.next=function(){var j=this._source.next();if(j!==void 0)return[this._index++,j]},F}();function ie(F,j){return new fe(e(F),j)}var fe=function(){function F(j,Ce){this._index=0,this._source=j,this._fn=Ce}return F.prototype.iter=function(){return this},F.prototype.clone=function(){var j=new F(this._source.clone(),this._fn);return j._index=this._index,j},F.prototype.next=function(){for(var j=this._fn,Ce=this._source,Oe;(Oe=Ce.next())!==void 0;)if(j(Oe,this._index++))return Oe},F}();function de(F,j){for(var Ce=0,Oe=e(F),st;(st=Oe.next())!==void 0;)if(j(st,Ce++))return st}function ae(F,j){for(var Ce=0,Oe=e(F),st;(st=Oe.next())!==void 0;)if(j(st,Ce++))return Ce-1;return-1}function Me(F,j){var Ce=e(F),Oe=Ce.next();if(Oe!==void 0){for(var st=Oe;(Oe=Ce.next())!==void 0;)j(Oe,st)<0&&(st=Oe);return st}}function Ge(F,j){var Ce=e(F),Oe=Ce.next();if(Oe!==void 0){for(var st=Oe;(Oe=Ce.next())!==void 0;)j(Oe,st)>0&&(st=Oe);return st}}function St(F,j){var Ce=e(F),Oe=Ce.next();if(Oe!==void 0){for(var st=Oe,pn=Oe;(Oe=Ce.next())!==void 0;)j(Oe,st)<0?st=Oe:j(Oe,pn)>0&&(pn=Oe);return[st,pn]}}function vt(F,j){return new ot(e(F),j)}var ot=function(){function F(j,Ce){this._index=0,this._source=j,this._fn=Ce}return F.prototype.iter=function(){return this},F.prototype.clone=function(){var j=new F(this._source.clone(),this._fn);return j._index=this._index,j},F.prototype.next=function(){var j=this._source.next();if(j!==void 0)return this._fn.call(void 0,j,this._index++)},F}();function oe(F,j,Ce){return j===void 0?new Pe(0,F,1):Ce===void 0?new Pe(F,j,1):new Pe(F,j,Ce)}var Pe=function(){function F(j,Ce,Oe){this._index=0,this._start=j,this._stop=Ce,this._step=Oe,this._length=Y.rangeLength(j,Ce,Oe)}return F.prototype.iter=function(){return this},F.prototype.clone=function(){var j=new F(this._start,this._stop,this._step);return j._index=this._index,j},F.prototype.next=function(){if(!(this._index>=this._length))return this._start+this._step*this._index++},F}(),Y;(function(F){function j(Ce,Oe,st){return st===0?1/0:Ce>Oe&&st>0||Ce<Oe&&st<0?0:Math.ceil((Oe-Ce)/st)}F.rangeLength=j})(Y||(Y={}));function be(F,j,Ce){var Oe=0,st=e(F),pn=st.next();if(pn===void 0&&Ce===void 0)throw new TypeError("Reduce of empty iterable with no initial value.");if(pn===void 0)return Ce;var zt=st.next();if(zt===void 0&&Ce===void 0)return pn;if(zt===void 0)return j(Ce,pn,Oe++);var jt;Ce===void 0?jt=j(pn,zt,Oe++):jt=j(j(Ce,pn,Oe++),zt,Oe++);for(var Ot;(Ot=st.next())!==void 0;)jt=j(jt,Ot,Oe++);return jt}function Je(F,j){return new kt(F,j)}function yn(F){return new kt(F,1)}var kt=function(){function F(j,Ce){this._value=j,this._count=Ce}return F.prototype.iter=function(){return this},F.prototype.clone=function(){return new F(this._value,this._count)},F.prototype.next=function(){if(!(this._count<=0))return this._count--,this._value},F}();function Yr(F){var j;return typeof F.retro=="function"?j=F.retro():j=new vs(F),j}var vs=function(){function F(j){this._source=j,this._index=j.length-1}return F.prototype.iter=function(){return this},F.prototype.clone=function(){var j=new F(this._source);return j._index=this._index,j},F.prototype.next=function(){if(!(this._index<0||this._index>=this._source.length))return this._source[this._index--]},F}();function qt(F){var j=[],Ce=new Set,Oe=new Map;return s(F,st),Oe.forEach(function(zt,jt){pn(jt)}),j;function st(zt){var jt=zt[0],Ot=zt[1],Ar=Oe.get(Ot);Ar?Ar.push(jt):Oe.set(Ot,[jt])}function pn(zt){if(!Ce.has(zt)){Ce.add(zt);var jt=Oe.get(zt);jt&&jt.forEach(pn),j.push(zt)}}}function un(F,j){return new Yi(e(F),j)}var Yi=function(){function F(j,Ce){this._source=j,this._step=Ce}return F.prototype.iter=function(){return this},F.prototype.clone=function(){return new F(this._source.clone(),this._step)},F.prototype.next=function(){for(var j=this._source.next(),Ce=this._step-1;Ce>0;--Ce)this._source.next();return j},F}();r.StringExt=void 0,function(F){function j(zt,jt,Ot){Ot===void 0&&(Ot=0);for(var Ar=new Array(jt.length),Xr=0,Ur=Ot,dn=jt.length;Xr<dn;++Xr,++Ur){if(Ur=zt.indexOf(jt[Xr],Ur),Ur===-1)return null;Ar[Xr]=Ur}return Ar}F.findIndices=j;function Ce(zt,jt,Ot){Ot===void 0&&(Ot=0);var Ar=j(zt,jt,Ot);if(!Ar)return null;for(var Xr=0,Ur=0,dn=Ar.length;Ur<dn;++Ur){var $=Ar[Ur]-Ot;Xr+=$*$}return{score:Xr,indices:Ar}}F.matchSumOfSquares=Ce;function Oe(zt,jt,Ot){Ot===void 0&&(Ot=0);var Ar=j(zt,jt,Ot);if(!Ar)return null;for(var Xr=0,Ur=Ot-1,dn=0,$=Ar.length;dn<$;++dn){var re=Ar[dn];Xr+=re-Ur-1,Ur=re}return{score:Xr,indices:Ar}}F.matchSumOfDeltas=Oe;function st(zt,jt,Ot){for(var Ar=[],Xr=0,Ur=0,dn=jt.length;Xr<dn;){for(var $=jt[Xr],re=jt[Xr];++Xr<dn&&jt[Xr]===re+1;)re++;Ur<$&&Ar.push(zt.slice(Ur,$)),$<re+1&&Ar.push(Ot(zt.slice($,re+1))),Ur=re+1}return Ur<zt.length&&Ar.push(zt.slice(Ur)),Ar}F.highlight=st;function pn(zt,jt){return zt<jt?-1:zt>jt?1:0}F.cmp=pn}(r.StringExt||(r.StringExt={}));function Mt(F,j){return new mr(e(F),j)}var mr=function(){function F(j,Ce){this._source=j,this._count=Ce}return F.prototype.iter=function(){return this},F.prototype.clone=function(){return new F(this._source.clone(),this._count)},F.prototype.next=function(){if(!(this._count<=0)){var j=this._source.next();if(j!==void 0)return this._count--,j}},F}();function mi(){for(var F=[],j=0;j<arguments.length;j++)F[j]=arguments[j];return new kc(F.map(e))}var kc=function(){function F(j){this._source=j}return F.prototype.iter=function(){return this},F.prototype.clone=function(){return new F(this._source.map(function(j){return j.clone()}))},F.prototype.next=function(){for(var j=new Array(this._source.length),Ce=0,Oe=this._source.length;Ce<Oe;++Ce){var st=this._source[Ce].next();if(st===void 0)return;j[Ce]=st}return j},F}();r.ArrayIterator=d,r.ChainIterator=D,r.EmptyIterator=L,r.EnumerateIterator=Se,r.FilterIterator=fe,r.FnIterator=S,r.ItemIterator=v,r.KeyIterator=f,r.MapIterator=ot,r.RangeIterator=Pe,r.RepeatIterator=kt,r.RetroArrayIterator=vs,r.StrideIterator=Yi,r.TakeIterator=mr,r.ValueIterator=h,r.ZipIterator=kc,r.chain=b,r.each=s,r.empty=_,r.enumerate=Z,r.every=a,r.filter=ie,r.find=de,r.findIndex=ae,r.iter=e,r.iterFn=o,r.iterItems=i,r.iterKeys=t,r.iterValues=n,r.map=vt,r.max=Ge,r.min=Me,r.minmax=St,r.once=yn,r.range=oe,r.reduce=be,r.repeat=Je,r.retro=Yr,r.some=l,r.stride=un,r.take=Mt,r.toArray=c,r.toObject=u,r.topologicSort=qt,r.zip=mi,Object.defineProperty(r,"__esModule",{value:!0})})});var l5=M((sT,a5)=>{(function(r,e){typeof sT=="object"&&typeof a5<"u"?e(sT):typeof define=="function"&&define.amd?define(["exports"],e):(r=typeof globalThis<"u"?globalThis:r||self,e(r.lumino_properties={}))})(sT,function(r){"use strict";r.AttachedProperty=function(){function t(n){this._pid=e.nextPID(),this.name=n.name,this._create=n.create,this._coerce=n.coerce||null,this._compare=n.compare||null,this._changed=n.changed||null}return t.prototype.get=function(n){var i,o=e.ensureMap(n);return this._pid in o?i=o[this._pid]:i=o[this._pid]=this._createValue(n),i},t.prototype.set=function(n,i){var o,s=e.ensureMap(n);this._pid in s?o=s[this._pid]:o=s[this._pid]=this._createValue(n);var a=this._coerceValue(n,i);this._maybeNotify(n,o,s[this._pid]=a)},t.prototype.coerce=function(n){var i,o=e.ensureMap(n);this._pid in o?i=o[this._pid]:i=o[this._pid]=this._createValue(n);var s=this._coerceValue(n,i);this._maybeNotify(n,i,o[this._pid]=s)},t.prototype._createValue=function(n){var i=this._create;return i(n)},t.prototype._coerceValue=function(n,i){var o=this._coerce;return o?o(n,i):i},t.prototype._compareValue=function(n,i){var o=this._compare;return o?o(n,i):n===i},t.prototype._maybeNotify=function(n,i,o){var s=this._changed;s&&!this._compareValue(i,o)&&s(n,i,o)},t}(),function(t){function n(i){e.ownerData.delete(i)}t.clearData=n}(r.AttachedProperty||(r.AttachedProperty={}));var e;(function(t){t.ownerData=new WeakMap,t.nextPID=function(){var i=0;return function(){var o=Math.random(),s=(""+o).slice(2);return"pid-"+s+"-"+i++}}();function n(i){var o=t.ownerData.get(i);return o||(o=Object.create(null),t.ownerData.set(i,o),o)}t.ensureMap=n})(e||(e={})),Object.defineProperty(r,"__esModule",{value:!0})})});var lT=M((aT,c5)=>{(function(r,e){typeof aT=="object"&&typeof c5<"u"?e(aT,s5(),l5()):typeof define=="function"&&define.amd?define(["exports","@lumino/algorithm","@lumino/properties"],e):(r=typeof globalThis<"u"?globalThis:r||self,e(r.lumino_signaling={},r.lumino_algorithm,r.lumino_properties))})(aT,function(r,e,t){"use strict";r.Signal=function(){function i(o){this._blockedCount=0,this.sender=o}return i.prototype.block=function(o){this._blockedCount++;try{o()}finally{this._blockedCount--}},i.prototype.connect=function(o,s){return n.connect(this,o,s)},i.prototype.disconnect=function(o,s){return n.disconnect(this,o,s)},i.prototype.emit=function(o){this._blockedCount||n.emit(this,o)},i}(),function(i){function o(h,v){var S=n.blockedProperty;S.set(h,S.get(h)+1);try{v()}finally{S.set(h,S.get(h)-1)}}i.blockAll=o;function s(h,v){n.disconnectBetween(h,v)}i.disconnectBetween=s;function a(h){n.disconnectSender(h)}i.disconnectSender=a;function l(h){n.disconnectReceiver(h)}i.disconnectReceiver=l;function c(h){n.disconnectAll(h)}i.disconnectAll=c;function u(h){n.disconnectAll(h)}i.clearData=u;function d(){return n.exceptionHandler}i.getExceptionHandler=d;function f(h){var v=n.exceptionHandler;return n.exceptionHandler=h,v}i.setExceptionHandler=f}(r.Signal||(r.Signal={}));var n;(function(i){i.exceptionHandler=function(ie){console.error(ie)};function o(ie,fe,de){de=de||void 0;var ae=f.get(ie.sender);if(ae||(ae=[],f.set(ie.sender,ae)),b(ae,ie,fe,de))return!1;var Me=de||fe,Ge=h.get(Me);Ge||(Ge=[],h.set(Me,Ge));var St={signal:ie,slot:fe,thisArg:de};return ae.push(St),Ge.push(St),!0}i.connect=o;function s(ie,fe,de){de=de||void 0;var ae=f.get(ie.sender);if(!ae||ae.length===0)return!1;var Me=b(ae,ie,fe,de);if(!Me)return!1;var Ge=de||fe,St=h.get(Ge);return Me.signal=null,_(ae),_(St),!0}i.disconnect=s;function a(ie,fe){var de=f.get(ie);if(!(!de||de.length===0)){var ae=h.get(fe);!ae||ae.length===0||(e.each(ae,function(Me){Me.signal&&Me.signal.sender===ie&&(Me.signal=null)}),_(de),_(ae))}}i.disconnectBetween=a;function l(ie){var fe=f.get(ie);!fe||fe.length===0||(e.each(fe,function(de){if(de.signal){var ae=de.thisArg||de.slot;de.signal=null,_(h.get(ae))}}),_(fe))}i.disconnectSender=l;function c(ie){var fe=h.get(ie);!fe||fe.length===0||(e.each(fe,function(de){if(de.signal){var ae=de.signal.sender;de.signal=null,_(f.get(ae))}}),_(fe))}i.disconnectReceiver=c;function u(ie){l(ie),c(ie)}i.disconnectAll=u;function d(ie,fe){if(!(i.blockedProperty.get(ie.sender)>0)){var de=f.get(ie.sender);if(!(!de||de.length===0))for(var ae=0,Me=de.length;ae<Me;++ae){var Ge=de[ae];Ge.signal===ie&&D(Ge,fe)}}}i.emit=d;var f=new WeakMap,h=new WeakMap,v=new Set,S=function(){var ie=typeof requestAnimationFrame=="function";return ie?requestAnimationFrame:setImmediate}();function b(ie,fe,de,ae){return e.find(ie,function(Me){return Me.signal===fe&&Me.slot===de&&Me.thisArg===ae})}function D(ie,fe){var de=ie.signal,ae=ie.slot,Me=ie.thisArg;try{ae.call(Me,de.sender,fe)}catch(Ge){i.exceptionHandler(Ge)}}function _(ie){v.size===0&&S(L),v.add(ie)}function L(){v.forEach(Z),v.clear()}function Z(ie){e.ArrayExt.removeAllWhere(ie,Se)}function Se(ie){return ie.signal===null}i.blockedProperty=new t.AttachedProperty({name:"blocked",create:function(){return 0}})})(n||(n={})),Object.defineProperty(r,"__esModule",{value:!0})})});var b5=M((EYe,y5)=>{"use strict";y5.exports=({onlyFirst:r=!1}={})=>{let e=["[\\u001B\\u009B][[\\]()#;?]*(?:(?:(?:(?:;[-a-zA-Z\\d\\/#&.:=?%@~_]+)*|[a-zA-Z\\d]+(?:;[-a-zA-Z\\d\\/#&.:=?%@~_]*)*)?\\u0007)","(?:(?:\\d{1,4}(?:;\\d{0,4})*)?[\\dA-PR-TZcf-ntqry=><~]))"].join("|");return new RegExp(e,r?void 0:"g")}});var dF=M((_tt,A5)=>{"use strict";var fhe=require("child_process").spawn;function hhe(r){if(r){r=r.trim();var e=/your \d+x\d+ screen size is bogus\. expect trouble/gi;return r=r.replace(e,""),r.trim()}}function ghe(r,e,t,n){typeof t=="function"&&(n=t,t=void 0);var i=!1,o=fhe(r,e,t),s="",a="";o.stdout.on("data",function(l){s+=l.toString()}),o.stderr.on("data",function(l){a+=l.toString()}),o.on("error",function(l){i||(i=!0,n(new Error(l)))}),o.on("close",function(l){if(!i){if(i=!0,a=hhe(a),a)return n(new Error(a));n(null,s,l)}})}A5.exports=ghe});var O5=M((Rtt,M5)=>{"use strict";var vhe=require("os"),yhe=dF();function bhe(r){var e=["-A","-o","ppid,pid"];yhe("ps",e,function(t,n,i){if(t)return r(t);if(i!==0)return r(new Error("pidtree ps command exited with code "+i));try{n=n.split(vhe.EOL);for(var o=[],s=1;s<n.length;s++)n[s]=n[s].trim(),n[s]&&(n[s]=n[s].split(/\s+/),n[s][0]=parseInt(n[s][0],10),n[s][1]=parseInt(n[s][1],10),o.push(n[s]));r(null,o)}catch(a){r(a)}})}M5.exports=bhe});var F5=M((Ntt,K5)=>{"use strict";var Ihe=require("os"),She=dF();function xhe(r){var e=["PROCESS","get","ParentProcessId,ProcessId"],t={windowsHide:!0,windowsVerbatimArguments:!0};She("wmic",e,t,function(n,i,o){if(n){r(n);return}if(o!==0){r(new Error("pidtree wmic command exited with code "+o));return}try{i=i.split(Ihe.EOL);for(var s=[],a=1;a<i.length;a++)i[a]=i[a].trim(),i[a]&&(i[a]=i[a].split(/\s+/),i[a][0]=parseInt(i[a][0],10),i[a][1]=parseInt(i[a][1],10),s.push(i[a]));r(null,s)}catch(l){r(l)}})}K5.exports=xhe});var j5=M((Att,W5)=>{"use strict";var U5=require("os"),Che={darwin:"ps",sunos:"ps",freebsd:"ps",netbsd:"ps",win:"wmic",linux:"ps",aix:"ps"},Ehe={ps:()=>O5(),wmic:()=>F5()},mF=U5.platform();mF.startsWith("win")&&(mF="win");var L5=Che[mF];function whe(r){L5===void 0&&r(new Error(U5.platform()+" is not supported yet, please open an issue (https://github.com/simonepri/pidtree)"));var e=Ehe[L5]();e(r)}W5.exports=whe});var B5=M((Mtt,V5)=>{"use strict";var khe=j5();function Phe(r,e,t){if(typeof e=="function"&&(t=e,e={}),typeof e!="object"&&(e={}),r=parseInt(r,10),isNaN(r)||r<-1){t(new TypeError("The pid provided is invalid"));return}khe(function(n,i){if(n){t(n);return}if(r===-1){for(var o=0;o<i.length;o++)i[o]=e.advanced?{ppid:i[o][0],pid:i[o][1]}:i[o]=i[o][1];t(null,i);return}for(var s,a=0;a<i.length;a++){if(i[a][1]===r){s=e.advanced?{ppid:i[a][0],pid:r}:r;break}i[a][0]===r&&(s=e.advanced?{pid:r}:r)}if(!s){t(new Error("No matching pid found"));return}for(var l={};i.length>0;){var c=i.pop();l[c[0]]?l[c[0]].push(c[1]):l[c[0]]=[c[1]]}for(var u=0,d=[s];u<d.length;){var f=e.advanced?d[u++].pid:d[u++];if(l[f]){for(var h=l[f].length,v=0;v<h;v++)d.push(e.advanced?{ppid:f,pid:l[f][v]}:l[f][v]);delete l[f]}}e.root||d.shift(),t(null,d)})}V5.exports=Phe});var $5=M((Ott,J5)=>{"use strict";function Dhe(r,e,t){return new Promise(function(n,i){r(e,t,function(o,s){if(o)return i(o);n(s)})})}String.prototype.startsWith||(String.prototype.startsWith=function(r){return this.substring(0,r.length)===r});var q5=B5();function The(r,e,t){if(typeof e=="function"&&(t=e,e=void 0),typeof t=="function"){q5(r,e,t);return}return Dhe(q5,r,e)}J5.exports=The});var eH=M((Ktt,Z5)=>{var H5=Array.prototype.slice,G5=typeof Object.keys=="function"?Object.keys:function(r){var e=[];for(var t in r)e.push(t);return e},z5=Z5.exports=function(r,e){return r===0&&e===0?_he(r,e):r===e?!0:r instanceof Date&&e instanceof Date?r.getTime()===e.getTime():X5(r)?X5(e):typeof r!="object"&&typeof e!="object"?r==e:Rhe(r,e)};function Q5(r){return r==null}function Y5(r){return Object.prototype.toString.call(r)=="[object Arguments]"}function X5(r){return typeof r=="number"&&r!==r}function _he(r,e){return 1/r===1/e}function Rhe(r,e){if(Q5(r)||Q5(e)||r.prototype!==e.prototype)return!1;if(Y5(r))return Y5(e)?(r=H5.call(r),e=H5.call(e),z5(r,e)):!1;try{var t=G5(r),n=G5(e),i,o}catch{return!1}if(t.length!=n.length)return!1;for(t.sort(),n.sort(),o=t.length-1;o>=0;o--)if(t[o]!=n[o])return!1;for(o=t.length-1;o>=0;o--)if(i=t[o],!z5(r[i],e[i]))return!1;return!0}});var nH=M((Ftt,rH)=>{"use strict";var tH="[a-fA-F\\d:]",ud=r=>r&&r.includeBoundaries?`(?:(?<=\\s|^)(?=${tH})|(?<=${tH})(?=\\s|$))`:"",Wa="(?:25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]\\d|\\d)(?:\\.(?:25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]\\d|\\d)){3}",Wn="[a-fA-F\\d]{1,4}",FT=`
(?:
(?:${Wn}:){7}(?:${Wn}|:)|                                    // 1:2:3:4:5:6:7::  1:2:3:4:5:6:7:8
(?:${Wn}:){6}(?:${Wa}|:${Wn}|:)|                             // 1:2:3:4:5:6::    1:2:3:4:5:6::8   1:2:3:4:5:6::8  1:2:3:4:5:6::1.2.3.4
(?:${Wn}:){5}(?::${Wa}|(?::${Wn}){1,2}|:)|                   // 1:2:3:4:5::      1:2:3:4:5::7:8   1:2:3:4:5::8    1:2:3:4:5::7:1.2.3.4
(?:${Wn}:){4}(?:(?::${Wn}){0,1}:${Wa}|(?::${Wn}){1,3}|:)| // 1:2:3:4::        1:2:3:4::6:7:8   1:2:3:4::8      1:2:3:4::6:7:1.2.3.4
(?:${Wn}:){3}(?:(?::${Wn}){0,2}:${Wa}|(?::${Wn}){1,4}|:)| // 1:2:3::          1:2:3::5:6:7:8   1:2:3::8        1:2:3::5:6:7:1.2.3.4
(?:${Wn}:){2}(?:(?::${Wn}){0,3}:${Wa}|(?::${Wn}){1,5}|:)| // 1:2::            1:2::4:5:6:7:8   1:2::8          1:2::4:5:6:7:1.2.3.4
(?:${Wn}:){1}(?:(?::${Wn}){0,4}:${Wa}|(?::${Wn}){1,6}|:)| // 1::              1::3:4:5:6:7:8   1::8            1::3:4:5:6:7:1.2.3.4
(?::(?:(?::${Wn}){0,5}:${Wa}|(?::${Wn}){1,7}|:))             // ::2:3:4:5:6:7:8  ::2:3:4:5:6:7:8  ::8             ::1.2.3.4
)(?:%[0-9a-zA-Z]{1,})?                                             // %eth0            %1
`.replace(/\s*\/\/.*$/gm,"").replace(/\n/g,"").trim(),Nhe=new RegExp(`(?:^${Wa}$)|(?:^${FT}$)`),Ahe=new RegExp(`^${Wa}$`),Mhe=new RegExp(`^${FT}$`),fF=r=>r&&r.exact?Nhe:new RegExp(`(?:${ud(r)}${Wa}${ud(r)})|(?:${ud(r)}${FT}${ud(r)})`,"g");fF.v4=r=>r&&r.exact?Ahe:new RegExp(`${ud(r)}${Wa}${ud(r)}`,"g");fF.v6=r=>r&&r.exact?Mhe:new RegExp(`${ud(r)}${FT}${ud(r)}`,"g");rH.exports=fF});var iH=M((Ltt,Ohe)=>{Ohe.exports={name:"is2",version:"2.0.7",description:"A type checking library where each exported function returns either true or false and does not throw. Also added tests.",license:"MIT",tags:["type","check","checker","checking","utilities","network","networking","credit","card","validation"],keywords:["type","check","checker","checking","utilities","network","networking","credit","card","validation"],author:"Enrico Marino <enrico.marino@email.com>",maintainers:"Edmond Meinfelder <edmond@stdarg.com>, Chris Oyler <christopher.oyler@gmail.com>",homepage:"http://github.com/stdarg/is2",repository:{type:"git",url:"git@github.com:stdarg/is2.git"},bugs:{url:"http://github.com/stdarg/is/issues"},main:"./index.js",scripts:{test:"./node_modules/.bin/mocha -C --reporter list tests.js"},engines:{node:">=v0.10.0"},dependencies:{"deep-is":"^0.1.3","ip-regex":"^4.1.0","is-url":"^1.2.4"},devDependencies:{mocha:"6.1.4",mongodb:"3.2.4"}}});var sH=M((Utt,oH)=>{oH.exports=Uhe;var Khe=/^(?:\w+:)?\/\/(\S+)$/,Fhe=/^localhost[\:?\d]*(?:[^\:?\d]\S*)?$/,Lhe=/^[^\s\.]+\.\S{2,}$/;function Uhe(r){if(typeof r!="string")return!1;var e=r.match(Khe);if(!e)return!1;var t=e[1];return t?!!(Fhe.test(t)||Lhe.test(t)):!1}});var cH=M(lH=>{"use strict";var aH={}.hasOwnProperty,Cr={}.toString,x=lH,Whe=eH(),jhe=nH();x.version=iH().version;x.browser=function(){return!x.node()&&typeof window<"u"&&Cr.call(window)==="[object global]"};x.defined=function(r){return typeof r<"u"};x.def=x.defined;x.nodejs=function(){return process&&process.hasOwnProperty("version")&&process.hasOwnProperty("versions")};x.node=x.nodejs;x.undefined=function(r){return r===void 0};x.udef=x.undef=x.undefined;x.array=function(r){return Cr.call(r)==="[object Array]"};x.arr=x.ary=x.arry=x.array;x.arrayLike=function(r){return x.nullOrUndef(r)?!1:r!==void 0&&aH.call(r,"length")&&isFinite(r.length)};x.arrLike=x.arryLike=x.aryLike=x.arraylike=x.arrayLike;x.arguments=function(r){return Cr.call(r)==="[object Arguments]"};x.args=x.arguments;x.boolean=function(r){return Cr.call(r)==="[object Boolean]"};x.bool=x.boolean;x.buffer=function(r){return x.nodejs()&&Buffer&&Buffer.hasOwnProperty("isBuffer")&&Buffer.isBuffer(r)};x.buff=x.buf=x.buffer;x.date=function(r){return Cr.call(r)==="[object Date]"};x.error=function(r){return Cr.call(r)==="[object Error]"};x.err=x.error;x.false=function(r){return r===!1};x.function=function(r){return x.syncFunction(r)||x.asyncFunction(r)};x.fun=x.func=x.function;x.asyncFunction=function(r){return Cr.call(r)==="[object AsyncFunction]"};x.asyncFun=x.asyncFunc=x.asyncFunction;x.syncFunction=function(r){return Cr.call(r)==="[object Function]"};x.syncFun=x.syncFunc=x.syncFunction;x.null=function(r){return r===null};x.nullOrUndefined=function(r){return r===null||typeof r>"u"};x.nullOrUndef=x.nullOrUndefined;x.number=function(r){return Cr.call(r)==="[object Number]"};x.num=x.number;x.object=function(r){return Cr.call(r)==="[object Object]"};x.obj=x.object;x.regExp=function(r){return Cr.call(r)==="[object RegExp]"};x.re=x.regexp=x.regExp;x.string=function(r){return Cr.call(r)==="[object String]"};x.str=x.string;x.true=function(r){return r===!0};var Vhe=new RegExp("[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}","i");x.uuid=function(r){return Vhe.test(r)};x.equal=function(r,e){var t=Cr.call(r);return typeof r!=typeof e||t!==Cr.call(e)?!1:t==="[object Object]"||t==="[object Array]"?Whe(r,e):t==="[object Function]"?r.prototype===e.prototype:t==="[object Date]"?r.getTime()===e.getTime():r===e};x.objEquals=x.eq=x.equal;var Bhe={boolean:1,number:1,string:1,undefined:1};x.hosted=function(r,e){if(x.nullOrUndef(r))return!1;var t=typeof e[r];return t==="object"?!!e[r]:!Bhe[t]};x.instanceOf=function(r,e){return x.nullOrUndef(r)||x.nullOrUndef(e)?!1:r instanceof e};x.instOf=x.instanceof=x.instanceOf;x.objectInstanceOf=function(r,e){try{return Cr.call(r)==="[object Object]"&&r instanceof e}catch{return!1}};x.instOf=x.instanceOf=x.objInstOf=x.objectInstanceOf;x.type=function(r,e){return typeof r===e};x.a=x.type;x.empty=function(r){var e=Cr.call(r);if(e==="[object Array]"||e==="[object Arguments]")return r.length===0;if(e==="[object Object]"){for(var t in r)if(aH.call(r,t))return!1;return!0}return e==="[object String]"?r==="":!1};x.emptyArguments=function(r){return Cr.call(r)==="[object Arguments]"&&r.length===0};x.noArgs=x.emptyArgs=x.emptyArguments;x.emptyArray=function(r){return Cr.call(r)==="[object Array]"&&r.length===0};x.emptyArry=x.emptyAry=x.emptyArray;x.emptyArrayLike=function(r){return r.length===0};x.emptyArrLike=x.emptyArrayLike;x.emptyString=function(r){return x.string(r)&&r.length===0};x.emptyStr=x.emptyString;x.nonEmptyArray=function(r){return Cr.call(r)==="[object Array]"&&r.length>0};x.nonEmptyArr=x.nonEmptyArry=x.nonEmptyAry=x.nonEmptyArray;x.nonEmptyObject=function(r){return Cr.call(r)==="[object Object]"&&Object.keys(r).length>0};x.nonEmptyObj=x.nonEmptyObject;x.emptyObject=function(r){return Cr.call(r)==="[object Object]"&&Object.keys(r).length===0};x.emptyObj=x.emptyObject;x.nonEmptyString=function(r){return x.string(r)&&r.length>0};x.nonEmptyStr=x.nonEmptyString;x.even=function(r){return Cr.call(r)==="[object Number]"&&r%2===0};x.decimal=function(r){return Cr.call(r)==="[object Number]"&&r%1!==0};x.dec=x.decNum=x.decimal;x.integer=function(r){return Cr.call(r)==="[object Number]"&&r%1===0};x.int=x.integer;x.notANumber=function(r){return!x.num(r)||r!==r};x.nan=x.notANum=x.notANumber;x.odd=function(r){return!x.decimal(r)&&Cr.call(r)==="[object Number]"&&r%2!==0};x.oddNumber=x.oddNum=x.odd;x.positiveNumber=function(r){return Cr.call(r)==="[object Number]"&&r>0};x.pos=x.positive=x.posNum=x.positiveNum=x.positiveNumber;x.negativeNumber=function(r){return Cr.call(r)==="[object Number]"&&r<0};x.neg=x.negNum=x.negativeNum=x.negativeNumber;x.negativeInteger=function(r){return Cr.call(r)==="[object Number]"&&r%1===0&&r<0};x.negativeInt=x.negInt=x.negativeInteger;x.positiveInteger=function(r){return Cr.call(r)==="[object Number]"&&r%1===0&&r>0};x.posInt=x.positiveInt=x.positiveInteger;x.divisibleBy=function(r,e){return r===0?!1:Cr.call(r)==="[object Number]"&&e!==0&&r%e===0};x.divBy=x.divisBy=x.divisibleBy;x.greaterOrEqualTo=function(r,e){return r>=e};x.greaterOrEqual=x.ge=x.greaterOrEqualTo;x.greaterThan=function(r,e){return r>e};x.gt=x.greaterThan;x.lessThanOrEqualTo=function(r,e){return r<=e};x.lessThanOrEq=x.lessThanOrEqual=x.le=x.lessThanOrEqualTo;x.lessThan=function(r,e){return r<e};x.lt=x.lessThan;x.maximum=function(r,e){if(!x.arrayLike(e)||!x.number(r))return!1;for(var t=e.length;--t>-1;)if(r<e[t])return!1;return!0};x.max=x.maximum;x.minimum=function(r,e){if(!x.arrayLike(e)||!x.number(r))return!1;for(var t=e.length;--t>-1;)if(r>e[t])return!1;return!0};x.min=x.minimum;x.within=function(r,e,t){return r>=e&&r<=t};x.withIn=x.within;x.prettyClose=function(r,e,t){return!x.number(r)||!x.number(e)||x.defined(t)&&!x.posInt(t)?!1:(x.undefined(t)&&(t=2),r.toFixed(t)===e.toFixed(t))};x.closish=x.near=x.prettyClose;x.dnsAddress=function(r){return!(!x.nonEmptyStr(r)||r.length>255||Jhe.test(r)||!qhe.test(r))};x.dnsAddr=x.dns=x.dnsAddress;var qhe=/^([a-zA-Z0-9]|[a-zA-Z0-9][a-zA-Z0-9\-]{0,61}[a-zA-Z0-9])(\.([a-zA-Z0-9]|[a-zA-Z0-9][a-zA-Z0-9\-]{0,61}[a-zA-Z0-9]))*$/,Jhe=/^([0-9]|[0-9][0-9\-]{0,61}[0-9])(\.([0-9]|[0-9][0-9\-]{0,61}[0-9]))*$/;x.emailAddress=function(r){return x.nonEmptyStr(r)?$he.test(r):!1};x.email=x.emailAddr=x.emailAddress;var $he=/^([^\x00-\x20\x22\x28\x29\x2c\x2e\x3a-\x3c\x3e\x40\x5b-\x5d\x7f-\xff]+|\x22([^\x0d\x22\x5c\x80-\xff]|\x5c[\x00-\x7f])*\x22)(\x2e([^\x00-\x20\x22\x28\x29\x2c\x2e\x3a-\x3c\x3e\x40\x5b-\x5d\x7f-\xff]+|\x22([^\x0d\x22\x5c\x80-\xff]|\x5c[\x00-\x7f])*\x22))*\x40([^\x00-\x20\x22\x28\x29\x2c\x2e\x3a-\x3c\x3e\x40\x5b-\x5d\x7f-\xff]+|\x5b([^\x0d\x5b-\x5d\x80-\xff]|\x5c[\x00-\x7f])*\x5d)(\x2e([^\x00-\x20\x22\x28\x29\x2c\x2e\x3a-\x3c\x3e\x40\x5b-\x5d\x7f-\xff]+|\x5b([^\x0d\x5b-\x5d\x80-\xff]|\x5c[\x00-\x7f])*\x5d))*$/;x.ipv4Address=function(r){if(!x.nonEmptyStr(r)||r.length>15)return!1;var e=r.split(".");if(!x.array(e)||e.length!==4)return!1;for(var t=0;t<e.length;t++){var n=parseInt(e[t],10);if(isNaN(n)||n<0||n>255)return!1}return!0};x.ipv4=x.ipv4Addr=x.ipv4Address;x.ipv6Address=function(r){return x.nonEmptyStr(r)?jhe.v6({extract:!0}).test(r):!1};x.ipv6=x.ipv6Addr=x.ipv6Address;x.ipAddress=function(r){return x.nonEmptyStr(r)?x.ipv4Address(r)||x.ipv6Address(r):!1};x.ip=x.ipAddr=x.ipAddress;x.hostAddress=function(r){return x.nonEmptyStr(r)?x.dns(r)||x.ipv4(r)||x.ipv6(r):!1};x.host=x.hostIp=x.hostAddr=x.hostAddress;x.port=function(r){return!(!x.num(r)||x.negativeInt(r)||r>65535)};x.systemPort=function(r){return!!(x.port(r)&&r<1024)};x.sysPort=x.systemPort;x.userPort=function(r){return!!(x.port(r)&&r>1023)};x.creditCardNumber=function(r){if(!x.str(r))return!1;var e=r.split(""),t,n;for(t=e.length-1,n=1;t>-1;t--,n++)n%2===0&&(e[t]*=2);r=e.join("");var i=0;for(t=0;t<r.length;t++)i+=Math.floor(r[t]);return i%10===0};x.creditCard=x.creditCardNum=x.creditCardNumber;x.americanExpressCardNumber=function(r){if(!x.str(r)||r.length!==15)return!1;var e=Math.floor(r.slice(0,2));return!(e!==34&&e!==37||!x.creditCardNumber(r))};x.amexCard=x.amexCardNum=x.americanExpressCardNumber;x.chinaUnionPayCardNumber=function(r){if(!x.str(r)||r.length<16&&r.length>19)return!1;var e=Math.floor(r.slice(0,2));return!(e!==62&&e!==88)};x.chinaUnion=x.chinaUnionPayCard=x.chinaUnionPayCardNumber;x.dinersClubCarteBlancheCardNumber=function(r){if(!x.str(r)||r.length!==14)return!1;var e=Math.floor(r.slice(0,3));return!(e<300||e>305||!x.creditCardNumber(r))};x.dinersClubCB=x.dinersClubCarteBlancheCard=x.dinersClubCarteBlancheCardNumber;x.dinersClubInternationalCardNumber=function(r){if(!x.str(r)||r.length!==14)return!1;var e=Math.floor(r.slice(0,3)),t=Math.floor(r.slice(0,2));return!((e<300||e>305)&&e!==309&&t!==36&&(t<38||t>39)||!x.creditCardNumber(r))};x.dinersClubInt=x.dinersClubInternationalCard=x.dinersClubInternationalCardNumber;x.dinersClubUSACanadaCardNumber=function(r){if(!x.str(r)||r.length!==16)return!1;var e=Math.floor(r.slice(0,2));return!(e!==54&&e!==55||!x.creditCardNumber(r))};x.dinersClub=x.dinersClubUSACanCard=x.dinersClubUSACanadaCardNumber;x.discoverCardNumber=function(r){if(!x.str(r)||r.length!==16)return!1;var e=Math.floor(r.slice(0,6)),t=Math.floor(r.slice(0,3));return!(r.slice(0,4)!=="6011"&&(e<622126||e>622925)&&(t<644||t>649)&&r.slice(0,2)!=="65"||!x.creditCardNumber(r))};x.discover=x.discoverCard=x.discoverCardNumber;x.instaPaymentCardNumber=function(r){if(!x.str(r)||r.length!==16)return!1;var e=Math.floor(r.slice(0,3));return!(e<637||e>639||!x.creditCardNumber(r))};x.instaPayment=x.instaPaymentCardNumber;x.jcbCardNumber=function(r){if(!x.str(r)||r.length!==16)return!1;var e=Math.floor(r.slice(0,4));return!(e<3528||e>3589||!x.creditCardNumber(r))};x.jcb=x.jcbCard=x.jcbCardNumber;x.laserCardNumber=function(r){if(!x.str(r)||r.length<16&&r.length>19)return!1;var e=Math.floor(r.slice(0,4)),t=[6304,6706,6771,6709];return!(t.indexOf(e)===-1||!x.creditCardNumber(r))};x.laser=x.laserCard=x.laserCardNumber;x.maestroCardNumber=function(r){if(!x.str(r)||r.length<12||r.length>19)return!1;var e=r.slice(0,4),t=["5018","5020","5038","5612","5893","6304","6759","6761","6762","6763","0604","6390"];return!(t.indexOf(e)===-1||!x.creditCardNumber(r))};x.maestro=x.maestroCard=x.maestroCardNumber;x.dankortCardNumber=function(r){return!(!x.str(r)||r.length!==16||r.slice(0,4)!=="5019"||!x.creditCardNumber(r))};x.dankort=x.dankortCard=x.dankortCardNumber;x.masterCardCardNumber=function(r){if(!x.str(r)||r.length!==16)return!1;var e=Math.floor(r.slice(0,2));return!(e<50||e>55||!x.creditCardNumber(r))};x.masterCard=x.masterCardCard=x.masterCardCardNumber;x.visaCardNumber=function(r){return!(!x.str(r)||r.length!==13&&r.length!==16||r.slice(0,1)!=="4"||!x.creditCardNumber(r))};x.visa=x.visaCard=x.visaCardNumber;x.visaElectronCardNumber=function(r){if(!x.str(r)||r.length!==16)return!1;var e=Math.floor(r.slice(0,4)),t=[4026,4405,4508,4844,4913,4917];return r.slice(0,6)!=="417500"&&t.indexOf(e)===-1||!x.creditCardNumber(r),!1};x.visaElectron=x.visaElectronCard=x.visaElectronCardNumber;var Hhe=/^[0-9a-fA-F]{24}$/;x.mongoId=x.objectId=x.objId=function(r){return!!r&&!Array.isArray(r)&&Hhe.test(String(r))};x.matching=x.match=x.inArgs=function(r){if(arguments.length<2)return!1;for(var e=!1,t=1;t<arguments.length;t++){var n=x.equal(r,arguments[t]);e=e||n}return e};x.streetAddress=function(r){if(!x.str(r))return!1;var e=/\b\d+[\s](?:[A-Za-z0-9.-]+[\s]+)+\b(ALLEY|ALY|AVENUE|AVE|BEND|BND|BLUFFS?|BLFS?|BOULEVARD|BLVD|BRANCH|BR|CENTERS?|CTRS?|CIRCLES?|CIRS?|CLIFFS?|CLFS?|COURTS?|CTS?|COVES?|CVS?|CREEK|CRK|CRESCENT|CRES|CREST|CRST|CROSSING|XING|DRIVES?|DRS?|EXPRESSWAY|EXPY|FREEWAY|FWY|HEIGHTS|HTS|HIGHWAY|HWY|HILLS?|HLS?|LANE|LN|LOOP|MANORS?|MNRS?|MOTORWAY|MTWY|MOUNT|MT|PARKS?|PARKWAYS?|PKWY|PASS|PLACE|PL|PLAZA|PLZ|POINTS?|PTS?|RIDGES?|RDGS?|ROADS?|RDS?|ROUTE|RTE?|SHOALS?|SHLS?|SHORES?|SHRS?|SPRINGS?|SPGS?|SPURS?|STREETS?|STS?|SUMMIT|SMT|TERRACE|TER|THROUGHWAY|TRWY|TRAFFICWAY|TRFY|TRAIL|TRL|TURNPIKE|TPKE|VALLEYS?|VLYS?|WAYS?)+(?:[\.\-\s\,]?)*((APARTMENT|APT|APPT|#|NUMBER|NUM|FLOOR|FL|\s)?(\d)*)\b/ig;return e.test(r)};x.street=x.address=x.streetAddress;x.zipCode=function(r){if(x.undefined(r)||!(x.string(r)||x.number(r)))return!1;var e=/^\d{5}(?:-\d{4})?$/;return e.test(r)};x.zip=x.zipCode;x.phoneNumber=function(r){if(!x.string(r))return!1;var e=/(?:(?:\+?1\s*(?:[.-]\s*)?)?(?:(\(?)(?:(\s*([2-9]1[02-9]|[2-9][02-8]1|[2-9][02-8][02-9])\s*)|([2-9]1[02-9]|[2-9][02-8]1|[2-9][02-8][02-9]))\)?)\s*(?:[.-]\s*)?)?([2-9]1[02-9]|[2-9][02-9]1|[2-9][02-9]{2})\s*(?:[.-]\s*)?([0-9]{4})/g;return e.test(r)};x.phone=x.phoneNumber;var Ghe=sH();x.url=function(r){return Ghe(r)};x.uri=x.url;x.enumerator=function(r,e){var t=!1;if(!x.defined(r)||!x.defined(e)||!x.arrayLike(e))return t;for(var n=0,i=e.length;n<i;n++)if(x.equal(r,e[n])){t=!0;break}return t};x.enum=x.inArray=x.enumerator});var hF=M((jtt,uH)=>{function zhe(r){t.debug=t,t.default=t,t.coerce=l,t.disable=o,t.enable=i,t.enabled=s,t.humanize=qk(),t.destroy=c,Object.keys(r).forEach(u=>{t[u]=r[u]}),t.names=[],t.skips=[],t.formatters={};function e(u){let d=0;for(let f=0;f<u.length;f++)d=(d<<5)-d+u.charCodeAt(f),d|=0;return t.colors[Math.abs(d)%t.colors.length]}t.selectColor=e;function t(u){let d,f=null;function h(...v){if(!h.enabled)return;let S=h,b=Number(new Date),D=b-(d||b);S.diff=D,S.prev=d,S.curr=b,d=b,v[0]=t.coerce(v[0]),typeof v[0]!="string"&&v.unshift("%O");let _=0;v[0]=v[0].replace(/%([a-zA-Z%])/g,(Z,Se)=>{if(Z==="%%")return"%";_++;let ie=t.formatters[Se];if(typeof ie=="function"){let fe=v[_];Z=ie.call(S,fe),v.splice(_,1),_--}return Z}),t.formatArgs.call(S,v),(S.log||t.log).apply(S,v)}return h.namespace=u,h.useColors=t.useColors(),h.color=t.selectColor(u),h.extend=n,h.destroy=t.destroy,Object.defineProperty(h,"enabled",{enumerable:!0,configurable:!1,get:()=>f===null?t.enabled(u):f,set:v=>{f=v}}),typeof t.init=="function"&&t.init(h),h}function n(u,d){let f=t(this.namespace+(typeof d>"u"?":":d)+u);return f.log=this.log,f}function i(u){t.save(u),t.names=[],t.skips=[];let d,f=(typeof u=="string"?u:"").split(/[\s,]+/),h=f.length;for(d=0;d<h;d++)f[d]&&(u=f[d].replace(/\*/g,".*?"),u[0]==="-"?t.skips.push(new RegExp("^"+u.substr(1)+"$")):t.names.push(new RegExp("^"+u+"$")))}function o(){let u=[...t.names.map(a),...t.skips.map(a).map(d=>"-"+d)].join(",");return t.enable(""),u}function s(u){if(u[u.length-1]==="*")return!0;let d,f;for(d=0,f=t.skips.length;d<f;d++)if(t.skips[d].test(u))return!1;for(d=0,f=t.names.length;d<f;d++)if(t.names[d].test(u))return!0;return!1}function a(u){return u.toString().substring(2,u.toString().length-2).replace(/\.\*\?$/,"*")}function l(u){return u instanceof Error?u.stack||u.message:u}function c(){console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.")}return t.enable(t.load()),t}uH.exports=zhe});var pH=M((as,LT)=>{as.formatArgs=Yhe;as.save=Xhe;as.load=Zhe;as.useColors=Qhe;as.storage=ege();as.destroy=(()=>{let r=!1;return()=>{r||(r=!0,console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`."))}})();as.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"];function Qhe(){return typeof window<"u"&&window.process&&(window.process.type==="renderer"||window.process.__nwjs)?!0:typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/)?!1:typeof document<"u"&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||typeof window<"u"&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31||typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)}function Yhe(r){if(r[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+r[0]+(this.useColors?"%c ":" ")+"+"+LT.exports.humanize(this.diff),!this.useColors)return;let e="color: "+this.color;r.splice(1,0,e,"color: inherit");let t=0,n=0;r[0].replace(/%[a-zA-Z%]/g,i=>{i!=="%%"&&(t++,i==="%c"&&(n=t))}),r.splice(n,0,e)}as.log=console.debug||console.log||(()=>{});function Xhe(r){try{r?as.storage.setItem("debug",r):as.storage.removeItem("debug")}catch{}}function Zhe(){let r;try{r=as.storage.getItem("debug")}catch{}return!r&&typeof process<"u"&&"env"in process&&(r=process.env.DEBUG),r}function ege(){try{return localStorage}catch{}}LT.exports=hF()(as);var{formatters:tge}=LT.exports;tge.j=function(r){try{return JSON.stringify(r)}catch(e){return"[UnexpectedJSONParseError]: "+e.message}}});var mH=M((Di,WT)=>{var rge=require("tty"),UT=require("util");Di.init=cge;Di.log=sge;Di.formatArgs=ige;Di.save=age;Di.load=lge;Di.useColors=nge;Di.destroy=UT.deprecate(()=>{},"Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.");Di.colors=[6,2,3,4,5,1];try{let r=$k();r&&(r.stderr||r).level>=2&&(Di.colors=[20,21,26,27,32,33,38,39,40,41,42,43,44,45,56,57,62,63,68,69,74,75,76,77,78,79,80,81,92,93,98,99,112,113,128,129,134,135,148,149,160,161,162,163,164,165,166,167,168,169,170,171,172,173,178,179,184,185,196,197,198,199,200,201,202,203,204,205,206,207,208,209,214,215,220,221])}catch{}Di.inspectOpts=Object.keys(process.env).filter(r=>/^debug_/i.test(r)).reduce((r,e)=>{let t=e.substring(6).toLowerCase().replace(/_([a-z])/g,(i,o)=>o.toUpperCase()),n=process.env[e];return/^(yes|on|true|enabled)$/i.test(n)?n=!0:/^(no|off|false|disabled)$/i.test(n)?n=!1:n==="null"?n=null:n=Number(n),r[t]=n,r},{});function nge(){return"colors"in Di.inspectOpts?!!Di.inspectOpts.colors:rge.isatty(process.stderr.fd)}function ige(r){let{namespace:e,useColors:t}=this;if(t){let n=this.color,i="\x1B[3"+(n<8?n:"8;5;"+n),o=`  ${i};1m${e} \x1B[0m`;r[0]=o+r[0].split(`
`).join(`
`+o),r.push(i+"m+"+WT.exports.humanize(this.diff)+"\x1B[0m")}else r[0]=oge()+e+" "+r[0]}function oge(){return Di.inspectOpts.hideDate?"":new Date().toISOString()+" "}function sge(...r){return process.stderr.write(UT.format(...r)+`
`)}function age(r){r?process.env.DEBUG=r:delete process.env.DEBUG}function lge(){return process.env.DEBUG}function cge(r){r.inspectOpts={};let e=Object.keys(Di.inspectOpts);for(let t=0;t<e.length;t++)r.inspectOpts[e[t]]=Di.inspectOpts[e[t]]}WT.exports=hF()(Di);var{formatters:dH}=WT.exports;dH.o=function(r){return this.inspectOpts.colors=this.useColors,UT.inspect(r,this.inspectOpts).split(`
`).map(e=>e.trim()).join(" ")};dH.O=function(r){return this.inspectOpts.colors=this.useColors,UT.inspect(r,this.inspectOpts)}});var fH=M((Vtt,gF)=>{typeof process>"u"||process.type==="renderer"||process.browser===!0||process.__nwjs?gF.exports=pH():gF.exports=mH()});var SH=M(sf=>{"use strict";sf.check=bH;sf.waitUntilFreeOnHost=pge;sf.waitUntilFree=dge;sf.waitUntilUsedOnHost=IH;sf.waitUntilUsed=mge;sf.waitForStatus=VT;var ja=cH(),uge=require("net"),hH=require("util"),jT=fH()("tcp-port-used"),gH=2e3,vH=250;function yH(){var r,e,t=new Promise(function(n,i){r=n,e=i});return{resolve:r,reject:e,promise:t}}function Py(r,e,t,n,i){var o={};return o.port=r,o.host=e,o.inUse=t,o.retryTimeMs=n,o.timeOutMs=i,o}function bH(r,e){var t=yH(),n=!0,i,o;if(ja.obj(r)?o=r:o=Py(r,e),!ja.port(o.port))return jT("Error invalid port: "+hH.inspect(o.port)),t.reject(new Error("invalid port: "+hH.inspect(o.port))),t.promise;ja.nullOrUndefined(o.host)&&(jT("set host address to default 127.0.0.1"),o.host="127.0.0.1");function s(){i&&(i.removeAllListeners("connect"),i.removeAllListeners("error"),i.end(),i.destroy(),i.unref())}function a(){t.resolve(n),s()}function l(c){c.code!=="ECONNREFUSED"?t.reject(c):(n=!1,t.resolve(n)),s()}return i=new uge.Socket,i.once("connect",a),i.once("error",l),i.connect({port:o.port,host:o.host},function(){}),t.promise}function VT(r,e,t,n,i){var o=yH(),s,a=!1,l,c;if(ja.obj(r)?c=r:c=Py(r,e,t,n,i),!ja.bool(c.inUse))return o.reject(new Error("inUse must be a boolean")),o.promise;ja.positiveInt(c.retryTimeMs)||(c.retryTimeMs=vH,jT("set retryTime to default "+vH+"ms")),ja.positiveInt(c.timeOutMs)||(c.timeOutMs=gH,jT("set timeOutMs to default "+gH+"ms"));function u(){s&&clearTimeout(s),l&&clearTimeout(l)}function d(){a=!0,u(),o.reject(new Error("timeout"))}s=setTimeout(d,c.timeOutMs);function f(){bH(c.port,c.host).then(function(h){if(!a)if(h===c.inUse){o.resolve(),u();return}else{l=setTimeout(function(){f()},c.retryTimeMs);return}},function(h){a||(o.reject(h),u())})}return f(),o.promise}function pge(r,e,t,n){var i;return ja.obj(r)?(i=r,i.inUse=!1):i=Py(r,e,!1,t,n),VT(i)}function dge(r,e,t){var n;return ja.obj(r)?(n=r,n.host="127.0.0.1",n.inUse=!1):n=Py(r,"127.0.0.1",!1,e,t),VT(n)}function IH(r,e,t,n){var i;return ja.obj(r)?(i=r,i.inUse=!0):i=Py(r,e,!0,t,n),VT(i)}function mge(r,e,t){var n;return ja.obj(r)?(n=r,n.host="127.0.0.1",n.inUse=!0):n=Py(r,"127.0.0.1",!0,e,t),IH(n)}});var DH=M((BT,cc)=>{(function(r,e){typeof BT=="object"&&typeof cc<"u"?e(BT):typeof define=="function"&&define.amd?define(["exports"],e):e(r.async=r.async||{})})(BT,function(r){"use strict";function e(I,P){P=P|0;for(var N=Math.max(I.length-P,0),K=Array(N),Q=0;Q<N;Q++)K[Q]=I[P+Q];return K}var t=function(I){var P=e(arguments,1);return function(){var N=e(arguments);return I.apply(null,P.concat(N))}},n=function(I){return function(){var P=e(arguments),N=P.pop();I.call(this,P,N)}};function i(I){var P=typeof I;return I!=null&&(P=="object"||P=="function")}var o=typeof setImmediate=="function"&&setImmediate,s=typeof process=="object"&&typeof process.nextTick=="function";function a(I){setTimeout(I,0)}function l(I){return function(P){var N=e(arguments,1);I(function(){P.apply(null,N)})}}var c;o?c=setImmediate:s?c=process.nextTick:c=a;var u=l(c);function d(I){return n(function(P,N){var K;try{K=I.apply(this,P)}catch(Q){return N(Q)}i(K)&&typeof K.then=="function"?K.then(function(Q){f(N,null,Q)},function(Q){f(N,Q.message?Q:new Error(Q))}):N(null,K)})}function f(I,P,N){try{I(P,N)}catch(K){u(h,K)}}function h(I){throw I}var v=typeof Symbol=="function";function S(I){return v&&I[Symbol.toStringTag]==="AsyncFunction"}function b(I){return S(I)?d(I):I}function D(I){return function(P){var N=e(arguments,1),K=n(function(Q,z){var le=this;return I(P,function(me,_e){b(me).apply(le,Q.concat(_e))},z)});return N.length?K.apply(this,N):K}}var _=typeof global=="object"&&global&&global.Object===Object&&global,L=typeof self=="object"&&self&&self.Object===Object&&self,Z=_||L||Function("return this")(),Se=Z.Symbol,ie=Object.prototype,fe=ie.hasOwnProperty,de=ie.toString,ae=Se?Se.toStringTag:void 0;function Me(I){var P=fe.call(I,ae),N=I[ae];try{I[ae]=void 0;var K=!0}catch{}var Q=de.call(I);return K&&(P?I[ae]=N:delete I[ae]),Q}var Ge=Object.prototype,St=Ge.toString;function vt(I){return St.call(I)}var ot="[object Null]",oe="[object Undefined]",Pe=Se?Se.toStringTag:void 0;function Y(I){return I==null?I===void 0?oe:ot:Pe&&Pe in Object(I)?Me(I):vt(I)}var be="[object AsyncFunction]",Je="[object Function]",yn="[object GeneratorFunction]",kt="[object Proxy]";function Yr(I){if(!i(I))return!1;var P=Y(I);return P==Je||P==yn||P==be||P==kt}var vs=9007199254740991;function qt(I){return typeof I=="number"&&I>-1&&I%1==0&&I<=vs}function un(I){return I!=null&&qt(I.length)&&!Yr(I)}var Yi={};function Mt(){}function mr(I){return function(){if(I!==null){var P=I;I=null,P.apply(this,arguments)}}}var mi=typeof Symbol=="function"&&Symbol.iterator,kc=function(I){return mi&&I[mi]&&I[mi]()};function F(I,P){for(var N=-1,K=Array(I);++N<I;)K[N]=P(N);return K}function j(I){return I!=null&&typeof I=="object"}var Ce="[object Arguments]";function Oe(I){return j(I)&&Y(I)==Ce}var st=Object.prototype,pn=st.hasOwnProperty,zt=st.propertyIsEnumerable,jt=Oe(function(){return arguments}())?Oe:function(I){return j(I)&&pn.call(I,"callee")&&!zt.call(I,"callee")},Ot=Array.isArray;function Ar(){return!1}var Xr=typeof r=="object"&&r&&!r.nodeType&&r,Ur=Xr&&typeof cc=="object"&&cc&&!cc.nodeType&&cc,dn=Ur&&Ur.exports===Xr,$=dn?Z.Buffer:void 0,re=$?$.isBuffer:void 0,ve=re||Ar,ke=9007199254740991,Qe=/^(?:0|[1-9]\d*)$/;function mn(I,P){var N=typeof I;return P=P??ke,!!P&&(N=="number"||N!="symbol"&&Qe.test(I))&&I>-1&&I%1==0&&I<P}var Pt="[object Arguments]",_t="[object Array]",at="[object Boolean]",Lt="[object Date]",ne="[object Error]",he="[object Function]",B="[object Map]",q="[object Number]",ee="[object Object]",De="[object RegExp]",We="[object Set]",vr="[object String]",Ni="[object WeakMap]",Pc="[object ArrayBuffer]",w1="[object DataView]",k1="[object Float32Array]",P1="[object Float64Array]",Ee="[object Int8Array]",CL="[object Int16Array]",EL="[object Int32Array]",wL="[object Uint8Array]",kL="[object Uint8ClampedArray]",PL="[object Uint16Array]",DL="[object Uint32Array]",Vr={};Vr[k1]=Vr[P1]=Vr[Ee]=Vr[CL]=Vr[EL]=Vr[wL]=Vr[kL]=Vr[PL]=Vr[DL]=!0,Vr[Pt]=Vr[_t]=Vr[Pc]=Vr[at]=Vr[w1]=Vr[Lt]=Vr[ne]=Vr[he]=Vr[B]=Vr[q]=Vr[ee]=Vr[De]=Vr[We]=Vr[vr]=Vr[Ni]=!1;function TL(I){return j(I)&&qt(I.length)&&!!Vr[Y(I)]}function _L(I){return function(P){return I(P)}}var D1=typeof r=="object"&&r&&!r.nodeType&&r,zf=D1&&typeof cc=="object"&&cc&&!cc.nodeType&&cc,RL=zf&&zf.exports===D1,bE=RL&&_.process,T1=function(){try{var I=zf&&zf.require&&zf.require("util").types;return I||bE&&bE.binding&&bE.binding("util")}catch{}}(),_1=T1&&T1.isTypedArray,NL=_1?_L(_1):TL,AL=Object.prototype,ML=AL.hasOwnProperty;function OL(I,P){var N=Ot(I),K=!N&&jt(I),Q=!N&&!K&&ve(I),z=!N&&!K&&!Q&&NL(I),le=N||K||Q||z,me=le?F(I.length,String):[],_e=me.length;for(var nt in I)(P||ML.call(I,nt))&&!(le&&(nt=="length"||Q&&(nt=="offset"||nt=="parent")||z&&(nt=="buffer"||nt=="byteLength"||nt=="byteOffset")||mn(nt,_e)))&&me.push(nt);return me}var KL=Object.prototype;function FL(I){var P=I&&I.constructor,N=typeof P=="function"&&P.prototype||KL;return I===N}function LL(I,P){return function(N){return I(P(N))}}var UL=LL(Object.keys,Object),WL=Object.prototype,jL=WL.hasOwnProperty;function VL(I){if(!FL(I))return UL(I);var P=[];for(var N in Object(I))jL.call(I,N)&&N!="constructor"&&P.push(N);return P}function IE(I){return un(I)?OL(I):VL(I)}function BL(I){var P=-1,N=I.length;return function(){return++P<N?{value:I[P],key:P}:null}}function qL(I){var P=-1;return function(){var K=I.next();return K.done?null:(P++,{value:K.value,key:P})}}function JL(I){var P=IE(I),N=-1,K=P.length;return function Q(){var z=P[++N];return z==="__proto__"?Q():N<K?{value:I[z],key:z}:null}}function $L(I){if(un(I))return BL(I);var P=kc(I);return P?qL(P):JL(I)}function pa(I){return function(){if(I===null)throw new Error("Callback was already called.");var P=I;I=null,P.apply(this,arguments)}}function rS(I){return function(P,N,K){if(K=mr(K||Mt),I<=0||!P)return K(null);var Q=$L(P),z=!1,le=0,me=!1;function _e(Re,Et){if(le-=1,Re)z=!0,K(Re);else{if(Et===Yi||z&&le<=0)return z=!0,K(null);me||nt()}}function nt(){for(me=!0;le<I&&!z;){var Re=Q();if(Re===null){z=!0,le<=0&&K(null);return}le+=1,N(Re.value,Re.key,pa(_e))}me=!1}nt()}}function Uu(I,P,N,K){rS(P)(I,b(N),K)}function Zn(I,P){return function(N,K,Q){return I(N,P,K,Q)}}function HL(I,P,N){N=mr(N||Mt);var K=0,Q=0,z=I.length;z===0&&N(null);function le(me,_e){me?N(me):(++Q===z||_e===Yi)&&N(null)}for(;K<z;K++)P(I[K],K,pa(le))}var GL=Zn(Uu,1/0),Dc=function(I,P,N){var K=un(I)?HL:GL;K(I,b(P),N)};function Od(I){return function(P,N,K){return I(Dc,P,b(N),K)}}function R1(I,P,N,K){K=K||Mt,P=P||[];var Q=[],z=0,le=b(N);I(P,function(me,_e,nt){var Re=z++;le(me,function(Et,Zr){Q[Re]=Zr,nt(Et)})},function(me){K(me,Q)})}var nS=Od(R1),N1=D(nS);function Kd(I){return function(P,N,K,Q){return I(rS(N),P,b(K),Q)}}var Fd=Kd(R1),SE=Zn(Fd,1),A1=D(SE);function iS(I,P){for(var N=-1,K=I==null?0:I.length;++N<K&&P(I[N],N,I)!==!1;);return I}function zL(I){return function(P,N,K){for(var Q=-1,z=Object(P),le=K(P),me=le.length;me--;){var _e=le[I?me:++Q];if(N(z[_e],_e,z)===!1)break}return P}}var QL=zL();function Qf(I,P){return I&&QL(I,P,IE)}function YL(I,P,N,K){for(var Q=I.length,z=N+(K?1:-1);K?z--:++z<Q;)if(P(I[z],z,I))return z;return-1}function XL(I){return I!==I}function ZL(I,P,N){for(var K=N-1,Q=I.length;++K<Q;)if(I[K]===P)return K;return-1}function oS(I,P,N){return P===P?ZL(I,P,N):YL(I,XL,N)}var xE=function(I,P,N){typeof P=="function"&&(N=P,P=null),N=mr(N||Mt);var K=IE(I),Q=K.length;if(!Q)return N(null);P||(P=Q);var z={},le=0,me=!1,_e=Object.create(null),nt=[],Re=[],Et={};Qf(I,function(nn,fn){if(!Ot(nn)){Zr(fn,[nn]),Re.push(fn);return}var ei=nn.slice(0,nn.length-1),_c=ei.length;if(_c===0){Zr(fn,nn),Re.push(fn);return}Et[fn]=_c,iS(ei,function(oh){if(!I[oh])throw new Error("async.auto task `"+fn+"` has a non-existent dependency `"+oh+"` in "+ei.join(", "));Xa(oh,function(){_c--,_c===0&&Zr(fn,nn)})})}),sQ(),Ai();function Zr(nn,fn){nt.push(function(){Za(nn,fn)})}function Ai(){if(nt.length===0&&le===0)return N(null,z);for(;nt.length&&le<P;){var nn=nt.shift();nn()}}function Xa(nn,fn){var ei=_e[nn];ei||(ei=_e[nn]=[]),ei.push(fn)}function bs(nn){var fn=_e[nn]||[];iS(fn,function(ei){ei()}),Ai()}function Za(nn,fn){if(!me){var ei=pa(function(oh,DR){if(le--,arguments.length>2&&(DR=e(arguments,1)),oh){var TR={};Qf(z,function(lQ,cQ){TR[cQ]=lQ}),TR[nn]=DR,me=!0,_e=Object.create(null),N(oh,TR)}else z[nn]=DR,bs(nn)});le++;var _c=b(fn[fn.length-1]);fn.length>1?_c(z,ei):_c(ei)}}function sQ(){for(var nn,fn=0;Re.length;)nn=Re.pop(),fn++,iS(aQ(nn),function(ei){--Et[ei]===0&&Re.push(ei)});if(fn!==Q)throw new Error("async.auto cannot execute tasks due to a recursive dependency")}function aQ(nn){var fn=[];return Qf(I,function(ei,_c){Ot(ei)&&oS(ei,nn,0)>=0&&fn.push(_c)}),fn}};function Ld(I,P){for(var N=-1,K=I==null?0:I.length,Q=Array(K);++N<K;)Q[N]=P(I[N],N,I);return Q}var eU="[object Symbol]";function tU(I){return typeof I=="symbol"||j(I)&&Y(I)==eU}var rU=1/0,M1=Se?Se.prototype:void 0,O1=M1?M1.toString:void 0;function CE(I){if(typeof I=="string")return I;if(Ot(I))return Ld(I,CE)+"";if(tU(I))return O1?O1.call(I):"";var P=I+"";return P=="0"&&1/I==-rU?"-0":P}function nU(I,P,N){var K=-1,Q=I.length;P<0&&(P=-P>Q?0:Q+P),N=N>Q?Q:N,N<0&&(N+=Q),Q=P>N?0:N-P>>>0,P>>>=0;for(var z=Array(Q);++K<Q;)z[K]=I[K+P];return z}function iU(I,P,N){var K=I.length;return N=N===void 0?K:N,!P&&N>=K?I:nU(I,P,N)}function oU(I,P){for(var N=I.length;N--&&oS(P,I[N],0)>-1;);return N}function sU(I,P){for(var N=-1,K=I.length;++N<K&&oS(P,I[N],0)>-1;);return N}function aU(I){return I.split("")}var lU="\\ud800-\\udfff",cU="\\u0300-\\u036f",uU="\\ufe20-\\ufe2f",pU="\\u20d0-\\u20ff",dU=cU+uU+pU,mU="\\ufe0e\\ufe0f",fU="\\u200d",hU=RegExp("["+fU+lU+dU+mU+"]");function gU(I){return hU.test(I)}var K1="\\ud800-\\udfff",vU="\\u0300-\\u036f",yU="\\ufe20-\\ufe2f",bU="\\u20d0-\\u20ff",IU=vU+yU+bU,SU="\\ufe0e\\ufe0f",xU="["+K1+"]",EE="["+IU+"]",wE="\\ud83c[\\udffb-\\udfff]",CU="(?:"+EE+"|"+wE+")",F1="[^"+K1+"]",L1="(?:\\ud83c[\\udde6-\\uddff]){2}",U1="[\\ud800-\\udbff][\\udc00-\\udfff]",EU="\\u200d",W1=CU+"?",j1="["+SU+"]?",wU="(?:"+EU+"(?:"+[F1,L1,U1].join("|")+")"+j1+W1+")*",kU=j1+W1+wU,PU="(?:"+[F1+EE+"?",EE,L1,U1,xU].join("|")+")",DU=RegExp(wE+"(?="+wE+")|"+PU+kU,"g");function TU(I){return I.match(DU)||[]}function V1(I){return gU(I)?TU(I):aU(I)}function _U(I){return I==null?"":CE(I)}var RU=/^\s+|\s+$/g;function NU(I,P,N){if(I=_U(I),I&&(N||P===void 0))return I.replace(RU,"");if(!I||!(P=CE(P)))return I;var K=V1(I),Q=V1(P),z=sU(K,Q),le=oU(K,Q)+1;return iU(K,z,le).join("")}var AU=/^(?:async\s+)?(function)?\s*[^\(]*\(\s*([^\)]*)\)/m,MU=/,/,OU=/(=.+)?(\s*)$/,KU=/((\/\/.*$)|(\/\*[\s\S]*?\*\/))/mg;function FU(I){return I=I.toString().replace(KU,""),I=I.match(AU)[2].replace(" ",""),I=I?I.split(MU):[],I=I.map(function(P){return NU(P.replace(OU,""))}),I}function B1(I,P){var N={};Qf(I,function(K,Q){var z,le=S(K),me=!le&&K.length===1||le&&K.length===0;if(Ot(K))z=K.slice(0,-1),K=K[K.length-1],N[Q]=z.concat(z.length>0?_e:K);else if(me)N[Q]=K;else{if(z=FU(K),K.length===0&&!le&&z.length===0)throw new Error("autoInject task functions require explicit parameters.");le||z.pop(),N[Q]=z.concat(_e)}function _e(nt,Re){var Et=Ld(z,function(Zr){return nt[Zr]});Et.push(Re),b(K).apply(null,Et)}}),xE(N,P)}function ys(){this.head=this.tail=null,this.length=0}function q1(I,P){I.length=1,I.head=I.tail=P}ys.prototype.removeLink=function(I){return I.prev?I.prev.next=I.next:this.head=I.next,I.next?I.next.prev=I.prev:this.tail=I.prev,I.prev=I.next=null,this.length-=1,I},ys.prototype.empty=function(){for(;this.head;)this.shift();return this},ys.prototype.insertAfter=function(I,P){P.prev=I,P.next=I.next,I.next?I.next.prev=P:this.tail=P,I.next=P,this.length+=1},ys.prototype.insertBefore=function(I,P){P.prev=I.prev,P.next=I,I.prev?I.prev.next=P:this.head=P,I.prev=P,this.length+=1},ys.prototype.unshift=function(I){this.head?this.insertBefore(this.head,I):q1(this,I)},ys.prototype.push=function(I){this.tail?this.insertAfter(this.tail,I):q1(this,I)},ys.prototype.shift=function(){return this.head&&this.removeLink(this.head)},ys.prototype.pop=function(){return this.tail&&this.removeLink(this.tail)},ys.prototype.toArray=function(){for(var I=Array(this.length),P=this.head,N=0;N<this.length;N++)I[N]=P.data,P=P.next;return I},ys.prototype.remove=function(I){for(var P=this.head;P;){var N=P.next;I(P)&&this.removeLink(P),P=N}return this};function J1(I,P,N){if(P==null)P=1;else if(P===0)throw new Error("Concurrency must not be zero");var K=b(I),Q=0,z=[],le=!1;function me(Et,Zr,Ai){if(Ai!=null&&typeof Ai!="function")throw new Error("task callback must be a function");if(Re.started=!0,Ot(Et)||(Et=[Et]),Et.length===0&&Re.idle())return u(function(){Re.drain()});for(var Xa=0,bs=Et.length;Xa<bs;Xa++){var Za={data:Et[Xa],callback:Ai||Mt};Zr?Re._tasks.unshift(Za):Re._tasks.push(Za)}le||(le=!0,u(function(){le=!1,Re.process()}))}function _e(Et){return function(Zr){Q-=1;for(var Ai=0,Xa=Et.length;Ai<Xa;Ai++){var bs=Et[Ai],Za=oS(z,bs,0);Za===0?z.shift():Za>0&&z.splice(Za,1),bs.callback.apply(bs,arguments),Zr!=null&&Re.error(Zr,bs.data)}Q<=Re.concurrency-Re.buffer&&Re.unsaturated(),Re.idle()&&Re.drain(),Re.process()}}var nt=!1,Re={_tasks:new ys,concurrency:P,payload:N,saturated:Mt,unsaturated:Mt,buffer:P/4,empty:Mt,drain:Mt,error:Mt,started:!1,paused:!1,push:function(Et,Zr){me(Et,!1,Zr)},kill:function(){Re.drain=Mt,Re._tasks.empty()},unshift:function(Et,Zr){me(Et,!0,Zr)},remove:function(Et){Re._tasks.remove(Et)},process:function(){if(!nt){for(nt=!0;!Re.paused&&Q<Re.concurrency&&Re._tasks.length;){var Et=[],Zr=[],Ai=Re._tasks.length;Re.payload&&(Ai=Math.min(Ai,Re.payload));for(var Xa=0;Xa<Ai;Xa++){var bs=Re._tasks.shift();Et.push(bs),z.push(bs),Zr.push(bs.data)}Q+=1,Re._tasks.length===0&&Re.empty(),Q===Re.concurrency&&Re.saturated();var Za=pa(_e(Et));K(Zr,Za)}nt=!1}},length:function(){return Re._tasks.length},running:function(){return Q},workersList:function(){return z},idle:function(){return Re._tasks.length+Q===0},pause:function(){Re.paused=!0},resume:function(){Re.paused!==!1&&(Re.paused=!1,u(Re.process))}};return Re}function $1(I,P){return J1(I,1,P)}var Ud=Zn(Uu,1);function Tc(I,P,N,K){K=mr(K||Mt);var Q=b(N);Ud(I,function(z,le,me){Q(P,z,function(_e,nt){P=nt,me(_e)})},function(z){K(z,P)})}function kE(){var I=Ld(arguments,b);return function(){var P=e(arguments),N=this,K=P[P.length-1];typeof K=="function"?P.pop():K=Mt,Tc(I,P,function(Q,z,le){z.apply(N,Q.concat(function(me){var _e=e(arguments,1);le(me,_e)}))},function(Q,z){K.apply(N,[Q].concat(z))})}}var H1=function(){return kE.apply(null,e(arguments).reverse())},LU=Array.prototype.concat,sS=function(I,P,N,K){K=K||Mt;var Q=b(N);Fd(I,P,function(z,le){Q(z,function(me){return me?le(me):le(null,e(arguments,1))})},function(z,le){for(var me=[],_e=0;_e<le.length;_e++)le[_e]&&(me=LU.apply(me,le[_e]));return K(z,me)})},G1=Zn(sS,1/0),z1=Zn(sS,1),Q1=function(){var I=e(arguments),P=[null].concat(I);return function(){var N=arguments[arguments.length-1];return N.apply(this,P)}};function Yf(I){return I}function Wd(I,P){return function(N,K,Q,z){z=z||Mt;var le=!1,me;N(K,function(_e,nt,Re){Q(_e,function(Et,Zr){Et?Re(Et):I(Zr)&&!me?(le=!0,me=P(!0,_e),Re(null,Yi)):Re()})},function(_e){_e?z(_e):z(null,le?me:P(!1))})}}function Y1(I,P){return P}var aS=Od(Wd(Yf,Y1)),Xf=Kd(Wd(Yf,Y1)),lS=Zn(Xf,1);function X1(I){return function(P){var N=e(arguments,1);N.push(function(K){var Q=e(arguments,1);typeof console=="object"&&(K?console.error&&console.error(K):console[I]&&iS(Q,function(z){console[I](z)}))}),b(P).apply(null,N)}}var Z1=X1("dir");function eR(I,P,N){N=pa(N||Mt);var K=b(I),Q=b(P);function z(me){if(me)return N(me);var _e=e(arguments,1);_e.push(le),Q.apply(this,_e)}function le(me,_e){if(me)return N(me);if(!_e)return N(null);K(z)}le(null,!0)}function PE(I,P,N){N=pa(N||Mt);var K=b(I),Q=function(z){if(z)return N(z);var le=e(arguments,1);if(P.apply(this,le))return K(Q);N.apply(null,[null].concat(le))};K(Q)}function tR(I,P,N){PE(I,function(){return!P.apply(this,arguments)},N)}function rR(I,P,N){N=pa(N||Mt);var K=b(P),Q=b(I);function z(me){if(me)return N(me);Q(le)}function le(me,_e){if(me)return N(me);if(!_e)return N(null);K(z)}Q(le)}function nR(I){return function(P,N,K){return I(P,K)}}function cS(I,P,N){Dc(I,nR(b(P)),N)}function Zf(I,P,N,K){rS(P)(I,nR(b(N)),K)}var eh=Zn(Zf,1);function DE(I){return S(I)?I:n(function(P,N){var K=!0;P.push(function(){var Q=arguments;K?u(function(){N.apply(null,Q)}):N.apply(null,Q)}),I.apply(this,P),K=!1})}function uS(I){return!I}var pS=Od(Wd(uS,uS)),th=Kd(Wd(uS,uS)),dS=Zn(th,1);function iR(I){return function(P){return P?.[I]}}function UU(I,P,N,K){var Q=new Array(P.length);I(P,function(z,le,me){N(z,function(_e,nt){Q[le]=!!nt,me(_e)})},function(z){if(z)return K(z);for(var le=[],me=0;me<P.length;me++)Q[me]&&le.push(P[me]);K(null,le)})}function WU(I,P,N,K){var Q=[];I(P,function(z,le,me){N(z,function(_e,nt){_e?me(_e):(nt&&Q.push({index:le,value:z}),me())})},function(z){z?K(z):K(null,Ld(Q.sort(function(le,me){return le.index-me.index}),iR("value")))})}function TE(I,P,N,K){var Q=un(P)?UU:WU;Q(I,P,b(N),K||Mt)}var mS=Od(TE),rh=Kd(TE),fS=Zn(rh,1);function oR(I,P){var N=pa(P||Mt),K=b(DE(I));function Q(z){if(z)return N(z);K(Q)}Q()}var hS=function(I,P,N,K){K=K||Mt;var Q=b(N);Fd(I,P,function(z,le){Q(z,function(me,_e){return me?le(me):le(null,{key:_e,val:z})})},function(z,le){for(var me={},_e=Object.prototype.hasOwnProperty,nt=0;nt<le.length;nt++)if(le[nt]){var Re=le[nt].key,Et=le[nt].val;_e.call(me,Re)?me[Re].push(Et):me[Re]=[Et]}return K(z,me)})},sR=Zn(hS,1/0),aR=Zn(hS,1),lR=X1("log");function gS(I,P,N,K){K=mr(K||Mt);var Q={},z=b(N);Uu(I,P,function(le,me,_e){z(le,me,function(nt,Re){if(nt)return _e(nt);Q[me]=Re,_e()})},function(le){K(le,Q)})}var cR=Zn(gS,1/0),uR=Zn(gS,1);function pR(I,P){return P in I}function dR(I,P){var N=Object.create(null),K=Object.create(null);P=P||Yf;var Q=b(I),z=n(function(me,_e){var nt=P.apply(null,me);pR(N,nt)?u(function(){_e.apply(null,N[nt])}):pR(K,nt)?K[nt].push(_e):(K[nt]=[_e],Q.apply(null,me.concat(function(){var Re=e(arguments);N[nt]=Re;var Et=K[nt];delete K[nt];for(var Zr=0,Ai=Et.length;Zr<Ai;Zr++)Et[Zr].apply(null,Re)})))});return z.memo=N,z.unmemoized=I,z}var vS;s?vS=process.nextTick:o?vS=setImmediate:vS=a;var mR=l(vS);function _E(I,P,N){N=N||Mt;var K=un(P)?[]:{};I(P,function(Q,z,le){b(Q)(function(me,_e){arguments.length>2&&(_e=e(arguments,1)),K[z]=_e,le(me)})},function(Q){N(Q,K)})}function fR(I,P){_E(Dc,I,P)}function hR(I,P,N){_E(rS(P),I,N)}var RE=function(I,P){var N=b(I);return J1(function(K,Q){N(K[0],Q)},P,1)},gR=function(I,P){var N=RE(I,P);return N.push=function(K,Q,z){if(z==null&&(z=Mt),typeof z!="function")throw new Error("task callback must be a function");if(N.started=!0,Ot(K)||(K=[K]),K.length===0)return u(function(){N.drain()});Q=Q||0;for(var le=N._tasks.head;le&&Q>=le.priority;)le=le.next;for(var me=0,_e=K.length;me<_e;me++){var nt={data:K[me],priority:Q,callback:z};le?N._tasks.insertBefore(le,nt):N._tasks.push(nt)}u(N.process)},delete N.unshift,N};function vR(I,P){if(P=mr(P||Mt),!Ot(I))return P(new TypeError("First argument to race must be an array of functions"));if(!I.length)return P();for(var N=0,K=I.length;N<K;N++)b(I[N])(P)}function yS(I,P,N,K){var Q=e(I).reverse();Tc(Q,P,N,K)}function bS(I){var P=b(I);return n(function(K,Q){return K.push(function(le,me){if(le)Q(null,{error:le});else{var _e;arguments.length<=2?_e=me:_e=e(arguments,1),Q(null,{value:_e})}}),P.apply(this,K)})}function yR(I){var P;return Ot(I)?P=Ld(I,bS):(P={},Qf(I,function(N,K){P[K]=bS.call(this,N)})),P}function bR(I,P,N,K){TE(I,P,function(Q,z){N(Q,function(le,me){z(le,!me)})},K)}var IR=Od(bR),NE=Kd(bR),SR=Zn(NE,1);function xR(I){return function(){return I}}function IS(I,P,N){var K=5,Q=0,z={times:K,intervalFunc:xR(Q)};function le(Re,Et){if(typeof Et=="object")Re.times=+Et.times||K,Re.intervalFunc=typeof Et.interval=="function"?Et.interval:xR(+Et.interval||Q),Re.errorFilter=Et.errorFilter;else if(typeof Et=="number"||typeof Et=="string")Re.times=+Et||K;else throw new Error("Invalid arguments for async.retry")}if(arguments.length<3&&typeof I=="function"?(N=P||Mt,P=I):(le(z,I),N=N||Mt),typeof P!="function")throw new Error("Invalid arguments for async.retry");var me=b(P),_e=1;function nt(){me(function(Re){Re&&_e++<z.times&&(typeof z.errorFilter!="function"||z.errorFilter(Re))?setTimeout(nt,z.intervalFunc(_e)):N.apply(null,arguments)})}nt()}var CR=function(I,P){P||(P=I,I=null);var N=b(P);return n(function(K,Q){function z(le){N.apply(null,K.concat(le))}I?IS(I,z,Q):IS(z,Q)})};function ER(I,P){_E(Ud,I,P)}var SS=Od(Wd(Boolean,Yf)),nh=Kd(Wd(Boolean,Yf)),xS=Zn(nh,1);function wR(I,P,N){var K=b(P);nS(I,function(z,le){K(z,function(me,_e){if(me)return le(me);le(null,{value:z,criteria:_e})})},function(z,le){if(z)return N(z);N(null,Ld(le.sort(Q),iR("value")))});function Q(z,le){var me=z.criteria,_e=le.criteria;return me<_e?-1:me>_e?1:0}}function kR(I,P,N){var K=b(I);return n(function(Q,z){var le=!1,me;function _e(){var nt=I.name||"anonymous",Re=new Error('Callback function "'+nt+'" timed out.');Re.code="ETIMEDOUT",N&&(Re.info=N),le=!0,z(Re)}Q.push(function(){le||(z.apply(null,arguments),clearTimeout(me))}),me=setTimeout(_e,P),K.apply(null,Q)})}var T=Math.ceil,U=Math.max;function rt(I,P,N,K){for(var Q=-1,z=U(T((P-I)/(N||1)),0),le=Array(z);z--;)le[K?z:++Q]=I,I+=N;return le}function ih(I,P,N,K){var Q=b(N);Fd(rt(0,I,1),P,Q,K)}var jU=Zn(ih,1/0),VU=Zn(ih,1);function BU(I,P,N,K){arguments.length<=3&&(K=N,N=P,P=Ot(I)?[]:{}),K=mr(K||Mt);var Q=b(N);Dc(I,function(z,le,me){Q(P,z,le,me)},function(z){K(z,P)})}function qU(I,P){var N=null,K;P=P||Mt,eh(I,function(Q,z){b(Q)(function(le,me){arguments.length>2?K=e(arguments,1):K=me,N=le,z(!le)})},function(){P(N,K)})}function JU(I){return function(){return(I.unmemoized||I).apply(null,arguments)}}function PR(I,P,N){N=pa(N||Mt);var K=b(P);if(!I())return N(null);var Q=function(z){if(z)return N(z);if(I())return K(Q);var le=e(arguments,1);N.apply(null,[null].concat(le))};K(Q)}function $U(I,P,N){PR(function(){return!I.apply(this,arguments)},P,N)}var HU=function(I,P){if(P=mr(P||Mt),!Ot(I))return P(new Error("First argument to waterfall must be an array of functions"));if(!I.length)return P();var N=0;function K(z){var le=b(I[N++]);z.push(pa(Q)),le.apply(null,z)}function Q(z){if(z||N===I.length)return P.apply(null,arguments);K(e(arguments,1))}K([])},oQ={apply:t,applyEach:N1,applyEachSeries:A1,asyncify:d,auto:xE,autoInject:B1,cargo:$1,compose:H1,concat:G1,concatLimit:sS,concatSeries:z1,constant:Q1,detect:aS,detectLimit:Xf,detectSeries:lS,dir:Z1,doDuring:eR,doUntil:tR,doWhilst:PE,during:rR,each:cS,eachLimit:Zf,eachOf:Dc,eachOfLimit:Uu,eachOfSeries:Ud,eachSeries:eh,ensureAsync:DE,every:pS,everyLimit:th,everySeries:dS,filter:mS,filterLimit:rh,filterSeries:fS,forever:oR,groupBy:sR,groupByLimit:hS,groupBySeries:aR,log:lR,map:nS,mapLimit:Fd,mapSeries:SE,mapValues:cR,mapValuesLimit:gS,mapValuesSeries:uR,memoize:dR,nextTick:mR,parallel:fR,parallelLimit:hR,priorityQueue:gR,queue:RE,race:vR,reduce:Tc,reduceRight:yS,reflect:bS,reflectAll:yR,reject:IR,rejectLimit:NE,rejectSeries:SR,retry:IS,retryable:CR,seq:kE,series:ER,setImmediate:u,some:SS,someLimit:nh,someSeries:xS,sortBy:wR,timeout:kR,times:jU,timesLimit:ih,timesSeries:VU,transform:BU,tryEach:qU,unmemoize:JU,until:$U,waterfall:HU,whilst:PR,all:pS,allLimit:th,allSeries:dS,any:SS,anyLimit:nh,anySeries:xS,find:aS,findLimit:Xf,findSeries:lS,forEach:cS,forEachSeries:eh,forEachLimit:Zf,forEachOf:Dc,forEachOfSeries:Ud,forEachOfLimit:Uu,inject:Tc,foldl:Tc,foldr:yS,select:mS,selectLimit:rh,selectSeries:fS,wrapSync:d};r.default=oQ,r.apply=t,r.applyEach=N1,r.applyEachSeries=A1,r.asyncify=d,r.auto=xE,r.autoInject=B1,r.cargo=$1,r.compose=H1,r.concat=G1,r.concatLimit=sS,r.concatSeries=z1,r.constant=Q1,r.detect=aS,r.detectLimit=Xf,r.detectSeries=lS,r.dir=Z1,r.doDuring=eR,r.doUntil=tR,r.doWhilst=PE,r.during=rR,r.each=cS,r.eachLimit=Zf,r.eachOf=Dc,r.eachOfLimit=Uu,r.eachOfSeries=Ud,r.eachSeries=eh,r.ensureAsync=DE,r.every=pS,r.everyLimit=th,r.everySeries=dS,r.filter=mS,r.filterLimit=rh,r.filterSeries=fS,r.forever=oR,r.groupBy=sR,r.groupByLimit=hS,r.groupBySeries=aR,r.log=lR,r.map=nS,r.mapLimit=Fd,r.mapSeries=SE,r.mapValues=cR,r.mapValuesLimit=gS,r.mapValuesSeries=uR,r.memoize=dR,r.nextTick=mR,r.parallel=fR,r.parallelLimit=hR,r.priorityQueue=gR,r.queue=RE,r.race=vR,r.reduce=Tc,r.reduceRight=yS,r.reflect=bS,r.reflectAll=yR,r.reject=IR,r.rejectLimit=NE,r.rejectSeries=SR,r.retry=IS,r.retryable=CR,r.seq=kE,r.series=ER,r.setImmediate=u,r.some=SS,r.someLimit=nh,r.someSeries=xS,r.sortBy=wR,r.timeout=kR,r.times=jU,r.timesLimit=ih,r.timesSeries=VU,r.transform=BU,r.tryEach=qU,r.unmemoize=JU,r.until=$U,r.waterfall=HU,r.whilst=PR,r.all=pS,r.allLimit=th,r.allSeries=dS,r.any=SS,r.anyLimit=nh,r.anySeries=xS,r.find=aS,r.findLimit=Xf,r.findSeries=lS,r.forEach=cS,r.forEachSeries=eh,r.forEachLimit=Zf,r.forEachOf=Dc,r.forEachOfSeries=Ud,r.forEachOfLimit=Uu,r.inject=Tc,r.foldl=Tc,r.foldr=yS,r.select=mS,r.selectLimit=rh,r.selectSeries=fS,r.wrapSync=d,Object.defineProperty(r,"__esModule",{value:!0})})});var vF=M((urt,TH)=>{"use strict";function fge(r){t.debug=t,t.default=t,t.coerce=l,t.disable=s,t.enable=o,t.enabled=a,t.humanize=qk(),Object.keys(r).forEach(function(c){t[c]=r[c]}),t.instances=[],t.names=[],t.skips=[],t.formatters={};function e(c){for(var u=0,d=0;d<c.length;d++)u=(u<<5)-u+c.charCodeAt(d),u|=0;return t.colors[Math.abs(u)%t.colors.length]}t.selectColor=e;function t(c){var u;function d(){if(d.enabled){for(var f=arguments.length,h=new Array(f),v=0;v<f;v++)h[v]=arguments[v];var S=d,b=Number(new Date),D=b-(u||b);S.diff=D,S.prev=u,S.curr=b,u=b,h[0]=t.coerce(h[0]),typeof h[0]!="string"&&h.unshift("%O");var _=0;h[0]=h[0].replace(/%([a-zA-Z%])/g,function(Z,Se){if(Z==="%%")return Z;_++;var ie=t.formatters[Se];if(typeof ie=="function"){var fe=h[_];Z=ie.call(S,fe),h.splice(_,1),_--}return Z}),t.formatArgs.call(S,h);var L=S.log||t.log;L.apply(S,h)}}return d.namespace=c,d.enabled=t.enabled(c),d.useColors=t.useColors(),d.color=e(c),d.destroy=n,d.extend=i,typeof t.init=="function"&&t.init(d),t.instances.push(d),d}function n(){var c=t.instances.indexOf(this);return c!==-1?(t.instances.splice(c,1),!0):!1}function i(c,u){return t(this.namespace+(typeof u>"u"?":":u)+c)}function o(c){t.save(c),t.names=[],t.skips=[];var u,d=(typeof c=="string"?c:"").split(/[\s,]+/),f=d.length;for(u=0;u<f;u++)d[u]&&(c=d[u].replace(/\*/g,".*?"),c[0]==="-"?t.skips.push(new RegExp("^"+c.substr(1)+"$")):t.names.push(new RegExp("^"+c+"$")));for(u=0;u<t.instances.length;u++){var h=t.instances[u];h.enabled=t.enabled(h.namespace)}}function s(){t.enable("")}function a(c){if(c[c.length-1]==="*")return!0;var u,d;for(u=0,d=t.skips.length;u<d;u++)if(t.skips[u].test(c))return!1;for(u=0,d=t.names.length;u<d;u++)if(t.names[u].test(c))return!0;return!1}function l(c){return c instanceof Error?c.stack||c.message:c}return t.enable(t.load()),t}TH.exports=fge});var _H=M((Qs,JT)=>{"use strict";function qT(r){return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?qT=function(t){return typeof t}:qT=function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},qT(r)}Qs.log=vge;Qs.formatArgs=gge;Qs.save=yge;Qs.load=bge;Qs.useColors=hge;Qs.storage=Ige();Qs.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"];function hge(){return typeof window<"u"&&window.process&&(window.process.type==="renderer"||window.process.__nwjs)?!0:typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/)?!1:typeof document<"u"&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||typeof window<"u"&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31||typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)}function gge(r){if(r[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+r[0]+(this.useColors?"%c ":" ")+"+"+JT.exports.humanize(this.diff),!!this.useColors){var e="color: "+this.color;r.splice(1,0,e,"color: inherit");var t=0,n=0;r[0].replace(/%[a-zA-Z%]/g,function(i){i!=="%%"&&(t++,i==="%c"&&(n=t))}),r.splice(n,0,e)}}function vge(){var r;return(typeof console>"u"?"undefined":qT(console))==="object"&&console.log&&(r=console).log.apply(r,arguments)}function yge(r){try{r?Qs.storage.setItem("debug",r):Qs.storage.removeItem("debug")}catch{}}function bge(){var r;try{r=Qs.storage.getItem("debug")}catch{}return!r&&typeof process<"u"&&"env"in process&&(r=process.env.DEBUG),r}function Ige(){try{return localStorage}catch{}}JT.exports=vF()(Qs);var Sge=JT.exports.formatters;Sge.j=function(r){try{return JSON.stringify(r)}catch(e){return"[UnexpectedJSONParseError]: "+e.message}}});var NH=M(($i,GT)=>{"use strict";var xge=require("tty"),HT=require("util");$i.init=Tge;$i.log=kge;$i.formatArgs=Ege;$i.save=Pge;$i.load=Dge;$i.useColors=Cge;$i.colors=[6,2,3,4,5,1];try{$T=$k(),$T&&($T.stderr||$T).level>=2&&($i.colors=[20,21,26,27,32,33,38,39,40,41,42,43,44,45,56,57,62,63,68,69,74,75,76,77,78,79,80,81,92,93,98,99,112,113,128,129,134,135,148,149,160,161,162,163,164,165,166,167,168,169,170,171,172,173,178,179,184,185,196,197,198,199,200,201,202,203,204,205,206,207,208,209,214,215,220,221])}catch{}var $T;$i.inspectOpts=Object.keys(process.env).filter(function(r){return/^debug_/i.test(r)}).reduce(function(r,e){var t=e.substring(6).toLowerCase().replace(/_([a-z])/g,function(i,o){return o.toUpperCase()}),n=process.env[e];return/^(yes|on|true|enabled)$/i.test(n)?n=!0:/^(no|off|false|disabled)$/i.test(n)?n=!1:n==="null"?n=null:n=Number(n),r[t]=n,r},{});function Cge(){return"colors"in $i.inspectOpts?!!$i.inspectOpts.colors:xge.isatty(process.stderr.fd)}function Ege(r){var e=this.namespace,t=this.useColors;if(t){var n=this.color,i="\x1B[3"+(n<8?n:"8;5;"+n),o="  ".concat(i,";1m").concat(e," \x1B[0m");r[0]=o+r[0].split(`
`).join(`
`+o),r.push(i+"m+"+GT.exports.humanize(this.diff)+"\x1B[0m")}else r[0]=wge()+e+" "+r[0]}function wge(){return $i.inspectOpts.hideDate?"":new Date().toISOString()+" "}function kge(){return process.stderr.write(HT.format.apply(HT,arguments)+`
`)}function Pge(r){r?process.env.DEBUG=r:delete process.env.DEBUG}function Dge(){return process.env.DEBUG}function Tge(r){r.inspectOpts={};for(var e=Object.keys($i.inspectOpts),t=0;t<e.length;t++)r.inspectOpts[e[t]]=$i.inspectOpts[e[t]]}GT.exports=vF()($i);var RH=GT.exports.formatters;RH.o=function(r){return this.inspectOpts.colors=this.useColors,HT.inspect(r,this.inspectOpts).split(`
`).map(function(e){return e.trim()}).join(" ")};RH.O=function(r){return this.inspectOpts.colors=this.useColors,HT.inspect(r,this.inspectOpts)}});var AH=M((prt,yF)=>{"use strict";typeof process>"u"||process.type==="renderer"||process.browser===!0||process.__nwjs?yF.exports=_H():yF.exports=NH()});var FH=M((drt,KH)=>{var AC=require("path"),MH=require("fs"),OH=parseInt("0777",8);KH.exports=Ry.mkdirp=Ry.mkdirP=Ry;function Ry(r,e,t,n){typeof e=="function"?(t=e,e={}):(!e||typeof e!="object")&&(e={mode:e});var i=e.mode,o=e.fs||MH;i===void 0&&(i=OH),n||(n=null);var s=t||function(){};r=AC.resolve(r),o.mkdir(r,i,function(a){if(!a)return n=n||r,s(null,n);switch(a.code){case"ENOENT":if(AC.dirname(r)===r)return s(a);Ry(AC.dirname(r),e,function(l,c){l?s(l,c):Ry(r,e,s,c)});break;default:o.stat(r,function(l,c){l||!c.isDirectory()?s(a,n):s(null,n)});break}})}Ry.sync=function r(e,t,n){(!t||typeof t!="object")&&(t={mode:t});var i=t.mode,o=t.fs||MH;i===void 0&&(i=OH),n||(n=null),e=AC.resolve(e);try{o.mkdirSync(e,i),n=n||e}catch(a){switch(a.code){case"ENOENT":n=r(AC.dirname(e),t,n),r(e,t,n);break;default:var s;try{s=o.statSync(e)}catch{throw a}if(!s.isDirectory())throw a;break}}return n}});var WH=M(Rr=>{"use strict";var LH=require("fs"),_ge=require("os"),Rge=require("net"),zT=require("path"),UH=DH(),SF=AH(),Nge=FH().mkdirp,bF=SF("portfinder:testPort"),MC=SF("portfinder:getPort"),Age=SF("portfinder:defaultHosts"),IF={};IF.testPort=function(r,e){e||(e=r,r={}),r.server=r.server||Rge.createServer(function(){}),bF("entered testPort(): trying",r.host,"port",r.port);function t(){bF("done w/ testPort(): OK",r.host,"port",r.port),r.server.removeListener("error",n),r.server.close(),e(null,r.port)}function n(i){if(bF("done w/ testPort(): failed",r.host,"w/ port",r.port,"with error",i.code),r.server.removeListener("listening",t),!(i.code=="EADDRINUSE"||i.code=="EACCES"))return e(i);var o=Rr.nextPort(r.port);if(o>Rr.highestPort)return e(new Error("No open ports available"));IF.testPort({port:o,host:r.host,server:r.server},e)}r.server.once("error",n),r.server.once("listening",t),r.host?r.server.listen(r.port,r.host):r.server.listen(r.port)};Rr.basePort=8e3;Rr.highestPort=65535;Rr.basePath="/tmp/portfinder";Rr.getPort=function(r,e){if(e||(e=r,r={}),r.port=Number(r.port)||Number(Rr.basePort),r.host=r.host||null,r.stopPort=Number(r.stopPort)||Number(Rr.highestPort),!r.startPort){if(r.startPort=Number(r.port),r.startPort<0)throw Error("Provided options.startPort("+r.startPort+") is less than 0, which are cannot be bound.");if(r.stopPort<r.startPort)throw Error("Provided options.stopPort("+r.stopPort+"is less than options.startPort ("+r.startPort+")")}if(r.host){for(var t,n=0;n<Rr._defaultHosts.length;n++)if(Rr._defaultHosts[n]===r.host){t=!0;break}t||Rr._defaultHosts.push(r.host)}var i=[],o;return UH.eachSeries(Rr._defaultHosts,function(s,a){return MC("in eachSeries() iteration callback: host is",s),IF.testPort({host:s,port:r.port},function(l,c){return l?(MC("in eachSeries() iteration callback testPort() callback","with an err:",l.code),o=s,a(l)):(MC("in eachSeries() iteration callback testPort() callback","with a success for port",c),i.push(c),a())})},function(s){if(s)if(MC("in eachSeries() result callback: err is",s),s.code==="EADDRNOTAVAIL"||s.code==="EINVAL")if(r.host===o){var a="Provided host "+r.host+" could NOT be bound. Please provide a different host address or hostname";return e(Error(a))}else{var l=Rr._defaultHosts.indexOf(o);return Rr._defaultHosts.splice(l,1),Rr.getPort(r,e)}else return e(s);if(i.sort(function(c,u){return c-u}),MC("in eachSeries() result callback: openPorts is",i),i[0]===i[i.length-1]){if(i[0]<=r.stopPort)return e(null,i[0]);var a="No open ports found in between "+r.startPort+" and "+r.stopPort;return e(Error(a))}else return Rr.getPort({port:i.pop(),host:r.host,startPort:r.startPort,stopPort:r.stopPort},e)})};Rr.getPortPromise=function(r){if(typeof Promise!="function")throw Error("Native promise support is not available in this version of node.Please install a polyfill and assign Promise to global.Promise before calling this method");return r||(r={}),new Promise(function(e,t){Rr.getPort(r,function(n,i){if(n)return t(n);e(i)})})};Rr.getPorts=function(r,e,t){t||(t=e,e={});var n=null;UH.timesSeries(r,function(i,o){n&&(e.port=Rr.nextPort(n)),Rr.getPort(e,function(s,a){s?o(s):(n=a,o(null,a))})},t)};Rr.getSocket=function(r,e){e||(e=r,r={}),r.mod=r.mod||parseInt(755,8),r.path=r.path||Rr.basePath+".sock";function t(){LH.stat(r.path,function(o){o?o.code=="ENOENT"?e(null,r.path):e(o):(r.path=Rr.nextSocket(r.path),Rr.getSocket(r,e))})}function n(o){Nge(o,r.mod,function(s){if(s)return e(s);r.exists=!0,t()})}function i(){var o=zT.dirname(r.path);LH.stat(o,function(s,a){if(s||!a.isDirectory())return n(o);r.exists=!0,t()})}return r.exists?t():i()};Rr.nextPort=function(r){return r+1};Rr.nextSocket=function(r){var e=zT.dirname(r),t=zT.basename(r,".sock"),n=t.match(/^([a-zA-z]+)(\d*)$/i),i=parseInt(n[2]),o=n[1];return isNaN(i)&&(i=0),i+=1,zT.join(e,o+i+".sock")};Rr._defaultHosts=function(){var r={};try{r=_ge.networkInterfaces()}catch(l){if(l.syscall!=="uv_interface_addresses")throw l}for(var e=Object.keys(r),t="0.0.0.0",n=[t],i=0;i<e.length;i++)for(var o=r[e[i]],s=0;s<o.length;s++){var a=o[s];n.push(a.address)}return n.push(null),Age("exports._defaultHosts is: %o",n),n}()});var HH=M(Ny=>{"use strict";Object.defineProperty(Ny,"__esModule",{value:!0});Ny.encode=Ny.decode=void 0;var qH=require("crypto"),CF="<IDS|MSG>",Mge=5;function ZT(r){return JSON.parse(r.toString())}function JH(r){return Object.assign({},{header:{},parent_header:{},metadata:{},content:{},idents:[],buffers:[]},r)}function $H(r){let e=r;switch(r){case"hmac-sha256":e="sha256";break}return e}function Oge(r,e,t="sha256"){var n=0;let i=[];for(n=0;n<r.length;n++){var o=r[n];if(o.toString()===CF)break;i.push(o)}if(r.length-n<Mge)throw new Error("Message Decoding: Not enough message frames");if(r[n].toString()!==CF)throw new Error("Message Decoding: Missing delimiter");if(e){let u=$H(t);var s=r[n+1].toString(),a=qH.createHmac(u,e);a.update(r[n+2]),a.update(r[n+3]),a.update(r[n+4]),a.update(r[n+5]);var l=a.digest("hex");if(l!==s)throw new Error(`Message Decoding: Incorrect;
Obtained "${s}"
Expected "${l}"`)}var c=JH({idents:i,header:ZT(r[n+2]),parent_header:ZT(r[n+3]),content:ZT(r[n+5]),metadata:ZT(r[n+4]),buffers:Array.prototype.slice.apply(r,[n+6])});return c}Ny.decode=Oge;function Kge(r,e,t="sha256"){let n=JH(r),i=$H(t),o=n.idents,s=Buffer.from(JSON.stringify(n.header),"utf-8"),a=Buffer.from(JSON.stringify(n.parent_header),"utf-8"),l=Buffer.from(JSON.stringify(n.metadata),"utf-8"),c=Buffer.from(JSON.stringify(n.content),"utf-8"),u="";if(e){let f=qH.createHmac(i,e);f.update(s),f.update(a),f.update(l),f.update(c),u=f.digest("hex")}var d=o.concat([Buffer.from(CF),Buffer.from(u),s,a,l,c]).concat(n.buffers);return d}Ny.encode=Kge});var N4=M((Ndt,R4)=>{"use strict";var ove=(r,e={})=>{let t=e.safe===!0||e.keepProtected===!0,n=!1,i=(o,s)=>{let a="",l,c;for(let u of o.nodes)switch(u.type){case"block":if(e.first&&n===!0){a+=i(u,o);break}if(e.preserveNewlines===!0){l=i(u,o),c=l.split(`
`),a+=`
`.repeat(c.length-1);break}if(t===!0&&u.protected===!0){a+=i(u,o);break}n=!0;break;case"line":if(e.first&&n===!0){a+=u.value;break}t===!0&&u.protected===!0&&(a+=u.value),n=!0;break;case"open":case"close":case"text":case"newline":default:{a+=u.value||"";break}}return a};return i(r)};R4.exports=ove});var M4=M((Adt,A4)=>{"use strict";var N_=class{constructor(e){this.type=e.type,e.value&&(this.value=e.value),e.match&&(this.match=e.match),this.newline=e.newline||""}get protected(){return!!this.match&&this.match[1]==="!"}},AF=class extends N_{constructor(e){super(e),this.nodes=e.nodes||[]}push(e){this.nodes.push(e)}get protected(){return this.nodes.length>0&&this.nodes[0].protected===!0}};A4.exports={Node:N_,Block:AF}});var K4=M(O4=>{"use strict";O4.javascript={BLOCK_OPEN_REGEX:/^\/\*\*?(!?)/,BLOCK_CLOSE_REGEX:/^\*\/(\n?)/,LINE_REGEX:/^\/\/(!?).*/}});var U4=M((Odt,L4)=>{"use strict";var{Node:gd,Block:F4}=M4(),sve=K4(),MF={ESCAPED_CHAR_REGEX:/^\\./,QUOTED_STRING_REGEX:/^(['"`])((?:\\.|[^\1])+?)(\1)/,NEWLINE_REGEX:/^\r*\n/},ave=(r,e={})=>{if(typeof r!="string")throw new TypeError("Expected input to be a string");let t=new F4({type:"root",nodes:[]}),n=[t],i=(e.language||"javascript").toLowerCase(),o=sve[i];if(typeof o>"u")throw new Error(`Language "${i}" is not supported by strip-comments`);let{LINE_REGEX:s,BLOCK_OPEN_REGEX:a,BLOCK_CLOSE_REGEX:l}=o,c=t,u=r,d,f,h=[a,l].filter(Boolean),v=!1;h.every(L=>L.source==='^"""')&&(v=!0);let S=(L=u[0]||"")=>(u=u.slice(L.length),L),b=(L,Z="text")=>{let Se=L.exec(u);if(Se)return S(Se[0]),{type:Z,value:Se[0],match:Se}},D=L=>{if(f&&f.type==="text"&&L.type==="text"){f.value+=L.value;return}c.push(L),L.nodes&&(n.push(L),c=L),f=L},_=()=>{if(c.type==="root")throw new SyntaxError("Unclosed block comment");n.pop(),c=n[n.length-1]};for(;u!=="";){if(d=b(MF.ESCAPED_CHAR_REGEX,"text")){D(new gd(d));continue}if(c.type!=="block"&&(!f||!/\w$/.test(f.value))&&!(v&&u.startsWith('"""'))&&(d=b(MF.QUOTED_STRING_REGEX,"text"))){D(new gd(d));continue}if(d=b(MF.NEWLINE_REGEX,"newline")){D(new gd(d));continue}if(a&&e.block&&!(v&&c.type==="block")&&(d=b(a,"open"))){D(new F4({type:"block"})),D(new gd(d));continue}if(l&&c.type==="block"&&e.block&&(d=b(l,"close"))){d.newline=d.match[1]||"",D(new gd(d)),_();continue}if(s&&c.type!=="block"&&e.line&&(d=b(s,"line"))){D(new gd(d));continue}if(d=b(/^[a-zABD-Z0-9\t ]+/,"text")){D(new gd(d));continue}D(new gd({type:"text",value:S(u[0])}))}return t};L4.exports=ave});var j4=M((Kdt,W4)=>{"use strict";var A_=N4(),LC=U4(),M_=W4.exports=(r,e)=>{let t={...e,block:!0,line:!0};return A_(LC(r,t),t)};M_.block=(r,e)=>{let t={...e,block:!0};return A_(LC(r,t),t)};M_.line=(r,e)=>{let t={...e,line:!0};return A_(LC(r,t),t)};M_.first=(r,e)=>{let t={...e,block:!0,line:!0,first:!0};return A_(LC(r,t),t)};M_.parse=LC});var PG=M((I_t,kG)=>{var Kve=typeof global=="object"&&global&&global.Object===Object&&global;kG.exports=Kve});var TG=M((S_t,DG)=>{var Fve=PG(),Lve=typeof self=="object"&&self&&self.Object===Object&&self,Uve=Fve||Lve||Function("return this")();DG.exports=Uve});var k0=M((x_t,_G)=>{var Wve=TG(),jve=Wve.Symbol;_G.exports=jve});var NG=M((C_t,RG)=>{function Vve(r,e){for(var t=-1,n=r==null?0:r.length,i=Array(n);++t<n;)i[t]=e(r[t],t,r);return i}RG.exports=Vve});var MG=M((E_t,AG)=>{var Bve=Array.isArray;AG.exports=Bve});var LG=M((w_t,FG)=>{var OG=k0(),KG=Object.prototype,qve=KG.hasOwnProperty,Jve=KG.toString,ZC=OG?OG.toStringTag:void 0;function $ve(r){var e=qve.call(r,ZC),t=r[ZC];try{r[ZC]=void 0;var n=!0}catch{}var i=Jve.call(r);return n&&(e?r[ZC]=t:delete r[ZC]),i}FG.exports=$ve});var WG=M((k_t,UG)=>{var Hve=Object.prototype,Gve=Hve.toString;function zve(r){return Gve.call(r)}UG.exports=zve});var qG=M((P_t,BG)=>{var jG=k0(),Qve=LG(),Yve=WG(),Xve="[object Null]",Zve="[object Undefined]",VG=jG?jG.toStringTag:void 0;function eye(r){return r==null?r===void 0?Zve:Xve:VG&&VG in Object(r)?Qve(r):Yve(r)}BG.exports=eye});var $G=M((D_t,JG)=>{function tye(r){return r!=null&&typeof r=="object"}JG.exports=tye});var GG=M((T_t,HG)=>{var rye=qG(),nye=$G(),iye="[object Symbol]";function oye(r){return typeof r=="symbol"||nye(r)&&rye(r)==iye}HG.exports=oye});var ez=M((__t,ZG)=>{var zG=k0(),sye=NG(),aye=MG(),lye=GG(),cye=1/0,QG=zG?zG.prototype:void 0,YG=QG?QG.toString:void 0;function XG(r){if(typeof r=="string")return r;if(aye(r))return sye(r,XG)+"";if(lye(r))return YG?YG.call(r):"";var e=r+"";return e=="0"&&1/r==-cye?"-0":e}ZG.exports=XG});var rz=M((R_t,tz)=>{var uye=ez();function pye(r){return r==null?"":uye(r)}tz.exports=pye});var oz=M((N_t,iz)=>{var dye=rz(),nz=/[\\^$.*+?()[\]{}|]/g,mye=RegExp(nz.source);function fye(r){return r=dye(r),r&&mye.test(r)?r.replace(nz,"\\$&"):r}iz.exports=fye});var yL=M((M3t,Yz)=>{Yz.exports=require("util").format});var abe={};zU(abe,{activate:()=>Gye,deactivate:()=>zye});module.exports=YU(abe);Reflect.metadata===void 0&&ZU();function ES(){try{return(tW(),YU(eW)).isPreRelesVersionOfJupyterExtension===!0?"true":"false"}catch{return"true"}}var wS={isExiting:!1},jd="_builtin.JupyterServerSelectorForTesting",kS="_builtin.jupyterServerUrlProvider";function rW(r){return r===jd||r===kS}var xe="python",PS="markdown",el="vscode-notebook-cell",gQ={scheme:"untitled",language:xe},vQ={scheme:"file",language:xe},AE={language:xe},yQ={scheme:el,language:xe},nW=[gQ,vQ,yQ],DS="vscode-interactive-input",Ct="jupyter-notebook",wt="interactive",Vd=[{language:xe,notebookType:Ct},{language:xe,notebookType:wt},{scheme:DS,language:xe},{scheme:el,language:xe}],bt="ms-toolsai.jupyter",sh="ms-toolsai.jupyter-hub",iW="0c6ae279ed8443289764825290e4f9e2-1a736e7c-1324-4338-be46-fc2a58ae4d14-7255",Wu="STANDARD_OUTPUT_CHANNEL",TS;(t=>(t.PythonInteractiveHelpLink="https://aka.ms/pyaiinstall",t.JupyterDataRateHelpLink="https://aka.ms/AA5ggm0"))(TS||={});var Qt;(u=>(u.JupyterServerLocalLaunch="local",u.JupyterServerRemoteLaunch="remote",u.JupyterServerUriList="jupyter.jupyterServer.uriList",u.JupyterServerRemoteLaunchUriListKey="remote-uri-list",u.JupyterServerRemoteLaunchUriSeparator="\r",u.JupyterServerRemoteLaunchNameSeparator=`
`,u.JupyterServerRemoteLaunchUriEqualsDisplayName="same",u.JupyterServerRemoteLaunchService=bt,u.JupyterServerUriListMax=10,u.IntellisenseTimeout=2e3))(Qt||={});var fi=!1;var bQ=!1;function Pr(){return bQ||_S()}var IQ=!1;function _S(){return IQ}var Le;(b=>(b.GeneratedThemeName="ipython-theme",b.RawPurpose="raw",b.MatplotLibDefaultParams="_VSCode_defaultMatplotlib_Params",b.MatplotLibFigureFormats="_VSCode_matplotLib_FigureFormats",b.DefaultCodeCellMarker="# %%",b.DefaultCommTarget="jupyter.widget",b.ALL_VARIABLES="ALL_VARIABLES",b.KERNEL_VARIABLES="KERNEL_VARIABLES",b.DEBUGGER_VARIABLES="DEBUGGER_VARIABLES",b.PYTHON_VARIABLES_REQUESTER="PYTHON_VARIABLES_REQUESTER",b.MULTIPLEXING_DEBUGSERVICE="MULTIPLEXING_DEBUGSERVICE",b.RUN_BY_LINE_DEBUGSERVICE="RUN_BY_LINE_DEBUGSERVICE",b.REMOTE_URI="https://remote/",b.REMOTE_URI_ID_PARAM="id",b.REMOTE_URI_HANDLE_PARAM="uriHandle",b.REMOTE_URI_EXTENSION_ID_PARAM="extensionId"))(Le||={});var da;(o=>(o.ImportIPython=`{0}
from IPython import get_ipython

{1}`,o.MatplotLibInit=`import matplotlib
%matplotlib inline
${Le.MatplotLibDefaultParams} = dict(matplotlib.rcParams)
`,o.AppendSVGFigureFormat=`import matplotlib_inline.backend_inline
${Le.MatplotLibFigureFormats} = matplotlib_inline.backend_inline.InlineBackend.instance().figure_formats
${Le.MatplotLibFigureFormats}.add('svg')
matplotlib_inline.backend_inline.set_matplotlib_formats(*${Le.MatplotLibFigureFormats})`,o.UpdateCWDAndPath=`import os as _VSCODE_os
import sys as _VSCODE_sys
%cd "{0}"
if _VSCODE_os.getcwd() not in _VSCODE_sys.path:
    _VSCODE_sys.path.insert(0, _VSCODE_os.getcwd())

del _VSCODE_sys
del _VSCODE_os`,o.DisableJedi="%config Completer.use_jedi = False"))(da||={});var ah="JUPYTER_OUTPUT_CHANNEL",_R="Default Light+",hi="ms-python.python",lh="ms-toolsai.jupyter-renderers",Bd="ms-python.vscode-pylance",oW=["python","html","xml","javascript","markdown","latex","shellscript","bat","powershell","kusto","ruby","sql","perl","qsharp","raw"],sW=new Map([["bash","shellscript"],["c#","csharp"],["f#","fsharp"],["q#","qsharp"],["c++11","c++"],["c++12","c++"],["c++14","c++"]]),RS=["python","r","julia","c++","c#","f#","q#","powershell","java","scala","haskell","bash","cling","rust","sas","sos","ocaml"];var V;(Ee=>(Ee.RunAllCells="jupyter.runallcells",Ee.RunAllCellsAbove="jupyter.runallcellsabove",Ee.RunCellAndAllBelow="jupyter.runcellandallbelow",Ee.RunAllCellsAbovePalette="jupyter.runallcellsabove.palette",Ee.RunCellAndAllBelowPalette="jupyter.runcurrentcellandallbelow.palette",Ee.RunToLine="jupyter.runtoline",Ee.RunFromLine="jupyter.runfromline",Ee.RunCell="jupyter.runcell",Ee.RunCurrentCell="jupyter.runcurrentcell",Ee.RunCurrentCellAdvance="jupyter.runcurrentcelladvance",Ee.CreateNewInteractive="jupyter.createnewinteractive",Ee.ImportNotebook="jupyter.importnotebook",Ee.ImportNotebookFile="jupyter.importnotebookfile",Ee.ExportFileAsNotebook="jupyter.exportfileasnotebook",Ee.ExportFileAndOutputAsNotebook="jupyter.exportfileandoutputasnotebook",Ee.InterruptKernel="jupyter.interruptkernel",Ee.RestartKernel="jupyter.restartkernel",Ee.RestartKernelAndRunAllCells="jupyter.restartkernelandrunallcells",Ee.RestartKernelAndRunUpToSelectedCell="jupyter.restartkernelandrunuptoselectedcell",Ee.NotebookEditorRemoveAllCells="jupyter.notebookeditor.removeallcells",Ee.NotebookEditorRunAllCells="jupyter.notebookeditor.runallcells",Ee.NotebookEditorRunSelectedCell="jupyter.notebookeditor.runselectedcell",Ee.NotebookEditorAddCellBelow="jupyter.notebookeditor.addcellbelow",Ee.ExpandAllCells="jupyter.expandallcells",Ee.CollapseAllCells="jupyter.collapseallcells",Ee.ExportOutputAsNotebook="jupyter.exportoutputasnotebook",Ee.ExecSelectionInInteractiveWindow="jupyter.execSelectionInteractive",Ee.RunFileInInteractiveWindows="jupyter.runFileInteractive",Ee.DebugFileInInteractiveWindows="jupyter.debugFileInteractive",Ee.AddCellBelow="jupyter.addcellbelow",Ee.DebugCurrentCellPalette="jupyter.debugcurrentcell.palette",Ee.DebugCell="jupyter.debugcell",Ee.DebugStepOver="jupyter.debugstepover",Ee.DebugContinue="jupyter.debugcontinue",Ee.DebugStop="jupyter.debugstop",Ee.RunCurrentCellAndAddBelow="jupyter.runcurrentcellandaddbelow",Ee.InsertCellBelowPosition="jupyter.insertCellBelowPosition",Ee.InsertCellBelow="jupyter.insertCellBelow",Ee.InsertCellAbove="jupyter.insertCellAbove",Ee.DeleteCells="jupyter.deleteCells",Ee.SelectCell="jupyter.selectCell",Ee.SelectCellContents="jupyter.selectCellContents",Ee.ExtendSelectionByCellAbove="jupyter.extendSelectionByCellAbove",Ee.ExtendSelectionByCellBelow="jupyter.extendSelectionByCellBelow",Ee.MoveCellsUp="jupyter.moveCellsUp",Ee.MoveCellsDown="jupyter.moveCellsDown",Ee.ChangeCellToMarkdown="jupyter.changeCellToMarkdown",Ee.ChangeCellToCode="jupyter.changeCellToCode",Ee.GotoNextCellInFile="jupyter.gotoNextCellInFile",Ee.GotoPrevCellInFile="jupyter.gotoPrevCellInFile",Ee.ScrollToCell="jupyter.scrolltocell",Ee.CreateNewNotebook="jupyter.createnewnotebook",Ee.ViewJupyterOutput="jupyter.viewOutput",Ee.ExportAsPythonScript="jupyter.exportAsPythonScript",Ee.ExportToHTML="jupyter.exportToHTML",Ee.ExportToPDF="jupyter.exportToPDF",Ee.Export="jupyter.export",Ee.NativeNotebookExport="jupyter.notebookeditor.export",Ee.LatestExtension="jupyter.latestExtension",Ee.EnableLoadingWidgetsFrom3rdPartySource="jupyter.enableLoadingWidgetScriptsFromThirdPartySource",Ee.NotebookEditorExpandAllCells="jupyter.notebookeditor.expandallcells",Ee.NotebookEditorCollapseAllCells="jupyter.notebookeditor.collapseallcells",Ee.EnableDebugLogging="jupyter.enableDebugLogging",Ee.ResetLoggingLevel="jupyter.resetLoggingLevel",Ee.ShowDataViewer="jupyter.showDataViewer",Ee.RefreshDataViewer="jupyter.refreshDataViewer",Ee.ClearSavedJupyterUris="jupyter.clearSavedJupyterUris",Ee.OpenVariableView="jupyter.openVariableView",Ee.OpenOutlineView="jupyter.openOutlineView",Ee.InteractiveClearAll="jupyter.interactive.clearAllCells",Ee.InteractiveGoToCode="jupyter.interactive.goToCode",Ee.InteractiveCopyCell="jupyter.interactive.copyCell",Ee.InteractiveExportAsNotebook="jupyter.interactive.exportasnotebook",Ee.InteractiveExportAs="jupyter.interactive.exportas",Ee.RunByLine="jupyter.runByLine",Ee.RunAndDebugCell="jupyter.runAndDebugCell",Ee.RunByLineNext="jupyter.runByLineNext",Ee.RunByLineStop="jupyter.runByLineStop",Ee.ReplayPylanceLog="jupyter.replayPylanceLog",Ee.ReplayPylanceLogStep="jupyter.replayPylanceLogStep",Ee.InstallPythonExtensionViaKernelPicker="jupyter.installPythonExtensionViaKernelPicker",Ee.InstallPythonViaKernelPicker="jupyter.installPythonViaKernelPicker",Ee.ContinueEditSessionInCodespace="jupyter.continueEditSessionInCodespace"))(V||={});var ju;(n=>(n.DefaultDesignLenses=[V.RunCurrentCell,V.RunAllCellsAbove,V.DebugCell],n.DefaultDebuggingLenses=[V.DebugContinue,V.DebugStop,V.DebugStepOver],n.DebuggerCommands=[V.DebugContinue,V.DebugStop,V.DebugStepOver]))(ju||={});var fr;(de=>(de.HasCodeCells="jupyter.hascodecells",de.IsInteractiveActive="jupyter.isinteractiveactive",de.OwnsSelection="jupyter.ownsSelection",de.HaveNativeCells="jupyter.havenativecells",de.HaveNative="jupyter.havenative",de.IsNativeActive="jupyter.isnativeactive",de.IsInteractiveOrNativeActive="jupyter.isinteractiveornativeactive",de.IsPythonOrNativeActive="jupyter.ispythonornativeactive",de.IsPythonOrInteractiveActive="jupyter.ispythonorinteractiveeactive",de.IsPythonOrInteractiveOrNativeActive="jupyter.ispythonorinteractiveornativeeactive",de.CanRestartNotebookKernel="jupyter.notebookeditor.canrestartNotebookkernel",de.CanInterruptNotebookKernel="jupyter.notebookeditor.canInterruptNotebookKernel",de.CanRestartInteractiveWindowKernel="jupyter.interactive.canRestartNotebookKernel",de.CanInterruptInteractiveWindowKernel="jupyter.interactive.canInterruptNotebookKernel",de.RunByLineCells="jupyter.notebookeditor.runByLineCells",de.RunByLineDocuments="jupyter.notebookeditor.runByLineDocuments",de.DebugDocuments="jupyter.notebookeditor.debugDocuments",de.IsPythonNotebook="jupyter.ispythonnotebook",de.IsJupyterKernelSelected="jupyter.kernel.isjupyter",de.IsDataViewerActive="jupyter.dataViewerActive",de.HasNativeNotebookOrInteractiveWindowOpen="jupyter.hasNativeNotebookOrInteractiveWindowOpen",de.ZmqAvailable="jupyter.zmqavailable",de.ReplayLogLoaded="jupyter.replayLogLoaded",de.KernelSource="jupyter.kernelSource"))(fr||={});var qd;(l=>(l.PythonCellMarker=/^(#\s*%%|#\s*\<codecell\>|#\s*In\[\d*?\]|#\s*In\[ \])/,l.PythonMarkdownCellMarker=/^(#\s*%%\s*\[markdown\]|#\s*\<markdowncell\>)/,l.UrlPatternRegEx="(?<PREFIX>https?:\\/\\/)((\\(.+\\s+or\\s+(?<IP>.+)\\))|(?<LOCAL>[^\\s]+))(?<REST>:.+)",l.HttpPattern=/https?:\/\//,l.ShapeSplitterRegEx=/.*,\s*(\d+).*/,l.SvgHeightRegex=/(\<svg.*height=\")(.*?)\"/,l.SvgWidthRegex=/(\<svg.*width=\")(.*?)\"/,l.SvgSizeTagRegex=/\<svg.*tag=\"sizeTag=\{(.*),\s*(.*)\}\"/))(qd||={});var aW=Symbol("DataScienceStartupTime"),RR={major:4,minor:2},Xi="application/vnd.jupyter.widget-view+json";var NS=7,AS="unknown";var OS=class{constructor(e,t){this._data=t;this.expiryTime=e+Date.now()}get expired(){let e=this.expiryTime<=Date.now();return e&&(this._data=void 0),e}get data(){return this.expired&&(this._data=void 0),this._data}},MS=new Map;function lW(){return MS}function cW(r,e){let t=e.map(n=>`${JSON.stringify(n)}`).join("-Arg-Separator-");return`KeyPrefix=${r}-Args=${t}`}var Jd=class{constructor(e,t=""){this.expiryDurationMs=e;this.cacheKey=t}get hasData(){let e=MS.get(this.cacheKey);return!!(e&&!e.expired)}get data(){return this.hasData?MS.get(this.cacheKey)?.data:void 0}set data(e){let t=new OS(this.expiryDurationMs,e);MS.set(this.cacheKey,t)}clear(){MS.delete(this.cacheKey)}};async function Vn(r){return new Promise(e=>{setTimeout(()=>e(r),r)})}async function uh(r,e,t){return new Promise(n=>{let i,o=setTimeout(()=>i(!1),e),s=setInterval(()=>{r().then(a=>{a&&i(!0)}).catch(a=>i(!1))},t);i=a=>{clearTimeout(o),clearInterval(s),n(a)}})}function Dr(r,e,...t){let n=ME(e)?void 0:e;ME(e)&&t.push(e);let i,o=setTimeout(()=>i?.(n),r);return Promise.race([Promise.race(t).finally(()=>clearTimeout(o)),new Promise(s=>i=s)])}function OE(r,e,...t){let n,i=setTimeout(()=>n?.(e),r);return Promise.race([Promise.race(t).finally(()=>clearTimeout(i)),new Promise((o,s)=>n=s)])}function $d(r){return typeof r?.then=="function"&&typeof r?.catch=="function"}function ME(r){return typeof r?.then=="function"}var NR=class{constructor(e=null){this.scope=e;this._resolved=!1;this._rejected=!1;this._promise=new Promise((t,n)=>{this._resolve=t,this._reject=n})}get value(){return this._value}resolve(e){this._value=e,this._resolve.apply(this.scope?this.scope:this,arguments),this._resolved=!0}reject(e){this._reject.apply(this.scope?this.scope:this,arguments),this._rejected=!0}get promise(){return this._promise}get resolved(){return this._resolved}get rejected(){return this._rejected}get completed(){return this._rejected||this._resolved}};function pe(r=null){return new NR(r)}function Vu(r){let e=pe();return r.then(e.resolve.bind(e)).catch(e.reject.bind(e)),e}var ch=class{constructor(){this.currentPromise=Promise.resolve(void 0)}async chain(e){let t=pe(),n=this.currentPromise;return this.currentPromise=this.currentPromise.then(async()=>{try{let i=await e();t.resolve(i)}catch(i){throw t.reject(i),i}}),await n,t.promise}chainFinally(e){let t=pe();return this.currentPromise=this.currentPromise.finally(()=>e().then(n=>t.resolve(n)).catch(n=>t.reject(n))),t.promise}};var $e=class{constructor(){this.started=Date.now()}get elapsedTime(){return Date.now()-this.started}reset(){this.started=Date.now()}};function m(){}function kn(r){try{let e=r();$d(e)&&e.catch(m)}catch{}}function AR(r,e,t){let n=new $e;try{t&&r(void 0);let i=e();return $d(i)?i.then(o=>(r({elapsed:n.elapsedTime,returnValue:o}),o)).catch(o=>{r({elapsed:n.elapsedTime,err:o})}):r({elapsed:n.elapsedTime,returnValue:i}),i}catch(i){throw r({elapsed:n.elapsedTime,err:i}),i}}function Bu(r){if(!r)return!0;let e=r;return typeof e.path=="string"&&typeof e.scheme=="string"}function ti(r){if(!r)return!1;let e=r;return typeof e.path=="string"&&typeof e.scheme=="string"}function KE(r){let e=ti(r)?r:r.uri;return e.scheme.includes(el)||e.path.endsWith(".interactive")}function ph(){return process.platform.toString()==="web"}function uW(r,e){return ti(e)?e.toString():e}function tl(r,e){return r===e?!0:r&&!e?!1:JSON.stringify(r,uW)===JSON.stringify(e,uW)}var pW=lW();function MR(r){return function(e,t,n){let i=n.value,s=`Cache_Method_Output_${"constructor"in e&&e.constructor.name?e.constructor.name:""}.${t}`;n.value=async function(...a){if(Pr())return i.apply(this,a);let l=cW(s,a),c=pW.get(l);if(c&&!c.expired)return w(`Cached data exists ${l}`),Promise.resolve(c.data);let u=i.apply(this,a);return u.then(d=>pW.set(l,new OS(r,d))).catch(m),u}}}function Br(r){return function(e,t,n){let i=n.value,o=`Jupyter Extension (Error in ${r||t}, method:${t}):`;n.value=function(...s){try{let a=i.apply(this,s);if(a&&typeof a.then=="function"&&typeof a.catch=="function")return a.catch(l=>{Pr()||C(o,l)})}catch(a){if(Pr())return;C(o,a)}}}}function dW(r,e){return function(t,n,i){let o=i.value;return i.value=function(...s){let a={kind:"Class",name:t&&t.constructor?t.constructor.name:"",args:s,methodName:n,target:t},l=this;return AR(c=>r(a,c),()=>o.apply(l,s),e)},i}}function qu(){return function(r,e,t){let n=t.value;return t.value=function(...i){if(!Pr())throw new Error(`Function: ${e} can only be called from test code`);return n.apply(this,i)},t}}function OR(){return function(r,e,t){let n=t.value,i=`chainedPromiseFor_${e}`;return t.value=async function(...o){let s=this[i];s?s=s.then(()=>n.apply(this,o)):s=n.apply(this,o),this[i]=s;let a=s.then(l=>l).catch(l=>{throw this[i]=void 0,l});return a.catch(m),a},t}}function KR(r,e){if(Array.isArray(r))return r.map(t=>KR(t,e)).join(", ");if(r===void 0)return"undefined";if(r===null)return"null";try{return r&&r.path?`<Uri:${r.path}>`:JSON.stringify(r)}catch{return`<${e} cannot be serialized for logging>`}}function FR(r){if(!r)return"";try{return r.map((t,n)=>{let i=KR(t,"argument");return`Arg ${n+1}: ${i}`}).join(", ")}catch{return""}}function mW(r){return`Return Value: ${KR(r,"Return value")}`}function FE(){let r=new Date,e=String(r.getHours()).padStart(2,"0"),t=String(r.getMinutes()).padStart(2,"0"),n=String(r.getSeconds()).padStart(2,"0"),i=String(r.getMilliseconds()).padStart(3,"0");return`${e}:${t}:${n}.${i}`}function je(r,e={removeEmptyEntries:!0,trim:!0}){r=r||"";let t=r.split(/\r?\n/g);return e&&e.trim&&(t=t.map(n=>n.trim())),e&&e.removeEmptyEntries&&(t=t.filter(n=>n.length>0)),t}function KS(r){return r&&(r.indexOf(" ")>=0&&!r.startsWith('"')&&!r.endsWith('"')?`"${r}"`:r.toString())}function FS(r){return r&&KS(r).replace(/\\/g,"/")}function Hd(r){return r&&r.replace(/(^['"])|(['"]$)/g,"")}function rl(r,...e){return r.replace(/{(\d+)}/g,(t,n)=>e[n]===void 0?t:e[n])}function dh(r){return r?r.replace(/\$\([a-z0-9\-]+?\)/gi,"").trim():r||""}var GR=require("vscode");var UE="en",jE=!1,VE=!1,LS=!1,SQ=!1,xQ=!1,UR=!1,CQ=!1,EQ=!1,wQ=!1,LE,WE=UE,kQ,$u,Is=typeof self=="object"?self:typeof global=="object"?global:{},vo;typeof Is.vscode<"u"&&typeof Is.vscode.process<"u"?vo=Is.vscode.process:typeof process<"u"&&(vo=process);var fW=typeof vo?.versions?.electron=="string",hW=fW&&vo?.type==="renderer",_be=hW&&vo?.sandboxed;if(typeof navigator=="object"&&!hW)$u=navigator.userAgent,jE=$u.indexOf("Windows")>=0,VE=$u.indexOf("Macintosh")>=0,EQ=($u.indexOf("Macintosh")>=0||$u.indexOf("iPad")>=0||$u.indexOf("iPhone")>=0)&&!!navigator.maxTouchPoints&&navigator.maxTouchPoints>0,LS=$u.indexOf("Linux")>=0,UR=!0,LE=navigator.language,WE=LE;else if(typeof vo=="object"){jE=vo.platform==="win32",VE=vo.platform==="darwin",LS=vo.platform==="linux",SQ=LS&&!!vo.env.SNAP&&!!vo.env.SNAP_REVISION,CQ=fW,wQ=!!vo.env.CI||!!vo.env.BUILD_ARTIFACTSTAGINGDIRECTORY,LE=UE,WE=UE;let r=vo.env.VSCODE_NLS_CONFIG;if(r)try{let e=JSON.parse(r),t=e.availableLanguages["*"];LE=e.locale,WE=t||UE,kQ=e._translationsConfigFile}catch{}xQ=!0}else console.error("Unable to resolve platform.");var LR=0;VE?LR=1:jE?LR=3:LS&&(LR=2);var US=jE,gW=VE,vW=LS;var BE=UR,Rbe=UR&&typeof Is.importScripts=="function";var nl=$u,Ju=WE,PQ;(n=>{function r(){return Ju}n.value=r;function e(){return Ju.length===2?Ju==="en":Ju.length>=3?Ju[0]==="e"&&Ju[1]==="n"&&Ju[2]==="-":!1}n.isDefaultVariant=e;function t(){return Ju==="en"}n.isDefault=t})(PQ||={});var Nbe=(()=>{if(typeof Is.postMessage=="function"&&!Is.importScripts){let r=[];Is.addEventListener("message",t=>{if(t.data&&t.data.vscodeScheduleAsyncWork)for(let n=0,i=r.length;n<i;n++){let o=r[n];if(o.id===t.data.vscodeScheduleAsyncWork){r.splice(n,1),o.callback();return}}});let e=0;return t=>{let n=++e;r.push({id:n,callback:t}),Is.postMessage({vscodeScheduleAsyncWork:n},"*")}}return r=>setTimeout(r)})();var DQ=!!(nl&&nl.indexOf("Chrome")>=0),Abe=!!(nl&&nl.indexOf("Firefox")>=0),Mbe=!!(!DQ&&nl&&nl.indexOf("Safari")>=0),Obe=!!(nl&&nl.indexOf("Edg/")>=0),Kbe=!!(nl&&nl.indexOf("Android")>=0);var Gd;if(typeof Is.vscode<"u"&&typeof Is.vscode.process<"u"){let r=Is.vscode.process;Gd={get platform(){return r.platform},get arch(){return r.arch},get env(){return r.env},cwd(){return r.cwd()}}}else typeof process<"u"?Gd={get platform(){return process.platform},get arch(){return process.arch},get env(){return process.env},cwd(){return process.env.VSCODE_CWD||process.cwd()}}:Gd={get platform(){return US?"win32":gW?"darwin":"linux"},get arch(){},get env(){return{}},cwd(){return"/"}};var qE=Gd.cwd,yW=Gd.env,yo=Gd.platform,Wbe=Gd.arch;var _Q=65,RQ=97,NQ=90,AQ=122,zu=46,ri=47,bo=92,Hu=58,MQ=63,JE=class extends Error{constructor(t,n,i){let o;typeof n=="string"&&n.indexOf("not ")===0?(o="must not be",n=n.replace(/^not /,"")):o="must be";let s=t.indexOf(".")!==-1?"property":"argument",a=`The "${t}" ${s} ${o} of type ${n}`;a+=`. Received type ${typeof i}`;super(a);this.code="ERR_INVALID_ARG_TYPE"}};function bn(r,e){if(typeof r!="string")throw new JE(e,"string",r)}function Kt(r){return r===ri||r===bo}function WR(r){return r===ri}function Gu(r){return r>=_Q&&r<=NQ||r>=RQ&&r<=AQ}function $E(r,e,t,n){let i="",o=0,s=-1,a=0,l=0;for(let c=0;c<=r.length;++c){if(c<r.length)l=r.charCodeAt(c);else{if(n(l))break;l=ri}if(n(l)){if(!(s===c-1||a===1))if(a===2){if(i.length<2||o!==2||i.charCodeAt(i.length-1)!==zu||i.charCodeAt(i.length-2)!==zu){if(i.length>2){let u=i.lastIndexOf(t);u===-1?(i="",o=0):(i=i.slice(0,u),o=i.length-1-i.lastIndexOf(t)),s=c,a=0;continue}else if(i.length!==0){i="",o=0,s=c,a=0;continue}}e&&(i+=i.length>0?`${t}..`:"..",o=2)}else i.length>0?i+=`${t}${r.slice(s+1,c)}`:i=r.slice(s+1,c),o=c-s-1;s=c,a=0}else l===zu&&a!==-1?++a:a=-1}return i}function bW(r,e){if(e===null||typeof e!="object")throw new JE("pathObject","Object",e);let t=e.dir||e.root,n=e.base||`${e.name||""}${e.ext||""}`;return t?t===e.root?`${t}${n}`:`${t}${r}${n}`:n}var _n={resolve(...r){let e="",t="",n=!1;for(let i=r.length-1;i>=-1;i--){let o;if(i>=0){if(o=r[i],bn(o,"path"),o.length===0)continue}else e.length===0?o=qE():(o=yW[`=${e}`]||qE(),(o===void 0||o.slice(0,2).toLowerCase()!==e.toLowerCase()&&o.charCodeAt(2)===bo)&&(o=`${e}\\`));let s=o.length,a=0,l="",c=!1,u=o.charCodeAt(0);if(s===1)Kt(u)&&(a=1,c=!0);else if(Kt(u))if(c=!0,Kt(o.charCodeAt(1))){let d=2,f=d;for(;d<s&&!Kt(o.charCodeAt(d));)d++;if(d<s&&d!==f){let h=o.slice(f,d);for(f=d;d<s&&Kt(o.charCodeAt(d));)d++;if(d<s&&d!==f){for(f=d;d<s&&!Kt(o.charCodeAt(d));)d++;(d===s||d!==f)&&(l=`\\\\${h}\\${o.slice(f,d)}`,a=d)}}}else a=1;else Gu(u)&&o.charCodeAt(1)===Hu&&(l=o.slice(0,2),a=2,s>2&&Kt(o.charCodeAt(2))&&(c=!0,a=3));if(l.length>0)if(e.length>0){if(l.toLowerCase()!==e.toLowerCase())continue}else e=l;if(n){if(e.length>0)break}else if(t=`${o.slice(a)}\\${t}`,n=c,c&&e.length>0)break}return t=$E(t,!n,"\\",Kt),n?`${e}\\${t}`:`${e}${t}`||"."},normalize(r){bn(r,"path");let e=r.length;if(e===0)return".";let t=0,n,i=!1,o=r.charCodeAt(0);if(e===1)return WR(o)?"\\":r;if(Kt(o))if(i=!0,Kt(r.charCodeAt(1))){let a=2,l=a;for(;a<e&&!Kt(r.charCodeAt(a));)a++;if(a<e&&a!==l){let c=r.slice(l,a);for(l=a;a<e&&Kt(r.charCodeAt(a));)a++;if(a<e&&a!==l){for(l=a;a<e&&!Kt(r.charCodeAt(a));)a++;if(a===e)return`\\\\${c}\\${r.slice(l)}\\`;a!==l&&(n=`\\\\${c}\\${r.slice(l,a)}`,t=a)}}}else t=1;else Gu(o)&&r.charCodeAt(1)===Hu&&(n=r.slice(0,2),t=2,e>2&&Kt(r.charCodeAt(2))&&(i=!0,t=3));let s=t<e?$E(r.slice(t),!i,"\\",Kt):"";return s.length===0&&!i&&(s="."),s.length>0&&Kt(r.charCodeAt(e-1))&&(s+="\\"),n===void 0?i?`\\${s}`:s:i?`${n}\\${s}`:`${n}${s}`},isAbsolute(r){bn(r,"path");let e=r.length;if(e===0)return!1;let t=r.charCodeAt(0);return Kt(t)||e>2&&Gu(t)&&r.charCodeAt(1)===Hu&&Kt(r.charCodeAt(2))},join(...r){if(r.length===0)return".";let e,t;for(let o=0;o<r.length;++o){let s=r[o];bn(s,"path"),s.length>0&&(e===void 0?e=t=s:e+=`\\${s}`)}if(e===void 0)return".";let n=!0,i=0;if(typeof t=="string"&&Kt(t.charCodeAt(0))){++i;let o=t.length;o>1&&Kt(t.charCodeAt(1))&&(++i,o>2&&(Kt(t.charCodeAt(2))?++i:n=!1))}if(n){for(;i<e.length&&Kt(e.charCodeAt(i));)i++;i>=2&&(e=`\\${e.slice(i)}`)}return _n.normalize(e)},relative(r,e){if(bn(r,"from"),bn(e,"to"),r===e)return"";let t=_n.resolve(r),n=_n.resolve(e);if(t===n||(r=t.toLowerCase(),e=n.toLowerCase(),r===e))return"";let i=0;for(;i<r.length&&r.charCodeAt(i)===bo;)i++;let o=r.length;for(;o-1>i&&r.charCodeAt(o-1)===bo;)o--;let s=o-i,a=0;for(;a<e.length&&e.charCodeAt(a)===bo;)a++;let l=e.length;for(;l-1>a&&e.charCodeAt(l-1)===bo;)l--;let c=l-a,u=s<c?s:c,d=-1,f=0;for(;f<u;f++){let v=r.charCodeAt(i+f);if(v!==e.charCodeAt(a+f))break;v===bo&&(d=f)}if(f!==u){if(d===-1)return n}else{if(c>u){if(e.charCodeAt(a+f)===bo)return n.slice(a+f+1);if(f===2)return n.slice(a+f)}s>u&&(r.charCodeAt(i+f)===bo?d=f:f===2&&(d=3)),d===-1&&(d=0)}let h="";for(f=i+d+1;f<=o;++f)(f===o||r.charCodeAt(f)===bo)&&(h+=h.length===0?"..":"\\..");return a+=d,h.length>0?`${h}${n.slice(a,l)}`:(n.charCodeAt(a)===bo&&++a,n.slice(a,l))},toNamespacedPath(r){if(typeof r!="string")return r;if(r.length===0)return"";let e=_n.resolve(r);if(e.length<=2)return r;if(e.charCodeAt(0)===bo){if(e.charCodeAt(1)===bo){let t=e.charCodeAt(2);if(t!==MQ&&t!==zu)return`\\\\?\\UNC\\${e.slice(2)}`}}else if(Gu(e.charCodeAt(0))&&e.charCodeAt(1)===Hu&&e.charCodeAt(2)===bo)return`\\\\?\\${e}`;return r},dirname(r){bn(r,"path");let e=r.length;if(e===0)return".";let t=-1,n=0,i=r.charCodeAt(0);if(e===1)return Kt(i)?r:".";if(Kt(i)){if(t=n=1,Kt(r.charCodeAt(1))){let a=2,l=a;for(;a<e&&!Kt(r.charCodeAt(a));)a++;if(a<e&&a!==l){for(l=a;a<e&&Kt(r.charCodeAt(a));)a++;if(a<e&&a!==l){for(l=a;a<e&&!Kt(r.charCodeAt(a));)a++;if(a===e)return r;a!==l&&(t=n=a+1)}}}}else Gu(i)&&r.charCodeAt(1)===Hu&&(t=e>2&&Kt(r.charCodeAt(2))?3:2,n=t);let o=-1,s=!0;for(let a=e-1;a>=n;--a)if(Kt(r.charCodeAt(a))){if(!s){o=a;break}}else s=!1;if(o===-1){if(t===-1)return".";o=t}return r.slice(0,o)},basename(r,e){e!==void 0&&bn(e,"ext"),bn(r,"path");let t=0,n=-1,i=!0,o;if(r.length>=2&&Gu(r.charCodeAt(0))&&r.charCodeAt(1)===Hu&&(t=2),e!==void 0&&e.length>0&&e.length<=r.length){if(e===r)return"";let s=e.length-1,a=-1;for(o=r.length-1;o>=t;--o){let l=r.charCodeAt(o);if(Kt(l)){if(!i){t=o+1;break}}else a===-1&&(i=!1,a=o+1),s>=0&&(l===e.charCodeAt(s)?--s===-1&&(n=o):(s=-1,n=a))}return t===n?n=a:n===-1&&(n=r.length),r.slice(t,n)}for(o=r.length-1;o>=t;--o)if(Kt(r.charCodeAt(o))){if(!i){t=o+1;break}}else n===-1&&(i=!1,n=o+1);return n===-1?"":r.slice(t,n)},extname(r){bn(r,"path");let e=0,t=-1,n=0,i=-1,o=!0,s=0;r.length>=2&&r.charCodeAt(1)===Hu&&Gu(r.charCodeAt(0))&&(e=n=2);for(let a=r.length-1;a>=e;--a){let l=r.charCodeAt(a);if(Kt(l)){if(!o){n=a+1;break}continue}i===-1&&(o=!1,i=a+1),l===zu?t===-1?t=a:s!==1&&(s=1):t!==-1&&(s=-1)}return t===-1||i===-1||s===0||s===1&&t===i-1&&t===n+1?"":r.slice(t,i)},format:bW.bind(null,"\\"),parse(r){bn(r,"path");let e={root:"",dir:"",base:"",ext:"",name:""};if(r.length===0)return e;let t=r.length,n=0,i=r.charCodeAt(0);if(t===1)return Kt(i)?(e.root=e.dir=r,e):(e.base=e.name=r,e);if(Kt(i)){if(n=1,Kt(r.charCodeAt(1))){let d=2,f=d;for(;d<t&&!Kt(r.charCodeAt(d));)d++;if(d<t&&d!==f){for(f=d;d<t&&Kt(r.charCodeAt(d));)d++;if(d<t&&d!==f){for(f=d;d<t&&!Kt(r.charCodeAt(d));)d++;d===t?n=d:d!==f&&(n=d+1)}}}}else if(Gu(i)&&r.charCodeAt(1)===Hu){if(t<=2)return e.root=e.dir=r,e;if(n=2,Kt(r.charCodeAt(2))){if(t===3)return e.root=e.dir=r,e;n=3}}n>0&&(e.root=r.slice(0,n));let o=-1,s=n,a=-1,l=!0,c=r.length-1,u=0;for(;c>=n;--c){if(i=r.charCodeAt(c),Kt(i)){if(!l){s=c+1;break}continue}a===-1&&(l=!1,a=c+1),i===zu?o===-1?o=c:u!==1&&(u=1):o!==-1&&(u=-1)}return a!==-1&&(o===-1||u===0||u===1&&o===a-1&&o===s+1?e.base=e.name=r.slice(s,a):(e.name=r.slice(s,o),e.base=r.slice(s,a),e.ext=r.slice(o,a))),s>0&&s!==n?e.dir=r.slice(0,s-1):e.dir=e.root,e},sep:"\\",delimiter:";",win32:null,posix:null},Tr={resolve(...r){let e="",t=!1;for(let n=r.length-1;n>=-1&&!t;n--){let i=n>=0?r[n]:qE();bn(i,"path"),i.length!==0&&(e=`${i}/${e}`,t=i.charCodeAt(0)===ri)}return e=$E(e,!t,"/",WR),t?`/${e}`:e.length>0?e:"."},normalize(r){if(bn(r,"path"),r.length===0)return".";let e=r.charCodeAt(0)===ri,t=r.charCodeAt(r.length-1)===ri;return r=$E(r,!e,"/",WR),r.length===0?e?"/":t?"./":".":(t&&(r+="/"),e?`/${r}`:r)},isAbsolute(r){return bn(r,"path"),r.length>0&&r.charCodeAt(0)===ri},join(...r){if(r.length===0)return".";let e;for(let t=0;t<r.length;++t){let n=r[t];bn(n,"path"),n.length>0&&(e===void 0?e=n:e+=`/${n}`)}return e===void 0?".":Tr.normalize(e)},relative(r,e){if(bn(r,"from"),bn(e,"to"),r===e||(r=Tr.resolve(r),e=Tr.resolve(e),r===e))return"";let t=1,n=r.length,i=n-t,o=1,s=e.length-o,a=i<s?i:s,l=-1,c=0;for(;c<a;c++){let d=r.charCodeAt(t+c);if(d!==e.charCodeAt(o+c))break;d===ri&&(l=c)}if(c===a)if(s>a){if(e.charCodeAt(o+c)===ri)return e.slice(o+c+1);if(c===0)return e.slice(o+c)}else i>a&&(r.charCodeAt(t+c)===ri?l=c:c===0&&(l=0));let u="";for(c=t+l+1;c<=n;++c)(c===n||r.charCodeAt(c)===ri)&&(u+=u.length===0?"..":"/..");return`${u}${e.slice(o+l)}`},toNamespacedPath(r){return r},dirname(r){if(bn(r,"path"),r.length===0)return".";let e=r.charCodeAt(0)===ri,t=-1,n=!0;for(let i=r.length-1;i>=1;--i)if(r.charCodeAt(i)===ri){if(!n){t=i;break}}else n=!1;return t===-1?e?"/":".":e&&t===1?"//":r.slice(0,t)},basename(r,e){e!==void 0&&bn(e,"ext"),bn(r,"path");let t=0,n=-1,i=!0,o;if(e!==void 0&&e.length>0&&e.length<=r.length){if(e===r)return"";let s=e.length-1,a=-1;for(o=r.length-1;o>=0;--o){let l=r.charCodeAt(o);if(l===ri){if(!i){t=o+1;break}}else a===-1&&(i=!1,a=o+1),s>=0&&(l===e.charCodeAt(s)?--s===-1&&(n=o):(s=-1,n=a))}return t===n?n=a:n===-1&&(n=r.length),r.slice(t,n)}for(o=r.length-1;o>=0;--o)if(r.charCodeAt(o)===ri){if(!i){t=o+1;break}}else n===-1&&(i=!1,n=o+1);return n===-1?"":r.slice(t,n)},extname(r){bn(r,"path");let e=-1,t=0,n=-1,i=!0,o=0;for(let s=r.length-1;s>=0;--s){let a=r.charCodeAt(s);if(a===ri){if(!i){t=s+1;break}continue}n===-1&&(i=!1,n=s+1),a===zu?e===-1?e=s:o!==1&&(o=1):e!==-1&&(o=-1)}return e===-1||n===-1||o===0||o===1&&e===n-1&&e===t+1?"":r.slice(e,n)},format:bW.bind(null,"/"),parse(r){bn(r,"path");let e={root:"",dir:"",base:"",ext:"",name:""};if(r.length===0)return e;let t=r.charCodeAt(0)===ri,n;t?(e.root="/",n=1):n=0;let i=-1,o=0,s=-1,a=!0,l=r.length-1,c=0;for(;l>=n;--l){let u=r.charCodeAt(l);if(u===ri){if(!a){o=l+1;break}continue}s===-1&&(a=!1,s=l+1),u===zu?i===-1?i=l:c!==1&&(c=1):i!==-1&&(c=-1)}if(s!==-1){let u=o===0&&t?1:o;i===-1||c===0||c===1&&i===s-1&&i===o+1?e.base=e.name=r.slice(u,s):(e.name=r.slice(u,i),e.base=r.slice(u,s),e.ext=r.slice(i,s))}return o>0?e.dir=r.slice(0,o-1):t&&(e.dir="/"),e},sep:"/",delimiter:":",win32:null,posix:null};Tr.win32=_n.win32=_n;Tr.posix=_n.posix=Tr;var Pn=yo==="win32"?_n.normalize:Tr.normalize,mh=yo==="win32"?_n.isAbsolute:Tr.isAbsolute,Ue=yo==="win32"?_n.join:Tr.join,IW=yo==="win32"?_n.resolve:Tr.resolve,HE=yo==="win32"?_n.relative:Tr.relative,pt=yo==="win32"?_n.dirname:Tr.dirname,Te=yo==="win32"?_n.basename:Tr.basename,Zi=yo==="win32"?_n.extname:Tr.extname,jbe=yo==="win32"?_n.format:Tr.format,SW=yo==="win32"?_n.parse:Tr.parse,Vbe=yo==="win32"?_n.toNamespacedPath:Tr.toNamespacedPath,ni=yo==="win32"?_n.sep:Tr.sep,ii=yo==="win32"?_n.delimiter:Tr.delimiter;var jS=require("vscode");var OQ=require("vscode");var GE=class{constructor(e){this.computeFn=e;this.lastCache=void 0;this.lastArgKey=void 0}get(e){let t=JSON.stringify(e);return this.lastArgKey!==t&&(this.lastArgKey=t,this.lastCache=this.computeFn(e)),this.lastCache}};var WS=class r{constructor(e){this.executor=e;this._didRun=!1}hasValue(){return this._didRun}getValue(){if(!this._didRun)try{this._value=this.executor()}catch(e){this._error=e}finally{this._didRun=!0}if(this._error)throw this._error;return this._value}get rawValue(){return this._value}map(e){return new r(()=>e(this.getValue()))}};function VR(r,e){return r<e?-1:r>e?1:0}function wW(r,e,t=0,n=r.length,i=0,o=e.length){for(;t<n&&i<o;t++,i++){let l=r.charCodeAt(t),c=e.charCodeAt(i);if(l<c)return-1;if(l>c)return 1}let s=n-t,a=o-i;return s<a?-1:s>a?1:0}function BR(r,e,t=0,n=r.length,i=0,o=e.length){for(;t<n&&i<o;t++,i++){let l=r.charCodeAt(t),c=e.charCodeAt(i);if(l===c)continue;if(l>=128||c>=128)return wW(r.toLowerCase(),e.toLowerCase(),t,n,i,o);xW(l)&&(l-=32),xW(c)&&(c-=32);let u=l-c;if(u!==0)return u}let s=n-t,a=o-i;return s<a?-1:s>a?1:0}function xW(r){return r>=97&&r<=122}function kW(r,e){return r.length===e.length&&BR(r,e)===0}function PW(r,e){let t=e.length;return e.length>r.length?!1:BR(r,e,0,t)===0}var CW=class r{constructor(e){this.confusableDictionary=e}static{this.ambiguousCharacterData=new WS(()=>JSON.parse('{"_common":[8232,32,8233,32,5760,32,8192,32,8193,32,8194,32,8195,32,8196,32,8197,32,8198,32,8200,32,8201,32,8202,32,8287,32,8199,32,8239,32,2042,95,65101,95,65102,95,65103,95,8208,45,8209,45,8210,45,65112,45,1748,45,8259,45,727,45,8722,45,10134,45,11450,45,1549,44,1643,44,8218,44,184,44,42233,44,894,59,2307,58,2691,58,1417,58,1795,58,1796,58,5868,58,65072,58,6147,58,6153,58,8282,58,1475,58,760,58,42889,58,8758,58,720,58,42237,58,451,33,11601,33,660,63,577,63,2429,63,5038,63,42731,63,119149,46,8228,46,1793,46,1794,46,42510,46,68176,46,1632,46,1776,46,42232,46,1373,96,65287,96,8219,96,8242,96,1370,96,1523,96,8175,96,65344,96,900,96,8189,96,8125,96,8127,96,8190,96,697,96,884,96,712,96,714,96,715,96,756,96,699,96,701,96,700,96,702,96,42892,96,1497,96,2036,96,2037,96,5194,96,5836,96,94033,96,94034,96,65339,91,10088,40,10098,40,12308,40,64830,40,65341,93,10089,41,10099,41,12309,41,64831,41,10100,123,119060,123,10101,125,65342,94,8270,42,1645,42,8727,42,66335,42,5941,47,8257,47,8725,47,8260,47,9585,47,10187,47,10744,47,119354,47,12755,47,12339,47,11462,47,20031,47,12035,47,65340,92,65128,92,8726,92,10189,92,10741,92,10745,92,119311,92,119355,92,12756,92,20022,92,12034,92,42872,38,708,94,710,94,5869,43,10133,43,66203,43,8249,60,10094,60,706,60,119350,60,5176,60,5810,60,5120,61,11840,61,12448,61,42239,61,8250,62,10095,62,707,62,119351,62,5171,62,94015,62,8275,126,732,126,8128,126,8764,126,65372,124,65293,45,120784,50,120794,50,120804,50,120814,50,120824,50,130034,50,42842,50,423,50,1000,50,42564,50,5311,50,42735,50,119302,51,120785,51,120795,51,120805,51,120815,51,120825,51,130035,51,42923,51,540,51,439,51,42858,51,11468,51,1248,51,94011,51,71882,51,120786,52,120796,52,120806,52,120816,52,120826,52,130036,52,5070,52,71855,52,120787,53,120797,53,120807,53,120817,53,120827,53,130037,53,444,53,71867,53,120788,54,120798,54,120808,54,120818,54,120828,54,130038,54,11474,54,5102,54,71893,54,119314,55,120789,55,120799,55,120809,55,120819,55,120829,55,130039,55,66770,55,71878,55,2819,56,2538,56,2666,56,125131,56,120790,56,120800,56,120810,56,120820,56,120830,56,130040,56,547,56,546,56,66330,56,2663,57,2920,57,2541,57,3437,57,120791,57,120801,57,120811,57,120821,57,120831,57,130041,57,42862,57,11466,57,71884,57,71852,57,71894,57,9082,97,65345,97,119834,97,119886,97,119938,97,119990,97,120042,97,120094,97,120146,97,120198,97,120250,97,120302,97,120354,97,120406,97,120458,97,593,97,945,97,120514,97,120572,97,120630,97,120688,97,120746,97,65313,65,119808,65,119860,65,119912,65,119964,65,120016,65,120068,65,120120,65,120172,65,120224,65,120276,65,120328,65,120380,65,120432,65,913,65,120488,65,120546,65,120604,65,120662,65,120720,65,5034,65,5573,65,42222,65,94016,65,66208,65,119835,98,119887,98,119939,98,119991,98,120043,98,120095,98,120147,98,120199,98,120251,98,120303,98,120355,98,120407,98,120459,98,388,98,5071,98,5234,98,5551,98,65314,66,8492,66,119809,66,119861,66,119913,66,120017,66,120069,66,120121,66,120173,66,120225,66,120277,66,120329,66,120381,66,120433,66,42932,66,914,66,120489,66,120547,66,120605,66,120663,66,120721,66,5108,66,5623,66,42192,66,66178,66,66209,66,66305,66,65347,99,8573,99,119836,99,119888,99,119940,99,119992,99,120044,99,120096,99,120148,99,120200,99,120252,99,120304,99,120356,99,120408,99,120460,99,7428,99,1010,99,11429,99,43951,99,66621,99,128844,67,71922,67,71913,67,65315,67,8557,67,8450,67,8493,67,119810,67,119862,67,119914,67,119966,67,120018,67,120174,67,120226,67,120278,67,120330,67,120382,67,120434,67,1017,67,11428,67,5087,67,42202,67,66210,67,66306,67,66581,67,66844,67,8574,100,8518,100,119837,100,119889,100,119941,100,119993,100,120045,100,120097,100,120149,100,120201,100,120253,100,120305,100,120357,100,120409,100,120461,100,1281,100,5095,100,5231,100,42194,100,8558,68,8517,68,119811,68,119863,68,119915,68,119967,68,120019,68,120071,68,120123,68,120175,68,120227,68,120279,68,120331,68,120383,68,120435,68,5024,68,5598,68,5610,68,42195,68,8494,101,65349,101,8495,101,8519,101,119838,101,119890,101,119942,101,120046,101,120098,101,120150,101,120202,101,120254,101,120306,101,120358,101,120410,101,120462,101,43826,101,1213,101,8959,69,65317,69,8496,69,119812,69,119864,69,119916,69,120020,69,120072,69,120124,69,120176,69,120228,69,120280,69,120332,69,120384,69,120436,69,917,69,120492,69,120550,69,120608,69,120666,69,120724,69,11577,69,5036,69,42224,69,71846,69,71854,69,66182,69,119839,102,119891,102,119943,102,119995,102,120047,102,120099,102,120151,102,120203,102,120255,102,120307,102,120359,102,120411,102,120463,102,43829,102,42905,102,383,102,7837,102,1412,102,119315,70,8497,70,119813,70,119865,70,119917,70,120021,70,120073,70,120125,70,120177,70,120229,70,120281,70,120333,70,120385,70,120437,70,42904,70,988,70,120778,70,5556,70,42205,70,71874,70,71842,70,66183,70,66213,70,66853,70,65351,103,8458,103,119840,103,119892,103,119944,103,120048,103,120100,103,120152,103,120204,103,120256,103,120308,103,120360,103,120412,103,120464,103,609,103,7555,103,397,103,1409,103,119814,71,119866,71,119918,71,119970,71,120022,71,120074,71,120126,71,120178,71,120230,71,120282,71,120334,71,120386,71,120438,71,1292,71,5056,71,5107,71,42198,71,65352,104,8462,104,119841,104,119945,104,119997,104,120049,104,120101,104,120153,104,120205,104,120257,104,120309,104,120361,104,120413,104,120465,104,1211,104,1392,104,5058,104,65320,72,8459,72,8460,72,8461,72,119815,72,119867,72,119919,72,120023,72,120179,72,120231,72,120283,72,120335,72,120387,72,120439,72,919,72,120494,72,120552,72,120610,72,120668,72,120726,72,11406,72,5051,72,5500,72,42215,72,66255,72,731,105,9075,105,65353,105,8560,105,8505,105,8520,105,119842,105,119894,105,119946,105,119998,105,120050,105,120102,105,120154,105,120206,105,120258,105,120310,105,120362,105,120414,105,120466,105,120484,105,618,105,617,105,953,105,8126,105,890,105,120522,105,120580,105,120638,105,120696,105,120754,105,1110,105,42567,105,1231,105,43893,105,5029,105,71875,105,65354,106,8521,106,119843,106,119895,106,119947,106,119999,106,120051,106,120103,106,120155,106,120207,106,120259,106,120311,106,120363,106,120415,106,120467,106,1011,106,1112,106,65322,74,119817,74,119869,74,119921,74,119973,74,120025,74,120077,74,120129,74,120181,74,120233,74,120285,74,120337,74,120389,74,120441,74,42930,74,895,74,1032,74,5035,74,5261,74,42201,74,119844,107,119896,107,119948,107,120000,107,120052,107,120104,107,120156,107,120208,107,120260,107,120312,107,120364,107,120416,107,120468,107,8490,75,65323,75,119818,75,119870,75,119922,75,119974,75,120026,75,120078,75,120130,75,120182,75,120234,75,120286,75,120338,75,120390,75,120442,75,922,75,120497,75,120555,75,120613,75,120671,75,120729,75,11412,75,5094,75,5845,75,42199,75,66840,75,1472,108,8739,73,9213,73,65512,73,1633,108,1777,73,66336,108,125127,108,120783,73,120793,73,120803,73,120813,73,120823,73,130033,73,65321,73,8544,73,8464,73,8465,73,119816,73,119868,73,119920,73,120024,73,120128,73,120180,73,120232,73,120284,73,120336,73,120388,73,120440,73,65356,108,8572,73,8467,108,119845,108,119897,108,119949,108,120001,108,120053,108,120105,73,120157,73,120209,73,120261,73,120313,73,120365,73,120417,73,120469,73,448,73,120496,73,120554,73,120612,73,120670,73,120728,73,11410,73,1030,73,1216,73,1493,108,1503,108,1575,108,126464,108,126592,108,65166,108,65165,108,1994,108,11599,73,5825,73,42226,73,93992,73,66186,124,66313,124,119338,76,8556,76,8466,76,119819,76,119871,76,119923,76,120027,76,120079,76,120131,76,120183,76,120235,76,120287,76,120339,76,120391,76,120443,76,11472,76,5086,76,5290,76,42209,76,93974,76,71843,76,71858,76,66587,76,66854,76,65325,77,8559,77,8499,77,119820,77,119872,77,119924,77,120028,77,120080,77,120132,77,120184,77,120236,77,120288,77,120340,77,120392,77,120444,77,924,77,120499,77,120557,77,120615,77,120673,77,120731,77,1018,77,11416,77,5047,77,5616,77,5846,77,42207,77,66224,77,66321,77,119847,110,119899,110,119951,110,120003,110,120055,110,120107,110,120159,110,120211,110,120263,110,120315,110,120367,110,120419,110,120471,110,1400,110,1404,110,65326,78,8469,78,119821,78,119873,78,119925,78,119977,78,120029,78,120081,78,120185,78,120237,78,120289,78,120341,78,120393,78,120445,78,925,78,120500,78,120558,78,120616,78,120674,78,120732,78,11418,78,42208,78,66835,78,3074,111,3202,111,3330,111,3458,111,2406,111,2662,111,2790,111,3046,111,3174,111,3302,111,3430,111,3664,111,3792,111,4160,111,1637,111,1781,111,65359,111,8500,111,119848,111,119900,111,119952,111,120056,111,120108,111,120160,111,120212,111,120264,111,120316,111,120368,111,120420,111,120472,111,7439,111,7441,111,43837,111,959,111,120528,111,120586,111,120644,111,120702,111,120760,111,963,111,120532,111,120590,111,120648,111,120706,111,120764,111,11423,111,4351,111,1413,111,1505,111,1607,111,126500,111,126564,111,126596,111,65259,111,65260,111,65258,111,65257,111,1726,111,64428,111,64429,111,64427,111,64426,111,1729,111,64424,111,64425,111,64423,111,64422,111,1749,111,3360,111,4125,111,66794,111,71880,111,71895,111,66604,111,1984,79,2534,79,2918,79,12295,79,70864,79,71904,79,120782,79,120792,79,120802,79,120812,79,120822,79,130032,79,65327,79,119822,79,119874,79,119926,79,119978,79,120030,79,120082,79,120134,79,120186,79,120238,79,120290,79,120342,79,120394,79,120446,79,927,79,120502,79,120560,79,120618,79,120676,79,120734,79,11422,79,1365,79,11604,79,4816,79,2848,79,66754,79,42227,79,71861,79,66194,79,66219,79,66564,79,66838,79,9076,112,65360,112,119849,112,119901,112,119953,112,120005,112,120057,112,120109,112,120161,112,120213,112,120265,112,120317,112,120369,112,120421,112,120473,112,961,112,120530,112,120544,112,120588,112,120602,112,120646,112,120660,112,120704,112,120718,112,120762,112,120776,112,11427,112,65328,80,8473,80,119823,80,119875,80,119927,80,119979,80,120031,80,120083,80,120187,80,120239,80,120291,80,120343,80,120395,80,120447,80,929,80,120504,80,120562,80,120620,80,120678,80,120736,80,11426,80,5090,80,5229,80,42193,80,66197,80,119850,113,119902,113,119954,113,120006,113,120058,113,120110,113,120162,113,120214,113,120266,113,120318,113,120370,113,120422,113,120474,113,1307,113,1379,113,1382,113,8474,81,119824,81,119876,81,119928,81,119980,81,120032,81,120084,81,120188,81,120240,81,120292,81,120344,81,120396,81,120448,81,11605,81,119851,114,119903,114,119955,114,120007,114,120059,114,120111,114,120163,114,120215,114,120267,114,120319,114,120371,114,120423,114,120475,114,43847,114,43848,114,7462,114,11397,114,43905,114,119318,82,8475,82,8476,82,8477,82,119825,82,119877,82,119929,82,120033,82,120189,82,120241,82,120293,82,120345,82,120397,82,120449,82,422,82,5025,82,5074,82,66740,82,5511,82,42211,82,94005,82,65363,115,119852,115,119904,115,119956,115,120008,115,120060,115,120112,115,120164,115,120216,115,120268,115,120320,115,120372,115,120424,115,120476,115,42801,115,445,115,1109,115,43946,115,71873,115,66632,115,65331,83,119826,83,119878,83,119930,83,119982,83,120034,83,120086,83,120138,83,120190,83,120242,83,120294,83,120346,83,120398,83,120450,83,1029,83,1359,83,5077,83,5082,83,42210,83,94010,83,66198,83,66592,83,119853,116,119905,116,119957,116,120009,116,120061,116,120113,116,120165,116,120217,116,120269,116,120321,116,120373,116,120425,116,120477,116,8868,84,10201,84,128872,84,65332,84,119827,84,119879,84,119931,84,119983,84,120035,84,120087,84,120139,84,120191,84,120243,84,120295,84,120347,84,120399,84,120451,84,932,84,120507,84,120565,84,120623,84,120681,84,120739,84,11430,84,5026,84,42196,84,93962,84,71868,84,66199,84,66225,84,66325,84,119854,117,119906,117,119958,117,120010,117,120062,117,120114,117,120166,117,120218,117,120270,117,120322,117,120374,117,120426,117,120478,117,42911,117,7452,117,43854,117,43858,117,651,117,965,117,120534,117,120592,117,120650,117,120708,117,120766,117,1405,117,66806,117,71896,117,8746,85,8899,85,119828,85,119880,85,119932,85,119984,85,120036,85,120088,85,120140,85,120192,85,120244,85,120296,85,120348,85,120400,85,120452,85,1357,85,4608,85,66766,85,5196,85,42228,85,94018,85,71864,85,8744,118,8897,118,65366,118,8564,118,119855,118,119907,118,119959,118,120011,118,120063,118,120115,118,120167,118,120219,118,120271,118,120323,118,120375,118,120427,118,120479,118,7456,118,957,118,120526,118,120584,118,120642,118,120700,118,120758,118,1141,118,1496,118,71430,118,43945,118,71872,118,119309,86,1639,86,1783,86,8548,86,119829,86,119881,86,119933,86,119985,86,120037,86,120089,86,120141,86,120193,86,120245,86,120297,86,120349,86,120401,86,120453,86,1140,86,11576,86,5081,86,5167,86,42719,86,42214,86,93960,86,71840,86,66845,86,623,119,119856,119,119908,119,119960,119,120012,119,120064,119,120116,119,120168,119,120220,119,120272,119,120324,119,120376,119,120428,119,120480,119,7457,119,1121,119,1309,119,1377,119,71434,119,71438,119,71439,119,43907,119,71919,87,71910,87,119830,87,119882,87,119934,87,119986,87,120038,87,120090,87,120142,87,120194,87,120246,87,120298,87,120350,87,120402,87,120454,87,1308,87,5043,87,5076,87,42218,87,5742,120,10539,120,10540,120,10799,120,65368,120,8569,120,119857,120,119909,120,119961,120,120013,120,120065,120,120117,120,120169,120,120221,120,120273,120,120325,120,120377,120,120429,120,120481,120,5441,120,5501,120,5741,88,9587,88,66338,88,71916,88,65336,88,8553,88,119831,88,119883,88,119935,88,119987,88,120039,88,120091,88,120143,88,120195,88,120247,88,120299,88,120351,88,120403,88,120455,88,42931,88,935,88,120510,88,120568,88,120626,88,120684,88,120742,88,11436,88,11613,88,5815,88,42219,88,66192,88,66228,88,66327,88,66855,88,611,121,7564,121,65369,121,119858,121,119910,121,119962,121,120014,121,120066,121,120118,121,120170,121,120222,121,120274,121,120326,121,120378,121,120430,121,120482,121,655,121,7935,121,43866,121,947,121,8509,121,120516,121,120574,121,120632,121,120690,121,120748,121,1199,121,4327,121,71900,121,65337,89,119832,89,119884,89,119936,89,119988,89,120040,89,120092,89,120144,89,120196,89,120248,89,120300,89,120352,89,120404,89,120456,89,933,89,978,89,120508,89,120566,89,120624,89,120682,89,120740,89,11432,89,1198,89,5033,89,5053,89,42220,89,94019,89,71844,89,66226,89,119859,122,119911,122,119963,122,120015,122,120067,122,120119,122,120171,122,120223,122,120275,122,120327,122,120379,122,120431,122,120483,122,7458,122,43923,122,71876,122,66293,90,71909,90,65338,90,8484,90,8488,90,119833,90,119885,90,119937,90,119989,90,120041,90,120197,90,120249,90,120301,90,120353,90,120405,90,120457,90,918,90,120493,90,120551,90,120609,90,120667,90,120725,90,5059,90,42204,90,71849,90,65282,34,65284,36,65285,37,65286,38,65290,42,65291,43,65294,46,65295,47,65296,48,65297,49,65298,50,65299,51,65300,52,65301,53,65302,54,65303,55,65304,56,65305,57,65308,60,65309,61,65310,62,65312,64,65316,68,65318,70,65319,71,65324,76,65329,81,65330,82,65333,85,65334,86,65335,87,65343,95,65346,98,65348,100,65350,102,65355,107,65357,109,65358,110,65361,113,65362,114,65364,116,65365,117,65367,119,65370,122,65371,123,65373,125],"_default":[160,32,8211,45,65374,126,65306,58,65281,33,8216,96,8217,96,8245,96,180,96,12494,47,1047,51,1073,54,1072,97,1040,65,1068,98,1042,66,1089,99,1057,67,1077,101,1045,69,1053,72,305,105,1050,75,921,73,1052,77,1086,111,1054,79,1009,112,1088,112,1056,80,1075,114,1058,84,215,120,1093,120,1061,88,1091,121,1059,89,65283,35,65288,40,65289,41,65292,44,65307,59,65311,63],"cs":[65374,126,65306,58,65281,33,8216,96,8217,96,8245,96,180,96,12494,47,1047,51,1073,54,1072,97,1040,65,1068,98,1042,66,1089,99,1057,67,1077,101,1045,69,1053,72,305,105,1050,75,921,73,1052,77,1086,111,1054,79,1009,112,1088,112,1056,80,1075,114,1058,84,1093,120,1061,88,1091,121,1059,89,65283,35,65288,40,65289,41,65292,44,65307,59,65311,63],"de":[65374,126,65306,58,65281,33,8216,96,8217,96,8245,96,180,96,12494,47,1047,51,1073,54,1072,97,1040,65,1068,98,1042,66,1089,99,1057,67,1077,101,1045,69,1053,72,305,105,1050,75,921,73,1052,77,1086,111,1054,79,1009,112,1088,112,1056,80,1075,114,1058,84,1093,120,1061,88,1091,121,1059,89,65283,35,65288,40,65289,41,65292,44,65307,59,65311,63],"es":[8211,45,65374,126,65306,58,65281,33,8245,96,180,96,12494,47,1047,51,1073,54,1072,97,1040,65,1068,98,1042,66,1089,99,1057,67,1077,101,1045,69,1053,72,305,105,1050,75,1052,77,1086,111,1054,79,1009,112,1088,112,1056,80,1075,114,1058,84,215,120,1093,120,1061,88,1091,121,1059,89,65283,35,65288,40,65289,41,65292,44,65307,59,65311,63],"fr":[65374,126,65306,58,65281,33,8216,96,8245,96,12494,47,1047,51,1073,54,1072,97,1040,65,1068,98,1042,66,1089,99,1057,67,1077,101,1045,69,1053,72,305,105,1050,75,921,73,1052,77,1086,111,1054,79,1009,112,1088,112,1056,80,1075,114,1058,84,215,120,1093,120,1061,88,1091,121,1059,89,65283,35,65288,40,65289,41,65292,44,65307,59,65311,63],"it":[160,32,8211,45,65374,126,65306,58,65281,33,8216,96,8245,96,180,96,12494,47,1047,51,1073,54,1072,97,1040,65,1068,98,1042,66,1089,99,1057,67,1077,101,1045,69,1053,72,305,105,1050,75,921,73,1052,77,1086,111,1054,79,1009,112,1088,112,1056,80,1075,114,1058,84,215,120,1093,120,1061,88,1091,121,1059,89,65283,35,65288,40,65289,41,65292,44,65307,59,65311,63],"ja":[8211,45,65306,58,65281,33,8216,96,8217,96,8245,96,180,96,1047,51,1073,54,1072,97,1040,65,1068,98,1042,66,1089,99,1057,67,1077,101,1045,69,1053,72,305,105,1050,75,921,73,1052,77,1086,111,1054,79,1009,112,1088,112,1056,80,1075,114,1058,84,215,120,1093,120,1061,88,1091,121,1059,89,65283,35,65292,44,65307,59],"ko":[8211,45,65374,126,65306,58,65281,33,8245,96,180,96,12494,47,1047,51,1073,54,1072,97,1040,65,1068,98,1042,66,1089,99,1057,67,1077,101,1045,69,1053,72,305,105,1050,75,921,73,1052,77,1086,111,1054,79,1009,112,1088,112,1056,80,1075,114,1058,84,215,120,1093,120,1061,88,1091,121,1059,89,65283,35,65288,40,65289,41,65292,44,65307,59,65311,63],"pl":[65374,126,65306,58,65281,33,8216,96,8217,96,8245,96,180,96,12494,47,1047,51,1073,54,1072,97,1040,65,1068,98,1042,66,1089,99,1057,67,1077,101,1045,69,1053,72,305,105,1050,75,921,73,1052,77,1086,111,1054,79,1009,112,1088,112,1056,80,1075,114,1058,84,215,120,1093,120,1061,88,1091,121,1059,89,65283,35,65288,40,65289,41,65292,44,65307,59,65311,63],"pt-BR":[65374,126,65306,58,65281,33,8216,96,8217,96,8245,96,180,96,12494,47,1047,51,1073,54,1072,97,1040,65,1068,98,1042,66,1089,99,1057,67,1077,101,1045,69,1053,72,305,105,1050,75,921,73,1052,77,1086,111,1054,79,1009,112,1088,112,1056,80,1075,114,1058,84,215,120,1093,120,1061,88,1091,121,1059,89,65283,35,65288,40,65289,41,65292,44,65307,59,65311,63],"qps-ploc":[160,32,8211,45,65374,126,65306,58,65281,33,8216,96,8217,96,8245,96,180,96,12494,47,1047,51,1073,54,1072,97,1040,65,1068,98,1042,66,1089,99,1057,67,1077,101,1045,69,1053,72,305,105,1050,75,921,73,1052,77,1086,111,1054,79,1088,112,1056,80,1075,114,1058,84,215,120,1093,120,1061,88,1091,121,1059,89,65283,35,65288,40,65289,41,65292,44,65307,59,65311,63],"ru":[65374,126,65306,58,65281,33,8216,96,8217,96,8245,96,180,96,12494,47,305,105,921,73,1009,112,215,120,65283,35,65288,40,65289,41,65292,44,65307,59,65311,63],"tr":[160,32,8211,45,65374,126,65306,58,65281,33,8245,96,180,96,12494,47,1047,51,1073,54,1072,97,1040,65,1068,98,1042,66,1089,99,1057,67,1077,101,1045,69,1053,72,1050,75,921,73,1052,77,1086,111,1054,79,1009,112,1088,112,1056,80,1075,114,1058,84,215,120,1093,120,1061,88,1091,121,1059,89,65283,35,65288,40,65289,41,65292,44,65307,59,65311,63],"zh-hans":[65374,126,65306,58,65281,33,8245,96,180,96,12494,47,1047,51,1073,54,1072,97,1040,65,1068,98,1042,66,1089,99,1057,67,1077,101,1045,69,1053,72,305,105,1050,75,921,73,1052,77,1086,111,1054,79,1009,112,1088,112,1056,80,1075,114,1058,84,215,120,1093,120,1061,88,1091,121,1059,89,65288,40,65289,41],"zh-hant":[8211,45,65374,126,180,96,12494,47,1047,51,1073,54,1072,97,1040,65,1068,98,1042,66,1089,99,1057,67,1077,101,1045,69,1053,72,305,105,1050,75,921,73,1052,77,1086,111,1054,79,1009,112,1088,112,1056,80,1075,114,1058,84,215,120,1093,120,1061,88,1091,121,1059,89,65283,35,65307,59]}'))}static{this.cache=new GE(e=>{function t(u){let d=new Map;for(let f=0;f<u.length;f+=2)d.set(u[f],u[f+1]);return d}function n(u,d){let f=new Map(u);for(let[h,v]of d)f.set(h,v);return f}function i(u,d){if(!u)return d;let f=new Map;for(let[h,v]of u)d.has(h)&&f.set(h,v);return f}let o=this.ambiguousCharacterData.getValue(),s=e.filter(u=>!u.startsWith("_")&&u in o);s.length===0&&(s=["_default"]);let a;for(let u of s){let d=t(o[u]);a=i(a,d)}let l=t(o._common),c=n(l,a);return new r(c)})}static getInstance(e){return r.cache.get(Array.from(e))}static{this._locales=new WS(()=>Object.keys(r.ambiguousCharacterData.getValue()).filter(e=>!e.startsWith("_")))}static getLocales(){return r._locales.getValue()}isAmbiguous(e){return this.confusableDictionary.has(e)}getPrimaryConfusable(e){return this.confusableDictionary.get(e)}getConfusableCodePoints(){return new Set(this.confusableDictionary.keys())}},EW=class r{static getRawData(){return JSON.parse("[9,10,11,12,13,32,127,160,173,847,1564,4447,4448,6068,6069,6155,6156,6157,6158,7355,7356,8192,8193,8194,8195,8196,8197,8198,8199,8200,8201,8202,8203,8204,8205,8206,8207,8234,8235,8236,8237,8238,8239,8287,8288,8289,8290,8291,8292,8293,8294,8295,8296,8297,8298,8299,8300,8301,8302,8303,10240,12288,12644,65024,65025,65026,65027,65028,65029,65030,65031,65032,65033,65034,65035,65036,65037,65038,65039,65279,65440,65520,65521,65522,65523,65524,65525,65526,65527,65528,65532,78844,119155,119156,119157,119158,119159,119160,119161,119162,917504,917505,917506,917507,917508,917509,917510,917511,917512,917513,917514,917515,917516,917517,917518,917519,917520,917521,917522,917523,917524,917525,917526,917527,917528,917529,917530,917531,917532,917533,917534,917535,917536,917537,917538,917539,917540,917541,917542,917543,917544,917545,917546,917547,917548,917549,917550,917551,917552,917553,917554,917555,917556,917557,917558,917559,917560,917561,917562,917563,917564,917565,917566,917567,917568,917569,917570,917571,917572,917573,917574,917575,917576,917577,917578,917579,917580,917581,917582,917583,917584,917585,917586,917587,917588,917589,917590,917591,917592,917593,917594,917595,917596,917597,917598,917599,917600,917601,917602,917603,917604,917605,917606,917607,917608,917609,917610,917611,917612,917613,917614,917615,917616,917617,917618,917619,917620,917621,917622,917623,917624,917625,917626,917627,917628,917629,917630,917631,917760,917761,917762,917763,917764,917765,917766,917767,917768,917769,917770,917771,917772,917773,917774,917775,917776,917777,917778,917779,917780,917781,917782,917783,917784,917785,917786,917787,917788,917789,917790,917791,917792,917793,917794,917795,917796,917797,917798,917799,917800,917801,917802,917803,917804,917805,917806,917807,917808,917809,917810,917811,917812,917813,917814,917815,917816,917817,917818,917819,917820,917821,917822,917823,917824,917825,917826,917827,917828,917829,917830,917831,917832,917833,917834,917835,917836,917837,917838,917839,917840,917841,917842,917843,917844,917845,917846,917847,917848,917849,917850,917851,917852,917853,917854,917855,917856,917857,917858,917859,917860,917861,917862,917863,917864,917865,917866,917867,917868,917869,917870,917871,917872,917873,917874,917875,917876,917877,917878,917879,917880,917881,917882,917883,917884,917885,917886,917887,917888,917889,917890,917891,917892,917893,917894,917895,917896,917897,917898,917899,917900,917901,917902,917903,917904,917905,917906,917907,917908,917909,917910,917911,917912,917913,917914,917915,917916,917917,917918,917919,917920,917921,917922,917923,917924,917925,917926,917927,917928,917929,917930,917931,917932,917933,917934,917935,917936,917937,917938,917939,917940,917941,917942,917943,917944,917945,917946,917947,917948,917949,917950,917951,917952,917953,917954,917955,917956,917957,917958,917959,917960,917961,917962,917963,917964,917965,917966,917967,917968,917969,917970,917971,917972,917973,917974,917975,917976,917977,917978,917979,917980,917981,917982,917983,917984,917985,917986,917987,917988,917989,917990,917991,917992,917993,917994,917995,917996,917997,917998,917999]")}static{this._data=void 0}static getData(){return this._data||(this._data=new Set(r.getRawData())),this._data}static isInvisibleCharacter(e){return r.getData().has(e)}static get codePoints(){return r.getData()}};function Qu(r){return r===47||r===92}function qR(r){return r.replace(/[\\/]/g,Tr.sep)}function DW(r){return r.indexOf("/")===-1&&(r=qR(r)),/^[a-zA-Z]:(\/|$)/.test(r)&&(r="/"+r),r}function JR(r,e=Tr.sep){if(!r)return"";let t=r.length,n=r.charCodeAt(0);if(Qu(n)){if(Qu(r.charCodeAt(1))&&!Qu(r.charCodeAt(2))){let o=3,s=o;for(;o<t&&!Qu(r.charCodeAt(o));o++);if(s!==o&&!Qu(r.charCodeAt(o+1))){for(o+=1;o<t;o++)if(Qu(r.charCodeAt(o)))return r.slice(0,o+1).replace(/[\\/]/g,e)}}return e}else if(KQ(n)&&r.charCodeAt(1)===58)return Qu(r.charCodeAt(2))?r.slice(0,2)+e:r.slice(0,2);let i=r.indexOf("://");if(i!==-1){for(i+=3;i<t;i++)if(Qu(r.charCodeAt(i)))return r.slice(0,i+1)}return""}function $R(r,e,t,n=ni){if(r===e)return!0;if(!r||!e||e.length>r.length)return!1;if(t){if(!PW(r,e))return!1;if(e.length===r.length)return!0;let o=e.length;return e.charAt(e.length-1)===n&&o--,r.charAt(o)===n}return e.charAt(e.length-1)!==n&&(e+=n),r.indexOf(e)===0}function KQ(r){return r>=65&&r<=90||r>=97&&r<=122}var il;(oe=>(oe.inMemory="inmemory",oe.vscode="vscode",oe.internal="private",oe.walkThrough="walkThrough",oe.walkThroughSnippet="walkThroughSnippet",oe.http="http",oe.https="https",oe.file="file",oe.mailto="mailto",oe.untitled="untitled",oe.data="data",oe.command="command",oe.vscodeRemote="vscode-remote",oe.vscodeRemoteResource="vscode-remote-resource",oe.vscodeUserData="vscode-userdata",oe.vscodeCustomEditor="vscode-custom-editor",oe.vscodeNotebook="vscode-notebook",oe.vscodeNotebookCell="vscode-notebook-cell",oe.vscodeNotebookCellMetadata="vscode-notebook-cell-metadata",oe.vscodeNotebookCellOutput="vscode-notebook-cell-output",oe.vscodeInteractive="vscode-interactive",oe.vscodeInteractiveInput="vscode-interactive-input",oe.vscodeSettings="vscode-settings",oe.vscodeWorkspaceTrust="vscode-workspace-trust",oe.vscodeTerminal="vscode-terminal",oe.webviewPanel="webview-panel",oe.vscodeWebview="vscode-webview",oe.extension="extension",oe.vscodeFileResource="vscode-file",oe.tmp="tmp",oe.vsls="vsls"))(il||={});function ma(r){return BE?r?.path||"":r?.fsPath||""}var VS=class{constructor(e){this._ignorePathCasing=e}compare(e,t,n=!1){return e===t?0:VR(this.getComparisonKey(e,n),this.getComparisonKey(t,n))}isEqual(e,t,n=!1){return e===t?!0:!e||!t?!1:this.getComparisonKey(e,n)===this.getComparisonKey(t,n)}getComparisonKey(e,t=!1){return e.with({path:this._ignorePathCasing(e)?e.path.toLowerCase():void 0,fragment:void 0}).toString()}ignorePathCasing(e){return this._ignorePathCasing(e)}isEqualOrParent(e,t,n=!1,i=US?"\\":"/"){if(e.scheme===t.scheme){if(e.scheme===il.file)return $R(ma(e),ma(t),this._ignorePathCasing(e),i)&&e.query===t.query&&(n||e.fragment===t.fragment);if(TW(e.authority,t.authority))return $R(e.path,t.path,this._ignorePathCasing(e),"/")&&e.query===t.query&&(n||e.fragment===t.fragment)}return!1}joinPath(e,...t){return jS.Uri.joinPath(e,...t)}basenameOrAuthority(e){return In(e)||e.authority}basename(e,t){return Tr.basename(e.path,t)}extname(e){return Tr.extname(e.path)}dirname(e){if(e.path.length===0)return e;let t;return e.scheme===il.file?t=jS.Uri.file(pt(ma(e))).path:(t=Tr.dirname(e.path),e.authority&&t.length&&t.charCodeAt(0)!==47&&(console.error(`dirname("${e.toString})) resulted in a relative path`),t="/")),e.with({path:t})}normalizePath(e){if(!e.path.length)return e;let t;return e.scheme===il.file?t=jS.Uri.file(Pn(ma(e))).path:t=Tr.normalize(e.path),e.with({path:t})}relativePath(e,t){if(e.scheme!==t.scheme||!TW(e.authority,t.authority))return;if(e.scheme===il.file){let o=HE(ma(e),ma(t));return US?qR(o):o}let n=e.path||"/",i=t.path||"/";if(this._ignorePathCasing(e)){let o=0;for(let s=Math.min(n.length,i.length);o<s&&!(n.charCodeAt(o)!==i.charCodeAt(o)&&n.charAt(o).toLowerCase()!==i.charAt(o).toLowerCase());o++);n=i.substr(0,o)+n.substr(o)}return Tr.relative(n,i)}resolvePath(e,t){if(e.scheme===il.file){let n=jS.Uri.file(IW(ma(e),t));return e.with({authority:n.authority,path:n.path})}return t=DW(t),e.with({path:Tr.resolve(e.path,t)})}isAbsolutePath(e){return!!e.path&&e.path[0]==="/"}isEqualAuthority(e,t){return e===t||e!==void 0&&t!==void 0&&kW(e,t)}hasTrailingPathSeparator(e,t=ni){if(e.scheme===il.file){let n=ma(e);return n.length>JR(n).length&&n[n.length-1]===t}else{let n=e.path;return n.length>1&&n.charCodeAt(n.length-1)===47&&!/^[a-zA-Z]:(\/$|\\$)/.test(e.fsPath)}}removeTrailingPathSeparator(e,t=ni){return _W(e,t)?e.with({path:e.path.substr(0,e.path.length-1)}):e}addTrailingPathSeparator(e,t=ni){let n=!1;if(e.scheme===il.file){let i=ma(e);n=i!==void 0&&i.length===JR(i).length&&i[i.length-1]===t}else{t="/";let i=e.path;n=i.length===1&&i.charCodeAt(i.length-1)===47}return!n&&!_W(e,t)?e.with({path:e.path+"/"}):e}},sr=new VS(()=>!1),sIe=new VS(r=>r.scheme===il.file?!vW:!0),aIe=new VS(r=>!0),Mi=sr.isEqual.bind(sr),BS=sr.isEqualOrParent.bind(sr),ar=sr.getComparisonKey.bind(sr),lIe=sr.basenameOrAuthority.bind(sr),In=sr.basename.bind(sr),Yu=sr.extname.bind(sr),oi=sr.dirname.bind(sr),Yt=sr.joinPath.bind(sr),cIe=sr.normalizePath.bind(sr),HR=sr.relativePath.bind(sr),RW=sr.resolvePath.bind(sr),uIe=sr.isAbsolutePath.bind(sr),TW=sr.isEqualAuthority.bind(sr),_W=sr.hasTrailingPathSeparator.bind(sr),pIe=sr.removeTrailingPathSeparator.bind(sr),dIe=sr.addTrailingPathSeparator.bind(sr),LQ;(o=>{o.META_DATA_LABEL="label",o.META_DATA_DESCRIPTION="description",o.META_DATA_SIZE="size",o.META_DATA_MIME="mime";function i(s){let a=new Map;s.path.substring(s.path.indexOf(";")+1,s.path.lastIndexOf(";")).split(";").forEach(u=>{let[d,f]=u.split(":");d&&f&&a.set(d,f)});let c=s.path.substring(0,s.path.indexOf(";"));return c&&a.set(o.META_DATA_MIME,c),a}o.parseMetaData=i})(LQ||={});function en(r=process.platform){return/^win/.test(r)?"Windows":/^darwin/.test(r)?"OSX":/^linux/.test(r)?"Linux":"Unknown"}function fh(r,e){return r.replace(/^~(?=$|\/|\\)/,e)}function UQ(){if(!ph())return GR.Uri.file(require("os").homedir())}function we(r){let e=en()==="Windows";if(r){let t=ma(r);return t&&t.startsWith(ni)&&t.length>1&&t[1]!==ni&&e?t.slice(1):t||""}return""}function W(r,e=[],t){t=t||UQ();let n;typeof r=="string"&&(n=GR.Uri.file(r)),typeof r!="string"&&(n=r);let i=NW(n,void 0,t),o=e.map(a=>NW(n,a.uri,t)),s=i;return[i,...o].forEach(a=>{a.length<s.length&&(s=a)}),s}function NW(r,e,t){let n=en()==="Windows";if(r&&e&&BS(r,e,!0)){let i=HR(e,r);if(i)return n?i.replace(/\//g,"\\"):i}if(r&&t&&BS(r,t,!0)){let i=HR(t,r);if(i)return i=n?i.replace(/\//g,"\\"):i,`~${ni}${i}`}return we(r)}var QE="",AW=3,zd=[];function QR(r){return zd.push(r),{dispose:()=>{zd=zd.filter(e=>e!==r)}}}var jQ=new Map([["error",40],["warn",30],["info",20],["debug",10],["none",100],["off",100],[void 0,40]]),gh=10;function YR(r){gh=typeof r=="number"?r:jQ.get(r)??40}function MW(r){QE=r.toLowerCase()}function OW(...r){return gh<=5?r:r.map(t=>{if(!(t instanceof Error)||!("isJupyterError"in t))return t;let n=[`${t.name}: ${t.message}`.trim()];if("kernelConnectionMetadata"in t&&t.kernelConnectionMetadata&&typeof t.kernelConnectionMetadata=="object"&&"id"in t.kernelConnectionMetadata&&(n.push(`Kernel Id = ${t.kernelConnectionMetadata.id}`),"interpreter"in t.kernelConnectionMetadata&&t.kernelConnectionMetadata.interpreter&&typeof t.kernelConnectionMetadata.interpreter=="object"&&"id"in t.kernelConnectionMetadata.interpreter&&typeof t.kernelConnectionMetadata.interpreter.id=="string"&&n.push(`Interpreter Id = ${W(t.kernelConnectionMetadata.interpreter.id)}`)),t.stack){let o=je(t.stack),s=o.find(a=>a.indexOf("at ")===0);o.length===1||(o.length===1?n.push(o[0]):o.length>1&&s?.length?n.push(s):n.push(o[0]))}let i=["stack","message","name","kernelConnectionMetadata","category","exitCode","isJupyterError"];return Object.keys(t).filter(o=>i.indexOf(o)===-1).forEach(o=>n.push(`${o} = ${String(t[o]).trim()}`)),n.filter(o=>o.trim().length).map((o,s)=>s===0?o:`    > ${o}`).join(`
`)})}function C(r,...e){gh<=40&&(e=OW(...e),zd.forEach(t=>t.traceError(r,...e)))}function J(r,...e){gh<=30&&(e=OW(...e),zd.forEach(t=>t.traceWarn(r,...e)))}function H(r,...e){gh<=20&&zd.forEach(t=>t.traceInfo(r,...e))}function w(r,...e){gh<=5&&zd.forEach(t=>t.traceVerbose(r,...e))}function te(r,...e){fi&&H(r,...e)}function gi(r,e=AW){return KW({message:r,opts:e,level:5})}function vh(r){return KW({message:r,opts:AW,level:40})}var Rc=new WeakMap;function Nc(r){return(e,t,n)=>{Rc.has(e)||Rc.set(e,new Map);let i=Rc.get(e);i||Rc.set(e,i=new Map),i.has(t)||i.set(t,[]),i.get(t).push({parameterIndex:n,propertyOfParameterToLog:r})}}function Xu(){return(r,e,t)=>{Rc.has(r)||Rc.set(r,new Map);let n=Rc.get(r);n||Rc.set(r,n=new Map),n.has(e)||n.set(e,[]),n.get(e).push({parameterIndex:t,ignore:!0})}}function KW(r){return dW((e,t)=>$Q(r,t,e),(r.opts&4)>0)}function VQ(r){let{kind:e,name:t,args:n}=r;return(!e||e==="")&&(e="Function"),(!t||t==="")&&(t="<anon>"),n||(n=[]),{kind:e,name:t,args:n,methodName:r.methodName||"",target:r.target||void 0}}function BQ(r){if(!r)return!1;let e=r;return typeof e.path=="string"&&typeof e.scheme=="string"}function zR(r){let e=QE?r.toLowerCase().indexOf(QE):-1;return e===-1?r:`~${r.substring(e+QE.length)}`}function qQ(r,e,t,n){if(BQ(t))return zR(t.path);if(!t)return t;let o=Rc.get(r)?.get(e)?.find(a=>a.parameterIndex===n);if(!o)return typeof t=="string"?zR(t):t;if("ignore"in o&&o.ignore)return"";let s=t;return"propertyOfParameterToLog"in o&&o.propertyOfParameterToLog&&(s=t[o.propertyOfParameterToLog]),typeof s=="string"?zR(s):s}function JQ(r,e,t){t=VQ(t);let n=[r.message];return n.push(`${t.kind} name = ${t.name}`.trim()),e?(n.push(`completed in ${e.elapsed}ms`),n.push(`has a ${e.returnValue?"truthy":"falsy"} return value`)):n[n.length-1]=`${n[n.length-1]} (started execution)`,(r.opts&1)===1&&(r.level===5?n.push(FR(t.args.map((i,o)=>t?qQ(t.target,t.methodName,i,o):i))):n.push(FR(t.args))),e&&(r.opts&2)===2&&n.push(mW(e.returnValue)),n.join(", ")}function $Q(r,e,t){let n=JQ(r,e,t);e?e.err===void 0?r.level&&r.level===40||(r.level?zE(r.level,n):zE(20,n)):zE(40,n,e.err):r.level&&r.level!==40&&zE(r.level,n)}function zE(r,e,...t){switch(r){case 40:C(e,...t);break;case 30:J(e,...t);break;case 20:H(e,...t);break;case 10:w(e,...t);break;case 5:w(e,...t);break;default:break}}var kr=require("vscode");var Ca=require("vscode");var gp=k(A());var ue=Symbol("IApplicationShell"),Fe=Symbol("ICommandManager"),lr=Symbol("IDocumentManager"),ce=Symbol("IWorkspaceService"),l2=Symbol("ITerminalManager"),Ui=Symbol("IDebugManager"),An=Symbol("IApplicationEnvironment"),_Se=Symbol("IWebviewPanelMessageListener"),RSe=Symbol("IWebviewViewMessageListener"),NSe=Symbol("IWebview"),ASe=Symbol("IWebviewView"),MSe=Symbol("IWebviewPanel"),tp=Symbol("IWebviewPanelProvider"),Dw=Symbol("IWebviewViewProvider"),c2=Symbol("ILanguageService"),Zd=Symbol("IClipboard"),qe=Symbol("IVSCodeNotebook"),Oc=Symbol("IEncryptedStorage");var rp=Symbol("JupyterServerHelper"),Tw=Symbol("INotebookImporter"),wh=Symbol("INotebookExporter"),np=Symbol("IJupyterInterpreterDependencyManager"),kh=Symbol("INbConvertInterpreterDependencyChecker"),_w=Symbol("INbConvertExportToPythonService"),Ph=Symbol("IJupyterServerProvider"),cr=Symbol("IJupyterServerUriStorage"),Rw=Symbol("IJupyterKernelService"),ip=Symbol("IJupyterRequestAgentCreator"),Kc=Symbol("IJupyterRequestCreator"),Nw=Symbol("INotebookStarter"),em=Symbol("ILiveRemoteKernelConnectionUsageTracker"),Aw=Symbol("IJupyterRemoteCachedKernelValidator"),Ut=Symbol("IJupyterServerProviderRegistry");var op=Symbol("IsCodeSpace"),u2=Symbol("IsDevMode"),on=Symbol("IsWebExtension"),Wo=Symbol("IOutputChannel"),p2=Symbol("IS_WINDOWS"),O=Symbol("IDisposableRegistry"),He=Symbol("IGlobalMemento"),It=Symbol("IGlobalMemento"),vi=Symbol("IWorkspaceMemento");var Sl=Symbol("IPersistentStateFactory"),FSe=Symbol("IRandom"),se=Symbol("IConfigurationService"),ws=Symbol("IHttpClient"),dt=Symbol("ExtensionContext"),rr=Symbol("IExtensions"),ks=Symbol("IBrowserService"),d2=Symbol("IJupyterExtensionBanner"),Mw=Symbol("IFeaturesManager"),Dh=Symbol("ICryptoUtils"),yi=Symbol("IAsyncDisposableRegistry");var sp=Symbol("IExperimentService"),Th=Symbol("IDataScienceCommandListener"),_h=Symbol("IVariableScriptGenerator"),Rh=Symbol("IDataFrameScriptGenerator");var Sa=k(A());var tt=class extends Error{constructor(t,n){super(n);this.category=t;this.isJupyterError=!0}},hn=class r extends tt{constructor(t,n,i){super(i||_N(n),t);this.originalException=n;n&&(this.stack=`${new Error("").stack}

${n.stack}`)}static from(t,n){return n instanceof tt?n:new r(t,n)}static unwrap(t){return t&&(t instanceof r&&t.originalException&&t.originalException instanceof tt&&(t=t.originalException),t)}};function _N(r){return r&&r instanceof tt?r.category:"unknown"}var ap=class extends tt{constructor(t,n){super("remotejupyterserveruriprovider",n.message||n.toString());this.serverProviderHandle=t;this.originalError=n}};var jN=require("vscode");function Ow(r,e){let t=r.length>0?`?token=${r}`:"";return`${e}${t}`}var E=require("vscode");var lt=require("vscode"),RN=60,NN=RN*60,zS=NN*24,m2=zS*7,f2=zS*30,h2=zS*365;function Nh(r,e,t,n){typeof r!="number"&&(r=r.getTime());let i=Math.round((new Date().getTime()-r)/1e3);if(i<-30)return lt.l10n.t("in {0}",Nh(new Date().getTime()+i*1e3,!1));if(!n&&i<30)return lt.l10n.t("now");let o;return i<RN?(o=i,e?o===1?t?lt.l10n.t("{0} second ago",o):lt.l10n.t("{0} sec ago",o):t?lt.l10n.t("{0} seconds ago",o):lt.l10n.t("{0} secs ago",o):o===1?t?lt.l10n.t("{0} second",o):lt.l10n.t("{0} sec",o):t?lt.l10n.t("{0} seconds",o):lt.l10n.t("{0} secs",o)):i<NN?(o=Math.floor(i/RN),e?o===1?t?lt.l10n.t("{0} minute ago",o):lt.l10n.t("{0} min ago",o):t?lt.l10n.t("{0} minutes ago",o):lt.l10n.t("{0} mins ago",o):o===1?t?lt.l10n.t("{0} minute",o):lt.l10n.t("{0} min",o):t?lt.l10n.t("{0} minutes",o):lt.l10n.t("{0} mins",o)):i<zS?(o=Math.floor(i/NN),e?o===1?t?lt.l10n.t("{0} hour ago",o):lt.l10n.t("{0} hr ago",o):t?lt.l10n.t("{0} hours ago",o):lt.l10n.t("{0} hrs ago",o):o===1?t?lt.l10n.t("{0} hour",o):lt.l10n.t("{0} hr",o):t?lt.l10n.t("{0} hours",o):lt.l10n.t("{0} hrs",o)):i<m2?(o=Math.floor(i/zS),e?o===1?lt.l10n.t("{0} day ago",o):lt.l10n.t("{0} days ago",o):o===1?lt.l10n.t("{0} day",o):lt.l10n.t("{0} days",o)):i<f2?(o=Math.floor(i/m2),e?o===1?t?lt.l10n.t("{0} week ago",o):lt.l10n.t("{0} wk ago",o):t?lt.l10n.t("{0} weeks ago",o):lt.l10n.t("{0} wks ago",o):o===1?t?lt.l10n.t("{0} week",o):lt.l10n.t("{0} wk",o):t?lt.l10n.t("{0} weeks",o):lt.l10n.t("{0} wks",o)):i<h2?(o=Math.floor(i/f2),e?o===1?t?lt.l10n.t("{0} month ago",o):lt.l10n.t("{0} mo ago",o):t?lt.l10n.t("{0} months ago",o):lt.l10n.t("{0} mos ago",o):o===1?t?lt.l10n.t("{0} month",o):lt.l10n.t("{0} mo",o):t?lt.l10n.t("{0} months",o):lt.l10n.t("{0} mos",o)):(o=Math.floor(i/h2),e?o===1?t?lt.l10n.t("{0} year ago",o):lt.l10n.t("{0} yr ago",o):t?lt.l10n.t("{0} years ago",o):lt.l10n.t("{0} yrs ago",o):o===1?t?lt.l10n.t("{0} year",o):lt.l10n.t("{0} yr",o):t?lt.l10n.t("{0} years",o):lt.l10n.t("{0} yrs",o))}function Nte(r){let e=r.displayName||r.envName||"",t=W(r.uri);return e?` ${e} (${t})`:t}var ye;(D=>(D.bannerLabelYes=E.l10n.t("Yes"),D.bannerLabelNo=E.l10n.t("No"),D.canceled=E.l10n.t("Canceled"),D.cancel=E.l10n.t("Cancel"),D.ok=E.l10n.t("Ok"),D.refresh=E.l10n.t("Refresh"),D.refreshing=E.l10n.t("Refreshing..."),D.install=E.l10n.t("Install"),D.loadingExtension=E.l10n.t("Jupyter Extension loading..."),D.handleExtensionActivationError=E.l10n.t("Extension activation failed, run the 'Developer: Toggle Developer Tools' command for more information."),D.doNotShowAgain=E.l10n.t("Do not show again"),D.reload=E.l10n.t("Reload"),D.moreInfo=E.l10n.t("More Info"),D.learnMore=E.l10n.t("Learn more"),D.and=E.l10n.t("and"),D.reportThisIssue=E.l10n.t("Report this issue"),D.clickHereForMoreInfoWithHtml=_=>E.l10n.t("Click <a href='{0}'>here</a> for more info.",_)))(ye||={});var tm;(t=>(t.notInGroup=n=>E.l10n.t("User does not belong to experiment group '{0}'",n),t.inGroup=n=>E.l10n.t("User belongs to experiment group '{0}'",n)))(tm||={});var AN;(e=>e.jupyter=E.l10n.t("Jupyter"))(AN||={});var MN;(e=>e.currentWorkingDirectory="cwd:")(MN||={});var ON;(e=>e.bannerMessage=E.l10n.t("Would you like shift-enter to send code to the new Interactive Window experience?"))(ON||={});var KN;(e=>e.bannerMessage=E.l10n.t("Can you please take a minute to tell us about your notebooks experience in VS Code?"))(KN||={});var Kw;(t=>(t.bannerLabelYes=E.l10n.t("Yes, take survey now"),t.bannerLabelNo=E.l10n.t("No, thanks")))(Kw||={});var y;(T=>(T.warnWhenSelectingKernelWithUnSupportedPythonVersion=E.l10n.t("The version of Python associated with the selected kernel is no longer supported. Please consider selecting a different kernel."),T.installingPythonExtension=E.l10n.t("Installing Python extension and locating kernels."),T.pythonExtensionRequired=E.l10n.t("The Python Extension is required to perform that task. Click Yes to open Python Extension installation page."),T.rendererExtensionRequired=E.l10n.t("The Renderer Extension is required to view IPyWidgets. Click Yes to open Jupyter Notebook Renderer Extension installation page."),T.rendererExtension1015Required=E.l10n.t("The installed version of the Renderer Extension is outdated and requires and update to view IPyWidgets. Click Yes to open Jupyter Notebook Renderer Extension installation page."),T.pythonExtensionInstalled=E.l10n.t("Python Extension is now installed. Some features might not be available until a notebook or interactive window session is restarted."),T.unknownPackage=E.l10n.t("unknown"),T.interactiveWindowTitleFormat=U=>E.l10n.t("Interactive - {0}",U),T.interactiveWindowModeBannerTitle=E.l10n.t({message:"Do you want to open a new Interactive Window for this file? [More Information](command:workbench.action.openSettings?%5B%22jupyter.interactiveWindowMode%22%5D).",args:[],comment:'The string "command:workbench.action.openSettings?%5B%22jupyter.interactiveWindowMode%22%5D" should not be translated. It is a command that opens the settings page with the "jupyter.interactiveWindowMode" setting selected.'}),T.interactiveWindowModeBannerSwitchYes=E.l10n.t("Yes"),T.interactiveWindowModeBannerSwitchNo=E.l10n.t("No"),T.dataExplorerTitle=E.l10n.t("Data Viewer"),T.badWebPanelFormatString=U=>E.l10n.t({message:"<html><body><h1>{0} is not a valid file name</h1></body></html>",args:[U],comment:["Only translate the text within the HTML tags"]}),T.installingMissingDependencies=E.l10n.t("Installing missing dependencies"),T.validatingKernelDependencies=E.l10n.t("Validating kernel dependencies"),T.performingExport=E.l10n.t("Performing Export"),T.exportNotebookToPython=E.l10n.t("Exporting Notebook to Python"),T.sessionDisposed=E.l10n.t("Cannot execute code, session has been disposed. Please try restarting the Kernel."),T.passwordFailure=E.l10n.t("Failed to connect to password protected server. Check that password is correct."),T.incorrectPassword=E.l10n.t("Incorrect Password."),T.exportDialogFilter=E.l10n.t("Jupyter Notebooks"),T.exportDialogComplete=U=>E.l10n.t("Notebook written to {0}",U),T.exportDialogFailed=U=>E.l10n.t("Failed to export notebook. {0}",U),T.exportOpenQuestion1=E.l10n.t("Open in editor"),T.runCellLensCommandTitle=E.l10n.t("Run Cell"),T.importDialogTitle=E.l10n.t("Import Jupyter Notebook"),T.importDialogFilter="Jupyter Notebooks",T.notebookCheckForImportNo=E.l10n.t("Later"),T.libraryRequiredToLaunchJupyterNotInstalled=U=>E.l10n.t("Running cells requires {0} package.",U),T.librariesRequiredToLaunchJupyterNotInstalled=U=>E.l10n.t("Running cells requires {0} package.",U),T.libraryRequiredToLaunchJupyterNotInstalledInterpreter=(U,rt)=>E.l10n.t("Running cells with '{0}' requires the {1} package.",U,rt),T.libraryRequiredToLaunchJupyterKernelNotInstalledInterpreter=(U,rt)=>E.l10n.t("Running cells with '{0}' requires the {1} package.",U,rt),T.libraryRequiredToLaunchJupyterKernelNotInstalledInterpreterAndRequiresUpdate=(U,rt)=>E.l10n.t("Running cells with '{0}' requires the {1} package to be installed or requires an update.",U,rt),T.librariesRequiredToLaunchJupyterNotInstalledInterpreter=(U,rt)=>E.l10n.t("Running cells with '{0}' requires the {1} package.",U,rt),T.installPackageInstructions=(U,rt)=>E.l10n.t(`Run the following command to install '{0}' into the Python environment. 
Command: '{1}'`,U,rt),T.pythonCondaKernelsWithoutPython=E.l10n.t("The Python Runtime and IPyKernel will be automatically installed upon selecting this environment."),T.selectJupyterInterpreter=E.l10n.t("Select an Interpreter to start Jupyter"),T.jupyterInstall=E.l10n.t("Install"),T.currentlySelectedJupyterInterpreterForPlaceholder=U=>E.l10n.t("Selected Environment {0}",U),T.jupyterNotSupported=U=>E.l10n.t("Jupyter cannot be started. Error attempting to locate Jupyter: {0}",U),T.jupyterNotebookNotInstalledOrNotFound=U=>{if(U){let rt=Nte(U);return E.l10n.t("Failed to start Jupyter Server as the packages 'jupyter' and 'notebook' could not be located in the Python environment '{0}'.",rt)}else return E.l10n.t("Failed to start Jupyter Server as the packages 'jupyter' and 'notebook' could not be located in the Python environment.")},T.jupyterNotSupportedBecauseOfEnvironment=(U,rt)=>E.l10n.t("Activating {0} to run Jupyter failed with {1}",U,rt),T.jupyterNbConvertNotSupported=E.l10n.t("Jupyter nbconvert is not installed"),T.jupyterLaunchTimedOut=E.l10n.t("The Jupyter notebook server failed to launch in time"),T.jupyterLaunchNoURL=E.l10n.t("Failed to find the URL of the launched Jupyter notebook server"),T.jupyterSelfCertFail=U=>E.l10n.t(`The security certificate used by server {0} was not issued by a trusted certificate authority.\r
This may indicate an attempt to steal your information.\r
Do you want to enable the Allow Unauthorized Remote Connection setting for this workspace to allow you to connect?`,U),T.jupyterExpiredCertFail=U=>E.l10n.t(`The security certificate used by server {0} has expired.\r
This may indicate an attempt to steal your information.\r
Do you want to enable the Allow Unauthorized Remote Connection setting for this workspace to allow you to connect?`,U),T.jupyterSelfCertFailErrorMessageOnly=E.l10n.t(`The security certificate used by server was not issued by a trusted certificate authority.\r
This may indicate an attempt to steal your information.`),T.jupyterSelfCertExpiredErrorMessageOnly=E.l10n.t(`The security certificate used by server has expired.\r
This may indicate an attempt to steal your information.`),T.jupyterSelfCertEnable=E.l10n.t("Yes, connect anyways"),T.jupyterSelfCertClose=E.l10n.t("No, close the connection"),T.pythonInteractiveHelpLink=E.l10n.t("See <https://aka.ms/pyaiinstall> for help on installing Jupyter."),T.importingFormat=U=>E.l10n.t("Importing {0}",U),T.startingJupyter=E.l10n.t("Starting Jupyter Server"),T.connectingToKernel=U=>E.l10n.t("Connecting to kernel: {0}",U),T.connectingToJupyter=E.l10n.t("Connecting to Jupyter Server"),T.exportingFormat=U=>E.l10n.t("Exporting {0}",U),T.runAllCellsLensCommandTitle=E.l10n.t("Run All Cells"),T.runAllCellsAboveLensCommandTitle=E.l10n.t("Run Above"),T.runCellAndAllBelowLensCommandTitle=E.l10n.t("Run Below"),T.restartKernelMessage=E.l10n.t("Do you want to restart the Jupyter kernel? All variables will be lost."),T.restartKernelMessageYes=E.l10n.t("Restart"),T.restartKernelMessageDontAskAgain=E.l10n.t("Don't Ask Again"),T.automaticallyReconnectingToAKernelProgressMessage=U=>E.l10n.t("Reconnecting to the kernel {0}",U),T.restartingKernelStatus=U=>E.l10n.t("Restarting Kernel {0}",U),T.interruptingKernelFailed=E.l10n.t("Kernel interrupt failed. Jupyter Server is hung. Please reload VS Code."),T.sessionStartFailedWithKernel=U=>E.l10n.t({message:`Failed to start the Kernel '{0}'. 
View Jupyter [log](command:jupyter.viewOutput) for further details.`,args:[U],comment:['Do not translate the text "command:jupyter.viewOutput", that is a command Id that will be used by VS Code to open the output panel']}),T.failedToStartJupyter=U=>E.l10n.t({message:`Failed to start Jupyter in the environment '{0}'. 
View Jupyter [log](command:jupyter.viewOutput) for further details.`,args:[U],comment:['Do not translate the text "command:jupyter.viewOutput", that is a command Id that will be used by VS Code to open the output panel']}),T.failedToStartJupyterWithErrorInfo=(U,rt)=>E.l10n.t({message:`Failed to start Jupyter in the environment '{0}'. 
{1} 
View Jupyter [log](command:jupyter.viewOutput) for further details.`,args:[U,rt],comment:['Do not translate the text "command:jupyter.viewOutput", that is a command Id that will be used by VS Code to open the output panel']}),T.failedToStartJupyterDueToOutdatedTraitlets=(U,rt)=>E.l10n.t({message:`Failed to start Jupyter in the environment '{0}' possibly due to an outdated version of 'traitlets'. 
{1} 
Consider updating the 'traitlets' module to '5.1.1' or later. 
View Jupyter [log](command:jupyter.viewOutput) for further details.`,args:[U,rt],comment:['Do not translate the text "command:jupyter.viewOutput", that is a command Id that will be used by VS Code to open the output panel',"Do not translate the text 'traitlets', that is a Python module name"]}),T.failedToStartKernel=E.l10n.t("Failed to start the Kernel."),T.failedToRestartKernel=E.l10n.t("Failed to restart the Kernel."),T.failedToInterruptKernel=E.l10n.t("Failed to interrupt the Kernel."),T.rawKernelStartFailedDueToTimeout=U=>E.l10n.t({message:`Unable to start Kernel '{0}' due to a connection timeout. 
View Jupyter [log](command:jupyter.viewOutput) for further details.`,args:[U],comment:['Do not translate the text "command:jupyter.viewOutput", that is a command Id that will be used by VS Code to open the output panel']}),T.rawKernelStartFailedDueToTimeoutWaitingForPort=U=>E.l10n.t({message:`Unable to start Kernel '{0}' due to a timeout waiting for the ports to get used. 
View Jupyter [log](command:jupyter.viewOutput) for further details.`,args:[U],comment:['Do not translate the text "command:jupyter.viewOutput", that is a command Id that will be used by VS Code to open the output panel']}),T.viewJupyterLogForFurtherInfo=E.l10n.t({message:"View Jupyter [log](command:jupyter.viewOutput) for further details.",comment:['Do not translate the text "command:jupyter.viewOutput", that is a command Id that will be used by VS Code to open the output panel']}),T.kernelDied=U=>E.l10n.t({message:"The kernel died. Error: {0}... View Jupyter [log](command:jupyter.viewOutput) for further details.",args:[U],comment:['Do not translate the text "command:jupyter.viewOutput", that is a command Id that will be used by VS Code to open the output panel']}),T.kernelDiedWithoutError=U=>E.l10n.t({message:"The kernel '{0}' died. Click [here](https://aka.ms/vscodeJupyterKernelCrash) for more info. View Jupyter [log](command:jupyter.viewOutput) for further details.",args:[U],comment:['Do not translate the text "command:jupyter.viewOutput", that is a command Id that will be used by VS Code to open the output panel',"Do not translate the link https://aka.ms/vscodeJupyterKernelCrash"]}),T.failedToStartAnUntrustedKernelSpec=(U,rt)=>E.l10n.t({message:`The kernel '{0}' was not started as it is located in an insecure location '{1}'.  
Click [here](https://aka.ms/JupyterTrustedKernelPaths) for further details, optionally update the setting [jupyter.kernels.trusted](command:workbench.action.openSettings?["jupyter.kernels.trusted"]) to trust the kernel.`,args:[U,rt],comment:['Do not translate the text "jupyter.kernels.trusted", that is a setting in VS Code','Do not translate the text command:workbench.action.openSettings?["jupyter.kernels.trusted"], that is a command Id that will be used by VS Code to open the output panel',"Do not translate the link https://aka.ms/JupyterTrustedKernelPaths"]}),T.kernelDiedWithoutErrorAndAutoRestarting=U=>E.l10n.t({message:"The kernel '{0}' died and is being automatically restarted by Jupyter. Click [here](https://aka.ms/vscodeJupyterKernelCrash) for more info. View Jupyter [log](command:jupyter.viewOutput) for further details.",args:[U],comment:['Do not translate the text "command:jupyter.viewOutput", that is a command Id that will be used by VS Code to open the output panel',"Do not translate the link https://aka.ms/vscodeJupyterKernelCrash"]}),T.kernelCrashedDueToCodeInCurrentOrPreviousCell=E.l10n.t({message:"The Kernel crashed while executing code in the the current cell or a previous cell. Please review the code in the cell(s) to identify a possible cause of the failure. Click <a href='https://aka.ms/vscodeJupyterKernelCrash'>here</a> for more info. View Jupyter [log](command:jupyter.viewOutput) for further details.",comment:['Do not translate the text "command:jupyter.viewOutput", that is a command Id that will be used by VS Code to open the output panel',"Do not translate the link https://aka.ms/vscodeJupyterKernelCrash"]}),T.kernelDisconnected=U=>E.l10n.t("Unable to connect to the kernel '{0}', please verify the Jupyter Server connection. View Jupyter [log](command:jupyter.viewOutput) for further details.",U),T.cannotRunCellKernelIsDead=U=>E.l10n.t("Cannot run cells, as the kernel '{0}' is dead.",U),T.showJupyterLogs=E.l10n.t("Show Jupyter Logs."),T.restartKernel=E.l10n.t("Restart Kernel"),T.reloadRequired=E.l10n.t("Please reload the window for new settings to take effect."),T.restartedKernelHeader=U=>E.l10n.t("Restarted {0}",U),T.connectedKernelHeader=U=>E.l10n.t("Connected to {0}",U),T.restartingKernelCustomHeader=U=>E.l10n.t("_Restarting {0}..._",U),T.restartingKernelHeader=E.l10n.t("_Restarting kernel..._"),T.startingNewKernelHeader=E.l10n.t("_Connecting to kernel..._"),T.startingNewKernelCustomHeader=U=>E.l10n.t("_Connecting to {0}..._",U),T.noKernelConnected=E.l10n.t("No kernel connected"),T.jupyterSelectUriCommandLabel=E.l10n.t("Enter the URL of the running Jupyter Server..."),T.jupyterSelectUriInputTitle=E.l10n.t("Enter the URL of the running Jupyter Server"),T.jupyterSelectUriInputPlaceholder=E.l10n.t("Enter the url of the running Jupyter Server"),T.connectToToTheJupyterServer=U=>E.l10n.t("Connect to the Jupyter Server {0}",U),T.enterOrSelectRemoteJupyterPlaceholder=E.l10n.t("Enter a remote url, or select a remote server"),T.selectRemoteJupyterPlaceholder=E.l10n.t("Select a remote server"),T.jupyterServerLastConnectionForQuickPickDescription=U=>E.l10n.t("Last connected {0}",Nh(U,!0,!1,!1)),T.jupyterServerNotUsedBeforeQuickPickSeparatorTitle=E.l10n.t("Jupyter Servers"),T.jupyterSelectURIInvalidURI=E.l10n.t("Invalid URL specified"),T.jupyterSelectURIMustBeHttpOrHttps=E.l10n.t("Invalid protocol in URL specified, only HTTP or HTTPS are supported."),T.jupyterSelectLiveRemoteKernelDescription=(U,rt)=>U?rt===0?E.l10n.t("Last activity {0}",Nh(U,!0,!1,!1)):rt===1?E.l10n.t("Last activity {0}, 1 connection",Nh(U,!0,!1,!1)):E.l10n.t("Last activity {0}, {1} connections",Nh(U,!0,!1,!1),rt.toString()):rt===0?"":rt===1?E.l10n.t("1 connection"):E.l10n.t("{0} connections",rt.toString()),T.installJupyterHub=E.l10n.t("Install the JupyterHub extension to connect to JupyterHub servers."),T.useJupyterHubExtension=E.l10n.t("Select 'Existing JupyterHub Server...' from the Kernel Picker"),T.useJupyterHubExtensionDetail=E.l10n.t("Use this option when connecting to JupyterHub servers"),T.installJupyterHubDetail=E.l10n.t("Once installed, open the Kernel Picker and select 'Existing JupyterHub Server...'"),T.jupyterSelectUserAndPasswordTitle=E.l10n.t("Enter your user name and password to connect to Jupyter Hub"),T.jupyterRenameServer=E.l10n.t("Change Server Display Name (Leave Blank To Use URL)"),T.jupyterServerUriDisplayNameInputPlaceholder=E.l10n.t("Enter a display name"),T.jupyterSelectUserPrompt=E.l10n.t("Enter your user name"),T.jupyterSelectPasswordPrompt=E.l10n.t("Enter your password"),T.jupyterSelectPasswordTitle=E.l10n.t("Enter your password for the Jupyter Server"),T.pythonNotInstalled=E.l10n.t(`Python is not installed. 
Please download and install Python in order to execute cells in this notebook. 
Once installed please reload VS Code.`),T.pleaseReloadVSCodeOncePythonHasBeenInstalled=E.l10n.t("Upon installing Python please reload VS Code."),T.jupyterNotebookFailure=U=>E.l10n.t(`Jupyter notebook failed to launch. \r
{0}`,U),T.remoteJupyterServerProvidedBy3rdPartyExtensionNoLongerValid=U=>E.l10n.t("The remote Jupyter Server contributed by the extension '{0}' is no longer available.",U),T.remoteJupyterConnectionFailedWithServerWithError=(U,rt)=>E.l10n.t("Failed to connect to the remote Jupyter Server '{0}'. Verify the server is running and reachable. ({1}).",U,rt),T.remoteJupyterConnectionFailedWithServer=U=>E.l10n.t("Failed to connect to the remote Jupyter Server '{0}'. Verify the server is running and reachable.",U),T.remoteJupyterConnectionFailedWithoutServerWithError=U=>E.l10n.t("Connection failure. Verify the server is running and reachable. ({0}).",U),T.remoteJupyterConnectionFailedWithoutServerWithErrorWeb=U=>E.l10n.t(`Connection failure. Verify the server is running and reachable from a browser. ({0}). 
When connecting from vscode.dev Jupyter servers must be started with specific options to connect. 
Click [here](https://aka.ms/vscjremoteweb) for more information.`,U),T.removeRemoteJupyterConnectionButtonText=E.l10n.t("Forget Connection"),T.jupyterNotebookRemoteConnectFailedWeb=U=>E.l10n.t(`Failed to connect to remote Jupyter Server.\r
Check that the Jupyter Server URL can be reached from a browser.\r
{0}. Click [here](https://aka.ms/vscjremoteweb) for more information.`,U),T.packageNotInstalledWindowsLongPathNotEnabledError=(U,rt)=>E.l10n.t(`Support for Windows Long Path has not been enabled, hence the package {0} could not be installed into the Python Environment '{1}'.
Please ensure that support for Windows Long Path is enabled.
See [here](https://pip.pypa.io/warnings/enable-long-paths) for more information.`,U,rt),T.changeRemoteJupyterConnectionButtonText=E.l10n.t("Manage Connections"),T.rawConnectionBrokenError=E.l10n.t("Direct kernel connection broken"),T.jupyterServerCrashed=U=>E.l10n.t(`Jupyter Server crashed. Unable to connect. \r
Error code from Jupyter: {0}`,U.toString()),T.jupyterKernelSpecModuleNotFound=U=>E.l10n.t(`'Kernelspec' module not installed in the selected interpreter ({0}).
 Please re-install or update 'jupyter'.`,U),T.interruptKernelStatus=U=>E.l10n.t("Interrupting Kernel {0}",U),T.exportPythonQuickPickLabel=E.l10n.t("Python Script"),T.exportHTMLQuickPickLabel=E.l10n.t("HTML"),T.exportPDFQuickPickLabel=E.l10n.t("PDF"),T.restartKernelAfterInterruptMessage=U=>E.l10n.t("Interrupting the kernel '{0}' timed out. Do you want to restart the kernel instead? All variables will be lost.",U),T.documentMismatch=U=>E.l10n.t("Cannot run cells, duplicate documents for {0} found.",U),T.jupyterGetVariablesBadResults=E.l10n.t("Failed to fetch variable info from the Jupyter Server."),E.l10n.t("Failure to create an 'Interactive' window. Try reinstalling the Python Extension."),T.jupyterGetVariablesExecutionError=U=>E.l10n.t(`Failure during variable extraction: \r
{0}`,U),T.selectKernel=E.l10n.t("Change Kernel"),T.selectDifferentKernel=E.l10n.t("Select a different Kernel"),T.kernelFilterPlaceholder=E.l10n.t("Choose the kernels that are available in the kernel picker."),T.recommendedItemCategoryInQuickPick=E.l10n.t("Recommended"),T.selectedKernelCategoryInQuickPick=E.l10n.t("Selected"),T.createPythonEnvironmentInQuickPick=E.l10n.t("Create Python Environment"),T.createPythonEnvironmentInQuickPickTooltip=E.l10n.t("Create an isolated Python Environment per workspace folder"),T.selectDifferentJupyterInterpreter=E.l10n.t("Change Interpreter"),T.pandasTooOldForViewingFormat=(U,rt)=>E.l10n.t({message:"Python package 'pandas' is version {0}. Version {1} or greater is required for viewing data.",args:[U,rt],comment:["Do not translate 'pandas' as that is a Python module name"]}),T.pandasRequiredForViewing=U=>E.l10n.t({message:"Python package 'pandas' version {0} (or above) is required for viewing data.",args:[U],comment:["Do not translate 'pandas' as that is a Python module name"]}),T.tooManyColumnsMessage=E.l10n.t("Variables with over a 1000 columns may take a long time to display. Are you sure you wish to continue?"),T.tooManyColumnsYes=E.l10n.t("Yes"),T.tooManyColumnsNo=E.l10n.t("No"),T.tooManyColumnsDontAskAgain=E.l10n.t("Don't Ask Again"),T.plotViewerTitle=E.l10n.t("Plots"),T.exportPlotTitle=E.l10n.t("Save plot image"),T.pdfFilter="PDF",T.pngFilter="PNG",T.svgFilter="SVG",T.exportImageFailed=U=>E.l10n.t("Error exporting image: {0}",U),T.jupyterDataRateExceeded=E.l10n.t({message:"Cannot view variable because data rate exceeded. Please restart your server with a higher data rate limit. For example, --NotebookApp.iopub_data_rate_limit=10000000000.0",comment:["Do not translate the text --NotebookApp.iopub_data_rate_limit=10000000000.0 as that is a command argument."]}),T.addCellBelowCommandTitle=E.l10n.t("Add cell"),T.debugCellCommandTitle=E.l10n.t("Debug Cell"),T.debugStepOverCommandTitle=E.l10n.t("Step over"),T.debugContinueCommandTitle=E.l10n.t("Continue"),T.debugStopCommandTitle=E.l10n.t("Stop"),T.runCurrentCellAndAddBelow=E.l10n.t("Run current cell and add empty cell below"),T.jupyterDebuggerNotInstalledError=U=>E.l10n.t("Pip module {0} is required for debugging cells. You will need to install it to debug cells.",U),T.jupyterDebuggerOutputParseError=U=>E.l10n.t("Unable to parse {0} output, please log an issue with https://github.com/microsoft/vscode-jupyter",U),T.cellStopOnErrorMessage=E.l10n.t("Cell was canceled due to an error in a previous cell."),T.scrollToCellTitleFormatMessage=U=>E.l10n.t("Go to [{0}]",U.toString()),T.instructionComments=U=>E.l10n.t(`# To add a new cell, type '{0}'
# To add a new markdown cell, type '{0} [markdown]'
`,U),T.exportButtonTitle=E.l10n.t("Export"),T.exportAsQuickPickPlaceholder=E.l10n.t("Export As..."),T.openExportedFileMessage=E.l10n.t("Would you like to open the exported file?"),T.openExportFileYes=E.l10n.t("Yes"),T.openExportFileNo=E.l10n.t("No"),T.exportFailedGeneralMessage=E.l10n.t({message:"Please check the 'Jupyter' [output](command:jupyter.viewOutput) panel for further details.",comment:['Do not translate the text "command:jupyter.viewOutput", that is a command Id that will be used by VS Code to open the output panel']}),T.exportToPDFDependencyMessage=E.l10n.t(`If you have not installed xelatex (TeX), you will need to do so before you can export to PDF. For further instructions, please see https://nbconvert.readthedocs.io/en/latest/install.html#installing-tex. \r
To avoid installing xelatex (TeX), you might want to try exporting to HTML and using your browser's "Print to PDF" feature.`),T.failedExportMessage=E.l10n.t("Export failed."),T.startingJupyterLogMessage=(U,rt)=>E.l10n.t("Starting Jupyter from {0} with arguments {1}",U,rt),T.waitingForJupyterSessionToBeIdle=E.l10n.t("Waiting for Jupyter Session to be idle"),T.gettingListOfKernelsForRemoteConnection=E.l10n.t("Fetching Kernels"),T.gettingListOfKernelSpecs=E.l10n.t("Fetching Kernel specs"),T.startingJupyterNotebook=E.l10n.t("Starting Jupyter Notebook"),T.registeringKernel=E.l10n.t("Registering Kernel"),T.jupyterCommandLineReloadQuestion=E.l10n.t("Please reload the window when changing the Jupyter command line."),T.jupyterCommandLineReloadAnswer=E.l10n.t("Reload"),T.createdNewKernel=(U,rt)=>E.l10n.t("{0}: Kernel started: {1}",U,rt),T.kernelInvalid=U=>E.l10n.t("Kernel {0} is not usable. Check the Jupyter output tab for more information.",U),T.removeRemoteJupyterServerEntryInQuickPick=E.l10n.t("Remove"),T.loadClassFailedWithNoInternet=(U,rt)=>E.l10n.t("Error loading {0}:{1}. Internet connection required for loading 3rd party widgets.",U,rt),T.useCDNForWidgetsNoInformation=E.l10n.t("Widgets require us to download supporting files from a 3rd party website."),T.enableCDNForWidgetsSetting=(U,rt)=>E.l10n.t("Widgets require us to download supporting files from a 3rd party website. (Error loading {0}:{1}).",U,rt),T.enableCDNForWidgetsButton=E.l10n.t("Enable Downloads"),T.unhandledMessage=(U,rt)=>E.l10n.t("Unhandled kernel message from a widget: {0} : {1}",U,rt),T.cdnWidgetScriptNotAccessibleWarningMessage=(U,rt)=>E.l10n.t("Unable to download widget '{0}' from 3rd party website {1}, due to network access. Expected behavior may be affected. Click [here](https://aka.ms/PVSCIPyWidgets) for more information.",U,rt),T.widgetScriptNotFoundOnCDNWidgetMightNotWork=(U,rt,ih)=>E.l10n.t("Unable to find widget '{0}' version '{1}' from configured widget sources {2}. Expected behavior may be affected. Click [here](https://aka.ms/PVSCIPyWidgets) for more information.",U,rt,ih),T.insecureSessionMessage=E.l10n.t("Connecting over HTTP without a token may be an insecure connection. Do you want to connect to a possibly insecure server?"),T.insecureSessionDenied=E.l10n.t("Denied connection to insecure server."),T.selectKernelForEditor=E.l10n.t("[Select a kernel](command:_notebook.selectKernel) to run cells."),T.needIpykernel6=E.l10n.t("Ipykernel setup required for this feature"),T.setup=E.l10n.t("Setup"),T.showDataViewerFail=E.l10n.t("Failed to create the Data Viewer. Check the Jupyter tab of the Output window for more info."),T.defaultNotebookName=E.l10n.t("default"),T.recommendExtensionForNotebookLanguage=(U,rt)=>E.l10n.t("The {0} extension is recommended for notebooks targeting the language '{1}'",U,rt),T.kernelWasNotStarted=E.l10n.t("Kernel was not started. A kernel session is needed to start debugging."),T.noNotebookToDebug=E.l10n.t("No active notebook document to debug."),T.cantStartDebugging=E.l10n.t("Can't start debugging."),T.restartNotSupported=E.l10n.t("Restarting is not supported in the interactive window."),T.importingIpynb=E.l10n.t("Importing notebook file"),T.exportingToFormat=U=>E.l10n.t("Exporting to {0}",U),T.kernelCategoryForJupyterSession=E.l10n.t("Jupyter Session"),T.kernelDefaultRemoteDisplayName=E.l10n.t("Remote"),T.kernelCategoryForJupyterKernel=E.l10n.t("Jupyter Kernel"),T.kernelCategoryForRemoteJupyterKernel=E.l10n.t("Jupyter Kernel"),T.kernelCategoryForConda=E.l10n.t("Conda Env"),T.kernelCategoryForCondaWithoutPython=E.l10n.t("Conda Env Without Python"),T.kernelCategoryForPoetry=E.l10n.t("Poetry Env"),T.kernelCategoryForPipEnv=E.l10n.t("Pipenv Env"),T.kernelCategoryForPyEnv=E.l10n.t("PyEnv Env"),T.kernelCategoryForGlobal=E.l10n.t("Global Env"),T.kernelCategoryForVirtual=E.l10n.t("Virtual Env"),T.fileSeemsToBeInterferingWithKernelStartup=U=>E.l10n.t("The file '{0}' seems to be overriding built in modules and interfering with the startup of the kernel. Consider renaming the file and starting the kernel again.",U),T.moduleSeemsToBeInterferingWithKernelStartup=U=>E.l10n.t("The module '{0}' seems to be overriding built in modules and interfering with the startup of the kernel. Consider renaming the folder and starting the kernel again.",U),T.pipCondaInstallHoverWarning=(U,rt)=>E.l10n.t("'!{0} install' could install packages into the wrong environment. [More info]({1})",U,rt),T.percentPipCondaInstallInsteadOfBang=U=>E.l10n.t({message:"Use '%{0} install' instead of '!{0} install'",args:[U],comment:['Do not translate the string within quotes, such as "%{0} install" and "!{0} install" as that is a Jupyter Shell Magic command']}),T.replacePipCondaInstallCodeAction=U=>E.l10n.t("Replace with '%{0} install'",U),T.failedToStartKernelDueToMissingModule=U=>E.l10n.t("The kernel failed to start due to the missing module '{0}'. Consider installing this module.",U),T.failedToStartKernelDueToImportFailure=U=>E.l10n.t("The kernel failed to start as the module '{0}' could not be imported.",U),T.failedToStartKernelDueToImportFailureFromFile=(U,rt)=>E.l10n.t("The kernel failed to start as '{0}' could not be imported from '{1}'.",U,rt),T.failedToStartKernelDueToUnknownDllLoadFailure=E.l10n.t("The kernel failed to start as a dll could not be loaded."),T.failedToStartKernelDueToDllLoadFailure=U=>E.l10n.t("The kernel failed to start as the dll '{0}' could not be loaded.",U),T.failedToStartKernelDueToWin32APIFailure=E.l10n.t("The kernel failed to start due to an error with the Win32api module. Consider (re) installing this module."),T.failedToStartKernelDueToPyZmqFailure=E.l10n.t({message:"The kernel failed to start due to an error with the 'pyzmq' module. Consider re-installing this module.",comment:['Do not translate the string "pyzmq" as that is a Python module.']}),T.failedToStartKernelDueToOldIPython=E.l10n.t("The kernel failed to start due to an outdated version of IPython. Consider updating this module to the latest version."),T.failedToStartKernelDueToOldIPyKernel=E.l10n.t("The kernel failed to start due to an outdated version of IPyKernel. Consider updating this module to the latest version."),T.failedToStartKernelDueToMissingPythonEnv=U=>E.l10n.t("The kernel failed to start as the Python Environment '{0}' is no longer available. Consider selecting another kernel or refreshing the list of Python Environments.",U),T.matplotlibWidgetInsteadOfOther=E.l10n.t("'%matplotlib' widget works best inside of VS Code"),T.matplotlibWidgetCodeActionTitle=E.l10n.t("More info"),T.allowExtensionToUseJupyterKernelApi=(U,rt)=>E.l10n.t("Do you want to give the extension '{0}' access to the Jupyter Kernels? Clicking '{1}' would allow this extension to execute code against the Jupyter Kernels.",U,rt),T.thanksForUsingJupyterKernelApiPleaseRegisterWithUs=U=>E.l10n.t("Thank you for trying the Jupyter API. Please file an issue on our repo to allow the extension {0} to use this API in production. This would prevent us from breaking your extension when updating the API (as it is still a work in progress).",U),T.activatingPythonEnvironment=U=>E.l10n.t("Activating Python Environment '{0}'",U),T.runningKernelStartupHooksFor=U=>E.l10n.t("Running Kernel startup hooks in '{0}'",U),T.cellAtFormat=(U,rt)=>E.l10n.t("{0} Cell {1}",U,rt),T.jupyterServerConsoleOutputChannel=E.l10n.t("Jupyter Server Console"),T.kernelConsoleOutputChannel=U=>E.l10n.t("{0} Kernel Console Output",U),T.webNotSupported=E.l10n.t("Operation not supported in web version of Jupyter Extension."),T.failedToInstallPythonExtension=E.l10n.t("Failed to install the Python Extension."),T.filesPossiblyOverridingPythonModulesMayHavePreventedKernelFromStarting=U=>E.l10n.t("Some of the following files found in the working directory may have prevented the Kernel from starting. Consider renaming them.",U),T.listOfFilesWithLinksThatMightNeedToBeRenamed=U=>E.l10n.t("File(s): {0} might need to be renamed.",U),T.failedToGetVersionOfPandas=E.l10n.t("Failed to get version of Pandas to use the Data Viewer."),T.failedToInstallPandas=E.l10n.t("Failed to install Pandas to use the Data Viewer."),T.localKernelSpecs=E.l10n.t("Jupyter Kernel..."),T.localPythonEnvironments=E.l10n.t("Python Environments..."),T.quickPickTitleForSelectionOfJupyterServer=E.l10n.t("Select a Jupyter Server"),T.UserJupyterServerUrlProviderDisplayName=E.l10n.t("Existing Jupyter Server..."),T.UserJupyterServerUrlProviderDetail=E.l10n.t("Connect to an existing Jupyter Server"),T.kernelPickerSelectKernelTitle=E.l10n.t("Select Kernel"),T.kernelPickerSelectLocalKernelSpecTitle=E.l10n.t("Select a Jupyter Kernel"),T.quickPickSelectPythonEnvironmentTitle=E.l10n.t("Select a Python Environment"),T.kernelPickerSelectKernelFromRemoteTitle=U=>E.l10n.t("Select a Kernel from {0}",U),T.kernelPickerSelectKernelFromRemoteTitleWithoutName=E.l10n.t("Select a Jupyter Kernel"),T.installPythonExtensionViaKernelPickerTitle=E.l10n.t("Install Python Extension"),T.installPythonExtensionViaKernelPickerToolTip=E.l10n.t("Python Extension is required to detect and use Python environments for the execution of code cells."),T.installPythonQuickPickTitle=E.l10n.t("Install Python"),T.installPythonQuickPickToolTip=E.l10n.t("Python Environments not detected. Upon installation reload VS Code or refresh the list of Kernels."),T.failedToFetchKernelSpecsRemoteErrorMessageForQuickPickLabel=E.l10n.t({message:"$(error) Unable to connect to the remote server",comment:"Do not translate the string $(error) as that is a VS Code icon."}),T.failedToFetchKernelSpecsRemoteErrorMessageForQuickPickDetail=E.l10n.t("Ensure the server is running and reachable.")))(y||={});var Jt;(Y=>(Y.collapseSingle=E.l10n.t("Collapse"),Y.expandSingle=E.l10n.t("Expand"),Y.noRowsInDataViewer=E.l10n.t("No rows match current filter"),Y.sliceIndexError=E.l10n.t({message:"Index {0} out of range for axis {1} with {2} elements",comment:["Do not translate the strings {0}, {1} and {2} as they are variable names and will be replaced later"]}),Y.sliceMismatchedAxesError=E.l10n.t({message:"Expected {0} axes, got {1} in slice expression",comment:["Do not translate the strings {0} and {2} as they are variable names and will be replaced later"]}),Y.fetchingDataViewer=E.l10n.t("Fetching data ..."),Y.dataViewerHideFilters=E.l10n.t("Hide filters"),Y.dataViewerShowFilters=E.l10n.t("Show filters"),Y.refreshDataViewer=E.l10n.t("Refresh data viewer"),Y.sliceSummaryTitle=E.l10n.t("SLICING"),Y.sliceData=E.l10n.t("Slice Data"),Y.sliceSubmitButton=E.l10n.t("Apply"),Y.sliceDropdownAxisLabel=E.l10n.t("Axis"),Y.sliceDropdownIndexLabel=E.l10n.t("Index"),Y.variableExplorerNameColumn=E.l10n.t("Name"),Y.variableExplorerTypeColumn=E.l10n.t("Type"),Y.variableExplorerCountColumn=E.l10n.t("Size"),Y.variableExplorerValueColumn=E.l10n.t("Value"),Y.collapseVariableExplorerLabel=E.l10n.t("Variables"),Y.variableLoadingValue=E.l10n.t("Loading..."),Y.showDataExplorerTooltip=E.l10n.t("Show variable snapshot in data viewer"),Y.noRowsInVariableExplorer=E.l10n.t("No variables defined"),Y.loadingRowsInVariableExplorer=E.l10n.t("Loading variables"),Y.previousPlot=E.l10n.t("Previous"),Y.nextPlot=E.l10n.t("Next"),Y.panPlot=E.l10n.t("Pan"),Y.zoomInPlot=E.l10n.t("Zoom in"),Y.zoomOutPlot=E.l10n.t("Zoom out"),Y.exportPlot=E.l10n.t("Export to different formats"),Y.deletePlot=E.l10n.t("Remove"),Y.selectedImageListLabel=E.l10n.t("Selected Image"),Y.selectedImageLabel=E.l10n.t("Image"),Y.errorOutputExceedsLinkToOpenFormatString=E.l10n.t({message:"Output exceeds the <a href={0}>size limit</a>. Open the full output data <a href={1}>in a text editor</a>",comment:['Do not translate the the Hyperlink text "<a href={0}>size limit</a>" and "<a href={1}>in a text editor</a>". However the text inside those tags can be translated']})))(Jt||={});var QS;(n=>(n.SHOW_DEPRECATED_FEATURE_PROMPT_FORMAT_ON_SAVE=E.l10n.t({message:"The setting 'python.formatting.formatOnSave' is deprecated, please use 'editor.formatOnSave'.",comment:['Do not translate the string "python.formatting.formatOnSave" as that is a setting in VS Code','Do not translate the string "editor.formatOnSave" as that is a setting in VS Code']}),n.SHOW_DEPRECATED_FEATURE_PROMPT_LINT_ON_TEXT_CHANGE=E.l10n.t({message:"The setting 'python.linting.lintOnTextChange' is deprecated, please enable 'python.linting.lintOnSave' and 'files.autoSave'.",comment:['Do not translate the string "python.linting.lintOnTextChange" as that is a setting in VS Code','Do not translate the string "python.linting.lintOnSave" as that is a setting in VS Code']}),n.SHOW_DEPRECATED_FEATURE_PROMPT_FOR_AUTO_COMPLETE_PRELOAD_MODULES=E.l10n.t({message:"The setting 'python.autoComplete.preloadModules' is deprecated, please consider using Pylance Language Server ('python.languageServer' setting).",comment:['Do not translate the string "python.autoComplete.preloadModules" as that is a setting in VS Code','Do not translate the string "python.languageServer" as that is a setting in VS Code']})))(QS||={});var Ah;(n=>(n.noCondaOrPipInstaller=E.l10n.t("There is no Conda or Pip installer available in the selected environment."),n.noPipInstaller=E.l10n.t("There is no Pip installer available in the selected environment."),n.searchForHelp=E.l10n.t("Search for help")))(Ah||={});var FN;(e=>e.installingModule=t=>E.l10n.t("Installing {0}",t))(FN||={});var YS="Python Kernel Debug Adapter",XS="Python Interactive Window Debug Adapter";var jw=require("node-fetch"),tx=k(g2());var y2=k(A());var Mh=class{async createHash(e,t="SHA-256"){return va(e,t)}};Mh=g([(0,y2.injectable)()],Mh);var Fw={},v2=!1,Lw;typeof window=="object"?Lw=window.crypto:typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope?Lw=self.crypto:Lw=require("node:crypto").webcrypto;async function va(r,e){let t=r.includes("/")||r.includes("\\")||r.endsWith(".interactive");if(t&&Fw[r])return Fw[r];let n=await Ote(r,e);return t&&!v2&&(Object.keys(Fw).length>1e4&&(v2=!0),Fw[r]=n),n}async function Ote(r,e){let t=new TextEncoder().encode(r),n=await Lw.subtle.digest({name:e},t);return Array.from(new Uint8Array(n)).map(o=>o.toString(16).padStart(2,"0")).join("")}function lp(r){try{let[e,t,n]=`${r.trim()}...`.split(".").map(i=>parseInt(i,10));return isNaN(e)?void 0:isNaN(t)?e.toString():isNaN(n)?`${e}.${t}`:`${e}.${t}.${n}`}catch(e){C(`Failed to parse version ${r}`,e)}}async function ht(r){return va(r,"SHA-256")}var Oh=require("vscode");var Ps=class extends tt{constructor(t,n,i){super("jupyterconnection",t+(n?`
${n}`:""));this.interpreter=i}};var Sn=class extends tt{constructor(){super("sessionDisposed",y.sessionDisposed)}};var Uw=class{static outputHasModuleNotInstalledError(e,t){return!!(t&&(t.indexOf(`No module named ${e}`)>0||t.indexOf(`No module named '${e}'`)>0))}};function Kh(r=""){if(!r)return;let e=/\S+Error: /g,t=`${r.trim()}: `.split(`
`).filter(s=>s.trim().length).reverse();if(t.length===0)return;let n=t[0],o=((n.match(e)?n:void 0)||"").split(":");return o.length&&o[0].endsWith("Error")?o[0]:void 0}function Ww(r=""){let e=I2(r);return e?e[1]:void 0}function I2(r=""){if(!r)return;let e=r.trim().split(`
`).map(t=>t.trim()).filter(t=>t.trim().length).reverse();if(e.length!==0&&e[0].includes("Error"))return[e.length>1?e[1]:"",e[0]]}function S2(r){if(!r)return;let t=(Array.isArray(r)?r[0]:r).split(`
`).map(l=>l.trim().toLowerCase()).filter(l=>l.length).reverse().find(l=>l.startsWith("file ")&&l.includes(", line ")&&l.includes(".py")&&l.includes(".py"));if(!t)return;let i=(t.substring(0,t.lastIndexOf(".py"))+".py").replace(/\\/g,"/").split("/"),o=i.indexOf("site-packages"),s=o>=0&&i.length>o+1?i[o+1]:"",a=i.reverse();if(!(a.length<2))return{fileName:a[0],folderName:a[1],packageName:s}}function rm(r,e,t,n="",i=[]){let o=e instanceof tt?e.stdErr||e.stack||"":e.toString(),s=I2(o),a=o.toLowerCase();if(e instanceof Sn)return{reason:"sessionDisposed",message:y.sessionDisposed,moreInfoLink:"https://aka.ms/kernelDisposedCannotRunCell",telemetrySafeTags:["deadSession"]};if(a.includes("ImportError: No module named 'win32api'".toLowerCase()))return{reason:"importWin32apiFailure",message:y.failedToStartKernelDueToWin32APIFailure,moreInfoLink:"https://aka.ms/kernelFailuresWin32Api",telemetrySafeTags:["win32api"]};if(a.includes("ImportError: DLL load failed".toLowerCase())&&a.includes("win32api"))return{reason:"importWin32apiFailure",message:y.failedToStartKernelDueToWin32APIFailure,moreInfoLink:"https://aka.ms/kernelFailuresWin32Api",telemetrySafeTags:["dll.load.failed","win32api"]};if(a.includes("ImportError: DLL load failed".toLowerCase())){let u=s&&s[0].toLowerCase().startsWith("import")?s[0].substring(6).trim():void 0;return{reason:"dllLoadFailure",moduleName:u,message:u?y.failedToStartKernelDueToDllLoadFailure(u):y.failedToStartKernelDueToUnknownDllLoadFailure,moreInfoLink:"https://aka.ms/kernelFailuresDllLoad",telemetrySafeTags:["dll.load.failed"]}}if(a.includes("AssertionError: Couldn't find Class NSProcessInfo".toLowerCase()))return{reason:"oldIPythonFailure",message:y.failedToStartKernelDueToOldIPython,moreInfoLink:"https://aka.ms/kernelFailuresOldIPython",telemetrySafeTags:["oldipython"]};if(a.includes("NotImplementedError".toLowerCase())&&a.includes("asyncio".toLowerCase())&&a.includes("events.py".toLowerCase()))return{reason:"oldIPyKernelFailure",message:y.failedToStartKernelDueToOldIPyKernel,moreInfoLink:"https://aka.ms/kernelFailuresOldIPyKernel",telemetrySafeTags:["oldipykernel"]};{let u=[];if(a.includes("ImportError: cannot import name".toLowerCase())&&a.includes("from partially initialized module".toLowerCase())&&a.includes("zmq.backend.cython".toLowerCase())&&u.push("zmq.backend.cython"),a.includes("zmq".toLowerCase())&&a.includes("cython".toLowerCase())&&a.includes("__init__.py".toLowerCase())&&u.push("zmq.cython"),a.includes("zmq.error.ZMQError")&&u.push("zmq.error"),u.length)return{reason:"zmqModuleFailure",message:y.failedToStartKernelDueToPyZmqFailure,moreInfoLink:"https://aka.ms/kernelFailuresPyzmq",telemetrySafeTags:u}}if(s&&s[1].toLowerCase().startsWith("importerror")){let u=b2(s[1]);if(u&&n){let d=Kte(u.moduleName,u.fileName,r,n);return d||{reason:"importFailure",moduleName:u.moduleName,fileName:u.fileName,message:u.fileName?y.failedToStartKernelDueToImportFailureFromFile(u.moduleName,u.fileName):y.failedToStartKernelDueToImportFailure(u.moduleName),moreInfoLink:u.fileName?"https://aka.ms/kernelFailuresModuleImportErrFromFile":"https://aka.ms/kernelFailuresModuleImportErr",telemetrySafeTags:["import.error"]}}}let l="No module named".toLowerCase(),c="is not a package".toLowerCase();if(a.includes(l)&&!c){let u=je(o).map(f=>f.trim()).filter(f=>f.length).find(f=>f.toLowerCase().includes(l)),d=u?u.substring(u.toLowerCase().indexOf(l)+l.length).trim():"";if(u)return{reason:"moduleNotFound",moduleName:d,message:y.failedToStartKernelDueToMissingModule(d),moreInfoLink:"https://aka.ms/kernelFailuresMissingModule",telemetrySafeTags:["module.notfound.error"]}}else if(a.includes(l)&&c){let u=je(o).map(S=>S.trim()).filter(S=>S.length).find(S=>S.toLowerCase().includes(l)),d=u?u.substring(u.toLowerCase().indexOf(l)+l.length).trim():"",f="",h="";d.split("'").length>2&&(f=d.split("'").slice(-2)[0]||"",f=f?`${f}.py`:"",h=f||"",d=d.split("'")[1]||d);let v=i.filter(S=>In(S).toLowerCase()==="__init__.py").map(S=>In(oi(S)));return d&&f&&d!==f&&i.some(S=>In(S).toLowerCase()===f.toLowerCase())?{reason:"overridingBuiltinModules",fileName:f,moduleName:d,message:y.fileSeemsToBeInterferingWithKernelStartup(f),moreInfoLink:"https://aka.ms/kernelFailuresOverridingBuiltInModules",telemetrySafeTags:["import.error","override.modules"]}:d&&v&&d!==h&&v.some(S=>S.toLowerCase()===h.toLowerCase())?{reason:"overridingBuiltinModules",folderName:h,moduleName:d,message:y.moduleSeemsToBeInterferingWithKernelStartup(h),moreInfoLink:"https://aka.ms/kernelFailuresOverridingBuiltInModules",telemetrySafeTags:["import.error","override.modules"]}:{reason:"moduleNotFound",moduleName:d,message:y.failedToStartKernelDueToMissingModule(d),moreInfoLink:"https://aka.ms/kernelFailuresMissingModule",telemetrySafeTags:["module.notfound.error"]}}else if(e instanceof tt&&e.category==="invalidkernel"&&i.length){let u=In(i[0]);return{reason:"overridingBuiltinModules",fileName:u,moduleName:In(i[0],".py"),message:y.fileSeemsToBeInterferingWithKernelStartup(u),moreInfoLink:"https://aka.ms/kernelFailuresOverridingBuiltInModules",telemetrySafeTags:["import.error","override.modules"]}}else if(s&&s[1].toLowerCase().startsWith("ModuleNotFoundError".toLowerCase())){let u=b2(s[1]);if(u)return{reason:"moduleNotFound",moduleName:u.moduleName,message:y.failedToStartKernelDueToMissingModule(u.moduleName),moreInfoLink:"https://aka.ms/kernelFailuresMissingModule",telemetrySafeTags:["module.notfound.error"]}}if(e instanceof Ps){let u=je(o).map(b=>b.trim()).reverse().find(b=>b.toLowerCase().includes("error: ")),d="AttributeError: 'Namespace' object has no attribute '_flags'",f=["jupyter.startup.failure"],h,v="jupyterStartFailure",S=je(e.message,{removeEmptyEntries:!0,trim:!0}).reverse().find(b=>b.toLowerCase().includes("error: "));if(S=S||je(e.stdErr||"",{removeEmptyEntries:!0,trim:!0}).reverse().find(b=>b.toLowerCase().includes("error: ")),a.includes(d.toLowerCase())?(v="jupyterStartFailureOutdatedTraitlets",u=y.failedToStartJupyterDueToOutdatedTraitlets(t||"",S||""),f.push("outdated.traitlets"),h="https://aka.ms/kernelFailuresJupyterTrailtletsOutdated"):(u=S?y.failedToStartJupyterWithErrorInfo(t||"",S):y.failedToStartJupyter(t||""),h=void 0),u)return{reason:v,message:u,pythonError:S,moreInfoLink:h,telemetrySafeTags:f}}}function b2(r){r=r.replace(/"/g,"'");let e=r.match(/'[^\\']*(\\'[^\\']*)*'/g),t=r.match(/\((.*?)\)/g),n,i;return e&&e[0].length>2&&(n=e[0],n=n.substring(1,n.length-1)),t&&t[0].length>2&&(i=t[0],i=i.substring(1,i.length-1)),n?{moduleName:n,fileName:i}:void 0}function Kte(r,e,t,n){if(n&&t.length!==0&&e&&!e.toLowerCase().startsWith(n)&&t.some(i=>e.toLowerCase().startsWith(i.uri.fsPath.toLowerCase())))return{reason:"overridingBuiltinModules",fileName:e,moduleName:r,message:y.fileSeemsToBeInterferingWithKernelStartup(W(Oh.Uri.file(e),t||[])),moreInfoLink:"https://aka.ms/kernelFailuresOverridingBuiltInModules",telemetrySafeTags:["import.error","override.modules"]}}function Fh(r){if(!r)return;let e=/\[([^\[\]]*)\]\((.*?)\)/gm,t;for(;(t=e.exec(r))!==null;)t.length===3&&(r=r.replace(t[0],`<a href='${t[2]}'>${t[1]}</a>`));let n=je(r,{removeEmptyEntries:!1,trim:!1}).map(i=>`\x1B[1;31m${i}`).join(`
`);return new Oh.NotebookCellOutput([Oh.NotebookCellOutputItem.error({message:"",name:"",stack:n})])}var Fte=[Lte,Ute];function x2(r){let e=[],t=Array.isArray(r)?r[0].toLowerCase():r.toLowerCase();Fte.forEach(i=>i(t,e));let n=rm([],t,void 0);return n?.telemetrySafeTags.length&&e.push(...n.telemetrySafeTags),Array.from(new Set(e)).join(",")}function Lte(r,e=[]){r.includes("ChildProcess.exithandler".toLowerCase())&&e.push("childproc.exit")}function Ute(r,e=[]){r.includes("KernelRestarter: restart failed".toLowerCase())&&e.push("KernelRestarter.failed")}async function C2(r,e){r.failed=!0,r.failureCategory=r.failureCategory||_N(e);let t=!jw.FetchError&&e?.name==="TypeError"&&e?.message==="Failed to fetch",i=(t||jw.FetchError!==void 0)&&Vte(e,t?TypeError:jw.FetchError);r.failureCategory==="unknown"&&i&&(r.failureCategory="fetcherror"),r.stackTrace=Wte(e),typeof e=="string"&&(r.failureSubCategory="errorisstring");let o=e.stdErr?e.stdErr:e.stack||"";if(!o)return;r.failureSubCategory=r.failureSubCategory||x2(o);let s=S2(o);s&&([r.pythonErrorFile,r.pythonErrorFolder,r.pythonErrorPackage]=await Promise.all([Promise.resolve(r.pythonErrorFile||ht(s.fileName)),Promise.resolve(r.pythonErrorFolder||ht(s.folderName)),Promise.resolve(r.pythonErrorPackage||ht(s.packageName))]))}function LN(r){if(r.stack&&Array.isArray(r.stack)){let e={...r,stack:r.stack.join(`
`)};return tx.parse.call(tx,e)}return tx.parse.call(tx,r)}function Wte(r){let e="";for(let t of LN(r)){let n=t.getFileName();if(n){let i=t.getLineNumber(),o=t.getColumnNumber();e+=`
	at ${jte(t)} ${n}:${i}:${o}`}else e+=`
	at <anonymous>`}return e.trim().replace(/\\/g,"/")}function jte(r){let e=[];return typeof r.getTypeName()=="string"&&r.getTypeName().length>0&&e.push(r.getTypeName()),typeof r.getMethodName()=="string"&&r.getMethodName().length>0&&e.push(r.getMethodName()),typeof r.getFunctionName()=="string"&&r.getFunctionName().length>0&&(e.length!==2||e.join(".")!==r.getFunctionName())&&e.push(r.getFunctionName()),e.join(".")}function Vte(r,e){return e?r instanceof e||r instanceof hn&&r.originalException instanceof e:(console.error("Error type is not defined",r),!1)}function Bte(){try{return require("vscode")===void 0?!1:k2()!==void 0}catch{return!1}}function Bw(r){return r.getConfiguration("telemetry").inspect("enableTelemetry").globalValue===!1}var Vw={};function Lh(r,e){let t=r;_S()&&t.startsWith("ds_")||(e===void 0?delete Vw[t]:Vw[t]=e)}var UN;function k2(){if(UN)return UN;let r=require("@vscode/extension-telemetry").default;return UN=new r(iW)}function E2(r,e){let t={};return Object.getOwnPropertyNames(e).forEach(n=>{if(!(e[n]===void 0||e[n]===null))try{t[n]=typeof e[n]=="string"?e[n]:typeof e[n]=="object"?"object":e[n].toString()}catch(i){C(`Failed to serialize ${n} for ${r}`,i)}}),t}function R(r,e,t,n){Pr()||!Bte()||qte(r,e,t,n)}function qte(r,e,t,n){let i=k2(),o={},s=r;n?(o={},Object.assign(o,Vw),Object.assign(o,t||{}),C2(o,n).then(()=>{o=E2(s,o),i.sendTelemetryEvent(s,o,e)}).catch(m)):(t&&(o=E2(s,t)),Object.assign(o,Vw),i.sendTelemetryEvent(s,o,e))}var w2=new Set;function yr(r,e){return function(t,n,i){let o=i.value;return i.value=function(...s){let a=e||{},l=new $e,c=`${r.toString()}${JSON.stringify(a)}`,u=!w2.has(c);w2.add(c);let d=o.apply(this,s);return d&&typeof d.then=="function"&&typeof d.catch=="function"?d.then(f=>{let h={...a};return u&&(h.firstTime=u),R(r,l?{duration:l?.elapsedTime}:void 0,h),f}).catch(f=>{let h={...a};h.failed=!0,R(r,l?{duration:l?.elapsedTime}:{},h,f)}):R(r,l?{duration:l?.elapsedTime}:void 0,a),d},i}}function sn(r,e){return function(t,n,i){let o=i.value;return i.value=function(...s){return R(r,void 0,e),o.apply(this,s)},i}}function Jte(){return{isInsiderExtension:{classification:"SystemMetaData",purpose:"FeatureInsight",comment:"Whether this is the Insider version of the Jupyter extension or not. Common to all events."},isPythonExtensionInstalled:{classification:"SystemMetaData",purpose:"FeatureInsight",comment:"Whether Python extension is installed or not. Common to all events."},rawKernelSupported:{classification:"SystemMetaData",purpose:"FeatureInsight",comment:"Whether the raw kernel is supported or not. Common to all events."}}}function Nt(){return{duration:{classification:"PublicNonPersonalData",purpose:"PerformanceAndHealth",isMeasurement:!0}}}function jo(){return{resourceType:{classification:"PublicNonPersonalData",comment:"",purpose:"FeatureInsight"}}}function xl(){return{failed:{classification:"PublicNonPersonalData",comment:"",purpose:"PerformanceAndHealth"},failureCategory:{classification:"PublicNonPersonalData",comment:"",purpose:"PerformanceAndHealth"},failureSubCategory:{classification:"PublicNonPersonalData",comment:"",purpose:"PerformanceAndHealth"},pythonErrorFile:{classification:"PublicNonPersonalData",comment:"",purpose:"PerformanceAndHealth"},pythonErrorFolder:{classification:"PublicNonPersonalData",comment:"",purpose:"PerformanceAndHealth"},pythonErrorPackage:{classification:"PublicNonPersonalData",comment:"",purpose:"PerformanceAndHealth"},stackTrace:{classification:"PublicNonPersonalData",comment:"",purpose:"PerformanceAndHealth"}}}function ro(){return{properties:{actionSource:{classification:"PublicNonPersonalData",comment:"",purpose:"PerformanceAndHealth"},disableUI:{classification:"PublicNonPersonalData",comment:"",purpose:"PerformanceAndHealth"},userExecutedCell:{classification:"PublicNonPersonalData",comment:"",purpose:"PerformanceAndHealth"},resourceHash:{classification:"PublicNonPersonalData",purpose:"PerformanceAndHealth"},pythonEnvironmentVersion:{classification:"PublicNonPersonalData",comment:"",purpose:"PerformanceAndHealth"},pythonEnvironmentType:{classification:"PublicNonPersonalData",comment:"",purpose:"PerformanceAndHealth"},pythonEnvironmentPath:{classification:"PublicNonPersonalData",comment:"",purpose:"PerformanceAndHealth"},pythonEnvironmentPackages:{classification:"PublicNonPersonalData",comment:"",purpose:"PerformanceAndHealth"},kernelSessionId:{classification:"PublicNonPersonalData",comment:"",purpose:"PerformanceAndHealth"},kernelLanguage:{classification:"PublicNonPersonalData",comment:"",purpose:"PerformanceAndHealth"},kernelSpecHash:{classification:"EndUserPseudonymizedInformation",purpose:"FeatureInsight"},kernelId:{classification:"PublicNonPersonalData",comment:"",purpose:"PerformanceAndHealth"},kernelConnectionType:{classification:"PublicNonPersonalData",comment:"",purpose:"PerformanceAndHealth"},isUsingActiveInterpreter:{classification:"PublicNonPersonalData",comment:"",purpose:"PerformanceAndHealth"},capturedEnvVars:{classification:"PublicNonPersonalData",comment:"",purpose:"PerformanceAndHealth"},newKernelPicker:{classification:"PublicNonPersonalData",comment:"",purpose:"PerformanceAndHealth"},...jo()}}}var Fxe={...Nt(),...xl(),...Jte()};var $te,Hte,Gte,zte,Qte,Yte,Xte,Zte,ere,tre,rre,nre,ire,ore,sre,are,lre,cre,ure,pre,dre,mre,fre,hre,gre,vre,yre,bre,Ire,Sre,xre,Cre,Ere,wre,kre,Pre,Dre,Tre,_re,Rre,Nre,Are,Mre,Ore,Kre,Fre,Lre,Ure,Wre,jre,Vre,Bre,qre,Jre,$re,Hre,Gre,zre,Qre,Yre,Xre,Zre,ene,tne,rne,nne,ine,one,sne,ane,lne,cne,une,pne,dne,mne,fne,hne,gne,vne,yne,bne,Ine,Sne,xne,Cne,Ene,wne,kne,Pne,Dne,Tne,_ne,Rne,Nne,Ane,Mne,One,Kne,Fne,Lne,Une,Wne,jne,Vne,Bne,qne,Jne,$ne,Hne,Gne,zne,Qne,Yne,Xne,Zne,eie,tie,rie,nie,iie,oie,sie,aie,lie,cie,uie,pie,die,mie,fie,hie,gie,vie,yie,bie,Iie,Sie,xie,Cie,Eie,wie,kie,Pie,Die,Tie,_ie,Rie,Nie,Aie,Mie,Oie,Kie,Fie,Lie,Uie,Wie,jie,Vie,Bie,qie,P2=class{constructor(){this[$te]={owner:"donjayamanne",feature:"N/A",source:"N/A",measures:{totalActivateTime:{classification:"SystemMetaData",purpose:"PerformanceAndHealth",isMeasurement:!0},codeLoadingTime:{classification:"SystemMetaData",purpose:"PerformanceAndHealth",isMeasurement:!0},workspaceFolderCount:{classification:"SystemMetaData",purpose:"PerformanceAndHealth",isMeasurement:!0}}};this[Hte]={owner:"donjayamanne",feature:"N/A",source:"N/A",measures:Nt()};this[Gte]={owner:"donjayamanne",feature:"N/A",source:"N/A"};this[zte]={owner:"donjayamanne",feature:"N/A",source:"N/A"};this[Qte]={owner:"donjayamanne",feature:"N/A",source:"N/A",properties:{hashedNamev2:{classification:"SystemMetaData",purpose:"FeatureInsight"},when:{classification:"SystemMetaData",purpose:"FeatureInsight"},...jo()}};this[Yte]={owner:"donjayamanne",feature:"N/A",source:"N/A",properties:{firstTime:{classification:"SystemMetaData",purpose:"PerformanceAndHealth"}},measures:Nt()};this[Xte]={owner:"donjayamanne",feature:"N/A",source:"N/A",properties:{mimeType:{classification:"PublicNonPersonalData",purpose:"FeatureInsight"},when:{classification:"SystemMetaData",purpose:"FeatureInsight"},...jo()}};this[Zte]={owner:"donjayamanne",feature:"N/A",source:"N/A",properties:{envType:{classification:"SystemMetaData",purpose:"FeatureInsight"},failed:{classification:"SystemMetaData",purpose:"PerformanceAndHealth"},reason:{classification:"SystemMetaData",purpose:"PerformanceAndHealth"},source:{classification:"SystemMetaData",purpose:"FeatureInsight"}},measures:Nt()};this[ere]={owner:"IanMatthewHuff",source:"User Action",feature:["DataFrameViewer","VariableViewer"]};this[tre]={owner:"IanMatthewHuff",source:"N/A",feature:["DataFrameViewer","VariableViewer"]};this[rre]={owner:"IanMatthewHuff",source:"User Action",feature:["DataFrameViewer","VariableViewer"]};this[nre]={owner:"amunger",feature:["InteractiveWindow"],source:"User Action",measures:Nt()};this[ire]={owner:"amunger",feature:["InteractiveWindow"],source:"User Action",measures:Nt()};this[ore]={owner:"amunger",feature:["InteractiveWindow"],source:"N/A",measures:{codeLensUpdateTime:{classification:"SystemMetaData",purpose:"PerformanceAndHealth",isMeasurement:!0},maxCellCount:{classification:"SystemMetaData",purpose:"FeatureInsight",isMeasurement:!0}}};this[sre]={owner:"roblourens",feature:["Debugger"],source:"User Action"};this[are]={owner:"roblourens",feature:["Debugger"],source:"User Action"};this[lre]={owner:"roblourens",feature:["Debugger"],source:"User Action"};this[cre]={owner:"roblourens",feature:["Debugger"],source:"User Action"};this[ure]={owner:"roblourens",feature:["Debugger"],source:"User Action"};this[pre]={owner:"donjayamanne",feature:"N/A",source:"N/A",tags:["KernelStartup"],properties:{...xl(),failed:{classification:"CallstackOrException",purpose:"PerformanceAndHealth"},reason:{classification:"SystemMetaData",purpose:"PerformanceAndHealth",comment:"Reason for failure to fetch kernel specs"},sessionManagerReady:{classification:"SystemMetaData",purpose:"PerformanceAndHealth"},specsManagerReady:{classification:"SystemMetaData",purpose:"PerformanceAndHealth"},wasSessionManagerReady:{classification:"SystemMetaData",purpose:"PerformanceAndHealth"},wasSpecsManagerReady:{classification:"SystemMetaData",purpose:"PerformanceAndHealth"}},measures:Nt()};this[dre]={owner:"donjayamanne",feature:"N/A",source:"N/A",properties:{kernelSpecHash:{classification:"EndUserPseudonymizedInformation",purpose:"FeatureInsight"},serverIdHash:{classification:"SystemMetaData",purpose:"FeatureInsight"},providerExtensionId:{classification:"SystemMetaData",purpose:"FeatureInsight"},baseUrlHash:{classification:"SystemMetaData",purpose:"FeatureInsight"},kernelId:{classification:"SystemMetaData",purpose:"FeatureInsight"},kernelConnectionType:{classification:"SystemMetaData",purpose:"FeatureInsight"},kernelLanguage:{classification:"SystemMetaData",purpose:"FeatureInsight"},envType:{classification:"SystemMetaData",purpose:"FeatureInsight"},isArgv0SameAsInterpreter:{classification:"SystemMetaData",purpose:"FeatureInsight"},argv0:{classification:"SystemMetaData",purpose:"FeatureInsight"},argv:{classification:"SystemMetaData",purpose:"FeatureInsight"}}};this[mre]={owner:"donjayamanne",feature:"N/A",source:"N/A",tags:["KernelStartup"],properties:{serverIdHash:{classification:"PublicNonPersonalData",purpose:"FeatureInsight"},baseUrlHash:{classification:"PublicNonPersonalData",purpose:"FeatureInsight"},failed:{classification:"PublicNonPersonalData",purpose:"PerformanceAndHealth"},isLocalHost:{classification:"PublicNonPersonalData",purpose:"PerformanceAndHealth"},isJupyterHub:{classification:"PublicNonPersonalData",purpose:"PerformanceAndHealth"},reason:{classification:"PublicNonPersonalData",purpose:"PerformanceAndHealth"}}};this[fre]={owner:"amunger",feature:["InteractiveWindow"],source:"User Action"};this[hre]={owner:"amunger",feature:["InteractiveWindow"],source:"User Action"};this[gre]={owner:"donjayamanne",feature:"N/A",source:"N/A",tags:["KernelStartup"],properties:ro().properties,measures:{...Nt()}};this[vre]={owner:"IanMatthewHuff",feature:["Import-Export","InteractiveWindow"],source:"User Action"};this[yre]={owner:"IanMatthewHuff",feature:["Import-Export","InteractiveWindow"],source:"User Action"};this[bre]={owner:"IanMatthewHuff",feature:["Import-Export","InteractiveWindow"],source:"User Action",properties:{format:{classification:"SystemMetaData",purpose:"FeatureInsight"}}};this[Ire]={owner:"IanMatthewHuff",feature:["Import-Export"],source:"N/A",properties:{format:{classification:"SystemMetaData",purpose:"FeatureInsight"},cancelled:{classification:"SystemMetaData",purpose:"FeatureInsight"},successful:{classification:"SystemMetaData",purpose:"FeatureInsight"},opened:{classification:"SystemMetaData",purpose:"FeatureInsight"}}};this[Sre]={owner:"IanMatthewHuff",feature:["Import-Export"],source:"User Action",properties:{scope:{classification:"SystemMetaData",purpose:"FeatureInsight"}}};this[xre]={owner:"IanMatthewHuff",feature:["Import-Export"],source:"User Action",properties:{format:{classification:"SystemMetaData",purpose:"FeatureInsight"}}};this[Cre]={owner:"IanMatthewHuff",feature:["Import-Export"],source:"N/A",properties:{format:{classification:"SystemMetaData",purpose:"FeatureInsight"}}};this[Ere]={owner:"donjayamanne",feature:"N/A",source:"N/A"};this[wre]={owner:"donjayamanne",feature:"N/A",source:"N/A"};this[kre]={owner:"donjayamanne",feature:"N/A",source:"N/A",properties:{failed:{classification:"SystemMetaData",purpose:"FeatureInsight"},info:{classification:"SystemMetaData",purpose:"FeatureInsight"}}};this[Pre]={owner:"IanMatthewHuff",feature:["DataFrameViewer"],source:"N/A"};this[Dre]={owner:"IanMatthewHuff",feature:["DataFrameViewer"],source:"N/A"};this[Tre]={owner:"IanMatthewHuff",feature:["DataFrameViewer"],source:"N/A"};this[_re]={owner:"IanMatthewHuff",feature:["DataFrameViewer"],source:"N/A"};this[Rre]={owner:"donjayamanne",feature:"N/A",source:"N/A",measures:{nbformat:{classification:"PublicNonPersonalData",isMeasurement:!0,purpose:"FeatureInsight"},nbformat_minor:{classification:"PublicNonPersonalData",isMeasurement:!0,purpose:"FeatureInsight"}}};this[Nre]={owner:"IanMatthewHuff",feature:["PlotViewer"],source:"User Action"};this[Are]={owner:"amunger",feature:["InteractiveWindow"],source:"User Action"};this[Mre]={owner:"amunger",feature:["InteractiveWindow"],source:"User Action"};this[Ore]={owner:"amunger",feature:["InteractiveWindow"],source:"User Action"};this[Kre]={owner:"amunger",feature:["InteractiveWindow"],source:"User Action"};this[Fre]={owner:"amunger",feature:["InteractiveWindow"],source:"User Action"};this[Lre]={owner:"amunger",feature:["InteractiveWindow"],source:"User Action"};this[Ure]={owner:"amunger",feature:["InteractiveWindow"],source:"User Action"};this[Wre]={owner:"amunger",feature:["InteractiveWindow"],source:"N/A"};this[jre]={owner:"amunger",feature:["InteractiveWindow"],source:"N/A"};this[Vre]={owner:"amunger",feature:["InteractiveWindow"],source:"N/A",measures:Nt()};this[Bre]={owner:"amunger",feature:["InteractiveWindow"],source:"N/A",measures:Nt()};this[qre]={owner:"amunger",feature:["InteractiveWindow"],source:"N/A",measures:Nt()};this[Jre]={owner:"amunger",feature:["InteractiveWindow"],source:"N/A",measures:Nt()};this[$re]={owner:"amunger",feature:["InteractiveWindow"],source:"N/A",measures:Nt()};this[Hre]={owner:"amunger",feature:["InteractiveWindow"],source:"N/A",measures:Nt()};this[Gre]={owner:"amunger",feature:["InteractiveWindow"],source:"N/A",measures:Nt()};this[zre]={owner:"amunger",feature:["InteractiveWindow"],source:"N/A",measures:Nt()};this[Qre]={owner:"amunger",feature:["InteractiveWindow"],source:"N/A",measures:Nt()};this[Yre]={owner:"amunger",feature:["InteractiveWindow"],source:"N/A",measures:Nt()};this[Xre]={owner:"amunger",feature:["InteractiveWindow"],source:"N/A",measures:Nt()};this[Zre]={owner:"amunger",feature:["InteractiveWindow"],source:"N/A",measures:Nt()};this[ene]={owner:"amunger",feature:["InteractiveWindow"],source:"N/A",measures:Nt()};this[tne]={owner:"amunger",feature:["InteractiveWindow"],source:"N/A",measures:Nt()};this[rne]={owner:"amunger",feature:["InteractiveWindow"],source:"N/A",measures:Nt()};this[nne]={owner:"donjayamanne",feature:"N/A",source:"N/A"};this[ine]={owner:"donjayamanne",feature:"N/A",source:"N/A"};this[one]={owner:"donjayamanne",feature:"N/A",source:"N/A",tags:["KernelStartup"]};this[sne]={owner:"IanMatthewHuff",feature:["DataFrameViewer"],source:"N/A"};this[ane]={owner:"donjayamanne",feature:"N/A",source:"N/A",tags:["KernelStartup"]};this[lne]={owner:"IanMatthewHuff",feature:["DataFrameViewer"],source:"N/A"};this[cne]={owner:"IanMatthewHuff",feature:["KernelPicker"],source:"User Action",properties:{action:{classification:"SystemMetaData",purpose:"FeatureInsight"}}};this[une]={owner:"donjayamanne",feature:["KernelPicker"],source:"User Action",properties:{action:{classification:"SystemMetaData",purpose:"FeatureInsight"}}};this[pne]={owner:"donjayamanne",feature:["KernelPicker"],source:"User Action",properties:{action:{classification:"SystemMetaData",purpose:"FeatureInsight"}}};this[dne]={owner:"donjayamanne",feature:"N/A",source:"N/A",properties:{action:{classification:"SystemMetaData",purpose:"FeatureInsight"},isModulePresent:{classification:"SystemMetaData",purpose:"PerformanceAndHealth"},moduleName:{classification:"PublicNonPersonalData",purpose:"FeatureInsight"},pythonEnvType:{classification:"SystemMetaData",purpose:"FeatureInsight"},resourceHash:{classification:"SystemMetaData",purpose:"FeatureInsight"},...jo()},measures:Nt()};this[mne]={owner:"amunger",feature:["InteractiveWindow"],source:"N/A"};this[fne]={owner:"IanMatthewHuff",feature:["DataFrameViewer"],source:"User Action",measures:Nt()};this[hne]={owner:"IanMatthewHuff",source:"N/A",feature:["DataFrameViewer"],measures:{rows:{classification:"PublicNonPersonalData",purpose:"FeatureInsight",isMeasurement:!0},columns:{classification:"PublicNonPersonalData",purpose:"FeatureInsight",isMeasurement:!0}}};this[gne]={owner:"IanMatthewHuff",source:"N/A",feature:["DataFrameViewer"],measures:{rowsTimer:{classification:"SystemMetaData",purpose:"PerformanceAndHealth"}}};this[vne]={owner:"IanMatthewHuff",feature:["DataFrameViewer","VariableViewer"],source:"N/A"};this[yne]={owner:"IanMatthewHuff",feature:["DataFrameViewer"],source:"User Action"};this[bne]={owner:"donjayamanne",feature:"N/A",source:"N/A",properties:{failedWithoutBackingFile:{classification:"SystemMetaData",purpose:"FeatureInsight"},failedWithBackingFile:{classification:"SystemMetaData",purpose:"FeatureInsight"},localHost:{classification:"SystemMetaData",purpose:"FeatureInsight"}}};this[Ine]={owner:"donjayamanne",feature:"N/A",source:"N/A",properties:{failed:{classification:"SystemMetaData",purpose:"FeatureInsight"},fallbackTried:{classification:"SystemMetaData",purpose:"FeatureInsight"},alpine:{classification:"SystemMetaData",purpose:"FeatureInsight"},zmqarch:{classification:"SystemMetaData",purpose:"FeatureInsight"},libc:{classification:"SystemMetaData",purpose:"FeatureInsight"},armv:{classification:"SystemMetaData",purpose:"FeatureInsight"},distro_id:{classification:"SystemMetaData",purpose:"FeatureInsight"},distro_version_id:{classification:"SystemMetaData",purpose:"FeatureInsight"}}};this[Sne]={owner:"donjayamanne",feature:"N/A",source:"N/A",properties:{failed:{classification:"SystemMetaData",purpose:"FeatureInsight"},fallbackTried:{classification:"SystemMetaData",purpose:"FeatureInsight"},alpine:{classification:"SystemMetaData",purpose:"FeatureInsight"},zmqarch:{classification:"SystemMetaData",purpose:"FeatureInsight"},libc:{classification:"SystemMetaData",purpose:"FeatureInsight"},armv:{classification:"SystemMetaData",purpose:"FeatureInsight"},distro_id:{classification:"SystemMetaData",purpose:"FeatureInsight"},distro_version_id:{classification:"SystemMetaData",purpose:"FeatureInsight"},errorMessage:{classification:"CallstackOrException",purpose:"FeatureInsight"},fallbackErrorMessage:{classification:"CallstackOrException",purpose:"FeatureInsight"},zmqBinaries:{classification:"CallstackOrException",purpose:"FeatureInsight"}}};this[xne]={owner:"IanMatthewHuff",feature:["VariableViewer"],source:"N/A",measures:Nt()};this[Cne]={owner:"IanMatthewHuff",feature:["VariableViewer"],source:"N/A",measures:{variableCount:{classification:"PublicNonPersonalData",purpose:"FeatureInsight",isMeasurement:!0}}};this[Ene]={owner:"donjayamanne",feature:"N/A",source:"N/A",tags:["KernelStartup"],properties:{kind:{classification:"SystemMetaData",purpose:"FeatureInsight"},language:{classification:"SystemMetaData",purpose:"FeatureInsight"},usesShell:{classification:"SystemMetaData",purpose:"FeatureInsight"}}};this[wne]={owner:"donjayamanne",feature:"N/A",source:"N/A",tags:["KernelStartup"],properties:{...xl(),...jo()},measures:{...Nt()}};this[kne]={owner:"donjayamanne",feature:"N/A",source:"N/A",properties:{kernelConnectionType:{classification:"SystemMetaData",purpose:"FeatureInsight"},pythonPathDefined:{classification:"SystemMetaData",purpose:"FeatureInsight"},pythonEnvFound:{classification:"SystemMetaData",purpose:"FeatureInsight"},language:{classification:"SystemMetaData",purpose:"FeatureInsight"},kernelSpecHash:{classification:"EndUserPseudonymizedInformation",purpose:"FeatureInsight"},argv0:{classification:"SystemMetaData",purpose:"FeatureInsight"},isCreatedByUs:{classification:"SystemMetaData",purpose:"FeatureInsight"}}};this[Pne]={owner:"amunger",feature:["InteractiveWindow"],source:"N/A"};this[Dne]={owner:"amunger",feature:["InteractiveWindow"],source:"N/A",properties:{hasKernel:{classification:"SystemMetaData",purpose:"FeatureInsight",comment:"If the kernel was known at the time of creation"},hasOwner:{classification:"SystemMetaData",purpose:"FeatureInsight",comment:"If the window was created for a text file"},mode:{classification:"SystemMetaData",purpose:"FeatureInsight",comment:"Creation mode: multiple, perfile or single"},restored:{classification:"SystemMetaData",purpose:"FeatureInsight",comment:"Was the window restored from a previous session"}},measures:{windowCount:{classification:"SystemMetaData",purpose:"FeatureInsight",comment:"Number of active interactive windows the user has open",isMeasurement:!0}}};this[Tne]={owner:"donjayamanne",feature:["Notebook","InteractiveWindow"],tags:["Widgets"],source:"N/A",properties:{cdnSearched:{classification:"SystemMetaData",purpose:"FeatureInsight"},hashedName:{classification:"PublicNonPersonalData",purpose:"FeatureInsight"},source:{classification:"SystemMetaData",purpose:"FeatureInsight"},moduleName:{classification:"PublicNonPersonalData",purpose:"FeatureInsight"},modelName:{classification:"PublicNonPersonalData",purpose:"FeatureInsight"},moduleVersion:{classification:"PublicNonPersonalData",purpose:"FeatureInsight"}}};this[_ne]={owner:"donjayamanne",feature:["Notebook","InteractiveWindow"],tags:["Widgets"],source:"N/A",properties:{type:{classification:"SystemMetaData",purpose:"FeatureInsight"}},measures:Nt()};this[Rne]={owner:"donjayamanne",feature:["Notebook","InteractiveWindow"],tags:["Widgets"],source:"N/A"};this[Nne]={owner:"donjayamanne",feature:["Notebook","InteractiveWindow"],tags:["Widgets"],source:"N/A",properties:{moduleHash:{classification:"PublicNonPersonalData",purpose:"FeatureInsight"},moduleVersion:{classification:"PublicNonPersonalData",purpose:"FeatureInsight"}}};this[Ane]={owner:"donjayamanne",feature:["Notebook","InteractiveWindow"],tags:["Widgets"],source:"N/A",properties:{timedout:{classification:"SystemMetaData",purpose:"PerformanceAndHealth"},isOnline:{classification:"SystemMetaData",purpose:"PerformanceAndHealth"},moduleHash:{classification:"PublicNonPersonalData",purpose:"FeatureInsight"},moduleVersion:{classification:"PublicNonPersonalData",purpose:"FeatureInsight"}}};this[Mne]={owner:"donjayamanne",feature:["Notebook","InteractiveWindow"],tags:["Widgets"],source:"N/A",properties:{moduleHash:{classification:"PublicNonPersonalData",purpose:"FeatureInsight"},moduleVersion:{classification:"PublicNonPersonalData",purpose:"FeatureInsight"}}};this[One]={owner:"donjayamanne",feature:["Notebook","InteractiveWindow"],tags:["Widgets"],source:"N/A"};this[Kne]={owner:"donjayamanne",feature:["Notebook","InteractiveWindow"],tags:["Widgets"],source:"N/A",properties:{selection:{classification:"PublicNonPersonalData",purpose:"FeatureInsight"}}};this[Fne]={owner:"donjayamanne",feature:["Notebook","InteractiveWindow"],tags:["Widgets"],source:"N/A",measures:{totalOverheadInMs:{classification:"SystemMetaData",purpose:"PerformanceAndHealth",isMeasurement:!0},numberOfMessagesWaitedOn:{classification:"SystemMetaData",purpose:"PerformanceAndHealth",isMeasurement:!0},averageWaitTime:{classification:"SystemMetaData",purpose:"PerformanceAndHealth",isMeasurement:!0},numberOfRegisteredHooks:{classification:"SystemMetaData",purpose:"FeatureInsight",isMeasurement:!0}}};this[Lne]={owner:"donjayamanne",feature:["Notebook","InteractiveWindow"],tags:["Widgets"],source:"N/A"};this[Une]={owner:"donjayamanne",feature:["Notebook","InteractiveWindow"],tags:["Widgets"],source:"N/A",properties:{msg_type:{classification:"PublicNonPersonalData",purpose:"PerformanceAndHealth"}}};this[Wne]={owner:"donjayamanne",feature:["Notebook","InteractiveWindow"],source:"N/A",tags:["KernelStartup"],measures:{...Nt(),attempts:{classification:"SystemMetaData",purpose:"PerformanceAndHealth",isMeasurement:!0}},properties:{...ro().properties,timedout:{classification:"SystemMetaData",purpose:"PerformanceAndHealth"}}};this[jne]={owner:"donjayamanne",feature:["Notebook","InteractiveWindow"],source:"N/A",tags:["KernelStartup"],measures:Nt()};this[Vne]={owner:"donjayamanne",feature:["Notebook","InteractiveWindow"],source:"User Action",tags:["Cell Execution"],measures:{...Nt(),pendingInspectRequestsBefore:{classification:"SystemMetaData",purpose:"PerformanceAndHealth",isMeasurement:!0},pendingInspectRequestsAfter:{classification:"SystemMetaData",purpose:"PerformanceAndHealth",isMeasurement:!0}},properties:{...ro().properties,...xl()}};this[Bne]={owner:"donjayamanne",feature:["Notebook","InteractiveWindow"],source:"User Action",tags:["Code Execution"],measures:Nt(),properties:{...ro().properties,...xl(),extensionId:{classification:"SystemMetaData",purpose:"FeatureInsight"}}};this[qne]={owner:"donjayamanne",feature:["Notebook","InteractiveWindow"],source:"User Action",tags:["Cell Execution"],properties:{...ro().properties,...xl()}};this[Jne]={owner:"donjayamanne",feature:["Notebook","InteractiveWindow"],source:"N/A",tags:["KernelStartup"],properties:{...ro().properties,...xl()}};this[$ne]={owner:"donjayamanne",feature:["Notebook","InteractiveWindow"],source:"N/A",properties:ro().properties};this[Hne]={owner:"donjayamanne",feature:["Notebook","InteractiveWindow"],source:"User Action",properties:{result:{classification:"SystemMetaData",purpose:"PerformanceAndHealth"},...jo(),...xl(),...ro().properties},measures:{...Nt()}};this[Gne]={owner:"donjayamanne",feature:["Notebook","InteractiveWindow"],source:"User Action",properties:{...jo(),...xl(),...ro().properties},measures:Nt()};this[zne]={owner:"donjayamanne",feature:["Notebook","InteractiveWindow"],source:"User Action",properties:{...jo(),...xl(),...ro().properties,envMissingReason:{classification:"SystemMetaData",purpose:"PerformanceAndHealth"},isEmptyCondaEnv:{classification:"SystemMetaData",purpose:"PerformanceAndHealth"},pythonEnvType:{classification:"SystemMetaData",purpose:"PerformanceAndHealth"},fileExists:{classification:"SystemMetaData",purpose:"PerformanceAndHealth"}}};this[Qne]={owner:"donjayamanne",feature:["Notebook","InteractiveWindow"],source:"N/A",properties:{...jo(),...ro().properties},measures:{reason:{classification:"SystemMetaData",isMeasurement:!0,purpose:"PerformanceAndHealth"}}};this[Yne]={owner:"donjayamanne",feature:["Notebook","InteractiveWindow"],source:"N/A",properties:{exitReason:{classification:"CallstackOrException",purpose:"PerformanceAndHealth"},...jo(),...ro().properties},measures:{exitCode:{classification:"CallstackOrException",purpose:"PerformanceAndHealth",isMeasurement:!0}}};this[Xne]={owner:"donjayamanne",feature:["Notebook","InteractiveWindow"],source:"N/A",properties:{isRequestToShutdownRestartSession:{classification:"SystemMetaData",purpose:"PerformanceAndHealth"},stacktrace:{classification:"CallstackOrException",purpose:"PerformanceAndHealth"},...jo(),...ro().properties}};this[Zne]={owner:"donjayamanne",feature:["Notebook","InteractiveWindow"],source:"N/A",properties:{stacktrace:{classification:"CallstackOrException",purpose:"PerformanceAndHealth"},...jo(),...ro().properties}};this[eie]={owner:"roblourens",feature:["Debugger"],source:"User Action"};this[tie]={owner:"donjayamanne",feature:["KernelPicker"],source:"N/A",measures:{kernelSpecCount:{classification:"SystemMetaData",purpose:"FeatureInsight",isMeasurement:!0},kernelInterpreterCount:{classification:"SystemMetaData",purpose:"FeatureInsight",isMeasurement:!0},kernelLiveCount:{classification:"SystemMetaData",purpose:"FeatureInsight",isMeasurement:!0},localKernelSpecCount:{classification:"SystemMetaData",purpose:"PerformanceAndHealth",isMeasurement:!0},remoteKernelSpecCount:{classification:"SystemMetaData",purpose:"PerformanceAndHealth",isMeasurement:!0}}};this[rie]={owner:"donjayamanne",feature:["Notebook","InteractiveWindow"],source:"N/A",properties:{outputType:{classification:"PublicNonPersonalData",purpose:"PerformanceAndHealth"}}};this[nie]={owner:"IanMatthewHuff",feature:["InteractiveWindow"],tags:["IntelliSense"],source:"N/A",measures:Nt(),properties:{isResultNull:{classification:"SystemMetaData",purpose:"FeatureInsight"}}};this[iie]={owner:"IanMatthewHuff",feature:["VariableViewer"],source:"N/A",measures:Nt()};this[oie]={owner:"IanMatthewHuff",feature:["VariableViewer"],source:"N/A"};this[sie]={owner:"IanMatthewHuff",feature:["DataFrameViewer"],source:"N/A",measures:Nt()};this[aie]={owner:"IanMatthewHuff",feature:["PlotViewer"],source:"N/A",measures:Nt()};this[lie]={owner:"amunger",feature:"N/A",source:"N/A",properties:{command:{classification:"SystemMetaData",purpose:"FeatureInsight"}}};this[cie]={owner:"IanMatthewHuff",feature:["DataFrameViewer"],source:"User Action",properties:{newState:{classification:"SystemMetaData",purpose:"FeatureInsight"}}};this[uie]={owner:"IanMatthewHuff",feature:["DataFrameViewer"],source:"N/A",measures:{numberOfDimensions:{classification:"SystemMetaData",purpose:"FeatureInsight",isMeasurement:!0}}};this[pie]={owner:"IanMatthewHuff",feature:["DataFrameViewer"],source:"User Action",properties:{source:{classification:"SystemMetaData",purpose:"FeatureInsight"}}};this[die]={owner:"donjayamanne",feature:"N/A",source:"N/A",properties:{failed:{classification:"SystemMetaData",purpose:"PerformanceAndHealth"},reason:{classification:"SystemMetaData",purpose:"PerformanceAndHealth"},dependenciesInstalled:{classification:"SystemMetaData",purpose:"FeatureInsight"},envType:{classification:"SystemMetaData",purpose:"FeatureInsight"}}};this[mie]={owner:"donjayamanne",feature:"N/A",source:"N/A",properties:{extensionId:{classification:"SystemMetaData",purpose:"FeatureInsight"},action:{classification:"SystemMetaData",purpose:"FeatureInsight"}}};this[fie]={owner:"roblourens",feature:["Debugger"],source:"User Action"};this[hie]={owner:"roblourens",feature:["Debugger"],source:"User Action"};this[gie]={owner:"roblourens",feature:["Debugger"],properties:{status:{classification:"SystemMetaData",purpose:"FeatureInsight"}},source:"N/A"};this[vie]={owner:"roblourens",feature:["Debugger"],source:"User Action"};this[yie]={owner:"roblourens",feature:["Debugger"],source:"N/A"};this[bie]={owner:"roblourens",feature:["Debugger"],source:"N/A"};this[Iie]={owner:"roblourens",feature:["Debugger"],source:"User Action"};this[Sie]={owner:"roblourens",feature:["Debugger"],source:"N/A"};this[xie]={owner:"roblourens",feature:["Debugger"],source:"N/A",properties:{reason:{classification:"SystemMetaData",purpose:"FeatureInsight"}}};this[Cie]={owner:"donjayamanne",feature:"N/A",source:"N/A",measures:{...Nt(),requestDuration:{classification:"SystemMetaData",purpose:"PerformanceAndHealth",isMeasurement:!0},completionItems:{classification:"SystemMetaData",purpose:"PerformanceAndHealth",isMeasurement:!0}},properties:{kernelConnectionType:{classification:"PublicNonPersonalData",purpose:"FeatureInsight"},kernelLanguage:{classification:"PublicNonPersonalData",purpose:"FeatureInsight"},monacoLanguage:{classification:"PublicNonPersonalData",purpose:"FeatureInsight"},kernelId:{classification:"PublicNonPersonalData",purpose:"FeatureInsight"},cancelled:{classification:"PublicNonPersonalData",purpose:"FeatureInsight"},completed:{classification:"PublicNonPersonalData",purpose:"FeatureInsight"},kernelStatusAfterRequest:{classification:"PublicNonPersonalData",purpose:"FeatureInsight"},kernelStatusBeforeRequest:{classification:"PublicNonPersonalData",purpose:"FeatureInsight"},requestSent:{classification:"PublicNonPersonalData",purpose:"FeatureInsight"}}};this[Eie]={owner:"donjayamanne",feature:"N/A",source:"N/A",measures:{...Nt(),requestDuration:{classification:"SystemMetaData",purpose:"PerformanceAndHealth",isMeasurement:!0},pendingRequests:{classification:"SystemMetaData",purpose:"PerformanceAndHealth",isMeasurement:!0}},properties:{kernelConnectionType:{classification:"PublicNonPersonalData",purpose:"FeatureInsight"},kernelLanguage:{classification:"PublicNonPersonalData",purpose:"FeatureInsight"},monacoLanguage:{classification:"PublicNonPersonalData",purpose:"FeatureInsight"},kernelId:{classification:"PublicNonPersonalData",purpose:"FeatureInsight"},cancelled:{classification:"PublicNonPersonalData",purpose:"FeatureInsight"},kernelStatusBeforeRequest:{classification:"PublicNonPersonalData",purpose:"FeatureInsight"},kernelStatusAfterRequest:{classification:"PublicNonPersonalData",purpose:"FeatureInsight"},requestTimedout:{classification:"PublicNonPersonalData",purpose:"FeatureInsight"},completedWithData:{classification:"PublicNonPersonalData",purpose:"FeatureInsight"},requestSent:{classification:"PublicNonPersonalData",purpose:"FeatureInsight"},completed:{classification:"PublicNonPersonalData",purpose:"FeatureInsight"}}};this[wie]={owner:"donjayamanne",feature:"N/A",source:"N/A",properties:{kernelConnectionType:{classification:"PublicNonPersonalData",purpose:"FeatureInsight"},kernelLanguage:{classification:"PublicNonPersonalData",purpose:"FeatureInsight"},kernelId:{classification:"PublicNonPersonalData",purpose:"FeatureInsight"}}};this[kie]={owner:"donjayamanne",feature:"N/A",source:"N/A",properties:{extensionId:{classification:"PublicNonPersonalData",purpose:"FeatureInsight"},pemUsed:{classification:"PublicNonPersonalData",purpose:"FeatureInsight"}}};this[Pie]={owner:"donjayamanne",feature:"N/A",source:"N/A",measures:{executionCount:{classification:"SystemMetaData",isMeasurement:!0,purpose:"FeatureInsight"}},properties:{extensionId:{classification:"PublicNonPersonalData",purpose:"FeatureInsight"},pemUsed:{classification:"PublicNonPersonalData",purpose:"FeatureInsight"},kernelId:{classification:"PublicNonPersonalData",purpose:"FeatureInsight"}}};this[Die]={owner:"donjayamanne",feature:"N/A",source:"N/A",properties:{accessAllowed:{classification:"PublicNonPersonalData",purpose:"FeatureInsight"},extensionId:{classification:"PublicNonPersonalData",purpose:"FeatureInsight"},pemUsed:{classification:"PublicNonPersonalData",purpose:"FeatureInsight"}}};this[Tie]={owner:"donjayamanne",feature:"N/A",source:"N/A",measures:{executionCount:{classification:"SystemMetaData",isMeasurement:!0,purpose:"FeatureInsight"},cancelledAfter:{classification:"SystemMetaData",isMeasurement:!0,purpose:"FeatureInsight"},requestAcknowledgedAfter:{classification:"SystemMetaData",isMeasurement:!0,purpose:"FeatureInsight"},requestSentAfter:{classification:"SystemMetaData",isMeasurement:!0,purpose:"FeatureInsight"},...Nt()},properties:{extensionId:{classification:"PublicNonPersonalData",purpose:"FeatureInsight"},kernelId:{classification:"PublicNonPersonalData",purpose:"FeatureInsight"},cancelled:{classification:"PublicNonPersonalData",purpose:"FeatureInsight"},requestAcknowledged:{classification:"PublicNonPersonalData",purpose:"FeatureInsight"},requestSent:{classification:"PublicNonPersonalData",purpose:"FeatureInsight"},cancelledBeforeRequestAcknowledged:{classification:"PublicNonPersonalData",purpose:"FeatureInsight"},cancelledBeforeRequestSent:{classification:"PublicNonPersonalData",purpose:"FeatureInsight"},mimeTypes:{classification:"PublicNonPersonalData",purpose:"FeatureInsight"},failed:{classification:"PublicNonPersonalData",comment:"",purpose:"PerformanceAndHealth"}}};this[_ie]={owner:"donjayamanne",feature:"N/A",source:"N/A",properties:{clientExtId:{classification:"PublicNonPersonalData",purpose:"FeatureInsight"},pemUsed:{classification:"PublicNonPersonalData",purpose:"FeatureInsight"}}};this[Rie]={owner:"donjayamanne",feature:"N/A",source:"N/A",properties:{extensionId:{classification:"PublicNonPersonalData",purpose:"FeatureInsight"},allowed:{classification:"SystemMetaData",purpose:"FeatureInsight"}}};this[Nie]={owner:"donjayamanne",feature:"N/A",source:"N/A",properties:{extensionId:{classification:"PublicNonPersonalData",purpose:"FeatureInsight"},providerId:{classification:"PublicNonPersonalData",purpose:"FeatureInsight"}},measures:Nt()};this[Aie]={owner:"IanMatthewHuff",feature:["VariableViewer"],source:"N/A"};this[Mie]={owner:"roblourens",feature:["InteractiveWindow","Debugger"],source:"N/A"};this[Oie]={owner:"donjayamanne",feature:["Notebook","InteractiveWindow"],source:"N/A",properties:{...ro().properties,...jo()}};this[Kie]={owner:"donjayamanne",source:"N/A",feature:["KernelPicker"]};this[Fie]={owner:"donjayamanne",source:"User Action",feature:["KernelPicker"]};this[Lie]={owner:"amunger",feature:"N/A",source:"N/A",properties:{testName:{classification:"SystemMetaData",purpose:"PerformanceAndHealth"},testResult:{classification:"SystemMetaData",purpose:"PerformanceAndHealth"},perfWarmup:{classification:"SystemMetaData",purpose:"PerformanceAndHealth"},commitHash:{classification:"SystemMetaData",purpose:"PerformanceAndHealth"},timedCheckpoints:{classification:"SystemMetaData",purpose:"PerformanceAndHealth"}}};this[Uie]={owner:"donjayamanne",feature:["KernelPicker"],source:"N/A",measures:{matchedReason:{classification:"SystemMetaData",purpose:"FeatureInsight"}}};this[Wie]={owner:"donjayamanne",feature:["Notebook","Notebook"],tags:["Widgets"],source:"N/A",measures:{requireEntryPointCount:{classification:"SystemMetaData",isMeasurement:!0,purpose:"PerformanceAndHealth"}},properties:{failed:{classification:"CallstackOrException",purpose:"PerformanceAndHealth"},failure:{classification:"CallstackOrException",purpose:"PerformanceAndHealth"},patternUsedToRegisterRequireConfig:{classification:"SystemMetaData",purpose:"PerformanceAndHealth"},widgetFolderNameHash:{classification:"SystemMetaData",purpose:"FeatureInsight"}}};this[jie]={owner:"donjayamanne",feature:["Notebook","Notebook"],tags:["Widgets"],source:"N/A",measures:Nt()};this[Vie]={owner:"donjayamanne",feature:["DataFrameViewer"],source:"N/A"};this[Bie]={owner:"IanMatthewHuff",feature:["DataFrameViewer"],source:"N/A"};this[qie]={owner:"IanMatthewHuff",feature:["DataFrameViewer"],source:"N/A"}}static{$te="EXTENSION.LOAD",Hte="DS_INTERNAL.EXPERIMENT_LOAD",Gte="ENVFILE_VARIABLE_SUBSTITUTION",zte="ENVFILE_WORKSPACE",Qte="HASHED_PACKAGE_NAME",Yte="DS_INTERNAL.ACTIVE_INTERPRETER_LISTING_PERF",Xte="DS_INTERNAL.CELL_OUTPUT_MIME_TYPE",Zte="DS_INTERNAL.GET_ACTIVATED_ENV_VARIABLES",ere="OPEN_DATAVIEWER_FROM_VARIABLE_WINDOW_REQUEST_EX",tre="OPEN_DATAVIEWER_FROM_VARIABLE_WINDOW_ERROR_EX",rre="OPEN_DATAVIEWER_FROM_VARIABLE_WINDOW_SUCCESS_EX",nre="DATASCIENCE.ADD_CELL_BELOW",ire="DS_INTERNAL.CODE_LENS_ACQ_TIME",ore="DS_INTERNAL.DOCUMENT_WITH_CODE_CELLS",sre="DATASCIENCE.DEBUG_CONTINUE",are="DATASCIENCE.DEBUG_CURRENT_CELL",lre="DATASCIENCE.DEBUG_STEP_OVER",cre="DATASCIENCE.DEBUG_STOP",ure="DATASCIENCE.DEBUG_FILE_INTERACTIVE",pre="DATASCIENCE.JUPYTER_KERNEL_SPEC_FETCH_FAILURE",dre="DS_INTERNAL.JUPYTER_KERNEL_SPEC",mre="DATASCIENCE.ENTER_REMOTE_JUPYTER_URL",fre="DATASCIENCE.DISABLE_INTERACTIVE_SHIFT_ENTER",hre="DATASCIENCE.ENABLE_INTERACTIVE_SHIFT_ENTER",gre="DS_INTERNAL.PERCEIVED_JUPYTER_STARTUP_NOTEBOOK",vre="DATASCIENCE.EXPORT_PYTHON_FILE",yre="DATASCIENCE.EXPORT_PYTHON_FILE_AND_OUTPUT",bre="DATASCIENCE.CLICKED_EXPORT_NOTEBOOK_AS_QUICK_PICK",Ire="DATASCIENCE.EXPORT_NOTEBOOK_AS",Sre="DATASCIENCE.IMPORT_NOTEBOOK",xre="DATASCIENCE.EXPORT_NOTEBOOK_AS_COMMAND",Cre="DATASCIENCE.EXPORT_NOTEBOOK_AS_FAILED",Ere="DS_INTERNAL.GET_PASSWORD_FAILURE",wre="DS_INTERNAL.GET_PASSWORD_SUCCESS",kre="DS_INTERNAL.JUPYTER_HUB_PASSWORD",Pre="DS_INTERNAL.SHOW_DATA_NO_PANDAS",Dre="DS_INTERNAL.SHOW_DATA_PANDAS_TOO_OLD",Tre="DS_INTERNAL.SHOW_DATA_PANDAS_OK",_re="DS_INTERNAL.SHOW_DATA_PANDAS_INSTALL_CANCELED",Rre="DATASCIENCE.NATIVE.OPEN_NOTEBOOK_ALL",Nre="DATASCIENCE.OPEN_PLOT_VIEWER",Are="DATASCIENCE.RUN_ALL_CELLS",Mre="DATASCIENCE.RUN_SELECTION_OR_LINE",Ore="DATASCIENCE.RUN_CURRENT_CELL",Kre="DATASCIENCE.RUN_ALL_CELLS_ABOVE",Fre="DATASCIENCE.RUN_CELL_AND_ALL_BELOW",Lre="DATASCIENCE.RUN_CURRENT_CELL_AND_ADVANCE",Ure="DATASCIENCE.RUN_FILE_INTERACTIVE",Wre="DATASCIENCE.RUN_TO_LINE",jre="DATASCIENCE.RUN_FROM_LINE",Vre="DATASCIENCE.RUN_INSERT_CELL_BELOW_POSITION",Bre="DATASCIENCE.RUN_INSERT_CELL_BELOW",qre="DATASCIENCE.RUN_INSERT_CELL_ABOVE",Jre="DATASCIENCE.RUN_DELETE_CELLS",$re="DATASCIENCE.RUN_SELECT_CELL",Hre="DATASCIENCE.RUN_SELECT_CELL_CONTENTS",Gre="DATASCIENCE.RUN_EXTEND_SELECTION_BY_CELL_ABOVE",zre="DATASCIENCE.RUN_EXTEND_SELECTION_BY_CELL_BELOW",Qre="DATASCIENCE.RUN_MOVE_CELLS_UP",Yre="DATASCIENCE.RUN_MOVE_CELLS_DOWN",Xre="DATASCIENCE.RUN_CHANGE_CELL_TO_MARKDOWN",Zre="DATASCIENCE.RUN_CHANGE_CELL_TO_CODE",ene="DATASCIENCE.GOTO_NEXT_CELL_IN_FILE",tne="DATASCIENCE.GOTO_PREV_CELL_IN_FILE",rne="DATASCIENCE.RUN_CURRENT_CELL_AND_ADD_BELOW",nne="DATASCIENCE.SELFCERTSMESSAGECLOSE",ine="DATASCIENCE.SELFCERTSMESSAGEENABLED",one="DATASCIENCE.USER_INSTALLED_JUPYTER",sne="DATASCIENCE.USER_INSTALLED_PANDAS",ane="DATASCIENCE.USER_DID_NOT_INSTALL_JUPYTER",lne="DATASCIENCE.USER_DID_NOT_INSTALL_PANDAS",cne="DS_INTERNAL.PYTHON_NOT_INSTALLED",une="DS_INTERNAL.PYTHON_EXTENSION_NOT_INSTALLED",pne="DS_INTERNAL.PYTHON_EXTENSION_INSTALLED_VIA_KERNEL_PICKER",dne="DS_INTERNAL.PYTHON_MODULE_INSTALL",mne="DS_INTERNAL.SHIFTENTER_BANNER_SHOWN",fne="DATASCIENCE.START_SHOW_DATA_EXPLORER",hne="DATASCIENCE.SHOW_DATA_EXPLORER",gne="DATASCIENCE.SHOW_DATA_EXPLORER_ROWS_LOADED",vne="DATASCIENCE.FAILED_SHOW_DATA_EXPLORER",yne="DATASCIENCE.REFRESH_DATA_VIEWER",bne="DS_INTERNAL.JUPYTER_STARTED_SESSION_WITH_BACKING_FILE",Ine="DS_INTERNAL.JUPYTER_ZMQ_SUPPORT",Sne="DS_INTERNAL.JUPYTER_ZMQ_SUPPORT_FAILURE",xne="DS_INTERNAL.VARIABLE_EXPLORER_FETCH_TIME",Cne="DS_INTERNAL.VARIABLE_EXPLORER_VARIABLE_COUNT",Ene="DATASCIENCE.KERNEL_SPEC_LANGUAGE",wne="DS_INTERNAL.KERNEL_LAUNCHER_PERF",kne="GLOBAL_PYTHON_KERNELSPEC",Pne="DS_INTERNAL.NEW_FILE_USED_IN_INTERACTIVE",Dne="DS_INTERNAL.CREATED_INTERACTIVE_WINDOW",Tne="DS_INTERNAL.IPYWIDGET_USED_BY_USER",_ne="DS_INTERNAL.IPYWIDGET_DISCOVER_WIDGETS_NB_EXTENSIONS",Rne="DS_INTERNAL.IPYWIDGET_DISCOVERY_ERRORED",Nne="DS_INTERNAL.IPYWIDGET_LOAD_SUCCESS",Ane="DS_INTERNAL.IPYWIDGET_LOAD_FAILURE",Mne="DS_INTERNAL.IPYWIDGET_WIDGET_VERSION_NOT_SUPPORTED_LOAD_FAILURE",One="DS_INTERNAL.IPYWIDGET_PROMPT_TO_USE_CDN",Kne="DS_INTERNAL.IPYWIDGET_PROMPT_TO_USE_CDN_SELECTION",Fne="DS_INTERNAL.IPYWIDGET_OVERHEAD",Lne="DS_INTERNAL.IPYWIDGET_RENDER_FAILURE",Une="DS_INTERNAL.IPYWIDGET_UNHANDLED_MESSAGE",Wne="DS_INTERNAL.RAWKERNEL_INFO_RESPONSE",jne="DS_INTERNAL.RAWKERNEL_PROCESS_LAUNCH",Vne="DATASCIENCE.EXECUTE_CELL",Bne="DATASCIENCE.EXECUTE_CODE",qne="DATASCIENCE.RESUME_EXECUTE_CELL",Jne="DATASCIENCE.NOTEBOOK_START",$ne="DS_INTERNAL.SWITCH_KERNEL",Hne="DATASCIENCE.NOTEBOOK_INTERRUPT",Gne="DATASCIENCE.NOTEBOOK_RESTART",zne="DATASCIENCE.KERNEL_START_FAILURE_MISSING_ENV",Qne="DS_INTERNAL.RAWKERNEL_SESSION_NO_IPYKERNEL",Yne="DS_INTERNAL.RAWKERNEL_SESSION_KERNEL_PROCESS_EXITED",Xne="DS_INTERNAL.RAWKERNEL_SESSION_SHUTDOWN",Zne="DS_INTERNAL.RAWKERNEL_SESSION_DISPOSED",eie="DATASCIENCE.RUN_BY_LINE_VARIABLE_HOVER",tie="DS_INTERNAL.KERNEL_COUNT",rie="DS_INTERNAL.VSCNOTEBOOK_CELL_TRANSLATION_FAILED",nie="DS_INTERNAL.INTERACTIVE_FILE_TOOLTIPS_PERF",iie="DS_INTERNAL.NATIVE_VARIABLE_VIEW_LOADED",oie="DS_INTERNAL.NATIVE_VARIABLE_VIEW_MADE_VISIBLE",sie="DATAVIEWER.WEBVIEW_LOADED",aie="PLOTVIEWER.WEBVIEW_LOADED",lie="DS_INTERNAL.COMMAND_EXECUTED",cie="DATASCIENCE.DATA_VIEWER_SLICE_ENABLEMENT_STATE_CHANGED",uie="DATASCIENCE.DATA_VIEWER_DATA_DIMENSIONALITY",pie="DATASCIENCE.DATA_VIEWER_SLICE_OPERATION",die="DATASCIENCE.CREATE_PYTHON_ENVIRONMENT",mie="DATASCIENCE.RECOMMENT_EXTENSION",fie="DATASCIENCE.DEBUGGING.CLICKED_ON_SETUP",hie="DATASCIENCE.DEBUGGING.CLOSED_MODAL",gie="DATASCIENCE.DEBUGGING.IPYKERNEL6_STATUS",vie="DATASCIENCE.DEBUGGING.CLICKED_RUNBYLINE",yie="DATASCIENCE.DEBUGGING.SUCCESSFULLY_STARTED_RUNBYLINE",bie="DATASCIENCE.DEBUGGING.SUCCESSFULLY_STARTED_IW_JUPYTER",Iie="DATASCIENCE.DEBUGGING.CLICKED_RUN_AND_DEBUG_CELL",Sie="DATASCIENCE.DEBUGGING.SUCCESSFULLY_STARTED_RUN_AND_DEBUG_CELL",xie="DATASCIENCE.DEBUGGING.ENDED_SESSION",Cie="DATASCIENCE.JUPYTER_KERNEL_CODE_COMPLETION",Eie="DATASCIENCE.JUPYTER_KERNEL_CODE_COMPLETION_RESOLVE",wie="DATASCIENCE.JUPYTER_KERNEL_CODE_COMPLETION_CANNOT_RESOLVE",kie="DATASCIENCE.JUPYTER_KERNEL_API_USAGE",Pie="DATASCIENCE.JUPYTER_NEW_KERNEL_API_USAGE",Die="DATASCIENCE.JUPYTER_NEW_KERNELS_API_USAGE",Tie="DATASCIENCE.JUPYTER_NEW_KERNEL_API_EXEC",_ie="DATASCIENCE.JUPYTER_API_USAGE",Rie="DATASCIENCE.JUPYTER_KERNEL_API_ACCESS",Nie="DATASCIENCE.JUPYTER_KERNEL_STARTUP_HOOK",Aie="DATASCIENCE.PYTHON_VARIABLE_FETCHING_CODE_FAILURE",Mie="DATASCIENCE.INTERACTIVE_WINDOW_DEBUG_SETUP_CODE_FAILURE",Oie="DATASCIENCE.KERNEL_CRASH",Kie="DATASCIENCE.JUPYTER_KERNEL_HIDDEN_VIA_FILTER",Fie="DATASCIENCE.JUPYTER_KERNEL_FILTER_USED",Lie="DS_INTERNAL.RUNTEST",Uie="DS_INTERNAL.PREFERRED_KERNEL_EXACT_MATCH",Wie="DS_INTERNAL.IPYWIDGET_EXTENSIONJS_INFO",jie="DS_INTERNAL.IPYWIDGET_TIME_TO_COPY_NBEXTENSIONS_DIR",Vie="DATASCIENCE.NO_ACTIVE_KERNEL_SESSION",Bie="DATAVIEWER.USING_INTERPRETER",qie="DATAVIEWER.USING_KERNEL"}};function Uh(r,e,t,n){if(r)return n.createSystemVariables(e).resolve(r);if(e)return pt(we(e));let i=t.getWorkspaceFolder(void 0);return i?we(i.uri):process.cwd()}async function Jw(r,e,t){let n=y.jupyterSelfCertEnable,i=y.jupyterSelfCertClose,o=await r.showErrorMessage(y.jupyterSelfCertFail(t),{modal:!0},n,i);return o===n?(R("DATASCIENCE.SELFCERTSMESSAGEENABLED"),await e.updateSetting("allowUnauthorizedRemoteConnection",!0,void 0,jN.ConfigurationTarget.Workspace),!0):(o===i&&R("DATASCIENCE.SELFCERTSMESSAGECLOSE"),!1)}async function $w(r,e,t){let n=y.jupyterSelfCertEnable,i=y.jupyterSelfCertClose,o=await r.showErrorMessage(y.jupyterExpiredCertFail(t),{modal:!0},n,i);return o===n?(R("DATASCIENCE.SELFCERTSMESSAGEENABLED"),await e.updateSetting("allowUnauthorizedRemoteConnection",!0,void 0,jN.ConfigurationTarget.Workspace),!0):(o===i&&R("DATASCIENCE.SELFCERTSMESSAGECLOSE"),!1)}function nx(r,e,t,n,i,o,s){let a=e.baseUrl,l=e.token,c=new URL(e.baseUrl).hostname,u=(e?.webSocketProtocols||[]).length?e?.webSocketProtocols||[]:[],d=e.authorizationHeader&&Object.keys(e?.authorizationHeader??{}).length>0?e.authorizationHeader:void 0,f=d?()=>d:void 0,h=u?()=>u:()=>[],v={baseUrl:a,appUrl:"",wsUrl:a.replace("http","ws"),fetch:e.fetch,WebSocket:e.WebSocket},S=t.getRequestInit();(!(l===""||l==="null")||f)&&(v={...v,token:l,appendToken:!0});let D=i.getSettings(void 0).allowUnauthorizedRemoteConnection;if(a.startsWith("https")&&D&&n){let Z=n.createHttpRequestAgent();S={...S,agent:Z}}let{ServerConnection:_}=require("@jupyterlab/services");return v={...v,init:S,WebSocket:e.WebSocket?t.wrapWebSocketCtor(e.WebSocket):t.getWebsocketCtor(void 0,D,f,h),fetch:e.fetch||t.getFetchMethod(),Request:t.getRequestCtor(void 0,D,f),Headers:t.getHeadersCtor()},{baseUrl:a,providerId:r.id,serverProviderHandle:r,token:l,hostName:c,displayName:e&&e.displayName?e.displayName:Ow(l,a),dispose:()=>s?.dispose(),rootDirectory:o,getAuthHeader:f,getWebsocketProtocols:h,settings:_.makeSettings(v)}}async function D2(r){let e=$t(r);return va(e,"SHA-256")}var Jie=new Set([bt,"ms-toolsai.vscode-ai","GitHub.codespaces"].map(r=>r.toLowerCase()));function $t(r){return Jie.has(r.extensionId.toLowerCase())?`${Le.REMOTE_URI}?${Le.REMOTE_URI_ID_PARAM}=${r.id}&${Le.REMOTE_URI_HANDLE_PARAM}=${encodeURI(r.handle)}`:`${Le.REMOTE_URI}?${Le.REMOTE_URI_ID_PARAM}=${r.id}&${Le.REMOTE_URI_HANDLE_PARAM}=${encodeURI(r.handle)}&${Le.REMOTE_URI_EXTENSION_ID_PARAM}=${encodeURI(r.extensionId)}`}var qw=class extends Error{};function T2(r){try{let e=new URL(r),t=e.searchParams.get(Le.REMOTE_URI_ID_PARAM),n=e.searchParams.get(Le.REMOTE_URI_HANDLE_PARAM),i=e.searchParams.get(Le.REMOTE_URI_EXTENSION_ID_PARAM)||VN(t||"");if(t&&n){if(!i)throw new qw(`Unable to determine the extension id for the remote server handle', { ${t}, ${n} }`);return{handle:n,id:t,extensionId:i}}throw new Error("Invalid remote URI")}catch(e){throw e instanceof qw?e:new Error(`'Failed to parse remote URI ${$ie(r)}`)}}function $ie(r){if((r||"").trim().toLowerCase().startsWith(Le.REMOTE_URI.toLowerCase()))return r;try{let e=new URL(r),t=e.hostname.toLocaleLowerCase()==="localhost"||e.hostname==="127.0.0.1";return`${e.protocol}//${t?e.hostname:"<REMOTE SERVER>"}:${e.port}`}catch{return r}}function VN(r){if(r){if(rW(r))return bt;if(r.startsWith("azureml_compute_instances")||r.startsWith("azureml_connected_compute_instances"))return"ms-toolsai.vscode-ai";if(r==="github-codespaces")return"GitHub.codespaces";J(`Extension Id not found for server Id ${r}`)}}var Vo=class extends tt{constructor(e){super("jupyterselfcert",e)}static isSelfCertsError(e){return e.message.indexOf("reason: self signed certificate")>=0}};var Cl=class extends tt{constructor(e){super("jupyterselfexpiredcert",e)}static isSelfCertsExpiredError(e){return e.message.indexOf("reason: certificate has expired")>=0}};var an=Symbol("IDataScienceErrorHandler"),On=class extends tt{constructor(t,n,i){super(t,n);this.kernelConnectionMetadata=i}},El=class extends hn{constructor(t,n,i){super(t,n);this.kernelConnectionMetadata=i}};var Wi=class extends tt{constructor(t,n,i){super("remotejupyterserverconnection",y.remoteJupyterConnectionFailedWithServerWithError(_2(t),i.message||i.toString()));this.url=t;this.serverProviderHandle=n;this.originalError=i;this.baseUrl=_2(t)}};function _2(r){let e=new URL(r);return`${e.protocol}//${e.host}/`}var fx=require("vscode");var FV=require("vscode");var wV=k(B2()),px=require("vscode");var cp=require("vscode");function Dl(r){let e=Pl(r.uri);return ht(e.path)}function Co(r=cp.Uri.file(""),e=cp.Uri.file(""),t=en(),n=!1){let i=Pl(r,t,t=="Windows"||n),o=Pl(e,t,t=="Windows"||n);return i===o||Mi(i,o,!0)}function Pl(r=cp.Uri.file(""),e=en(),t=!1){let n=we(r);return t&&(n=n.toLowerCase()),n.endsWith("/bin/python")?["Linux","OSX"].includes(e)?n.endsWith("/bin/python")&&n.split("/").length>4?cp.Uri.file(n.replace("/bin/python","/python")):cp.Uri.file(n):cp.Uri.file(n):cp.Uri.file(n)}var ur=require("vscode");var Xt=Symbol("IPythonApi"),ze=Symbol("IPythonExtensionChecker");var qn=k(A());var q2=require("vscode");var Eo=class{constructor(){this.promises=new Set;this._onStateChange=new q2.EventEmitter;this.onStateChange=this._onStateChange.event}get isComplete(){return this.promises.size===0}dispose(){this._onStateChange.dispose()}push(e){this.promises.add(e),this._onStateChange.fire(),e.finally(()=>{this.promises.delete(e),this.isComplete&&this._onStateChange.fire()}).catch(m)}};var Gw=class extends hn{constructor(e){super("Python Extension failed to activate",e,"pythonExtension")}};var zw=class extends tt{constructor(){super("pythonExtension","Python Extension API not exported")}};var aV=k(Hh());function up(r){if("executable"in r){let s=[];typeof r.version?.major=="number"&&(s.push(r.version.major.toString()),typeof r.version.minor=="number"&&(s.push(r.version.minor.toString()),typeof r.version.micro=="number"&&s.push(r.version.micro.toString())));let a=s.length?s.join("."):"",l=r.environment?In(r.environment?.folderUri):"",c=a?`Python ${a}`:"Python";return ya(r)&&l?l:l?`${l} (${c})`:c}let e=(lp(r.version?.raw||"")||"").trim(),t=r.envType==="Conda"&&r.isCondaEnvWithoutPython===!0,n=e.trim()?`Python ${e}`:"Python",i=ok(r);if(t&&i)return i;let o=[];return i&&o.push(i),r.envType&&r.envType!=="Unknown"&&o.push(r.envType),[n,o.length?`(${o.join(": ")})`:""].join(" ").trim()}function ok(r){let e=r.envName;return r.envPath&&r.envType==="Conda"&&!r.envName&&(e=In(r.envPath)),e}var Woe=["Unknown","Conda","PipEnv","Poetry","Pyenv","Venv","VirtualEnv","VirtualEnvWrapper"];function tn(r){if(r.environment?.type==="Conda")return"Conda";let e=[["Conda","Conda"],["Pyenv","Pyenv"],["Pipenv","PipEnv"],["Poetry","Poetry"],["VirtualEnvWrapper","VirtualEnvWrapper"],["VirtualEnv","VirtualEnv"],["Venv","Venv"]];for(let[t,n]of e)if(r.tools.includes(t))return n;for(let t of Woe)if(r.tools.some(n=>n.toLowerCase()===t.toLowerCase()))return t;return"Unknown"}function ya(r){return tn(r)==="Conda"&&!r.executable.uri}function cx(r,e){if(r){let t={...r,sysPrefix:r.sysPrefix||"",uri:ur.Uri.file(r.path||""),id:e||r.id,envPath:r.envPath?ur.Uri.file(r.envPath):void 0,displayPath:"displayPath"in r&&typeof r.displayPath=="string"?ur.Uri.file(r.displayPath):void 0};return delete t.path,r.envPath||delete t.envPath,t}}function joe(r,e){let t=r.tools,n=[["Conda","Conda"],["Pyenv","Pyenv"],["Pipenv","PipEnv"],["Poetry","Poetry"],["VirtualEnvWrapper","VirtualEnvWrapper"],["VirtualEnv","VirtualEnv"],["Venv","Venv"]],i=t.length?t[0]:"Unknown";if(r.environment?.type==="Conda")i="Conda";else{for(let[c,u]of n)if(t.includes(c)){i=u;break}i==="Unknown"&&r.environment?.type==="VirtualEnvironment"&&(i="VirtualEnv")}let o=!1,s,a=r.id,l=r.executable.sysPrefix;if(r.executable.uri)s=r.executable.uri;else if(i==="Conda"&&e)o=!0,l=l||r.environment?.folderUri?.fsPath||"",s=en()==="Windows"?ur.Uri.joinPath(r.environment?.folderUri||ur.Uri.file(r.path),"python.exe"):ur.Uri.joinPath(r.environment?.folderUri||ur.Uri.file(r.path),"bin","python");else{J(`Python environment ${W(r.id)} excluded as Uri is undefined`);return}return{id:a,sysPrefix:l||"",envPath:r.environment?.folderUri,displayPath:r.environment?.folderUri||ur.Uri.file(r.path),envName:r.environment?.name||"",uri:s,displayName:r.environment?.name||"",envType:i,isCondaEnvWithoutPython:o,version:r.version?{major:r.version.major,minor:r.version.minor,patch:r.version.micro,raw:r.version.sysVersion}:void 0}}function sk(r,e){let t=tn(r),n=!1,i,o=r.id,s=r.executable.sysPrefix;if(r.executable.uri)i=r.executable.uri;else if(t==="Conda"&&e)n=!0,s=s||r.environment?.folderUri?.fsPath||"",i=en()==="Windows"?ur.Uri.joinPath(r.environment?.folderUri||ur.Uri.file(r.path),"python.exe"):ur.Uri.joinPath(r.environment?.folderUri||ur.Uri.file(r.path),"bin","python");else{J(`Python environment ${W(r.id)} excluded as Uri is undefined`);return}return{id:o,sysPrefix:s||"",envPath:r.environment?.folderUri,displayPath:r.environment?.folderUri||ur.Uri.file(r.path),envName:r.environment?.name||"",uri:i,displayName:r.environment?.name||"",envType:t,isCondaEnvWithoutPython:n,version:r.version?{major:r.version.major||0,minor:r.version.minor||0,patch:r.version.micro||0,raw:r.version.sysVersion||""}:void 0}}function Lc(r){if(r){let e=Object.assign({},r,{path:we(r.uri),envPath:r.envPath?we(r.envPath):void 0,displayPath:r.displayPath?we(r.displayPath):void 0});return delete e.uri,e}}var Gh=class{constructor(e,t,n,i){this.extensions=e;this.disposables=t;this.extensionChecker=n;this.workspace=i;this.api=pe();this.didActivatePython=new ur.EventEmitter;this._pythonExtensionHooked=pe();this.extensionChecker.isPythonExtensionInstalled||this.extensions.onDidChange(async()=>{this.extensionChecker.isPythonExtensionInstalled&&await this.registerHooks()},this,this.disposables),this.disposables.push(this.didActivatePython)}get onDidActivatePythonExtension(){return this.didActivatePython.event}get pythonExtensionHooked(){return this._pythonExtensionHooked.promise}get pythonExtensionVersion(){return this._pythonExtensionVersion}getApi(){return this.init().catch(m),this.api.promise}async getNewApi(){await this.init();let e=this.extensions.getExtension(hi);return e?.packageJSON?.version&&(this._pythonExtensionVersion=new aV.SemVer(e?.packageJSON?.version)),e?.exports}setApi(e){this.api.resolved||!this.workspace.isTrusted||this.api.resolve(e)}async init(){if(this.initialized)return;this.extensions.getExtension(hi)?await this.registerHooks():await this.extensionChecker.showPythonExtensionInstallRequiredPrompt(),this.initialized=!0}async registerHooks(){if(this.hooksRegistered)return;let e=this.extensions.getExtension(hi);if(!e)return;let t=!1;if(!e.isActive)try{await e.activate(),t=!0}catch(n){C("Failed activating the python extension: ",n),this.api.reject(new Gw(n));return}this.hooksRegistered||(this.hooksRegistered=!0,t&&this.didActivatePython.fire(),e.exports?.jupyter?e.exports.jupyter.registerHooks():(C("Python extension is not exporting the jupyter API"),this.api.reject(new zw)),this._pythonExtensionHooked.resolve())}};Gh=g([(0,qn.injectable)(),p(0,(0,qn.inject)(rr)),p(1,(0,qn.inject)(O)),p(2,(0,qn.inject)(ze)),p(3,(0,qn.inject)(ce))],Gh);var pp=class{constructor(e,t,n,i,o){this.extensions=e;this.appShell=t;this.commandManager=n;this.workspace=i;this.disposables=o;this.pythonExtensionInstallationStatusChanged=new ur.EventEmitter;this.extensions.onDidChange(this.extensionsChangeHandler.bind(this),this,this.disposables),this.previousInstallState=this.isPythonExtensionInstalled}get onPythonExtensionInstallationStatusChanged(){return this.pythonExtensionInstallationStatusChanged.event}get isPythonExtensionInstalled(){return this.extensions.getExtension(hi)!==void 0}get isPythonExtensionActive(){return this.extensions.getExtension(hi)?.isActive===!0}async directlyInstallPythonExtension(){return this.commandManager.executeCommand("workbench.extensions.installExtension",hi,{context:{skipWalkthrough:!0}})}async showPythonExtensionInstallRequiredPrompt(){if(!this.workspace.isTrusted)return;pp.promptDisplayed=!0;let e=ye.bannerLabelYes;R("DS_INTERNAL.PYTHON_EXTENSION_NOT_INSTALLED",void 0,{action:"displayed"}),await this.appShell.showInformationMessage(y.pythonExtensionRequired,{modal:!0},e)===e?(R("DS_INTERNAL.PYTHON_EXTENSION_NOT_INSTALLED",void 0,{action:"download"}),await this.installPythonExtension()):R("DS_INTERNAL.PYTHON_EXTENSION_NOT_INSTALLED",void 0,{action:"dismissed"})}async installPythonExtension(){this.commandManager.executeCommand("extension.open",hi).then(m,m)}async extensionsChangeHandler(){let e=this.isPythonExtensionInstalled;e!==this.previousInstallState&&(this.pythonExtensionInstallationStatusChanged.fire(e?"installed":"uninstalled"),this.previousInstallState=e)}};pp=g([(0,qn.injectable)(),p(0,(0,qn.inject)(rr)),p(1,(0,qn.inject)(ue)),p(2,(0,qn.inject)(Fe)),p(3,(0,qn.inject)(ce)),p(4,(0,qn.inject)(O))],pp);var zh=class{constructor(e,t,n,i,o){this.apiProvider=e;this.extensionChecker=t;this.disposables=n;this.workspace=i;this.context=o;this.didChangeInterpreter=new ur.EventEmitter;this.didChangeInterpreters=new ur.EventEmitter;this._onDidEnvironmentVariablesChange=new ur.EventEmitter;this._onDidRemoveInterpreter=new ur.EventEmitter;this.onDidRemoveInterpreter=this._onDidRemoveInterpreter.event;this.onDidEnvironmentVariablesChange=this._onDidEnvironmentVariablesChange.event;this.interpreterListCachePromise=void 0;this._status="idle";this._onDidChangeStatus=new ur.EventEmitter;this.onDidChangeStatus=this._onDidChangeStatus.event;this.refreshPromises=new Eo;this.pauseEnvDetection=!1;this.onResumeEnvDetection=new ur.EventEmitter;this._interpreters=new Map;this.workspaceCachedActiveInterpreter=new Set;this.lastLoggedResourceAndInterpreterId="";this.pythonEnvHashes=new Map;this.loggedEnvsWithoutInterpreterPath=new Set;this.pendingInterpreterChangeEventTriggers=new Map;this.pendingInterpretersChangeEventTriggers=new Map;this.extensionChecker.isPythonExtensionInstalled&&(this.extensionChecker.isPythonExtensionActive||this.apiProvider.onDidActivatePythonExtension(()=>{this.builtListOfInterpretersAtLeastOnce=!1,this.hookupOnDidChangeInterpreterEvent(),this.buildListOfInterpretersForFirstTime()},this,this.disposables)),this.workspace.onDidChangeWorkspaceFolders(this.onDidChangeWorkspaceFolders,this,n),this.workspace.onDidGrantWorkspaceTrust(()=>this.refreshInterpreters(!0),this,this.disposables),this.disposables.push(this._onDidChangeStatus),this.disposables.push(this.refreshPromises),this.disposables.push(this.onResumeEnvDetection),this.refreshPromises.onStateChange(()=>{this.status=this.refreshPromises.isComplete?"idle":"refreshing"}),this.workspace.onDidGrantWorkspaceTrust(()=>this.populateCachedListOfInterpreters(!0).catch(m),this,this.disposables)}get status(){return this._status}set status(e){this._status!==e&&(this._status=e,this._onDidChangeStatus.fire())}get known(){return this.api?.environments.known||[]}async resolveEnvironment(e){return this.getApi().then(t=>{if(!t)return;let n=typeof e=="string"?t.environments.known.find(i=>i.id===e||i.path===e):e;return t.environments.resolveEnvironment(n||e)})}get onDidChangeInterpreter(){return this.hookupOnDidChangeInterpreterEvent(),this.didChangeInterpreter.event}get onDidChangeInterpreters(){return this.hookupOnDidChangeInterpreterEvent(),this.didChangeInterpreters.event}get resolvedEnvironments(){return this.hookupOnDidChangeInterpreterEvent(),Array.from(this._interpreters.values()).map(e=>e.resolved)}get environmentsFound(){return this.getApi().catch(m),this.hookupOnDidChangeInterpreterEvent(),(this.api?.environments?.known.length??0)>0}getInterpreters(){if(this.hookupOnDidChangeInterpreterEvent(),!this.interpreterListCachePromise){this.getInterpretersCancellation?.cancel(),this.getInterpretersCancellation?.dispose();let e=this.getInterpretersCancellation=new ur.CancellationTokenSource;this.interpreterListCachePromise=this.getInterpretersImpl(e.token),this.interpreterListCachePromise.finally(()=>e.dispose()).catch(m),this.refreshPromises.push(this.interpreterListCachePromise)}return this.interpreterListCachePromise}pauseInterpreterDetection(e){e.isCancellationRequested||(this.pauseEnvDetection=!0,e.onCancellationRequested(()=>{this.pauseEnvDetection=!1,this.triggerPendingEvents()},this,this.disposables))}async refreshInterpreters(e=!1){let t=(async()=>{let n=await this.getApi();if(n)try{await n.environments.refreshEnvironments({forceRefresh:e}),this.interpreterListCachePromise=void 0,await this.getInterpreters(),w("Refreshed Environments")}catch{C("Failed to refresh the list of interpreters")}})();this.refreshPromises.push(t),this.refreshPromises.push(t.then(()=>Vn(1e3))),await t}async getActiveInterpreter(e){if(!this.workspace.isTrusted)return;let t=new $e;this.hookupOnDidChangeInterpreterEvent(),!e&&this.workspace.workspaceFolders?.length===1&&(e=this.workspace.workspaceFolders[0].uri),this.workspace.workspaceFolders?.length&&(e=this.workspace.getWorkspaceFolder(e)?.uri||this.workspace.workspaceFolders[0].uri);let n=this.workspace.getWorkspaceFolderIdentifier(e),i=this.getApi().then(async o=>{if(!o)return;let s=o.environments.getActiveEnvironmentPath(e),a=await o.environments.resolveEnvironment(s);return this.trackResolvedEnvironment(a)});return i.then(()=>{this.workspaceCachedActiveInterpreter.has(n)||(this.workspaceCachedActiveInterpreter.add(n),R("DS_INTERNAL.ACTIVE_INTERPRETER_LISTING_PERF",{duration:t.elapsedTime},{firstTime:!0}))}).catch(o=>{J(`Failed to get active interpreter from Python for workspace ${n}`,o)}),(fi||[ur.ExtensionMode.Development,ur.ExtensionMode.Test].includes(this.context.extensionMode))&&i.then(o=>{let s=`${W(e)}'-${W(o?.id)}`;this.lastLoggedResourceAndInterpreterId!==s&&(this.lastLoggedResourceAndInterpreterId=s,H(`Active Interpreter ${e?`for '${W(e)}' `:""}is ${W(o?.id)} (${o?.envType}, '${o?.envName}', ${o?.version?.major}.${o?.version?.minor}.${o?.version?.patch})`))}).catch(m),i}getInterpreterHash(e){return this.pythonEnvHashes.get(e)}async getInterpreterDetails(e,t){if(!this.workspace.isTrusted)throw new Error("Unable to determine active Interpreter as Workspace is not trusted");this.hookupOnDidChangeInterpreterEvent();try{return await this.getApi().then(async n=>{if(!n||t?.isCancellationRequested)return;let i=n.environments.known.find(l=>ti(e)?Co(l.executable.uri,e):typeof e=="string"?l.id===e:Co(ur.Uri.file(l.path),ur.Uri.file(e.path))),o=ti(e)?W(e):typeof e=="string"?e:W(ur.Uri.file(e.path));if(i){let l=await n.environments.resolveEnvironment(i),c=this.trackResolvedEnvironment(l);return te(`Interpreter details for ${o} from Python is ${JSON.stringify(l)} and our mapping is ${JSON.stringify(c)}`),c}let s=o;if(this.loggedEnvsWithoutInterpreterPath.has(s)||(this.loggedEnvsWithoutInterpreterPath.add(s),J(`No interpreter with path ${o} found in Python API, will convert Uri path to string as Id ${o}`)),t?.isCancellationRequested)return;let a=await n.environments.resolveEnvironment(ti(e)?e.fsPath:typeof e=="string"?e:e.path);return this.trackResolvedEnvironment(a)})}catch(n){J(`Failed to get Python interpreter details from Python Extension API for ${typeof e=="string"?e:W(ti(e)?e:ur.Uri.file(e.path))}`,n);return}}trackResolvedEnvironment(e){if(e){let t=this.apiProvider.pythonExtensionVersion&&this.apiProvider.pythonExtensionVersion.compare("2023.3.10341119")>=0,n=joe(e,!!t);if(!n)return;if(Dl(n).then(i=>{this.pythonEnvHashes.set(n.id,i)}).catch(m),!this._interpreters.get(e.id)||!tl(n,this._interpreters.get(e.id)?.resolved)){let i=this._interpreters.get(e.id);i?.resolved&&Object.assign(i.resolved,n),this._interpreters.set(e.id,{resolved:n}),this.triggerEventIfAllowed("interpretersChangeEvent",n)}return n}}triggerEventIfAllowed(e,t){if(e==="interpreterChangeEvent"?this.pendingInterpreterChangeEventTriggers.set(t?.id||"",t):this.pendingInterpretersChangeEventTriggers.set(t?.id||"",t),!this.pauseEnvDetection){this.triggerPendingEvents();return}}triggerPendingEvents(){this.pendingInterpreterChangeEventTriggers.forEach(t=>this.didChangeInterpreter.fire(t)),this.pendingInterpreterChangeEventTriggers.clear();let e=Array.from(this.pendingInterpretersChangeEventTriggers.values());if(e.length){let t=e.filter(n=>!!n);t.length!==e.length&&t.length===0?this.didChangeInterpreters.fire([]):this.didChangeInterpreters.fire(t)}this.pendingInterpretersChangeEventTriggers.clear()}async getApi(){if(this.extensionChecker.isPythonExtensionInstalled)return this.apiPromise||(this.apiPromise=this.apiProvider.getNewApi(),this.apiPromise.then(e=>e?this.api=e:void 0).catch(m)),this.apiPromise}onDidChangeWorkspaceFolders(){this.interpreterListCachePromise=void 0}populateCachedListOfInterpreters(e){e&&(this.interpreterListCachePromise=void 0);let t=this.getInterpreters().catch(m);return this.refreshPromises.push(t),this.refreshPromises.push(t.then(()=>Vn(1e3))),t}async getInterpretersImpl(e,t=0){if(!this.workspace.isTrusted)return[];this.extensionChecker.isPythonExtensionInstalled&&(this.builtListOfInterpretersAtLeastOnce=!0);let n=[],i=!1;return await this.getApi().then(async o=>{if(!o||e.isCancellationRequested)return[];let s=o.environments.known.length;try{await Promise.all(o.environments.known.map(async a=>{try{let l=await o.environments.resolveEnvironment(a),c=this.trackResolvedEnvironment(l);c?n.push(c):a.executable.uri&&a.environment?.type!=="Conda"&&C(`Failed to get env details from Python API for ${W(a.id)} without an error`)}catch(l){C(`Failed to get env details from Python API for ${W(a.id)}`,l)}})),this.triggerEventIfAllowed("interpretersChangeEvent",void 0)}catch(a){C("Failed to refresh list of interpreters and get their details",a)}s<o.environments.known.length&&(i=!0)}),e.isCancellationRequested?[]:i&&t<10?(w(`List of interpreters changed after a while, will need to rebuild it again, counter = ${t}`),this.getInterpretersImpl(e,t++)):(w(`Full interpreter list is length: ${n.length}, ${n.map(o=>`${o.id}:${o.displayName}:${o.envType}:${W(o.uri)}`).join(", ")}`),n)}buildListOfInterpretersForFirstTime(){this.builtListOfInterpretersAtLeastOnce||(this.extensionChecker.isPythonExtensionActive&&(this.builtListOfInterpretersAtLeastOnce=!0,this.populateCachedListOfInterpreters().catch(m)),this.extensionChecker.onPythonExtensionInstallationStatusChanged(e=>{e==="installed"&&this.extensionChecker.isPythonExtensionActive&&this.populateCachedListOfInterpreters().catch(m)},this,this.disposables))}hookupOnDidChangeInterpreterEvent(){this.eventHandlerAdded||(this.buildListOfInterpretersForFirstTime(),this.getApi().then(e=>{!this.eventHandlerAdded&&e&&(this.eventHandlerAdded=!0,e.environments.onDidEnvironmentVariablesChange(t=>{w(`Detected changes to env file ${t.resource?.uri?.path} in PythonApi`),this._onDidEnvironmentVariablesChange.fire()},this,this.disposables),e.environments.onDidChangeActiveEnvironmentPath(()=>{w("Detected change in Active Python environment via Python API"),this.interpreterListCachePromise=void 0,this.workspaceCachedActiveInterpreter.clear(),this.triggerEventIfAllowed("interpreterChangeEvent",void 0)},this,this.disposables),e.environments.onDidChangeEnvironments(async t=>{w(`Python API env change detected, ${t.type} => '${t.env.id}'`),t.type==="remove"&&this._interpreters.delete(t.env.id);let n=!!(t.type==="update"&&this._interpreters.get(t.env.id)?.resolved.isCondaEnvWithoutPython&&t.env.executable.uri);this.populateCachedListOfInterpreters(!0).finally(()=>{let i=this._interpreters.get(t.env.id);t.type==="remove"&&!i?(this.triggerEventIfAllowed("interpreterChangeEvent",void 0),this.triggerEventIfAllowed("interpretersChangeEvent",void 0),this._onDidRemoveInterpreter.fire({id:t.env.id})):t.type==="update"&&i&&n&&!i.resolved.isCondaEnvWithoutPython&&(this.triggerEventIfAllowed("interpreterChangeEvent",i.resolved),this.triggerEventIfAllowed("interpretersChangeEvent",i.resolved))}).catch(m)},this,this.disposables))}).catch(m))}};zh=g([(0,qn.injectable)(),p(0,(0,qn.inject)(Xt)),p(1,(0,qn.inject)(ze)),p(2,(0,qn.inject)(O)),p(3,(0,qn.inject)(ce)),p(4,(0,qn.inject)(dt))],zh);var dp=class{constructor(e,t,n,i){this.specFile=t;this.interpreterPath=n;this.isRegisteredByVSC=i;this.name=e.name,this.argv=e.argv,this.language=e.language,this.executable=e.argv&&e.argv.length>0?e.argv[0]:"",this.display_name=e.display_name,this.metadata=e.metadata,this.env=e.env,this.interrupt_mode=e.interrupt_mode}};var bi=require("vscode"),SV=k(uA());var pV=k(Hh());var dV=require("vscode");var Boe={output_type:"stream",name:"stdout",text:""},qoe={output_type:"error",ename:"",evalue:"",traceback:[""]},Joe={output_type:"display_data",data:{},metadata:{}},$oe={output_type:"execute_result",execution_count:0,data:{},metadata:{}},Hoe={stream:new Set(Object.keys(Boe)),error:new Set(Object.keys(qoe)),display_data:new Set(Object.keys(Joe)),execute_result:new Set(Object.keys($oe))};function io(r){return r&&Yu(r).toLowerCase().endsWith("ipynb")?"notebook":"interactive"}function Goe(r){let e;switch(r.output_type){case"stream":case"error":case"execute_result":case"display_data":e=Hoe[r.output_type];break;default:return r}let t={...r};for(let n of Object.keys(r))e.has(n)||delete t[n];return t}function mV(r){let e={...r,source:_l(r.source)};if(e.cell_type!=="code")delete e.outputs,delete e.execution_count;else if(e.cell_type){let t=e;t.outputs=t.outputs?t.outputs.map(Goe):[]}return e}function Ts(r){return r=r.toLowerCase(),r.length===2&&r.endsWith("#")?`${r.substring(0,1)}sharp`:sW.get(r)||r}function Dt(r){return typeof r=="string"?r===Ct||r===wt:r.notebookType===Ct||r.notebookType===wt}function wo(r){let e=r.metadata?.custom;return JSON.parse(JSON.stringify(e?.metadata||{}))}function fV(r){let e=r.metadata?.custom;return{nbformat:e?.nbformat,nbformat_minor:e?.nbformat_minor}}function mp(r){return dV.workspace.notebookDocuments.find(e=>Dt(e)&&e.getCells().some(t=>t.document===r))}function _s(r){if(Array.isArray(r)){let e="";for(let t=0;t<r.length;t+=1){let n=r[t];t<r.length-1&&!n.endsWith(`
`)?e=e.concat(`${n}
`):e=e.concat(n)}return e}return r.toString()}function _l(r){if(Array.isArray(r))return r;let e=r.toString();if(e.length>0){let t=e.split(`
`);return t.map((n,i)=>i<t.length-1?`${n}
`:n).filter(n=>n.length>0)}return[]}function zoe(r){let e=r;do r=e,e=r.replace(/[^\n]\x08/gm,"");while(e.length<r.length);return r}function Qoe(r){for(r=r.replace(/\r+\n/gm,`
`);r.search(/\r[^$]/g)>-1;){var e=r.match(/^(.*)\r+/m)[1],t=r.match(/\r+(.*)$/m)[1];t=t+e.slice(t.length,e.length),r=r.replace(/\r+.*$/m,"\r").replace(/^.*\r/m,t)}return r}function hV(r){return Qoe(zoe(r))}var ak="'''",lk='"""';function am(r,e,t){let n,i,o=0;for(let s of r){let a=s.trim(),l=a.startsWith(ak)?ak:a.startsWith(lk)?lk:void 0,c=a.includes(ak)?ak:a.includes(lk)?lk:void 0;if(i)i===c&&(i=void 0),t(s,o);else if(n)n===l&&(n=void 0),n&&e(s,o);else if(c&&!l){let u=a.indexOf(c);i=a.lastIndexOf(c)!==u?void 0:c,t(s,o)}else if(l){let u=a.indexOf(l,3);n=u>=0?void 0:l,a.length>3&&e(a.slice(3,u>=0?u:void 0),o)}else a.startsWith("#")?e(a.slice(1),o):t(s,o);o+=1}}function Rl(r,e=`
`,t){return r.map((n,i)=>{let o=t?t(n):n;return i===r.length-1?`${o}`:`${o}${e}`})}function Yoe(r){let e=[];return am(r,t=>e.push(t),t=>{}),e}function ck(r){return Rl(Yoe(r.slice(r.length>1?1:0)))}function gV(r){let e=r.length,t=-1;return r.forEach((n,i)=>{n.trim()&&(e=i,t<0&&(t=i))}),t>=0?r.slice(t,e+1):[]}function uk(r){let e=/^\s*(\d+)\.(\d+)\.(.+)\s*$/.exec(r);if(e&&e.length>2){let t=parseInt(e[1],10),n=parseInt(e[2],10),i=parseInt(e[3],10);return(0,pV.parse)(`${t}.${n}.${i}`,!0)??void 0}}var pA=class{constructor(e,t,n,i=!1){this._impl=e;this.controllerId=t;this._endCallback=n;this.clearOutputOnStartWithTime=i;this.started=!1}get cell(){return this._impl.cell}get token(){return this._impl.token}get executionOrder(){return this._impl.executionOrder}set executionOrder(e){this._impl.executionOrder=e}startIfNecessary(){this.started||this._impl.start()}start(e){this.started||(this.started=!0,this._impl.start(e),this._startTime=e,this.clearOutputOnStartWithTime?(w(`Start cell ${this.cell.index} execution @ ${e} (clear output)`),this._impl.clearOutput().then(m,m)):w(`Start cell ${this.cell.index} execution @ ${e}`))}end(e,t){if(this._endCallback)try{this._impl.end(e,t),H(`End cell ${this.cell.index} execution after ${((t||0)-(this._startTime||0))/1e3}s, completed @ ${t}, started @ ${this._startTime}`)}finally{this._endCallback(),this._endCallback=void 0}}clearOutput(e){return this.startIfNecessary(),this._impl.clearOutput(e)}replaceOutput(e,t){return this.startIfNecessary(),this._impl.replaceOutput(e,t)}appendOutput(e,t){return this.startIfNecessary(),this._impl.appendOutput(e,t)}replaceOutputItems(e,t){return this.startIfNecessary(),this._impl.replaceOutputItems(e,t)}appendOutputItems(e,t){return this.startIfNecessary(),this._impl.appendOutputItems(e,t)}},Bo=class r{static{this._map=new WeakMap}static getOrCreate(e,t,n=!1){let i,o=e.document;if(i=this.get(e),!i)i=r.create(o,e,t,n);else if(i.controllerId!==t.id){let s=i;s.end(void 0),i=r.create(o,e,t,n),s.started&&i.start(new Date().getTime())}return i}static get(e){let t=e.document;return r._map.get(t)}static create(e,t,n,i=!1){let o=new pA(n.createNotebookCellExecution(t),n.id,()=>{r._map.delete(e)},i);return r._map.set(e,o),o}};function xV(r){let e;return r.kind===bi.NotebookCellKind.Markup?e=ese(r):"document"in r&&r.document.languageId==="raw"||"languageId"in r&&r.languageId==="raw"?e=Xoe(r):e=Zoe(r),e}function Xoe(r){let e=r.metadata?.custom,t={cell_type:"raw",source:_l("document"in r?r.document.getText():r.value),metadata:e?.metadata||{}};return e?.attachments&&(t.attachments=e.attachments),t}function Zoe(r){let e=r.metadata?.custom,t="document"in r?r.document.getText():r.value;return{cell_type:"code",execution_count:r.executionSummary?.executionOrder??null,source:_l(t),outputs:(r.outputs||[]).map(mk),metadata:e?.metadata||{}}}function ese(r){let e=r.metadata?.custom,t={cell_type:"markdown",source:_l("document"in r?r.document.getText():r.value),metadata:e?.metadata||{}};return e?.attachments&&(t.attachments=e.attachments),t}var vV=["application/vnd.*","application/vdom.*","application/geo+json","application/x-nteract-model-debug+json","text/html","application/javascript","image/gif","text/latex","text/markdown","image/png","image/svg+xml","image/jpeg","application/json","text/plain"];function yV(r){if(r.mime.startsWith("application/vnd."))try{return Buffer.from(r.data).toString().length===0}catch{}return!1}function tse(r){return r.sort((e,t)=>{let n=(s,a)=>(s.endsWith(".*")&&(s=s.substr(0,s.indexOf(".*"))),a.startsWith(s)),i=vV.findIndex(s=>n(s,e.mime)),o=vV.findIndex(s=>n(s,t.mime));return yV(e)&&(i=-1),yV(t)&&(o=-1),i=i==-1?100:i,o=o==-1?100:o,i-o})}var Uc=class r{static{this.cellStates=new WeakMap}static getCellState(e){return r.cellStates.get(e)?.state}static getCellStatus(e){return(r.cellStates.get(e)?.stateTransition||[]).join(", ")||""}static setCellState(e,t){let n=r.cellStates.get(e)?.start||new $e,i=r.cellStates.get(e)?.stateTransition||[];i.push(`${t} ${i.length===0?"@ start":`After ${n.elapsedTime}ms`}`),r.cellStates.set(e,{stateTransition:i,state:t,start:n})}};function yt(r,e){te(`Cell Index:${r.index}, of document ${In(r.notebook.uri)} with state:${Uc.getCellStatus(r)}, exec: ${r.executionSummary?.executionOrder}. ${e}.`)}var Qh=new Map;Qh.set("display_data",dk);Qh.set("error",ose);Qh.set("execute_result",dk);Qh.set("stream",rse);Qh.set("update_display_data",dk);function ba(r){let e=Qh.get(r.output_type),t;return e?t=e(r):(J(`Unable to translate cell from ${r.output_type} to NotebookCellData for VS Code.`),t=dk(r)),t}function dA(r){let e={outputType:r.output_type};switch(r.transient&&(e.transient=r.transient),r.output_type){case"display_data":case"execute_result":case"update_display_data":{e.executionCount=r.execution_count,e.metadata=r.metadata?JSON.parse(JSON.stringify(r.metadata)):{};break}default:break}return e}function dk(r){let e=dA(r);("image/svg+xml"in r.data||"image/png"in r.data)&&(e.__displayOpenPlotIcon=!0);let t=[];if(r.data)for(let n in r.data)t.push(ise(n,r.data[n]));return new bi.NotebookCellOutput(tse(t),e)}function rse(r){let e=_s(r.text),t=r.name==="stderr"?bi.NotebookCellOutputItem.stderr:bi.NotebookCellOutputItem.stdout;return new bi.NotebookCellOutput([t(e)],dA(r))}function nse(r){if(r.items.length>0)return r.items[0].mime==="application/vnd.code.notebook.stderr"?"stderr":"stdout"}function bV(r){let e=r.items[0];if(!e.data)return{output_type:"error",ename:"",evalue:"",traceback:[]};let t=r.metadata?.originalError,n=JSON.parse(Buffer.from(e.data).toString("utf8"));return{output_type:"error",ename:n.name,evalue:n.message,traceback:t?.traceback||_l(n.stack||n.message||"")}}var lm=new TextDecoder,CV=["text/plain","text/markdown","application/vnd.code.notebook.stderr","application/vnd.code.notebook.stdout"];function pk(r,e){if(!e)return"";try{if(r==="application/vnd.code.notebook.error"){let t=lm.decode(e);return JSON.parse(t)}else if(r.startsWith("text/")||CV.includes(r)){let t=lm.decode(e);return _l(t)}else if(r.startsWith("image/")&&r!=="image/svg+xml"){if(typeof Buffer<"u"&&typeof Buffer.from=="function")return Buffer.from(e).toString("base64");{let t=lm.decode(e);return btoa(encodeURIComponent(t).replace(/%([0-9A-F]{2})/g,function(n,i){return String.fromCharCode(Number.parseInt("0x"+i))}))}}else if(r.toLowerCase().startsWith("application/vnd.holoviews_load.v")&&r.toLowerCase().endsWith("+json")){let t=lm.decode(e);try{return t.length>0?JSON.parse(t):t}catch{return t}}else if(r.toLowerCase().includes("json")){let t=lm.decode(e);return t.length>0?JSON.parse(t):t}else return lm.decode(e)}catch(t){return C(`Failed to convert ${r} output from a buffer ${typeof e}, ${e}`,t),""}}function ise(r,e){if(!e)return bi.NotebookCellOutputItem.text("",r);try{if((r.startsWith("text/")||CV.includes(r))&&(Array.isArray(e)||typeof e=="string")){let t=Array.isArray(e)?_s(e):e;return bi.NotebookCellOutputItem.text(t,r)}else if(r.startsWith("image/")&&typeof e=="string"&&r!=="image/svg+xml"){if(typeof Buffer<"u"&&typeof Buffer.from=="function")return new bi.NotebookCellOutputItem(Buffer.from(e,"base64"),r);{let t=Uint8Array.from(atob(e),n=>n.charCodeAt(0));return new bi.NotebookCellOutputItem(t,r)}}else return typeof e=="object"&&e!==null&&!Array.isArray(e)?bi.NotebookCellOutputItem.text(JSON.stringify(e),r):(e=Array.isArray(e)?_s(e):e,bi.NotebookCellOutputItem.text(e,r))}catch(t){return C(`Failed to convert ${r} output to a buffer ${typeof e}, ${e}`,t),bi.NotebookCellOutputItem.text("")}}function IV(r){let e=[];r.items.filter(n=>n.mime==="application/vnd.code.notebook.stderr"||n.mime==="application/vnd.code.notebook.stdout").map(n=>lm.decode(n.data)).forEach(n=>{let i=n.split(`
`);e.length&&i.length&&i[0].length>0&&(e[e.length-1]=`${e[e.length-1]}${i.shift()}`);for(let o of i)e.push(o)});for(let n=0;n<e.length-1;n++)e[n]=`${e[n]}
`;return e.length&&e[e.length-1].length===0&&e.pop(),{output_type:"stream",name:nse(r)||"stdout",text:e}}function mk(r){let e=r.metadata,t;switch(e?.outputType){case"error":{t=bV(r);break}case"stream":{t=IV(r);break}case"display_data":{t={output_type:"display_data",data:r.items.reduce((i,o)=>(i[o.mime]=pk(o.mime,o.data),i),{}),metadata:e?.metadata||{}};break}case"execute_result":{t={output_type:"execute_result",data:r.items.reduce((i,o)=>(i[o.mime]=pk(o.mime,o.data),i),{}),metadata:e?.metadata||{},execution_count:typeof e?.executionCount=="number"?e?.executionCount:null};break}case"update_display_data":{t={output_type:"update_display_data",data:r.items.reduce((i,o)=>(i[o.mime]=pk(o.mime,o.data),i),{}),metadata:e?.metadata||{}};break}default:{let i=r.items.length===1&&r.items.every(l=>l.mime==="application/vnd.code.notebook.error"),o=r.items.every(l=>l.mime==="application/vnd.code.notebook.stderr"||l.mime==="application/vnd.code.notebook.stdout");if(i)return bV(r);let s=e?.outputType||(o?"stream":"display_data");R("DS_INTERNAL.VSCNOTEBOOK_CELL_TRANSLATION_FAILED",void 0,{outputType:s});let a;s==="stream"?a=IV(r):s==="display_data"?a={data:{},metadata:{},output_type:"display_data"}:a={output_type:s},e?.metadata&&(a.metadata=e.metadata),r.items.length>0&&(a.data=r.items.reduce((l,c)=>(l[c.mime]=pk(c.mime,c.data),l),{})),t=a;break}}return t&&e&&e.transient&&(t.transient=e.transient),t}function ose(r){return r=r||{output_type:"error",ename:"",evalue:"",traceback:[]},new bi.NotebookCellOutput([bi.NotebookCellOutputItem.error({name:r?.ename||"",message:r?.evalue||"",stack:(r?.traceback||[]).join(`
`)})],{...dA(r),originalError:r})}async function fk(r,e,t){let n=!1,i;if(!r)return{changed:n,kernelId:i};r?.language_info?.name||(r.language_info=r.language_info||{name:""});let o;switch(e?.kind){case"connectToLiveRemoteKernel":o=e.kernelModel.language;break;case"startUsingRemoteKernelSpec":case"startUsingLocalKernelSpec":o=e.kernelSpec.language;break;case"startUsingPythonInterpreter":o=xe;break;default:break}if(r.language_info.name!==o&&o&&(r.language_info.name=o,n=!0),t&&"language_info"in t&&t.language_info)(0,SV.default)(r.language_info,t.language_info)||(r.language_info=JSON.parse(JSON.stringify(t.language_info)),n=!0);else{let a=Vt(e),l=a?EV(e):void 0,c=l?.version?`${l.version.major}.${l.version.minor}.${l.version.patch}`:"";l&&l.version&&r&&r.language_info&&r.language_info.version!==c?(r.language_info.version=c,n=!0):!l&&r?.language_info&&a&&(r.language_info=void 0,n=!0)}let s=e&&Yh(e)?e.kernelModel:e&&"kernelSpec"in e?e.kernelSpec:void 0;if(e?.kind==="startUsingPythonInterpreter"){let a=e.kernelSpec,l=a.display_name||e.interpreter.displayName||"",c="";switch(Kn(a)){case"registeredByOldVersionOfExt":case"registeredByNewVersionOfExt":c="python3";break;case"registeredByNewVersionOfExtForCustomKernelSpec":{c=(a.metadata?.vscode?.originalSpecFile?Te(pt(a.metadata.vscode.originalSpecFile)):void 0)||a.name,l=a.metadata?.vscode?.originalDisplayName||l;break}default:c=a.name;break}r.kernelspec?.name!==c&&(n=!0,r.kernelspec={name:c,language:xe,display_name:l},"vscode"in r&&delete r.vscode,"interpreter"in r&&delete r.interpreter)}else if(s&&!r.kernelspec){let a=s.metadata?.vscode?.originalSpecFile?Te(pt(s.metadata.vscode.originalSpecFile)):void 0;r.kernelspec={name:a||s.name||s.display_name||"",display_name:s.metadata?.vscode?.originalDisplayName||s.display_name||s.name||""},s.language&&(r.kernelspec.language=s.language),i=s.id,n=!0}else if(s&&r.kernelspec){let l=(s.metadata?.vscode?.originalSpecFile?Te(pt(s.metadata.vscode.originalSpecFile)):void 0)||s.name||s.display_name||"",c=s.metadata?.vscode?.originalDisplayName||s.display_name||s.name||"",u=s.language||s.language||"";(r.kernelspec.name!==l||r.kernelspec.language!==u||r.kernelspec.display_name!==c||i!==s.id)&&(n=!0,r.kernelspec.name=l,r.kernelspec.display_name=c,r.kernelspec.language=u,i=s.id);try{delete r.kernelspec.metadata}catch{}}return{changed:n,kernelId:i}}async function fp(r,e,t,n){let i=Bo.getOrCreate(r,e),o=Fh(t);if(!o){i.started&&i.end(n?void 0:!1,r.executionSummary?.timing?.endTime);return}i.started||(i.start(r.executionSummary?.timing?.endTime),i.executionOrder=r.executionSummary?.executionOrder),await i.appendOutput(o),i.end(n?void 0:!1,r.executionSummary?.timing?.endTime)}function hk(r){if(r.hasOwnProperty("text/html")){let e=r["text/html"];typeof e=="string"&&e.includes('<iframe id="tensorboard-frame-')&&(r["text/html"]=e.replace(/new URL\((.*), window.location\)/,'new URL("http://localhost")'))}return r}function ux(r){let e=this,t=!1,n;return function(){return t||(t=!0,n=r.apply(e,arguments)),n}}var cm="{connection_file}";function kV(r){return r.argv.findIndex(e=>e.includes(cm))}var Xh="-jvsc-",sse=/^python\d*.?\d*$/;async function Ia(r,e){return ase(await gA(r),r,e)}function ase(r,e,t){let n=e?{path:we(e.uri)}:{},i={name:r,language:"python",display_name:e?.displayName||"Python 3",metadata:{interpreter:n},argv:["python","-m","ipykernel_launcher","-f",cm],env:{},resources:{}},o=t&&i.name?Yt(t,i.name,"kernel.json"):void 0;return new dp(i,o?we(o):void 0,we(e?.uri),"registeredByNewVersionOfExt")}function PV(r){let e=JSON.parse(JSON.stringify(r));return e.env&&Object.keys(e.env).forEach(n=>{if(e.env){let i=e.env[n];i!=null&&(e.env[n]=i.toString())}}),e}function gk(r){let e=r?.kernelspec;return r?.language_info?.name&&r.language_info.name!==xe?!1:e?.name?.includes(xe)?!0:e?.language===xe||r?.language_info?.name===xe}function mx(r){let e=r.metadata?.vscode?.originalSpecFile||r.metadata?.originalSpecFile,t=e?Te(pt(e)):r.name||"",n=r.metadata?.vscode?.originalDisplayName||r.display_name||"";return!!(t.toLowerCase().match(sse)||n.toLowerCase()==="python 3 (ipykernel)"||n.toLowerCase()==="python 3")}function lse(r){if(r.includes(Xh)){let e=/[a-f0-9]$/;if(r.substring(r.lastIndexOf(Xh)+Xh.length).search(e)!==-1){let t=r.substring(0,r.lastIndexOf(Xh));return t.toLowerCase().endsWith(".ipynb")||t.toLowerCase().endsWith(".py")?t:`${t}.ipynb`}}return r}function vk(r){return r.kind!=="connectToLiveRemoteKernel"}function Yh(r){return r.kind==="connectToLiveRemoteKernel"}function ci(r,e,t){e=mA(r)?e:void 0;let n=r.name,i=Kn(r);if(i&&n.includes(dx)&&(n=n.substring(n.indexOf(dx)),i==="registeredByNewVersionOfExtForCustomKernelSpec")){let c=r.metadata?.vscode?.originalSpecFile||r.metadata?.originalSpecFile;c&&(n=`${n}#${Te(pt(c))}`)}let o="";mA(r)?o=r.argv.slice(1).filter(c=>!["-f","{connection_file}"].includes(c)).join("#").toLowerCase():o=r.argv.join("#").toLowerCase();let s=t?`${t}.`:"",a=we(Pl(r.interpreterPath?px.Uri.file(r.interpreterPath):px.Uri.file(r.executable))),l=we(Pl(e?.uri))||"";return`${s}${r.id||""}.${n}.${a}.${l}.${o}`}function gt(r){let e=cse(r);if(!r)return e;switch(r.kind){case"connectToLiveRemoteKernel":{let n=lse(r.kernelModel?.notebook?.path||r.kernelModel?.model?.path||"");return n?`${e} (${n})`:e}case"startUsingRemoteKernelSpec":case"startUsingLocalKernelSpec":if(r.interpreter?.envType&&r.interpreter.envType!=="Unknown"){let n=ok(r.interpreter);if(r.kernelSpec.language===xe){let i=`Python ${lp(r.interpreter.version?.raw||"")||""}`.trim();return r.interpreter.envName?`${e} (${i})`:e}else return n?`${e} (${n})`:e}else return e;case"startUsingPythonInterpreter":let t=(lp(r.interpreter.version?.raw||"")||"").trim();if(r.interpreter.envType&&r.interpreter.envType!=="Unknown"){if(r.kernelSpec.display_name&&Kn(r.kernelSpec)==="registeredByNewVersionOfExtForCustomKernelSpec")return r.kernelSpec.display_name;let n=r.interpreter.envType==="Conda"&&r.interpreter.isCondaEnvWithoutPython===!0,i=t.trim()?`Python ${t}`:"Python",o=ok(r.interpreter);return n&&o?o:o?`${o} (${i})`:i}else return`Python ${t}`.trim()}return e}function cse(r){if(!r)return"";let e=r.kind==="connectToLiveRemoteKernel"?r.kernelModel.display_name:r.kernelSpec?.display_name,t=r.kind==="connectToLiveRemoteKernel"?r.kernelModel.name:r.kernelSpec?.name,n=r.kind==="startUsingPythonInterpreter"?r.interpreter.displayName:void 0;return[e,t,n,""].find(i=>typeof i=="string"&&i.length>0)||""}function Zh(r,e=""){return r?r.kind==="connectToLiveRemoteKernel"?r.kernelModel.name:r.kernelSpec?.name:e}function use(r){if(!r)return;let e=Yh(r)?r.kernelModel:void 0,t=vk(r)?r.kernelSpec:void 0;if(r.kind==="startUsingPythonInterpreter"||(r.kind==="startUsingRemoteKernelSpec"||r.kind==="startUsingLocalKernelSpec")&&r.kernelSpec.language===xe){let n=t?.metadata?.interpreter?.path||t?.interpreterPath||t?.executable;return n==="/python"||n==="python"?r.interpreter?.displayPath:n?px.Uri.file(n):void 0}else{let n=e?.executable||t?.executable||t?.metadata?.interpreter?.path||t?.interpreterPath;return n?px.Uri.file(n):void 0}}function fA(r,e=""){if(r?.kind==="connectToLiveRemoteKernel"){let t;if(typeof r.kernelModel.lastActivityTime=="string")try{t=new Date(r.kernelModel.lastActivityTime)}catch(n){w(`Error parsing date ${n}`)}else t=r.kernelModel.lastActivityTime;return y.jupyterSelectLiveRemoteKernelDescription(t,r.kernelModel.numberOfConnections)}return e}function hA(r,e,t){if(r?.kind==="connectToLiveRemoteKernel")return;let n=use(r),i=e.workspaceFolders?e.workspaceFolders:[];return n?W(n,i,t.homeDir):""}function EV(r){if(!r)return;if(r.interpreter)return r.interpreter;let e=Yh(r)?r.kernelModel:void 0;if(e?.metadata?.interpreter)return cx(e?.metadata?.interpreter,"");let t=vk(r)?r.kernelSpec:void 0;return cx(t?.metadata?.interpreter,"")}function eg(r){return r.kind==="startUsingLocalKernelSpec"||r.kind==="startUsingPythonInterpreter"&&r.kernelSpec&&Kn(r.kernelSpec)==="registeredByNewVersionOfExtForCustomKernelSpec"}function Vt(r){if(!r)return!1;if(r.kind==="startUsingPythonInterpreter")return!0;let e=Yh(r)?r.kernelModel:void 0,t=vk(r)?r.kernelSpec:void 0;return e?.language===xe||mA(t)}function mA(r){return(r?.language||"").toLowerCase()===xe}function oo(r){if(!r)return;if(r.kind==="startUsingPythonInterpreter")return xe;let e=Yh(r)?r.kernelModel:void 0,t=vk(r)?r.kernelSpec:void 0;return e?.language||DV(t)}function yk(r){if(!r)return;let e=r.kernelspec;return DV(e)||r.language_info?.name}function DV(r){return r?.language}var dx="jvsc74a57bd0";async function gA(r){let t=(r?.sysVersion?lp(r.sysVersion)||"3":"").replace(/\./g,""),n=r?`python${t}`:"";return r?`${n}${dx}${await Dl(r)}`:"python3"}function Kn(r){if(r.isRegisteredByVSC)return r.isRegisteredByVSC;if(!r.name)return;let e=r.metadata?.vscode?.originalSpecFile||r.metadata?.originalSpecFile,t=e?Te(pt(e)):r.name,n=mx({...r,name:t})?Object.keys(r.env||{}).length>0:typeof e=="string"&&!e.includes(dx);if(r.name.includes(dx))return n?"registeredByNewVersionOfExtForCustomKernelSpec":"registeredByNewVersionOfExt";let i=/[a-f0-9]{32}$/;if(r.metadata?.interpreter&&r.name.toLowerCase().search(i)!==-1)return"registeredByOldVersionOfExt"}function TV(r,e){return!r&&!e?!0:!r&&e||r&&!e?!1:r?.id===e?.id}function bk(r){if(r.kind==="connectToLiveRemoteKernel"||r.kind==="startUsingRemoteKernelSpec"){let e=new wV.default(r.baseUrl);return e.hostname.toLocaleLowerCase()==="localhost"||e.hostname==="127.0.0.1"}return!1}async function xn(r,e,t){w(`Executing silently Code (${r.status}) = ${je(e.substring(0,100)).join("\\n")}`);let n=require("@jupyterlab/services"),i=r.requestExecute({code:e.replace(/\r\n/g,`
`),silent:!1,stop_on_error:!1,allow_stdin:!0,store_history:!1},!0),o=[];i.onIOPub=a=>{if(n.KernelMessage.isStreamMsg(a))if(te(`Got io pub message (stream), ${je(a.content.text.substr(0,100)).join("\\n")}`),o.length>0&&o[o.length-1].output_type==="stream"&&o[o.length-1].name===a.content.name){let l=o[o.length-1];l.text+=a.content.text}else{let l={name:a.content.name,text:a.content.text,output_type:"stream"};o.push(l)}else if(n.KernelMessage.isExecuteResultMsg(a)){te("Got io pub message (execresult)}");let l={data:a.content.data,execution_count:a.content.execution_count,metadata:a.content.metadata,output_type:"execute_result"};o.push(l)}else if(n.KernelMessage.isDisplayDataMsg(a)){te("Got io pub message (displaydata)}");let l={data:a.content.data,metadata:a.content.metadata,output_type:"display_data"};o.push(l)}else if(n.KernelMessage.isErrorMsg(a)){if(te(`Got io pub message (error), ${a.content.ename},${a.content.evalue}, ${a.content.traceback.join().substring(0,100)}}`),t?.traceErrors){let c=`${t.traceErrorsMessage||"Failed to execute (silent) code against the kernel"}, 
Code = ${e}
Error details: `;C(`${c} ${a.content.ename},${a.content.evalue}, ${a.content.traceback.join()}`)}let l={ename:a.content.ename,evalue:a.content.evalue,traceback:a.content.traceback,output_type:"error"};o.push(l)}else te(`Got io pub message (${a.header.msg_type})`)},await i.done;let s=je(e.substring(0,100)).join("\\n");return t&&pse(o,t,s),w(`Executing silently Code (completed) = ${s} with ${o.length} output(s)`),o}function _V(r,e,t,n){e=e.replace(/\r\n/g,`
`);let i=require("@jupyterlab/services"),o=r.requestExecute({code:e,silent:!1,stop_on_error:!1,allow_stdin:!1,store_history:!1},!0),s=ux(t);return o.onIOPub=a=>{s(),i.KernelMessage.isStreamMsg(a)?n(ba({output_type:"stream",name:a.content.name,text:a.content.text}).items):i.KernelMessage.isExecuteResultMsg(a)?n(ba({output_type:"execute_result",data:a.content.data,metadata:a.content.metadata,transient:a.content.transient,execution_count:a.content.execution_count}).items):i.KernelMessage.isDisplayDataMsg(a)?n(ba({output_type:"display_data",data:hk(a.content.data),metadata:a.content.metadata,transient:a.content.transient}).items):i.KernelMessage.isErrorMsg(a)?n(ba({output_type:"error",ename:a.content.ename,evalue:a.content.evalue,traceback:a.content.traceback}).items):i.KernelMessage.isExecuteInputMsg(a)||i.KernelMessage.isStatusMsg(a)||J(`Got unexpected io pub message when executing code sillenty (${a.header.msg_type})`)},o}function pse(r,e,t){r.filter(n=>n.output_type==="error").forEach(n=>{let i=n,o=`${i.ename}: ${i.evalue} 
 ${i.traceback.map(a=>`    ${a}`).join(`
`)}`,s=`${e.traceErrorsMessage||""} ${t} ${o}`;e.traceErrors?C(s):J(s),e.telemetryName&&R(e.telemetryName)})}var AV=k(RV());var yA;(b=>{function r(D){return D&&typeof D=="object"&&typeof D[Symbol.iterator]=="function"}b.is=r;let e=Object.freeze([]);function t(){return e}b.empty=t;function*n(D){yield D}b.single=n;function i(D){return r(D)?D:n(D)}b.wrap=i;function o(D){return D||e}b.from=o;function s(D){return!D||D[Symbol.iterator]().next().done===!0}b.isEmpty=s;function a(D){return D[Symbol.iterator]().next().value}b.first=a;function l(D,_){for(let L of D)if(_(L))return!0;return!1}b.some=l;function c(D,_){for(let L of D)if(_(L))return L}b.find=c;function*u(D,_){for(let L of D)_(L)&&(yield L)}b.filter=u;function*d(D,_){let L=0;for(let Z of D)yield _(Z,L++)}b.map=d;function*f(...D){for(let _ of D)for(let L of _)yield L}b.concat=f;function h(D,_,L){let Z=L;for(let Se of D)Z=_(Z,Se);return Z}b.reduce=h;function*v(D,_,L=D.length){for(_<0&&(_+=D.length),L<0?L+=D.length:L>D.length&&(L=D.length);_<L;_++)yield D[_]}b.slice=v;function S(D,_=Number.POSITIVE_INFINITY){let L=[];if(_===0)return[L,D];let Z=D[Symbol.iterator]();for(let Se=0;Se<_;Se++){let ie=Z.next();if(ie.done)return[L,b.empty()];L.push(ie.value)}return[L,{[Symbol.iterator](){return Z}}]}b.consume=S})(yA||={});var MV=null;function OV(r){MV=r}function KV(r){return MV?.push(r),r}function G(r){if(yA.is(r)){for(let e of r)if(e)try{e.dispose()}catch(t){console.warn(`dispose() failed for ${e}`,t)}return Array.isArray(r)?[]:r}else if(r)return r.dispose(),r}var qo=class r{constructor(...e){this._toDispose=new Set;this._isDisposed=!1;e.forEach(t=>this.add(t)),KV(this)}static{this.DISABLE_DISPOSED_WARNING=!1}dispose(){this._isDisposed||(this._isDisposed=!0,this.clear())}get isDisposed(){return this._isDisposed}clear(){if(this._toDispose.size!==0)try{G(this._toDispose)}finally{this._toDispose.clear()}}add(e){if(!e)return e;if(e===this)throw new Error("Cannot register a disposable on itself!");return this._isDisposed?r.DISABLE_DISPOSED_WARNING||console.warn(new Error("Trying to add a disposable to a DisposableStore that has already been disposed of. The added object will be leaked!").stack):this._toDispose.add(e),e}},Mr=class{constructor(...e){this._store=new qo;this._isDisposed=!1;e.forEach(t=>this._store.add(t)),KV(this)}get isDisposed(){return this._isDisposed}dispose(){this._store.dispose(),this._isDisposed=!0}_register(e){if(e===this)throw new Error("Cannot register a disposable on itself!");return this._store.add(e)}},Ik=class extends Mr{constructor(){super();this._onDidDispose=new AV.EventEmitter,this.onDidDispose=this._onDidDispose.event}dispose(){super.dispose(),this._onDidDispose.fire(),this._onDidDispose.dispose()}};var NV=class{constructor(){this._store=new Map;this._isDisposed=!1}dispose(){this._isDisposed=!0,this.clearAndDisposeAll()}clearAndDisposeAll(){if(this._store.size)try{G(this._store.values())}finally{this._store.clear()}}has(e){return this._store.has(e)}get(e){return this._store.get(e)}set(e,t,n=!1){this._isDisposed&&console.warn(new Error("Trying to add a disposable to a DisposableMap that has already been disposed of. The added object will be leaked!").stack),n||this._store.get(e)?.dispose(),this._store.set(e,t)}deleteAndDispose(e){this._store.get(e)?.dispose(),this._store.delete(e)}[Symbol.iterator](){return this._store[Symbol.iterator]()}};var hp=class r{constructor(e){this.serverSettings=e;this.kernelSpecManager=new this.jupyterlab.KernelSpecManager({serverSettings:this.serverSettings}),this.kernelManager=new this.jupyterlab.KernelManager({serverSettings:this.serverSettings}),this.sessionManager=new this.jupyterlab.SessionManager({serverSettings:this.serverSettings,kernelManager:this.kernelManager}),this.contentsManager=new this.jupyterlab.ContentsManager({serverSettings:this.serverSettings})}get isDisposed(){return this.disposed===!0}get jupyterlab(){return this._jupyterlab||(this._jupyterlab=require("@jupyterlab/services")),this._jupyterlab}static create(e){return new r(e)}async dispose(){if(!this.disposed){this.disposed=!0,w("Disposing Jupyter Lab Helper");try{this.contentsManager&&(w("SessionManager - dispose contents manager"),this.contentsManager.dispose()),this.sessionManager&&!this.sessionManager.isDisposed&&(w("ShutdownSessionAndConnection - dispose session manager"),await Dr(1e4,this.sessionManager.ready),this.sessionManager.dispose()),this.kernelManager?.isDisposed||this.kernelManager?.dispose(),this.kernelSpecManager?.isDisposed||this.kernelSpecManager?.dispose()}catch(e){C("Exception on Jupyter Lab Helper shutdown: ",e)}finally{w("Finished disposing Jupyter Lab Helper")}}}async getRunningSessions(){if(!this.sessionManager)return[];await Dr(1e4,this.sessionManager.ready).catch(m),await this.sessionManager.refreshRunning();let e=[],t=this.sessionManager.running(),n=t.next();for(;n;)e.push(n),n=t.next();return e}async getRunningKernels(){let e=await this.jupyterlab.KernelAPI.listRunning(this.serverSettings),t=new Set;return e.map(n=>{let i=n;return{id:n.id,name:n.name,lastActivityTime:i.last_activity?new Date(Date.parse(i.last_activity.toString())):new Date,numberOfConnections:i.connections?parseInt(i.connections.toString(),10):0}}).filter(n=>t.has(n.id)?!1:(t.add(n.id),!0))}async getKernelSpecs(){if(!this.serverSettings||!this.sessionManager||!this.contentsManager)throw new Sn;try{let e=new $e,t=this.kernelSpecManager;if(!t)return C(`No SessionManager to enumerate kernelspecs (no specs manager). Returning a default kernel. Specs ${JSON.stringify(this.kernelSpecManager?.specs?.kernelspecs||{})}.`),R("DATASCIENCE.JUPYTER_KERNEL_SPEC_FETCH_FAILURE",void 0,{failed:!0,reason:"NoSpecsManager"}),[await Ia()];let n={wasSessionManagerReady:this.sessionManager.isReady,wasSpecsManagerReady:t.isReady,sessionManagerReady:this.sessionManager.isReady,specsManagerReady:t.isReady,waitedForChangeEvent:!1},i=(l={})=>t.specs&&Object.keys(t.specs.kernelspecs).length?t.specs.kernelspecs:l,o=i();await Dr(1e4,this.sessionManager.ready),n.sessionManagerReady=this.sessionManager.isReady,await Dr(1e4,t.refreshSpecs()),n.specsManagerReady=t.isReady;let s=!1;if(t&&Object.keys(t.specs?.kernelspecs||{}).length===0){let l=[],c=pe(),u=c.resolve.bind(c);t.specsChanged.connect(u),l.push(new FV.Disposable(()=>t.specsChanged.disconnect(u)));let d=Promise.all([c.promise,t.ready,t.refreshSpecs(),this.sessionManager.ready]);await Dr(1e4,d),n.waitedForChangeEvent=!0,c.completed||(s=!0,R("DATASCIENCE.JUPYTER_KERNEL_SPEC_FETCH_FAILURE",void 0,{failed:!0,sessionManagerReady:this.sessionManager.isReady,specsManagerReady:t.isReady,reason:t.isReady?this.sessionManager.isReady?"SpecsDidNotChangeInTime":"SessionManagerIsNotReady":"SpecManagerIsNotReady"})),G(l)}let a=i(o);if(Object.keys(a||{}).length){let l=[];return Object.entries(a).forEach(([c,u])=>{u&&l.push(new dp(u))}),R("DATASCIENCE.JUPYTER_KERNEL_SPEC_FETCH_FAILURE",{duration:e.elapsedTime},n),l}else return C(`Jupyter Lab Helper cannot enumerate kernelspecs. Returning a default kernel. Specs ${JSON.stringify(a)}.`),s||R("DATASCIENCE.JUPYTER_KERNEL_SPEC_FETCH_FAILURE",void 0,{failed:!0,reason:"NoSpecsEventAfterRefresh"}),[await Ia()]}catch(e){return C("Jupyter Lab Helper:getKernelSpecs failure: ",e),[]}}};var Dn=class{constructor(e,t,n,i,o,s){this.jupyterPickerRegistration=e;this.applicationShell=t;this.configService=n;this.errorHandler=i;this.requestAgentCreator=o;this.requestCreator=s}async createConnectionInfo(e){let t=await this.getJupyterServerUri(e);if(!t)throw new Error(`Unable to get resolved server information for ${e.extensionId}:${e.id}:${e.handle}`);let n={baseUrl:t.connectionInformation.baseUrl.toString(!0),displayName:t.label,token:t.connectionInformation.token||"",authorizationHeader:t.connectionInformation.headers||{},fetch:t.connectionInformation.fetch,mappedRemoteNotebookDir:void 0,WebSocket:t.connectionInformation.WebSocket,webSocketProtocols:t.connectionInformation?.webSocketProtocols};return nx(e,n,this.requestCreator,this.requestAgentCreator,this.configService,fx.Uri.file(""))}async validateRemoteUri(e,t,n){let i;if(!t){let s=await this.getJupyterServerUri(e);if(s)t={baseUrl:s.connectionInformation.baseUrl.toString(!0),displayName:s.label,token:s.connectionInformation.token||"",authorizationHeader:s.connectionInformation.headers||{},fetch:s.connectionInformation.fetch,mappedRemoteNotebookDir:void 0,WebSocket:s.connectionInformation.WebSocket,webSocketProtocols:s.connectionInformation?.webSocketProtocols};else throw new Error(`Unable to get resolved server information for ${e.extensionId}:${e.id}:${e.handle}`)}let o=nx(e,t,this.requestCreator,this.requestAgentCreator,this.configService,fx.Uri.file(""));try{i=hp.create(o.settings),await Promise.all([i.getRunningKernels(),i.getKernelSpecs()])}catch(s){if(Vo.isSelfCertsError(s)){if(!await Jw(this.applicationShell,this.configService,s.message))throw s}else if(Cl.isSelfCertsExpiredError(s)){if(!await $w(this.applicationShell,this.configService,s.message))throw s}else throw t&&!n&&await this.errorHandler.handleError(new Wi(t.baseUrl,e,s)),s}finally{o.dispose(),i&&i.dispose().catch(m)}}async getJupyterServerUri(e){let t=new fx.CancellationTokenSource;try{let n=this.jupyterPickerRegistration.jupyterCollections.find(l=>l.extensionId===e.extensionId&&l.id===e.id)||await this.jupyterPickerRegistration.activateThirdPartyExtensionAndFindCollection(e.extensionId,e.id);if(!n)return;let o=(await Promise.resolve(n.serverProvider.provideJupyterServers(t.token)))?.find(l=>l.id===e.handle);if(!o)return;if(o.connectionInformation)return o;let s=await Promise.resolve(n.serverProvider.resolveJupyterServer(o,t.token));if(!s?.connectionInformation)return;let a=Object.assign({},o);return a.connectionInformation=s.connectionInformation,a}catch(n){throw n instanceof tt?n:new ap(e,n)}finally{t.dispose()}}};Dn=g([(0,Sa.injectable)(),p(0,(0,Sa.inject)(Ut)),p(1,(0,Sa.inject)(ue)),p(2,(0,Sa.inject)(se)),p(3,(0,Sa.inject)(an)),p(4,(0,Sa.inject)(ip)),p(4,(0,Sa.optional)()),p(5,(0,Sa.inject)(Kc))],Dn);var Jo=class{constructor(e,t,n,i,o){this.serverUriStorage=e;this.jupyterConnection=t;this.workspaceService=n;this.disposableRegistry=i;this.serverProviderRegistry=o}async addJupyterServer(e){try{await this.jupyterConnection.validateRemoteUri(e)}catch(t){C(`Error in validating the Remote Uri ${e.id}.${e.handle}`,t);return}if(e.extensionId===bt&&e.id===jd){await this.serverUriStorage.add(e);return}![bt].includes(e.extensionId)&&!this.serverProviderRegistry.jupyterCollections.some(t=>t.extensionId===e.extensionId)&&await this.serverUriStorage.add(e)}};Jo=g([(0,gp.injectable)(),p(0,(0,gp.inject)(cr)),p(1,(0,gp.inject)(Dn)),p(2,(0,gp.inject)(ce)),p(3,(0,gp.inject)(O)),p(4,(0,gp.inject)(Ut))],Jo);var LV=" (Interactive)",xt=Symbol("IControllerRegistration");var Sk=Symbol("IRemoteNotebookKernelSourceSelector"),xk=Symbol("ILocalNotebookKernelSourceSelector"),hx=Symbol("ILocalPythonNotebookKernelSourceSelector"),vp=Symbol("IConnectionDisplayData");async function Ck(r){if(!ph()&&r.interpreter?.uri){let e=r.interpreter.uri.fsPath,t=Pl(r.interpreter.uri).fsPath,n=r.id.replace(e,t);return ht(n)}return ht(r.id)}var Rs=class{static fromJSON(e){let t=Object.assign(e,{});switch(t.interpreter&&(t.interpreter=cx(t.interpreter,"")),e.kind){case"startUsingLocalKernelSpec":return Al.create(t);case"connectToLiveRemoteKernel":return gx.create(t);case"startUsingRemoteKernelSpec":return vx.create(t);case"startUsingPythonInterpreter":return $o.create(t);default:throw new Error(`Invalid object to be deserialized into a connection, kind = ${t.kind}`)}}},gx=class r{constructor(e){this.kind="connectToLiveRemoteKernel";this.kernelModel=e.kernelModel,this.interpreter=e.interpreter,this.baseUrl=e.baseUrl,this.id=e.id,this.serverProviderHandle=e.serverProviderHandle,wk(this)}static create(e){return new r(e)}updateModel(e){Object.assign(this.kernelModel,e)}getHashId(){return Ck(this)}toJSON(){return{id:this.id,kind:this.kind,baseUrl:this.baseUrl,interpreter:Lc(this.interpreter),kernelModel:this.kernelModel,serverProviderHandle:this.serverProviderHandle}}static fromJSON(e){return Rs.fromJSON(e)}},Al=class r{constructor(e){this.kind="startUsingLocalKernelSpec";this.kernelSpec=e.kernelSpec,this.interpreter=e.interpreter,this.id=e.id,wk(this)}static create(e){return new r(e)}getHashId(){return Ck(this)}toJSON(){return{id:this.id,kernelSpec:this.kernelSpec,interpreter:Lc(this.interpreter),kind:this.kind}}static fromJSON(e){return Rs.fromJSON(e)}},vx=class r{constructor(e){this.kind="startUsingRemoteKernelSpec";this.interpreter=e.interpreter,this.kernelSpec=e.kernelSpec,this.baseUrl=e.baseUrl,this.id=e.id,this.serverProviderHandle=e.serverProviderHandle,wk(this)}static create(e){return new r(e)}getHashId(){return Ck(this)}toJSON(){return{id:this.id,kernelSpec:this.kernelSpec,interpreter:Lc(this.interpreter),baseUrl:this.baseUrl,kind:this.kind,serverProviderHandle:this.serverProviderHandle}}static fromJSON(e){return Rs.fromJSON(e)}},$o=class r{constructor(e){this.kind="startUsingPythonInterpreter";this.kernelSpec=e.kernelSpec,this.interpreter=e.interpreter,this.id=e.id,wk(this)}static create(e){return new r(e)}getHashId(){return Ck(this)}toJSON(){return{id:this.id,kernelSpec:this.kernelSpec,interpreter:Lc(this.interpreter),kind:this.kind}}updateInterpreter(e){Object.assign(this.interpreter,e)}static fromJSON(e){return Rs.fromJSON(e)}};function mt(r){return r.kind==="startUsingLocalKernelSpec"||r.kind==="startUsingPythonInterpreter"}function Ft(r){return!mt(r)}var Ke=Symbol("IKernelProvider"),um=Symbol("IThirdPartyKernelProvider");var Ek=Symbol("IJupyterServerConnector"),yx=Symbol("IKernelSessionFactory");var Ns=Symbol("IKernelDependencyService"),Wr=Symbol("IKernelFinder"),tg=Symbol("ITracebackFormatter");var xa=Symbol("IStartupCodeProviders"),UV=new Set;function wk(r){if(UV.has(r.id))return;UV.add(r.id);let e="kernelSpec"in r?r.kernelSpec:void 0,t=e?.language||(r.kind==="startUsingPythonInterpreter"?xe:void 0),n="",i="",o="interpreter"in r?r.interpreter:void 0,s="<#>",a;e&&Array.isArray(e.argv)&&e.argv.length>0&&(n=e.argv[0],a=n.toLowerCase()===o?.uri?.fsPath?.toLowerCase(),Te(n)!==n&&(n=`<P>${Te(n)}`),i=e.argv.map(h=>h.includes("/")||h.includes("\\")?`<P>${Te(h)}`:h).join(s));let l="kernelSpec"in r&&r.kernelSpec.specFile?ht(r.kernelSpec.specFile):Promise.resolve(""),c=ht(r.id),u=Ft(r)?ht($t(r.serverProviderHandle)):Promise.resolve(""),d=Ft(r)?r.serverProviderHandle.extensionId:bt,f=Ft(r)?ht(r.baseUrl.toLowerCase()):Promise.resolve("");Promise.all([l,c,u,f]).then(([h,v,S,b])=>R("DS_INTERNAL.JUPYTER_KERNEL_SPEC",void 0,{kernelId:v,serverIdHash:S,kernelSpecHash:h,baseUrlHash:b,providerExtensionId:d,kernelConnectionType:r.kind,kernelLanguage:t,envType:o?.envType,isArgv0SameAsInterpreter:a,argv0:n,argv:i})).catch(m)}var Ml=require("vscode");var jV=k(A());var WV=require("events"),bx=k(A());try{(0,bx.decorate)((0,bx.injectable)(),WV.EventEmitter)}catch(r){J("Failed to decorate EventEmitter for DI (possibly already decorated by another Extension)",r)}var Xe=class{constructor(e){this.container=e;Xe._instance=this}static get instance(){return Xe._instance}get(e,t){return t?this.container.getNamed(e,t):this.container.get(e)}getAll(e,t){return t?this.container.getAllNamed(e,t):this.container.getAll(e)}tryGet(e,t){try{return t?this.container.getNamed(e,t):this.container.get(e)}catch{}}};Xe=g([(0,bx.injectable)()],Xe);var yp=require("vscode");function br(r,e=!1){return typeof r!="object"||!r?!1:!!(r instanceof yp.CancellationError||e&&(r.message.includes("Canceled")||r.message.includes(ye.canceled)))}async function Gt(r,e,...t){let n;return ME(e)?(t.push(e),n=void 0):n=e,r?r.isCancellationRequested?n:new Promise((i,o)=>{if(r.isCancellationRequested)return i(n);let s=r.onCancellationRequested(()=>{s.dispose(),i(n)});Promise.race(t).then(i,o).finally(()=>s.dispose())}):await Promise.race(t)}async function pr(r,...e){if(!r)return Promise.race(e);if(r.isCancellationRequested)throw new yp.CancellationError;return new Promise((t,n)=>{if(r.isCancellationRequested)return n(new yp.CancellationError);let i=r.onCancellationRequested(()=>{i.dispose(),n(new yp.CancellationError)});Promise.race(e).then(t,n).finally(()=>i.dispose())})}function kk(...r){let e=new yp.CancellationTokenSource,t=[];for(let i of r)i&&(i.isCancellationRequested&&e.cancel(),i.onCancellationRequested(()=>e.cancel(),void 0,t));let n=e.dispose.bind(e);return e.dispose=()=>{n(),G(t)},e}var Cn;(e=>{function r(t){if(t?.isCancellationRequested)throw new yp.CancellationError}e.throwIfCanceled=r})(Cn||={});function ng(r,e,t){return e.jupyterCollections.find(i=>i.extensionId===r.extensionId&&i.id===r.id)?.label||t||`${r.id}:${r.handle}`}function VV(r){let e=new Map,t=(a,l)=>{if(!e.has(a)){let c={id:a,label:l.displayName,connectionInformation:{baseUrl:Ml.Uri.parse(l.baseUrl),token:l.token,fetch:l.fetch,headers:l.authorizationHeader,WebSocket:l.WebSocket,webSocketProtocols:l.webSocketProtocols}};e.set(a,{serverUri:l,server:c})}return e.get(a).server},n=new Ml.EventEmitter,i={async provideJupyterServers(a){let l=r.getHandles?await pr(a,r.getHandles()):[];return!l||l.length===0?[]:pr(a,Promise.all(l.map(c=>r.getServerUri(c).then(u=>t(c,u)))))},resolveJupyterServer(a,l){return a},onDidChangeServers:n.event};if(!r.handleQuickPick||!r.getQuickPickEntryItems)return{serverProvider:i};let o=new Map;return{serverProvider:i,commandProvider:{async handleCommand(a,l){let c=o.get(a.label);if(!c||!r.handleQuickPick)return;let u=await pr(l,r.handleQuickPick(c,!0));if(u==="back")return;if(!u)throw new Ml.CancellationError;let d=await r.getServerUri(u);return t(u,d)},async provideCommands(a,l){return r.getQuickPickEntryItems?(await pr(l,Promise.resolve(r.getQuickPickEntryItems()))).map(u=>{let d={label:dh(u.label),canBeAutoSelected:u.default,description:dh(u.description)};return o.set(d.label,u),d}):[]}}}}var bA=class extends Ik{constructor(t,n,i,o){super();this.extensionId=t;this.id=n;this.label=i;this.serverProvider=o;this._onDidChangeProvider=new Ml.EventEmitter;this.onDidChangeProvider=this._onDidChangeProvider.event}set commandProvider(t){this._commandProvider=t,this._onDidChangeProvider.fire()}get commandProvider(){return this._commandProvider}},rg=class extends Mr{constructor(){super();this._onDidChangeCollections=new Ml.EventEmitter;this._collections=new Map;Xe.instance.get(O).push(this)}get onDidChangeCollections(){return this._onDidChangeCollections.event}get jupyterCollections(){return Array.from(this._collections.values())}async activateThirdPartyExtensionAndFindCollection(t,n){return await this.loadExtension(t,n).catch(m),this.jupyterCollections.find(i=>i.extensionId===t&&i.id===n)}async loadExtension(t,n){if(t===bt)return;let i=Ml.extensions.getExtension(t);if(!i)throw new Error(`Extension '${t}' that provides Jupyter Server '${n}' not found`);i.isActive||await i.activate().then(m,m)}createJupyterServerCollection(t,n,i,o){let s=`${t}#${n}`;if(this._collections.has(s)&&t!==bt)throw new Error(`Jupyter Server Provider with id ${s} already exists`);let a=new bA(t,n,i,o);return this._collections.set(s,a),this._onDidChangeCollections.fire({added:[a],removed:[]}),this._register(a.onDidDispose(()=>{this._collections.delete(s),this._onDidChangeCollections.fire({removed:[a],added:[]})},this)),a}};rg=g([(0,jV.injectable)()],rg);var ji=require("vscode");function pm(r){return(e,t=null,n)=>{let i=!1,o;return o=r(s=>{if(!i)return o?o.dispose():i=!0,e.call(t,s)},null,n),i&&o.dispose(),o}}function IA(r,e=null,t){return new Promise(n=>pm(r)(n,e,t))}var xA=class{constructor(e,t){let n=ji.extensions.getExtension(e)?.packageJSON?.displayName||e;this.notebook=ji.workspace.notebookDocuments.find(i=>i.uri.toString()===t.resourceUri?.toString()),this.controllerDisplayName=gt(t.kernelConnectionMetadata),this.title=ji.l10n.t("Executing code in {0} from {1}",this.controllerDisplayName,n),this.eventHandler=ji.window.onDidChangeVisibleNotebookEditors(this.showProgressImpl,this)}dispose(){this.eventHandler.dispose(),this.disposable?.dispose()}show(){if(this.deferred&&!this.deferred.completed){let e=this.deferred;return this.deferred=pe(),e.resolve(),this.disposable=new ji.Disposable(()=>this.deferred?.resolve())}return this.deferred=pe(),this.showProgress().catch(m),this.disposable=new ji.Disposable(()=>this.deferred?.resolve())}async showProgress(){await Vn(500),!(!this.deferred||this.deferred.completed||this.displayInProgress)&&(this.shouldDisplayProgress=!0,await Promise.all([this.showProgressImpl(),this.waitUntilCompleted()]),this.shouldDisplayProgress=!1)}async showProgressImpl(){!this.notebook||!this.shouldDisplayProgress||ji.window.visibleNotebookEditors.some(e=>e.notebook===this.notebook)&&(this.displayInProgress=!0,await ji.window.withProgress({location:ji.ProgressLocation.Notification,title:this.title},async()=>this.waitUntilCompleted()),this.displayInProgress=!1)}async waitUntilCompleted(){let e=this.deferred;for(;e&&!e.completed;)await e.promise,e=this.deferred}},CA=class r extends Mr{constructor(t,n,i,o){super();this.extensionId=t;this.kernel=n;this.execution=i;this.kernelAccess=o;this.progress=this._register(new xA(t,n)),this._register(pm(n.onDisposed)(()=>this.progress.dispose())),this.language=n.kernelConnectionMetadata.kind==="connectToLiveRemoteKernel"?xe:n.kernelConnectionMetadata.kernelSpec.language||xe,this._api=Object.freeze({language:this.language,executeCode:(s,a)=>this.executeCode(s,a)})}static createApiKernel(t,n,i,o){let s=new r(t,n,i,o);return Xe.instance.get(O).push(s),s._api}async*executeCode(t,n){if(!this.kernelAccess.accessAllowed)throw new Error(ji.l10n.t("Access to Jupyter Kernel has been revoked"));this.previousProgress?.dispose();let i=!1,o={executionCount:this.execution.executionCount,requestSentAfter:0,requestAcknowledgedAfter:0,cancelledAfter:0,duration:0},s={kernelId:"",extensionId:this.extensionId,cancelled:!1,requestSent:!1,requestAcknowledged:!1,cancelledBeforeRequestSent:!1,cancelledBeforeRequestAcknowledged:!1,mimeTypes:"",failed:!1},a=new $e,l=new Set;if(fse(this.extensionId,this.kernel,"executeCode",o.executionCount).catch(m),this.kernel.disposed)throw s.failed=!0,SA(this.kernel,o,s).catch(m),new Error("Kernel is disposed");if(!this.kernel.session?.kernel)throw s.failed=!0,SA(this.kernel,o,s).catch(m),this.kernel.status==="dead"||this.kernel.status==="terminating"?new Error("Kernel is dead or terminating"):new Error("Kernel connection not available to execute 3rd party code");let c=[],u=pe();c.push({dispose:()=>{o.duration=a.elapsedTime,s.mimeTypes=Array.from(l).join(","),i=!0,u.resolve(),SA(this.kernel,o,s).catch(m)}});let d=Xe.instance.get(Ke).getKernelExecution(this.kernel),f=[],h=pe();for(d.executeCode(t,this.extensionId,n).then(v=>{v.result.finally(()=>G(c)).catch(m),v.onRequestSent(()=>{if(s.requestSent=!0,o.requestSentAfter=a.elapsedTime,!n.isCancellationRequested){let S=this.previousProgress=this.progress.show();c.push(S)}},this,c),v.onRequestAcknowledged(()=>{s.requestAcknowledged=!0,o.requestAcknowledgedAfter=a.elapsedTime},this,c),v.onDidEmitOutput(S=>{S.forEach(b=>l.add(b.mime)),f.push(S),h.resolve(),h=pe()},this,c)}).catch(v=>{C(`Extension ${this.extensionId} failed to execute code in kernel ${this.extensionId}`,v)}),n.onCancellationRequested(()=>{i||(s.cancelled=!0,o.cancelledAfter=a.elapsedTime,s.cancelledBeforeRequestSent=!s.requestSent,s.cancelledBeforeRequestAcknowledged=!s.requestAcknowledged,w(`Code execution cancelled by extension ${this.extensionId}`))},this,c);;){for(await Promise.race([h.promise,u.promise]),h.completed&&(h=pe());f.length;)yield f.shift();if(u.completed)break}}};async function fse(r,e,t,n){let i=await ht(e.id);R("DATASCIENCE.JUPYTER_NEW_KERNEL_API_USAGE",{executionCount:n},{kernelId:i,pemUsed:t,extensionId:r})}async function SA(r,e,t){t.kernelId=await ht(r.id),R("DATASCIENCE.JUPYTER_NEW_KERNEL_API_EXEC",e,t)}function BV(r,e,t){let n=Xe.instance.get(Ke);return CA.createApiKernel(r,e,n.getKernelExecution(e),t)}var Jn=require("vscode");var ig=new Map,qV=new Set;async function JV(r){if(!Jn.workspace.isTrusted)return{accessAllowed:!1};if(r===bt)return{accessAllowed:!0};let e=ig.get(r);return e||(e=hse(r),ig.set(r,e),e.then(({result:t})=>{(t==="learnMore"||t==="cancelled")&&ig.get(r)===e&&(ig.delete(r),qV.add(r))})),e.then(({result:t})=>({accessAllowed:t==="allowed"}))}async function hse(r){let e=await EA();if(e.get(r)===!0)return{result:"allowed"};if(e.get(r)===!1)return{result:"denied"};let t=Jn.extensions.getExtension(r)?.packageJSON?.displayName;if(!t)return C(`Kernel API access revoked, as extension ${r} does not exist!`),{result:"denied"};let n=Jn.l10n.t("Allow"),i=Jn.l10n.t("Deny"),o=await Jn.window.showInformationMessage(Jn.l10n.t("Do you want to grant Kernel access to the extension {0} ({1})?",t,r),{modal:!0,detail:Jn.l10n.t("This allows the extension to execute code against Jupyter Kernels.")},n,ye.learnMore,i);switch(o===ye.learnMore?Jn.env.openExternal(Jn.Uri.parse("https://aka.ms/vscodeJupyterKernelApiAccess")).then(m,m):(o===n||o===i)&&await gse(r,o===n),o){case n:return{result:"allowed"};case ye.learnMore:return{result:"learnMore"};case i:return{result:"denied"};default:return{result:"cancelled"}}}async function $V(){let r=new Set,[e]=await Promise.all([EA().then(t=>new Map(t)),...Array.from(ig.entries()).map(async([t,n])=>{(await n).result!=="allowed"&&r.add(t)})]);return r.forEach(t=>e.set(t,!1)),qV.forEach(t=>e.set(t,e.get(t)===!0)),e}var Pk="API.Access",bp;async function EA(r=!1){let e=Xe.instance.get(dt);if(e.extensionMode===Jn.ExtensionMode.Test)return new Map;if(ux(()=>{Xe.instance.get(O).push(e.secrets.onDidChange(i=>{i.key===Pk&&(bp=void 0)}))})(),bp&&!r)return bp;let t="";try{return t=await e.secrets.get(Pk),!t||t.length===0?new Map:(bp=new Map(Object.entries(JSON.parse(t))),bp)}catch(n){return C(`Failed to parse API access information ${t}`,n),new Map}}var Dk=Promise.resolve();async function HV(r){return Dk=Dk.then(async()=>{await Promise.all(Array.from(ig.entries()).map(async([t,n])=>{let i=await n;i.result=r.includes(t)===!0?"allowed":"denied"})),bp=new Map(r.map(t=>[t,!0]));let e=Xe.instance.get(dt);if(e.extensionMode!==Jn.ExtensionMode.Test)try{await e.secrets.store(Pk,JSON.stringify(Object.fromEntries(bp)))}catch(t){C(`Failed to update API access information ${JSON.stringify(Object.fromEntries(bp))}`,t)}})}async function gse(r,e){return Dk=Dk.then(async()=>{let t=Xe.instance.get(dt);if(t.extensionMode===Jn.ExtensionMode.Test)return;let n=await EA(!0);if(e!==n.get(r)){n.set(r,e);try{await t.secrets.store(Pk,JSON.stringify(Object.fromEntries(n)))}catch(i){C(`Failed to store API access information ${JSON.stringify(Object.fromEntries(n))}`,i)}}})}var GV=new WeakMap;function zV(r){return{async getKernel(e){let t,n=Xe.instance.get(Ke),o=Xe.instance.get(qe).notebookDocuments.find(u=>u.uri.toString()===e.toString()),s=n.get(o||e);if(!s||!s.startedAtLeastOnce){R("DATASCIENCE.JUPYTER_NEW_KERNELS_API_USAGE",void 0,{extensionId:r,pemUsed:"getKernel",accessAllowed:t});return}let a=n.getKernelExecution(s);if(!Ft(s.kernelConnectionMetadata)&&a.executionCount===0){R("DATASCIENCE.JUPYTER_NEW_KERNELS_API_USAGE",void 0,{extensionId:r,pemUsed:"getKernel",accessAllowed:t});return}let l=await JV(r);if(t=l.accessAllowed,R("DATASCIENCE.JUPYTER_NEW_KERNELS_API_USAGE",void 0,{extensionId:r,pemUsed:"getKernel",accessAllowed:t}),!t)return;let c=GV.get(s)||BV(r,s,l);return GV.set(s,c),c}}}var wA=Symbol("IExportedKernelServiceFactory");function vse(r,e){return new Promise(t=>{e.onDidChange(n=>{for(let i of n.added)Ft(i.connection)&&i.connection.serverProviderHandle.id===r.id&&i.connection.serverProviderHandle.handle===r.handle&&t()})})}function QV(r,e,t,n){let i=!1,o=t.get(rr),s=(l,c,u,d)=>{R("DATASCIENCE.JUPYTER_API_USAGE",void 0,{clientExtId:d,pemUsed:"createJupyterServerCollection"});let h=t.get(Ut).createJupyterServerCollection(d,l,dh(c),u);return{dispose:()=>{h?.dispose()},get id(){return l},set label(S){h.label=dh(S)},get label(){return h.label},set documentation(S){h.documentation=S},get documentation(){return h.documentation},set commandProvider(S){h.commandProvider=S},get commandProvider(){return h.commandProvider}}},a={ready:r.catch(l=>(C("Failure during activation.",l),Promise.reject(l))),registerPythonApi:l=>{if(i)return;i=!0,t.get(Xt).setApi(l)},registerRemoteServerProvider(l){C("The API registerRemoteServerProvider has being deprecated and will be removed soon, please use createJupyterServerCollection.");let c=t.get(rr),u=l.id.startsWith("_builtin")?bt:c.determineExtensionFromCallStack().extensionId;R("DATASCIENCE.JUPYTER_API_USAGE",void 0,{clientExtId:u,pemUsed:"registerRemoteServerProvider"});let{serverProvider:d,commandProvider:f}=VV(l),h=s(l.id,l.displayName||l.detail||l.id,d,u);return f&&(h.commandProvider=f),{dispose:()=>{h.dispose()}}},getKernelService:async()=>(R("DATASCIENCE.JUPYTER_API_USAGE",void 0,{clientExtId:o.determineExtensionFromCallStack().extensionId,pemUsed:"registerRemoteServerProvider"}),t.get(wA).getService()),addRemoteJupyterServer:async(l,c)=>{C("The API addRemoteJupyterServer has being deprecated and will be removed soon, please use createJupyterServerCollection.");let u=o.determineExtensionFromCallStack().extensionId;R("DATASCIENCE.JUPYTER_API_USAGE",void 0,{clientExtId:u,pemUsed:"addRemoteJupyterServer"});let d=t.get(Jo),f=t.get(xt),h=vse({id:l,handle:c},f);await d.addJupyterServer({id:l,handle:c,extensionId:u}),await h},openNotebook:async(l,c)=>{R("DATASCIENCE.JUPYTER_API_USAGE",void 0,{clientExtId:o.determineExtensionFromCallStack().extensionId,pemUsed:"openNotebook"});let d=t.get(xt).all.find(h=>h.id===c)?.id;if(!d)throw new Error(`Kernel ${c} not found.`);let f=Ca.window.activeNotebookEditor?.notebook?.uri?.toString()===l.toString()?Ca.window.activeNotebookEditor:await Ca.window.showNotebookDocument(await Ca.workspace.openNotebookDocument(l));return await Ca.commands.executeCommand("notebook.selectKernel",{notebookEditor:f,id:d,extension:bt}),f.notebook},createJupyterServerCollection:(l,c,u)=>s(l,c,u,o.determineExtensionFromCallStack().extensionId),get kernels(){return zV(o.determineExtensionFromCallStack().extensionId)}};return(Pr()||n.extensionMode===Ca.ExtensionMode.Development||n.extensionMode===Ca.ExtensionMode.Test)&&(a.serviceContainer=t,a.serviceManager=e),a}var YV=Symbol("IServiceManager"),ct=Symbol("IServiceContainer");async function XV(r,e,t,n){if(!Pr())try{await r,e.totalActivateTime=t.elapsedTime,await e9(n,e),R("EXTENSION.LOAD",e)}catch(i){C("sendStartupTelemetry() failed.",i)}}async function ZV(r,e,t){try{let n={};if(t)try{await e9(t,e)}catch(i){C("getActivationTelemetryProps() failed.",i)}R("EXTENSION.LOAD",e,n,r)}catch(n){C("sendErrorTelemetry() failed.",n)}}async function e9(r,e){let t=r.get(ce),n=t.hasWorkspaceFolders?t.workspaceFolders.length:0;e.workspaceFolderCount=n}var Tk=Symbol("IExtensionActivationManager"),Ie=Symbol("IExtensionSyncActivationService");var Ul=k(A());var Ol=Symbol("IEnvironmentVariablesService"),Kl=Symbol("ICustomEnvironmentVariablesProvider");var it=Symbol("IInterpreterService");var Nk=k(A()),Fl=require("vscode");var yse={JupyterSessionWaitForIdleSession:y.waitingForJupyterSessionToBeIdle,KernelsGetKernelForRemoteConnection:y.gettingListOfKernelsForRemoteConnection,KernelsGetKernelSpecs:y.gettingListOfKernelSpecs,KernelsRegisterKernel:y.registeringKernel,NotebookConnect:y.connectingToJupyter,NotebookStart:y.startingJupyterNotebook,InstallingMissingDependencies:y.installingMissingDependencies,ExportNotebookToPython:y.exportNotebookToPython,PerformingExport:y.performingExport};function Rk(r){return yse[r]}var ft=class{constructor(e){this.kernelResourceProgressReporter=new Map;e.push(this),ft.instance=this}activate(){}dispose(){G(Array.from(ft.disposables))}static createProgressReporter(e,t,n){if(!ft.instance)return new Fl.Disposable(m);let i=e?ar(e):"";return ft.instance.kernelResourceProgressReporter.has(i)?ft.reportProgress(e,t):ft.createProgressReporterInternal(i,t,n)}static wrapAndReportProgress(e,t,n){let i=e?ar(e):"";if(!ft.instance)return n();let o=ft.reportProgressInternal(i,t);return n().finally(()=>o?.dispose())}static reportProgress(e,t){let n=Rk(t)||t,i=e?ar(e):"";return n?ft.reportProgressInternal(i,n||""):new Fl.Disposable(()=>m)}static reportProgressInternal(e,t){if(!ft.instance)return new Fl.Disposable(m);let n=ft.instance.kernelResourceProgressReporter.get(e);if(n||(n={title:t,pendingProgress:[],progressList:[],dispose:m},ft.instance.kernelResourceProgressReporter.set(e,n)),n.reporter)n.progressList.push(t),n.reporter.report({message:t});else{if(n.progressList.includes(t))return new Fl.Disposable(m);n.pendingProgress.push(t)}return{dispose:()=>{try{if(!n)return;let i=n.progressList.findIndex(o=>o===t);if(i>=0&&n.progressList.splice(i),n.progressList.length>0){let o=n.progressList[n.progressList.length-1];n.reporter&&n.reporter.report({message:o===n.title&&n.reporter?"":o})}else ft.instance.kernelResourceProgressReporter.delete(e),n.dispose()}catch(i){C(`Failed to dispose Progress reporter for ${e}`,i)}}}}static createProgressReporterInternal(e,t,n){let i=pe(),o=new Fl.Disposable(()=>i.resolve()),s=ft.instance.kernelResourceProgressReporter.get(e)||{title:t,pendingProgress:[],progressList:[],tokenSources:[],dispose:()=>{o.dispose()}},a=!1,l=()=>{a||(a=!0,Fl.window.withProgress({location:Fl.ProgressLocation.Notification,title:t},async(c,u)=>{let d=ft.instance.kernelResourceProgressReporter.get(e);if(d){for(d.reporter=c;d.pendingProgress.length>0;){let f=d.pendingProgress.shift();f===t?d.progressList.push(f):f!==t&&f&&(d.progressList.push(f),c.report({message:f}))}await Gt(u,i.promise),ft.instance.kernelResourceProgressReporter.get(e)===d&&ft.instance.kernelResourceProgressReporter.delete(e),ft.disposables.delete(o)}}).then(m,m))};return ft.instance.kernelResourceProgressReporter.set(e,{...s,dispose:()=>o.dispose(),show:l}),ft.disposables.add(o),s.pendingProgress.push(t),n||l(),{dispose:()=>o.dispose(),show:l}}};ft.disposables=new Set,ft=g([(0,Nk.injectable)(),p(0,(0,Nk.inject)(O))],ft);var og=k(A()),Mk=require("vscode");var Ir=Symbol("IPlatformService"),Ze=Symbol("IFileSystem");var kA=class{constructor(e,t){this.Uri=e;this.value=t}},bse,Ak=class r{constructor(e,t){this[bse]="ResourceMap";e instanceof r?(this.map=new Map(e.map),this.toKey=t??r.defaultToKey):(this.map=new Map,this.toKey=e??r.defaultToKey)}static{this.defaultToKey=e=>e.toString()}set(e,t){return this.map.set(this.toKey(e),new kA(e,t)),this}get(e){return this.map.get(this.toKey(e))?.value}has(e){return this.map.has(this.toKey(e))}get size(){return this.map.size}clear(){this.map.clear()}delete(e){return this.map.delete(this.toKey(e))}forEach(e,t){typeof t<"u"&&(e=e.bind(t));for(let[n,i]of this.map)e(i.value,i.Uri,this)}*values(){for(let e of this.map.values())yield e.value}*keys(){for(let e of this.map.values())yield e.Uri}*entries(){for(let e of this.map.values())yield[e.Uri,e.value]}*[(bse=Symbol.toStringTag,Symbol.iterator)](){for(let[,e]of this.map)yield[e.Uri,e.value]}};var LPe=Symbol("IBufferDecoder"),Vi=Symbol("IProcessServiceFactory"),Ix=class extends tt{constructor(e){super("unknown",e)}};var Ll=class{constructor(e,t,n){this.processFactory=e;this.platform=t;this.fs=n;this.userSitePaths=new Ak}async getExecutablesPath(e){let t=e.executable.uri;if(!(tn(e)!=="Unknown"||!t)){if(!this.userSitePaths.has(t)){let n=this.getUserSitePathImpl(t);n.catch(()=>{this.userSitePaths.get(t)===n&&this.userSitePaths.delete(t)}),this.userSitePaths.set(t,n)}return this.userSitePaths.get(t)}}async getUserSitePathImpl(e){let t=await this.processFactory.create(void 0),n="USER_BASE_VALUE",i=this.platform.isWindows?"USER_SITE":"USER_BASE",{stdout:o}=await t.exec(e.fsPath,["-c",`import site;print("${n}");print(site.${i});print("${n}");`]);if(o.includes(n)){let s=o.substring(o.indexOf(n)+n.length,o.lastIndexOf(n)).trim(),a=Mk.Uri.file(s),l;if(this.platform.isWindows?l=Mk.Uri.joinPath(oi(a),"Scripts"):l=Mk.Uri.joinPath(a,"bin"),!l||!this.fs.exists(l))throw new Error(`USER_SITE ${l.fsPath} dir does not exist for the interpreter ${W(e)}`);return w(`USER_SITE for ${W(e)} is ${l.fsPath}`),l}else throw new Error(`USER_SITE not found for the interpreter ${W(e)}. Stdout: ${o}`)}};g([Br()],Ll.prototype,"getExecutablesPath",1),Ll=g([(0,og.injectable)(),p(0,(0,og.inject)(Vi)),p(1,(0,og.inject)(Ir)),p(2,(0,og.inject)(Ze))],Ll);var t9=6e4,Ip=class{constructor(e,t,n,i,o,s,a){this.workspace=e;this.interpreterService=t;this.customEnvVarsService=n;this.apiProvider=i;this.extensionChecker=o;this.envVarsService=s;this.globalExecPaths=a;this.disposables=[];this.activatedEnvVariablesCache=new Map;this.cachedEnvVariables=new Map;this.customEnvVarsService.onDidEnvironmentVariablesChange(this.clearCache,this,this.disposables),this.interpreterService.onDidChangeInterpreter(this.clearCache,this,this.disposables),this.interpreterService.onDidEnvironmentVariablesChange(this.clearCache,this,this.disposables)}clearCache(){this.activatedEnvVariablesCache.clear(),this.cachedEnvVariables.clear()}dispose(){this.disposables.forEach(e=>e.dispose())}async getActivatedEnvironmentVariables(e,t,n){let i=this.interpreterService.known.find(s=>s.id===t.id)||await this.interpreterService.resolveEnvironment(t.id);if(!i)return;let o=y.activatingPythonEnvironment(up(i));return ft.wrapAndReportProgress(e,o,async()=>this.getActivatedEnvironmentVariablesImplWithCaching(e,await this.interpreterService.resolveEnvironment(i)||i,n))}async getActivatedEnvironmentVariablesImplWithCaching(e,t,n){let i=`${e?.toString()||""}${t.id}`,o=this.activatedEnvVariablesCache.get(i);if(o&&o.time.elapsedTime>=t9&&this.activatedEnvVariablesCache.delete(i),!this.activatedEnvVariablesCache.has(i)){let a=this.getActivatedEnvironmentVariablesImpl(e,t,n);a.catch(m),this.activatedEnvVariablesCache.set(i,{promise:a,time:new $e})}let s=this.activatedEnvVariablesCache.get(i).promise;return n?s:Gt(n,s)}async getActivatedEnvironmentVariablesImpl(e,t,n){if(!this.extensionChecker.isPythonExtensionInstalled)return;let i=new $e;return this.getActivatedEnvironmentVariablesFromPython(e,t,n).then(o=>{if(!n?.isCancellationRequested)return o}).catch(o=>{C(`Failed to get env vars with python ${W(t.id)} in ${i.elapsedTime}ms`,o)})}async getActivatedEnvironmentVariablesFromPython(e,t,n){let i=`${e?.toString()||""}${t.id||""}`,o=this.cachedEnvVariables.get(i);if(o&&o.lastRequestedTime.elapsedTime>t9&&this.cachedEnvVariables.delete(i),!this.cachedEnvVariables.has(i)){let s=this.getActivatedEnvironmentVariablesFromPythonImpl(e,t,n);this.cachedEnvVariables.set(i,{promise:s,lastRequestedTime:new $e})}return Gt(n,this.cachedEnvVariables.get(i).promise)}async getActivatedEnvironmentVariablesFromPythonImpl(e,t,n){e=e||(this.workspace.workspaceFolders?.length?this.workspace.workspaceFolders[0].uri:void 0);let i=new $e,o=this.customEnvVarsService.getEnvironmentVariables(e,"RunPythonCode").catch(()=>{}),s="emptyVariables",a,l=await this.apiProvider.getApi().then(u=>u.getActivatedEnvironmentVariables(e,Lc(sk(t,!0)),!1).catch(d=>{C(`Failed to get activated env variables from Python Extension for ${W(t.path)}`,d),s="failedToGetActivatedEnvVariablesFromPython"}));if(n?.isCancellationRequested)return;let c=tn(t);if(R("DS_INTERNAL.GET_ACTIVATED_ENV_VARIABLES",{duration:i.elapsedTime},{envType:c,source:"python",failed:Object.keys(l||{}).length===0,reason:s},a),l?w(`Got env vars with python ${W(t.path)}, with env var count ${Object.keys(l||{}).length} in ${i.elapsedTime}ms. 
    PATH value is ${l.PATH} and 
    Path value is ${l.Path}`):c==="Conda"?C(`Failed to get activated conda env vars for ${W(t.path)}
                 in ${i.elapsedTime}ms`):J(`Failed to get activated env vars for ${W(t.path)} in ${i.elapsedTime}ms`),!l){let u=await o;if(l={},tn(t)==="Conda"){let S=this.interpreterService.known.find(b=>b.id===t.id)?.executable.sysPrefix||(await this.interpreterService.resolveEnvironment(t))?.executable.sysPrefix;S?l.CONDA_PREFIX=S:J(`Failed to get the SysPrefix for the Conda Environment ${W(t.path)}}`)}this.envVarsService.mergeVariables(process.env,l),this.envVarsService.mergeVariables(u,l),this.envVarsService.mergePaths(process.env,l),process.env.PYTHONPATH&&(l.PYTHONPATH=process.env.PYTHONPATH);let d=u?Object.keys(u).find(S=>S.toLowerCase()=="path"):void 0;d&&u[d]&&this.envVarsService.appendPath(l,u[d]),u.PYTHONPATH&&this.envVarsService.appendPythonPath(l,u.PYTHONPATH);let f=await this.globalExecPaths.getExecutablesPath(t).catch(m);if(n?.isCancellationRequested)return;let h=l.PATH||l.Path,v=h?h.split(ii):[];f&&v[1]!==f.fsPath?(w(`Prepend PATH with user site path for ${W(t.path)}, user site ${f.fsPath}`),this.envVarsService.prependPath(l,f.fsPath)):ya(t)||C(`Unable to determine site packages path for python ${W(t.path)} (${tn(t)})`),!l.PATH&&l.Path&&(l.PATH=l.Path)}return w(`Prepend PATH with python bin for ${W(t.path)}`),t.executable.uri&&this.envVarsService.prependPath(l,pt(t.executable.uri.fsPath)),w(`Activated Env Variables for ${W(t.path)}, 
    PATH value is ${l.PATH} and 
    Path value is ${l.Path}`),l}};g([gi("Getting activated env variables",5),p(1,Nc("id"))],Ip.prototype,"getActivatedEnvironmentVariablesImpl",1),g([p(1,Nc("id")),p(2,Xu())],Ip.prototype,"getActivatedEnvironmentVariablesFromPython",1),Ip=g([(0,Ul.injectable)(),p(0,(0,Ul.inject)(ce)),p(1,(0,Ul.inject)(it)),p(2,(0,Ul.inject)(Kl)),p(3,(0,Ul.inject)(Xt)),p(4,(0,Ul.inject)(ze)),p(5,(0,Ul.inject)(Ol)),p(6,(0,Ul.inject)(Ll))],Ip);var As=Symbol("IEnvironmentActivationService");var dm=k(A()),r9=require("vscode");var sg=class{constructor(e,t,n,i){this.vscNotebook=e;this.disposables=t;this.extensionChecker=n;this.pythonApi=i;this._changed=new r9.EventEmitter;this._registered=!1;e.onDidChangeActiveNotebookEditor(()=>{this._changed.fire()},this,t)}activate(){this.extensionChecker.isPythonExtensionActive?this.registerStatusFilter():this.pythonApi.onDidActivatePythonExtension(this.registerStatusFilter,this,this.disposables)}get changed(){return this._changed.event}get hidden(){return!!(this.vscNotebook.activeNotebookEditor&&Dt(this.vscNotebook.activeNotebookEditor.notebook))}registerStatusFilter(){this._registered||(this._registered=!0,this.pythonApi.getApi().then(e=>{e.registerInterpreterStatusFilter&&(e.registerInterpreterStatusFilter(this),this._changed.fire())}).catch(m))}};sg=g([(0,dm.injectable)(),p(0,(0,dm.inject)(qe)),p(1,(0,dm.inject)(O)),p(2,(0,dm.inject)(ze)),p(3,(0,dm.inject)(Xt))],sg);function n9(r){r.addSingleton(Xt,Gh),r.addSingleton(ze,pp),r.addSingleton(it,zh),r.addSingleton(Ie,sg),r.addSingleton(As,Ip)}var Sx=k(A()),DA=require("vscode");var PA=require("vscode"),o9=k(require("os"));var i9=o9.homedir();function mm(r){return process.env[r]}function Sp(){if(en()==="Windows")return PA.Uri.file(mm("USERPROFILE")||i9);let r=mm("HOME")||mm("HOMEPATH")||i9;return PA.Uri.file(r.replace(/\\/g,"/"))}var Ea=k(require("vscode")),Ok=class{constructor(e){this.extensionContext=e}get appName(){return Ea.env.appName}get vscodeVersion(){return Ea.version}get appRoot(){return Ea.env.appRoot}get language(){return Ea.env.language}get sessionId(){return Ea.env.sessionId}get machineId(){return Ea.env.machineId}get uiKind(){return Ea.env.uiKind}get extensionName(){return this.packageJson.displayName}get extensionVersion(){return this.packageJson.version}get shell(){return Ea.env.shell}get packageJson(){return this.extensionContext.extension.packageJSON}get channel(){return this.appName.indexOf("Insider")>0||this.appName.indexOf("Code - OSS Dev")>=0?"insiders":"stable"}get uriScheme(){return Ea.env.uriScheme}};var ag=class extends Ok{constructor(t,n){super(n);this.platform=t;this.homeDir=Sp()||DA.Uri.file("")}get userSettingsFile(){let t=this.channel==="insiders"?"Code - Insiders":"Code";switch(this.platform.osType){case"OSX":return Yt(this.homeDir,"Library","Application Support",t,"User","settings.json");case"Linux":return Yt(this.homeDir,".config",t,"User","settings.json");case"Windows":return process.env.APPDATA?Yt(DA.Uri.file(process.env.APPDATA),t,"User","settings.json"):void 0;default:return}}get userCustomKeybindingsFile(){return RW(this.extensionContext.globalStorageUri,Ue("..","..","keybindings.json"))}};ag=g([(0,Sx.injectable)(),p(0,(0,Sx.inject)(Ir)),p(1,(0,Sx.inject)(dt))],ag);var s9=k(A()),TA=require("vscode");var lg=class{async readText(){return TA.env.clipboard.readText()}async writeText(e){await TA.env.clipboard.writeText(e)}};lg=g([(0,s9.injectable)()],lg);var xx=k(A());var cg=class{constructor(e,t){this.commandManager=e;this.appShell=t}activate(){this.commandManager.registerCommand("jupyter.reloadVSCode",this.onReloadVSCode,this)}async onReloadVSCode(e){await this.appShell.showInformationMessage(e,ye.reload)===ye.reload&&this.commandManager.executeCommand("workbench.action.reloadWindow").then(m,m)}};cg=g([(0,xx.injectable)(),p(0,(0,xx.inject)(Fe)),p(1,(0,xx.inject)(ue))],cg);var a9=k(A()),so=require("vscode");var Wc=class{get activeDebugConsole(){return so.debug.activeDebugConsole}get activeDebugSession(){return te(`Getting active debug session, ${so.debug.activeDebugSession?.name}`),so.debug.activeDebugSession}get breakpoints(){return so.debug.breakpoints}get onDidChangeActiveDebugSession(){return so.debug.onDidChangeActiveDebugSession}get onDidStartDebugSession(){return so.debug.onDidStartDebugSession}get onDidReceiveDebugSessionCustomEvent(){return so.debug.onDidReceiveDebugSessionCustomEvent}get onDidTerminateDebugSession(){return so.debug.onDidTerminateDebugSession}get onDidChangeBreakpoints(){return so.debug.onDidChangeBreakpoints}registerDebugConfigurationProvider(e,t){return so.debug.registerDebugConfigurationProvider(e,t)}registerDebugAdapterTrackerFactory(e,t){return so.debug.registerDebugAdapterTrackerFactory(e,t)}startDebugging(e,t,n){return so.debug.startDebugging(e,t,n)}addBreakpoints(e){so.debug.addBreakpoints(e)}removeBreakpoints(e){so.debug.removeBreakpoints(e)}};Wc.instance=new Wc,Wc=g([(0,a9.injectable)()],Wc);var l9=k(A()),ui=require("vscode");var ug=class{get textDocuments(){return ui.workspace.textDocuments}get activeTextEditor(){return ui.window.activeTextEditor}get visibleTextEditors(){return ui.window.visibleTextEditors}get onDidChangeActiveTextEditor(){return ui.window.onDidChangeActiveTextEditor}get onDidChangeTextDocument(){return ui.workspace.onDidChangeTextDocument}get onDidChangeVisibleTextEditors(){return ui.window.onDidChangeVisibleTextEditors}get onDidChangeTextEditorSelection(){return ui.window.onDidChangeTextEditorSelection}get onDidChangeTextEditorOptions(){return ui.window.onDidChangeTextEditorOptions}get onDidChangeTextEditorViewColumn(){return ui.window.onDidChangeTextEditorViewColumn}get onDidOpenTextDocument(){return ui.workspace.onDidOpenTextDocument}get onDidCloseTextDocument(){return ui.workspace.onDidCloseTextDocument}get onDidSaveTextDocument(){return ui.workspace.onDidSaveTextDocument}showTextDocument(e,t,n){return ui.window.showTextDocument(e,t,n)}openTextDocument(e){return ui.workspace.openTextDocument(e)}applyEdit(e){return ui.workspace.applyEdit(e)}createTextEditorDecorationType(e){return ui.window.createTextEditorDecorationType(e)}};ug=g([(0,l9.injectable)()],ug);var Kk=k(A()),_A=require("vscode");var pg=class{constructor(e){this.extensionContext=e;this.testingState=new Map}async store(e,t,n){if(fi&&this.extensionContext.extensionMode!==_A.ExtensionMode.Production){this.testingState.set(`${e}#${t}`,n||"");return}if(n)await this.extensionContext.secrets.store(`${e}.${t}`,n);else try{await this.extensionContext.secrets.delete(`${e}.${t}`)}catch(i){C(i)}}async retrieve(e,t){if(fi&&this.extensionContext.extensionMode!==_A.ExtensionMode.Production)return this.testingState.get(`${e}#${t}`);try{return await this.extensionContext.secrets.get(`${e}.${t}`)}catch{try{await this.extensionContext.secrets.delete(`${e}.${t}`);return}catch(i){C(i)}}}};pg=g([(0,Kk.injectable)(),p(0,(0,Kk.inject)(dt))],pg);var c9=k(A()),Fk=require("vscode");var dg=class{get all(){return Fk.extensions.all}get onDidChange(){return Fk.extensions.onDidChange}getExtension(e){return Fk.extensions.getExtension(e)}determineExtensionFromCallStack(e){e=e||new Error().stack;try{if(e){let t=this.getExtension(bt).extensionUri.toString().toLowerCase(),n=e.split(`
`).map(i=>{let o=/\((.*)\)/.exec(i);if(o)return o[1]}).filter(i=>i&&!i.toLowerCase().startsWith(t));LN(new Error("Ex")).forEach(i=>{let o=i.getFileName();o&&!o.toLowerCase().startsWith(t)&&n.push(o)});for(let i of n){let o=this.all.find(s=>s.id!==bt&&(i.toLowerCase().startsWith(s.extensionUri.fsPath.toLowerCase())||i.toLowerCase().startsWith(s.extensionUri.path.toLowerCase())));if(o)return{extensionId:o.id,displayName:o.packageJSON.displayName}}}return{extensionId:AS,displayName:y.unknownPackage}}catch(t){return C("Unable to determine the caller of the extension API for trace stack.",e),C("Failure error",t),{extensionId:AS,displayName:y.unknownPackage}}}};dg=g([(0,c9.injectable)()],dg);var u9=k(A()),p9=require("vscode");var mg=class{registerCompletionItemProvider(e,t,...n){return p9.languages.registerCompletionItemProvider(e,t,...n)}};mg=g([(0,u9.injectable)()],mg);var Cx=k(A()),ln=require("vscode");var fm=class{constructor(e,t){this.env=e;this.diposables=t;this._onDidCloseNotebookDocument=new ln.EventEmitter;this.onDidChangeNotebookEditorSelection=ln.window.onDidChangeNotebookEditorSelection,this.onDidChangeActiveNotebookEditor=ln.window.onDidChangeActiveNotebookEditor,this.onDidOpenNotebookDocument=ln.workspace.onDidOpenNotebookDocument,ln.workspace.onDidCloseNotebookDocument(n=>this._onDidCloseNotebookDocument.fire(n),this,this.diposables),this.onDidChangeVisibleNotebookEditors=ln.window.onDidChangeVisibleNotebookEditors,this.onDidSaveNotebookDocument=ln.workspace.onDidSaveNotebookDocument}get onDidCloseNotebookDocument(){return this._onDidCloseNotebookDocument.event}get onDidChangeNotebookCellExecutionState(){return ln.notebooks.onDidChangeNotebookCellExecutionState}get notebookDocuments(){return ln.workspace.notebookDocuments}get notebookEditors(){return ln.window.visibleNotebookEditors}get activeNotebookEditor(){return ln.window.activeNotebookEditor}async openNotebookDocument(e,t){return typeof e=="string"?ln.workspace.openNotebookDocument(e,t):ln.workspace.openNotebookDocument(e)}async showNotebookDocument(e,t){return ln.window.showNotebookDocument(e,t)}registerNotebookSerializer(e,t,n){return ln.workspace.registerNotebookSerializer(e,t,n)}createNotebookController(e,t,n,i,o,s){return ln.notebooks.createNotebookController(e,t,n,i,o)}async closeActiveNotebooks(){let e=new Set(this.notebookDocuments);for(;ln.window.activeNotebookEditor;)e.add(ln.window.activeNotebookEditor.notebook),await ln.commands.executeCommand("workbench.action.revertAndCloseActiveEditor"),await Vn(10);e.forEach(t=>this._onDidCloseNotebookDocument.fire(t))}};g([qu()],fm.prototype,"closeActiveNotebooks",1),fm=g([(0,Cx.injectable)(),p(0,(0,Cx.inject)(An)),p(1,(0,Cx.inject)(O))],fm);var d9=k(A());var fg=class{constructor(){this._list=[]}async dispose(){let e=this._list.map(t=>t.dispose());await Promise.all(e),this._list=[]}push(e){e&&this._list.push(e)}get list(){return this._list}};fg=g([(0,d9.injectable)()],fg);var Vc=k(A()),Nx=k(IB());var mP=class{setSharedProperty(e,t){Lh(e,t)}postEvent(e,t){let n={};t.forEach((i,o)=>{n[o]=i}),R(e,void 0,n)}};var Yce="VSCode.ABExp.FeatureData",AM="vscode",wg=class{constructor(e,t,n,i){this.configurationService=e;this.workspace=t;this.appEnvironment=n;this.globalState=i;this._optInto=[];this._optOutFrom=[];this.settings=e.getSettings(void 0);let o=this.settings.experiments.optInto,s=this.settings.experiments.optOutFrom;if(this._optInto=o.filter(c=>!c.endsWith("control")),this._optOutFrom=s.filter(c=>!c.endsWith("control")),!this.enabled)return;let a;this.appEnvironment.channel==="insiders"?a=Nx.TargetPopulation.Insiders:a=Nx.TargetPopulation.Public;let l=new mP;this.experimentationService=(0,Nx.getExperimentationService)(bt,this.appEnvironment.packageJson.version,a,l,this.globalState)}get enabled(){return this.settings.experiments.enabled&&!this.settings.experiments.optOutFrom.includes("All")}async activate(){this.experimentationService&&this.enabled&&(w(`Experimentation service retrieved: ${this.experimentationService}`),await this.experimentationService.initializePromise,this.getFeatures().length===0&&await this.experimentationService.initialFetch,this.logExperiments())}inExperiment(e){return!this.experimentationService||!this.enabled||this._optOutFrom.includes(e.toString())?!1:this._optInto.includes(e.toString())||this._optInto.includes("All")?(this.experimentationService.getTreatmentVariable(AM,e),!0):e==="KernelCompletions"&&(this.appEnvironment.channel==="insiders"||ES())?!0:this.experimentationService.getTreatmentVariable(AM,e)===!0}async getExperimentValue(e){if(!(!this.experimentationService||!this.enabled||this._optOutFrom.includes(e)))return this.experimentationService.getTreatmentVariable(AM,e)}getFeatures(){return this.globalState.get(Yce,{features:[]}).features}logExperiments(){let e=this.workspace.getConfiguration("telemetry"),t=!1;if(e&&e.get("enableTelemetry")===!1&&(H("Telemetry is disabled"),t=!0),e&&e.get("telemetryLevel")==="off"&&(H("Telemetry level is off"),t=!0),t&&H("Experiments are disabled, only manually opted experiments are active."),this._optOutFrom.includes("All"))return;if(this._optInto.includes("All")){H(tm.inGroup("All"));return}let n=new Set(this._optInto),i=new Set;this._optOutFrom.filter(o=>o!=="All").forEach(o=>{H(tm.notInGroup(o))}),this._optInto.filter(o=>o!=="All").forEach(o=>{i.add(o),H(tm.inGroup(o))}),t&&!i.has("KernelCompletions")&&(this.appEnvironment.channel==="insiders"||ES())&&H(tm.inGroup("KernelCompletions")),t||this.getFeatures().forEach(o=>{o.toLowerCase().startsWith("jupyter")&&!this._optOutFrom.includes(o)&&!this._optInto.includes(o)&&(n.add(o),H(tm.inGroup(o)))})}};wg=g([(0,Vc.injectable)(),p(0,(0,Vc.inject)(se)),p(1,(0,Vc.inject)(ce)),p(2,(0,Vc.inject)(An)),p(3,(0,Vc.inject)(He)),p(3,(0,Vc.named)(It))],wg);var bm=k(A()),CB=require("vscode");var xB=k(A()),fP=require("vscode");function MM(r){fP.env.openExternal(fP.Uri.parse(r)).then(m,m)}var kg=class{launch(e){MM(e)}};kg=g([(0,xB.injectable)()],kg);var Xce=[{doNotDisplayPromptStateKey:"SHOW_DEPRECATED_FEATURE_PROMPT_FORMAT_ON_SAVE",message:QS.SHOW_DEPRECATED_FEATURE_PROMPT_FORMAT_ON_SAVE,moreInfoUrl:"https://github.com/Microsoft/vscode-python/issues/309",setting:{setting:"formatting.formatOnSave",values:["true",!0]}},{doNotDisplayPromptStateKey:"SHOW_DEPRECATED_FEATURE_PROMPT_LINT_ON_TEXT_CHANGE",message:QS.SHOW_DEPRECATED_FEATURE_PROMPT_LINT_ON_TEXT_CHANGE,moreInfoUrl:"https://github.com/Microsoft/vscode-python/issues/313",setting:{setting:"linting.lintOnTextChange",values:["true",!0]}},{doNotDisplayPromptStateKey:"SHOW_DEPRECATED_FEATURE_PROMPT_FOR_AUTO_COMPLETE_PRELOAD_MODULES",message:QS.SHOW_DEPRECATED_FEATURE_PROMPT_FOR_AUTO_COMPLETE_PRELOAD_MODULES,moreInfoUrl:"https://github.com/Microsoft/vscode-python/issues/1704",setting:{setting:"autoComplete.preloadModules"}}],Pg=class{constructor(e,t,n,i){this.persistentStateFactory=e;this.cmdMgr=t;this.workspace=n;this.appShell=i;this._onDidChangeFeatures=new CB.EventEmitter;this.onDidChangeFeatures=this._onDidChangeFeatures.event;this._features={};this.disposables=[];this._updateFeatures(),this.disposables.push(this.workspace.onDidChangeConfiguration(()=>{this._updateFeatures()}))}get features(){return this._features}set features(e){this._features=e,this._onDidChangeFeatures.fire()}_updateFeatures(){this.features={}}dispose(){this.disposables.forEach(e=>e.dispose())}initialize(){Xce.forEach(this.registerDeprecation.bind(this))}registerDeprecation(e){Array.isArray(e.commands)&&e.commands.forEach(t=>{this.disposables.push(this.cmdMgr.registerCommand(t,()=>this.notifyDeprecation(e),this))}),e.setting&&this.checkAndNotifyDeprecatedSetting(e)}async notifyDeprecation(e){let t=this.persistentStateFactory.createGlobalPersistentState(e.doNotDisplayPromptStateKey,!0);if(!t.value)return;let n="Learn more",i="Never show again",o=await this.appShell.showInformationMessage(e.message,n,i);if(o)switch(o){case n:{MM(e.moreInfoUrl);break}case i:{await t.updateValue(!1);break}default:throw new Error("Selected option not supported.")}}checkAndNotifyDeprecatedSetting(e){let t=!1;Array.isArray(this.workspace.workspaceFolders)&&this.workspace.workspaceFolders.length>0?this.workspace.workspaceFolders.forEach(n=>{t||(t=this.isDeprecatedSettingAndValueUsed(this.workspace.getConfiguration("jupyter",n.uri),e.setting))}):t=this.isDeprecatedSettingAndValueUsed(this.workspace.getConfiguration("jupyter"),e.setting),t&&this.notifyDeprecation(e).catch(n=>w("Jupyter Extension: notifyDeprecation",n))}isDeprecatedSettingAndValueUsed(e,t){if(!e.has(t.setting))return!1;let n=e.get(t.setting);return!Array.isArray(t.values)||t.values.length===0?Array.isArray(n)?n.length>0:!0:!Array.isArray(t.values)||t.values.length===0?n===void 0?!1:Array.isArray(n)?n.length>0:!0:t.values.indexOf(e.get(t.setting))>=0}};Pg=g([(0,bm.injectable)(),p(0,(0,bm.inject)(Sl)),p(1,(0,bm.inject)(Fe)),p(2,(0,bm.inject)(ce)),p(3,(0,bm.inject)(ue))],Pg);var gP=k(A());var kB=k(wB());var Dg=class{constructor(e){this.requestOptions={};let t=e.getConfiguration("http").get("proxy","");t&&(this.requestOptions={headers:{proxy:t}})}async downloadFile(e){return kB.fetch(e,this.requestOptions)}async exists(e){try{return(await this.downloadFile(e)).status===200}catch(t){return w(`HttpClient - Failure checking for file ${e}: ${t}`),!1}}};Dg=g([(0,gP.injectable)(),p(0,(0,gP.inject)(ce))],Dg);var Tp=k(A());var vP=class{constructor(e,t,n,i){this.storage=e;this.key=t;this.defaultValue=n;this.expiryDurationMs=i}get value(){if(this.expiryDurationMs){let e=this.storage.get(this.key,{data:this.defaultValue});return!e||!e.expiry||e.expiry<Date.now()?this.defaultValue:e.data}else return this.storage.get(this.key,this.defaultValue)}async updateValue(e){this.expiryDurationMs?await this.storage.update(this.key,{data:e,expiry:Date.now()+this.expiryDurationMs}):await this.storage.update(this.key,e)}},Tg=class{constructor(e,t){this.globalState=e;this.workspaceState=t}createGlobalPersistentState(e,t,n){return new vP(this.globalState,e,t,n)}createWorkspacePersistentState(e,t,n){return new vP(this.workspaceState,e,t,n)}};Tg=g([(0,Tp.injectable)(),p(0,(0,Tp.inject)(He)),p(0,(0,Tp.named)(It)),p(1,(0,Tp.inject)(He)),p(1,(0,Tp.named)(vi))],Tg);var PB="Path",DB="PATH",TB=/^win/.test(process.platform);var yP=k(A()),Mx=require("vscode");var Ae=class r extends Error{static{this.back=new r("back")}static{this.cancel=new r("cancel")}static{this.resume=new r("resume")}},Ox=class{constructor(e){this.shell=e;this.steps=[]}run(e,t){return this.stepThrough(e,t)}async showQuickPick(e){return this.showLazyLoadQuickPick(e).selection}showLazyLoadQuickPick({title:e,step:t,totalSteps:n,items:i,activeItem:o,placeholder:s,buttons:a,shouldResume:l,matchOnDescription:c,matchOnDetail:u,acceptFilterBoxTextAsSelection:d,startBusy:f,stopBusy:h,validate:v,onDidTriggerItemButton:S,onDidTriggerButton:b,supportBackInFirstStep:D,onDidChangeItems:_,ignoreFocusOut:L}){let Z=[],Se=pe(),ie=this.shell.createQuickPick();return ie.title=e,ie.step=t,ie.totalSteps=n,ie.placeholder=s,ie.ignoreFocusOut=L??!0,ie.items=i,h&&(ie.busy=f??!1,h(()=>{ie.enabled&&(ie.busy=!1)},this,Z)),_&&(ie.keepScrollPosition=!0,_(fe=>{ie.items=fe},this,Z)),S&&ie.onDidTriggerItemButton(fe=>S(fe),void 0,Z),ie.matchOnDescription=c||!1,ie.matchOnDetail=u||!1,o?ie.activeItems=[o]:ie.activeItems=[],ie.buttons=[...this.steps.length>1||D?[Mx.QuickInputButtons.Back]:[],...a||[]],Z.push(ie.onDidTriggerButton(fe=>{fe===Mx.QuickInputButtons.Back?Se.reject(Ae.back):b?b(fe):Se.resolve(fe)}),ie.onDidChangeSelection(async fe=>{let de=fe.length?fe[0].label:"",ae=!!de;if(de&&v&&fe.length){ie.enabled=!1,ie.busy=!0;let Me=await v(fe[0]);Me&&(ae=!1,await this.shell.showErrorMessage(Me,{modal:!0})),ie.enabled=!0,ie.busy=!1}ae&&Se.resolve(fe[0])}),ie.onDidHide(()=>{(async()=>{Se.reject(l&&await l()?Ae.resume:Ae.cancel)})().catch(Se.reject)})),d&&Z.push(ie.onDidAccept(async()=>{if(!ie.busy){let fe=v?await v(ie):void 0;fe?(ie.enabled=!1,ie.busy=!0,await this.shell.showErrorMessage(fe),ie.enabled=!0,ie.busy=!1):Se.resolve(ie.value)}})),this.current&&this.current.dispose(),this.current=ie,this.current.show(),Se.promise.finally(()=>G(Z)).catch(m),{quickPick:ie,selection:Se.promise}}async showInputBox({title:e,step:t,totalSteps:n,value:i,prompt:o,validate:s,password:a,buttons:l,shouldResume:c,validationMessage:u}){let d=[];try{return await new Promise((f,h)=>{let v=this.shell.createInputBox();v.title=e,v.step=t,v.totalSteps=n,v.password=!!a,v.value=i||"",v.prompt=o,v.validationMessage=u||"",v.ignoreFocusOut=!0,v.validationMessage=u||"",v.buttons=[...this.steps.length>1?[Mx.QuickInputButtons.Back]:[],...l||[]],d.push(v.onDidTriggerButton(S=>{S===Mx.QuickInputButtons.Back?h(Ae.back):f(S)}),v.onDidAccept(async()=>{let S=v.value;v.enabled=!1,v.busy=!0;let b=await s(S);b?(v.validationMessage=b,v.show()):(v.validationMessage="",f(S)),v.enabled=!0,v.busy=!1}),v.onDidChangeValue(async()=>{v.validationMessage=""}),v.onDidHide(()=>{(async()=>{v.busy||h(c&&await c()?Ae.resume:Ae.cancel)})().catch(h)})),this.current&&this.current.dispose(),this.current=v,this.current.show()})}finally{d.forEach(f=>f.dispose())}}async stepThrough(e,t){let n=e;for(;n;){this.steps.push(n),this.current&&(this.current.enabled=!1,this.current.busy=!0);try{n=await n(this,t)}catch(i){if(i===Ae.back)this.steps.pop(),n=this.steps.pop();else if(i===Ae.resume)n=this.steps.pop();else if(i===Ae.cancel)n=void 0;else throw i;if(!n)return i}}this.current&&this.current.dispose()}},Rg=Symbol("IMultiStepInputFactory"),_g=class{constructor(e){this.shell=e}create(){return new Ox(this.shell)}};_g=g([(0,yP.injectable)(),p(0,(0,yP.inject)(ue))],_g);var _B=k(A()),RB=require("vscode");var Ng=class{activate(){RB.languages.getLanguages().then(e=>{e.map(t=>t.toLowerCase()).forEach(t=>{RS.includes(t)||RS.push(t)})},m)}};Ng=g([(0,_B.injectable)()],Ng);var qc=k(ql());function Np(r){return en()==="Windows"?Pn(r).toUpperCase():Pn(r)}function Ap(r,e){return Np(r)===Np(e)}function Fg(r,e){return e.endsWith(ni)||(e+=ni),r.endsWith(ni)||(r+=ni),Np(r).startsWith(Np(e))}var NJ=require("os"),rO;function AJ(r){rO=r}async function MJ(r,e={}){return(await rO.get(Vi).create(void 0)).shellExec(r,e)}function Lg(r){return qc.pathExists(r)}function nO(r){return qc.pathExistsSync(r)}function OJ(r){return qc.readFile(r,"utf-8")}function KJ(r){return qc.readFileSync(r,"utf-8")}var NP=r=>fh(r,(0,NJ.homedir)());function FJ(r){return rO.get(se).getSettings()[r]}var UJ=k(A()),Pm=k(require("os")),WJ=k(Hh()),iO=require("vscode");var Ug=k(Hh());function LJ(r){r=r.replace(/\.00*(?=[1-9]|0\.)/,".");let e=Ug.coerce(r);return e===null||!Ug.valid(e)?new Ug.SemVer("0.0.0"):e}var Jl=class{constructor(){this._homeDir=Sp()||iO.Uri.file(Pm.homedir());this._tempDir=iO.Uri.file(Pm.tmpdir());this.osType=en();this.osType,"Unknown"}get homeDir(){return this._homeDir}get tempDir(){return this._tempDir}get pathVariableName(){return this.isWindows?PB:DB}async getVersion(){if(this.version)return this.version;switch(this.osType){case"Windows":case"OSX":try{let e=(0,WJ.coerce)(Pm.release());if(e)return this.version=e;throw new Error("Unable to parse version")}catch{return LJ(Pm.release())}default:throw new Error("Not Supported")}}get isWindows(){return this.osType==="Windows"}get isMac(){return this.osType==="OSX"}get isLinux(){return this.osType==="Linux"}};Jl=g([(0,UJ.injectable)()],Jl);function jJ(r){r.addSingleton(Ir,Jl),AJ(r.get(ct))}var Wg=k(A());var Dm=require("child_process"),OP=require("vscode");var oO="utf8";var AP=require("vscode"),VJ=require("os"),MP=AP.Uri.file((0,VJ.homedir)());function Jc(r,e){let t=e?[{uri:AP.Uri.file(e),name:"",index:0}]:[];return W(r?AP.Uri.file(r):void 0,t,MP)}function $r(r,e=[]){return W(r,e,MP)}function sO(r,e,t){let n=e.reduce((o,s,a)=>{let l=KS(s);return(s.startsWith('"')&&s.endsWith('"')||s.startsWith("'")&&s.endsWith("'")&&(s.includes("/")||s.includes("\\")))&&(l=`${s[0]}${$r(s.substr(1))}`),a===0?l:`${o} ${l}`},""),i=[`Process Execution: ${$r(r)} ${n}`];t&&t.cwd&&i.push(`    > ${MN.currentWorkingDirectory} ${$r(t.cwd.toString())}`),H(i.join(`
`))}var aO=class{decode(e){return Buffer.concat(e).toString(oO)}},Mp=class Mp{constructor(e){this.env=e;this.processesToKill=new Set;this.decoder=new aO}static isAlive(e){try{return e?(process.kill(e,0),!0):!1}catch{return!1}}static kill(e){try{if(!e)return;process.platform==="win32"?(0,Dm.execSync)(`taskkill /pid ${e} /T /F`):process.kill(e)}catch{}}dispose(){this.processesToKill.forEach(e=>{try{e.dispose()}catch{}})}execObservable(e,t,n={}){let i=this.getDefaultOptions(n),o=(0,Dm.spawn)(e,t,i),s=!1;te(`Exec observable ${e}, ${t.join(" ")}`);let a=[],l={dispose:function(){o&&!o.killed&&!s&&Mp.kill(o.pid),o&&o.unref(),G(a)}};this.processesToKill.add(l);let c=Lpe();a.push(c);let u=(f,h,v)=>{f.on(h,v),a.push({dispose:()=>f.removeListener(h,v)})};n.token&&a.push(n.token.onCancellationRequested(()=>{!s&&!o.killed&&(Mp.kill(o.pid),s=!0)}));let d=(f,h)=>{let v=this.decoder.decode([h]);f==="stderr"&&n.throwOnStdErr?c.reject(new Ix(v)):c.fire({source:f,out:v})};return u(o.stdout,"data",f=>d("stdout",f)),u(o.stderr,"data",f=>d("stderr",f)),o.once("close",()=>{s=!0,c.resolve(),a.forEach(f=>f.dispose())}),o.once("exit",()=>{s=!0,c.resolve(),a.forEach(f=>f.dispose())}),o.once("error",f=>{s=!0,c.reject(f),a.forEach(h=>h.dispose())}),sO(e,t,n),{proc:o,out:c,dispose:l.dispose}}exec(e,t,n={}){let i=this.getDefaultOptions(n),o=(0,Dm.spawn)(e,t,i),s=pe(),a={dispose:()=>{!o.killed&&!s.completed&&Mp.kill(o.pid)}};this.processesToKill.add(a);let l=[],c=(f,h,v)=>{f.on(h,v),l.push({dispose:()=>f.removeListener(h,v)})};n.token&&l.push(n.token.onCancellationRequested(a.dispose));let u=[];c(o.stdout,"data",f=>u.push(f));let d=[];return c(o.stderr,"data",f=>{n.mergeStdOutErr&&u.push(f),d.push(f)}),o.once("close",()=>{if(s.completed)return;let f=d.length===0?void 0:this.decoder.decode(d);if(f&&f.length>0&&n.throwOnStdErr)s.reject(new Ix(f));else{let h=this.decoder.decode(u);s.resolve({stdout:h,stderr:f})}l.forEach(h=>h.dispose())}),o.once("error",f=>{s.reject(f),l.forEach(h=>h.dispose())}),sO(e,t,n),s.promise}shellExec(e,t={}){let n=this.getDefaultOptions(t);return new Promise((i,o)=>{let s,a=(0,Dm.exec)(e,n,(c,u,d)=>{s?.dispose(),c&&c!==null?o(c):n.throwOnStdErr&&d&&d.length?o(new Error(d)):i({stderr:d&&d.length>0?d:void 0,stdout:u})});t.token&&(s=t.token.onCancellationRequested(()=>{a.exitCode===null&&!a.killed&&(o(new OP.CancellationError),Mp.kill(a.pid))}));let l={dispose:()=>{a.killed||Mp.kill(a.pid)}};this.processesToKill.add(l)})}getDefaultOptions(e){let t={...e},n=t;if(n){let i=n.encoding=typeof n.encoding=="string"&&n.encoding.length>0?n.encoding:oO;delete n.encoding,n.encoding=i}if(!t.env||Object.keys(t.env).length===0){let i=this.env?this.env:process.env;t.env={...i}}else t.env={...t.env};return t.env.PYTHONUNBUFFERED="1",t.env.PYTHONIOENCODING||(t.env.PYTHONIOENCODING="utf-8"),t}};g([gi("Execing shell command",5),p(1,Xu())],Mp.prototype,"shellExec",1);var $l=Mp;function Lpe(){let r=new OP.EventEmitter,e=pe();return e.promise.catch(m),{get onDidChange(){return r.event},get done(){return e.promise},resolve:e.resolve.bind(e),reject:e.reject.bind(e),fire:r.fire.bind(r),dispose:()=>{r.dispose()}}}var Tm=class{constructor(e,t,n){this.envVarsService=e;this.disposableRegistry=t;this.workspace=n}async create(e,t){if(!this.workspace.isTrusted)throw new Error("Workspace not trusted");let n=await this.envVarsService.getEnvironmentVariables(e,"RunNonPythonCode",t),i=new $l(n);return this.disposableRegistry.push(i),i}};g([gi("Create ProcessService",5)],Tm.prototype,"create",1),Tm=g([(0,Wg.injectable)(),p(0,(0,Wg.inject)(Kl)),p(1,(0,Wg.inject)(O)),p(2,(0,Wg.inject)(ce))],Tm);function BJ(r){r.addSingleton(Vi,Tm)}var JJ=k(require("os")),FP=k(A());var jg=k(require("vscode")),qJ;(l=>{let r=jg.FileSystemError.FileNotFound().name,e=jg.FileSystemError.FileExists().name,t=jg.FileSystemError.FileIsADirectory().name,n=jg.FileSystemError.FileNotADirectory().name,i=jg.FileSystemError.NoPermissions().name,o=[r,e,t,n,i];function s(c,u){if(o.includes(c.name))return c.name===u}function a(c){return s(c,r)}l.isFileNotFound=a})(qJ||={});function Upe(r,e){let t=r.code;if(t)return t===e}function KP(r){let e=qJ.isFileNotFound(r);return e!==void 0?e:Upe(r,"ENOENT")}var $J=require("vscode");var Vg=class{constructor(e){this.fs=e}async parseFile(e,t){if(e)try{return Wpe(await this.fs.readFile($J.Uri.file(e)),t)}catch(n){KP(n)||C(`Failed to parse env file ${e}`,n)}}mergeVariables(e,t){t&&Object.keys(e).forEach(n=>{let i=n.toLowerCase();if(i=="pythonpath"||i=="path")return;let o=Object.keys(t).find(s=>s.toLowerCase()===i)||n;t[o]=e[n]})}mergePaths(e,t){let n=Object.keys(e).find(o=>o.toLowerCase()==="path"),i=Object.keys(t).find(o=>o.toLowerCase()==="path")||n;n&&i&&(t[i]=e[n])}appendPythonPath(e,...t){return this.appendPaths(e,"PYTHONPATH",!0,...t)}appendPath(e,...t){return this.appendPaths(e,"PATH",!0,...t)}prependPath(e,...t){return this.appendPaths(e,"PATH",!1,...t)}appendPaths(e,t,n,...i){let o=i.filter(f=>typeof f=="string"&&f.trim().length>0).map(f=>f.trim()).join(ii);if(o.length===0)return e;let s=t.toLowerCase(),a=e?Object.keys(e).find(f=>f.toLowerCase()==s):void 0,l=e&&a?e[a]:void 0,c=a||t;l&&typeof l=="string"&&l.length>0?n&&!(e[c]||"").endsWith(ii+o)?e[c]=l+ii+o:!n&&!(e[c]||"").startsWith(o+ii)&&(e[c]=o+ii+l):e[c]=o;let d=["Path","PATH"].find(f=>f!==c);if(JJ.platform()==="win32"&&d&&d in e&&typeof e[d]=="string"){let f=e[d],h=d;f&&typeof f=="string"&&f.length>0?n&&!(e[h]||"").endsWith(ii+o)?e[h]=f+ii+o:!n&&!(e[h]||"").startsWith(o+ii)&&(e[h]=o+ii+f):e[h]=o}return e}};Vg=g([(0,FP.injectable)(),p(0,(0,FP.inject)(Ze))],Vg);function Wpe(r,e){let t=e||{},n={};return r.toString().split(`
`).forEach((i,o)=>{let[s,a]=jpe(i);s!==""&&(n[s]=Bpe(a,n,t))}),n}function jpe(r){let e=r.match(/^\s*([a-zA-Z]\w*)\s*=\s*(.*?)?\s*$/);if(!e)return["",""];let t=e[1],n=e[2];return n&&n!==""?n[0]==="'"&&n[n.length-1]==="'"?(n=n.substring(1,n.length-1),n=n.replace(/\\n/gm,`
`)):n[0]==='"'&&n[n.length-1]==='"'&&(n=n.substring(1,n.length-1),n=n.replace(/\\n/gm,`
`)):n="",[t,n]}var Vpe=/\${([a-zA-Z]\w*)?([^}\w].*)?}/g;function Bpe(r,e,t,n=""){let i=!1,o=r;return o=o.replace(Vpe,(s,a,l,c,u)=>c>0&&u[c-1]==="\\"?s:l&&l!==""||!a||a===""?(i=!0,s):e[a]||t[a]||n),!i&&o!==r&&(r=o,R("ENVFILE_VARIABLE_SUBSTITUTION")),r.replace(/\\\$/g,"$")}var Da=k(A());var qg=require("vscode");var HJ=require("vscode");var lO={number:"number",string:"string",undefined:"undefined",object:"object",function:"function"};function cO(r){return Array.isArray?Array.isArray(r):!!(r&&typeof r.length===lO.number&&r.constructor===Array)}function LP(r){return typeof r===lO.string||r instanceof String}function uO(r){return typeof r===lO.object&&r!==null&&!Array.isArray(r)&&!(r instanceof RegExp)&&!(r instanceof Date)}var UP=class{resolve(e){return LP(e)?this.__resolveString(e):cO(e)?this.__resolveArray(e):uO(e)?this.__resolveLiteral(e):e}resolveAny(e){return LP(e)?this.__resolveString(e):cO(e)?this.__resolveAnyArray(e):uO(e)?this.__resolveAnyLiteral(e):e}__resolveString(e){let t=/\$\{(.*?)\}/g;return e.replace(t,(n,i)=>{let o=this[i];return LP(o)?o:n&&(n.indexOf("env.")>0||n.indexOf("env:")>0)?"":n})}__resolveLiteral(e){let t=Object.create(null);return Object.keys(e).forEach(n=>{let i=e[n];t[n]=this.resolve(i)}),t}__resolveAnyLiteral(e){let t=Object.create(null);return Object.keys(e).forEach(n=>{let i=e[n];t[n]=this.resolveAny(i)}),t}__resolveArray(e){return e.map(t=>this.__resolveString(t))}__resolveAnyArray(e){return e.map(t=>this.resolveAny(t))}};var Bg=class extends UP{constructor(t,n,i,o){super();let s=i&&t?i.getWorkspaceFolder(t):void 0;this._workspaceFolder=s?s.uri.fsPath:n?.fsPath||__dirname,this._workspaceFolderName=Te(this._workspaceFolder),this._filePath=t?t.fsPath:void 0,o&&o.activeTextEditor&&(this._lineNumber=o.activeTextEditor.selection.anchor.line+1,this._selectedText=o.activeTextEditor.document.getText(new HJ.Range(o.activeTextEditor.selection.start,o.activeTextEditor.selection.end))),this._execPath=process.execPath,Object.keys(process.env).forEach(a=>{this[`env:${a}`]=this[`env.${a}`]=process.env[a]})}get cwd(){return this.workspaceFolder}get workspaceRoot(){return this._workspaceFolder}get workspaceFolder(){return this._workspaceFolder}get workspaceRootFolderName(){return this._workspaceFolderName}get workspaceFolderBasename(){return this._workspaceFolderName}get file(){return this._filePath}get relativeFile(){return this.file?HE(this._workspaceFolder,this.file):void 0}get relativeFileDirname(){return this.relativeFile?pt(this.relativeFile):void 0}get fileBasename(){return this.file?Te(this.file):void 0}get fileBasenameNoExtension(){return this.file?SW(this.file).name:void 0}get fileDirname(){return this.file?pt(this.file):void 0}get fileExtname(){return this.file?Zi(this.file):void 0}get lineNumber(){return this._lineNumber}get selectedText(){return this._selectedText}get execPath(){return this._execPath}};var GJ=require("vscode"),Vx,WP=!1;function zJ(){XJ()&&YJ()}async function QJ(r,e,t){if(XJ()){let i=new Bg(t,void 0,e).resolveAny(ZJ(e));await r.exists(GJ.Uri.file(i))&&YJ()}}function YJ(){R("ENVFILE_WORKSPACE"),WP=!0}function XJ(){return!WP}function ZJ(r){return Vx||(Vx=r.getConfiguration("python").inspect("envFile")?.defaultValue||""),Vx}var Jpe;(t=>{function r({telemetrySent:n,defaultSetting:i}){n!==void 0&&(WP=n),ZJ!==void 0&&(Vx=i)}t.setState=r;function e(){Vx=void 0,WP=!1}t.resetState=e})(Jpe||={});var $pe=60*1e3,_m=class{constructor(e,t,n,i,o,s=$pe){this.envVarsService=e;this.workspaceService=n;this.extensionChecker=i;this.pythonApi=o;this.cacheDuration=s;this.trackedWorkspaceFolders=new Set;this.fileWatchers=new Set;this.disposables=[];this.changeEventEmitter=new qg.EventEmitter;t.push(this)}get onDidEnvironmentVariablesChange(){return this.changeEventEmitter.event}dispose(){this.changeEventEmitter.dispose(),G(this.disposables)}async getEnvironmentVariables(e,t,n){if(e=e||(this.workspaceService.workspaceFolders?.length?this.workspaceService.workspaceFolders[0].uri:void 0),t==="RunPythonCode")return this._getEnvironmentVariables(e,t,n);let i=new Jd(this.cacheDuration,this.getCacheKeyForMergedVars(e));if(i.hasData&&i.data)return w(`Cached data exists getEnvironmentVariables, ${e?e.fsPath:"<No Resource>"}`),i.data;let o=this._getEnvironmentVariables(e,t,n);return o.then(s=>{n?.isCancellationRequested||(i.data=s)}).catch(m),o}async getCustomEnvironmentVariables(e,t,n){e=e||(this.workspaceService.workspaceFolders?.length?this.workspaceService.workspaceFolders[0].uri:void 0);let i=this.getWorkspaceFolderUri(e);if(!i){te(`No workspace folder found for ${e?e.fsPath:"<No Resource>"}`);return}if(t==="RunPythonCode"&&this.extensionChecker.isPythonExtensionInstalled){let l=await this.pythonApi.getNewApi();if(l&&!n?.isCancellationRequested)return this.pythonEnvVarChangeEventHooked||(this.pythonEnvVarChangeEventHooked=!0,l.environments.onDidEnvironmentVariablesChange(c=>{w(`Python env vars changed ${c.resource?.uri?.path}`),this.onEnvironmentFileChanged(c.resource?.uri),this.changeEventEmitter.fire(c.resource?.uri)},this,this.disposables)),l.environments.getEnvironmentVariables(i)}let o=new Jd(this.cacheDuration,this.getCacheKeyForCustomVars(e));if(o.hasData)return w(`Cached custom vars data exists getCustomEnvironmentVariables, ${e?e.fsPath:"<No Resource>"}`),o.data;if(n?.isCancellationRequested)return;this.trackedWorkspaceFolders.add(i.fsPath||"");let s=this.getEnvFile(i);this.createFileWatcher(s,i);let a=this.envVarsService.parseFile(s,process.env);return a.then(l=>{n?.isCancellationRequested||(o.data=l)}).catch(m),a}createFileWatcher(e,t){let n=this.getCacheKeyForMergedVars(t);if(this.fileWatchers.has(n))return;let i=new qg.RelativePattern(qg.Uri.file(pt(e)),Te(e)),o=this.workspaceService.createFileSystemWatcher(i,!1,!1,!1);o?(this.disposables.push(o),this.fileWatchers.add(n),o.onDidChange(()=>this.onEnvironmentFileChanged(t),this,this.disposables),o.onDidCreate(()=>this.onEnvironmentFileCreated(t),this,this.disposables),o.onDidDelete(()=>this.onEnvironmentFileChanged(t),this,this.disposables)):C("Failed to create file watcher for environment file")}getEnvFile(e){return Ue(e.fsPath,".env")}async _getEnvironmentVariables(e,t,n){let i=await this.getCustomEnvironmentVariables(e,t,n);if(n?.isCancellationRequested)return{};if(i&&t==="RunPythonCode"&&this.extensionChecker.isPythonExtensionInstalled)return i;i||(i={});let o={};this.envVarsService.mergeVariables(process.env,o),this.envVarsService.mergeVariables(i,o),this.envVarsService.mergePaths(process.env,o),process.env.PYTHONPATH&&(o.PYTHONPATH=process.env.PYTHONPATH);let s=i?Object.keys(i).find(a=>a.toLowerCase()=="path"):void 0;return s&&i[s]&&this.envVarsService.appendPath(o,i[s]),i.PYTHONPATH&&this.envVarsService.appendPythonPath(o,i.PYTHONPATH),o}getWorkspaceFolderUri(e){let t=this.workspaceService.workspaceFolders||[],n=t.length===1?t[0].uri:void 0;return e&&this.workspaceService.getWorkspaceFolder(e)?.uri||n}onEnvironmentFileCreated(e){this.onEnvironmentFileChanged(e),zJ()}onEnvironmentFileChanged(e){new Jd(this.cacheDuration,this.getCacheKeyForMergedVars(e)).clear(),new Jd(this.cacheDuration,this.getCacheKeyForCustomVars(e)).clear(),this.changeEventEmitter.fire(e)}getCacheKeyForMergedVars(e){return`${this.workspaceService.getWorkspaceFolderIdentifier(e)}:RunNonPythonCode`}getCacheKeyForCustomVars(e){return`${this.workspaceService.getWorkspaceFolderIdentifier(e)}:RunNonPythonCode:CustomVars`}};g([gi("Get Custom Env Variables",5)],_m.prototype,"getEnvironmentVariables",1),_m=g([(0,Da.injectable)(),p(0,(0,Da.inject)(Ol)),p(1,(0,Da.inject)(O)),p(2,(0,Da.inject)(ce)),p(3,(0,Da.inject)(ze)),p(4,(0,Da.inject)(Xt)),p(5,(0,Da.inject)("number")),p(5,(0,Da.optional)())],_m);function e6(r){r.addSingleton(Ol,Vg),r.addSingleton(Kl,_m)}var Bx=k(A()),qx=require("vscode");var Jg=class{constructor(e,t){this.commandManager=e;this.workspaceService=t}activate(){this.commandManager.registerCommand("jupyter.runInDedicatedExtensionHost",this.updateAffinity,this)}async updateAffinity(){let e=this.workspaceService.getConfiguration("extensions").get("experimental.affinity"),t=0;e&&Object.values(e).forEach(o=>{t=Math.max(t,o)});let n=t+1,i={"ms-toolsai.jupyter":n,"ms-toolsai.jupyter-renderers":n};qx.extensions.getExtension(hi)&&(i[hi]=n),qx.extensions.getExtension(Bd)&&(i[Bd]=n),await this.workspaceService.getConfiguration("extensions").update("experimental.affinity",{...e??{},...i},qx.ConfigurationTarget.Global),this.commandManager.executeCommand("workbench.action.reloadWindow").then(m,m)}};Jg=g([(0,Bx.injectable)(),p(0,(0,Bx.inject)(Fe)),p(1,(0,Bx.inject)(ce))],Jg);var t6=k(A()),jP=require("vscode");var $g=class{get onDidCloseTerminal(){return jP.window.onDidCloseTerminal}get onDidOpenTerminal(){return jP.window.onDidOpenTerminal}createTerminal(e){return jP.window.createTerminal(e)}};$g=g([(0,t6.injectable)()],$g);var Ta=k(A());var r6=["currentServerHash","connectToLocalKernelsOnly","JUPYTER_LOCAL_KERNELSPECS","JUPYTER_LOCAL_KERNELSPECS_V1","JUPYTER_LOCAL_KERNELSPECS_V2","JUPYTER_LOCAL_KERNELSPECS_V3","JUPYTER_REMOTE_KERNELSPECS","JUPYTER_REMOTE_KERNELSPECS_V1","JUPYTER_REMOTE_KERNELSPECS_V2","JUPYTER_REMOTE_KERNELSPECS_V3","JUPYTER_LOCAL_KERNELSPECS_V4","JUPYTER_REMOTE_KERNELSPECS_V4-","LOCAL_KERNEL_SPECS_CACHE_KEY_V_2022_10","LOCAL_KERNEL_PYTHON_AND_RELATED_SPECS_CACHE_KEY_V_2022_10","user-jupyter-server-uri-list-v2","REGISTRATION_ID_EXTENSION_OWNER_MEMENTO_KEY"],Hg=class{constructor(e,t,n,i,o){this.workspace=e;this.globalState=t;this.crypto=n;this.appEnv=i;this.workspaceState=o}activate(){this.removeOldCachedItems().then(m,m)}async removeOldCachedItems(){await Promise.all([await this.getUriAccountKey()].concat(r6).filter(t=>this.globalState.get(t,void 0)!==void 0).map(t=>this.globalState.update(t,void 0).then(m,m)));let e=this.workspaceState.keys().filter(t=>t.startsWith("LAST_EXECUTED_CELL_")&&!t.startsWith("LAST_EXECUTED_CELL_V2_"));await Promise.all(e.map(t=>this.workspaceState.update(t,void 0))),await Promise.all(r6.map(t=>this.globalState.keys().filter(n=>n.startsWith(t)).map(n=>this.globalState.update(n,void 0).then(m,m))).flat())}async getUriAccountKey(){return this.workspace.rootFolder?this.crypto.createHash(we(this.workspace.rootFolder),"SHA-512"):this.workspace.workspaceFile?this.crypto.createHash(we(this.workspace.workspaceFile),"SHA-512"):this.appEnv.machineId}};Hg=g([(0,Ta.injectable)(),p(0,(0,Ta.inject)(ce)),p(1,(0,Ta.inject)(He)),p(1,(0,Ta.named)(It)),p(2,(0,Ta.inject)(Dh)),p(3,(0,Ta.inject)(An)),p(4,(0,Ta.inject)(He)),p(4,(0,Ta.named)(vi))],Hg);function n6(r){r.addSingletonInstance(p2,TB),r.addSingleton(rr,dg),r.addSingleton(Sl,Tg),r.addSingleton(qe,fm),r.addSingleton(Zd,lg),r.addSingleton(lr,ug),r.addSingleton(Ui,Wc),r.addSingleton(An,ag),r.addSingleton(Oc,pg),r.addSingleton(c2,mg),r.addSingleton(ks,kg),r.addSingleton(ws,Dg),r.addSingleton(Dh,Mh),r.addSingleton(sp,wg),r.addSingleton(l2,$g),r.addSingleton(Mw,Pg),r.addSingleton(yi,fg),r.addSingleton(Rg,_g),r.addSingleton(Ie,Ng),r.addSingleton(Ie,Hg),r.addSingleton(Ie,cg),r.addSingleton(Ie,Jg),jJ(r),BJ(r),e6(r)}var BP=k(A());var Xo=Ue(__dirname,"..");var pO=Ue(Xo,"pythonFiles"),Hpe=pO;function i6(){let e=[Ue(Hpe,"normalizeSelection.py")];function t(n){return n}return[e,t]}var $c=require("vscode");var VP=class{constructor(e){this.documentManager=e.get(lr),this.applicationShell=e.get(ue)}async normalizeLines(e,t){return e}async getFileToExecute(){let e=this.documentManager.activeTextEditor;if(!e){this.applicationShell.showErrorMessage("No open file to run in terminal").then(m,m);return}if(e.document.isUntitled){this.applicationShell.showErrorMessage("The active file needs to be saved before it can be run").then(m,m);return}if(e.document.languageId!==xe){this.applicationShell.showErrorMessage("The active file is not a Python source file").then(m,m);return}return e.document.isDirty&&await e.document.save(),e.document.uri}getSelectedTextToExecute(e){if(!e)return;let t=e.selection,n;return t.isEmpty?n=e.document.lineAt(t.start.line).text:t.isSingleLine?n=this.getSingleLineSelectionText(e):n=this.getMultiLineSelectionText(e),this.dedentCode(n.trimEnd())}async saveFileIfDirty(e){let t=this.documentManager.textDocuments.filter(n=>n.uri.path===e.path);t.length===1&&t[0].isDirty&&await t[0].save()}dedentCode(e){let t=e.split(`
`),n=t.find(i=>i.trim().length>0);if(n){let i=n.match(/^\s*/)[0];return t.map(o=>o.startsWith(i)?o.replace(i,""):o).join(`
`)}return e}getSingleLineSelectionText(e){let t=e.selection,n=new $c.Range(t.start,t.end),i=e.document.getText(n),o=e.document.lineAt(t.start.line).text;return i.trim()===o.trim()?o:i}getMultiLineSelectionText(e){let t=e.selection,n=new $c.Range(t.start,t.end),i=e.document.getText(n),o=new $c.Range(new $c.Position(t.start.line,0),new $c.Position(t.end.line,e.document.lineAt(t.end.line).text.length)),s=e.document.getText(o);if(i.trim()===s.trim())return s;let a=e.document.lineAt(t.start.line).text,l=new $c.Range(t.start,new $c.Position(t.start.line,a.length)),c=e.document.getText(l);return c.trimStart()===a.trimStart()?a+i.substring(c.length):i}};var Gg=class extends VP{constructor(t){super(t);this.processServiceFactory=t.get(Vi),this.interpreterService=t.get(it)}async normalizeLines(t,n){let i=[];try{let o=t.trim();if(o.length===0)return"";if(t=t.replace(new RegExp("\\r","g"),""),o.indexOf(`
`)===-1)return o+`
`;let s=await this.interpreterService.getActiveInterpreter(n),a=await this.processServiceFactory.create(n),[l,c]=i6(),u=a.execObservable(we(s?.uri)||"python",l,{throwOnStdErr:!0}),d="";u.out.onDidChange(_=>{_.source==="stdout"&&(d+=_.out)},this,i);let f=JSON.stringify({code:t});u.proc?.stdin?.write(f),u.proc?.stdin?.end(),await u.out.done;let v=JSON.parse(d),S=c(v.normalized),b=je(t,{trim:!0,removeEmptyEntries:!1}).findIndex(_=>_.length),D=je(S,{trim:!0,removeEmptyEntries:!1}).findIndex(_=>_.length);if(b>D){let _=b-D;return`${`
`.repeat(_)}${S}`}return S}catch(o){return C(o,"Python: Failed to normalize code for execution in Interactive Window"),t}finally{G(i)}}};Gg=g([(0,BP.injectable)(),p(0,(0,BP.inject)(ct))],Gg);var qP=Symbol("ICodeExecutionHelper");function o6(r){r.addSingleton(qP,Gg)}var Op=k(A()),a6=k(Hh()),Jx=require("vscode");var s6="CONDA_INFORMATION_CACHE";function dO(r){return r&&mh(r.fsPath)&&r.fsPath.startsWith(ni)&&`${ni}${Te(r.fsPath)}`===r.fsPath?Te(r.fsPath):r?.fsPath}var Ls=class{constructor(e,t,n){this.pythonApi=e;this.globalState=t;this.fs=n}async getCondaVersion(){if(this._version)return this._version;if(this._previousVersionCall)return this._previousVersionCall;let e=async()=>{let t=this.getCondaVersionFromPython();t.then(i=>{this._version=i,this.updateCache().catch(m)}).catch(m);let n=Vu(this.getCachedInformation());return await Promise.race([n.promise,t]),n.completed&&n.value?.version?this._version=n.value.version:t};return this._previousVersionCall=e(),this._previousVersionCall}async getCondaFile(){if(this._file)return dO(this._file);if(this._previousFileCall)return this._previousFileCall.then(dO);let e=async()=>{let t=this.pythonApi.getApi().then(i=>i.getCondaFile?i.getCondaFile():void 0);t.then(i=>{w(`Conda file returned by Python Extension is ${i}`),this._file=i?Jx.Uri.file(i):void 0,this.updateCache().catch(m)}).catch(m);let n=Vu(this.getCachedInformation());return await Promise.race([n.promise,t]),n.completed&&n.value?.file?this._file=n.value.file:t.then(i=>i?Jx.Uri.file(i):void 0)};return this._previousFileCall=e(),this._previousFileCall.then(dO)}async isCondaAvailable(){return typeof this.isAvailable=="boolean"?this.isAvailable:this.getCondaVersion().then(e=>this.isAvailable=e!==void 0).catch(()=>this.isAvailable=!1)}async updateCache(){if(!this._file||!this._version)return;let e=this._file.fsPath.toLowerCase().endsWith("conda")?"":await this.fs.getFileHash(this._file);await this.globalState.update(s6,{version:this._version.raw,file:this._file.fsPath,fileHash:e})}async getCachedInformation(){let e=this.globalState.get(s6,void 0);if(!e)return;let t=e.file.toLowerCase().endsWith("conda")?"":await this.fs.getFileHash(Jx.Uri.file(e.file));if(e.fileHash===t)return{version:new a6.SemVer(e.version),file:Jx.Uri.file(e.file)}}async getCondaVersionFromPython(){return this.pythonApi.getApi().then(e=>e.getCondaVersion?e.getCondaVersion():void 0)}};Ls=g([(0,Op.injectable)(),p(0,(0,Op.inject)(Xt)),p(1,(0,Op.inject)(He)),p(1,(0,Op.named)(It)),p(2,(0,Op.inject)(Ze))],Ls);var $x=k(A());var c6=k(JP());var l6="_VSCODE_getDataFrame",$P=c6.default`
                            try:
                                del _VSCODE_getDataFrame
                            except:
                                pass
                            `,Hl=class{constructor(e,t){this.fs=e;this.context=t}async generateCodeToGetDataFrameInfo(e){let t=await this.getContentsOfDataFrameScript(),n=e.isDebugging?"True":"False",i=`${l6}("info", ${n}, ${e.variableName})`;return e.isDebugging?{initializeCode:t,code:i,cleanupCode:$P}:{code:`${t}

${i}

${$P}`}}async generateCodeToGetDataFrameRows(e){let t=await this.getContentsOfDataFrameScript(),n=e.isDebugging?"True":"False",i=`${l6}("rows", ${n}, ${e.variableName}, ${e.startIndex}, ${e.endIndex})`;return e.isDebugging?{initializeCode:t,code:i,cleanupCode:$P}:{code:`${t}

${i}

${$P}`}}async getContentsOfDataFrameScript(){if(Hl.contentsOfDataFrameScript)return Hl.contentsOfDataFrameScript;let e=Yt(this.context.extensionUri,"pythonFiles","vscode_datascience_helpers","dataframes","vscodeDataFrame.py"),t=await this.fs.readFile(e);return Hl.contentsOfDataFrameScript=t,t}};Hl=g([(0,$x.injectable)(),p(0,(0,$x.inject)(Ze)),p(1,(0,$x.inject)(dt))],Hl);var Qg=k(A()),Hc=require("jsonc-parser"),hO=require("vscode");var zg=k(A()),u6=require("vscode");var xi=class{constructor(e,t,n){this.workspace=e;this.webExtension=n;this.disposables=[];this._onDidChange=new u6.EventEmitter;t.push(this),this.webExtension||this.workspace.onDidChangeConfiguration(i=>{i.affectsConfiguration("jupyter.kernels.excludePythonEnvironments")&&this._onDidChange.fire()},this,this.disposables)}get onDidChange(){return this._onDidChange.event}dispose(){this._onDidChange.dispose(),G(this.disposables)}isPythonEnvironmentExcluded(e){if(this.webExtension)return!1;let t=this.getExcludedPythonEnvironments(),n=fO(e,t),i="uri"in e?e.uri:e.executable.uri;return n&&(R("DATASCIENCE.JUPYTER_KERNEL_HIDDEN_VIA_FILTER"),w(`Python Env hidden via filter: ${W(i)}`)),n}getExcludedPythonEnvironments(){if(!this.workspace.workspaceFolders||this.workspace.workspaceFolders.length===0)return this.workspace.getConfiguration("jupyter",void 0).get("kernels.excludePythonEnvironments",[]);let e=[];return this.workspace.workspaceFolders.forEach(t=>{e.push(...this.workspace.getConfiguration("jupyter",t.uri).get("kernels.excludePythonEnvironments",[]))}),e}};xi=g([(0,zg.injectable)(),p(0,(0,zg.inject)(ce)),p(1,(0,zg.inject)(O)),p(2,(0,zg.inject)(on))],xi);function fO(r,e){let t="uri"in r?r.envPath:r.environment?.folderUri,n="uri"in r?r.uri:r.executable.uri;return!n&&!t?!1:e.some(o=>{let s=W(o.trim()).toLowerCase().replace(/\\/g,"/");if(o=o.trim().toLowerCase().replace(/\\/g,"/"),o.length===0||s.length===0)return!1;let a=W(n).toLowerCase().replace(/\\/g,"/"),l=n?n.fsPath.toLowerCase().replace(/\\/g,"/"):"";if(o===a||s===a||o===l||s===l)return!0;let c=W(t||"").toLowerCase().replace(/\\/g,"/"),u=W(t||"").toLowerCase().replace(/\\/g,"/");return o===c||s===c||o===u||s===u})}var Kp=class{constructor(e,t,n){this.disposableRegistry=e;this.interpreters=t;this.pythonExtChecker=n;this.supportedWorkspaceTypes={untrustedWorkspace:!1,virtualWorkspace:!1}}async activate(){this.disposableRegistry.push(hO.languages.registerCompletionItemProvider({language:"json"},this,",","[")),this.disposableRegistry.push(hO.languages.registerCompletionItemProvider({language:"jsonc"},this,",","["))}async provideCompletionItems(e,t,n){if(!this.pythonExtChecker.isPythonExtensionInstalled||!this.pythonExtChecker.isPythonExtensionActive||this.interpreters.resolvedEnvironments.length===0||!Kp.canProvideCompletions(e,t))return[];let i=this.getCurrentItemsInList(e,t);return this.interpreters.resolvedEnvironments.filter(o=>!fO(o,i)).map(o=>{let s=up(o),a=W(o.uri);return{label:s,detail:a,insertText:`"${a.replace(/\\/g,"\\\\")}"`,filterText:`${s} ${a}`}})}static canProvideCompletions(e,t){if(Te(e.uri.fsPath)!=="settings.json")return!1;let n=(0,Hc.getLocation)(e.getText(),e.offsetAt(t));return n.path[0]==="jupyter.kernels.excludePythonEnvironments"&&n.path.length===2}getCurrentItemsInList(e,t){try{let n=e.getText(),i=(0,Hc.getLocation)(n,e.offsetAt(t)),o=(0,Hc.parseTree)(n),s=(0,Hc.findNodeAtLocation)(o,[i.path[0]]);if(!s)return[];let a=(0,Hc.getNodeValue)(s);return Array.isArray(a)?a:[]}catch(n){return J("Failed to provide completions for python env filter",n),[]}}};Kp=g([(0,Qg.injectable)(),p(0,(0,Qg.inject)(O)),p(1,(0,Qg.inject)(it)),p(2,(0,Qg.inject)(ze))],Kp);var HP=k(A()),Fp=require("vscode");var Yg=class{constructor(e){this.workspace=e}activate(){this.migrateFilters().catch(m)}async migrateFilters(){let e=Array.isArray(this.workspace.workspaceFolders)?this.workspace.workspaceFolders:[];await this.migrateWorkspaceFilters(this.workspace.getConfiguration("jupyter",void 0),Fp.ConfigurationTarget.Global),e.length===0?await this.migrateWorkspaceFilters(this.workspace.getConfiguration("jupyter",void 0),Fp.ConfigurationTarget.Global):e.length===1?await this.migrateWorkspaceFilters(this.workspace.getConfiguration("jupyter",e[0].uri),Fp.ConfigurationTarget.WorkspaceFolder):(await this.migrateWorkspaceFilters(this.workspace.getConfiguration("jupyter",void 0),Fp.ConfigurationTarget.Workspace),await Promise.all(e.map(t=>this.migrateWorkspaceFilters(this.workspace.getConfiguration("jupyter",t.uri),Fp.ConfigurationTarget.WorkspaceFolder))))}async migrateWorkspaceFilters(e,t){let n=e.inspect("kernels.filter"),i=[];switch(t){case Fp.ConfigurationTarget.Global:i=n?.globalValue||[];break;case Fp.ConfigurationTarget.Workspace:i=n?.workspaceValue||[];break;default:i=n?.workspaceFolderValue||[]}let o=i.filter(s=>s.type==="pythonEnvironment").map(s=>s.path);i.length&&await e.update("kernels.filter",void 0,t),o.length&&await e.update("kernels.excludePythonEnvironments",Array.from(new Set(o)),t)}};Yg=g([(0,HP.injectable)(),p(0,(0,HP.inject)(ce))],Yg);var Hx=k(A());var Xg=class{constructor(e,t){this.commandManager=e;this.disposables=t}activate(){this.disposables.push(this.commandManager.registerCommand("jupyter.filterKernels",()=>this.commandManager.executeCommand("workbench.action.openSettings","jupyter.kernels.excludePythonEnvironments").then(m,m),this))}};Xg=g([(0,Hx.injectable)(),p(0,(0,Hx.inject)(Fe)),p(1,(0,Hx.inject)(O))],Xg);var zP=k(A());var Rm=Symbol("IModuleInstaller"),qMe=Symbol("IPythonInstallation"),GP=Symbol("IInstallationChannelManager"),Gx=Symbol("IProductService"),zx=Symbol("IProductPathService");var qi=Symbol("IInstaller");var Zg=class{constructor(e){this.serviceContainer=e}async getInstallationChannel(e,t){let n=await this.getInstallationChannels(t);if(n.length>=1)return n[0];if(n.length===0){await this.showNoInstallersMessage(t);return}}async getInstallationChannels(e){let t=this.serviceContainer.getAll(Rm),n=[];if(t.length===0)return[];t.sort((o,s)=>s.priority-o.priority);let i=t[0].priority;for(let o of t){if(o.priority!==i){if(n.length>0)break;i=o.priority}await o.isSupported(e)&&n.push(o)}return n}async showNoInstallersMessage(e){let t=this.serviceContainer.get(ue);if(await t.showErrorMessage(e.envType==="Conda"?Ah.noCondaOrPipInstaller:Ah.noPipInstaller,{modal:!0},Ah.searchForHelp)===Ah.searchForHelp){let i=this.serviceContainer.get(Ir),o=i.isWindows?"Windows":i.isMac?"MacOS":"Linux";t.openUrl(`https://www.bing.com/search?q=Install Pip ${o} ${e.envType==="Conda"?"Conda":""}`)}}};Zg=g([(0,zP.injectable)(),p(0,(0,zP.inject)(ct))],Zg);var YP=k(A());var p6=require("vscode");function lo(r){switch(r){case 18:return"jupyter";case 20:return"notebook";case 23:return"pandas";case 19:return"ipykernel";case 22:return"nbconvert";case 21:return"kernelspec";case 27:return"pip";case 28:return"ensurepip";default:throw new Error(`Product ${r} cannot be installed as a Python Module.`)}}var d6=require("os");var ev=class extends tt{constructor(t,n,i){super("windowsLongPathNotEnabled",i);this.product=t;this.interpreter=n;this.originalMessage=i}};var Hr=Symbol("IPythonExecutionFactory"),aOe=Symbol("IPythonExecutionService");var Gl=class{constructor(e){this.serviceContainer=e}async installModule(e,t,n,i){let o=typeof e=="string"?e:lo(e),s=await this.getExecutionArgs(o,t,i),a=this.serviceContainer.get(Hr),l=this.serviceContainer.get(Vi),c=this.serviceContainer.get(As),u=this.serviceContainer.get(Ol);if(n.token.isCancellationRequested)return;let d=async(v,S)=>{let b=pe(),D=[];S.onCancellationRequested(()=>{n.cancel(),b.resolve()},this,D);let _;if(s.useShellExec){let fe=await l.create(void 0);if(n.token.isCancellationRequested)return;try{let de=await fe.shellExec(s.args.join(" "),{cwd:s.cwd});w(de.stdout),b.resolve()}catch(de){b.reject(de)}}else if(s.exe){let fe=await c.getActivatedEnvironmentVariables(void 0,t);if(n.token.isCancellationRequested)return;let de={...process.env};u.mergeVariables(fe||{},de),u.mergePaths(fe||{},de);let ae=await l.create(void 0);if(n.token.isCancellationRequested)return;_=ae.execObservable(s.exe,s.args,{encoding:"utf-8",token:S,env:de,cwd:s.cwd})}else{let fe=await a.createActivatedEnvironment({interpreter:t});if(n.token.isCancellationRequested)return;_=fe.execObservable(s.args,{encoding:"utf-8",token:S,cwd:s.cwd})}let L,Z,Se=[".","..","..."],ie=0;return _&&(_.out.onDidChange(fe=>{let de=Se[ie%3],ae=fe.out.trim();ie+=1;let Me=ae.length>28?`${ae.substring(0,28)}${de}`:ae;v.report({message:Me}),w(fe.out),fe.source==="stderr"&&(Z?Z+=fe.out:!Z&&fe.out.includes("ERROR: Could not install packages")&&(Z=fe.out.substring(fe.out.indexOf("ERROR: Could not install packages"))),L=fe.out)},this,D),_.out.done.then(()=>{_?.proc?.exitCode!==0?Z&&Z.includes("https://pip.pypa.io/warnings/enable-long-paths")?(Z=je(Z,{trim:!0,removeEmptyEntries:!0}).filter(fe=>!fe.startsWith("[notice]")).join(d6.EOL),b.reject(new ev(e,t,Z))):b.reject(L||_?.proc?.exitCode):b.resolve()},fe=>{b.reject(fe)}).finally(()=>G(D))),b.promise},f=this.serviceContainer.get(ue),h={location:p6.ProgressLocation.Notification,cancellable:!0,title:FN.installingModule(o)};await f.withProgress(h,async(v,S)=>d(v,S))}};var Qpe=[lo(18),lo(20)];function QP(r,e){return Qpe.includes(e)?r==="pip"?["jupyter-client<8","pyzmq<25"]:["jupyter_client<8","pyzmq<25"]:[]}var m6=require("vscode");var tv=class extends Gl{constructor(t){super(t)}get name(){return"Conda"}get displayName(){return"Conda"}get type(){return"Conda"}get priority(){return 0}async isSupported(t){if(this._isCondaAvailable===!1)return!1;let n=this.serviceContainer.get(Ls);return this._isCondaAvailable=await n.isCondaAvailable(),this._isCondaAvailable?("executable"in t?tn(t):t.envType)==="Conda":!1}async installModule(t,n,i,o){if(await super.installModule(t,n,i,o),("executable"in n?tn(n):n.envType==="Conda")&&("executable"in n?ya(n):n.isCondaEnvWithoutPython)){if(!this.serviceContainer.get(ze).isPythonExtensionActive)return;let l=await this.serviceContainer.get(it).getInterpreterDetails(n.id);l&&!l.isCondaEnvWithoutPython&&Object.assign(n,l)}}async getExecutionArgs(t,n,i=0){let s=await this.serviceContainer.get(Ls).getCondaFile(),a="executable"in n?n.environment?.name:n.envName,l=this.getEnvironmentPath(n),c=[i&1?"update":"install"];return[19,23,22,18,20].map(lo).includes(t)&&c.push("-c","conda-forge"),a?(c.push("--name"),c.push(KS(a))):l&&(c.push("--prefix"),c.push(FS(l))),i&2&&c.push("--update-deps"),i&4&&c.push("--force-reinstall"),c.push(t),c.push(...QP("conda",t)),c.push("-y"),{exe:s,args:c}}getEnvironmentPath(t){let n;if("executable"in t){if(t.environment?.folderUri)return t.environment.folderUri.fsPath;n=t.executable.uri||m6.Uri.file(t.path)}else n=t.uri;let i=pt(n.fsPath),o=Te(i);return["BIN","SCRIPTS"].indexOf(o.toUpperCase())!==-1?Ue(i,".."):i}};tv=g([(0,YP.injectable)(),p(0,(0,YP.inject)(ct))],tv);var Yx=k(A());function Ype(){let r=mm("PIPENV_MAX_DEPTH");if(r===void 0)return 3;let e=parseInt(r,10);return isNaN(e)?(C(`PIPENV_MAX_DEPTH is incorrectly set. Converting value '${r}' to number results in NaN`),1):e}async function f6(r,e){let t=mm("PIPENV_PIPFILE")||"Pipfile",n=e.lookIntoParentDirectories?Ype():1;for(;n>0&&!Ap(r,pt(r));){let i=Ue(r,t);if(await Lg(i))return i;r=pt(r),n-=1}}async function Xpe(r){let e=Ue(r,".project");if(!await Lg(e))return;let t=await OJ(e);if(!await Lg(t)){C(`The .project file inside environment folder: ${r} doesn't contain a valid path to the project`);return}return t}async function Zpe(r){let e=pt(pt(r.fsPath)),t=await Xpe(e);if(!(t===void 0||!Te(Np(e)).startsWith(`${Te(Np(t))}-`)))return f6(t,{lookIntoParentDirectories:!1})}async function h6(r,e){let t=await Zpe(r);if(!t)return!1;let n=mm("PIPENV_NO_INHERIT")===void 0,i=await f6(e.fsPath,{lookIntoParentDirectories:n});return i?Ap(t,i):!1}var g6=require("vscode");function Qx(r,e){let t="executable"in r?r.executable.uri||g6.Uri.file(r.path):r.uri;return e.getWorkspaceFolder(t)?.uri||e.rootFolder}var v6="pipenv",rv=class extends Gl{constructor(t,n){super(t);this.workspaceService=n}get name(){return"pipenv"}get type(){return"Pipenv"}get displayName(){return v6}get priority(){return 10}async isSupported(t){if(Bu(t)){let n=await this.serviceContainer.get(it).getActiveInterpreter(t),i=t?this.serviceContainer.get(ce).getWorkspaceFolder(t):void 0;return!n||!i||n.envType!=="PipEnv"?!1:h6(n.uri,i.uri)}else return("executable"in t?tn(t):t.envType)==="PipEnv"}async getExecutionArgs(t,n,i=0){let s=[i&4||i&2||i&1?"update":"install",t,"--dev"],a=Qx(n,this.workspaceService);return{args:s,exe:v6,cwd:a?we(a):void 0}}};rv=g([(0,Yx.injectable)(),p(0,(0,Yx.inject)(ct)),p(1,(0,Yx.inject)(ce))],rv);var XP=k(A());var nv=class extends Gl{constructor(e){super(e)}get name(){return"Pip"}get type(){return"Pip"}get displayName(){return"Pip"}get priority(){return 0}async isSupported(e){switch("executable"in e?tn(e):e.envType){case"Conda":case"PipEnv":case"Poetry":return!1}return this.isPipAvailable(e)}async getExecutionArgs(e,t,n=0){if(e===lo(27))return await this.serviceContainer.get(qi).isInstalled(28,t)?{args:["-m","ensurepip"]}:{args:[Ue(pO,"get-pip.py")]};let i=[],s=this.serviceContainer.get(ce).getConfiguration("http").get("proxy","");return s.length>0&&(i.push("--proxy"),i.push(s)),i.push("install","-U"),n&4&&i.push("--force-reinstall"),("executable"in t?tn(t):t.envType)==="Unknown"&&i.push("--user"),{args:["-m","pip",...i,e].concat(QP("pip",e))}}isPipAvailable(e){return this.serviceContainer.get(Hr).create({resource:void 0,interpreter:e}).then(n=>n.isModuleInstalled("pip")).catch(()=>!1)}};nv=g([(0,XP.injectable)(),p(0,(0,XP.inject)(ct))],nv);var ov=k(A());var ede=5e4,Gc=class Gc{constructor(e,t){this.command=e;this.cwd=t;this.fixCwd()}static{this.poetryPromise=new Map}static async getPoetry(e){if(tde(e))return(Gc.poetryPromise.get(e)===void 0||Pr())&&Gc.poetryPromise.set(e,Gc.locate(e)),Gc.poetryPromise.get(e)}static async locate(e){w(`Getting poetry for cwd ${e}`);function*t(){let n=FJ("poetryPath");n&&n!=="poetry"&&(yield n),yield"poetry";let i=Sp();if(i){let o=Ue(i.fsPath,".poetry","bin","poetry");nO(o)&&(yield o)}}for(let n of t()){w(`Probing poetry binary for ${e}: ${n}`);let i=new Gc(n,e);if(await i.getEnvList()!==void 0)return w(`Found poetry via filesystem probing for ${e}: ${n}`),i;w(`Failed to find poetry for ${e}: ${n}`)}w(`No poetry binary found for ${e}`)}async getEnvList(){return this.getEnvListCached(this.command,this.cwd)}async getEnvListCached(e,t){let n=await this.safeShellExecute(`${e} env list --full-path`);if(!n)return;let i="(Activated)";return(await Promise.all(je(n.stdout).map(async s=>{s.endsWith(i)&&(s=s.slice(0,-i.length));let a=s.trim();return await Lg(a)?a:void 0}))).filter(s=>s!==void 0).map(s=>s)}async getActiveEnvPath(){return this.getActiveEnvPathCached(this.cwd)}async getActiveEnvPathCached(e){let t=await this.safeShellExecute(`${this.command} env info -p`,!0);if(t)return t.stdout.trim()}async getVirtualenvsPathSetting(){let e=await this.safeShellExecute(`${this.command} config virtualenvs.path`);if(e)return e.stdout.trim()}fixCwd(){if(en()==="Windows"&&/^[a-z]:/.test(this.cwd)){let e=this.cwd.split(":");e[0]=e[0].toUpperCase(),this.cwd=e.join(":")}}async safeShellExecute(e,t=!1){let n=new $e,i=await MJ(e,{cwd:this.cwd,throwOnStdErr:!0,timeout:ede}).catch(o=>{t?w(o):C(o)});return w(`Time taken to run ${e} in ms`,n.elapsedTime),i}};g([MR(3e4)],Gc.prototype,"getEnvListCached",1),g([MR(2e4)],Gc.prototype,"getActiveEnvPathCached",1);var ZP=Gc;async function y6(r,e,t){let i=await(t?new ZP(t,e):await ZP.getPoetry(e))?.getActiveEnvPath();return i?Fg(r,i):!1}function tde(r){let e=Ue(r,"pyproject.toml");return!(!nO(e)||!KJ(e).includes("[tool.poetry]"))}var b6=require("vscode");var rde="poetry",iv=class extends Gl{constructor(t,n,i){super(t);this.workspaceService=n;this.configurationService=i}get name(){return"poetry"}get type(){return"Poetry"}get displayName(){return rde}get priority(){return 10}async isSupported(t){if(("executable"in t?tn(t):t.envType)!=="Poetry")return!1;let n=Qx(t,this.workspaceService);if(n){let i="executable"in t?t.executable.uri||b6.Uri.file(t.path):t.uri;return y6(i.fsPath,n.fsPath,this.configurationService.getSettings(void 0).poetryPath)}return!1}async getExecutionArgs(t,n){let o=[this.configurationService.getSettings(void 0).poetryPath,"add","--dev",t],s=Qx(n,this.workspaceService)?.fsPath;return{useShellExec:!0,args:o,cwd:s}}};iv=g([(0,ov.injectable)(),p(0,(0,ov.inject)(ct)),p(1,(0,ov.inject)(ce)),p(2,(0,ov.inject)(se))],iv);var zl=k(A()),w6=require("vscode");var Sr=new Map;Sr.set(18,"jupyter");Sr.set(20,"notebook");Sr.set(19,"ipykernel");Sr.set(22,"nbconvert");Sr.set(21,"kernelspec");Sr.set(23,"pandas");Sr.set(27,"pip");Sr.set(28,"ensurepip");var zc=k(A());var I6=new Set(["ipykernel","ipython-genutils","jupyter","jupyter-client","jupyter-core","ipywidgets","nbconvert","nbformat","notebook","pyzmq","pyzmq32","tornado","traitlets"].map(r=>r.toLowerCase())),S6="NOT INSTALLED",Us=class{constructor(e,t,n,i,o,s){this.pythonExtensionChecker=e;this.interpreterService=t;this.executionFactory=n;this.apiProvider=i;this.disposables=o;this.workspace=s;this.interpreterInformation=new Map;this.pendingInterpreterInformation=new Map;this.pendingInterpreterBeforeActivation=new Set;this.interpreterPackages=new Map;Us._instance=this,this.apiProvider.onDidActivatePythonExtension(()=>this.pendingInterpreterBeforeActivation.forEach(a=>this.trackPackages(a)),this,this.disposables)}static get instance(){return Us._instance}getPackageVersions(e){if(!this.pythonExtensionChecker.isPythonExtensionInstalled)return Promise.resolve(new Map);let t=ar(e.uri),n=this.interpreterInformation.get(t);return n||(n=pe(),this.interpreterInformation.set(t,n),this.trackInterpreterPackages(e).catch(m)),n.promise}async getPackageVersion(e,t){if(!this.pythonExtensionChecker.isPythonExtensionInstalled)return Promise.resolve(void 0);let n=await this.getPackageVersions(e),i=await ht(t.toLocaleLowerCase());if(!n.has(i))return;let o=n.get(i);if(o)return o===S6?void 0:o}trackPackages(e,t){this.trackPackagesInternal(e,t).catch(m)}async listPackages(e){if(!this.pythonExtensionChecker.isPythonExtensionInstalled)return[];let t=this.workspace.getWorkspaceFolderIdentifier(e);if(!this.interpreterPackages.has(t)){let n=this.listPackagesImpl(e);this.interpreterPackages.set(t,n),n.catch(i=>{this.interpreterPackages.get(t)===n&&this.interpreterPackages.delete(t),J(`Failed to get list of installed packages for ${t}`,i)})}return this.interpreterPackages.get(t).then(n=>Array.from(n))}async listPackagesImpl(e){let t=await this.interpreterService.getActiveInterpreter(e);if(!t)return new Set;let n=await this.executionFactory.createActivatedEnvironment({interpreter:t,resource:e}),i="389a87b7-288f-4235-92bf-73bf19bf6491",o=`import pkgutil;import json;print("${i}");print(json.dumps(list([x.name for x in pkgutil.iter_modules()])));print("${i}");`,s=await n.exec(["-c",o],{throwOnStdErr:!1});if(s.stdout){let a=JSON.parse(s.stdout.split(i)[1].trim());return new Set(a.concat(a.map(l=>l.toLowerCase())))}else return C(`Failed to get list of installed packages for ${$r(t.uri)}`,s.stderr),new Set}async trackPackagesInternal(e,t){if(!this.pythonExtensionChecker.isPythonExtensionActive){this.pendingInterpreterBeforeActivation.add(e);return}let n;if(Bu(e)){let i=await this.interpreterService.getActiveInterpreter(e);if(!i)return;n=i}else n=e;this.trackInterpreterPackages(n,t).catch(m)}async trackInterpreterPackages(e,t){let n=ar(e.uri);if(this.pendingInterpreterInformation.has(n)&&!t)return;let i=this.getPackageInformation({interpreter:e});i.finally(()=>{let o=setTimeout(()=>{this.pendingInterpreterInformation.get(n)===i&&this.pendingInterpreterInformation.delete(n)},3e5),s={dispose:()=>clearTimeout(o)};this.disposables.push(s)}).catch(m),this.pendingInterpreterInformation.set(n,i)}async getPackageInformation({interpreter:e}){if(e.isCondaEnvWithoutPython)return;let n=await(await this.executionFactory.createActivatedEnvironment({interpreter:e})).execModule("pip",["list"],{throwOnStdErr:!1,mergeStdOutErr:!0}),i=new Map;await Promise.all(Array.from(I6).map(async a=>{i.set(await ht(a),S6)})),await Promise.all(n.stdout.split(`
`).map(a=>a.trim().toLowerCase()).filter(a=>a.length>0).map(async a=>{let l=a.split(" ").filter(f=>f.trim().length);if(l.length<2)return;let[c,u]=l;if(!I6.has(c.toLowerCase().trim()))return;let d=lp(u);i.set(await ht(c),d||"")}));let o=ar(e.uri),s=this.interpreterInformation.get(o);s||(s=pe(),this.interpreterInformation.set(o,s)),s.resolve(i)}};Us=g([(0,zc.injectable)(),p(0,(0,zc.inject)(ze)),p(1,(0,zc.inject)(it)),p(2,(0,zc.inject)(Hr)),p(3,(0,zc.inject)(Xt)),p(4,(0,zc.inject)(O)),p(5,(0,zc.inject)(ce))],Us);async function eD(r,e,t){if(Bu(t))return;let n=`${await Dl(t)}#${Sr.get(e)}`;await r.update(n,!0)}async function x6(r,e,t){let n=`${await Dl({uri:t})}#${Sr.get(e)}`;await r.update(n,void 0)}async function C6(r,e,t){let n=`${await Dl(t)}#${Sr.get(e)}`;return r.get(n,!1)}var tD=Symbol("IReservedPythonNamedProvider"),Lp=Symbol("IInterpreterPackages"),rD=Symbol("IWorkspaceInterpreterTracker");async function k6(r,e,t){let n=`${await Dl(t)}#${Sr.get(e)}`;if(r.get(n,!1))return!0;let i=lo(e),o=Us.instance?Us.instance.getPackageVersion(t,i).then(s=>typeof s=="string"?"found":"notfound").catch(s=>{C("Failed to get interpreter package version",s)}):Promise.resolve(void 0);try{let s=await Dr(500,o);if(typeof s=="string")return s==="found"}catch{C(`Failed to check if package exists ${Sr.get(e)}`)}}var nD=class{constructor(e,t){this.serviceContainer=e;this.appShell=e.get(ue),this.configService=e.get(se),this.workspaceService=e.get(ce),this.productService=e.get(Gx),this.persistentStateFactory=e.get(Sl)}async install(e,t,n,i,o){let a=await this.serviceContainer.get(GP).getInstallationChannel(e,t);if(!a)return 2;if(n.token.isCancellationRequested)return 3;let l=i===!0?6:void 0;return o===!0&&(l=l?l|8:8),await a.installModule(e,t,n,l),n.token.isCancellationRequested?3:(t.isCondaEnvWithoutPython&&(t.isCondaEnvWithoutPython=!1),this.isInstalled(e,t).then(c=>c?0:2))}async isInstalled(e,t){let n=this.getExecutableNameFromSettings(e,void 0);return this.isExecutableAModule(e,void 0)?(await this.serviceContainer.get(Hr).createActivatedEnvironment({resource:void 0,interpreter:t})).isModuleInstalled(n):(await this.serviceContainer.get(Vi).create(void 0)).exec(n,["--version"],{mergeStdOutErr:!0}).then(()=>!0).catch(()=>!1)}getExecutableNameFromSettings(e,t){let n=this.productService.getProductType(e);return this.serviceContainer.get(zx,n).getExecutableNameFromSettings(e,t)}isExecutableAModule(e,t){let n=this.productService.getProductType(e);return this.serviceContainer.get(zx,n).isExecutableAModule(e,t)}};g([gi("Checking if product is installed"),p(1,Nc("path"))],nD.prototype,"isInstalled",1);var sv=class{constructor(e,t,n,i){this.serviceContainer=e;this.interpreterPackages=t;this.memento=n;this.output=i;this._onInstalled=new w6.EventEmitter;this.productService=e.get(Gx)}get onInstalled(){return this._onInstalled.event}dispose(){}async install(e,t,n,i,o){t&&this.interpreterPackages.trackPackages(t);let s="installed";try{let a=await this.createInstaller(e).install(e,t,n,i,o);switch(eD(this.memento,e,t).catch(m),a===0&&this._onInstalled.fire({product:e,resource:t}),a){case 3:s="cancelled";break;case 0:s="installed";break;case 2:s="ignored";break;case 1:s="disabled";break;default:break}return a}catch(a){throw s="failed",a}finally{R("DS_INTERNAL.PYTHON_MODULE_INSTALL",void 0,{action:s,moduleName:Sr.get(e)})}}async isInstalled(e,t){return this.createInstaller(e).isInstalled(e,t)}translateProductToModuleName(e){return lo(e)}createInstaller(e){switch(this.productService.getProductType(e)){case"DataScience":return new nD(this.serviceContainer,this.output);default:break}throw new Error(`Unknown product ${e}`)}};sv=g([(0,zl.injectable)(),p(0,(0,zl.inject)(ct)),p(1,(0,zl.inject)(Lp)),p(2,(0,zl.inject)(He)),p(2,(0,zl.named)(It)),p(3,(0,zl.inject)(Wo)),p(3,(0,zl.named)(Wu))],sv);var iD=k(A());var bO=class{constructor(e){this.serviceContainer=e;this.configService=e.get(se),this.productInstaller=e.get(qi)}isExecutableAModule(e,t){if(e===21)return!1;let n;try{n=this.productInstaller.translateProductToModuleName(e,2)}catch{}let i=this.getExecutableNameFromSettings(e,t);return typeof n=="string"&&n.length>0&&Te(i)===i}},av=class extends bO{constructor(e){super(e)}getExecutableNameFromSettings(e,t){return this.productInstaller.translateProductToModuleName(e,2)}};av=g([(0,iD.injectable)(),p(0,(0,iD.inject)(ct))],av);var P6=k(A());var lv=class{constructor(){this.ProductTypes=new Map;this.ProductTypes.set(18,"DataScience"),this.ProductTypes.set(20,"DataScience"),this.ProductTypes.set(19,"DataScience"),this.ProductTypes.set(22,"DataScience"),this.ProductTypes.set(21,"DataScience"),this.ProductTypes.set(23,"DataScience"),this.ProductTypes.set(27,"DataScience"),this.ProductTypes.set(28,"DataScience")}getProductType(e){return this.ProductTypes.get(e)}};lv=g([(0,P6.injectable)()],lv);var IO=require("vscode"),cv=k(A());var Ws=class{constructor(e,t,n){this.title=y.localPythonEnvironments;this._onDidChange=new IO.EventEmitter;this._onDidChangeStatus=new IO.EventEmitter;this.onDidChange=this._onDidChange.event;this.onDidChangeStatus=this._onDidChangeStatus.event;this.refreshedOnceBefore=!1;this.disposables=[];this.promiseMonitor=new Eo;this._status="idle";n.push(this),this.promiseMonitor.onStateChange(()=>this.status=this.promiseMonitor.isComplete?"idle":"discovering",this,this.disposables);let i=()=>{let o=e.getNewApi();this.promiseMonitor.push(o),o.then(s=>{if(this.api=s,!s){this.status="idle",this._onDidChangeStatus.fire();return}this._onDidChange.fire(),s.environments.onDidChangeEnvironments(()=>this._onDidChange.fire(),this,this.disposables)}).catch(s=>C("Failed to get python api",s))};t.isPythonExtensionInstalled?i():t.onPythonExtensionInstallationStatusChanged(()=>{t.isPythonExtensionInstalled&&i()},this,this.disposables)}get items(){return this.api?(this.refreshedOnceBefore||(this.refreshedOnceBefore=!0,this.refresh().catch(m)),this.api.environments.known):[]}get status(){return this._status}set status(e){this._status=e,this._onDidChangeStatus.fire()}activate(){}dispose(){G(this.disposables)}async refresh(){if(!this.api)return;let e=this.api.environments.refreshEnvironments();this.promiseMonitor.push(e),await e.catch(m)}withFilter(e){return new Proxy(this,{get(t,n){switch(n){case"items":return t.items.filter(e);case"dispose":return m;default:return t[n]}}})}};Ws=g([(0,cv.injectable)(),p(0,(0,cv.inject)(Xt)),p(1,(0,cv.inject)(ze)),p(2,(0,cv.inject)(O))],Ws);var Nm=k(A());function SO(r,e){if(Array.isArray(r)){let t=r.slice(1);return e&&t.push(...e),{args:t,command:r[0],python:[...r],pythonExecutable:r[r.length-1]}}return{command:r,args:e||[],python:[r],pythonExecutable:r}}function D6(r,e){let t={command:r.command,args:[...r.args],python:[...r.python],pythonExecutable:r.pythonExecutable};return e&&t.args.push(...e),t.pythonExecutable===void 0&&(t.pythonExecutable=t.python[t.python.length-1]),t}var N6=require("vscode");function xO(r,e){return["-m",r,...e]}function T6(){let r=["-c","import sys;print(sys.executable)"];function e(t){return t.trim()}return[r,e]}function _6(r){let e=["-c",`import ${r};print('6af208d0-cb9c-427f-b937-ff563e17efdf')`];function t(n){return n.includes("6af208d0-cb9c-427f-b937-ff563e17efdf")?!0:(w(`Module ${r} is not installed. Output ${n}`),!1)}return[e,t]}async function A6(r,e){let[t,n]=T6(),i=D6(r,t),o=await e(i.command,i.args);return N6.Uri.file(n(o.stdout))}var oD=class{constructor(e,t){this.deps=t;if(this.pythonEnvId=e.id,"executable"in e){if(!e.executable.uri)throw new Error(`interpreter.executable.uri is not defined for ${e.id}`);this.executable=e.executable.uri}else this.executable=e.uri}getExecutionInfo(e=[]){let t=this.deps.getPythonArgv(this.executable);return SO(t,e)}getExecutionObservableInfo(e=[]){let t=this.deps.getObservablePythonArgv(this.executable);return SO(t,e)}async getExecutablePath(){if(await this.deps.isValidExecutable(this.executable))return this.executable;let e=this.getExecutionInfo();return A6(e,this.deps.exec)}async isModuleInstalled(e){let[t,n]=_6(e),i=this.getExecutionInfo(t);try{let o=await this.deps.exec(i.command,i.args,{throwOnStdErr:!1});return n(o.stdout)}catch(o){return J(`Module ${e} not installed in environment ${this.pythonEnvId}`,o),!1}}};function M6(r,e,t,n,i){return{getPythonArgv:o=>e||[we(o)],getObservablePythonArgv:o=>t||[we(o)],isValidExecutable:r,exec:async(o,s,a)=>n(o,s,Object.assign({throwOnStdErr:!0},a||{})),shellExec:async(o,s)=>i(o,{timeout:s})}}function O6(r,e,t){let n=M6(async i=>t.exists(i),void 0,void 0,(i,o,s)=>e.exec(i,o,s),(i,o)=>e.shellExec(i,o));return new oD(r,n)}function K6(r,e,t,n,i){let o=["run"];e.name===""?o.push("-p",e.path):o.push("-n",e.name);let s=[r,...o,"python"],a=M6(async l=>i.exists(l),s,void 0,(l,c,u)=>n.exec(l,c,u),(l,c)=>n.shellExec(l,c));return new oD(t,a)}var sD=class extends tt{constructor(t){super("notinstalled",`Module '${t}' not installed.`);this.moduleName=t}};var CO=class{constructor(e){this.deps=e}execObservable(e,t){let n={...t},i=this.deps.getExecutionObservableInfo(e);return this.deps.execObservable(i.command,i.args,n)}execModuleObservable(e,t,n){let i=xO(e,t),o={...n},s=this.deps.getExecutionObservableInfo(i),a={...n};return a.token=void 0,this.deps.execObservable(s.command,s.args,o)}async exec(e,t){let n={...t},i=this.deps.getExecutionInfo(e);return this.deps.exec(i.command,i.args,n)}async execModule(e,t,n){let i=xO(e,t),o={...n},s=this.deps.getExecutionInfo(i),a=await this.deps.exec(s.command,s.args,o);if(e&&Uw.outputHasModuleNotInstalledError(e,a.stderr)&&!await this.deps.isModuleInstalled(e))throw new sD(e);return a}};function F6(r,e){let t={isModuleInstalled:async n=>e.isModuleInstalled(n),getExecutionInfo:n=>e.getExecutionInfo(n),getExecutionObservableInfo:n=>e.getExecutionObservableInfo(n),exec:async(n,i,o)=>r.exec(n,i,o),execObservable:(n,i,o)=>r.execObservable(n,i,o)};return new CO(t)}var uv=class{constructor(e,t,n,i){this.serviceContainer=e;this.activationHelper=t;this.processServiceFactory=n;this.workspace=i;this.disposables=this.serviceContainer.get(O),this.fileSystem=this.serviceContainer.get(Ze)}async create(e){let t=await this.processServiceFactory.create(e.resource);return L6(e.interpreter,t,this.fileSystem,void 0)}async createActivatedEnvironment(e){if(e.resource=e.resource?e.resource:this.workspace.workspaceFolders?.length?this.workspace.workspaceFolders[0].uri:void 0,!this.workspace.isTrusted)throw new Error("Workspace not trusted");let t=await this.activationHelper.getActivatedEnvironmentVariables(e.resource,e.interpreter);if(!(t&&Object.keys(t).length>0))return this.create({resource:e.resource,interpreter:e.interpreter});let i=new $l({...t});return this.disposables.push(i),L6(e.interpreter,i,this.fileSystem)}};uv=g([(0,Nm.injectable)(),p(0,(0,Nm.inject)(ct)),p(1,(0,Nm.inject)(As)),p(2,(0,Nm.inject)(Vi)),p(3,(0,Nm.inject)(ce))],uv);function L6(r,e,t,n){let i=O6(r,e,t);if(n){let[s,a]=n;i=K6(s,a,r,e,t)}let o=F6(e,i);return{isModuleInstalled:s=>i.isModuleInstalled(s),execObservable:(s,a)=>o.execObservable(s,a),execModuleObservable:(s,a,l)=>o.execModuleObservable(s,a,l),exec:(s,a)=>o.exec(s,a),execModule:(s,a,l)=>o.execModule(s,a,l)}}var Ql=k(A()),eC=require("vscode");var U6="https://aka.ms/JupyterKernelStartFailureOverrideReservedName",W6=["abc","aifc","antigravity","argparse","array","ast","asynchat","asyncio","asyncore","atexit","audioop","base64","bdb","binascii","binhex","bisect","builtins","bz2","cProfile","calendar","cgi","cgitb","chunk","cmath","cmd","code","codecs","codeop","collections","colorsys","compileall","concurrent","configparser","contextlib","contextvars","copy","copyreg","crypt","csv","ctypes","curses","dataclasses","datetime","dbm","decimal","difflib","dis","distutils","doctest","email","encodings","ensurepip","enum","errno","faulthandler","fcntl","filecmp","fileinput","fnmatch","formatter","fractions","ftplib","functools","gc","genericpath","getopt","getpass","gettext","glob","graphlib","grp","gzip","hashlib","heapq","hmac","html","http","idlelib","imaplib","imghdr","imp","importlib","inspect","io","ipaddress","itertools","json","keyword","lib2to3","linecache","locale","logging","lzma","mailbox","mailcap","marshal","math","mimetypes","mmap","modulefinder","multiprocessing","netrc","nis","nntplib","ntpath","nturl2path","numbers","opcode","operator","optparse","os","parser","pathlib","pdb","pickle","pickletools","pipes","pkgutil","platform","plistlib","poplib","posix","posixpath","pprint","profile","pstats","pty","pwd","py_compile","pyclbr","pydoc","pydoc_data","queue","quopri","random","re","readline","reprlib","resource","rlcompleter","runpy","sched","secrets","select","selectors","shelve","shlex","shutil","signal","site","smtpd","smtplib","sndhdr","socket","socketserver","sqlite3","sre_compile","sre_constants","sre_parse","ssl","stat","statistics","string","stringprep","struct","subprocess","sunau","symbol","symtable","sys","sysconfig","syslog","tabnanny","tarfile","telnetlib","tempfile","termios","textwrap","this","threading","time","timeit","tkinter","token","tokenize","trace","traceback","tracemalloc","tty","turtle","turtledemo","types","typing","unicodedata","unittest","urllib","uu","uuid","warnings","wave","weakref","webbrowser","wsgiref","xdrlib","xml","xmlrpc","zipapp","zipfile","zipimport","zlib","zoneinfo"];var a7=k(Zx());var Or=Symbol("IFileSystemNode");var Ede="jupyter.pythonPackages",TO="diagnostics.reservedPythonNames.exclude",dv=class{constructor(e,t,n,i,o){this.cache=e;this.workspace=t;this.platform=n;this.fs=o;this.ignoredFiles=new Set;this.cachedModules=new Set;this.pendingUpdate=Promise.resolve();this.disposables=[];i.push(this),this.cachedModules=new Set(this.cache.get(Ede,W6).map(s=>s.toLowerCase())),t.onDidChangeConfiguration(s=>{s.affectsConfiguration(`jupyter.${TO}`)&&this.initializeIgnoreList()},this,this.disposables),this.initializeIgnoreList()}dispose(){G(this.disposables)}async getUriOverridingReservedPythonNames(e){let[t,n]=await Promise.all([this.fs.searchLocal("*.py",e.fsPath,!0),this.fs.searchLocal("*/__init__.py",e.fsPath,!0)]),i=[],o=Promise.all(t.map(a=>eC.Uri.joinPath(e,a)).map(async a=>{await this.isReserved(a)&&i.push({uri:a,type:"file"})})),s=Promise.all(n.map(a=>eC.Uri.joinPath(e,a)).map(async a=>{await this.isReserved(a)&&i.push({uri:a,type:"__init__"})}));return await Promise.all([o,s]),i}async isReserved(e){if(!e.fsPath.toLowerCase().endsWith(".py"))return!1;await this.pendingUpdate;let t=this.platform.isWindows?e.fsPath.toLowerCase():e.fsPath;if(Array.from(this.ignoredFiles).some(o=>{if(o===t||(0,a7.default)(t,o,{dot:!0}))return!0}))return!1;let n=In(e,Yu(e)).toLowerCase(),i=n==="__init__"?In(oi(e)).toLowerCase():n;return this.cachedModules.has(i)}async addToIgnoreList(e){await this.pendingUpdate;let t=this.workspace.getConfiguration("jupyter"),n=this.platform.isWindows?e.fsPath.toLowerCase():e.fsPath;this.initializeIgnoreList();let i=this.ignoredFiles.size;if(this.ignoredFiles.add(n),i!==this.ignoredFiles.size)return this.pendingUpdate=this.pendingUpdate.finally(()=>t.update(TO,Array.from(this.ignoredFiles),eC.ConfigurationTarget.Global)),this.pendingUpdate}initializeIgnoreList(){let t=this.workspace.getConfiguration("jupyter").get(TO,[]);this.platform.isWindows&&(t=t.map(n=>n.toLowerCase())),this.ignoredFiles=new Set(t)}};dv=g([(0,Ql.injectable)(),p(0,(0,Ql.inject)(He)),p(0,(0,Ql.named)(It)),p(1,(0,Ql.inject)(ce)),p(2,(0,Ql.inject)(Ir)),p(3,(0,Ql.inject)(O)),p(4,(0,Ql.inject)(Or))],dv);var tC=k(A());var RO=k(JP());var _O="_VSCODE_getVariable",mv=RO.default`
                            try:
                                del _VSCODE_getVariable
                            except:
                                pass
                            `,Yl=class{constructor(e,t){this.fs=e;this.context=t}async generateCodeToGetVariableInfo(e){let t=await this.getContentsOfScript(),n=e.isDebugging?"True":"False",i=`${_O}("info", ${n}, ${e.variableName})`;return e.isDebugging?{initializeCode:t,code:i,cleanupCode:mv}:{code:`${t}

${i}

${mv}`}}async generateCodeToGetVariableProperties(e){let t=await this.getContentsOfScript(),n=e.isDebugging?"True":"False",i=`${_O}("properties", ${n}, ${e.variableName}, ${e.stringifiedAttributeNameList})`;return e.isDebugging?{initializeCode:t,code:i,cleanupCode:mv}:{code:`${t}

${i}

${mv}`}}async generateCodeToGetVariableTypes(e){let n=`${await this.getContentsOfScript()}

_VSCODE_rwho_ls = %who_ls
`,i=e.isDebugging?"True":"False",o=RO.default`
        try:
            del _VSCODE_rwho_ls
        except:
            pass
        `,s=`${_O}("types", ${i}, _VSCODE_rwho_ls)`;return e.isDebugging?{initializeCode:n,code:s,cleanupCode:`${mv}
${o}`}:{code:`${n}${s}

${mv}
${o}`}}async getContentsOfScript(){if(Yl.contentsOfScript)return Yl.contentsOfScript;let e=Yt(this.context.extensionUri,"pythonFiles","vscode_datascience_helpers","getVariableInfo","vscodeGetVariableInfo.py"),t=await this.fs.readFile(e);return Yl.contentsOfScript=t,t}};Yl=g([(0,tC.injectable)(),p(0,(0,tC.inject)(Ze)),p(1,(0,tC.inject)(dt))],Yl);var fv=k(A());var _a=class{constructor(e){this.workspaceInterpreterTracker=e;_a.isActiveWorkspaceInterpreter=this.isActiveWorkspaceInterpreterImpl.bind(this)}activate(){this.workspaceInterpreterTracker?.activate()}isActiveWorkspaceInterpreterImpl(e,t){return this.workspaceInterpreterTracker?.isActiveWorkspaceInterpreter(e,t)??!1}};_a.isActiveWorkspaceInterpreter=()=>!1,_a=g([(0,fv.injectable)(),p(0,(0,fv.inject)(rD)),p(0,(0,fv.optional)())],_a);var Qc=k(A());var hv=class{constructor(e,t,n,i,o,s){this.extensions=e;this.workspaceService=t;this.pythonExtensionChecker=n;this.disposables=i;this.interpreterService=o;this.webExtension=s;this.workspaceInterpreters=new Map}activate(){this.trackActiveInterpreters(),this.extensions.onDidChange(this.trackActiveInterpreters,this,this.disposables)}isActiveWorkspaceInterpreter(e,t){if(!t)return!1;let n=this.workspaceService.getWorkspaceFolderIdentifier(e),i=this.workspaceInterpreters.get(n);return i?Co(i,t.uri):!1}trackActiveInterpreters(){this.webExtension||this.trackingInterpreters||!this.pythonExtensionChecker.isPythonExtensionActive||(this.trackingInterpreters=!0,this.interpreterService.onDidChangeInterpreter(async()=>{let e=Array.isArray(this.workspaceService.workspaceFolders)?this.workspaceService.workspaceFolders.map(t=>t.uri):[];await Promise.all(e.map(async t=>{try{let n=this.workspaceService.getWorkspaceFolderIdentifier(t),i=await this.interpreterService.getActiveInterpreter(t);this.workspaceInterpreters.set(n,i?.uri)}catch{}}))},this,this.disposables))}};hv=g([(0,Qc.injectable)(),p(0,(0,Qc.inject)(rr)),p(1,(0,Qc.inject)(ce)),p(2,(0,Qc.inject)(ze)),p(3,(0,Qc.inject)(O)),p(4,(0,Qc.inject)(it)),p(5,(0,Qc.inject)(on))],hv);function l7(r){r.addSingleton(Hr,uv),r.addSingleton(Ls,Ls),r.addSingleton(Ll,Ll),r.addSingleton(Lp,Us),r.addSingleton(Ie,_a),r.addSingleton(rD,hv),r.addSingleton(Ie,Yg),r.addSingleton(Ie,Xg),r.addSingleton(Ie,Kp),r.addSingleton(xi,xi),r.addSingleton(tD,dv),r.addSingleton(_h,Yl),r.addSingleton(Rh,Hl),r.addSingleton(Rm,tv),r.addSingleton(Rm,nv),r.addSingleton(Rm,rv),r.addSingleton(Rm,iv),r.addSingleton(GP,Zg),r.addSingleton(Gx,lv),r.addSingleton(qi,sv),r.addSingleton(zx,av,"DataScience"),r.addSingleton(Ws,Ws),r.addBinding(Ws,Ie)}var cD=k(A()),uD=require("vscode");var u7=new Set;function p7(r){u7.add(r)}function c7(r){try{u7.forEach(e=>e.report(r))}catch(e){C("Failed to report progress",e)}}function gv(r){return function(e,t,n){let i=n.value;n.value=async function(...o){return c7({action:r,phase:"started"}),i.apply(this,o).finally(()=>{c7({action:r,phase:"completed"})})}}}var es=class{constructor(e){this.appShell=e;this.progressReporters=[];this.actionPhases=new Map;this.currentActions=[];p7(this)}get currentAction(){return this.currentActions.length===0?void 0:this.currentActions[this.currentActions.length-1]}createProgressIndicator(e,t=!1){let n=new uD.CancellationTokenSource,i=pe(),o={location:uD.ProgressLocation.Notification,cancellable:t,title:e};return this.appShell.withProgress(o,async(s,a)=>{a.onCancellationRequested(()=>{a.isCancellationRequested&&n.cancel(),i.resolve()}),n.token.onCancellationRequested(()=>{i.resolve()}),this.progressReporters.push(s),await i.promise}).then(m,m),{token:n.token,dispose:()=>i.resolve()}}report(e){if(this.progressReporters.length!==0&&(this.actionPhases.set(e.action,e.phase),e.phase==="started"&&this.currentActions.push(e.action),!!this.currentAction)){for(;this.actionPhases.get(this.currentAction)&&this.actionPhases.get(this.currentAction)!=="started";)this.actionPhases.delete(this.currentAction),this.currentActions.pop();this.updateProgressMessage()}}updateProgressMessage(){if(!this.currentAction||this.progressReporters.length===0)return;let e=Rk(this.currentAction);e&&this.progressReporters.forEach(t=>t.report({message:e}))}};es=g([(0,cD.injectable)(),p(0,(0,cD.inject)(ue))],es);var d7=k(A()),Gr=require("vscode");var vv=class{get activeColorTheme(){return Gr.window.activeColorTheme}get onDidChangeWindowState(){return Gr.window.onDidChangeWindowState}showInformationMessage(e,t,...n){return Gr.window.showInformationMessage(e,t,...n)}showWarningMessage(e,t,...n){return Gr.window.showWarningMessage(e,t,...n)}showErrorMessage(e,t,...n){return Gr.window.showErrorMessage(e,t,...n)}showQuickPick(e,t,n){return Gr.window.showQuickPick(e,t,n)}showOpenDialog(e){return Gr.window.showOpenDialog(e)}showSaveDialog(e){return Gr.window.showSaveDialog(e)}showInputBox(e,t){return Gr.window.showInputBox(e,t)}openUrl(e){Gr.env.openExternal(Gr.Uri.parse(e)).then(m,m)}setStatusBarMessage(e,t){return Gr.window.setStatusBarMessage(e,t)}createStatusBarItem(e,t){return Gr.window.createStatusBarItem(e,t)}showWorkspaceFolderPick(e){return Gr.window.showWorkspaceFolderPick(e)}withProgress(e,t){return Gr.window.withProgress(e,t)}withProgressCustomIcon(e,t){let n=new Gr.CancellationTokenSource().token,i=this.createStatusBarItem(Gr.StatusBarAlignment.Left),o={report:s=>{i.text=`${e} ${s.message}`}};return i.show(),t(o,n).then(s=>(i.dispose(),s))}createQuickPick(){return Gr.window.createQuickPick()}createInputBox(){return Gr.window.createInputBox()}createTreeView(e,t){return Gr.window.createTreeView(e,t)}createOutputChannel(e){return Gr.window.createOutputChannel(e)}};vv=g([(0,d7.injectable)()],vv);var m7=k(A()),rC=require("vscode");var NO=new Set(["setContext"]),yv=class{registerCommand(e,t,n){return NO.add(e),rC.commands.registerCommand(e,(...i)=>(R("DS_INTERNAL.COMMAND_EXECUTED",void 0,{command:e}),n?t.call(n,...i):t(...i)),n)}registerTextEditorCommand(e,t,n){return NO.add(e),rC.commands.registerTextEditorCommand(e,(i,o,...s)=>(R("DS_INTERNAL.COMMAND_EXECUTED",void 0,{command:e}),n?t.call(n,i,o,...s):t(i,o,...s)),n)}executeCommand(e,...t){return NO.has(e)||R("DS_INTERNAL.COMMAND_EXECUTED",void 0,{command:e}),rC.commands.executeCommand(e,...t)}getCommands(e){return rC.commands.getCommands(e)}};yv=g([(0,m7.injectable)()],yv);var fD=k(A());var iC=require("vscode");var Am=require("vscode");var nC=class r{constructor(e){this.jupyterConfig=e}static{this.migratedSettings={interactiveWindowMode:"interactiveWindow.creationMode",interactiveWindowViewColumn:"interactiveWindow.viewColumn",splitRunFileIntoCells:"interactiveWindow.splitRunFileIntoCells",sendSelectionToInteractiveWindow:"interactiveWindow.textEditor.executeSelection",normalizeSelectionForInteractiveWindow:"interactiveWindow.textEditor.normalizeSelection",magicCommandsAsComments:"interactiveWindow.textEditor.magicCommandsAsComments",enableAutoMoveToNextCell:"interactiveWindow.textEditor.autoMoveToNextCell",newCellOnRunLast:"interactiveWindow.textEditor.autoAddNewCell",pythonCellFolding:"interactiveWindow.textEditor.cellFolding",enableCellCodeLens:"interactiveWindow.codeLens.enable",addGotoCodeLenses:"interactiveWindow.codeLens.enableGotoCell",codeLenses:"interactiveWindow.codeLens.commands",debugCodeLenses:"interactiveWindow.codeLes.debugCommands",codeRegularExpression:"interactiveWindow.cellMarker.codeRegex",markdownRegularExpression:"interactiveWindow.cellMarker.markdownRegex",decorateCells:"interactiveWindow.cellMarker.decorateCells",defaultCellMarker:"interactiveWindow.cellMarker.default"}}static{this.fullSettingIds={...this.migratedSettings}}async migrateSettings(){let e=[];for(let t of Object.keys(r.migratedSettings))e.push(...this.migrateSetting(t,r.migratedSettings[t]));try{await Promise.all(e)}catch(t){pD(t)}}migrateSetting(e,t){let n=this.jupyterConfig.inspect(e),i=this.jupyterConfig.inspect(t),o=[];if(n?.workspaceValue!==void 0){let s=Promise.resolve();i?.workspaceValue===void 0&&(s=this.jupyterConfig.update(t,n.workspaceValue,Am.ConfigurationTarget.Workspace)),o.push(s.then(()=>this.jupyterConfig.update(e,void 0,Am.ConfigurationTarget.Workspace),pD))}if(n?.workspaceFolderValue!==void 0){let s=Promise.resolve();i?.workspaceFolderValue===void 0&&(s=this.jupyterConfig.update(t,n.workspaceFolderValue,Am.ConfigurationTarget.WorkspaceFolder)),o.push(s.then(()=>this.jupyterConfig.update(e,void 0,Am.ConfigurationTarget.WorkspaceFolder),pD))}if(n?.globalValue!==void 0){let s=Promise.resolve();i?.globalValue===void 0&&(s=this.jupyterConfig.update(t,n.globalValue,Am.ConfigurationTarget.Global)),o.push(s.then(()=>this.jupyterConfig.update(e,void 0,Am.ConfigurationTarget.Global),pD))}return o}};function pD(r){J("Error migrating Jupyter configuration",r)}function wde(r){return(e,t,n)=>{let i=null,o=null;if(typeof n.value=="function"?(i="value",o=n.value):typeof n.get=="function"&&(i="get",o=n.get),!o)throw new Error("not supported");n[i]=r(o,t)}}function dD(r,e,t){return wde((n,i)=>{let o=`$debounce$${i}`,s=`$debounce$result$${i}`;return function(...a){this[s]||(this[s]=t?t():void 0),clearTimeout(this[o]),e&&(this[s]=e(this[s],...a),a=[this[s]]),this[o]=setTimeout(()=>{n.apply(this,a),this[s]=t?t():void 0},r)}})}var Ra=class Ra{constructor(e,t,n,i){this._systemVariablesCtor=t;this._type=n;this._workspace=i;this.logging={level:"error"};this.allowUnauthorizedRemoteConnection=!1;this.jupyterInterruptTimeout=1e4;this.jupyterLaunchTimeout=6e4;this.jupyterLaunchRetries=3;this.notebookFileRoot="";this.useDefaultConfigForJupyter=!1;this.searchForJupyter=!1;this.sendSelectionToInteractiveWindow=!1;this.normalizeSelectionForInteractiveWindow=!0;this.splitRunFileIntoCells=!0;this.markdownRegularExpression="";this.codeRegularExpression="";this.errorBackgroundColor="";this.ignoreVscodeTheme=!1;this.variableExplorerExclude="";this.decorateCells="currentCell";this.enableCellCodeLens=!1;this.askForLargeDataFrames=!1;this.enableAutoMoveToNextCell=!1;this.askForKernelRestart=!1;this.generateSVGPlots=!1;this.codeLenses="";this.debugCodeLenses="";this.debugpyDistPath="";this.stopOnFirstLineWhileDebugging=!1;this.magicCommandsAsComments=!1;this.pythonExportMethod="direct";this.stopOnError=!1;this.remoteDebuggerPort=0;this.addGotoCodeLenses=!1;this.runStartupCommands=[];this.debugJustMyCode=!1;this.defaultCellMarker="";this.themeMatplotlibPlots=!1;this.variableQueries=[];this.disableJupyterAutoStart=!1;this.enablePythonKernelLogging=!1;this.jupyterCommandLineArguments=[];this.widgetScriptSources=[];this.interactiveWindowMode="multiple";this.pythonCellFolding=!0;this.interactiveWindowViewColumn="secondGroup";this.disableZMQSupport=!1;this.forceIPyKernelDebugger=!1;this.verboseLogging=!1;this.showVariableViewWhenDebugging=!0;this.newCellOnRunLast=!0;this.pythonCompletionTriggerCharacters="";this.logKernelOutputSeparately=!1;this.development=!1;this.poetryPath="";this.excludeUserSitePackages=!1;this.enableExtendedKernelCompletions=!1;this.useOldKernelResolve=!1;this.formatStackTraces=!1;this._changeEmitter=new iC.EventEmitter;this._disposables=[];this._workspaceRoot=e,this.initialize(),i&&i.isTrusted===!1&&(this.disableJupyterAutoStart=!0)}get onDidChange(){return this._changeEmitter.event}static{this.jupyterSettings=new Map}static getInstance(e,t,n,i){let o=Ra.getSettingsUriAndTarget(e,i).uri,s=o?o.path:"",a=Ra.jupyterSettings.get(s);return a?a._type==="web"&&n==="node"&&(a._systemVariablesCtor=t,a._type=n):(a=new Ra(o,t,n,i),Ra.jupyterSettings.set(s,a)),a}static getSettingsUriAndTarget(e,t){let n=e?t.getWorkspaceFolder(e):void 0,i=n?n.uri:void 0;!i&&Array.isArray(t.workspaceFolders)&&t.workspaceFolders.length>0&&(i=t.workspaceFolders[0].uri);let o=i?iC.ConfigurationTarget.WorkspaceFolder:iC.ConfigurationTarget.Global;return{uri:i,target:o}}static dispose(){if(!Pr())throw new Error("Dispose can only be called from unit tests");Ra.jupyterSettings.forEach(e=>e&&e.dispose()),Ra.jupyterSettings.clear()}dispose(){this._disposables.forEach(e=>e&&e.dispose()),this._disposables=[]}createSystemVariables(e){return new this._systemVariablesCtor(e,this._workspaceRoot,this._workspace)}toJSON(){let e={};return this.getSerializableKeys().forEach(n=>e[n]=this[n]),e}update(e,t){let n=this.createSystemVariables(void 0),i=n.resolveAny(e.get("logging"));i&&(i.level=kde(i.level),this.logging?Object.assign(this.logging,i):this.logging=i);let o=n.resolveAny(e.get("experiments"));this.experiments?Object.assign(this.experiments,o):this.experiments=o,this.experiments=this.experiments?this.experiments:{enabled:!0,optInto:[],optOutFrom:[]};let s=(l,c)=>{let u=nC.fullSettingIds[l],d=u&&c.get(u)!==void 0?c.get(u):c.get(l),f=n.resolveAny(d);f!==void 0&&(this[l]=f)};this.getSerializableKeys().filter(l=>l!=="experiments"&&l!=="logging"&&l!=="kernelPickerType").forEach(l=>s(l,e)),t&&s("poetryPath",t)}onWorkspaceFoldersChanged(){let e=this._workspace.workspaceFolders.map(i=>i.uri.path),n=Array.from(Ra.jupyterSettings.keys()).filter(i=>e.indexOf(i)<0);if(n.length>0)for(let i of n)Ra.jupyterSettings.delete(i)}initialize(){let e=()=>{let i=this._workspace.getConfiguration("jupyter",this._workspaceRoot),o=this._workspace.getConfiguration("python",this._workspaceRoot);this.update(i,o),this.debounceChangeNotification()};this._disposables.push(this._workspace.onDidChangeWorkspaceFolders(this.onWorkspaceFoldersChanged,this)),this._disposables.push(this._workspace.onDidChangeConfiguration(i=>{i.affectsConfiguration("jupyter")&&e(),i.affectsConfiguration("python.poetryPath")&&e()}));let t=this._workspace.getConfiguration("jupyter",this._workspaceRoot),n=this._workspace.getConfiguration("python",this._workspaceRoot);t&&(this.update(t,n),this.migrateSettings(t).catch(m))}async migrateSettings(e){await new nC(e).migrateSettings()}debounceChangeNotification(){this._changeEmitter.fire()}fireChangeNotification(){this._changeEmitter.fire()}getSerializableKeys(){return Object.getOwnPropertyNames(this).filter(e=>!e.startsWith("_"))}};g([dD(1)],Ra.prototype,"debounceChangeNotification",1);var bv=Ra;function kde(r){switch(r){case"info":return 20;case"warn":return 30;case"off":return"off";case"debug":return 10;case"verbose":return 5;default:return 40}}var Wp=require("vscode");var mD=class{constructor(e){this.serviceContainer=e;this.workspaceService=this.serviceContainer.get(ce)}async updateSectionSetting(e,t,n,i,o){let a={uri:i,target:o||Wp.ConfigurationTarget.WorkspaceFolder};e==="jupyter"&&o!==Wp.ConfigurationTarget.Global&&(a=bv.getSettingsUriAndTarget(i,this.workspaceService));let l=this.workspaceService.getConfiguration(e,a.uri),c=l.inspect(t);c!==void 0&&(o===Wp.ConfigurationTarget.Global&&c.globalValue===n||o===Wp.ConfigurationTarget.Workspace&&c.workspaceValue===n||o===Wp.ConfigurationTarget.WorkspaceFolder&&c.workspaceFolderValue===n)||(await l.update(t,n,o),o&&await this.verifySetting(l,o,t,n))}async updateSetting(e,t,n,i){return this.updateSectionSetting("jupyter",e,t,n,i)}async verifySetting(e,t,n,i){if(Pr()&&!_S()){let o=0;do{let s=e.inspect(n);if(!s&&i===void 0||s&&i!==void 0&&(t===Wp.ConfigurationTarget.Global?s.globalValue:t===Wp.ConfigurationTarget.Workspace?s.workspaceValue:s.workspaceFolderValue)===i)break;await new Promise(a=>setTimeout(a,250)),o+=1}while(o<20)}}};var Iv=class extends mD{constructor(e){super(e)}getSettings(e){return bv.getInstance(e,Bg,"node",this.workspaceService)}};Iv=g([(0,fD.injectable)(),p(0,(0,fD.inject)(ct))],Iv);var Hn=k(ql()),r8=k(JO()),SD=k(A()),n8=k(t8()),i8=require("util");var ID=k(A()),Jp=k(require("vscode"));var sK="utf8",wv=class{constructor(e){this.httpClient=e;this.vscfs=Jp.workspace.fs}arePathsSame(e,t){return Mi(e,t)}async getFiles(e){return(await this.vscfs.readDirectory(e)).filter(n=>n[1]===Jp.FileType.File).map(n=>Jp.Uri.file(n[0]))}async copy(e,t,n){await this.vscfs.copy(e,t,n)}async createDirectory(e){await this.vscfs.createDirectory(e)}async delete(e){await this.vscfs.delete(e)}async readFile(e){let t=await this.vscfs.readFile(e);return Buffer.from(t).toString(sK)}async stat(e){return this.vscfs.stat(e)}async writeFile(e,t){let n=typeof t=="string"?Buffer.from(t):t;return this.vscfs.writeFile(e,n)}async exists(e,t){if(e.scheme.toLowerCase()==="http"||e.scheme.toLowerCase()==="https")return this.httpClient.exists(e.toString());let n;try{n=await this.stat(e)}catch(i){return KP(i)||C(`stat() failed for "${e}"`,i),!1}return t===void 0?!0:t===Jp.FileType.Unknown?n.type===Jp.FileType.Unknown:(n.type&t)===t}async getFileHash(e){let t=await this.stat(e),n=`${t.ctime}-${t.mtime}`;return va(n,"SHA-512")}};wv=g([(0,ID.injectable)(),p(0,(0,ID.inject)(ws))],wv);var o8=require("vscode");var Zc=class extends wv{constructor(t){super(t);this.globFiles=(0,i8.promisify)(r8.default)}createLocalWriteStream(t){return Hn.createWriteStream(t)}async createTemporaryLocalFile(t){let n=typeof t=="string"?t:t.fileExtension,i=t&&typeof t=="object"?t.prefix:void 0,o={postfix:n,prefix:i};return new Promise((s,a)=>{n8.file(o,(l,c,u,d)=>{if(l)return a(l);s({filePath:c,dispose:d})})})}async searchLocal(t,n,i){let o;n&&(o={...o,cwd:n}),i&&(o={...o,dot:i});let s=await this.globFiles(t,o);return Array.isArray(s)?s:[]}async writeLocalFile(t,n){return await Hn.ensureDir(pt(t)),Hn.writeFile(t,n)}async readFile(t){if(Lm(t)){let n=await Hn.readFile(we(t));return Buffer.from(n).toString(sK)}else return super.readFile(t)}async delete(t){Lm(t)?await this.exists(t)&&((await this.stat(t)).type===o8.FileType.Directory?await new Promise(i=>Hn.rm(we(t),{force:!0,recursive:!0},i)):await Hn.unlink(we(t))):await super.delete(t)}async exists(t,n){return Lm(t)?Hn.pathExists(we(t)):super.exists(t,n)}async createDirectory(t){Lm(t)?await Hn.ensureDir(we(t)):await this.vscfs.createDirectory(t)}async writeFile(t,n){if(Lm(t)){let i=we(t);return await Hn.ensureDir(pt(i)),Hn.writeFile(i,n)}else await this.vscfs.writeFile(t,typeof n=="string"?Buffer.from(n):n)}async copy(t,n,i){if(Lm(t)&&Lm(n)){let o=typeof i===void 0||typeof i?.overwrite==null?!0:i?.overwrite;await Hn.copy(we(t),we(n),{overwrite:o})}else await super.copy(t,n,i)}};Zc=g([(0,SD.injectable)(),p(0,(0,SD.inject)(ws))],Zc);function Lm(r){return r.scheme==="file"}var Un=require("vscode");var xD=class{get onDidChangeConfiguration(){return Un.workspace.onDidChangeConfiguration}get rootFolder(){let e=Array.isArray(Un.workspace.workspaceFolders)&&Un.workspace.workspaceFolders.length>0?Un.workspace.workspaceFolders[0]:void 0;if(e)return e.uri}get workspaceFolders(){return Un.workspace.workspaceFolders}get onDidChangeWorkspaceFolders(){return Un.workspace.onDidChangeWorkspaceFolders}get hasWorkspaceFolders(){return Array.isArray(Un.workspace.workspaceFolders)&&Un.workspace.workspaceFolders.length>0}get workspaceFile(){return Un.workspace.workspaceFile}getConfiguration(e,t){return Un.workspace.getConfiguration(e,t||null)}getWorkspaceFolder(e){return e?Un.workspace.getWorkspaceFolder(e):void 0}asRelativePath(e,t){return Un.workspace.asRelativePath(e,t)}get isTrusted(){return Un.workspace.isTrusted}get onDidGrantWorkspaceTrust(){return Un.workspace.onDidGrantWorkspaceTrust}createFileSystemWatcher(e,t,n,i){return Un.workspace.createFileSystemWatcher(e,n,n,i)}findFiles(e,t,n,i){return Un.workspace.findFiles(e,t,n,i)}getWorkspaceFolderIdentifier(e,t=""){let n=e?Un.workspace.getWorkspaceFolder(e):Un.workspace.workspaceFolders?Un.workspace.workspaceFolders[0]:void 0;return n?Pn(en()==="Windows"?n.uri.path.toUpperCase():n.uri.path):t}};var uC=k(ql());var s8=k(A());var kv=class extends xD{async computeWorkingDirectory(e){let t=e&&e.scheme==="file"?await uC.pathExists(e.fsPath):!1;return(e&&e.scheme==="file"?await uC.pathExists(pt(e.fsPath)):!1)&&e&&e.fsPath.includes(".")?pt(e.fsPath):t&&e&&(await uC.stat(e.fsPath)).isDirectory()?e.fsPath:this.getWorkspaceFolder(e)?.uri.fsPath||this.rootFolder?.fsPath||process.cwd()}};kv=g([(0,s8.injectable)()],kv);var Um=k(A());var Pv=class{constructor(e,t){this.jupyterOutput=e;this.disposableRegistry=t}register(e){this.disposableRegistry.push(e.registerCommand(V.ViewJupyterOutput,this.viewJupyterOutput,this))}viewJupyterOutput(){this.jupyterOutput.show(!0)}};Pv=g([(0,Um.injectable)(),p(0,(0,Um.inject)(Wo)),p(0,(0,Um.named)(Wu)),p(1,(0,Um.inject)(O))],Pv);var pC=k(A()),l8=require("vscode");var a8=require("vscode");var Dv=class{constructor(e,t,n,i=[]){this.fs=e;this.disposableRegistry=t;this.options=n;this.loadFailedEmitter=new a8.EventEmitter;let o={enableScripts:!0,localResourceRoots:[this.options.rootPath,this.options.cwd,...i]};n.webviewHost?(this.webviewHost=n.webviewHost,this.webviewHost.webview.options=o):this.webviewHost=this.createWebview(o),this.loadPromise=this.load()}get loadFailed(){return this.loadFailedEmitter.event}asWebviewUri(e){if(!this.webviewHost?.webview)throw new Error("WebView not initialized, too early to get a Uri");return this.webviewHost.webview.asWebviewUri(e)}postMessage(e){this.webviewHost?.webview&&this.webviewHost?.webview.postMessage(e)}async generateLocalReactHtml(){if(!this.webviewHost?.webview)throw new Error("WebView not initialized, too early to get a Uri");let e=this.webviewHost.webview.asWebviewUri(this.options.cwd).toString(),t=this.options.scripts.map(o=>this.webviewHost.webview.asWebviewUri(o)),n=this.webviewHost.webview.asWebviewUri(this.options.rootPath).toString(),i="false";return`<!doctype html>
        <html lang="en">
            <head>
                <meta charset="utf-8">
                <meta name="viewport" content="width=device-width,initial-scale=1,shrink-to-fit=no">
                <meta http-equiv="Content-Security-Policy" content="img-src 'self' data: https: http: blob: ${this.webviewHost.webview.cspSource}; default-src 'unsafe-inline' 'unsafe-eval' data: https: http: blob: ${this.webviewHost.webview.cspSource};">
                <meta name="theme-color" content="#000000">
                <meta name="theme" content="${Le.GeneratedThemeName}"/>
                <title>VS Code Python React UI</title>
                <base href="${e}${e.endsWith("/")?"":"/"}"/>
                </head>
            <body>
                <noscript>You need to enable JavaScript to run this app.</noscript>
                <div id="root"></div>
                <script type="text/javascript">
                    // Public path that will be used by webpack.
                    window.__PVSC_Public_Path = "${n}/";
                    function resolvePath(relativePath) {
                        if (relativePath && relativePath[0] == '.' && relativePath[1] != '.') {
                            return "${e}" + relativePath.substring(1);
                        }

                        return "${e}" + relativePath;
                    }
                    function forceTestMiddleware() {
                        return ${i};
                    }
                </script>
                ${t.map(o=>`<script type="text/javascript" src="${o}"></script>`).join(`
`)}
            </body>
        </html>`}async load(){try{this.webviewHost?.webview&&((await Promise.all(this.options.scripts.map(t=>this.fs.exists(t)))).every(t=>t===!0)?(this.webviewHost.webview.html=await this.generateLocalReactHtml(),this.postLoad(this.webviewHost)):this.webviewHost.webview.html=y.badWebPanelFormatString(this.options.scripts.join(", ")))}catch(e){C(`Error Loading WebviewPanel: ${e}`),this.loadFailedEmitter.fire()}}};var aK=class extends Dv{constructor(t,n,i,o=[]){super(t,n,i,o);this.panelOptions=i;this._onDidChangeVisibility=new l8.EventEmitter}get visible(){return this.webviewHost?this.webviewHost.visible:!1}get onDidChangeVisibility(){return this._onDidChangeVisibility.event}createWebview(t){throw new Error("Webview Views must be passed in an initial view")}postLoad(t){this.disposableRegistry.push(t.onDidDispose(()=>{this.webviewHost=void 0,this.panelOptions.listener.dispose().catch(m)})),this.disposableRegistry.push(t.webview.onDidReceiveMessage(n=>{this.panelOptions.listener.onMessage(n.type,n.payload)})),this.disposableRegistry.push(t.onDidChangeVisibility(()=>{this._onDidChangeVisibility.fire()})),this._onDidChangeVisibility.fire()}},Tv=class{constructor(e,t){this.disposableRegistry=e;this.fs=t}async create(e){return new aK(this.fs,this.disposableRegistry,e)}};Tv=g([(0,pC.injectable)(),p(0,(0,pC.inject)(O)),p(1,(0,pC.inject)(Ze))],Tv);var Rv=k(A()),CD=require("vscode");var lK=class extends Dv{get panel(){return this.webviewHost}get panelOptions(){return this.options}constructor(e,t,n,i=[]){super(e,t,n,i)}async show(e){await this.loadPromise,this.panel&&(e?this.panel.visible||this.panel.reveal(this.panel.viewColumn,e):this.panel.active||this.panel.reveal(this.panel.viewColumn,e))}close(){this.panel&&this.panel.dispose()}get viewColumn(){return this.panel?.viewColumn}isVisible(){return this.panel?this.panel.visible:!1}isActive(){return this.panel?this.panel.active:!1}setTitle(e){this.panelOptions.title=e,this.panel&&(this.panel.title=e)}createWebview(e){return CD.window.createWebviewPanel(this.panelOptions.title.toLowerCase().replace(" ",""),this.panelOptions.title,{viewColumn:this.panelOptions.viewColumn,preserveFocus:!0},{retainContextWhenHidden:!0,enableFindWidget:!0,...e})}postLoad(e){this.disposableRegistry.push(e.onDidDispose(()=>{this.webviewHost=void 0,this.panelOptions.listener.dispose().catch(m)})),this.disposableRegistry.push(e.webview.onDidReceiveMessage(t=>{this.panelOptions.listener.onMessage(t.type,t.payload)})),this.disposableRegistry.push(e.onDidChangeViewState(t=>{this.panelOptions.listener.onChangeViewState(this)})),this.panelOptions.listener.onChangeViewState(this)}},_v=class{constructor(e,t,n){this.disposableRegistry=e;this.fs=t;this.context=n}async create(e){let t=[CD.Uri.file(Ue(this.context.extensionPath,"temp"))];return Array.isArray(e.additionalPaths)&&t.push(...e.additionalPaths),new lK(this.fs,this.disposableRegistry,e,t)}};_v=g([(0,Rv.injectable)(),p(0,(0,Rv.inject)(O)),p(1,(0,Rv.inject)(Ze)),p(2,(0,Rv.inject)(dt))],_v);function c8(r){r.addSingleton(Zc,Zc),r.addBinding(Zc,Or),r.addBinding(Zc,Ze),r.addSingleton(Fe,yv),r.addSingleton(ce,kv),r.addSingleton(ue,vv),r.addSingleton(se,Iv),n9(r),n6(r),o6(r),l7(r),r.addSingletonInstance(aW,Date.now()),r.addSingleton(es,es),r.addSingleton(Ie,ft),r.addSingleton(Th,Pv),r.add(Dw,Tv),r.add(tp,_v)}var Gp=k(A());var Xl=k(A()),g8=require("vscode");var Av=k(A()),p8=require("vscode");var Nv=Symbol("IJupyterCommandFactory"),$p=Symbol("IJupyterSubCommandExecutionService");function gme(r){r.sort((e,t)=>e===18?-1:t===18?1:e===20?-1:t===20?1:0)}function cK(r,e){let t=e.displayName||e.envName||e.envPath?.fsPath||e.uri.fsPath,n=r.map(i=>Sr.get(i)).filter(i=>!!i).map(i=>i);switch(n.length){case 0:return"";case 1:return t?y.libraryRequiredToLaunchJupyterNotInstalledInterpreter(t,n[0]):y.libraryRequiredToLaunchJupyterNotInstalled(n[0]);default:{let i=n.pop();return t?y.librariesRequiredToLaunchJupyterNotInstalledInterpreter(t,`${n.join(", ")} ${ye.and} ${i}`):y.librariesRequiredToLaunchJupyterNotInstalled(`${n.join(", ")} ${ye.and} ${i}`)}}}var js=class{constructor(e,t,n){this.applicationShell=e;this.installer=t;this.commandFactory=n;this.dependenciesInstalledInInterpreter=new Set}async installMissingDependencies(e,t){let n=new p8.CancellationTokenSource;try{let i=e.envType==="Conda"?Promise.resolve(void 0):this.installer.isInstalled(27,e),[o,s]=await Promise.all([this.getDependenciesNotInstalled(e,void 0),i]);if(o.length===0)return 0;let a=cK(s===!1?[27].concat(o):o,e);switch(R("DS_INTERNAL.PYTHON_MODULE_INSTALL",void 0,{action:"displayed",moduleName:Sr.get(18),pythonEnvType:e.envType}),await this.applicationShell.showErrorMessage(a,{modal:!0},y.jupyterInstall,y.selectDifferentJupyterInterpreter)){case y.jupyterInstall:{o.includes(21)&&!o.includes(18)&&o.push(18);let c=o.filter(d=>d!==21);gme(c);let u=c.shift();for(;u;)if(await Gt(n.token,2,this.installer.install(u,e,n,void 0,s===!1))===0){u=c.shift();continue}else return 2;return R("DATASCIENCE.USER_INSTALLED_JUPYTER"),this.checkKernelSpecAvailability(e)}case y.selectDifferentJupyterInterpreter:return R("DATASCIENCE.USER_DID_NOT_INSTALL_JUPYTER"),1;case y.pythonInteractiveHelpLink:return this.applicationShell.openUrl(TS.PythonInteractiveHelpLink),R("DATASCIENCE.USER_DID_NOT_INSTALL_JUPYTER"),2;default:return R("DATASCIENCE.USER_DID_NOT_INSTALL_JUPYTER"),2}}finally{n.dispose()}}async areDependenciesInstalled(e,t){return this.getDependenciesNotInstalled(e,t).then(n=>n.length===0)}async getDependenciesNotInstalled(e,t){let n=ar(e.uri);if(this.dependenciesInstalledInInterpreter.has(n))return[];let i=[];if(await Gt(t,Promise.all([this.installer.isInstalled(18,e).then(s=>s?void 0:i.push(18)),this.installer.isInstalled(20,e).then(s=>s?void 0:i.push(20))])),i.length>0)return i;if(t?.isCancellationRequested)return[];let o=await this.isKernelSpecAvailable(e,t).then(s=>s?[]:[21]);return o.length===0&&this.dependenciesInstalledInInterpreter.add(n),o}async isKernelSpecAvailable(e,t){return this.commandFactory.createInterpreterCommand("kernelspec","jupyter",["-m","jupyter","kernelspec"],e,!1).exec(["--version"],{throwOnStdErr:!0}).then(()=>!0).catch(i=>(C("Kernel spec not found: ",i),!1))}async checkKernelSpecAvailability(e,t){return await this.isKernelSpecAvailable(e)?0:t?.isCancellationRequested?2:await this.applicationShell.showErrorMessage(y.jupyterKernelSpecModuleNotFound(e.uri.fsPath),{modal:!0},y.selectDifferentJupyterInterpreter)===y.selectDifferentJupyterInterpreter?1:2}};g([gv("InstallingMissingDependencies")],js.prototype,"installMissingDependencies",1),js=g([(0,Av.injectable)(),p(0,(0,Av.inject)(ue)),p(1,(0,Av.inject)(qi)),p(2,(0,Av.inject)(Nv))],js);var DD=k(A());var TD=require("vscode");var d8=require("vscode");function ED(r,e){let t=up(r),i={label:`${r.id===e.recommended?.id?"$(star-full) ":ya(r)?"$(warning) ":""}${t}`};return i.description=W(r.executable.uri||r.path,d8.workspace.workspaceFolders||[],new Jl().homeDir),i.tooltip=ya(r)?y.pythonCondaKernelsWithoutPython:"",i}function wD(r){switch(tn(r)){case"Conda":return ya(r)?{label:y.kernelCategoryForCondaWithoutPython,sortKey:"Z"}:{label:y.kernelCategoryForConda};case"PipEnv":return{label:y.kernelCategoryForPipEnv};case"Poetry":return{label:y.kernelCategoryForPoetry};case"Pyenv":return{label:y.kernelCategoryForPyEnv};case"Venv":case"VirtualEnv":case"VirtualEnvWrapper":return{label:y.kernelCategoryForVirtual};default:return{label:y.kernelCategoryForGlobal}}}var Vs=k(A()),m8=require("vscode");var kD="INTERPRETER_PATH_SELECTED_FOR_JUPYTER_SERVER",uK="INTERPRETER_PATH_WAS_SELECTED_FOR_JUPYTER_SERVER",Na=class{constructor(e){this.memento=e}get interpreterSetAtleastOnce(){return!!this.selectedPythonPath||this.memento.get(uK,!1)}get selectedPythonPath(){if(this._interpreterPath)return this._interpreterPath;let e=this.memento.get(kD,void 0);if(e)return m8.Uri.parse(e)}updateSelectedPythonPath(e){this._interpreterPath=e,this.memento.update(kD,e?.toString()).then(m,m),this.memento.update(uK,!0).then(m,m)}};Na=g([(0,Vs.injectable)(),p(0,(0,Vs.inject)(He)),p(0,(0,Vs.named)(It))],Na);var Mv=class{constructor(e,t,n,i){this.api=e;this.memento=t;this.checker=n;this.disposables=i}activate(){this.activateBackground().catch(m),this.api.onDidActivatePythonExtension(this.activateBackground,this,this.disposables)}async activateBackground(){!this.memento.get(kD)&&this.checker.isPythonExtensionActive&&await this.migrateSettings()}async migrateSettings(){if(this.settingsMigrated)return;this.settingsMigrated=!0;let t=(await this.api.getApi()).getInterpreterPathSelectedForJupyterServer();await this.memento.update(kD,t),await this.memento.update(uK,!0)}};Mv=g([(0,Vs.injectable)(),p(0,(0,Vs.inject)(Xt)),p(1,(0,Vs.inject)(He)),p(1,(0,Vs.named)(It)),p(2,(0,Vs.inject)(ze)),p(3,(0,Vs.inject)(O))],Mv);var ts=require("vscode");var pK=class{constructor(e){this.label=e}},PD=class extends pK{constructor(t,n){super(t);this.sortKey=n;this.kind=ts.QuickPickItemKind.Separator}},Hp=class extends Mr{constructor(t,n,i,o,s,a){super();this.provider=t;this.createQuickPickItem=n;this.getCategory=i;this.options=o;this.createErrorQuickPickItem=s;this._title=a;this.categories=new Map;this.quickPickItems=[];this.previouslyEnteredValue="";this.commands=new Set;this._placeholder="";this.quickPickItemMap=new WeakSet;this.errorQuickPickItemMap=new WeakSet}set recommended(t){let n=this._recommended?.id!==t?.id;this._recommended=t,n&&this.quickPick&&this.rebuildQuickPickItems(this.quickPick)}get recommended(){return this._recommended}set placeholder(t){this.quickPick&&(this.quickPick.placeholder=t),this._placeholder=t}get placeholder(){return this._placeholder}set selected(t){let n=this._selected!==t;this._selected=t,n&&this.quickPick&&this.rebuildQuickPickItems(this.quickPick)}get selected(){return this._selected}createQuickPick(){let t=[],n={iconPath:new ts.ThemeIcon("refresh"),tooltip:ye.refresh},i=this.quickPick=ts.window.createQuickPick();return t.push(i),this.quickPickItems=[],i.placeholder=this.placeholder,i.buttons=this.options.supportsBack?[ts.QuickInputButtons.Back,n]:[n],i.ignoreFocusOut=!0,i.busy=!0,i.value=this.previouslyEnteredValue,i.onDidChangeValue(o=>this.previouslyEnteredValue=o,this,t),i.onDidHide(()=>G(t),this,t),i.title=this._title||y.kernelPickerSelectKernelFromRemoteTitleWithoutName,this.provider.then(o=>{this.resolvedProvider=o,this._title||(i.title=y.kernelPickerSelectKernelFromRemoteTitle(o.title)),i.busy=o.status==="discovering",o.onDidChange(()=>this.updateQuickPickItems(i,o),this,t),i.onDidTriggerButton(async a=>{a===n&&(i.busy=!0,await o.refresh().catch(m),this.updateQuickPickItems(i,o),i.busy=!1)},this,t);let s;o.onDidChangeStatus(()=>{switch(s&&clearTimeout(s),o.status){case"discovering":i.busy=!0;break;case"idle":s=setTimeout(()=>i.busy=!1,500),t.push(new ts.Disposable(()=>s&&clearTimeout(s)));break}},this,t),f8(o.items.map(a=>this.toQuickPickItem(a)),(a,l)=>h8(this.getCategory(a.item,this),this.getCategory(l.item,this))).forEach(a=>{let l=this.connectionToCategory(a[0].item);this.quickPickItems.push(l),a.sort((c,u)=>c.label.localeCompare(u.label)),this.quickPickItems.push(...a),this.categories.set(l,new Set(a))}),this.updateQuickPickItems(i,o)}).catch(m),t.forEach(o=>this._register(o)),{quickPick:i,disposables:t}}isCommandQuickPickItem(t){return this.commands.has(t)}addCommand(t,n){let i=t;return i.execute=n,this.commands.add(i),this.quickPick&&this.rebuildQuickPickItems(this.quickPick),{dispose:()=>{this.commands.delete(i)}}}async selectItem(t){for(;!t.isCancellationRequested;){let{quickPick:n,disposables:i}=this.createQuickPick();n.show();try{this.previouslySelectedItem=void 0;let o=await new Promise((s,a)=>{n.onDidChangeSelection(l=>{if(l.length){let c=l[0];this.isSelectorQuickPickItem(c)?s(c.item):this.isCommandQuickPickItem(c)?s(c):this.isErrorQuickPickItem(c)}}),n.onDidTriggerButton(l=>l===ts.QuickInputButtons.Back?s(Ae.back):void 0,this,i),n.onDidHide(()=>s(void 0),this,i)});if(t.isCancellationRequested||!o)return;if(o instanceof Ae)return o===Ae.back?Ae.back:void 0;if(o&&"label"in o&&this.isCommandQuickPickItem(o)){this.previouslySelectedItem=o;let s=await o.execute();if(!s||s===Ae.back)continue;return s instanceof Ae,s}return o||void 0}finally{G(i)}}}updateQuickPickItems(t,n){let i=new Map(t.items.filter(a=>this.isSelectorQuickPickItem(a)).map(a=>a).map(a=>[a.item.id,a.item])),o=new Map(n.items.map(a=>[a.id,a]));this.quickPickItems=this.quickPickItems.map(a=>{if(this.isSelectorQuickPickItem(a)){let l=i.get(a.item.id);if(l&&l!==a.item)return this.toQuickPickItem(l);let c=o.get(a.item.id);if(c){let u=this.toQuickPickItem(c);if(JSON.stringify({...a,item:""})!==JSON.stringify({...u,item:""}))return this.toQuickPickItem(c)}}return a});let s=n.items.filter(a=>!i.has(a.id)).map(a=>this.toQuickPickItem(a));this.removeOutdatedQuickPickItems(t,n),f8(s,(a,l)=>h8(this.getCategory(a.item,this),this.getCategory(l.item,this))).forEach(a=>{a.sort((u,d)=>u.label.localeCompare(d.label));let l=this.connectionToCategory(a[0].item),c=this.quickPickItems.find(u=>u.kind===ts.QuickPickItemKind.Separator&&u.label===l.label);if(c){let u=this.quickPickItems.indexOf(c),d=this.categories.get(c),f=new Map(Array.from(d).map(S=>[S.item.id,S])),h=d.size;a.forEach(S=>{let b=f.get(S.item.id);b&&d.delete(b),d.add(S)});let v=Array.from(d);v.sort((S,b)=>S.label.localeCompare(b.label)),this.quickPickItems.splice(u+1,h,...v)}else{let u=this.quickPickItems.filter(h=>h instanceof PD).map((h,v)=>[h,v]);u.push([l,-1]),u.sort((h,v)=>h[0].sortKey.localeCompare(v[0].sortKey));let d=u.findIndex(h=>h[1]===-1),f=0;d>0&&(f=u.length===d+1?this.quickPickItems.length:u[d+1][1]),a.sort((h,v)=>h.label.localeCompare(v.label)),this.quickPickItems.splice(f,0,l,...a),this.categories.set(l,new Set(a))}}),this.rebuildQuickPickItems(t)}rebuildQuickPickItems(t){let n=this.recommended?this.toQuickPickItem(this.recommended):void 0,i=[];n&&i.push({label:y.recommendedItemCategoryInQuickPick,kind:ts.QuickPickItemKind.Separator},n);let o=n;o=this.selected?this.quickPickItems.filter(d=>this.isSelectorQuickPickItem(d)).map(d=>d).find(d=>d.item.id===this.selected?.id):o;let s=this.quickPickItems.filter(d=>!this.isSelectorQuickPickItem(d)||d.item.id!==n?.item?.id),a=t.activeItems.length?t.activeItems[0]:void 0;o&&a&&(this.isSelectorQuickPickItem(a)?a.item.id!==o.item.id&&(o=void 0):o=void 0);let l=this.resolvedProvider?.lastError?this.toErrorQuickPickItem(this.resolvedProvider.lastError):void 0,c=[].concat(Array.from(this.commands.values())).concat(i).concat(s).concat(l?[l]:[]),u=o?[o]:t.activeItems.length?[t.activeItems[0]]:[];if(u.length&&!c.includes(u[0])){let d=u[0],f=this.isSelectorQuickPickItem(d)&&c.find(h=>this.isSelectorQuickPickItem(h)&&h.item.id===d.item.id);f?u[0]=f:u.length=0}t.items=c,t.activeItems=u,!t.activeItems.length&&this.previouslySelectedItem&&c.includes(this.previouslySelectedItem)&&(t.activeItems=[this.previouslySelectedItem])}isErrorQuickPickItem(t){return this.errorQuickPickItemMap.has(t)}toErrorQuickPickItem(t){if(!this.createErrorQuickPickItem)return;let n=this.createErrorQuickPickItem(t,this);return this.errorQuickPickItemMap.add(n),n}isSelectorQuickPickItem(t){return this.quickPickItemMap.has(t)}toQuickPickItem(t){let n=this.createQuickPickItem(t,this);return n.item=t,this.quickPickItemMap.add(n),n}removeOutdatedQuickPickItems(t,n){let i=t.items.filter(a=>this.isSelectorQuickPickItem(a)).map(a=>a).map(a=>a.item.id),o=new Map(n.items.map(a=>[a.id,a])),s=i.filter(a=>!o.has(a));if(s.length){let a=[];this.categories.forEach((l,c)=>{l.forEach(u=>{s.includes(u.item.id)&&(l.delete(u),a.push(u))}),l.size||(a.push(c),this.categories.delete(c))}),this.quickPickItems=this.quickPickItems.filter(l=>!a.includes(l)),this.rebuildQuickPickItems(t)}}connectionToCategory(t){let n=this.getCategory(t,this);return new PD(n.label,n.sortKey||n.label)}};function f8(r,e){let t=[],n;for(let i of r.slice(0).sort(e))!n||e(n[0],i)!==0?(n=[i],t.push(n)):n.push(i);return t}function h8(r,e){return(r.sortKey||r.label).localeCompare(e.sortKey||e.label,void 0,{sensitivity:"accent"})}var eu=class{constructor(e){this.serviceContainer=e}async selectPythonInterpreter(){let e=await this.selectPythonEnvironment();return e?.executable?.uri&&await this.serviceContainer.get(it).getInterpreterDetails(e.executable.uri)}async selectPythonEnvironment(){let e=new TD.CancellationTokenSource,t=new Jl,n=this.serviceContainer.get(Na).selectedPythonPath,i=Xe.instance.get(xi),o=Xe.instance.get(Ws).withFilter(u=>!ya(u)&&!i.isPythonEnvironmentExcluded(u)),s=()=>o.items.find(u=>Co(u.executable.uri,n,t.osType)),a=n?y.currentlySelectedJupyterInterpreterForPlaceholder(W(n,TD.workspace.workspaceFolders||[],t.homeDir)):"",l=[],c=new Hp(Promise.resolve(o),ED,wD,{supportsBack:!1},void 0,y.quickPickSelectPythonEnvironmentTitle);c.placeholder=a,c.selected=s(),l.push(c),l.push(e);try{if(!c.selected&&n){let d=o.onDidChange(()=>{c.selected=s(),c.selected&&d.dispose()});l.push(d)}let u=await c.selectItem(e.token);return!u||u instanceof Ae?void 0:u}catch(u){C("Failed to select a Python Environment to start Jupyter",u)}finally{G(l)}}};eu=g([(0,DD.injectable)(),p(0,(0,DD.inject)(ct))],eu);var Ei=class{constructor(e,t,n,i,o,s,a){this.interpreterSelectionState=e;this.jupyterInterpreterSelector=t;this.interpreterConfiguration=n;this.interpreterService=i;this.appShell=o;this.workspace=s;this._onDidChangeInterpreter=new g8.EventEmitter;this.workspace.onDidGrantWorkspaceTrust(()=>{this.getInitialInterpreterPromiseFailed&&(this.getInitialInterpreterPromise=void 0,this.getInitialInterpreterPromiseFailed=!1)},this,a)}get onDidChangeInterpreter(){return this._onDidChangeInterpreter.event}async getSelectedInterpreter(e){return await this.setInitialInterpreter(e),this._selectedInterpreter}async setInitialInterpreter(e){return this.getInitialInterpreterPromise||(this.getInitialInterpreterPromise=this.getInitialInterpreterImpl(e).then(t=>(t&&this.changeSelectedInterpreterProperty(t),t)),this.getInitialInterpreterPromise.catch(()=>this.getInitialInterpreterPromiseFailed=!0)),this.getInitialInterpreterPromise}async selectInterpreter(){let e=await this.jupyterInterpreterSelector.selectPythonInterpreter();if(!e)return;switch(await this.interpreterConfiguration.installMissingDependencies(e,void 0)){case 0:return await this.setAsSelectedInterpreter(e),e;case 2:return;default:return this.selectInterpreter()}}async installMissingDependencies(e){let t=await this.getSelectedInterpreter(),n=t;if(!n&&(n=await this.interpreterService.getActiveInterpreter(void 0),!n))return e&&await this.appShell.showErrorMessage(e.message,{modal:!0},y.selectDifferentJupyterInterpreter)!==y.selectDifferentJupyterInterpreter?2:(await this.selectInterpreter(),1);let i=await this.interpreterConfiguration.installMissingDependencies(n,e);return i===1?(n=await this.selectInterpreter(),n?0:2):(i===0&&n!==t&&await this.setAsSelectedInterpreter(n),i)}async setAsSelectedInterpreter(e){await this.setInitialInterpreter(),this.changeSelectedInterpreterProperty(e)}changeSelectedInterpreterProperty(e){this._selectedInterpreter=e,this._onDidChangeInterpreter.fire(e),this.interpreterSelectionState.updateSelectedPythonPath(e.uri)}async validateInterpreterPath(e,t){try{let n=await Gt(t,this.interpreterService.getInterpreterDetails(e));if(n&&await this.interpreterConfiguration.areDependenciesInstalled(n,t))return n}catch{}}async getInitialInterpreterImpl(e){let t;if(this.interpreterSelectionState.selectedPythonPath&&(t=await this.validateInterpreterPath(this.interpreterSelectionState.selectedPythonPath,e),t||this.interpreterSelectionState.updateSelectedPythonPath(void 0)),!t){let n=await this.interpreterService.getActiveInterpreter(void 0);n&&await this.interpreterConfiguration.areDependenciesInstalled(n,e)&&(t=n)}return t}};Ei=g([(0,Xl.injectable)(),p(0,(0,Xl.inject)(Na)),p(1,(0,Xl.inject)(eu)),p(2,(0,Xl.inject)(js)),p(3,(0,Xl.inject)(it)),p(4,(0,Xl.inject)(ue)),p(5,(0,Xl.inject)(ce)),p(6,(0,Xl.inject)(O))],Ei);var _D=Symbol("IKernelLauncher"),wi=Symbol("IRawNotebookSupportedService"),RD=Symbol("IRawKernelSessionFactory");var Ov=class{constructor(e,t,n,i,o){this.vscNotebook=e;this.jupyterInterpreterService=t;this.disposables=n;this.rawSupported=i;this.extensionChecker=o;this.notebookOpened=!1}activate(){this.disposables.push(this.vscNotebook.onDidOpenNotebookDocument(this.onDidOpenNotebookEditor,this)),this.disposables.push(this.jupyterInterpreterService.onDidChangeInterpreter(this.onDidChangeInterpreter,this))}onDidOpenNotebookEditor(e){Dt(e)&&(this.notebookOpened=!0,R("DATASCIENCE.NATIVE.OPEN_NOTEBOOK_ALL",fV(e)),!this.rawSupported.isSupported&&this.extensionChecker.isPythonExtensionInstalled&&this.jupyterInterpreterService.setInitialInterpreter().catch(m))}onDidChangeInterpreter(){this.notebookOpened&&!this.rawSupported.isSupported&&this.extensionChecker.isPythonExtensionInstalled&&this.jupyterInterpreterService.setInitialInterpreter().catch(m)}};Ov=g([(0,Gp.injectable)(),p(0,(0,Gp.inject)(qe)),p(1,(0,Gp.inject)(Ei)),p(2,(0,Gp.inject)(O)),p(3,(0,Gp.inject)(wi)),p(4,(0,Gp.inject)(ze))],Ov);var ND=k(A()),v8=require("vscode");var cn=class{static dispose(){G(cn.disposables)}constructor(e){e.push({dispose:()=>{cn.dispose()}})}activate(){v8.workspace.onDidChangeNotebookDocument(e=>{Dt(e.notebook)&&e.cellChanges.filter(t=>t.outputs?.length===0).map(t=>{let n=cn.cellToDisplayIdMapping.get(t.cell);n&&(cn.cellToDisplayIdMapping.delete(t.cell),cn.displayIdCellOutputMappingPerDocument.get(e.notebook)?.delete(n))})})}static trackOutputByDisplayId(e,t,n,i){let o=cn.displayIdCellOutputMappingPerDocument.get(e.notebook);o||(o=new Map,cn.displayIdCellOutputMappingPerDocument.set(e.notebook,o)),o.set(t,{outputContainer:n,cell:e,outputItems:i}),cn.cellToDisplayIdMapping.set(e,t)}static getMappedOutput(e,t){let n=cn.displayIdCellOutputMappingPerDocument.get(e);if(!n)return;let i=n.get(t);return i?.cell.document.isClosed?void 0:i}};cn.displayIdCellOutputMappingPerDocument=new WeakMap,cn.cellToDisplayIdMapping=new WeakMap,cn.disposables=[],cn=g([(0,ND.injectable)(),p(0,(0,ND.inject)(O))],cn);var Wm=k(A());var dK="Active_Kernel_Id_List",vme=100,rs=class{constructor(e,t){this.globalMemento=e;this.crypto=t}async getPreferredRemoteKernelId(e){let t=this.globalMemento.get(dK,[]);if(t.length){let n=await this.crypto.createHash(e.toString()),i=t.find(o=>o.fileHash===n);return w(`Preferred Remote kernel for ${W(e)} is ${i?.kernelId}`),i?.kernelId}}async clearPreferredRemoteKernelId(e){await this.updatePreferredRemoteKernelIdInternal(e)}async storePreferredRemoteKernelId(e,t){await this.updatePreferredRemoteKernelIdInternal(e,t)}async updatePreferredRemoteKernelIdInternal(e,t){let n=!1,i=JSON.parse(JSON.stringify(this.globalMemento.get(dK,[]))),o=await this.crypto.createHash(e.toString()),s=i.findIndex(a=>a.fileHash===o);for(s>=0&&(n=!0,i.splice(s,1)),t&&(n=!0,i.push({fileHash:o,kernelId:t}),w(`Storing Preferred remote kernel for ${W(e)} is ${t}`));i.length>vme;)n=!0,i.shift();n&&await this.globalMemento.update(dK,i)}};rs=g([(0,Wm.injectable)(),p(0,(0,Wm.inject)(He)),p(0,(0,Wm.named)(It)),p(1,(0,Wm.inject)(Dh))],rs);var Fv=k(A()),mK=require("vscode");var yme=1e3,Kv=class{constructor(e,t,n){this.serverStorage=e;this.kernelProvider=t;this.disposables=[];this.monitoredKernels=new WeakSet;this.timeouts=new Set;n.push(this)}dispose(){G(this.disposables),G(Array.from(this.timeouts.values()))}activate(){this.kernelProvider.onDidStartKernel(this.onDidStartKernel,this,this.disposables),this.kernelProvider.onDidRestartKernel(this.onDidStartKernel,this,this.disposables)}onDidStartKernel(e){let t=e.kernelConnectionMetadata;if(!Ft(t)||this.monitoredKernels.has(e))return;this.monitoredKernels.add(e);let n=[];this.disposables.push(new mK.Disposable(()=>G(n)));let i=()=>{if(G(n),e.disposed||e.disposing)return;let o=setTimeout(()=>{this.serverStorage.update(t.serverProviderHandle).catch(m)},yme);n.push(new mK.Disposable(()=>clearTimeout(o)))};this.kernelProvider.getKernelExecution(e).onPreExecute(i,this,this.disposables),i()}};Kv=g([(0,Fv.injectable)(),p(0,(0,Fv.inject)(cr)),p(1,(0,Fv.inject)(Ke)),p(2,(0,Fv.inject)(O))],Kv);var ns=k(A()),I8=require("vscode");var y8=require("vscode"),er=class{constructor(e){this._event=new y8.EventEmitter;this._disableUI=e}get disableUI(){return this._disableUI}set disableUI(e){let t=this._disableUI!==e;this._disableUI=e,t&&this._event.fire()}get onDidChangeDisableUI(){return this._event.event}dispose(){this._event.dispose()}};var bme="last-python-notebook-created",b8="last-notebook-created",Lv=class{constructor(e,t,n,i,o,s,a,l){this.configService=t;this.serverConnector=n;this.workspace=i;this.disposables=o;this.rawKernelSupport=s;this.mementoStorage=a;this.kernelProvider=l;e.onDidOpenNotebookDocument(this.onDidOpenNotebook.bind(this),this,o)}activate(){this.checkDateForServerStart(),this.disposables.push(this.kernelProvider.onDidStartKernel(this.kernelStarted,this))}get lastNotebookCreated(){let e=this.mementoStorage.get(b8);return e?new Date(e):void 0}checkDateForServerStart(){this.shouldAutoStartStartServer(this.lastNotebookCreated)&&this.createServerIfNecessary().catch(m)}shouldAutoStartStartServer(e){if(!e)return!1;let n=new Date().getTime()-e.getTime();return Math.floor(n/(24*3600*1e3))<=7}async createServerIfNecessary(){if(!this.workspace.isTrusted||this.rawKernelSupport.isSupported)return;let e=new I8.CancellationTokenSource,t=new er(!0);try{H("Attempting to start a server because of preload conditions ..."),this.configService.getSettings(void 0).disableJupyterAutoStart||await this.serverConnector.connect({resource:void 0,ui:t,token:e.token})}catch(n){C("Error starting server in serverPreload: ",n)}finally{t.dispose(),e.dispose()}}onDidOpenNotebook(e){Dt(e)&&this.createServerIfNecessary().catch(m)}kernelStarted(e){let t=oo(e.kernelConnectionMetadata);this.mementoStorage.update(b8,Date.now()).then(m,m),t===xe&&this.mementoStorage.update(bme,Date.now()).then(m,m)}};Lv=g([(0,ns.injectable)(),p(0,(0,ns.inject)(qe)),p(1,(0,ns.inject)(se)),p(2,(0,ns.inject)(Ek)),p(3,(0,ns.inject)(ce)),p(4,(0,ns.inject)(O)),p(5,(0,ns.inject)(wi)),p(6,(0,ns.inject)(He)),p(6,(0,ns.named)(vi)),p(7,(0,ns.inject)(Ke))],Lv);var Gn=k(A());var ki=k(A());var co=class extends tt{constructor(e){super("jupyterinstall",e)}};var Zp=require("vscode");var jm=class extends On{constructor(e){super("timeout",y.rawKernelStartFailedDueToTimeout(gt(e)),e)}};var zp=class extends El{constructor(t,n,i,o){super(t,i,o);this.stdErr=n}};var Uv=class extends On{constructor(e){super("timeout",y.rawKernelStartFailedDueToTimeoutWaitingForPort(gt(e)),e)}};var Qp=class extends On{constructor(t=-1,n,i){super("kerneldied",y.kernelDied(n.trim()),i);this.exitCode=t;this.stdErr=n}};var Vm=class extends On{constructor(t,n){super("noipykernel",y.kernelInvalid(gt(n)),n);this.reason=t}};var Yp=class extends El{constructor(e){super(y.kernelDiedWithoutError(gt(e)),void 0,e)}};var AD=class extends tt{constructor(e){super("jupyterexpiredcert",e)}};var Xp=class extends tt{constructor(t){super("invalidremotejupyterserverurihandle","Server handle not in list of known handles");this.serverProviderHandle=t}};var MD=new Map,hK=new Map,fK;function S8(r){fK=r}function gK(r,e){if(!r.pythonEnvironmentPath)return;let t=pe();Ime({interpreterHash:r.pythonEnvironmentPath}).then(n=>{r.pythonEnvironmentPackages=n||r.pythonEnvironmentPackages,e&&(e.pythonEnvironmentPackages=n||e.pythonEnvironmentPackages)}).catch(()=>{}).finally(()=>{t.resolve()})}async function Ime(r){if(!fK)return C("Python package provider is not initialized."),"{}";let e;if("interpreter"in r?e=r.interpreter:e=hK.get(r.interpreterHash),!e)return"{}";let t=await fK(e);return!t||t.size===0?"{}":JSON.stringify(Object.fromEntries(t))}async function x8(r){if(!r)return{};let e=MD.get(ar(r)),t=io(r);if(!e&&t)return{resourceType:t,resourceHash:r?await ht(r.toString()):void 0};if(!e)return{};let n=JSON.parse(JSON.stringify(e[0]));return gK(e[0],n),n}function Rt(r,e,t,n,i){x8(r).then(o=>{Object.assign(o,n||{}),R(e,t,o,i)}).catch(m)}var tu=class extends tt{constructor(t,n,i){super("jupyternotebooknotinstalled",t+(n?`
${n}`:""));this.interpreter=i}};var jv=class{constructor(e,t,n,i,o,s,a,l,c,u,d,f){this.applicationShell=e;this.dependencyManager=t;this.browser=n;this.configuration=i;this.kernelDependency=o;this.workspaceService=s;this.serverUriStorage=a;this.jupyterUriProviderRegistration=l;this.isWebExtension=c;this.extensions=u;this.fs=d;this.interpreterService=f;this.handledErrors=new WeakSet;this.handledKernelErrors=new WeakSet}async handleError(e){if(J("DataScience Error",e),e=hn.unwrap(e),!this.handledErrors.has(e)){if(this.handledErrors.add(e),e instanceof co)await this.dependencyManager?.installMissingDependencies(e);else if(e instanceof Vo)await Jw(this.applicationShell,this.configuration,e.message);else if(e instanceof AD)await $w(this.applicationShell,this.configuration,e.message);else if(!br(e))if(e instanceof jm||e instanceof Uv)this.applicationShell.showErrorMessage(e.message).then(m,m);else if(e instanceof zp||e instanceof Qp||e instanceof tu||e instanceof Ps)this.applicationShell.showErrorMessage(Wv(e)).then(m,m);else if(e instanceof Wi&&this.isWebExtension)this.applicationShell.showErrorMessage(y.jupyterNotebookRemoteConnectFailedWeb(e.baseUrl)).then(m,m);else if(e instanceof Wi){let t=await this.handleJupyterServerConnectionError(e,void 0);this.applicationShell.showErrorMessage(t).then(m,m)}else if(e instanceof ap){let t=await this.handleJupyterServerUriProviderError(e,void 0);this.applicationShell.showErrorMessage(t).then(m,m)}else{let t=C8(e.message||e.toString());this.applicationShell.showErrorMessage(t).then(m,m)}}}async getErrorMessageForDisplayInCell(e,t,n){if(e=hn.unwrap(e),br(e)||C("Error in execution (get message for cell)",e),e instanceof Yp)return"";if(e instanceof Vm)return vK(e.kernelConnectionMetadata)||e.message;if(e instanceof co)return Cme(e)||e.message;if(e instanceof Wi&&!this.isWebExtension)return e.message;if(e instanceof Wi&&this.isWebExtension)return y.jupyterNotebookRemoteConnectFailedWeb(e.baseUrl);if(br(e))return"";if(e instanceof ev){let i=typeof e.product=="string"?e.product:Sr.get(e.product)||`${e.product}`,o=up(e.interpreter)||e.interpreter.id||"",s=W("executable"in e.interpreter?e.interpreter.executable.uri:e.interpreter.uri),a=o?` ${o} (${s})`:s;return y.packageNotInstalledWindowsLongPathNotEnabledError(i,a)}else{if((e instanceof zp||e instanceof Qp)&&(e.kernelConnectionMetadata.kind==="startUsingLocalKernelSpec"||e.kernelConnectionMetadata.kind==="startUsingPythonInterpreter")&&e.kernelConnectionMetadata.interpreter&&!await this.fs.exists(e.kernelConnectionMetadata.interpreter.uri))return y.failedToStartKernelDueToMissingPythonEnv(e.kernelConnectionMetadata.interpreter.displayName||e.kernelConnectionMetadata.interpreter.envName||W(e.kernelConnectionMetadata.interpreter.uri));if((e instanceof zp||e instanceof Qp)&&(e.kernelConnectionMetadata.kind==="startUsingLocalKernelSpec"||e.kernelConnectionMetadata.kind==="startUsingPythonInterpreter")&&e.kernelConnectionMetadata.interpreter&&this.kernelDependency&&!await this.kernelDependency.areDependenciesInstalled(e.kernelConnectionMetadata,void 0,!0))return vK(e.kernelConnectionMetadata)||e.message;if(e instanceof On||e instanceof El){let i=await this.getFilesInWorkingDirectoryThatCouldPotentiallyOverridePythonModules(n),o=rm(Zp.workspace.workspaceFolders||[],e,gt(e.kernelConnectionMetadata),e.kernelConnectionMetadata.interpreter?.sysPrefix,i.map(s=>s.uri));if(o){if(o.reason==="moduleNotFound"&&["ipykernel_launcher","ipykernel"].includes(o.moduleName))return vK(e.kernelConnectionMetadata)||e.message;let s=[o.message];return o.moreInfoLink&&s.push(ye.clickHereForMoreInfoWithHtml(o.moreInfoLink)),mt(e.kernelConnectionMetadata)&&o.reason==="moduleNotFound"&&!["ipykernel_launcher","ipykernel"].includes(o.moduleName)&&await this.addErrorMessageIfPythonArePossiblyOverridingPythonModules(s,n),s.join(`
`)}}else{if(e instanceof Wi)return this.handleJupyterServerConnectionError(e,t);if(e instanceof ap)return this.handleJupyterServerUriProviderError(e,t);if(e instanceof Xp){let i=this.extensions.getExtension(e.serverProviderHandle.extensionId)?.packageJSON.displayName||e.serverProviderHandle.extensionId;return Wv(y.remoteJupyterServerProvidedBy3rdPartyExtensionNoLongerValid(i),t)}}}return Wv(e,t)}async handleJupyterServerUriProviderError(e,t){let n=await ng(e.serverProviderHandle,this.jupyterUriProviderRegistration),i=e.originalError?.message||e.message;return Wv(y.remoteJupyterConnectionFailedWithServerWithError(n,i),t)}async handleJupyterServerConnectionError(e,t){let n=await ng(e.serverProviderHandle,this.jupyterUriProviderRegistration,e.baseUrl),i=e.originalError.message||"";return Wv(y.remoteJupyterConnectionFailedWithServerWithError(n,i),t)}async handleJupyterServerProviderConnectionError(e,t){let n=new Zp.CancellationTokenSource;try{let i=await Promise.resolve(t.serverProvider.provideJupyterServers(n.token));return i&&(i.find(o=>o.id===e.handle)||await this.serverUriStorage.remove(e).catch(m)),!0}catch{return!1}finally{n.dispose()}}async handleKernelError(e,t,n,i,o){if(br(e)||J(`Kernel Error, context = ${t}`,e),e=hn.unwrap(e),br(e))return this.sendKernelTelemetry(e,t,i,"cancelled"),1;if(e instanceof Vm)if(J(`Jupyter Kernel Dependency Error, reason=${e.reason}`,e),this.sendKernelTelemetry(e,t,i,e.category),e.reason===4&&this.kernelDependency){let s=new Zp.CancellationTokenSource;try{let a=o==="3rdPartyExtension";return this.kernelDependency.installMissingDependencies({resource:i,kernelConnection:n,ui:new er(!1),token:s.token,ignoreCache:!0,cannotChangeKernels:a})}finally{s.dispose()}}else return e.reason;else{if((t==="start"||t==="restart")&&e instanceof co)return this.sendKernelTelemetry(e,t,i,e.category),(this.dependencyManager?await this.dependencyManager.installMissingDependencies(e):2)===0?0:1;if(e instanceof Wi||e instanceof ap||e instanceof Xp){this.sendKernelTelemetry(e,t,i,e.category);let s=e instanceof Xp?"":e instanceof Wi?e.originalError.message||"":e.originalError?.message||e.message,a=e.serverProviderHandle.extensionId,l=e.serverProviderHandle.id,c=this.jupyterUriProviderRegistration.jupyterCollections.find(S=>S.extensionId===a&&S.id==l);if(!c||await this.handleJupyterServerProviderConnectionError(e.serverProviderHandle,c))return 3;let u=e instanceof Wi?e.baseUrl:"",d=ng(e.serverProviderHandle,this.jupyterUriProviderRegistration,u),f=e instanceof Xp?this.extensions.getExtension(e.serverProviderHandle.extensionId)?.packageJSON.displayName||e.serverProviderHandle.extensionId:"",h=o==="jupyterExtension"?[y.selectDifferentKernel]:[];switch(await this.applicationShell.showErrorMessage(e instanceof Xp?y.remoteJupyterServerProvidedBy3rdPartyExtensionNoLongerValid(f):y.remoteJupyterConnectionFailedWithServer(d),{detail:s,modal:!0},y.removeRemoteJupyterConnectionButtonText,y.changeRemoteJupyterConnectionButtonText,...h)){case y.removeRemoteJupyterConnectionButtonText:return await this.serverUriStorage.remove(e.serverProviderHandle).catch(m),1;case y.changeRemoteJupyterConnectionButtonText:return 1;case y.selectDifferentKernel:return 3}return 1}else if(e instanceof Vo){this.sendKernelTelemetry(e,t,i,e.category);let s=y.jupyterSelfCertEnable,a=y.jupyterSelfCertClose;return this.applicationShell.showErrorMessage(y.jupyterSelfCertFail(e.message),s,a).then(l=>{l===s?(R("DATASCIENCE.SELFCERTSMESSAGEENABLED"),this.configuration.updateSetting("allowUnauthorizedRemoteConnection",!0,void 0,Zp.ConfigurationTarget.Workspace).catch(m)):l===a&&R("DATASCIENCE.SELFCERTSMESSAGECLOSE")}).then(m,m),2}else{if((t==="start"||t==="restart")&&n.kind==="startUsingPythonInterpreter"&&this.interpreterService&&!await this.fs.exists(n.interpreter.uri))return this.interpreterService.getInterpreterDetails(n.interpreter.id).then(async s=>{let a=await this.fs.exists(n.interpreter.uri);s?Rt(i,"DATASCIENCE.KERNEL_START_FAILURE_MISSING_ENV",void 0,{envMissingReason:"Unknown",isEmptyCondaEnv:s.isCondaEnvWithoutPython,pythonEnvType:s.envType,fileExists:a}):Rt(i,"DATASCIENCE.KERNEL_START_FAILURE_MISSING_ENV",void 0,{envMissingReason:"EmptyEnvDetailsFromPython",isEmptyCondaEnv:n.interpreter.isCondaEnvWithoutPython,pythonEnvType:n.interpreter.envType,fileExists:a})}).catch(async()=>{let s=await this.fs.exists(n.interpreter.uri);Rt(i,"DATASCIENCE.KERNEL_START_FAILURE_MISSING_ENV",void 0,{envMissingReason:"FailedToGetEnvDetailsFromPython",isEmptyCondaEnv:n.interpreter.isCondaEnvWithoutPython,pythonEnvType:n.interpreter.envType,fileExists:s})}).catch(m),this.sendKernelTelemetry(e,t,i,"pythonEnvironmentMissing"),this.applicationShell.showErrorMessage(y.failedToStartKernelDueToMissingPythonEnv(n.interpreter.displayName||n.interpreter.envName||W(n.interpreter.uri))).then(m,m),this.interpreterService.refreshInterpreters(!0).catch(m),2;if((t==="start"||t==="restart")&&this.kernelDependency&&!await this.kernelDependency.areDependenciesInstalled(n,void 0,!0)){this.sendKernelTelemetry(e,t,i,"noipykernel");let s=new Zp.CancellationTokenSource;try{let a=o==="3rdPartyExtension";return this.kernelDependency.installMissingDependencies({resource:i,kernelConnection:n,ui:new er(!1),token:s.token,ignoreCache:!0,cannotChangeKernels:a})}finally{s.dispose()}}else{let s=await this.getFilesInWorkingDirectoryThatCouldPotentiallyOverridePythonModules(i),a=rm(this.workspaceService.workspaceFolders||[],e,gt(n),n.interpreter?.sysPrefix,s.map(l=>l.uri));return this.sendKernelTelemetry(e,t,i,a?.reason),a?this.showMessageWithMoreInfo(a.message,a?.moreInfoLink).catch(m):this.showMessageWithMoreInfo(Wv(e,t)).catch(m),2}}}}sendKernelTelemetry(e,t,n,i){this.handledKernelErrors.has(e)||(this.handledKernelErrors.add(e),t==="start"&&Rt(n,"DATASCIENCE.NOTEBOOK_START",void 0,{disableUI:!1,failureCategory:i},e))}async showMessageWithMoreInfo(e,t){e.includes(V.ViewJupyterOutput)||(e=`${e} 
${y.viewJupyterLogForFurtherInfo}`);let n=t?[ye.learnMore]:[];await this.applicationShell.showErrorMessage(e,...n).then(i=>{i===ye.learnMore&&t&&this.browser.launch(t)})}};jv=g([p(0,(0,ki.inject)(ue)),p(1,(0,ki.inject)(np)),p(1,(0,ki.optional)()),p(2,(0,ki.inject)(ks)),p(3,(0,ki.inject)(se)),p(4,(0,ki.inject)(Ns)),p(4,(0,ki.optional)()),p(5,(0,ki.inject)(ce)),p(6,(0,ki.inject)(cr)),p(7,(0,ki.inject)(Ut)),p(8,(0,ki.inject)(on)),p(9,(0,ki.inject)(rr)),p(10,(0,ki.inject)(Ze)),p(11,(0,ki.inject)(it)),p(11,(0,ki.optional)())],jv);var Sme={restart:y.failedToRestartKernel,start:y.failedToStartKernel,interrupt:y.failedToInterruptKernel,execution:""};function Wv(r,e){r=typeof r=="string"?r:hn.unwrap(r);let t=e?Sme[e]:"",n="";return r instanceof tu?n=y.jupyterNotebookNotInstalledOrNotFound(r.interpreter):r instanceof tt?n=Ww(r.stdErr)||r.stdErr||r.message:n=typeof r=="string"?r:r.message,C8(t,n)}function xme(r){return(new RegExp(/\[([^\[]+)\]\((.*)\)/).exec(r)?.length??0)>0}function C8(r="",e=""){r&&e.startsWith(r.substring(0,r.length-1))&&(r="");let t=[r,e].map(n=>n.trim()).filter(n=>n.length>0).join(` 
`);return!xme(t)&&t.length&&t.indexOf("command:jupyter.viewOutput")===-1?`${t.endsWith(".")?t:t+"."} 
${y.viewJupyterLogForFurtherInfo}`:t}function vK(r){if(r.kind==="connectToLiveRemoteKernel"||r.kind==="startUsingRemoteKernelSpec"||!r.interpreter)return;let e=r.interpreter.displayName||we(r.interpreter.uri),t=Sr.get(19),n=lo(19),i=`${FS(we(r.interpreter.uri))} -m pip install ${n} -U --force-reinstall`;r.interpreter?.envType==="Conda"?r.interpreter?.envName?i=`conda install -n ${r.interpreter?.envName} ${n} --update-deps --force-reinstall`:r.interpreter?.envPath&&(i=`conda install -p ${we(r.interpreter?.envPath)} ${n} --update-deps --force-reinstall`):r.interpreter?.envType==="Unknown"&&(i=`${FS(we(r.interpreter.uri))} -m pip install ${n} -U --user --force-reinstall`);let o=y.libraryRequiredToLaunchJupyterKernelNotInstalledInterpreter(e,Sr.get(19)),s=y.installPackageInstructions(t,i);return o+`
`+s}function Cme(r){let e=`${Sr.get(18)} ${ye.and} ${Sr.get(20)}`,t=[18,20].map(lo).join(" "),n=`python -m pip install ${t} -U
or
conda install ${t} -U`,i=y.installPackageInstructions(e,n);return r.message+`
`+i+`
`+ye.clickHereForMoreInfoWithHtml("https://aka.ms/installJupyterForVSCode")}var Vv=class extends jv{constructor(t,n,i,o,s,a,l,c,u,d,f,h,v){super(t,n,i,o,s,a,l,d,c,u,h,v);this.reservedPythonNames=f}async addErrorMessageIfPythonArePossiblyOverridingPythonModules(t,n){let i=await this.getFilesInWorkingDirectoryThatCouldPotentiallyOverridePythonModules(n);if(i.length>0){let o=n?oi(n):void 0,s=i.map(l=>{if(l.type==="file"){let c=n?W(l.uri,[],o):In(l.uri);return`<a href='${l.uri.toString()}?line=1'>${c}</a>`}else{let c=n?W(l.uri,[],o):`${In(oi(l.uri))}/__init__.py`;return`<a href='${l.uri.toString()}?line=1'>${c}</a>`}}),a="";s.length===1?a=s[0]:a=`${s.slice(0,-1).join(", ")} ${ye.and} ${s.slice(-1)}`,t.push(y.filesPossiblyOverridingPythonModulesMayHavePreventedKernelFromStarting(a)),t.push(y.listOfFilesWithLinksThatMightNeedToBeRenamed(a)),t.push(ye.clickHereForMoreInfoWithHtml(U6))}}async getFilesInWorkingDirectoryThatCouldPotentiallyOverridePythonModules(t){return t?this.reservedPythonNames.getUriOverridingReservedPythonNames(oi(t)):[]}};Vv=g([(0,Gn.injectable)(),p(0,(0,Gn.inject)(ue)),p(1,(0,Gn.inject)(np)),p(1,(0,Gn.optional)()),p(2,(0,Gn.inject)(ks)),p(3,(0,Gn.inject)(se)),p(4,(0,Gn.inject)(Ns)),p(4,(0,Gn.optional)()),p(5,(0,Gn.inject)(ce)),p(6,(0,Gn.inject)(cr)),p(7,(0,Gn.inject)(on)),p(8,(0,Gn.inject)(rr)),p(9,(0,Gn.inject)(Ut)),p(10,(0,Gn.inject)(tD)),p(11,(0,Gn.inject)(Ze)),p(12,(0,Gn.inject)(it))],Vv);var KD=k(A());var dC=class{constructor(e,t,n,i){this.moduleName=e;this.args=t;this.pythonExecutionFactory=n;this._interpreter=i;this.interpreterPromise=Promise.resolve(this._interpreter),this.pythonLauncher=this.interpreterPromise.then(async o=>n.createActivatedEnvironment({interpreter:o}))}interpreter(){return this.interpreterPromise}async exec(e,t){let n={...t},i=await this.pythonLauncher,o=[...this.args,...e],s=o[1];return o.shift(),o.shift(),i.execModule(s,o,n)}},yK=class extends dC{constructor(e,t,n,i){super(e,t,n,i)}},bK=class extends dC{constructor(e,t,n,i){super(e,t,n,i)}async exec(e,t){let n,i={stdout:""};try{i=await super.exec(e,t)}catch(a){n=a}if(!i.stderr&&!n)return i;let o=()=>{if(n)throw C("Exception attempting to enumerate kernelspecs: ",n),n;return i},s=await this.interpreter();if(!s||this.moduleName.toLowerCase()!=="jupyter"||this.args.join(" ").toLowerCase()!=="-m jupyter kernelspec".toLowerCase())return o();try{if(e.join(" ").toLowerCase()==="list --json")return i=await this.getKernelSpecList(s,t),i;if(e.join(" ").toLowerCase()==="--version")return i=await this.getKernelSpecVersion(s,t),i}catch(a){C("Failed to get a list of the kernelspec using python script",a)}return o()}async getKernelSpecList(e,t){return(await this.pythonExecutionFactory.createActivatedEnvironment({interpreter:e})).exec([Ue(Xo,"pythonFiles","vscode_datascience_helpers","getJupyterKernels.py")],{...t,throwOnStdErr:!0})}async getKernelSpecVersion(e,t){return(await this.pythonExecutionFactory.createActivatedEnvironment({interpreter:e})).exec([Ue(Xo,"pythonFiles","vscode_datascience_helpers","getJupyterKernelspecVersion.py")],{...t,throwOnStdErr:!0})}},Bv=class{constructor(e){this.executionFactory=e}createInterpreterCommand(e,t,n,i){return e==="notebook"?new yK(t,n,this.executionFactory,i):e==="kernelspec"?new bK(t,n,this.executionFactory,i):new dC(t,n,this.executionFactory,i)}};Bv=g([(0,KD.injectable)(),p(0,(0,KD.inject)(Hr))],Bv);var Jv=k(A());var qv=class{constructor(e,t,n){this.service=e;this.cmdManager=t;this.disposables=n}activate(){this.disposables.push(this.cmdManager.registerCommand("jupyter.selectJupyterInterpreter",()=>{this.service.selectInterpreter().catch(m)}))}};qv=g([(0,Jv.injectable)(),p(0,(0,Jv.inject)(Ei)),p(1,(0,Jv.inject)(Fe)),p(2,(0,Jv.inject)(O))],qv);var Js=k(A());var qs=k(A());var Kr=require("vscode");var E8=k(ql()),w8=require("vscode");async function FD(r){try{let e=await E8.realpath(r.fsPath);return en()!="Windows"&&(e=e.replace(/\\/g,"/")),w8.Uri.file(e)}catch{return r}}var IK=class{constructor(e,t){this.uri=e;this.value=t}},Eme,Bs=class r{constructor(e,t){this[Eme]="ResourceMap";e instanceof r?(this.map=new Map(e.map),this.toKey=t??r.defaultToKey):(this.map=new Map,this.toKey=e??r.defaultToKey)}static{this.defaultToKey=e=>e.toString()}set(e,t){return this.map.set(this.toKey(e),new IK(e,t)),this}get(e){return this.map.get(this.toKey(e))?.value}has(e){return this.map.has(this.toKey(e))}get size(){return this.map.size}clear(){this.map.clear()}delete(e){return this.map.delete(this.toKey(e))}forEach(e,t){typeof t<"u"&&(e=e.bind(t));for(let[n,i]of this.map)e(i.value,i.uri,this)}*values(){for(let e of this.map.values())yield e.value}*keys(){for(let e of this.map.values())yield e.uri}*entries(){for(let e of this.map.values())yield[e.uri,e.value]}*[(Eme=Symbol.toStringTag,Symbol.iterator)](){for(let[,e]of this.map)yield[e.uri,e.value]}},wme,Zl=class{constructor(e,t){this[wme]="ResourceSet";!e||typeof e=="function"?this._map=new Bs(e):(this._map=new Bs(t),e.forEach(this.add,this))}get size(){return this._map.size}add(e){return this._map.set(e,e),this}clear(){this._map.clear()}delete(e){return this._map.delete(e)}forEach(e,t){this._map.forEach((n,i)=>e.call(t,i,i,this))}has(e){return this._map.has(e)}entries(){return this._map.entries()}keys(){return this._map.keys()}values(){return this._map.keys()}[(wme=Symbol.toStringTag,Symbol.iterator)](){return this.keys()}};var kme=Ue("AppData","Roaming","jupyter","kernels"),k8=Ue(".local","share","jupyter","kernels"),P8=Ue("Library","Jupyter","kernels"),Pme=Ue("AppData","Roaming","jupyter","runtime"),Dme=Ue("Library","Jupyter","runtime"),D8=Ue("share","jupyter","kernels"),LD="CACHE_KEY_FOR_JUPYTER_KERNELSPEC_ROOT_PATH.",SK="CACHE_KEY_FOR_JUPYTER_KERNEL_PATHS_.",rn=class{constructor(e,t,n,i,o,s,a){this.platformService=e;this.envVarsProvider=t;this.globalState=i;this.fs=o;this.context=s;this.pythonExecFactory=a;this.cachedDataDirs=new Map;this.envVarsProvider.onDidEnvironmentVariablesChange(()=>{this.cachedJupyterKernelPaths=void 0,this.cachedJupyterPaths=void 0},this,n)}async getKernelSpecTempRegistrationFolder(){let e=Yt(this.context.extensionUri,"temp","jupyter","kernels");return await this.fs.createDirectory(e),e}async getKernelSpecRootPath(){let e=this.getCachedRootPath();return e||this.cachedKernelSpecRootPath?e||this.cachedKernelSpecRootPath:(this.cachedKernelSpecRootPath=(async()=>{let t=this.platformService.homeDir;if(t)return this.platformService.isWindows?FD(Yt(t,kme)):this.platformService.isMac?Yt(t,P8):Yt(t,k8)})(),this.cachedKernelSpecRootPath.then(t=>{w(`Getting Jupyter KernelSpec Root Path ${t?.toString()}`),this.updateCachedRootPath(t)}).catch(m),this.cachedKernelSpecRootPath)}async getRuntimeDir(){let e,t=this.platformService.homeDir;if(t&&(this.platformService.isWindows?e=await FD(Yt(t,Pme)):this.platformService.isMac?e=Yt(t,Dme):e=process.env.$XDG_RUNTIME_DIR?Kr.Uri.file(Ue(process.env.$XDG_RUNTIME_DIR,"jupyter","runtime")):Yt(t,".local","share","jupyter","runtime")),!e){C("Failed to determine Jupyter runtime directory");return}try{return await this.fs.createDirectory(e),e}catch(n){C(`Failed to create runtime directory, reverting to temp directory ${e}`,n)}}async getDataDirs(e){let t=e.interpreter?e.interpreter.uri.toString():"";return this.cachedDataDirs.has(t)||this.cachedDataDirs.set(t,this.getDataDirsImpl(e.resource,e.interpreter)),this.cachedDataDirs.get(t)}async getDataDirsImpl(e,t){let n=new Bs,i=await this.getJupyterPaths();for(let d of i)d&&!n.has(d)&&n.set(d,n.size);if(t)try{let d=await this.pythonExecFactory.createActivatedEnvironment({interpreter:t,resource:e}),f=Kr.Uri.joinPath(this.context.extensionUri,"pythonFiles","printJupyterDataDir.py"),h=await d.exec([f.fsPath],{});if(h.stdout.trim().length){let v=Kr.Uri.file(h.stdout.trim());await this.fs.exists(v)?n.has(v)||n.set(v,n.size):J(`Got a non-existent Jupyer Data Dir ${v}`)}}catch(d){C(`Failed to get DataDir based on ENABLE_USER_SITE for ${t.displayName}`,d)}let o=t?.sysPrefix?Kr.Uri.joinPath(Kr.Uri.file(t.sysPrefix),"share","jupyter"):void 0,s=this.getSystemJupyterPaths(),a=o?new Zl(s).has(o)?void 0:o:void 0,l=this.getJupyterDataDir(),c=(process.env.JUPYTER_PREFER_ENV_PATH||"no").toLowerCase();return["no","n","false","off","0","0.0"].includes(c)?[l,a].forEach(d=>{d&&!n.has(d)&&n.set(d,n.size)}):[a,l].forEach(d=>{d&&!n.has(d)&&n.set(d,n.size)}),s.forEach(d=>{d&&!n.has(d)&&n.set(d,n.size)}),Array.from(n.entries()).sort((d,f)=>d[1]-f[1]).map(d=>d[0])}getJupyterConfigDir(){return process.env.JUPYTER_CONFIG_DIR?Kr.Uri.file(Pn(process.env.JUPYTER_CONFIG_DIR)):this.platformService.homeDir?Kr.Uri.joinPath(this.platformService.homeDir,".jupyter"):void 0}getSystemJupyterPaths(){if(this.platformService.isWindows){let e=process.env.PROGRAMDATA?Pn(process.env.PROGRAMDATA):void 0;return e?[Kr.Uri.joinPath(Kr.Uri.file(e),"jupyter")]:[]}else return[Kr.Uri.file("/usr/local/share/jupyter"),Kr.Uri.file("/usr/share/jupyter")]}getJupyterDataDir(){if(process.env.JUPYTER_DATA_DIR)return Kr.Uri.file(Pn(process.env.JUPYTER_DATA_DIR));if(this.platformService.homeDir)switch(this.platformService.osType){case"OSX":return Kr.Uri.joinPath(this.platformService.homeDir,"Library","Jupyter");case"Windows":let e=process.env.APPDATA?Kr.Uri.file(Pn(process.env.APPDATA)):"";if(e)return Kr.Uri.joinPath(e,"jupyter");let t=this.getJupyterConfigDir();return t?Kr.Uri.joinPath(t,"data"):Kr.Uri.joinPath(this.platformService.homeDir,"Library","Jupyter");default:{let n=process.env.XDG_DATA_HOME?Kr.Uri.file(Pn(process.env.XDG_DATA_HOME)):Kr.Uri.joinPath(this.platformService.homeDir,".local","share");return Kr.Uri.joinPath(n,"jupyter")}}}async getKernelSpecRootPaths(e){if(this.cachedKernelSpecRootPaths?.promise&&this.cachedKernelSpecRootPaths.stopWatch.elapsedTime<=6e4)return this.cachedKernelSpecRootPaths.promise;let t=new $e,n=this.getKernelSpecRootPathsImpl(e);this.cachedKernelSpecRootPaths={promise:n,stopWatch:t};let i=e.onCancellationRequested(()=>{this.cachedKernelSpecRootPaths?.promise===n&&(this.cachedKernelSpecRootPaths=void 0)},this);return n.finally(()=>i.dispose()).catch(m),n}async getKernelSpecRootPathsImpl(e){let t=new Zl(await this.getJupyterPathKernelPaths(e));if(e.isCancellationRequested)return[];if(this.platformService.isWindows){let n=await this.getKernelSpecRootPath();if(e.isCancellationRequested)return[];n&&t.add(n),process.env.PROGRAMDATA&&t.add(Kr.Uri.file(Ue(process.env.PROGRAMDATA,"jupyter","kernels")))}else{let n=this.platformService.isMac?P8:k8;t.add(Kr.Uri.file(Ue("/","usr","share","jupyter","kernels"))),t.add(Kr.Uri.file(Ue("/","usr","local","share","jupyter","kernels"))),this.platformService.homeDir&&t.add(Yt(this.platformService.homeDir,n))}return w(`Kernel Spec Root Paths, ${Array.from(t).map(n=>W(n)).join(", ")}`),Array.from(t)}async getJupyterPathKernelPaths(e){return this.cachedJupyterKernelPaths=this.cachedJupyterKernelPaths||this.getJupyterPathSubPaths(e,"kernels"),this.cachedJupyterKernelPaths.then(t=>{t.length>0&&this.updateCachedPaths(t).then(m,m)},m),this.getCachedPaths().length>0?this.getCachedPaths():this.cachedJupyterKernelPaths}async getJupyterPaths(e){return this.cachedJupyterPaths=this.cachedJupyterPaths||this.getJupyterPathSubPaths(e),this.cachedJupyterPaths}async getJupyterPathSubPaths(e,t){let n=new Zl,i=await this.envVarsProvider.getEnvironmentVariables(void 0,"RunPythonCode");if(e?.isCancellationRequested)return[];let o=i.JUPYTER_PATH?i.JUPYTER_PATH.split(ii).map(s=>t?Ue(s,t):s):[];return o.length>0&&(await Promise.all(o.map(async a=>FD(Kr.Uri.file(a))))).forEach(a=>{a&&n.add(a)}),w(`Jupyter Paths ${W(t)}: ${Array.from(n).map(s=>W(s))}`),Array.from(n)}getCachedPaths(){return this.globalState.get(SK,[]).map(e=>Kr.Uri.parse(e))}async updateCachedPaths(e){let t=this.globalState.get(SK,[]),n=e.map(Kr.Uri.toString);t.join(",")!==n.join(",")&&await this.globalState.update(SK,n)}getCachedRootPath(){if(this.globalState.get(LD)){let e=this.globalState.get(LD);if(e)return Kr.Uri.parse(e)}}updateCachedRootPath(e){e?this.globalState.update(LD,e.toString()).then(m,m):this.globalState.update(LD,void 0).then(m,m)}};g([gi("getDataDirsImpl",5),p(1,Nc("id"))],rn.prototype,"getDataDirsImpl",1),g([p(0,Xu())],rn.prototype,"getJupyterPathKernelPaths",1),rn=g([(0,qs.injectable)(),p(0,(0,qs.inject)(Ir)),p(1,(0,qs.inject)(Kl)),p(2,(0,qs.inject)(O)),p(3,(0,qs.inject)(He)),p(3,(0,qs.named)(It)),p(4,(0,qs.inject)(Or)),p(5,(0,qs.inject)(dt)),p(6,(0,qs.inject)(Hr))],rn);var Bm=class{constructor(e,t,n,i,o,s,a){this.jupyterInterpreter=e;this.interpreterService=t;this.jupyterDependencyService=n;this.pythonExecutionFactory=i;this.jupyterOutputChannel=o;this.jupyterPaths=s;this.activationHelper=a}async refreshCommands(){}async isNotebookSupported(e){let t=await this.jupyterInterpreter.getSelectedInterpreter(e);return t?this.jupyterDependencyService.areDependenciesInstalled(t,e):!1}async getReasonForJupyterNotebookNotBeingSupported(e){let t=await this.jupyterInterpreter.getSelectedInterpreter(e);if(!t&&(t=await this.interpreterService.getActiveInterpreter(void 0),!t))return y.selectJupyterInterpreter;let n=await this.jupyterDependencyService.getDependenciesNotInstalled(t,e);return n.length===0?"":n.length===1&&n[0]===21?y.jupyterKernelSpecModuleNotFound(t.uri.fsPath):cK(n,t)}async getSelectedInterpreter(e){return this.jupyterInterpreter.getSelectedInterpreter(e)}async startNotebook(e,t){let n=await this.getSelectedInterpreterAndThrowIfNotAvailable(t.token);this.jupyterOutputChannel.appendLine(y.startingJupyterLogMessage($r(n.uri),e.join(" ")));let i=await this.pythonExecutionFactory.createActivatedEnvironment({interpreter:n}),o={...t};o.token=void 0;let s=await this.activationHelper.getActivatedEnvironmentVariables(void 0,n)||process.env,a=(process.env.JUPYTER_PATH||s.JUPYTER_PATH||"").split(ii).filter(c=>c.trim().length);a.push(oi(await this.jupyterPaths.getKernelSpecTempRegistrationFolder()).fsPath),o.env={...s,JUPYTER_PATH:a.join(ii)},w(`Start Jupyter Notebook with JUPYTER_PATH=${a.join(ii)}`),w(`Start Jupyter Notebook with PYTHONPATH=${s.PYTHONPATH||""}`);let l=Object.keys(s).filter(c=>c.toLowerCase()==="path");if(l.length){let c=l.map(u=>`${u}=${s[u]}`).join(",");w(`Start Jupyter Notebook with PATH variable. ${c}`)}else C("Start Jupyter Notebook without a PATH variable");return i.execModuleObservable("jupyter",["notebook"].concat(e),o)}async getRunningJupyterServers(e){let t=await this.getSelectedInterpreterAndThrowIfNotAvailable(e),n=await this.pythonExecutionFactory.createActivatedEnvironment({interpreter:t}),i={mergeStdOutErr:!0,token:e},o=Ue(Xo,"pythonFiles","vscode_datascience_helpers","getServerInfo.py"),s=await n.exec([o],i),a;try{a=JSON.parse(s.stdout.trim())}catch(l){J("Failed to parse JSON when getting server info out from getServerInfo.py",l);return}return a}async installMissingDependencies(e){return this.jupyterInterpreter.installMissingDependencies(e)}async getSelectedInterpreterAndThrowIfNotAvailable(e){let t=await this.jupyterInterpreter.getSelectedInterpreter(e);if(!t){let n=await this.getReasonForJupyterNotebookNotBeingSupported();throw new co(n)}return t}};Bm=g([(0,Js.injectable)(),p(0,(0,Js.inject)(Ei)),p(1,(0,Js.inject)(it)),p(2,(0,Js.inject)(js)),p(3,(0,Js.inject)(Hr)),p(4,(0,Js.inject)(Wo)),p(4,(0,Js.named)(ah)),p(5,(0,Js.inject)(rn)),p(6,(0,Js.inject)(As))],Bm);var UD=k(A());var qm=class{constructor(e){this.pythonExecutionFactory=e}async exportNotebookToPython(e,t,n,i){let o=await this.pythonExecutionFactory.createActivatedEnvironment({resource:e,interpreter:t}),s=n?[e.fsPath,"--to","python","--stdout","--template",n]:[e.fsPath,"--to","python","--stdout"];return o.execModule("jupyter",["nbconvert"].concat(s),{throwOnStdErr:!1,encoding:"utf8",token:i}).then(a=>{if(a.stdout==="")throw C("nbconvert zero size output"),new Error(a.stderr);return a.stdout})}};g([gv("ExportNotebookToPython")],qm.prototype,"exportNotebookToPython",1),qm=g([(0,UD.injectable)(),p(0,(0,UD.inject)(Hr))],qm);var mC=k(A());var $v=class{constructor(e,t){this.installer=e;this.commandFactory=t;this.nbconvertInstalledInInterpreter=new Zl}async isNbConvertInstalled(e,t){if(this.nbconvertInstalledInInterpreter.has(e.uri))return!0;let n=!!await this.installer.isInstalled(22,e)&&!!await this.installer.isInstalled(18,e);return n===!0&&this.nbconvertInstalledInInterpreter.add(e.uri),n}async getNbConvertVersion(e,t){let i=await this.commandFactory.createInterpreterCommand("nbconvert","jupyter",["-m","jupyter","nbconvert"],e,!1).exec(["--version"],{throwOnStdErr:!0});return uk(i.stdout)}};$v=g([(0,mC.injectable)(),p(0,(0,mC.inject)(qi)),p(1,(0,mC.inject)(Nv))],$v);var $m=k(A());var Hv=require("vscode");var ed=k(A());var T8=require("vscode");async function uo(r,e){if(!r)return;let t=ar(r),[n,i]=MD.get(t)||[{resourceType:io(r),resourceHash:r?await ht(r.toString()):void 0,kernelSessionId:await ht(Date.now().toString()),capturedEnvVars:void 0,userExecutedCell:void 0,disableUI:void 0,kernelLanguage:void 0,kernelId:void 0,kernelSpecHash:void 0,isUsingActiveInterpreter:void 0,pythonEnvironmentType:void 0,pythonEnvironmentPath:void 0,pythonEnvironmentVersion:void 0,kernelConnectionType:void 0},{previouslySelectedKernelConnectionId:""}];typeof e.capturedEnvVars=="boolean"&&(n.capturedEnvVars=e.capturedEnvVars),e.userExecutedCell&&(n.userExecutedCell=!0),typeof e.disableUI=="boolean"&&(n.disableUI=e.disableUI);let o=e.kernelConnection;if(o){let s=o.id;i.previouslySelectedKernelConnectionId!==s&&(n.userExecutedCell=e.userExecutedCell,n.disableUI=e.disableUI),i.previouslySelectedKernelConnectionId&&i.previouslySelectedKernelConnectionId!==s&&(n.kernelSessionId=await ht(Date.now().toString()));let a;switch(o.kind){case"connectToLiveRemoteKernel":a=o.kernelModel.language;break;case"startUsingRemoteKernelSpec":case"startUsingLocalKernelSpec":a=o.kernelSpec.language;break;case"startUsingPythonInterpreter":a=xe;break;default:break}let l="kernelSpec"in o&&o.kernelSpec.specFile?ht(o.kernelSpec.specFile):Promise.resolve("");n.kernelLanguage=a,[n.kernelId,n.kernelSpecHash]=await Promise.all([ht(o.id),l]),i.previouslySelectedKernelConnectionId=o.id;let c=o.interpreter;if(c){if(n.isUsingActiveInterpreter=_a.isActiveWorkspaceInterpreter(r,c),n.pythonEnvironmentType=c.envType,n.pythonEnvironmentPath=await ht(we(Pl(c.uri))),hK.set(n.pythonEnvironmentPath,c),c.version){let{major:u,minor:d,patch:f}=c.version;n.pythonEnvironmentVersion=`${u}.${d}.${f}`}else n.pythonEnvironmentVersion=void 0;gK(n)}n.kernelConnectionType=n.kernelConnectionType||o?.kind}else i.previouslySelectedKernelConnectionId="";MD.set(t,[n,i])}async function is(r,e){await uo(r,{kernelConnection:e,userExecutedCell:!0})}var Aa=class{constructor(e,t,n,i,o){this.interpreterService=e;this.envActivation=t;this.envVarsService=n;this.customEnvVars=i;this.configService=o}async getEnvironmentVariables(e,t,n,i){let o=n.env&&Object.keys(n.env).length>0?n.env:void 0,s=(n.language||"").toLowerCase()===xe;if(!t&&n.interpreterPath&&(t=await this.interpreterService.getInterpreterDetails(T8.Uri.file(n.interpreterPath),i).catch(u=>{C("Failed to fetch interpreter information for interpreter that owns a kernel",u)})),i?.isCancellationRequested)return;let[a,l]=await Promise.all([this.customEnvVars.getCustomEnvironmentVariables(e,s?"RunPythonCode":"RunNonPythonCode",i).catch(m),t?this.envActivation.getActivatedEnvironmentVariables(e,t,i).catch(u=>{C("Failed to get env variables for interpreter, hence no variables for Kernel",u)}):void 0]);if(i?.isCancellationRequested)return;await uo(e,{capturedEnvVars:Object.keys(l||{}).length>0}),!l&&Object.keys(a||{}).length===0&&w("No custom variables nor do we have a conda environment");let c={...process.env};if(process.platform==="win32"&&(c={},Object.keys(process.env).forEach(u=>{c[u.toUpperCase()]=process.env[u]})),o=o||{},a=a||{},s||t){if(l=l||a,this.configService.getSettings(e).useOldKernelResolve){this.envVarsService.mergeVariables(l,c),this.envVarsService.mergeVariables(o,c),this.envVarsService.mergeVariables(a,c);let u=Object.keys(l).find(f=>f.toLowerCase()=="path"),d=Object.keys(c).find(f=>f.toLowerCase()=="path")||u;u&&d&&(c[d]=l[u]),l.PYTHONPATH&&(c.PYTHONPATH=l.PYTHONPATH),u=Object.keys(a).find(f=>f.toLowerCase()=="path"),u&&a[u]&&this.envVarsService.appendPath(c,a[u]),u=Object.keys(o).find(f=>f.toLowerCase()=="path"),u&&o[u]&&this.envVarsService.appendPath(c,o[u]),a.PYTHONPATH&&this.envVarsService.appendPythonPath(c,a.PYTHONPATH),o.PYTHONPATH&&this.envVarsService.appendPythonPath(c,o.PYTHONPATH),t&&this.envVarsService.prependPath(c,pt(t.uri.fsPath))}else Object.assign(c,l,o);this.configService.getSettings(void 0).excludeUserSitePackages&&(H(`Adding env Variable PYTHONNOUSERSITE to ${W(t?.uri)}`),c.PYTHONNOUSERSITE="True"),s&&(c.PYDEVD_IPYTHON_COMPATIBLE_DEBUGGING="1")}else this.envVarsService.mergeVariables(o,c),this.envVarsService.mergeVariables(a,c);return w(`Kernel Env Variables for ${n.specFile||n.name}, PATH value is ${c.PATH}`),c}};Aa=g([(0,ed.injectable)(),p(0,(0,ed.inject)(it)),p(1,(0,ed.inject)(As)),p(2,(0,ed.inject)(Ol)),p(3,(0,ed.inject)(Kl)),p(4,(0,ed.inject)(se))],Aa);var _8=require("vscode");async function R8(r,e,t){if(!t.interpreter||!Vt(t)||!r.kernel||r.kernel.status==="dead"||r.kernel.status==="terminating"||t.kind!=="startUsingLocalKernelSpec"&&t.kind!=="startUsingPythonInterpreter")return;let n=new $e;try{let i=await xn(r.kernel,`import sys as _VSCODE_sys
print(_VSCODE_sys.executable); del _VSCODE_sys`);if(i.length===0)return;let o=i[0];if(o.name!=="stdout"&&o.output_type!=="stream")return;let s=_s(o.text).trim().toLowerCase(),a=Co(t.interpreter.uri,_8.Uri.file(s));await uo(e,{interpreterMatchesKernel:a})}catch(i){C(`Failed to compare interpreters after ${n.elapsedTime}ms`,i)}w(`End sendTelemetryForPythonKernelExecutable after ${n.elapsedTime}ms`)}function Tme(r){let e="kernelSpec"in r?r:void 0;if(e?.kind==="startUsingPythonInterpreter")return!0;if(e&&!mt(e))return!1;let t=e?e.kernelSpec:r;return Te(t.argv[0]).toLowerCase().startsWith("python")}function ru(r){let e="kernelSpec"in r?r:void 0;if(e?.kind==="startUsingPythonInterpreter")return!0;if(e&&!mt(e))return!1;let t=e?e.kernelSpec:r;return t.language&&t.language.toLowerCase()!==xe?!1:Tme(r)&&t.argv.some(n=>n.includes("ipykernel_launcher")||n.includes("ipykernel"))}var Jm=class{constructor(e,t,n,i){this.kernelDependencyService=e;this.fs=t;this.jupyterPaths=n;this.kernelEnvVars=i}async ensureKernelIsUsable(e,t,n,i,o){if(w(`Check if a kernel ${t.id} is usable`),ru(t)&&t.interpreter){let a=await this.kernelDependencyService.installMissingDependencies({resource:e,kernelConnection:t,ui:n,token:i,ignoreCache:!0,cannotChangeKernels:o});switch(a){case 1:case 3:case 2:case 4:throw new Vm(a,t);default:break}}var s=void 0;mt(t)&&(s=t.kernelSpec.specFile,!s||!await this.fs.exists(Hv.Uri.file(s))?s=await this.registerKernel(t,i):t.interpreter&&s&&Te(pt(s)).toLowerCase()!=t.kernelSpec.name.toLowerCase()&&(s=await this.registerKernel(t,i)),t.interpreter&&s?(w(`Updating Kernel Environment for ${t.id} for interpreter ${t.interpreter.id}`),await this.updateKernelEnvironment(e,t,s,i)):w(`Not Updating Kernel Environment for ${t.id}`))}async registerKernel(e,t){let n=await this.jupyterPaths.getKernelSpecTempRegistrationFolder();if(!e.kernelSpec||t.isCancellationRequested||!e.kernelSpec.name)return;let i=Yt(n,e.kernelSpec.name,"kernel.json");if(await this.fs.exists(i))return H(`Kernel spec file for ${e.id} already exists ${W(i)}`),i.fsPath;let o={...e.kernelSpec};if(e.kernelSpec.specFile&&!Ap(we(i),e.kernelSpec.specFile)&&(o.metadata=o.metadata||{},o.metadata={...o.metadata,vscode:{...o.metadata.vscode||{},originalSpecFile:e.kernelSpec.metadata?.vscode?.originalSpecFile||e.kernelSpec.specFile,originalDisplayName:e.kernelSpec.metadata?.vscode?.originalDisplayName||e.kernelSpec.display_name}}),e.interpreter&&(o.metadata={...o.metadata,interpreter:Lc(e.interpreter)}),H(`RegisterKernel for ${e.id} into ${W(i)}`),w(`RegisterKernel for ${e.id} into ${W(i)} with contents ${JSON.stringify(o)}`),await this.fs.writeFile(i,JSON.stringify(o,void 0,4)),t.isCancellationRequested)return;let s=o.metadata?.vscode?.originalSpecFile||o.metadata?.originalSpecFile;if(s){let a=pt(s),l=pt(i.fsPath),c=await this.fs.searchLocal("*.*[^json]",a);await Promise.all(c.map(async u=>{let d=Ue(a,u),f=Ue(l,u);await this.fs.copy(Hv.Uri.file(d),Hv.Uri.file(f))}))}return i.fsPath}async updateKernelEnvironment(e,t,n,i){let o=t.interpreter,s=t.kernelSpec,a=await this.jupyterPaths.getKernelSpecTempRegistrationFolder(),l=s;if(n&&a){let c=Te(n).toLowerCase()===s.name.toLowerCase()?n:Yt(a,s.name,"kernel.json").fsPath;if(!await this.fs.exists(Hv.Uri.file(c))){J(`Spec file for ${t.id} does not exist ${c} hence not updating env vars.`);return}let u=Hv.Uri.file(c);try{let d=JSON.parse(await this.fs.readFile(u));if(i?.isCancellationRequested||(d.metadata?.interpreter?(ru(s)&&(w(`Python KernelSpec argv[0] updated for ${t.id} from '${d.argv[0]}' to '${W(o.uri)}'`),d.argv[0]=o.uri.fsPath),d.metadata=d.metadata||{},d.metadata.interpreter=o):w(`KernelSpec argv[0] not updated for ${t.id} ('${d.argv[0]}')`),d.env=await this.kernelEnvVars.getEnvironmentVariables(e,o,l),d=PV(d),await this.fs.writeFile(u,JSON.stringify(d,void 0,2)),w(`Updated kernel spec for ${t.id} with environment variables for ${W(u)}`),i?.isCancellationRequested))return;l.metadata=d.metadata}catch(d){if(i?.isCancellationRequested)return;throw C(`Failed to update kernel spec for ${t.id} with environment variables for ${W(u)}`,d),d}}else J(`Either Kernel spec file or root spec file path does not exist for ${t.id}.`)}};g([vh("Failed to register an interpreter as a kernel")],Jm.prototype,"registerKernel",1),Jm=g([(0,$m.injectable)(),p(0,(0,$m.inject)(Ns)),p(1,(0,$m.inject)(Or)),p(2,(0,$m.inject)(rn)),p(3,(0,$m.inject)(Aa))],Jm);var fC=k(A());var N8=require("vscode");var Gv=class{constructor(e,t){this.liveKernelConnectionTracker=e;this.providerRegistration=t}async isValid(e){if(!this.liveKernelConnectionTracker.wasKernelUsed(e))return!1;let t=await this.providerRegistration.jupyterCollections.find(i=>i.extensionId===e.serverProviderHandle.extensionId&&i.id===e.serverProviderHandle.id);if(!t)return J(`Extension ${e.serverProviderHandle.extensionId} may have been uninstalled for provider ${e.serverProviderHandle.id}, handle ${e.serverProviderHandle.handle}`),!1;let n=new N8.CancellationTokenSource;try{let i=await Promise.resolve(t.serverProvider.provideJupyterServers(n.token));return i?i.map(o=>o.id).includes(e.serverProviderHandle.handle)?!0:(J(`Hiding remote kernel ${e.id} for ${t.id} as the remote Jupyter Server ${e.serverProviderHandle.extensionId}:${e.serverProviderHandle.id}:${e.serverProviderHandle.handle} is no longer available`),!1):!1}catch(i){return J(`Failed to fetch remote servers from ${e.serverProviderHandle.extensionId}:${e.serverProviderHandle.id}`,i),!1}finally{n.dispose()}return!0}};Gv=g([(0,fC.injectable)(),p(0,(0,fC.inject)(em)),p(1,(0,fC.inject)(Ut))],Gv);var zv=k(A());var Hm=class{constructor(e,t,n){this.appShell=t;this.commandManager=n;e.onDidChangeConfiguration(this.onDidChangeConfiguration.bind(this))}async onDidChangeConfiguration(e){if(e.affectsConfiguration("jupyter.jupyterCommandLineArguments")){let t=y.jupyterCommandLineReloadAnswer;await this.appShell.showInformationMessage(y.jupyterCommandLineReloadQuestion,t)===t&&this.commandManager.executeCommand("workbench.action.reloadWindow").then(m,m)}}};Hm=g([(0,zv.injectable)(),p(0,(0,zv.inject)(ce)),p(1,(0,zv.inject)(ue)),p(2,(0,zv.inject)(Fe))],Hm);var U8=k(po()),W8=require("vscode"),os=k(A());var Qv=class extends On{constructor(e){super("timeout",y.jupyterLaunchTimedOut,e)}};var Yv=class{constructor(e,t,n,i,o,s,a){this.interpreterService=e;this.disposableRegistry=t;this.workspace=i;this.configuration=o;this.notebookStarter=s;this.jupyterInterpreterService=a;this.disposed=!1;this._disposed=!1;this.disposableRegistry.push(this.interpreterService.onDidChangeInterpreter(()=>this.onSettingsChanged())),this.disposableRegistry.push(this),i&&i.onDidChangeConfiguration(l=>{l.affectsConfiguration("python.dataScience",void 0)&&this.onSettingsChanged()},this,this.disposableRegistry),n.push(this)}async dispose(){H("Disposing HostJupyterExecution"),this._disposed||(this._disposed=!0,w("Disposing super HostJupyterExecution"),this.disposed=!0,w("Cleaning up server cache"),await this.cache?.then(e=>e.dispose()).catch(m)),w("Finished disposing HostJupyterExecution")}async startServer(e,t){if(this._disposed)throw new Error("Notebook server is disposed");if(!this.cache){let n=this.cache=this.startJupyterWithRetry(e,t);n.catch(i=>{C("Failed to start the Jupyter Server",i),this.cache===n&&(this.cache=void 0)})}return this.cache}async refreshCommands(){await this.jupyterInterpreterService?.refreshCommands()}async isJupyterServerSupported(e){return this.jupyterInterpreterService?this.jupyterInterpreterService.isNotebookSupported(e):!1}async getJupyterServerError(){return this.jupyterInterpreterService?this.jupyterInterpreterService.getReasonForJupyterNotebookNotBeingSupported():y.webNotSupported}async getUsableJupyterPython(e){return!this.usablePythonInterpreter&&!this.disposed&&this.jupyterInterpreterService&&(this.usablePythonInterpreter=await pr(e,this.jupyterInterpreterService.getSelectedInterpreter(e))),this.usablePythonInterpreter}startJupyterWithRetry(e,t){return pr(t,(async()=>{let i,o=1,s=Math.max(1,this.configuration.getSettings(void 0).jupyterLaunchRetries),a;for(;o<=s&&!this.disposed;){try{return i=await this.startImpl(e,t),w("Connection complete server"),i}catch(l){if(a=l,l instanceof Qv&&o<s)H("Retry because of wait for idle problem."),i?.dispose(),o+=1;else throw i&&this.disposed,l}throw a}throw new Error("Max number of attempts reached")})())}async startImpl(e,t){H("Launching server");let n=this.configuration.getSettings(e),i=n.useDefaultConfigForJupyter,o=await this.workspace.computeWorkingDirectory(e),s=Uh(o,this.workspace.rootFolder?Yt(this.workspace.rootFolder,`${(0,U8.default)()}.txt`):void 0,this.workspace,n);if(!this.notebookStarter)throw new Error("Notebook Starter cannot be undefined");return this.notebookStarter.start(e,i,this.configuration.getSettings(void 0).jupyterCommandLineArguments,W8.Uri.file(s),t)}onSettingsChanged(){this.usablePythonInterpreter=void 0}};Yv=g([(0,os.injectable)(),p(0,(0,os.inject)(it)),p(1,(0,os.inject)(O)),p(2,(0,os.inject)(yi)),p(3,(0,os.inject)(ce)),p(4,(0,os.inject)(se)),p(5,(0,os.inject)(Nw)),p(5,(0,os.optional)()),p(6,(0,os.inject)($p)),p(6,(0,os.optional)())],Yv);var gC=k(A());var WD=class extends hn{constructor(){super("Python Extension not installed",void 0,"pythonExtension")}};var Xv=class{constructor(e,t){this.jupyterServerProvider=e;this.extensionChecker=t;this.startupUi=new er(!0)}async connect(e){e.ui.disableUI||(this.startupUi.disableUI=!1);let t=e.ui.onDidChangeDisableUI(()=>{e.ui.disableUI||(this.startupUi.disableUI=!1,t.dispose())});if(e.ui=this.startupUi,this.extensionChecker.isPythonExtensionInstalled)return this.jupyterServerProvider.getOrStartServer(e).finally(()=>t.dispose());throw t.dispose(),this.startupUi.disableUI||await this.extensionChecker.showPythonExtensionInstallRequiredPrompt(),new WD}};Xv=g([(0,gC.injectable)(),p(0,(0,gC.inject)(Ph)),p(1,(0,gC.inject)(ze))],Xv);var Gm=k(A());var jD=class extends tt{constructor(){super("nodeonly",y.webNotSupported)}};var Zv=class{constructor(e,t){this.jupyterServerHelper=e;this.interpreterService=t}async getOrStartServer(e){if(!this.serverPromise){let t=this.serverPromise=this.startServerImpl(e);t.catch(()=>{t===this.serverPromise&&(this.serverPromise=void 0)})}return this.serverPromise}async startServerImpl(e){let t=this.jupyterServerHelper;if(!t)throw new jD;try{if(w("Checking for server usability."),!await this.checkUsable())throw w("Server not usable (should ask for install now)"),new co(y.jupyterNotSupported(await t.getJupyterServerError()));w("Starting notebook server.");let i=await t.startServer(e.resource,e.token);return Cn.throwIfCanceled(e.token),i}catch(n){throw e.token?.isCancellationRequested&&br(n)||await t.refreshCommands(),n}}async checkUsable(){try{return this.jupyterServerHelper?!!await this.jupyterServerHelper.getUsableJupyterPython():!0}catch(e){let t=await this.interpreterService.getActiveInterpreter(void 0);if(t){let n=t.displayName?t.displayName:we(t.uri);throw new Error(y.jupyterNotSupportedBecauseOfEnvironment(n,e.toString()))}else throw new co(y.jupyterNotSupported(this.jupyterServerHelper?await this.jupyterServerHelper.getJupyterServerError():"Error"))}}};Zv=g([(0,Gm.injectable)(),p(0,(0,Gm.inject)(rp)),p(0,(0,Gm.optional)()),p(1,(0,Gm.inject)(it))],Zv);var j8=k(require("child_process")),nu=k(A()),V8=k(require("os"));var B8=k(po()),vC=require("vscode");var BD=require("vscode");var ey=class extends tt{constructor(t,n,i){super("jupytercannotbelaunchedwitheroot",t+(n?`
${n}`:""));this.interpreter=i}};var Ome=new RegExp(qd.UrlPatternRegEx),VD=class{constructor(e,t,n,i,o,s){this.launchResult=e;this.notebookDir=t;this.rootDir=n;this.getServerInfo=i;this.serviceContainer=o;this.interpreter=s;this.startPromise=pe();this.output="";this.subscriptions=[];this.ready=this.startPromise.promise;let l=o.get(se).getSettings(void 0).jupyterLaunchTimeout;this.launchTimeout=setTimeout(()=>{this.startPromise.completed||this.rejectStartPromise(y.jupyterLaunchTimedOut)},l);let c=0;e.proc&&e.proc.on("exit",u=>c=u||0),this.subscriptions.push(e.out.onDidChange(u=>{w(u.out),this.output+=u.out,qd.HttpPattern.exec(this.output)&&!this.startPromise.completed&&this.getServerInfo().then(d=>this.getJupyterURL(d,this.output)).catch(d=>J("Failed to get server info",d))})),e.out.done.then(()=>this.rejectStartPromise(y.jupyterServerCrashed(c))).catch(u=>this.rejectStartPromise(u))}dispose(){clearTimeout(this.launchTimeout),G(this.subscriptions)}getJupyterURL(e,t){if(e&&e.length>0&&!this.startPromise.completed){let n=e.find(i=>Ap(we(this.notebookDir),we(BD.Uri.file(i.notebook_dir))));if(n){let i=n.url,o=n.token;this.resolveStartPromise(i,o)}}if(!this.startPromise.completed){let i=Ome.exec(t)?.groups;if(!this.startPromise.completed&&i&&(i.LOCAL||i.IP)){let o=i.LOCAL?i.LOCAL:i.IP,s=`${i.PREFIX}${o}${i.REST}`,a;try{a=new URL(s)}catch(c){C(`Failed to parse ${s}`,c),this.rejectStartPromise(y.jupyterLaunchNoURL);return}let l=a.pathname.endsWith("/tree")?a.pathname.replace("/tree",""):a.pathname;this.resolveStartPromise(`${a.protocol}//${a.host}${l}`,`${a.searchParams.get("token")}`)}}}resolveStartPromise(e,t){if(clearTimeout(this.launchTimeout),!this.startPromise.rejected){let n=this.serviceContainer.get(se),i=this.serviceContainer.get(Kc),o=this.serviceContainer.get(ip),s=nx({handle:"",id:"_builtin.jupyterServerLauncher",extensionId:bt},{baseUrl:e,token:t,displayName:Ow(t,e)},i,o,n,this.rootDir,new BD.Disposable(()=>this.launchResult.dispose()));this.startPromise.resolve(s)}}rejectStartPromise(e){if(clearTimeout(this.launchTimeout),!this.startPromise.resolved){e=typeof e=="string"?e:e.message;let t,n=this.output;n.includes("Jupyter command `jupyter-notebook` not found")?t=new tu(e,n,this.interpreter):n.includes("Running as root is not recommended. Use --allow-root to bypass")?t=new ey(e,n,this.interpreter):t=new Ps(e,n,this.interpreter),this.startPromise.reject(t)}}};var No=new Set;var ty=class{constructor(e,t,n,i){this.jupyterInterpreterService=e;this.fs=t;this.serviceContainer=n;this.jupyterOutputChannel=i;this.disposables=[]}dispose(){for(;this.disposables.length>0;){let e=this.disposables.shift();try{e&&e.dispose()}catch{}}}async start(e,t,n,i,o){H("Starting Notebook");let s=0,a,l=[],c=ft.reportProgress(e,"NotebookStart");try{let u=this.generateTempDir();u.then(b=>this.disposables.push(b)).catch(m);let d=await this.generateArguments(t,n,u,i.fsPath);Cn.throwIfCanceled(o),w("Starting Jupyter Notebook");let[f,h,v]=await Promise.all([this.jupyterInterpreterService.startNotebook(d||[],{throwOnStdErr:!1,encoding:"utf8",token:o}),u,this.jupyterInterpreterService.getSelectedInterpreter(o).catch(()=>{})]);f.proc&&(f.proc.on("exit",b=>s=b),f.out.onDidChange(b=>this.jupyterOutputChannel.append(b.out))),f&&o.onCancellationRequested(()=>{f.dispose()},this,l),w("Waiting for Jupyter Notebook"),a=new VD(f,vC.Uri.file(h.path),i,()=>this.jupyterInterpreterService.getRunningJupyterServers(o),this.serviceContainer,v),Cn.throwIfCanceled(o);let S=await pr(o,a.ready);try{let b=parseInt(new URL(S.baseUrl).port||"0",10);b&&!isNaN(b)&&(f.proc&&f.proc.on("exit",()=>No.delete(b)),No.add(b))}catch(b){C(`Parsing failed ${S.baseUrl}`,b)}return G(l),S}catch(u){throw G(l),br(u)||u instanceof Ps||u instanceof ey||u instanceof tu?u:await this.jupyterInterpreterService.isNotebookSupported()?s!==0?new Error(y.jupyterServerCrashed(s)):hn.from(y.jupyterNotebookFailure(u),u):new co(await this.jupyterInterpreterService.getReasonForJupyterNotebookNotBeingSupported())}finally{c.dispose(),a?.dispose()}}async generateDefaultArguments(e,t,n){let i=[];i.push(Promise.resolve("--no-browser")),i.push(Promise.resolve(this.getNotebookDirArgument(n))),e&&i.push(this.getConfigArgument(t)),i.push(Promise.resolve("--NotebookApp.iopub_data_rate_limit=10000000000.0"));let[o,s]=await Promise.all([Promise.all(i),this.getDockerArguments()]),a=process.env&&process.env.VSCODE_JUPYTER_DEBUG_JUPYTER?["--debug"]:[];return[...o,...s,...a]}async generateCustomArguments(e){return[...["--no-browser","--NotebookApp.iopub_data_rate_limit=10000000000.0","--KernelManager.autorestart=False"],...e]}async generateArguments(e,t,n,i){return!t||t.length===0?this.generateDefaultArguments(e,n,i):this.generateCustomArguments(t)}getNotebookDirArgument(e){return`--notebook-dir="${e.replace(/\\/g,"\\\\")}"`}async getConfigArgument(e){let t=await e,n=Ue(t.path,"jupyter_notebook_config.py");return await this.fs.writeFile(vC.Uri.file(n),""),H(`Generating custom default config at ${n}`),`--config=${n}`}async getDockerArguments(){let e=[];try{let t=await this.fs.readFile(vC.Uri.file("/proc/self/cgroup")).catch(()=>"");return!t.includes("docker")&&!t.includes("kubepods")?e:(e.push("--ip"),e.push("127.0.0.1"),new Promise(n=>{j8.exec("id",{encoding:"utf-8"},(i,o)=>{o&&o.toString().includes("(root)")&&e.push("--allow-root"),n(e)})}))}catch{return e}}async generateTempDir(){let e=vC.Uri.file(Ue(V8.tmpdir(),(0,B8.default)()));return await this.fs.createDirectory(e),{path:we(e),dispose:async()=>{let t=0;for(;t<10;)try{await this.fs.delete(e),t=10}catch{t+=1}}}}};ty=g([(0,nu.injectable)(),p(0,(0,nu.inject)($p)),p(1,(0,nu.inject)(Ze)),p(2,(0,nu.inject)(ct)),p(3,(0,nu.inject)(Wo)),p(3,(0,nu.named)(ah))],ty);var $s=require("vscode"),ss=k(A());var ry=class extends Mr{constructor(t,n,i,o,s){super();this.context=o;this._onDidLoad=this._register(new $s.EventEmitter);this._onDidChangeUri=this._register(new $s.EventEmitter);this._onDidRemoveUris=this._register(new $s.EventEmitter);this._onDidAddUri=this._register(new $s.EventEmitter);this._all=[];s.push(this);let a=$s.Uri.joinPath(this.context.globalStorageUri,"remoteServersMRUList.json");this.oldStorage=new yC(t,n),this.newStorage=this._register(new xK(i,a,this.oldStorage,n))}get onDidLoad(){return this._onDidLoad.event}get onDidChange(){return this._onDidChangeUri.event}get onDidRemove(){return this._onDidRemoveUris.event}get onDidAdd(){return this._onDidAddUri.event}get all(){return this._all}hookupStorageEvents(){this.storageEventsHooked||(this.storageEventsHooked=!0,this._register(this.newStorage.onDidAdd(t=>this._onDidAddUri.fire(t),this)),this._register(this.newStorage.onDidChange(t=>this._onDidChangeUri.fire(t),this)),this._register(this.newStorage.onDidRemove(t=>this._onDidRemoveUris.fire(t),this)))}async getAll(){this.hookupStorageEvents(),await this.newStorage.migrateMRU();let t=this._all;return this._all=await this.newStorage.getAll(),(t.length!==this._all.length||JSON.stringify(this._all)!==JSON.stringify(t))&&this._onDidLoad.fire(),this._all}async clear(){this.hookupStorageEvents(),await this.newStorage.migrateMRU(),await Promise.all([this.oldStorage.clear(),this.newStorage.clear()]),this._all=[],this._onDidLoad.fire()}async add(t,n){this.hookupStorageEvents(),await this.newStorage.migrateMRU(),te(`setUri: ${t.id}.${t.handle}`);let i={time:n?.time??Date.now(),displayName:"",provider:t};await this.newStorage.add(i),this.getAll().catch(m)}async update(t){this.hookupStorageEvents(),await this.newStorage.migrateMRU(),await this.newStorage.update(t),this.getAll().catch(m)}async remove(t){this.hookupStorageEvents(),await this.newStorage.migrateMRU(),await this.newStorage.remove(t),this.getAll().catch(m)}};ry=g([(0,ss.injectable)(),p(0,(0,ss.inject)(Oc)),p(1,(0,ss.inject)(He)),p(1,(0,ss.named)(It)),p(2,(0,ss.inject)(Ze)),p(3,(0,ss.inject)(dt)),p(4,(0,ss.inject)(O))],ry);var yC=class{constructor(e,t){this.encryptedStorage=e;this.globalMemento=t}async getAllRaw(){let e=this.globalMemento.get(Qt.JupyterServerUriList);if(!Array.isArray(e)||e.length===0)return[];let t=await this.encryptedStorage.retrieve(Qt.JupyterServerRemoteLaunchService,Qt.JupyterServerRemoteLaunchUriListKey);if(!t)return[];let n=t.split(Qt.JupyterServerRemoteLaunchUriSeparator),i=[];return await Promise.all(n.slice(0,Math.min(n.length,e.length)).map(async(o,s)=>{let a=o.split(Qt.JupyterServerRemoteLaunchNameSeparator),l=a[0];if(l!==Qt.JupyterServerLocalLaunch)try{let c=T2(l),u=a[1]===Qt.JupyterServerRemoteLaunchUriEqualsDisplayName||!a[1]?l:a[1];i.push({time:e[s].time,displayName:u,provider:c})}catch(c){l.startsWith(Le.REMOTE_URI)&&C("Failed to parse stored Uri information",c)}})),w(`Found ${i.length} saved URIs, ${JSON.stringify(i)}`),i}async clear(){await this.globalMemento.update(Qt.JupyterServerUriList,[]).then(m,m),await this.encryptedStorage.store(Qt.JupyterServerRemoteLaunchService,Qt.JupyterServerRemoteLaunchUriListKey,void 0).then(m,m)}};yC=g([p(0,(0,ss.inject)(Oc)),p(1,(0,ss.inject)(He)),p(1,(0,ss.named)(It))],yC);var xK=class{constructor(e,t,n,i){this.fs=e;this.storageFile=t;this.oldStorage=n;this.memento=i;this._onDidChangeUri=new $s.EventEmitter;this._onDidRemoveUris=new $s.EventEmitter;this._onDidAddUri=new $s.EventEmitter;this.updatePromise=Promise.resolve();this.mementoKey=`MEMENTO_KEY_FOR_STORING_USED_JUPYTER_PROVIDERS_${$s.env.machineId}`}get onDidChange(){return this._onDidChangeUri.event}get onDidRemove(){return this._onDidRemoveUris.event}get onDidAdd(){return this._onDidAddUri.event}dispose(){this._onDidAddUri.dispose(),this._onDidChangeUri.dispose(),this._onDidRemoveUris.dispose()}async migrateMRU(){if(!this.migration){if(this.memento.get(this.mementoKey)){this.migration=Promise.resolve();return}this.migration=this.migrateToStorageFile().then(()=>this.migrateToMemento())}return this.migration}async migrateToStorageFile(){if(await this.fs.exists(this.storageFile))return;let e=await this.oldStorage.getAllRaw(),t=oi(this.storageFile);await this.fs.exists(t)||await this.fs.createDirectory(t);let n=e.map(i=>({serverHandle:i.provider,displayName:i.displayName||"",time:i.time}));await this.fs.writeFile(this.storageFile,JSON.stringify(n))}async migrateToMemento(){if(this.memento.get(this.mementoKey))return;if(!await this.fs.exists(this.storageFile)){await this.memento.update(this.mementoKey,[]);return}let e=await this.fs.readFile(this.storageFile),t=[];JSON.parse(e).map(n=>{n.serverHandle.extensionId=n.serverHandle.extensionId||VN(n.serverHandle.id)||"",n.serverHandle.extensionId&&t.push(n)}),await Promise.all([this.fs.delete(this.storageFile).catch(m),this.memento.update(this.mementoKey,t)])}async add(e){return this.updatePromise=this.updatePromise.then(async()=>{let t=this.getAll(),n=t.find(a=>$t(a.provider)===$t(e.provider)),o=[{displayName:e.displayName||n?.displayName||$t(e.provider),serverHandle:e.provider,time:e.time}].concat(t.sort((a,l)=>l.time-a.time).filter(a=>$t(a.provider)!==$t(e.provider)).map(a=>({displayName:a.displayName,serverHandle:a.provider,time:a.time}))),s=o.splice(Qt.JupyterServerUriListMax);if(await this.memento.update(this.mementoKey,o),n||this._onDidAddUri.fire(e),s.length){let a=s.map(l=>({provider:l.serverHandle,time:l.time,displayName:l.displayName||""}));this._onDidRemoveUris.fire(a.map(l=>l.provider))}this._onDidChangeUri.fire()}).catch(m)}async update(e){let n=this.getAll().find(o=>o.provider.id===e.id&&o.provider.handle===e.handle),i={provider:e,time:Date.now(),displayName:n?.displayName||""};await this.add(i)}async remove(e){await(this.updatePromise=this.updatePromise.then(async()=>{let t=!1;try{let n=this.getAll();if(n.length===0)return;let i=n.filter(s=>s.provider.id!==e.id||s.provider.handle!==e.handle),o=n.filter(s=>s.provider.id===e.id&&s.provider.handle===e.handle);if(i.length===0)await this.clear();else if(o.length){let s=i.map(a=>({displayName:a.displayName,serverHandle:a.provider,time:a.time}));t=!0,await this.memento.update(this.mementoKey,s),this._onDidRemoveUris.fire(o.map(a=>a.provider))}}finally{t||this._onDidRemoveUris.fire([e])}}).catch(t=>C(`Failed to remove Server handle ${JSON.stringify(e)}`,t)))}getAll(){let e=this.memento.get(this.mementoKey,[]),t=[];return e.forEach(async n=>{let i=$t(n.serverHandle),o={time:n.time,displayName:n.displayName||i,provider:n.serverHandle};t.push(o)}),t}async clear(){let e=this.getAll();await this.memento.update(this.mementoKey,[]),e.length&&this._onDidRemoveUris.fire(e.map(t=>t.provider))}};var td=k(A());var qD="removeKernelUrisAndSessionsUsedByResources",ny=class{constructor(e,t,n){this.disposables=e;this.uriStorage=t;this.memento=n;this.usedRemoteKernelServerIdsAndSessions={}}activate(){this.usedRemoteKernelServerIdsAndSessions=this.memento.get(qD,{}),this.uriStorage.onDidRemove(this.onDidRemoveServers,this,this.disposables)}wasKernelUsed(e){let t=$t(e.serverProviderHandle);return t in this.usedRemoteKernelServerIdsAndSessions&&typeof e.kernelModel.id=="string"&&e.kernelModel.id in this.usedRemoteKernelServerIdsAndSessions[t]}trackKernelIdAsUsed(e,t,n){let i=$t(t);this.usedRemoteKernelServerIdsAndSessions[i]=this.usedRemoteKernelServerIdsAndSessions[i]||{},this.usedRemoteKernelServerIdsAndSessions[i][n]=this.usedRemoteKernelServerIdsAndSessions[i][n]||[];let o=this.usedRemoteKernelServerIdsAndSessions[i][n];o.includes(e.toString())||(o.push(e.toString()),this.memento.update(qD,this.usedRemoteKernelServerIdsAndSessions).then(m,m))}trackKernelIdAsNotUsed(e,t,n){let i=$t(t);if(!(i in this.usedRemoteKernelServerIdsAndSessions)||!(n in this.usedRemoteKernelServerIdsAndSessions[i]))return;let o=this.usedRemoteKernelServerIdsAndSessions[i][n];!Array.isArray(o)||!o.includes(e.toString())||(o.splice(o.indexOf(e.toString()),1),o.length===0&&delete this.usedRemoteKernelServerIdsAndSessions[i][n],Object.keys(this.usedRemoteKernelServerIdsAndSessions[i]).length===0&&delete this.usedRemoteKernelServerIdsAndSessions[i],this.memento.update(qD,this.usedRemoteKernelServerIdsAndSessions).then(m,m))}onDidRemoveServers(e){e.forEach(t=>{let n=$t(t);delete this.usedRemoteKernelServerIdsAndSessions[n],this.memento.update(qD,this.usedRemoteKernelServerIdsAndSessions).then(m,m)})}};ny=g([(0,td.injectable)(),p(0,(0,td.inject)(O)),p(1,(0,td.inject)(cr)),p(2,(0,td.inject)(He)),p(2,(0,td.named)(It))],ny);var Xm=k(require("node-fetch")),t5=k(Z$());var e5=require("vscode");function XK(r){return class extends r{constructor(...n){super(...n);this._onAnyMessage=new e5.EventEmitter;this.onAnyMessage=this._onAnyMessage.event;this.msgChain=Promise.resolve(),this.sendChain=Promise.resolve(),this.receiveHooks=[],this.sendHooks=[]}patchSuperEmit(n){super.emit=n}send(n,i){this.sendHooks?this.sendChain=this.sendChain.then(()=>Promise.all(this.sendHooks.map(o=>o(n,i)))).then(()=>super.send(n,i)):super.send(n,i)}handleEvent(n,i,...o){return i==="message"&&this.receiveHooks.length?(this.msgChain=this.msgChain.then(()=>Promise.all(this.receiveHooks.map(s=>s(o[0])))).then(()=>n(i,...o)).catch(s=>C(`Exception while handling messages: ${s}`)),!0):n(i,...o)}emit(n,...i){return this.handleEvent((o,...s)=>super.emit(o,...s),n,...i)}addReceiveHook(n){this.receiveHooks.push(n)}removeReceiveHook(n){this.receiveHooks=this.receiveHooks.filter(i=>i!==n)}addSendHook(n){this.sendHooks.push(n)}removeSendHook(n){this.sendHooks=this.sendHooks.filter(i=>i!==n)}}}var r5=k(A());var mo=new Map;var sy=class{getRequestCtor(e,t,n){class i extends Xm.Request{constructor(s,a){super(s,a);let l=this.headers,c=n();Object.keys(c).forEach(f=>l.append(f,c[f].toString())),l.set("Content-Type","application/json");let d=l.append.bind(l);l.append=(f,h)=>{f.toLowerCase()!=="authorization"&&d(f,h)}}}return n&&Object.keys(n()||{}).length?i:Xm.Request}getWebsocketCtor(e,t,n,i){let o=()=>{let l={},c;if(t&&(l={...l,rejectUnauthorized:!1}),e&&(c={Cookie:e}),n){let u=n();c=c?{...c,...u}:u}return c&&(l={...l,headers:c}),l},s=l=>{let c=i?i():void 0;if(!(!c&&!l))return!l&&c?c:(l&&!c||(l=l?typeof l=="string"?[l]:l:[],Array.isArray(c)?l.push(...c):typeof c=="string"&&l.push(c)),l)};class a extends XK(t5.default){constructor(u,d){super(u,s(d),o());let f,h=/.*\/kernels\/(.*)\/.*/.exec(u);h&&h.length>1&&(this.kernelId=h[1]),this.kernelId?(mo.set(this.kernelId,this),this.on("close",()=>{f&&this.timer!==f&&clearInterval(f),mo.get(this.kernelId)===this&&mo.delete(this.kernelId)})):C("KernelId not extracted from Kernel WebSocket URL"),f=this.timer=setInterval(()=>this.ping(m),3e4)}}return a}wrapWebSocketCtor(e){class t extends XK(e){constructor(o,s,a){super(o,s,a);let l,c=/.*\/kernels\/(.*)\/.*/.exec(o);c&&c.length>1&&(this.kernelId=c[1]),this.kernelId?(mo.set(this.kernelId,this),this.on("close",()=>{l&&this.timer!==l&&clearInterval(l),mo.get(this.kernelId)===this&&mo.delete(this.kernelId)})):C("KernelId not extracted from Kernel WebSocket URL"),l=this.timer=setInterval(()=>this.ping(m),3e4)}}return t}getFetchMethod(){return Xm.default}getHeadersCtor(){return Xm.Headers}getRequestInit(){return{cache:"no-store",credentials:"same-origin"}}};sy=g([(0,r5.injectable)()],sy);var n5=require("https"),i5=k(A());var ay=class{createHttpRequestAgent(){return new n5.Agent({rejectUnauthorized:!1})}};ay=g([(0,i5.injectable)()],ay);var Oo=k(A());var rc=require("vscode");var Vfe=["/bin/sh","/bin/bash","/bin/zsh"];function tT(r,e){let t=(r.argv||[]).some(n=>(n=n.toLowerCase(),Vfe.some(i=>n.includes(i))));R("DATASCIENCE.KERNEL_SPEC_LANGUAGE",void 0,{language:r.language,kind:e,usesShell:t})}var ly="remoteKernelSpecCache.json";var Bfe=2e3,rT=class{constructor(e,t,n,i,o,s,a,l,c,u){this.id=e;this.displayName=t;this.env=n;this.cachedRemoteKernelValidator=i;this.kernelProvider=s;this.serverProviderHandle=a;this.jupyterConnection=l;this.fs=c;this.context=u;this._status="idle";this._onDidChangeStatus=new rc.EventEmitter;this.onDidChangeStatus=this._onDidChangeStatus.event;this.promiseMonitor=new Eo;this.kernelIdsToHide=new Set;this.kind="remote";this.cache=[];this._onDidChangeKernels=new rc.EventEmitter;this.onDidChangeKernels=this._onDidChangeKernels.event;this._onDidChange=new rc.EventEmitter;this.onDidChange=this._onDidChange.event;this.disposables=[];this.cacheFile=rc.Uri.joinPath(u.globalStorageUri,ly),this.cacheKey=$t(a),this.disposables.push(o.registerKernelFinder(this)),this._onDidChangeKernels.event(()=>this._onDidChange.fire(),this,this.disposables),this.disposables.push(this._onDidChangeKernels),this.disposables.push(this._onDidChange),this.disposables.push(this._onDidChangeStatus),this.disposables.push(this.promiseMonitor)}get status(){return this._status}set status(e){this._status!==e&&(this._status=e,this._onDidChangeStatus.fire())}get lastError(){return this._lastError}get kernels(){return this.cache}get items(){return this.kernels}get title(){return this.displayName}dispose(){this.kernelDisposeDelayTimer&&clearTimeout(this.kernelDisposeDelayTimer),G(this.disposables)}async activate(){this.promiseMonitor.onStateChange(()=>{this.status=this.promiseMonitor.isComplete?"idle":"discovering"}),this.loadCache().then(m,m),this.kernelProvider.onDidStartKernel(e=>{Ft(e.kernelConnectionMetadata)&&this.updateCache().then(m,m)},this,this.disposables),this.kernelProvider.onDidDisposeKernel(e=>{if(e&&Ft(e.kernelConnectionMetadata)){this.kernelDisposeDelayTimer&&(clearTimeout(this.kernelDisposeDelayTimer),this.kernelDisposeDelayTimer=void 0);let t=setTimeout(()=>{this.updateCache().then(m,m)},Bfe);return this.kernelDisposeDelayTimer=t,t}},this,this.disposables)}async refresh(){await this.loadCache(!0,!0)}getListOfKernelsWithCachedConnection(e,t=!1){let n=!!this.cachedConnection;return this.cachedConnection=this.cachedConnection||this.getRemoteConnectionInfo(e),this.cachedConnection.then(i=>(i&&!n&&(this.cachedConnection=Promise.resolve(i)),i?this.listKernelsFromConnection(i):Promise.resolve([]))).catch(i=>n?this.getListOfKernelsWithCachedConnection(e,t):(this.cachedConnection=void 0,Promise.reject(i)))}async loadCache(e=!1,t=!1){te(`Remote Kernel Finder load cache Server: ${this.id}`);let n=(async()=>{let i=e?[]:await this.getFromCache(),o=[];if(!e&&Array.isArray(i)&&i.length>0)o=i,this.updateCache().then(m,m),this.loadCache(!0).then(m,m);else try{o=await this.getListOfKernelsWithCachedConnection(t),this._lastError=void 0}catch(s){s instanceof rc.CancellationError||(C("UniversalRemoteKernelFinder: Failed to get kernels without cache",s),this._lastError=s,this._onDidChange.fire())}await this.writeToCache(o)})();this.promiseMonitor.push(n),await n}async updateCache(){let e=(async()=>{let t=[];this._cacheUpdateCancelTokenSource?.dispose();let n=new rc.CancellationTokenSource;this._cacheUpdateCancelTokenSource=n;try{t=await this.getListOfKernelsWithCachedConnection(!1)}catch(i){J(`Could not fetch kernels from the ${this.kind} server, falling back to cache: ${i}`),t=await this.getFromCache(n.token),t=t.filter(o=>o.kind==="connectToLiveRemoteKernel")}n.token.isCancellationRequested||await this.writeToCache(t)})();this.promiseMonitor.push(e),await e}async getRemoteConnectionInfo(e=!0){let t=[];return e&&t.push(ft.createProgressReporter(void 0,y.connectingToJupyter)),this.jupyterConnection.createConnectionInfo(this.serverProviderHandle).finally(()=>G(t))}async getFromCache(e){try{let t=this.cache;(!t||t.length===0)&&(t=await this.getCacheContents());let n=[],i=Promise.all(t.map(async o=>{await this.isValidCachedKernel(o)&&n.push(o)}));return await Gt(e,i),n}catch(t){C("UniversalRemoteKernelFinder: Failed to get from cache",t)}return[]}async getCacheContents(){try{let e=await this.fs.readFile(this.cacheFile),t=JSON.parse(e);if(t.extensionVersion!==this.env.extensionVersion)return[];let n=t.data[this.cacheKey]||[];return Array.isArray(n)?n.map(i=>Rs.fromJSON(i)):[]}catch{return[]}}async listKernelsFromConnection(e){let t=[];try{let n=hp.create(e.settings);t.push(n);let[i,o,s,a]=await Promise.all([n.getRunningKernels(),n.getKernelSpecs(),n.getRunningSessions(),D2(e.serverProviderHandle)]),l=o.map(d=>(tT(d,"remote"),vx.create({kernelSpec:d,id:ci(d,void 0,a),baseUrl:e.baseUrl,serverProviderHandle:e.serverProviderHandle})));return[...s.map(d=>{let f=d.kernel,h=f.last_activity?new Date(Date.parse(f.last_activity.toString())):new Date,v=f.connections?parseInt(f.connections.toString(),10):0,S=i.find(_=>_.id===d.kernel?.id)||{},b=o.find(_=>_.name===d.kernel?.name)||{};return gx.create({kernelModel:{...d.kernel,...b,...S,name:d.kernel?.name||"",lastActivityTime:h,numberOfConnections:v,model:d},baseUrl:e.baseUrl,id:d.kernel?.id||"",serverProviderHandle:e.serverProviderHandle})}).filter(d=>!this.kernelIdsToHide.has(d.kernelModel.id||"")),...l]}catch(n){throw C(`Error fetching kernels from ${e.baseUrl} (${e.displayName}):`,n),n}finally{await Promise.all(t.map(n=>n.dispose().catch(m)))}}async writeToCache(e){try{w(`UniversalRemoteKernelFinder: Writing ${e.length} remote kernel connection metadata to cache`);let t=this.cache,n=new Map(t.map(d=>[d.id,d])),i=new Map(e.map(d=>[d.id,d])),o=e.filter(d=>!n.has(d.id)),s=e.filter(d=>n.has(d.id)&&!tl(d,n.get(d.id))),a=t.filter(d=>!i.has(d.id)),l=this.cacheKey;this.cache=t.filter(d=>i.has(d.id)).concat(o),this.cache.forEach(d=>{let f=i.get(d.id);d!==f&&f.kind==="connectToLiveRemoteKernel"&&d.kind==="connectToLiveRemoteKernel"&&d.updateModel(f.kernelModel)});let c=e.map(d=>d.toJSON()),u={extensionVersion:this.env.extensionVersion,data:{}};try{let d=await this.fs.readFile(this.cacheFile),f=JSON.parse(d);f.extensionVersion===this.env.extensionVersion&&(u=f)}catch{}u.data[l]=c,await this.fs.createDirectory(this.context.globalStorageUri).then(()=>this.fs.writeFile(this.cacheFile,JSON.stringify(u))).catch(d=>{C("Failed to cache the remote kernels.",d)}),(o.length||s.length||a.length)&&this._onDidChangeKernels.fire({removed:a})}catch(t){C("UniversalRemoteKernelFinder: Failed to write to cache",t)}}async isValidCachedKernel(e){switch(e.kind){case"startUsingRemoteKernelSpec":return!1;case"connectToLiveRemoteKernel":return this.cachedRemoteKernelValidator.isValid(e)}}};var nT=require("vscode");var lu=class{constructor(e,t,n,i,o,s,a,l,c,u,d){this.serverUriStorage=e;this.env=t;this.cachedRemoteKernelValidator=n;this.kernelFinder=i;this.kernelProvider=o;this.jupyterConnection=s;this.disposables=a;this.fs=l;this.context=c;this.jupyterPickerRegistration=u;this.jupyterServerProviderRegistry=d;this.serverFinderMapping=new Map;this.handledProviders=new WeakSet;this.mappedProviders=new WeakSet;this.mappedServers=new Set}activate(){this.serverUriStorage.onDidAdd(e=>this.validateAndCreateFinder(e),this,this.disposables),this.serverUriStorage.onDidChange(this.buildListOfFinders,this,this.disposables),this.serverUriStorage.onDidLoad(this.handleProviderChanges,this,this.disposables),this.jupyterPickerRegistration.onDidChangeCollections(this.handleProviderHandleChanges,this,this.disposables),this.serverUriStorage.onDidRemove(this.urisRemoved,this,this.disposables),this.jupyterServerProviderRegistry.onDidChangeCollections(this.handleProviderChanges,this,this.disposables),this.buildListOfFinders(),this.handleProviderChanges().catch(m)}buildListOfFinders(){this.serverUriStorage.getAll().then(e=>e.map(t=>this.validateAndCreateFinder(t).catch(m))).catch(m)}handleProviderHandleChanges(){this.jupyterPickerRegistration.jupyterCollections.forEach(e=>{this.handledProviders.has(e)||(this.handledProviders.add(e),e.serverProvider.onDidChangeServers&&e.serverProvider.onDidChangeServers(this.buildListOfFinders,this,this.disposables))}),this.buildListOfFinders()}async handleProviderChanges(){if(!this.serverUriStorage.all.length)return;let e=new nT.CancellationTokenSource;this.disposables.push(e),await Promise.all(this.jupyterServerProviderRegistry.jupyterCollections.map(t=>{let n=t.serverProvider;if(!(!n||this.mappedProviders.has(n)))return this.mappedProviders.add(n),n?.onDidChangeServers&&n?.onDidChangeServers(()=>this.lookForServersInCollectionAndRemoveOldServers(t),this,this.disposables),this.serverUriStorage.onDidLoad(()=>this.lookForServersInCollectionAndRemoveOldServers(t),this,this.disposables),this.lookForServersInCollectionAndRemoveOldServers(t).catch(m)})),e.dispose()}async lookForServersInCollectionAndRemoveOldServers(e){if(!this.serverUriStorage.all.length)return;let t=new Set(this.serverUriStorage.all.map(o=>$t(o.provider))),n=e.serverProvider;if(!n)return;let i=new nT.CancellationTokenSource;try{let o=await Promise.resolve(n.provideJupyterServers(i.token)),s=new Set;(o||[]).forEach(a=>{let l={extensionId:e.extensionId,handle:a.id,id:e.id},c=$t(l);s.add(c),!(this.mappedServers.has(c)||!t.has(c))&&(this.mappedServers.add(c),this.createRemoteKernelFinder(l,a.label))}),this.serverFinderMapping.forEach((a,l)=>{a.serverProviderHandle.extensionId===e.extensionId&&a.serverProviderHandle.id===e.id&&!s.has($t(a.serverProviderHandle))&&(a.dispose(),this.serverFinderMapping.delete(l))})}catch(o){C(`Failed to get servers for Collection ${e.id} in ${e.extensionId}`,o)}finally{i.dispose()}}async validateAndCreateFinder(e){let t=$t(e.provider);if(this.serverFinderMapping.has(t))return;let n=new nT.CancellationTokenSource,i=async()=>{let s=this.jupyterServerProviderRegistry.jupyterCollections.find(c=>c.extensionId===e.provider.extensionId&&c.id===e.provider.id);if(!s||!s.serverProvider)return;let l=(await Promise.resolve(s.serverProvider.provideJupyterServers(n.token)))?.find(c=>c.id===e.provider.handle)?.label;l&&this.createRemoteKernelFinder(e.provider,l)},o=async()=>{let s=await this.jupyterPickerRegistration.jupyterCollections.find(a=>a.extensionId===e.provider.extensionId&&a.id===e.provider.id)?.label;s&&this.createRemoteKernelFinder(e.provider,s)};await Promise.all([i().catch(m),o().catch(m)]),n.dispose()}getOrCreateRemoteKernelFinder(e,t){let n=$t(e);if(!this.serverFinderMapping.has(n)){let i=new rT(`remote-${n}`,t,this.env,this.cachedRemoteKernelValidator,this.kernelFinder,this.kernelProvider,e,this.jupyterConnection,this.fs,this.context);this.disposables.push(i),this.serverFinderMapping.set(n,i),i.activate().then(m,m)}return this.serverFinderMapping.get(n)}createRemoteKernelFinder(e,t){this.getOrCreateRemoteKernelFinder(e,t)}urisRemoved(e){e.forEach(t=>{let n=$t(t),i=this.serverFinderMapping.get(n);i&&i.dispose(),this.serverFinderMapping.delete(n)})}dispose(){this.serverFinderMapping.forEach(e=>e.dispose())}};g([Br("Handle Jupyter Provider Changes")],lu.prototype,"handleProviderChanges",1),g([Br("Check Servers in Jupyter Server Provider")],lu.prototype,"lookForServersInCollectionAndRemoveOldServers",1),g([Br("Failed to create a Remote Kernel Finder")],lu.prototype,"validateAndCreateFinder",1),lu=g([(0,Oo.injectable)(),p(0,(0,Oo.inject)(cr)),p(1,(0,Oo.inject)(An)),p(2,(0,Oo.inject)(Aw)),p(3,(0,Oo.inject)(Wr)),p(4,(0,Oo.inject)(Ke)),p(5,(0,Oo.inject)(Dn)),p(6,(0,Oo.inject)(O)),p(7,(0,Oo.inject)(Ze)),p(8,(0,Oo.inject)(dt)),p(9,(0,Oo.inject)(Ut)),p(10,(0,Oo.inject)(Ut))],lu);var od=k(A());var id=require("vscode");var dT=k(po());var Ma=k(A());var iT=class extends tt{constructor(t){super("localjupyterserverconnection",y.jupyterNotebookFailure(t.message||t.toString()));this.originalError=t}};function uy(r){if(Pr()){let e=r;if(e&&e._futures){let t=e._futures;t.forEach&&t.forEach(n=>{n._status!==void 0&&(n._status|=4)})}e&&e._reconnectLimit&&(e._reconnectLimit=0)}}var cy=class extends hn{constructor(e){super(e.message,e)}};var CC=require("vscode");var Zm=class extends On{constructor(e){super("invalidkernel",y.kernelInvalid(gt(e)),e)}};async function py(r,e,t,n,i){if(!t.kernel)throw new Zm(r);let o=ft.reportProgress(e,y.waitingForJupyterSessionToBeIdle),s=[];o&&s.push(o);try{w(`Waiting for idle on (kernel): ${t.kernel.id} -> ${t.kernel.status}`);let a=pe();i.onCancellationRequested(()=>a.reject(new CC.CancellationError),void 0,s);let l=(f,h)=>{w(`Got status ${h} in waitForIdleOnSession`),h=="idle"&&a.resolve(h)};t.kernel.statusChanged?.connect(l),s.push(new CC.Disposable(()=>kn(()=>t.kernel?.statusChanged?.disconnect(l)))),t.kernel.status=="idle"&&a.resolve(t.kernel.status);let c=pe(),u=()=>c.resolve("");t.disposed.connect(u,c),s.push(new CC.Disposable(()=>kn(()=>t.disposed.disconnect(u,c)))),c.promise.catch(m),a.promise.catch(m);let d=await Dr(n,"",a.promise,c.promise);if(t.isDisposed)throw C("Session disposed while waiting for session to be idle."),new Zm(r);if(w(`Finished waiting for idle on (kernel): ${t.kernel.id} -> ${t.kernel.status}`),d=="idle")return;throw C(`Shutting down after failing to wait for idle on (kernel): ${t.kernel.id} -> ${t.kernel.status}`),new Qv(r)}catch(a){throw te("Error waiting for idle",a),a}finally{G(s)}}var pT=require("vscode");var ic=k(lT()),cT=require("vscode");var dy=class{constructor(e,t){this.kind=e;this.session=t;this.propertyChanged=new ic.Signal(this);this.kernelChanged=new ic.Signal(this);this.statusChanged=new ic.Signal(this);this.connectionStatusChanged=new ic.Signal(this);this.iopubMessage=new ic.Signal(this);this.unhandledMessage=new ic.Signal(this);this.anyMessage=new ic.Signal(this);this.disposables=[];this.disposed=new ic.Signal(this);this._disposed=new cT.EventEmitter;this.didShutdown=new cT.EventEmitter;this._onDidKernelSocketChange=new cT.EventEmitter;t.propertyChanged.connect(this.onPropertyChanged,this),t.kernelChanged.connect(this.onKernelChanged,this),t.statusChanged.connect(this.onStatusChanged,this),t.connectionStatusChanged.connect(this.onConnectionStatusChanged,this),t.iopubMessage.connect(this.onIOPubMessage,this),t.unhandledMessage.connect(this.onUnhandledMessage,this),t.anyMessage.connect(this.onAnyMessage,this),this.disposables.push({dispose:()=>{this.didShutdown.dispose(),this._disposed.dispose(),this.session.propertyChanged.disconnect(this.onPropertyChanged,this),this.session.kernelChanged.disconnect(this.onKernelChanged,this),this.session.statusChanged.disconnect(this.onStatusChanged,this),this.session.connectionStatusChanged.disconnect(this.onConnectionStatusChanged,this),this.session.iopubMessage.disconnect(this.onIOPubMessage,this),this.session.unhandledMessage.disconnect(this.onUnhandledMessage,this),this.session.anyMessage.disconnect(this.onAnyMessage,this)}})}get id(){return this.session.id}get path(){return this.session.path}get name(){return this.session.name}get type(){return this.session.type}get serverSettings(){return this.session.serverSettings}get model(){return this.session.model}get kernel(){return this.isDisposed||!this.session.kernel?null:this.session.kernel}get isDisposed(){return this._isDisposed===!0}get onDidDispose(){return this._disposed.event}get onDidShutdown(){return this.didShutdown.event}get kernelId(){return this.session?.kernel?.id||""}get onDidKernelSocketChange(){return this._onDidKernelSocketChange.event}async disposeAsync(){this.dispose()}dispose(){this.disposeInvoked||(this.statusChanged.emit("dead"),this._disposed.fire(),this.disposed.emit(),this.previousAnyMessageHandler?.dispose(),G(this.disposables),ic.Signal.disconnectAll(this))}async restart(){await this.session.kernel?.restart(),this.initializeKernelSocket(),H(`Restarted ${this.session?.kernel?.id}`)}initializeKernelSocket(){if(!this.session.kernel)throw new Error("Kernel not initialized in Session");let e={kernel:this.session.kernel,options:{clientId:this.session.kernel.clientId,id:this.session.kernel.id,model:{...this.session.kernel.model},userName:this.session.kernel.username},socket:mo.get(this.session.kernel.id)};JSON.stringify(this.previousKernelSocketInformation?.kernel.model)===JSON.stringify(e.kernel.model)&&this.previousKernelSocketInformation?.kernel===e.kernel&&this.previousKernelSocketInformation?.kernel.id===e.kernel.id&&this.previousKernelSocketInformation?.socket===e.socket||(this.previousKernelSocketInformation=e,this.previousAnyMessageHandler?.dispose(),this.session.kernel?.connectionStatusChanged.disconnect(this.onKernelConnectionStatusHandler,this),this.session.kernel?.connectionStatusChanged.connect(this.onKernelConnectionStatusHandler,this),this._onDidKernelSocketChange.fire())}onPropertyChanged(e,t){this.propertyChanged.emit(t)}onKernelChanged(e,t){this.kernelChanged.emit(t)}onStatusChanged(e,t){this.statusChanged.emit(t);let n=this.status;te(`Server Status = ${n}`)}onConnectionStatusChanged(e,t){this.connectionStatusChanged.emit(t)}onIOPubMessage(e,t){this.iopubMessage.emit(t)}onUnhandledMessage(e,t){J(`Unhandled message found: ${t.header.msg_type}`),this.unhandledMessage.emit(t)}onAnyMessage(e,t){this.anyMessage.emit(t)}setPath(e){return this.session.setPath(e)}setName(e){return this.session.setName(e)}setType(e){return this.session.setType(e)}changeKernel(e){return this.session.changeKernel(e)}onKernelConnectionStatusHandler(e,t){te(`Server Kernel Status = ${t}`)}};var uT=class extends dy{constructor(t,n,i,o,s,a){super(mt(i)?"localJupyter":"remoteJupyter",t);this.resource=n;this.kernelConnectionMetadata=i;this.workingDirectory=o;this.kernelService=s;this.creator=a;this.initializeKernelSocket()}get status(){return this.isDisposed?"dead":this.session?.kernel?this.session.kernel.status:(te(`Kernel status not started because real session is ${this.session?"defined":"undefined"} & real kernel is ${this.session?.kernel?"defined":"undefined"}`),"unknown")}dispose(){this.restartToken?.cancel(),this.restartToken?.dispose(),this.shutdownImplementation(!1).catch(m)}async disposeAsync(){await this.shutdownImplementation(!1).catch(m),await super.disposeAsync()}async waitForIdle(t,n){try{await py(this.kernelConnectionMetadata,this.resource,this.session,t,n)}catch(i){throw te("Error waiting for idle",i),await this.shutdown().catch(m),i}}async restart(){let t=[],n=new pT.CancellationTokenSource;this.restartToken=n;let i=new er(!1);t.push(i),t.push(n);try{await this.validateLocalKernelDependencies(n.token,i),await super.restart()}finally{G(t)}}async validateLocalKernelDependencies(t,n){if(!(!this.kernelConnectionMetadata?.interpreter||!mt(this.kernelConnectionMetadata)||!this.kernelService)){if(t.isCancellationRequested)throw new pT.CancellationError;await this.kernelService.ensureKernelIsUsable(this.resource,this.kernelConnectionMetadata,n,t,this.creator==="3rdPartyExtension")}}async shutdown(){return this.restartToken?.cancel(),this.restartToken?.dispose(),this.shutdownImplementation(!0)}async shutdownImplementation(t){if(this._isDisposed)return;this._isDisposed=!0,w(`Shutdown session - current session, called from ${new Error("").stack}`);let n=`${this.session.kernel?.id}, ${this.kernelConnectionMetadata.id}`;w(`shutdownSession ${n} - start`);try{if(t||this.canShutdownSession())try{w(`Session can be shutdown ${this.kernelConnectionMetadata.id}`),uy(this.session.kernel),this.session.isDisposed||await Dr(1e3,this.session.shutdown().catch(m))}catch{try{this.session.isDisposed||this.session.dispose()}catch(i){J("Failures in disposing the session",i)}}finally{this.didShutdown.fire()}else w(`Session cannot be shutdown ${this.kernelConnectionMetadata.id}`);try{this.session.isDisposed||this.session.dispose()}catch(i){J("Failures in disposing the session",i)}super.dispose(),w("Shutdown session -- complete")}catch(i){J("Failures in disposing the session",i)}w(`shutdownSession ${n} - shutdown complete`)}canShutdownSession(){return mt(this.kernelConnectionMetadata)?!0:this.kernelConnectionMetadata.kind==="connectToLiveRemoteKernel"?!1:this.resource&&io(this.resource)==="interactive"?!0:!(this.resource&&io(this.resource)==="notebook"&&Ft(this.kernelConnectionMetadata))}};var cu=class{constructor(e,t,n,i,o,s){this.jupyterNotebookProvider=e;this.jupyterConnection=t;this.asyncDisposables=n;this.workspaceService=i;this.kernelService=o;this.configService=s}async create(e){let t=[],n,i=()=>{e.ui.disableUI||n||(n=ft.createProgressReporter(e.resource,Ft(e.kernelConnection)?y.connectingToJupyter:y.startingJupyter),t.push(n))};e.ui.disableUI&&e.ui.onDidChangeDisableUI(i,this,t),i();let o,s=[],a=this.configService.getSettings(e.resource).jupyterLaunchTimeout;try{o=Ft(e.kernelConnection)?await pr(e.token,this.jupyterConnection.createConnectionInfo(e.kernelConnection.serverProviderHandle)):await this.jupyterNotebookProvider.getOrStartServer({resource:e.resource,token:e.token,ui:e.ui}),await pr(e.token,this.validateLocalKernelDependencies(e));let l=hp.create(o.settings);this.asyncDisposables.push(l),s.push(new id.Disposable(()=>l.dispose().catch(m))),await pr(e.token,this.validateRemoteServer(e,l));let c=mt(e.kernelConnection)?await pr(e.token,this.workspaceService.computeWorkingDirectory(e.resource)):"",u=await this.connectToOrCreateSession({...e,contentsManager:l.contentsManager,sessionManager:l.sessionManager,kernelManager:l.kernelManager,kernelSpecManager:l.kernelSpecManager,idleTimeout:a,connection:o});e.token.isCancellationRequested&&(await u.shutdown().catch(m),kn(()=>u.dispose())),Cn.throwIfCanceled(e.token),H(`Started session for kernel ${e.kernelConnection.kind}:${e.kernelConnection.id}`);let d=new uT(u,e.resource,e.kernelConnection,id.Uri.file(c),this.kernelService,e.creator),f=u.disposed,h=()=>{l.dispose().catch(m),f.disconnect(h)};this.asyncDisposables.push({dispose:()=>d.shutdown().finally(()=>d.dispose())}),u.disposed.connect(h);let v=d.onDidDispose(h);return this.asyncDisposables.push(v),d}catch(l){throw G(s),Ft(e.kernelConnection)?o?Vo.isSelfCertsError(l)?new Vo(o.baseUrl):Cl.isSelfCertsExpiredError(l)?new Cl(o.baseUrl):new Wi(o.baseUrl,e.kernelConnection.serverProviderHandle,l):l:l instanceof tt?l:new iT(l)}finally{G(t)}}async validateRemoteServer(e,t){if(t.isDisposed)throw new Sn;if(!mt(e.kernelConnection))try{await Promise.all([t.getRunningKernels(),t.getKernelSpecs()])}catch(n){throw C("Failed to fetch running kernels from remote server, connection may be outdated or remote server may be unreachable",n),new Wi(e.kernelConnection.baseUrl,e.kernelConnection.serverProviderHandle,n)}}async validateLocalKernelDependencies(e){if(e.token.isCancellationRequested)throw new id.CancellationError;e.kernelConnection?.interpreter&&mt(e.kernelConnection)&&this.kernelService&&await this.kernelService.ensureKernelIsUsable(e.resource,e.kernelConnection,e.ui,e.token,e.creator==="3rdPartyExtension")}async connectToOrCreateSession(e){if(e.token.isCancellationRequested)throw new id.CancellationError;let t;try{if(e.kernelConnection&&e.kernelConnection.kind==="connectToLiveRemoteKernel"&&e.kernelConnection.kernelModel.id&&e.kernelConnection.kernelModel.model){if(!e.kernelConnection.kernelModel.model)throw new Error("Kernel model not defined when connecting to an existing session");t=e.sessionManager.connectTo({...e.kernelConnection.kernelModel,model:e.kernelConnection.kernelModel.model}),await pr(e.token,uh(async()=>t.kernel?.connectionStatus==="connected"||e.token.isCancellationRequested,e.idleTimeout,100))}else w(`createNewKernelSession ${e.kernelConnection?.id}`),t=await this.createNewSession(e),await py(e.kernelConnection,e.resource,t,e.idleTimeout,e.token).catch(m);if(e.token.isCancellationRequested)throw new id.CancellationError;return t}catch(n){let i=e.ui.disableUI?w:C;throw n instanceof tt?(i("Failed to change kernel, re-throwing",n),n):(i("Failed to change kernel",n),new Zm(e.kernelConnection))}}async createNewSession(e){let t=(e.connection,e.resource,void 0),n=t?.path,i=Zh(e.kernelConnection)??e.kernelSpecManager?.specs?.default??"",o;if(t?.name)o=t.name;else{let a=e.resource?Yu(e.resource):"";o=`${e.resource?In(e.resource,a):""}-${(0,dT.default)()}${a}`}let s={path:n||$fe(e.resource),kernel:{name:i},name:o,type:(e.resource?.path||"").toLowerCase().endsWith(".ipynb")?"notebook":"console"};try{let a=await pr(e.token,e.sessionManager.startNew(s,{kernelConnectionOptions:{handleComms:!0}}));if(!a.kernel)throw new cy(new Error("No kernel created"));return H(y.createdNewKernel(e.connection.baseUrl,a?.kernel?.id||"")),a}catch(a){throw a instanceof cy?a:new cy(a)}}};cu=g([(0,Ma.injectable)(),p(0,(0,Ma.inject)(Ph)),p(1,(0,Ma.inject)(Dn)),p(2,(0,Ma.inject)(yi)),p(3,(0,Ma.inject)(ce)),p(4,(0,Ma.inject)(Rw)),p(4,(0,Ma.optional)()),p(5,(0,Ma.inject)(se))],cu);function Jfe(){return`${Xh}${(0,dT.default)()}`}function $fe(r){let e=`${Jfe()}${(0,dT.default)()}.ipynb`;return r?`${In(r,".ipynb")}${e}`:`${y.defaultNotebookName}${e}`}var my=class{constructor(e,t,n){this.rawKernelSupported=e;this.newRawKernelSessionFactory=t;this.newJupyterSessionFactory=n}async create(e){let t=e.kernelConnection;return this.rawKernelSupported.isSupported&&mt(t)&&this.newRawKernelSessionFactory?this.newRawKernelSessionFactory.create({...e,kernelConnection:t}):this.newJupyterSessionFactory.create(e)}};my=g([(0,od.injectable)(),p(0,(0,od.inject)(wi)),p(1,(0,od.inject)(RD)),p(1,(0,od.optional)()),p(2,(0,od.inject)(cu))],my);var EC=Symbol("RemoteKernelFinderController");function u5(r,e){r.add(Nv,Bv),r.addSingleton(Ie,qv),r.addSingleton(Ie,Mv),r.addSingleton(rp,Yv),r.addSingleton(Hm,Hm),r.addSingleton(js,js),r.addSingleton(kh,$v),r.addSingleton(_w,qm),r.addSingleton(eu,eu),r.addSingleton(Ei,Ei),r.addSingleton(Na,Na),r.addSingleton(Jo,Jo),r.addSingleton(Rw,Jm),r.addSingleton(Ph,Zv),r.addSingleton(np,Bm),r.addSingleton($p,Bm),r.addSingleton(cr,ry),r.addSingleton(Nw,ty),r.addSingleton(Ek,Xv),r.addSingleton(yx,my),r.addSingleton(cu,cu),r.addSingleton(Kc,sy),r.addSingleton(ip,ay),r.addSingleton(Dn,Dn),r.addSingleton(em,ny),r.addBinding(em,Ie),r.addSingleton(Aw,Gv),r.addSingleton(an,Vv),r.addSingleton(EC,lu),r.addBinding(EC,Ie),r.addSingleton(Ut,rg)}var sd=k(A()),oc=require("vscode");var fy=class{constructor(e,t,n,i,o){this.appShell=e;this.disposableRegistry=t;this.kernelProvider=n;this.serverUriStorage=i;this.jupyterUriProviderRegistration=o;this.kernelsStartedSuccessfully=new WeakSet;this.kernelConnectionToKernelMapping=new WeakMap;this.kernelsRestarting=new WeakSet;this.kernelReconnectProgress=new WeakMap;this.lastExecutedCellPerKernel=new WeakMap}activate(){this.kernelProvider.onDidStartKernel(this.onDidStartKernel,this,this.disposableRegistry),this.disposableRegistry.push(this.kernelProvider.onDidDisposeKernel(e=>{this.kernelReconnectProgress.get(e)?.dispose(),this.kernelReconnectProgress.delete(e)},this)),this.disposableRegistry.push(this.kernelProvider.onDidRestartKernel(e=>{this.kernelReconnectProgress.get(e)?.dispose(),this.kernelReconnectProgress.delete(e)},this)),this.disposableRegistry.push(oc.notebooks.onDidChangeNotebookCellExecutionState(e=>{if(!Dt(e.cell.notebook)||e.state!==oc.NotebookCellExecutionState.Idle)return;let t=this.kernelProvider.get(e.cell.notebook);!t||this.lastExecutedCellPerKernel.get(t)!==e.cell||this.lastExecutedCellPerKernel.delete(t)}))}onDidStartKernel(e){if(!this.kernelsStartedSuccessfully.has(e)){if(this.kernelProvider.getKernelExecution(e).onPreExecute(t=>this.lastExecutedCellPerKernel.set(e,t),this,this.disposableRegistry),!e.session?.kernel)return;this.kernelsStartedSuccessfully.add(e),this.kernelConnectionToKernelMapping.set(e.session.kernel,e),e.session?.kernel?.connectionStatusChanged.connect(this.onKernelStatusChanged,this),e.onDisposed(()=>{this.kernelReconnectProgress.get(e)?.dispose(),this.kernelReconnectProgress.delete(e)},this,this.disposableRegistry),e.addHook("willRestart",async()=>{this.kernelReconnectProgress.get(e)?.dispose(),this.kernelReconnectProgress.delete(e),this.kernelsRestarting.add(e)},this,this.disposableRegistry),e.onRestarted(()=>this.kernelsRestarting.delete(e),this,this.disposableRegistry)}}onKernelStatusChanged(e,t){let n=this.kernelConnectionToKernelMapping.get(e);if(n&&!this.kernelsRestarting.has(n))switch(t){case"connected":{this.kernelReconnectProgress.get(n)?.dispose(),this.kernelReconnectProgress.delete(n);return}case"disconnected":{this.kernelReconnectProgress.has(n)&&(this.kernelReconnectProgress.get(n)?.dispose(),this.kernelReconnectProgress.delete(n),this.onKernelDisconnected(n)?.catch(m));return}case"connecting":this.kernelReconnectProgress.has(n)||this.onKernelConnecting(n)?.catch(m);return;default:return}}async onKernelConnecting(e){let t=pe(),n=new oc.Disposable(()=>t.resolve());if(this.kernelReconnectProgress.set(e,n),Ft(e.kernelConnectionMetadata)&&await this.handleRemoteServerShutdown(e,e.kernelConnectionMetadata))return;let i=y.automaticallyReconnectingToAKernelProgressMessage(gt(e.kernelConnectionMetadata));this.appShell.withProgress({location:oc.ProgressLocation.Notification,title:i},async()=>t.promise).then(m,m),this.disposableRegistry.push(n)}async onKernelDisconnected(e){if(e.disposed||e.disposing||(Rt(e.resourceUri,"DATASCIENCE.KERNEL_CRASH"),Ft(e.kernelConnectionMetadata)&&await this.handleRemoteServerShutdown(e,e.kernelConnectionMetadata)))return;let t=mt(e.kernelConnectionMetadata)?y.kernelDisconnected(gt(e.kernelConnectionMetadata)):y.remoteJupyterConnectionFailedWithServer(e.kernelConnectionMetadata.baseUrl);this.appShell.showErrorMessage(t).then(m,m);try{let n=this.lastExecutedCellPerKernel.get(e);if(!n||n.document.isClosed||n.notebook.isClosed||n.executionSummary?.success===!1)return;await fp(n,e.controller,t,!1)}finally{await e.dispose()}}async handleRemoteServerShutdown(e,t){let n=this.jupyterUriProviderRegistration.jupyterCollections.find(o=>o.extensionId===t.serverProviderHandle.extensionId&&o.id===t.serverProviderHandle.id);if(!n)return!1;let i=new oc.CancellationTokenSource;try{return(await Promise.resolve(n.serverProvider.provideJupyterServers(i.token))||[]).map(a=>a.id).includes(t.serverProviderHandle.handle)?!1:(await this.serverUriStorage.remove(t.serverProviderHandle),this.kernelReconnectProgress.get(e)?.dispose(),this.kernelReconnectProgress.delete(e),!0)}catch{return!1}finally{i.dispose()}}};fy=g([(0,sd.injectable)(),p(0,(0,sd.inject)(ue)),p(1,(0,sd.inject)(O)),p(2,(0,sd.inject)(Ke)),p(3,(0,sd.inject)(cr)),p(4,(0,sd.inject)(Ut))],fy);var wC=k(A());var hy=class{constructor(e,t){this.disposableRegistry=e;this.kernelProvider=t;this.kernelsStartedSuccessfully=new WeakSet;this.kernelRestartProgress=new WeakMap}activate(){this.kernelProvider.onKernelStatusChanged(this.onKernelStatusChanged,this,this.disposableRegistry),this.kernelProvider.onDidStartKernel(this.onDidStartKernel,this,this.disposableRegistry),this.disposableRegistry.push(this.kernelProvider.onDidDisposeKernel(e=>{this.kernelRestartProgress.get(e)?.dispose(),this.kernelRestartProgress.delete(e)},this)),this.disposableRegistry.push(this.kernelProvider.onDidRestartKernel(e=>{this.kernelRestartProgress.get(e)?.dispose(),this.kernelRestartProgress.delete(e)},this))}onDidStartKernel(e){this.kernelsStartedSuccessfully.add(e)}onKernelStatusChanged({kernel:e}){if(!(!this.kernelsStartedSuccessfully.has(e)||!e.session||e.session.kind==="localRaw"))if(e.status==="autorestarting"){let t=ft.createProgressReporter(e.resourceUri,y.restartingKernelStatus(gt(e.kernelConnectionMetadata)));this.kernelRestartProgress.set(e,t)}else e.status!=="starting"&&e.status!=="busy"&&e.status!=="unknown"&&this.kernelRestartProgress.has(e)&&(this.kernelRestartProgress.get(e)?.dispose(),this.kernelRestartProgress.delete(e))}};hy=g([(0,wC.injectable)(),p(0,(0,wC.inject)(O)),p(1,(0,wC.inject)(Ke))],hy);var gy=k(A());var ef=class{constructor(e,t,n){this.disposableRegistry=e;this.applicationShell=t;this.kernelProvider=n;this.lastExecutedCellPerKernel=new WeakMap;this.kernelsStartedSuccessfully=new WeakSet}activate(){this.kernelProvider.onKernelStatusChanged(this.onKernelStatusChanged,this,this.disposableRegistry),this.kernelProvider.onDidStartKernel(this.onDidStartKernel,this,this.disposableRegistry)}onDidStartKernel(e){this.kernelsStartedSuccessfully.add(e),this.kernelProvider.getKernelExecution(e).onPreExecute(t=>this.lastExecutedCellPerKernel.set(e,t),this,this.disposableRegistry)}async onKernelStatusChanged({kernel:e}){this.kernelsStartedSuccessfully.has(e)&&(e.disposed||e.disposing||!e.session||(e.session.kind==="localRaw"&&e.status==="dead"&&(this.applicationShell.showErrorMessage(y.kernelDiedWithoutError(gt(e.kernelConnectionMetadata))).then(m,m),await this.endCellAndDisplayErrorsInCell(e)),e.session.kind!=="localRaw"&&e.status==="autorestarting"&&(this.applicationShell.showErrorMessage(y.kernelDiedWithoutErrorAndAutoRestarting(gt(e.kernelConnectionMetadata))).then(m,m),await this.endCellAndDisplayErrorsInCell(e))))}async endCellAndDisplayErrorsInCell(e){let t=this.lastExecutedCellPerKernel.get(e);if(Rt(e.resourceUri,"DATASCIENCE.KERNEL_CRASH"),!!t)return fp(t,e.controller,y.kernelCrashedDueToCodeInCurrentOrPreviousCell,!1)}};g([Br()],ef.prototype,"onKernelStatusChanged",1),ef=g([(0,gy.injectable)(),p(0,(0,gy.inject)(O)),p(1,(0,gy.inject)(ue)),p(2,(0,gy.inject)(Ke))],ef);var Oa=k(A()),p5=require("vscode");var ad=class{constructor(e,t,n,i,o,s){this.appShell=e;this.installer=t;this.memento=n;this.isCodeSpace=i;this.rawSupport=o;this.serviceContainer=s;this.installPromises=new Map}async installMissingDependencies({resource:e,kernelConnection:t,ui:n,token:i,ignoreCache:o,cannotChangeKernels:s,installWithoutPrompting:a}){if(!mt(t)||!Vt(t)||!t.interpreter)return 0;H(`Check & install missing Kernel dependencies for ${W(t.interpreter?.uri)}, ui.disabled=${n.disableUI} for resource '${W(e)}'`);let l=async()=>{if(await ft.wrapAndReportProgress(e,y.validatingKernelDependencies,()=>this.areDependenciesInstalled(t,i,o)))return 0;if(i?.isCancellationRequested)return 1};if(!a){let h=await l();if(h===0||h===1)return h}let c=ar(t.interpreter.uri),u=this.installPromises.get(c),d;if(!u){let h=new p5.CancellationTokenSource,v=i.onCancellationRequested(()=>{h.cancel(),v.dispose()});u=ft.wrapAndReportProgress(e,y.installingMissingDependencies,async()=>{if(a){let S=await l();if(S===0||S===1)return S}return this.runInstaller(e,t.interpreter,n,h,s,a)}),u.finally(()=>{v.dispose(),h.dispose()}).catch(m),this.installPromises.set(c,u)}let f=2;try{f=await u,(d?.token?.isCancellationRequested||i.isCancellationRequested)&&(f=1)}catch(h){te("Failed to install kernel dependency",h),f=2}finally{this.installPromises.delete(c)}return f}async areDependenciesInstalled(e,t,n){if(e.kind==="connectToLiveRemoteKernel"||e.kind==="startUsingRemoteKernelSpec"||e.interpreter===void 0)return!0;if(!n&&this.rawSupport.isSupported&&await C6(this.memento,19,e.interpreter))return H(`IPyKernel found previously in this environment ${W(e.interpreter.uri)}`),!0;let i=this.installer.isInstalled(19,e.interpreter).then(o=>o===!0);return i.then(o=>{o&&eD(this.memento,19,e.interpreter).catch(m)},m),Gt(t,!1,i)}async runInstaller(e,t,n,i,o,s){if(te(`Run Installer for ${W(e)} ui.disableUI=${n.disableUI}, cancelTokenSource.token.isCancellationRequested=${i.token.isCancellationRequested}`),n.disableUI)return 4;let[a,l]=await Promise.all([k6(this.memento,19,t),t.envType==="Conda"?void 0:await this.installer.isInstalled(27,t)]);if(i.token.isCancellationRequested)return 1;let c=a?y.libraryRequiredToLaunchJupyterKernelNotInstalledInterpreterAndRequiresUpdate:y.libraryRequiredToLaunchJupyterKernelNotInstalledInterpreter,u=l===!1?[19,27]:[19],d=c(t.displayName||t.uri.fsPath,u.map(L=>Sr.get(L)).join(` ${ye.and} `)),f=u.map(L=>Sr.get(L)).join(", "),h=e?io(e):void 0,v=e?await ht(e.toString()):void 0;Rt(e,"DS_INTERNAL.PYTHON_MODULE_INSTALL",void 0,{action:"displayed",moduleName:f,resourceType:h,resourceHash:v,pythonEnvType:t.envType});let S=ye.install,b=y.selectKernel,D=ye.moreInfo,_=[S];e&&!o&&_.push(b),_.push(D);try{(!this.isCodeSpace||!s)&&Rt(e,"DS_INTERNAL.PYTHON_MODULE_INSTALL",void 0,{action:"prompted",moduleName:f,resourceType:h,resourceHash:v,pythonEnvType:t.envType});let L;do L=this.isCodeSpace||s?S:await Gt(i.token,this.appShell.showInformationMessage(d,{modal:!0},..._)),L===D&&(Rt(e,"DS_INTERNAL.PYTHON_MODULE_INSTALL",void 0,{action:"moreInfo",moduleName:f,resourceType:h,resourceHash:v,pythonEnvType:t.envType}),this.appShell.openUrl("https://aka.ms/AAhi594"));while(L===D);if(i.token.isCancellationRequested)return Rt(e,"DS_INTERNAL.PYTHON_MODULE_INSTALL",void 0,{action:"dismissed",moduleName:f,resourceType:h,resourceHash:v,pythonEnvType:t.envType}),1;if(L===b)return Rt(e,"DS_INTERNAL.PYTHON_MODULE_INSTALL",void 0,{action:"differentKernel",moduleName:f,resourceType:h,resourceHash:v,pythonEnvType:t.envType}),3;if(L===S){Rt(e,"DS_INTERNAL.PYTHON_MODULE_INSTALL",void 0,{action:"install",moduleName:f,resourceType:h,resourceHash:v,pythonEnvType:t.envType});let Z=await Gt(i.token,3,this.installer.install(19,t,i,a===!0,l===!1));if(Z===0)return Rt(e,"DS_INTERNAL.PYTHON_MODULE_INSTALL",void 0,{action:"installed",moduleName:f,resourceType:h,resourceHash:v,pythonEnvType:t.envType}),0;if(Z===2)return Rt(e,"DS_INTERNAL.PYTHON_MODULE_INSTALL",void 0,{action:"failed",moduleName:f,resourceType:h,resourceHash:v,pythonEnvType:t.envType}),2}return Rt(e,"DS_INTERNAL.PYTHON_MODULE_INSTALL",void 0,{action:"dismissed",moduleName:f,resourceType:h,resourceHash:v,pythonEnvType:t.envType}),1}catch(L){throw C(`Failed to install ${f}`,L),Rt(e,"DS_INTERNAL.PYTHON_MODULE_INSTALL",void 0,{action:"error",moduleName:f,resourceType:h,resourceHash:v,pythonEnvType:t.envType}),L}}};g([gi("Install Missing Dependencies")],ad.prototype,"installMissingDependencies",1),g([gi("Are Dependencies Installed"),p(0,Nc("id"))],ad.prototype,"areDependenciesInstalled",1),ad=g([(0,Oa.injectable)(),p(0,(0,Oa.inject)(ue)),p(1,(0,Oa.inject)(qi)),p(2,(0,Oa.inject)(He)),p(2,(0,Oa.named)(It)),p(3,(0,Oa.inject)(op)),p(4,(0,Oa.inject)(wi)),p(5,(0,Oa.inject)(ct))],ad);var fT=k(A()),mT=require("vscode");var vy=class{constructor(e){this.disposables=e;this._onDidChangeRegistrations=new mT.EventEmitter;this.onDidChangeRegistrations=this._onDidChangeRegistrations.event;this._finders=[];this.connectionFinderMapping=new Map;this._onDidChangeKernels=new mT.EventEmitter;this.onDidChangeKernels=this._onDidChangeKernels.event;this._status="idle";this._onDidChangeStatus=new mT.EventEmitter;e.push(this._onDidChangeStatus),e.push(this._onDidChangeRegistrations)}get status(){return this._status}set status(e){this._status!=e&&(this._status=e,this._onDidChangeStatus.fire())}get onDidChangeStatus(){return this._onDidChangeStatus.event}registerKernelFinder(e){this._finders.push(e),e.status==="discovering"&&(this.status="discovering");let t=e.onDidChangeStatus(()=>this.status=this._finders.every(i=>i.status==="idle")?"idle":"discovering",this,this.disposables),n=e.onDidChangeKernels(()=>this._onDidChangeKernels.fire());return this.disposables.push(n),this._onDidChangeKernels.fire(),this._onDidChangeRegistrations.fire({added:[e],removed:[]}),{dispose:()=>{let i=this._finders.findIndex(o=>o===e);this._finders.splice(i,1),n.dispose(),t.dispose(),this._onDidChangeKernels.fire(),this._onDidChangeRegistrations.fire({added:[],removed:[e]})}}}get kernels(){let e=[];this.connectionFinderMapping.clear();let t=new Set;this._finders.filter(i=>i.kind==="localPythonEnvironment").forEach(i=>{i.kernels.forEach(o=>{(o.kind==="startUsingLocalKernelSpec"||o.kind==="startUsingPythonInterpreter")&&o.kernelSpec.specFile&&t.add(o.kernelSpec.specFile),e.push(o),this.connectionFinderMapping.set(o.id,i)})}),this._finders.filter(i=>i.kind==="localKernelSpec").forEach(i=>{i.kernels.forEach(o=>{(o.kind==="startUsingLocalKernelSpec"||o.kind==="startUsingPythonInterpreter")&&o.kernelSpec.specFile&&t.has(o.kernelSpec.specFile)||(e.push(o),this.connectionFinderMapping.set(o.id,i))})});let n=this._finders.filter(i=>i.kind==="remote");for(let i of n){let o=i.kernels;o.forEach(s=>{this.connectionFinderMapping.set(s.id,i)}),e.push(...o)}return e}getFinderForConnection(e){return this.connectionFinderMapping.get(e.id)}get registered(){return this._finders}};vy=g([(0,fT.injectable)(),p(0,(0,fT.inject)(O))],vy);var jr=k(A());var Ka=require("vscode");var hT=class{constructor(e,t,n){this.asyncDisposables=e;this.disposables=t;this.notebook=n;this.executions=new WeakMap;this.kernelsByNotebook=new WeakMap;this.kernelsById=new Map;this.pendingDisposables=new Set;this._onDidRestartKernel=new Ka.EventEmitter;this._onDidStartKernel=new Ka.EventEmitter;this._onDidCreateKernel=new Ka.EventEmitter;this._onDidDisposeKernel=new Ka.EventEmitter;this._onKernelStatusChanged=new Ka.EventEmitter;this.onKernelStatusChanged=this._onKernelStatusChanged.event;this.asyncDisposables.push(this),this.notebook.onDidCloseNotebookDocument(i=>this.disposeOldKernel(i),this,t),t.push(this._onDidDisposeKernel),t.push(this._onDidRestartKernel),t.push(this._onKernelStatusChanged),t.push(this._onDidStartKernel),t.push(this._onDidCreateKernel)}get kernels(){let e=new Set;return this.notebook.notebookDocuments.forEach(t=>{let n=this.get(t);n&&e.add(n)}),Array.from(e)}get onDidDisposeKernel(){return this._onDidDisposeKernel.event}get onDidRestartKernel(){return this._onDidRestartKernel.event}get onDidStartKernel(){return this._onDidStartKernel.event}get onDidCreateKernel(){return this._onDidCreateKernel.event}get(e){if(ti(e)){let t=this.notebook.notebookDocuments.find(n=>n.uri.toString()===e.toString());return t?this.get(t):void 0}else return typeof e=="string"?this.kernelsById.get(e)?.kernel:this.kernelsByNotebook.get(e)?.kernel}getKernelExecution(e){return this.executions.get(e)}getInternal(e){return this.kernelsByNotebook.get(e)}async dispose(){te("Disposing all kernels from kernel provider");let e=Array.from(this.pendingDisposables.values());this.pendingDisposables.clear(),await Promise.all(e),await Promise.all(this.kernels.map(t=>t.dispose()))}storeKernel(e,t,n){this.kernelsByNotebook.set(e,{options:t,kernel:n}),this.kernelsById.set(n.id,{options:t,kernel:n}),this._onDidCreateKernel.fire(n)}deleteMappingIfKernelIsDisposed(e){e.onDisposed(()=>{this.get(e.notebook)===e&&(this.kernelsByNotebook.delete(e.notebook),this.kernelsById.delete(e.id),w(`Kernel got disposed, hence there is no longer a kernel associated with ${W(e.uri)}`)),this.pendingDisposables.delete(e)},this,this.disposables)}disposeOldKernel(e){let t=this.kernelsByNotebook.get(e);t&&(w(`Disposing kernel associated with ${W(e.uri)}, isClosed=${e.isClosed}`),this.kernelsById.delete(t.kernel.id),this.pendingDisposables.add(t.kernel),t.kernel.dispose().catch(n=>J("Failed to dispose old kernel",n)).finally(()=>this.pendingDisposables.delete(t.kernel)).catch(m)),this.kernelsByNotebook.delete(e)}handleServerRemoval(e){this.notebook.notebookDocuments.forEach(t=>{let n=this.kernelsByNotebook.get(t);if(n){let i=n.options.metadata;(i.kind==="connectToLiveRemoteKernel"||i.kind==="startUsingRemoteKernelSpec")&&e.find(s=>s.id===i.serverProviderHandle.id&&s.handle===i.serverProviderHandle.handle)&&(this.kernelsByNotebook.delete(t),this.kernelsById.delete(n.kernel.id))}})}},gT=class{constructor(e,t,n){this.asyncDisposables=e;this.disposables=t;this.notebook=n;this.kernelsByUri=new Map;this.kernelsById=new Map;this.pendingDisposables=new Set;this._onDidRestartKernel=new Ka.EventEmitter;this._onDidStartKernel=new Ka.EventEmitter;this._onDidCreateKernel=new Ka.EventEmitter;this._onDidDisposeKernel=new Ka.EventEmitter;this._onKernelStatusChanged=new Ka.EventEmitter;this.onKernelStatusChanged=this._onKernelStatusChanged.event;this.asyncDisposables.push(this),this.notebook.onDidCloseNotebookDocument(i=>{w(`Notebook document ${W(i.uri)} got closed`),this.disposeOldKernel(i.uri)},this,t),t.push(this._onDidDisposeKernel),t.push(this._onDidRestartKernel),t.push(this._onKernelStatusChanged),t.push(this._onDidStartKernel),t.push(this._onDidCreateKernel)}get kernels(){return Array.from(this.kernelsByUri.values()).map(e=>e.kernel)}get onDidDisposeKernel(){return this._onDidDisposeKernel.event}get onDidRestartKernel(){return this._onDidRestartKernel.event}get onDidStartKernel(){return this._onDidStartKernel.event}get onDidCreateKernel(){return this._onDidCreateKernel.event}get(e){return this.kernelsByUri.get(e.toString())?.kernel||this.kernelsById.get(e.toString())?.kernel}getInternal(e){return this.kernelsByUri.get(e.toString())}async dispose(){te("Disposing all kernels from kernel provider");let e=Array.from(this.pendingDisposables.values());this.pendingDisposables.clear(),await Promise.all(e),await Promise.all(this.kernels.map(t=>t.dispose()))}storeKernel(e,t,n){this.kernelsByUri.set(e.toString(),{options:t,kernel:n}),this.kernelsById.set(n.id,{options:t,kernel:n}),this._onDidCreateKernel.fire(n)}deleteMappingIfKernelIsDisposed(e,t){t.onDisposed(()=>{this.get(e)===t&&(this.kernelsByUri.delete(e.toString()),this.kernelsById.delete(t.id),w(`Kernel got disposed, hence there is no longer a kernel associated with ${W(e)}`)),this.pendingDisposables.delete(t)},this,this.disposables)}disposeOldKernel(e){let t=this.kernelsByUri.get(e.toString());t&&(te(`Disposing kernel associated with ${W(e)}`),this.kernelsById.delete(t.kernel.id),this.pendingDisposables.add(t.kernel),t.kernel.dispose().catch(n=>J("Failed to dispose old kernel",n)).finally(()=>this.pendingDisposables.delete(t.kernel)).catch(m)),this.kernelsByUri.delete(e.toString())}};var eF=k(po()),wn=require("vscode");var f5=k(JP());var ZK="KERNEL_INFO",Hfe=1e3*60*60*24*2;async function m5(r,e,t){let n=[],i={banner:"",help_links:[],implementation:"",implementation_version:"",language_info:{name:"",version:""},protocol_version:"",status:"ok"};if(!r.kernel)return;r.kernel?.info&&(n.push(r.kernel.info),r.kernel.info.then(a=>d5(t,e,a)).catch(m));let o=r.kernel.requestKernelInfo().then(a=>a?.content);if(n.push(o),o.then(a=>d5(t,e,a)).catch(m),e.kind==="connectToLiveRemoteKernel"){let a=Gfe(t,e);a?n.push(Promise.resolve(a)):n.push(Vn(5e3).then(()=>i))}let s=await Promise.race(n);return s===i?J("Failed to Kernel info in a timely manner, defaulting to empty info!"):w("Got Kernel info"),s}async function d5(r,e,t){if(!t||!Ft(e))return;let n=r.get(ZK,[]).filter(i=>Date.now()-i.age<Hfe).filter(i=>i.id!==e.id);n.push({id:e.id,age:Date.now(),info:t}),await r.update(ZK,n)}function Gfe(r,e){if(Ft(e))return r.get(ZK,[]).find(t=>t.id===e.id)?.info}var vT=class extends On{constructor(e){super("kernelpromisetimeout",y.interruptingKernelFailed,e)}};var yT="e976ee50-99ed-4aba-9b6b-9dcd5634d07d:IPyWidgets:";function xT(r){let e=typeof r=="string"?r:"";return typeof r!="string"&&"content"in r&&"code"in r.content&&typeof r.content.code=="string"&&(e=r.content.code),!e.includes(yT)}function CT(r){return r.status==="dead"||r.status==="terminating"&&!r.disposed&&!r.disposing||!r.disposed&&!r.disposing&&(r.session?.status=="unknown"||r.session?.kernel?.status=="unknown")&&(r.session.kernel?.isDisposed||r.session.isDisposed)}function h5(r){return r.status==="dead"||r.status==="terminating"&&!r.isDisposed||!r.isDisposed&&(r.status=="unknown"||r.kernel?.status=="unknown")&&(r.kernel?.isDisposed||r.isDisposed)}var bT=class{constructor(e,t,n,i,o,s,a,l,c,u){this.id=e;this.uri=t;this.resourceUri=n;this.kernelConnectionMetadata=i;this.sessionCreator=o;this.kernelSettings=s;this.appShell=a;this.startupCodeProviders=l;this._creator=c;this.workspaceMemento=u;this.disposables=[];this._onIPyWidgetVersionResolved=new wn.EventEmitter;this._onDidKernelSocketChange=new wn.EventEmitter;this._onStatusChanged=new wn.EventEmitter;this._onRestarted=new wn.EventEmitter;this._onStarted=new wn.EventEmitter;this._onDisposed=new wn.EventEmitter;this.hookedSessionForEvents=new WeakSet;this.hooks=new Map;this.startCancellation=new wn.CancellationTokenSource;this.startupUI=new er(!0);this.disposables.push(this._onStatusChanged),this.disposables.push(this._onRestarted),this.disposables.push(this._onStarted),this.disposables.push(this._onDisposed),this.disposables.push(this._onIPyWidgetVersionResolved),this.disposables.push(this._onDidKernelSocketChange),uo(this.resourceUri,{kernelConnection:this.kernelConnectionMetadata,actionSource:this.creator,disableUI:this.startupUI.disableUI}).catch(m),this.startupUI.onDidChangeDisableUI(()=>{this.startupUI.disableUI||uo(this.resourceUri,{disableUI:!1}).catch(m)},this.disposables)}get ipywidgetsVersion(){return this._ipywidgetsVersion}get onIPyWidgetVersionResolved(){return this._onIPyWidgetVersionResolved.event}get onStatusChanged(){return this._onStatusChanged.event}get onRestarted(){return this._onRestarted.event}get onStarted(){return this._onStarted.event}get onDisposed(){return this._onDisposed.event}get creator(){return this._creator}get startedAtLeastOnce(){return this._startedAtLeastOnce}get info(){return this._info}get status(){return this._jupyterSessionPromise&&!this._session?"starting":this._session?.status??(this.isKernelDead?"dead":"unknown")}get disposed(){return this._disposed===!0||this._session?.isDisposed===!0}get disposing(){return this._disposing===!0}get onDidKernelSocketChange(){return this._onDidKernelSocketChange.event}get session(){return this._session}get restarting(){return this._restartPromise||Promise.resolve()}addHook(e,t,n,i){let o=this.hooks.get(e)||new Set;this.hooks.set(e,o),t=n?t.bind(n):t,o.add(t);let s={dispose:()=>{o.delete(t)}};return i&&i.push(s),s}async start(e){return this.startCancellation.token.isCancellationRequested&&(this.startCancellation.dispose(),this.startCancellation=new wn.CancellationTokenSource),this.startJupyterSession(e)}async interrupt(){let e=Promise.all(Array.from(this.hooks.get("willInterrupt")||new Set).map(n=>n()));H(`Interrupt requested ${W(this.resourceUri||this.uri)}`);let t;try{let n=this._jupyterSessionPromise?await this._jupyterSessionPromise.catch(()=>{}):void 0;H("Interrupt kernel execution"),n?(t=this._interruptPromise?await this._interruptPromise:await(this._interruptPromise=this.interruptExecution(n,e)),this._interruptPromise=void 0):(H("No kernel session to interrupt"),this._interruptPromise=void 0,t="success")}finally{await Promise.all(Array.from(this.hooks.get("interruptCompleted")||new Set).map(n=>n())).catch(m)}if(H(`Interrupt requested & sent for ${W(this.uri)} in notebookEditor.`),t==="timeout"){let n=y.restartKernelAfterInterruptMessage(gt(this.kernelConnectionMetadata)),i=y.restartKernelMessageYes;await this.appShell.showInformationMessage(n,{modal:!0},i)===i&&await this.restart()}}async dispose(){if(H(`Dispose Kernel '${W(this.uri)}' associated with '${W(this.resourceUri)}'`),this._disposing=!0,this.disposingPromise)return this.disposingPromise;this._ignoreJupyterSessionDisposedErrors=!0,this.startCancellation.cancel();let e=async()=>{let t=[];t.push(Promise.all(Array.from(this.hooks.get("willCancel")||new Set).map(n=>n())).then(m).catch(m)),this._session=this._session?this._session:this._jupyterSessionPromise?await this._jupyterSessionPromise.catch(()=>{}):void 0,this._jupyterSessionPromise=void 0,this._session&&(t.push(this._session.disposeAsync().catch(m)),this._session=void 0),this._disposed=!0,this._onDisposed.fire(),this._onStatusChanged.fire("dead");try{await Promise.all(t)}finally{this.startCancellation.dispose(),G(this.disposables)}};this.disposingPromise=e(),await this.disposingPromise}async restart(){try{let e=io(this.resourceUri);H(`Restart requested ${W(this.uri)}`),await Promise.all(Array.from(this.hooks.get("willRestart")||new Set).map(n=>n(this._jupyterSessionPromise))),this.startCancellation.cancel(),this.startCancellation.dispose();let t=new $e;try{let n=this._jupyterSessionPromise?await this._jupyterSessionPromise.catch(()=>{}):void 0;n?(this._restartPromise||(this._restartPromise=n.restart(),this._restartPromise.finally(()=>this._restartPromise=void 0).catch(m)),await this._restartPromise,this.startCancellation=new wn.CancellationTokenSource):await this.start(new er(!1)),Rt(this.resourceUri,"DATASCIENCE.NOTEBOOK_RESTART",{duration:t.elapsedTime},{resourceType:e})}catch(n){C(`Restart failed ${W(this.uri)}`,n),this._ignoreJupyterSessionDisposedErrors=!0;let i=this._session;throw this._session=void 0,this._jupyterSessionPromise=void 0,Rt(this.resourceUri,"DATASCIENCE.NOTEBOOK_RESTART",{duration:t.elapsedTime},void 0,n),await i?.disposeAsync().catch(m),this._ignoreJupyterSessionDisposedErrors=!1,n}await this.initializeAfterStart(this._session),this._onRestarted.fire()}catch(e){throw C(`Failed to restart kernel ${W(this.uri)}`,e),e}finally{Promise.all(Array.from(this.hooks.get("restartCompleted")||new Set).map(e=>e())).catch(m)}}async startJupyterSession(e=new er(!1)){if(this._startedAtLeastOnce=!0,e.disableUI||(this.startupUI.disableUI=!1),e.onDidChangeDisableUI(()=>{!e.disableUI&&this.startupUI.disableUI&&(this.startupUI.disableUI=!1)}),this.startupUI.disableUI?this.startupUI.onDidChangeDisableUI(()=>{this.disposing||this.disposed||this.startupUI.disableUI||is(this.resourceUri,this.kernelConnectionMetadata).catch(m)},this,this.disposables):await is(this.resourceUri,this.kernelConnectionMetadata),this.disposing)throw new wn.CancellationError;if(Cn.throwIfCanceled(this.startCancellation.token),!this._jupyterSessionPromise){let t=new $e;if(await uo(this.resourceUri,{kernelConnection:this.kernelConnectionMetadata,actionSource:this.creator}),this.disposing)throw new wn.CancellationError;Cn.throwIfCanceled(this.startCancellation.token),this._jupyterSessionPromise=this.createJupyterSession().then(n=>(Rt(this.resourceUri,"DS_INTERNAL.PERCEIVED_JUPYTER_STARTUP_NOTEBOOK",{duration:t.elapsedTime}),n)).catch(n=>{throw te(`Failed to create Jupyter Session in Kernel.startNotebook for ${W(this.uri)}`),this.startCancellation.cancel(),this._jupyterSessionPromise=void 0,n})}return this._jupyterSessionPromise.finally(()=>this.sendKernelStartedTelemetry()).catch(m),this._jupyterSessionPromise}async interruptExecution(e,t){let n=pe(),i=new $e,o=[],s=c=>{(c==="restarting"||c==="autorestarting")&&(J("Kernel restarting during interrupt"),n.resolve(!0))},a=(c,u)=>s(u);return e.statusChanged.connect(a),o.push(new wn.Disposable(()=>kn(()=>e.statusChanged.disconnect(a)))),e&&e.kernel&&(H(`Interrupting kernel: ${e.kernel.name}`),await OE(this.kernelSettings.interruptTimeout,new vT(this.kernelConnectionMetadata),e.kernel.interrupt()).catch(c=>{J(`Error during interrupt: ${c}`),n.resolve(!0)})),(async()=>{try{return await Dr(this.kernelSettings.interruptTimeout,"timeout",t.then(()=>"success"),n.promise.then(()=>"restart"))}catch(c){if(n.completed)return"restart";throw Rt(this.resourceUri,"DATASCIENCE.NOTEBOOK_INTERRUPT",{duration:i.elapsedTime},void 0,c),c}finally{G(o)}})().then(c=>(Rt(this.resourceUri,"DATASCIENCE.NOTEBOOK_INTERRUPT",{duration:i.elapsedTime},{result:c}),c))}async createJupyterSession(){if(this.disposing)throw new wn.CancellationError;Cn.throwIfCanceled(this.startCancellation.token);let e=[];try{let t="",n=this.kernelConnectionMetadata.interpreter;if(n){let o=[];o.push(`Python Path: ${W(n.uri)}`),o.push(n.envType||""),o.push(n.envName||""),n.version&&o.push(`${n.version.major}.${n.version.minor}.${n.version.patch}`),t=` (${o.filter(s=>s).join(", ")})`}H(`Starting Kernel ${this.kernelConnectionMetadata.kind}, ${this.kernelConnectionMetadata.id} ${t} for '${W(this.uri)}' (disableUI=${this.startupUI.disableUI})`),this.createProgressIndicator(e),this.isKernelDead=!1,this._onStatusChanged.fire("starting");let i=await this.sessionCreator.create({resource:this.resourceUri,ui:this.startupUI,kernelConnection:this.kernelConnectionMetadata,token:this.startCancellation.token,creator:this.creator});if(this.disposing)throw new wn.CancellationError;if(Cn.throwIfCanceled(this.startCancellation.token),await this.initializeAfterStart(i),this.disposing)throw new wn.CancellationError;return this.sendKernelStartedTelemetry(),this._session=i,this._onStarted.fire(),i}catch(t){if(this.startupUI.disableUI?w(`failed to create IJupyterKernelConnectionSession in kernel, UI Disabled = ${this.startupUI.disableUI}`,t):!this.startCancellation.token&&!br(t)&&C(`failed to create IJupyterKernelConnectionSession in kernel, UI Disabled = ${this.startupUI.disableUI}`,t),Cn.throwIfCanceled(this.startCancellation.token),t instanceof Ps)throw t;let n=y.sessionStartFailedWithKernel(gt(this.kernelConnectionMetadata));throw hn.from(n+" "+("message"in t?t.message:t.toString()),t)}finally{G(e)}}sendKernelStartedTelemetry(){this.uiWasDisabledWhenKernelStartupTelemetryWasLastSent&&this.uiWasDisabledWhenKernelStartupTelemetryWasLastSent===this.startupUI.disableUI||this.startTelemetrySent&&!this.startupUI.disableUI||(this.uiWasDisabledWhenKernelStartupTelemetryWasLastSent=this.startupUI.disableUI===!0,this.startTelemetrySent=!0,Rt(this.resourceUri,"DATASCIENCE.NOTEBOOK_START",void 0,{disableUI:this.startupUI.disableUI}))}createProgressIndicator(e){let t=ft.createProgressReporter(this.resourceUri,y.connectingToKernel(gt(this.kernelConnectionMetadata)),this.startupUI.disableUI);e.push(t),this.startupUI.disableUI&&this.startupUI.onDidChangeDisableUI(()=>{this.disposing||this.disposed||this.startupUI.disableUI||t.show&&t.show()},this,e)}async initializeAfterStart(e){if(await Promise.all(Array.from(this.hooks.get("didStart")||new Set).map(t=>t(e,this.startCancellation.token).catch(m))),w(`Started running kernel initialization for ${W(this.uri)}`),!e){w("Not running kernel initialization");return}if(!this.hookedSessionForEvents.has(e)){this.hookedSessionForEvents.add(e),e.onDidKernelSocketChange(n=>this._onDidKernelSocketChange.fire(n)),e.onDidDispose(()=>{if(te(`Kernel got disposed as a result of session.onDisposed (1) ${W(this.resourceUri||this.uri)}`),!this._ignoreJupyterSessionDisposedErrors){H(`Kernel got disposed as a result of session.onDisposed ${W(this.resourceUri||this.uri)} & _ignoreJupyterSessionDisposedErrors = false.`);let n=this._session===e;this._jupyterSessionPromise=void 0,this._session=void 0,n&&(this.isKernelDead=!0,this._onStatusChanged.fire("dead"))}});let t=(n,i)=>this._onStatusChanged.fire(i);e.statusChanged.connect(t),this.disposables.push(new wn.Disposable(()=>kn(()=>e.statusChanged.disconnect(t))))}if(e.kernel?.registerCommTarget(Le.DefaultCommTarget,m),this.kernelConnectionMetadata.kind==="connectToLiveRemoteKernel")this.determineVersionOfIPyWidgets(e).catch(t=>C("Failed to determine IPyWidget version",t)),this.gatherInternalStartupCode().then(t=>this.executeSilently(e,t,{traceErrors:!0,traceErrorsMessage:"Error executing jupyter extension internal startup code"})).catch(t=>C("Failed to execute internal startup code",t));else{await this.determineVersionOfIPyWidgets(e);let t=await this.gatherInternalStartupCode();await this.executeSilently(e,t,{traceErrors:!0,traceErrorsMessage:"Error executing jupyter extension internal startup code"}),await this.executeSilently(e,this.getUserStartupCommands(),{traceErrors:!1})}try{w("Requesting Kernel info"),this._info=await m5(e,this.kernelConnectionMetadata,this.workspaceMemento)}catch(t){J("Failed to request KernelInfo",t)}this.kernelConnectionMetadata.kind!=="connectToLiveRemoteKernel"&&(w("End running kernel initialization, now waiting for idle"),await e.waitForIdle(this.kernelSettings.launchTimeout,this.startCancellation.token),w("End running kernel initialization, session is idle"))}async determineVersionOfIPyWidgets(e){if(!Vt(this.kernelConnectionMetadata)){this._ipywidgetsVersion==NS,this._onIPyWidgetVersionResolved.fire(NS);return}let t=async()=>{let n=f5.default`
        try:
            import ipywidgets as _VSCODE_ipywidgets
            print("${yT}" + _VSCODE_ipywidgets.__version__)
            del _VSCODE_ipywidgets
        except:
            pass
        `,i=await this.executeSilently(e,[n]).catch(o=>C("Failed to determine version of IPyWidgets",o));if(Array.isArray(i)){let o=i.some(l=>(l.text||"")?.toString().includes(`${yT}8.`)),s=i.some(l=>(l.text||"")?.toString().includes(`${yT}7.`)),a=this._ipywidgetsVersion=s?7:o?8:void 0;w(`Determined IPyWidgets Version as ${a}`),this._ipywidgetsVersion==a,this._onIPyWidgetVersionResolved.fire(a)}else J("Failed to determine IPyKernel Version",JSON.stringify(i))};if(await t(),!this._ipywidgetsVersion&&this.session?.kernel){let n=(i,o)=>{if(o.direction==="send")return;let s=o.msg;s.content&&"data"in s.content&&s.content.data&&(s.content.data[Xi]||"target_name"in s.content&&s.content.target_name===Le.DefaultCommTarget)&&(this._ipywidgetsVersion||(t().catch(m),this.session?.kernel&&this.session.kernel.anyMessage.disconnect(n,this)))};this.session.kernel.anyMessage.connect(n,this)}}async gatherInternalStartupCode(){let e=[],t=await Promise.all(this.startupCodeProviders.sort((n,i)=>i.priority-n.priority).map(n=>n.getCode(this)));for(let n of t)e.push(...n);if(Vt(this.kernelConnectionMetadata)&&this.kernelConnectionMetadata.kind!=="connectToLiveRemoteKernel"){let n=we(this.resourceUri);n&&e.push(`__vsc_ipynb_file__ = "${n.replace(/\\/g,"\\\\")}"`),this.kernelSettings.enableExtendedKernelCompletions||e.push(da.DisableJedi),e.push(...zfe(this.getMatplotLibInitializeCode(),"Failed to initialize matplotlib startup code. Matplotlib might be missing."))}return e}getMatplotLibInitializeCode(){let e=[];if(this.kernelSettings.themeMatplotlibPlots){te(`Initialize config for plots for ${W(this.resourceUri||this.uri)}`);let t=da.MatplotLibInit;w(`Initialize matplotlib for ${W(this.resourceUri||this.uri)}`),e.push(...je(t,{trim:!1}));let n=this.appShell.activeColorTheme.kind===wn.ColorThemeKind.Dark;this.kernelSettings.ignoreVscodeTheme||e.push(n?"matplotlib.style.use('dark_background')":`matplotlib.rcParams.update(${Le.MatplotLibDefaultParams})`)}return this.kernelSettings.generateSVGPlots&&(e.push(...je(da.AppendSVGFigureFormat,{trim:!1})),w("Add SVG to matplotlib figure formats")),e}getUserStartupCommands(){let e=this.kernelSettings.runStartupCommands;if(Array.isArray(e)&&(e=e.join(`
`)),e){let t=e.replace(/\\n/g,`
`);return je(t,{trim:!1})}return[]}async executeSilently(e,t,n){if(t.join("").trim().length!==0){if(!e.kernel){w(`Not executing startup as there is no session, code: ${t}`);return}return xn(e.kernel,t.join(`
`),n)}}},IT=class extends bT{get creator(){return"3rdPartyExtension"}constructor(e,t,n,i,o,s,a,l){super(`3rdPartyKernel_${(0,eF.default)()}`,e,t,n,i,s,o,a,"3rdPartyExtension",l)}},ST=class extends bT{constructor(t,n,i,o,s,a,l,c,u){super((0,eF.default)(),n.uri,t,i,o,s,a,c,"jupyterExtension",u);this.notebook=n;this.controller=l}get creator(){return"jupyterExtension"}};function zfe(r,e){return!r||r.length===0||(r=r.map(t=>`    ${t}`),r.unshift("try:"),r.push("except:",`    print('${e}')`)),r}function ET(r){if(r.length>0){let e=r[0].data;if(e&&e.hasOwnProperty("text/plain"))return _s(e["text/plain"]);if(r[0].output_type==="stream"){let t=r[0];return _s(t.text)}}}function tF(r,e){return{get enableExtendedKernelCompletions(){return r.getSettings(e).enableExtendedKernelCompletions},get generateSVGPlots(){return r.getSettings(e).generateSVGPlots},get ignoreVscodeTheme(){return r.getSettings(e).ignoreVscodeTheme},get interruptTimeout(){return r.getSettings(e).jupyterInterruptTimeout},get launchTimeout(){return r.getSettings(e).jupyterLaunchTimeout},get runStartupCommands(){return r.getSettings(e).runStartupCommands},get themeMatplotlibPlots(){return r.getSettings(e).themeMatplotlibPlots}}}var Hs=require("vscode");var Fa=require("vscode");var rF=k(uA()),zr=require("vscode");var yy=new WeakMap;function uu(r){if(r.parent_header&&"msg_id"in r.parent_header)return r.parent_header.msg_id}var ld=class ld{constructor(e,t,n,i,o,s,a,l,c){this.cell=e;this.applicationService=t;this.controller=n;this.context=i;this.formatters=o;this.kernel=s;this.request=a;this._onErrorHandlingIOPubMessage=new zr.EventEmitter;this.onErrorHandlingExecuteRequestIOPubMessage=this._onErrorHandlingIOPubMessage.event;this.outputsAreSpecificToAWidget=[];this.commIdsMappedToParentWidgetModel=new Map;this.disposables=[];this.prompts=new Set;this.ownedCommIds=new Set;this.commIdsMappedToWidgetOutputModels=new Set;this.ownedRequestMsgIds=new Set;this._completed=pe();this.gotIdleIOPubStatus=!1;this.gotShellReply=!1;this.streamsReAttachedToExecutingCell=!1;this._completed.promise.catch(m),this.executeRequestMessageId=c,this.ownedRequestMsgIds.add(c),zr.workspace.onDidChangeNotebookDocument(u=>{if(!Dt(u.notebook))return;let d=u.cellChanges.find(({cell:f})=>f===this.cell);d&&d.outputs?.length===0&&(this.clearLastUsedStreamOutput(),this.cellHasErrorsInOutput=!1)},this,this.disposables),this.execution=l,this.kernel.anyMessage.connect(this.onKernelAnyMessage,this),this.kernel.iopubMessage.connect(this.onKernelIOPubMessage,this),a&&(a.onIOPub=()=>{this.cell.document.isClosed&&!this.completedExecution&&a.dispose()},a.onReply=u=>{if(this.cell.document.isClosed){a.dispose();return}this.handleReply(u)},a.onStdin=this.handleInputRequest.bind(this),a.done.finally(()=>{this.completedExecution=!0,this.endCellExecution()}).catch(m))}static{this.modelIdsOwnedByCells=new WeakMap}get hasErrorOutput(){return this.cellHasErrorsInOutput===!0}static{this.outputsOwnedByWidgetModel=new Map}get completed(){return this._completed.promise}dispose(){this.disposed||(this.disposed=!0,yt(this.cell,"Execution Message Handler disposed"),G(this.disposables),this.prompts.forEach(e=>e.dispose()),this.prompts.clear(),this.request&&this.clearLastUsedStreamOutput(),this.execution=void 0,this.kernel.anyMessage.disconnect(this.onKernelAnyMessage,this),this.kernel.iopubMessage.disconnect(this.onKernelIOPubMessage,this),this._onErrorHandlingIOPubMessage.dispose())}endCellExecution(){this.prompts.forEach(e=>e.dispose()),this.prompts.clear(),this.request&&this.clearLastUsedStreamOutput(),this.execution=void 0,this._completed.resolve()}onKernelAnyMessage(e,{direction:t,msg:n}){if(this.cell.document.isClosed)return this.endCellExecution();let i=require("@jupyterlab/services");if(!this.request&&t==="recv"){let o=uu(n);i.KernelMessage.isStatusMsg(n)&&n.content.execution_state==="idle"&&o===this.executeRequestMessageId&&(this.gotIdleIOPubStatus=!0),n.channel==="shell"&&o===this.executeRequestMessageId&&(this.gotShellReply=!0);let s=i.KernelMessage.isStatusMsg(n)&&n.content.execution_state!=="idle"&&o!==this.executeRequestMessageId;typeof n.parent_header=="object"&&n.parent_header&&"msg_type"in n.parent_header&&n.parent_header.msg_type;let a=o?o!==this.executeRequestMessageId&&!s:!1,l=typeof n.parent_header=="object"&&n.parent_header&&"msg_type"in n.parent_header&&n.parent_header.msg_type==="interrupt_request",c=this.gotIdleIOPubStatus&&this.gotShellReply,u=["kernel_info_reply","execute_input","execute_reply"],d="msg_type"in n&&typeof n.msg_type=="string"&&u.includes(n.msg_type);if(!this.completedExecution&&c)return this.completedExecution=!0,this.endAbnormallyTimeout&&clearTimeout(this.endAbnormallyTimeout),this.endCellExecution();if(!this.completedExecution&&(d||a)){this.endAbnormallyTimeout&&clearTimeout(this.endAbnormallyTimeout),this.endAbnormallyTimeout=setTimeout(()=>(this.completedExecution=!0,this.endAbnormallyTimeout=void 0,this.endCellExecution()),l?1e3:100),this.disposables.push(new zr.Disposable(()=>{clearTimeout(this.endAbnormallyTimeout),this.endAbnormallyTimeout=void 0}));return}}t!=="send"||!this.completedExecution||i.KernelMessage.isCommMsgMsg(n)&&this.ownedCommIds.has(n.content.comm_id)&&this.ownedRequestMsgIds.add(n.header.msg_id)}onKernelIOPubMessage(e,t){if(this.cell.document.isClosed)return this.endCellExecution();if(!(!t.parent_header||!("msg_id"in t.parent_header)||!this.ownedRequestMsgIds.has(t.parent_header.msg_id)||t.channel!=="iopub"))try{this.handleIOPub(t)}catch(n){C("Failed to handle iopub message as a result of some comm message",t,n),!this.completedExecution&&!this.cell.document.isClosed&&this._onErrorHandlingIOPubMessage.fire(n)}}clearLastUsedStreamOutput(){this.lastUsedStreamOutput=void 0}createTemporaryTask(){if(this.cell.document.isClosed)return;let e=yy.get(this.cell.notebook);return e||(this.previousResultsToRestore={...this.cell.executionSummary||{}},this.temporaryExecution=Bo.getOrCreate(this.cell,this.controller),this.temporaryExecution?.start(),this.previousResultsToRestore?.executionOrder&&this.execution&&(this.execution.executionOrder=this.previousResultsToRestore.executionOrder),this.temporaryExecution)}endTemporaryTask(){this.previousResultsToRestore?.executionOrder&&this.execution&&(this.execution.executionOrder=this.previousResultsToRestore.executionOrder),this.previousResultsToRestore&&this.temporaryExecution?(this.previousResultsToRestore.executionOrder&&(this.temporaryExecution.executionOrder=this.previousResultsToRestore.executionOrder),this.temporaryExecution.end(this.previousResultsToRestore.success,this.previousResultsToRestore.timing?.endTime)):this.temporaryExecution?.end(void 0),this.previousResultsToRestore=void 0,this.temporaryExecution=void 0}handleIOPub(e){this.startTime||(this.startTime=new Date().getTime(),this.execution?.start(this.startTime),H(`Kernel acknowledged execution of cell ${this.cell.index} @ ${this.startTime}`));let t=require("@jupyterlab/services");if(t.KernelMessage.isCommOpenMsg(e))this.handleCommOpen(e);else if(t.KernelMessage.isExecuteResultMsg(e))this.handleExecuteResult(e);else if(t.KernelMessage.isExecuteInputMsg(e))this.handleExecuteInput(e);else if(t.KernelMessage.isStatusMsg(e)){let n=e;this.handleStatusMessage(n)}else t.KernelMessage.isStreamMsg(e)?this.handleStreamMessage(e):t.KernelMessage.isDisplayDataMsg(e)?this.handleDisplayData(e):t.KernelMessage.isUpdateDisplayDataMsg(e)?this.handleUpdateDisplayDataMessage(e):t.KernelMessage.isClearOutputMsg(e)?this.handleClearOutput(e):t.KernelMessage.isErrorMsg(e)?this.handleError(e):t.KernelMessage.isCommOpenMsg(e)||(t.KernelMessage.isCommMsgMsg(e)?this.handleCommMsg(e):t.KernelMessage.isCommCloseMsg(e)||J(`Unknown message ${e.header.msg_type} : hasData=${"data"in e.content}`));"execution_count"in e.content&&typeof e.content.execution_count=="number"&&this.execution&&(this.execution.executionOrder=e.content.execution_count)}handleCommOpen(e){this.ownedCommIds.add(e.content.comm_id);let t=e.content.data?.state||void 0;e.content.target_name===Le.DefaultCommTarget&&t&&t._model_module==="@jupyter-widgets/output"&&this.commIdsMappedToWidgetOutputModels.add(e.content.comm_id)}handleCommMsg(e){let t=e.content.data;if(!(!t||t.method!=="update"||typeof t.state!="object")){if("msg_id"in t.state&&typeof t.state.msg_id=="string"){let n="msg_id"in e.parent_header?e.parent_header:void 0;(this.ownedRequestMsgIds.has(e.content.comm_id)||n&&this.ownedRequestMsgIds.has(n.msg_id))&&(t.state.msg_id?this.outputsAreSpecificToAWidget.push({handlingCommId:e.content.comm_id,msgIdsToSwallow:t.state.msg_id}):this.outputsAreSpecificToAWidget.length&&this.outputsAreSpecificToAWidget[this.outputsAreSpecificToAWidget.length-1].handlingCommId===e.content.comm_id&&this.outputsAreSpecificToAWidget.pop())}else if("children"in t.state&&Array.isArray(t.state.children)&&this.ownedCommIds.has(e.content.comm_id)){let n="IPY_MODEL_";t.state.children.forEach(i=>{if(typeof i!="string")return J("Came across a comm update message a child that isn't a string",i);if(!i.startsWith(n))return J(`Came across a comm update message a child that start start with ${n}`,i);let o=i.substring(n.length);this.ownedCommIds.add(o),this.commIdsMappedToParentWidgetModel.set(o,e.content.comm_id)})}}}clearOutputIfNecessary(e){return this.clearOutputOnNextUpdateToOutput?(yt(this.cell,"Clear cell output"),this.clearLastUsedStreamOutput(),e?.clearOutput().then(m,m),this.clearOutputOnNextUpdateToOutput=!1,{previousValueOfClearOutputOnNextUpdateToOutput:!0}):{previousValueOfClearOutputOnNextUpdateToOutput:!1}}addToCellData(e,t){if(e.data&&typeof e.data=="object"&&Xi in e.data){let l=e.data[Xi];if(l&&this.context.extensionMode===zr.ExtensionMode.Test&&(l._vsc_test_cellIndex=this.cell.index),l&&"model_id"in l){let c=ld.modelIdsOwnedByCells.get(this.cell)||new Set;c.add(l.model_id),ld.modelIdsOwnedByCells.set(this.cell,c)}}let n=ba(e),i="transient"in e&&typeof e.transient=="object"&&e.transient&&"display_id"in e.transient&&typeof e.transient?.display_id=="string"?e.transient?.display_id:void 0;if(this.cell.document.isClosed)return;yt(this.cell,"Update output");let o=this.execution||this.createTemporaryTask();this.clearOutputIfNecessary(o),i&&cn.trackOutputByDisplayId(this.cell,i,n,n.items),this.clearLastUsedStreamOutput(),yt(this.cell,"Append output in addToCellData");let s=!0,a=uu(t);(this.outputsAreSpecificToAWidget.length&&this.outputsAreSpecificToAWidget[this.outputsAreSpecificToAWidget.length-1].msgIdsToSwallow===a&&n.items.every(l=>this.canMimeTypeBeRenderedByWidgetManager(l))||this.outputsAreSpecificToAWidget.length&&this.outputsAreSpecificToAWidget[this.outputsAreSpecificToAWidget.length-1].msgIdsToSwallow===a&&this.updateJupyterOutputWidgetWithOutput({commId:this.outputsAreSpecificToAWidget[this.outputsAreSpecificToAWidget.length-1].handlingCommId,outputToAppend:n},o)?.outputAdded)&&(s=!1),s&&o?.appendOutput([n]).then(m,m),this.endTemporaryTask()}canMimeTypeBeRenderedByWidgetManager(e){let t=e.mime;if(t=="application/vnd.code.notebook.stderr"||t=="application/vnd.code.notebook.stdout"||t=="application/vnd.code.notebook.error")return!0;if(t===Xi){let n=JSON.parse(Buffer.from(e.data).toString());return!(typeof n.model_id=="string"&&this.commIdsMappedToWidgetOutputModels.has(n.model_id))}return!t.startsWith("application/vnd")}updateJupyterOutputWidgetWithOutput(e,t){let n=this.outputsAreSpecificToAWidget.length?this.outputsAreSpecificToAWidget[this.outputsAreSpecificToAWidget.length-1].handlingCommId:void 0,i="commId"in e?e.commId:n;if(!i)return;let o="outputToAppend"in e?e.outputToAppend:void 0,s=this.commIdsMappedToParentWidgetModel.get(i)||i,a=this.cell.notebook.getCells().find(b=>ld.modelIdsOwnedByCells.get(b)?.has(s));if(!a){J(`Unable to find a cell that owns the model ${s}`);return}let l=a.outputs.find(b=>b.items.find(D=>{if(D.mime!==Xi)return!1;try{return JSON.parse(Buffer.from(D.data).toString()).model_id===s}catch(_){J("Failed to deserialize the widget data",_)}return!1}));if(!l)return;let c=ld.outputsOwnedByWidgetModel.get(s)||new Set,d=("clearOutput"in e?e.clearOutput:!1)||(this.outputsAreSpecificToAWidget.length?this.outputsAreSpecificToAWidget[this.outputsAreSpecificToAWidget.length-1].clearOutputOnNextUpdateToOutput===!0:!1);this.outputsAreSpecificToAWidget.length&&(this.outputsAreSpecificToAWidget[this.outputsAreSpecificToAWidget.length-1].clearOutputOnNextUpdateToOutput=!1);let f=a.outputs.slice().filter(b=>d?!c.has(b.id):!0),h=f.slice(0,f.indexOf(l)+1),v=f.slice(f.indexOf(l)+1);ld.outputsOwnedByWidgetModel.set(s,c),o&&c.add(o.id);let S=o?h.concat(o).concat(v):h.concat(v);return v.length===0&&o?t?.appendOutput(o,a).then(m,m):d&&!o&&v.length===0||t?.replaceOutput(S,a).then(m,m),{outputAdded:!0}}async handleInputRequest(e){if(e.content&&"prompt"in e.content){let t=new zr.CancellationTokenSource;this.prompts.add(t);let n=e.content.password!==null&&e.content.password;await this.applicationService.showInputBox({prompt:e.content.prompt?e.content.prompt.toString():"",ignoreFocusOut:!0,password:n},t.token).then(i=>{this.kernel.sendInputReply({value:i||"",status:"ok"})},m),this.prompts.delete(t)}}handleExecuteResult(e){this.addToCellData({output_type:"execute_result",data:e.content.data,metadata:e.content.metadata,transient:e.content.transient,execution_count:e.content.execution_count},e)}handleExecuteReply(e){let t=e.content;t.payload&&t.payload.forEach(n=>{n.source&&n.source==="set_next_input"&&"text"in n&&"replace"in n&&this.handleSetNextInput(n),n.data&&n.data.hasOwnProperty("text/plain")&&this.addToCellData({output_type:"stream",text:n.data["text/plain"].toString(),name:"stdout",metadata:{},execution_count:t.execution_count},e)})}handleSetNextInput(e){let t=new zr.WorkspaceEdit;if(e.replace)t.replace(this.cell.document.uri,new zr.Range(this.cell.document.lineAt(0).range.start,this.cell.document.lineAt(this.cell.document.lineCount-1).range.end),e.text);else{yt(this.cell,"Create new cell after current");let n=new zr.NotebookCellData(zr.NotebookCellKind.Code,e.text,this.cell.document.languageId);n.outputs=[],n.metadata={};let i=zr.NotebookEdit.insertCells(this.cell.index+1,[n]);t.set(this.cell.notebook.uri,[i])}zr.workspace.applyEdit(t).then(m,m)}handleExecuteInput(e){e.content.execution_count&&this.execution&&(this.execution.executionOrder=e.content.execution_count)}handleStatusMessage(e){yt(this.cell,`Kernel switching to ${e.content.execution_state}`)}handleStreamMessage(e){if(uu(e)&&this.outputsAreSpecificToAWidget.length&&this.outputsAreSpecificToAWidget[this.outputsAreSpecificToAWidget.length-1].msgIdsToSwallow==uu(e))return;yt(this.cell,`Update streamed output, new output '${e.content.text.substring(0,100)}'`);let t=this.execution||this.createTemporaryTask(),n=e.content.name==="stdout"?zr.NotebookCellOutputItem.stdout("").mime:zr.NotebookCellOutputItem.stderr("").mime;!this.request&&!this.streamsReAttachedToExecutingCell&&!this.lastUsedStreamOutput&&this.cell.outputs.length&&this.cell.outputs[this.cell.outputs.length-1].items.length>=1&&this.cell.outputs[this.cell.outputs.length-1].items.every(o=>o.mime===n)&&(this.lastUsedStreamOutput={output:this.cell.outputs[0],stream:e.content.name}),this.streamsReAttachedToExecutingCell=!0;let{previousValueOfClearOutputOnNextUpdateToOutput:i}=this.clearOutputIfNecessary(t);if(this.lastUsedStreamOutput?.stream===e.content.name){let o=ba({output_type:"stream",name:e.content.name,text:e.content.text});yt(this.cell,`Append output items '${e.content.text.substring(0,100)}`),t?.appendOutputItems(o.items,this.lastUsedStreamOutput.output).then(m,m)}else if(i){let o=_s(e.content.text),s=ba({output_type:"stream",name:e.content.name,text:o});this.lastUsedStreamOutput={output:s,stream:e.content.name},yt(this.cell,`Replace output with '${o.substring(0,100)}'`),t?.replaceOutput([s]).then(m,m)}else{let o=hV(_s(e.content.text)),s=ba({output_type:"stream",name:e.content.name,text:o});this.lastUsedStreamOutput={output:s,stream:e.content.name},yt(this.cell,`Append new output '${o.substring(0,100)}'`),t?.appendOutput([s]).then(m,m)}this.endTemporaryTask()}handleDisplayData(e){let t={output_type:"display_data",data:hk(e.content.data),metadata:e.content.metadata,transient:e.content.transient};this.addToCellData(t,e)}handleClearOutput(e){if(this.outputsAreSpecificToAWidget.length&&this.outputsAreSpecificToAWidget[this.outputsAreSpecificToAWidget.length-1].msgIdsToSwallow===uu(e)){if(e.content.wait)this.outputsAreSpecificToAWidget.length&&(this.outputsAreSpecificToAWidget[this.outputsAreSpecificToAWidget.length-1].clearOutputOnNextUpdateToOutput=!0);else{let t=this.execution||this.createTemporaryTask();this.updateJupyterOutputWidgetWithOutput({clearOutput:!0},t),this.endTemporaryTask()}return}if(e.content.wait)this.clearOutputOnNextUpdateToOutput=!0;else{let t=this.execution||this.createTemporaryTask();this.clearLastUsedStreamOutput(),t?.clearOutput().then(m,m),this.endTemporaryTask()}}handleError(e){let t=e.content.traceback;te(`Traceback for error ${t}`),this.formatters.forEach(i=>{t=i.format(this.cell,t)}),te(`Traceback for error after formatting ${t}`);let n={output_type:"error",ename:e.content.ename,evalue:e.content.evalue,traceback:t};this.addToCellData(n,e),this.cellHasErrorsInOutput=!0}handleReply(e){require("@jupyterlab/services").KernelMessage.isExecuteReplyMsg(e)&&(this.handleExecuteReply(e),"execution_count"in e.content&&typeof e.content.execution_count=="number"&&this.execution&&(this.execution.executionOrder=e.content.execution_count))}handleUpdateDisplayDataMessage(e){let t=e.content.transient.display_id;if(!t){J("Update display data message received, but no display id",e.content);return}let n=cn.getMappedOutput(this.cell.notebook,t);if(!n){J("Update display data message received, but no output found to update",e.content);return}if(n.cell.document.isClosed){J("Update display data message received, but output cell is closed",e.content);return}let i=mk(new zr.NotebookCellOutput(n.outputItems,n.outputContainer.metadata)),o=ba({...i,data:e.content.data,metadata:e.content.metadata});if(n.outputItems.length===0&&o.items.length===0){w("Update display data message received, but no output to update",e.content);return}let s=!1;if(n.outputItems.length===o.items.length){let l=!0;if((0,rF.default)(n.outputContainer.metadata||{},o.metadata||{})||(s=!0,l=!1),l){for(let c=0;c<n.outputItems.length;c++)if(!(0,rF.default)(n.outputItems[c],o.items[c])){l=!1;break}}if(l){w("Update display data message received, but no output to update (data is the same)",e.content);return}}let a=this.execution||this.createTemporaryTask();if(yt(this.cell,`Replace output items in display data ${o.items.length}`),s){let l=n.cell.outputs.map(c=>{let u=mk(c);return u.output_type==="display_data"&&"transient"in u&&u.transient&&typeof u.transient=="object"&&"display_id"in u.transient&&typeof u.transient.display_id=="string"&&u.transient.display_id===t?o:c});a?.replaceOutput(l,n.cell).then(m,m),cn.trackOutputByDisplayId(n.cell,t,o,o.items)}else a?.replaceOutputItems(o.items,n.outputContainer).then(m,m),cn.trackOutputByDisplayId(n.cell,t,n.outputContainer,o.items);this.endTemporaryTask()}};g([Br()],ld.prototype,"handleReply",1);var kC=ld;var wT=class{constructor(e,t){this.controller=e;this.requestListener=t}create(e,t,n,i){return nF.fromCell(e,t,n,this.controller,this.requestListener,i)}},nF=class r{constructor(e,t,n,i,o,s){this.cell=e;this.codeOverride=t;this.kernelConnection=n;this.controller=i;this.requestListener=o;this.resumeExecution=s;this.type="cell";this._result=pe();this.cancelHandled=!1;this.disposables=[];this._preExecuteEmitter=new Fa.EventEmitter;if(Fa.workspace.onDidCloseTextDocument(a=>{if(a===this.cell.document){H(`Disposing request as the cell (${this.cell.index}) was deleted ${W(this.cell.notebook.uri)}`);try{this.request?.dispose()}catch(l){C(`Error during cell execution dispose: ${l}`)}this.started&&!this._completed&&this.completedDueToCancellation()}},this,this.disposables),Uc.setCellState(e,Fa.NotebookCellExecutionState.Idle),this.canExecuteCell())this.execution=Bo.getOrCreate(e,this.controller,!s?.msg_id),Uc.setCellState(e,Fa.NotebookCellExecutionState.Pending);else{let a=Bo.get(e);a&&(a.start(),a.end(void 0))}}get result(){return this._result.promise}get preExecute(){return this._preExecuteEmitter.event}static fromCell(e,t,n,i,o,s){return new r(e,t,n,i,o,s)}async start(e){if(this.session=e,this.resumeExecution?.msg_id)return this.resume(e,this.resumeExecution).then(m);if(this.cancelHandled){yt(this.cell,"Not starting as it was cancelled");return}if(yt(this.cell,"Start execution"),te(`Cell Exec contents ${this.cell.document.getText().substring(0,50)}...`),!this.canExecuteCell()){this.execution?.end(void 0),this.execution=void 0,this._result.resolve();return}if(e.kind==="remoteJupyter"&&e.status==="unknown"&&(!e.kernel||e.kernel.isDisposed||e.isDisposed)){this.execution?.start(),this.execution?.clearOutput().then(m,m),this.completedWithErrors(new Sn);return}if(this.started)return yt(this.cell,"Cell has already been started yet CellExecution.Start invoked again"),C(`Cell has already been started yet CellExecution.Start invoked again ${this.cell.index}`),this.result.then(m);this.started=!0,yy.set(this.cell.notebook,this.execution),Uc.setCellState(this.cell,Fa.NotebookCellExecutionState.Executing),this.execute(this.codeOverride||this.cell.document.getText().replace(/\r\n/g,`
`),e).catch(t=>this.completedWithErrors(t)).catch(m)}async resume(e,t){if(this.cancelHandled){yt(this.cell,"Not resuming as it was cancelled");return}if(!e.kernel)throw new Error("Kernel not available to resume execution");if(yt(this.cell,"Start resuming execution"),te(`Cell Exec (resuming) contents ${this.cell.document.getText().substring(0,50)}...`),!this.canExecuteCell()){this.execution?.end(void 0),this.execution=void 0,this._result.resolve();return}if(this.started)return C(`Cell has already been started yet CellExecution.resume invoked again ${this.cell.index}`),this.result;this.started=!0,yy.set(this.cell.notebook,this.execution),this.execution?.start(t.startTime),t.executionCount&&this.execution&&(this.execution.executionOrder=t.executionCount),Uc.setCellState(this.cell,Fa.NotebookCellExecutionState.Executing),this.cellExecutionHandler=this.requestListener.registerListenerForResumingExecution(this.cell,{kernel:e.kernel,cellExecution:this.execution,msg_id:t.msg_id}),this.cellExecutionHandler.onErrorHandlingExecuteRequestIOPubMessage(n=>{C(`Cell (index = ${this.cell.index}) execution completed with errors (2).`,n),this.completedWithErrors(n.error)},this,this.disposables),this.cellExecutionHandler.completed.finally(()=>this.completedSuccessfully()).catch(m)}async cancel(e=!1){if(!this.cancelHandled){if(this.cancelRequested=!0,this.started&&!e&&this.execution?.started){yt(this.cell,"Cell is already running, waiting for it to finish or kernel to start"),await this.result;return}this.cancelHandled||this._completed||(yt(this.cell,"Execution cancelled"),this.cancelHandled=!0,this.completedDueToCancellation(),this.dispose())}}dispose(){this.disposed||(this.disposed=!0,yt(this.cell,"Execution disposed"),G(this.disposables))}completedWithErrors(e){if(this.cancelHandled)return;!this.disposed&&!this.cancelRequested?J("Cell completed with errors",e):J(`Cell completed with errors (${this.disposed?"disposed":"cancelled"})`),yt(this.cell,"Completed with errors"),yt(this.cell,"Update with error state & output");let t,n;!(e instanceof tt)&&e.message?.includes("Canceled future for execute_request message before replies were done")&&this.session&&h5(this.session)&&(e=new Sn),e instanceof tt?t=rm(Fa.workspace.workspaceFolders||[],e,gt(this.kernelConnection),this.kernelConnection.interpreter?.sysPrefix)?.message:t=e.message||e.name||e.stack,n=Fh(t||""),n&&this.execution?.appendOutput(n).then(m,m),this.endCellTask("failed"),yt(this.cell,"Completed with errors, & resolving"),this._result.resolve("Error")}get isEmptyCodeCell(){return this.cell.document.getText().trim().length===0}completedSuccessfully(e){yt(this.cell,"Completed successfully");let t=this.isEmptyCodeCell?"Idle":"Success",n="success";this.cellExecutionHandler?.hasErrorOutput&&(n="failed",t="Error"),this.endCellTask(n,e),yt(this.cell,`Completed successfully & resolving with status = ${n}`),this._result.resolve(t)}endCellTask(e,t=new Date().getTime()){if(!this._completed){if(this._completed=!0,this.isEmptyCodeCell)this.execution&&(this.execution.executionOrder=void 0),this.execution?.end(void 0);else if(e==="success"||e==="failed")this.endTime=t,this.execution?.end(e==="success",this.endTime);else{try{this.request?.dispose()}catch{}this.execution?.end(void 0)}yy.get(this.cell.notebook)===this.execution&&yy.set(this.cell.notebook,void 0),Uc.setCellState(this.cell,Fa.NotebookCellExecutionState.Idle),this.execution=void 0}}completedDueToCancellation(){yt(this.cell,"Completed due to cancellation"),this.endCellTask("cancelled"),yt(this.cell,"Cell cancelled & resolving"),this._result.resolve("Idle")}canExecuteCell(){return this.cell.document.languageId==="raw"?!1:!this.cell.document.isClosed}async execute(e,t){if(!t.kernel)throw new Error("No kernel available to execute code");if(yt(this.cell,"Send code for execution"),e.trim().length===0||this.cell.document.isClosed)return e.trim().length===0&&(this.execution?.start(this.resumeExecution?.startTime),this.execution?.clearOutput()?.then(m,m)),yt(this.cell,"Empty cell execution"),this.completedSuccessfully();let n={cellId:this.cell.document.uri.toString(),...this.cell.metadata?.custom?.metadata||{}},i=t.kernel;try{this._preExecuteEmitter.fire(this.cell),w(`Cell Index:${this.cell.index} sent to kernel`),this.request=i.requestExecute({code:e,silent:!1,stop_on_error:!1,allow_stdin:!0,store_history:!0},!1,n),this.request.done.then(m,m)}catch(o){return C(`Cell execution failed without request, for cell Index ${this.cell.index}`,o),this.completedWithErrors(o)}this.cellExecutionHandler=this.requestListener.registerListenerForExecution(this.cell,{kernel:i,cellExecution:this.execution,request:this.request}),this.cellExecutionHandler.onErrorHandlingExecuteRequestIOPubMessage(o=>{C(`Cell (index = ${this.cell.index}) execution completed with errors (2).`,o),this.completedWithErrors(o.error)},this,this.disposables);try{yt(this.cell,"Wait for jupyter execution"),await this.request.done;let o=new Date().getTime();yt(this.cell,"Jupyter execution completed"),this.completedSuccessfully(o),yt(this.cell,"Executed successfully in executeCell")}catch(o){if(this.cancelHandled)return;!this.disposed&&!this.cancelRequested&&C("Error in waiting for cell to complete",o),yt(this.cell,"Some other execution error"),o&&o instanceof Error&&br(o,!0)?this.completedWithErrors({message:o.message}):this.completedWithErrors(o)}}};var g5=require("vscode");var kT=class{constructor(e,t,n,i,o){this.appShell=e;this.controller=t;this.context=n;this.formatters=i;this.notebook=o;this.disposables=[];this.messageHandlers=new WeakMap;g5.workspace.onDidChangeNotebookDocument(s=>{s.notebook===this.notebook&&s.contentChanges.forEach(a=>a.removedCells.forEach(l=>this.messageHandlers.get(l)?.dispose()))},this,this.disposables)}dispose(){G(this.disposables),this.notebook&&this.notebook.getCells().forEach(e=>this.messageHandlers.get(e)?.dispose())}registerListenerForExecution(e,t){this.messageHandlers.get(e)?.dispose();let n=new kC(e,this.appShell,this.controller,this.context,this.formatters,t.kernel,t.request,t.cellExecution,t.request.msg.header.msg_id);return this.messageHandlers.set(e,n),n}registerListenerForResumingExecution(e,t){this.messageHandlers.get(e)?.dispose();let n=new kC(e,this.appShell,this.controller,this.context,this.formatters,t.kernel,void 0,t.cellExecution,t.msg_id);return this.messageHandlers.set(e,n),n}};var iF=require("vscode");var PT=require("vscode");function pu(r,e){w(`Execution Id:${r}. ${e}.`)}var v5=new Map,DT=class r{constructor(e,t){this.code=e;this.extensionId=t;this.type="code";this._onDidEmitOutput=new PT.EventEmitter;this.onDidEmitOutput=this._onDidEmitOutput.event;this._onRequestSent=new PT.EventEmitter;this.onRequestSent=this._onRequestSent.event;this._onRequestAcknowledge=new PT.EventEmitter;this.onRequestAcknowledged=this._onRequestAcknowledge.event;this._done=pe();this.cancelHandled=!1;this.disposables=[];let n=v5.get(t)||0;n+=1,v5.set(t,n),this.executionId=`${t}-${n}`,this.disposables.push(this._onDidEmitOutput)}get done(){return this._done.promise}get result(){return this._done.promise.catch(m).then(()=>"Success")}static fromCode(e,t){return new r(e,t)}async start(e){if(this.session=e,this.cancelHandled){pu(this.executionId,"Not starting as it was cancelled");return}if(pu(this.executionId,"Start Code execution"),te(`Code Exec contents ${this.code.substring(0,50)}...`),!e.kernel||e.kernel.isDisposed||e.isDisposed){this._done.reject(new Sn);return}if(this.started)return pu(this.executionId,"Code has already been started yet CodeExecution.Start invoked again"),C(`Code has already been started yet CodeExecution.Start invoked again ${this.executionId}`),this.done;await this.execute(this.code.replace(/\r\n/g,`
`),e).catch(m)}async cancel(){if(!(this.cancelHandled||this._completed)){if(this.cancelRequested=!0,this.started){pu(this.executionId,"Code is already running, interrupting and waiting for it to finish or kernel to start");let e=this.session?.kernel;e&&await e.interrupt().catch(m),this.request?.dispose(),await this.request?.done.catch(m)}this.cancelHandled||this._completed||(pu(this.executionId,"Execution cancelled"),this.cancelHandled=!0,this._done.resolve(),this.dispose())}}dispose(){this.disposed||(this.disposed=!0,this._completed||pu(this.executionId,"Execution disposed"),G(this.disposables))}async execute(e,t){if(!t.kernel){let i=new Error("No kernel available to execute code");throw this._done.resolve(),i}pu(this.executionId,"Send code for execution");let n=t.kernel;try{this.started=!0,this._onRequestSent.fire(),pu(this.executionId,"Execution Request Sent to Kernel"),this.request=_V(n,e,()=>this._onRequestAcknowledge.fire(),i=>{i.length&&this._onDidEmitOutput.fire(i)}),this.request.done.then(m,m)}catch(i){C(`Code execution failed without request, for exec ${this.executionId}`,i),this._completed=!0,this._done.resolve();return}try{await this.request.done.catch(m),this._completed=!0,this._done.resolve(),pu(this.executionId,"Executed successfully")}catch(i){if(this._completed=!0,this.cancelHandled)return;!this.disposed&&!this.cancelRequested?C(`Error in waiting for code ${this.executionId} to complete`,i):C(`Some other execution error for exec ${this.executionId}`,i),this._done.resolve()}}};var TT=class{constructor(e,t,n,i){this.session=e;this.executionFactory=t;this.metadata=n;this.resourceUri=i;this.queueOfItemsToExecute=[];this.cancelledOrCompletedWithErrors=!1;this.startedRunningCells=!1;this._onPreExecute=new iF.EventEmitter;this._onPostExecute=new iF.EventEmitter;this.disposables=[]}get queueOfCellsToExecute(){return this.queueOfItemsToExecute.filter(e=>e.type==="cell").map(e=>e)}get isEmpty(){return this.queueOfItemsToExecute.length===0}get failed(){return this.cancelledOrCompletedWithErrors}get queue(){return this.queueOfCellsToExecute.map(e=>e.cell)}dispose(){this.disposables.forEach(e=>e.dispose()),this.lastCellExecution?.dispose()}get onPreExecute(){return this._onPreExecute.event}get onPostExecute(){return this._onPostExecute.event}queueCell(e,t){this.enqueue({cell:e,codeOverride:t})}queueCode(e,t,n){return this.enqueue({code:e,extensionId:t,token:n})}enqueue(e){let t;if("cell"in e){let{cell:n,codeOverride:i}=e,o=this.queueOfCellsToExecute.find(a=>a.cell===n);if(o)return yt(n,"Use existing cell execution"),o;let s=this.executionFactory.create(n,i,this.metadata);t=s,this.disposables.push(s),s.preExecute(a=>this._onPreExecute.fire(a),this,this.disposables),this.queueOfItemsToExecute.push(s),yt(n,"User queued cell for execution")}else{let{code:n,extensionId:i,token:o}=e,s=DT.fromCode(n,i);t=s,this.disposables.push(s),this.queueOfItemsToExecute.push(s),this.disposables.push(pm(o.onCancellationRequested)(()=>s.cancel()))}return this.startExecutingCells(),t}resumeCell(e,t){if(this.queueOfCellsToExecute.find(o=>o.cell===e)){yt(e,"Use existing cell execution");return}let i=this.executionFactory.create(e,"",this.metadata,t);this.disposables.push(i),this.queueOfItemsToExecute.push(i),yt(e,"User queued cell for execution"),this.startExecutingCells()}async cancel(e){this.cancelledOrCompletedWithErrors=!0,w("Cancel pending cells"),await Promise.all(this.queueOfItemsToExecute.map(t=>t.cancel(e))),this.lastCellExecution?.dispose(),this.queueOfItemsToExecute.splice(0,this.queueOfItemsToExecute.length)}async cancelQueuedCells(){this.cancelledOrCompletedWithErrors=!0,w("Cancel pending cells"),await Promise.all(this.queueOfCellsToExecute.map(e=>e.cancel())),this.lastCellExecution?.type==="cell"&&this.lastCellExecution?.dispose(),this.queueOfItemsToExecute.push(...this.queueOfItemsToExecute.filter(e=>e.type==="code"))}async waitForCompletion(e){let t=Array.isArray(e)&&e.length>0?this.queueOfCellsToExecute.filter(n=>e.includes(n.cell)):this.queueOfItemsToExecute;return Promise.all(t.map(n=>n.result))}startExecutingCells(){this.startedRunningCells||this.start().catch(m),this.startedRunningCells=!0}async start(){try{await this.executeQueuedCells()}catch(e){C("Failed to execute cells in CellExecutionQueue",e),this.cancelledOrCompletedWithErrors=!0,await this.cancelQueuedCells()}}async executeQueuedCells(){let e,t=await this.session;for(this.queueOfItemsToExecute.forEach(n=>n.type==="cell"&&yt(n.cell,"Ready to execute"));this.queueOfItemsToExecute.length;){this.lastCellExecution?.dispose();let n=this.queueOfItemsToExecute[0];this.lastCellExecution=n,n.type==="cell"&&yt(n.cell,"Before Execute individual cell");let i;try{n.type==="cell"&&n.cell.notebook.isClosed?e=!0:n.type==="cell"&&this.cancelledOrCompletedWithErrors||(await n.start(t),i=await n.result)}finally{n.type==="cell"&&yt(n.cell,`After Execute individual cell ${i}`);let o=this.queueOfItemsToExecute.indexOf(n);o>=0&&this.queueOfItemsToExecute.splice(o,1),n.type==="cell"&&this._onPostExecute.fire(n.cell)}if(e||this.cancelledOrCompletedWithErrors||i==="Error"){this.cancelledOrCompletedWithErrors=!0;let o=[];if(this.cancelledOrCompletedWithErrors&&o.push("cancellation or failure in execution"),e&&o.push("Notebook being closed"),typeof i=="number"&&i==="Error"&&o.push("failure in cell execution"),o.length===0&&o.push("an unknown reason"),this.queueOfCellsToExecute.length>0&&this.queueOfCellsToExecute.length===this.queueOfItemsToExecute.length){J(`Cancel all remaining cells due to ${o.join(" or ")}`),await this.cancel();break}else if(this.queueOfCellsToExecute.length>0&&this.queueOfCellsToExecute.length!==this.queueOfItemsToExecute.length)J(`Cancel all remaining cells due to ${o.join(" or ")}`),await this.cancelQueuedCells();else if(e){J(`Cancel all remaining cells due to ${o.join(" or ")}`),await this.cancel();break}}if(t.status==="dead"||t.status==="terminating"){this.cancelledOrCompletedWithErrors=!0,J("Cancel all remaining cells due to dead kernel"),await this.cancel();break}}}};var C5=require("vscode");function sc(r){if(typeof r!="string")throw new TypeError(`Expected a \`string\`, got \`${typeof r}\``);var e=b5();let t=e;return t.default&&(t=t.default),r.replace(t(),"")}var tf=require("vscode");var Qfe=new Map([["julia",ehe],["python",Xfe],["r",the]]);function I5(r,e){let t=Qfe.get(e.toLowerCase());return t?t(r):r}var Yfe=["Docstring:","Options:","Parameters","Returns","See Also","Notes","Examples","Usage:","Subclasses:"];function Xfe(r){let e=je(r,{trim:!1,removeEmptyEntries:!1}),t=-1,n=!1,i=!1,o=[],s=new Set,a=!1,l="",c=!1,u=!1;if(e.map((f,h)=>{if(h===0){let S=["Signature:","Init signature:"].find(b=>f.toLowerCase().startsWith(b.toLowerCase()));if(S){n=!0,f=f.substring(S.length).trim(),o.push("```python"),f.trim().length&&(o.push(f),c=!0);return}}if(f.startsWith("File:")&&h===e.length-1||f.startsWith("Type:")&&h===0)return;if(!a&&f.toLowerCase().startsWith("String form:".toLowerCase())){i=!0;return}let v=Yfe.find(S=>f.trim().toLowerCase().startsWith(S.toLowerCase()));if(v&&!s.has(v)){l=v.toLowerCase(),s.add(v),a=!0,t=h,i=!1,n&&o.push("```","----------"),n=!1,u=!1,l!=="docstring:"&&o.push(`## ${v}`);let S=f.includes(":")?f.split(":")[1].replace("<no docstring>","").trim():"";S.length&&(o.push(S),c=!0);return}if(!i){if(t+1===h&&f.replace(/-/g,"").replace(/:/g,"").replace("<no docstring>","").trim().length===0){t=h,i=!1,n=!1,u=!1;return}if(l==="parameters"||l==="see also"){f.trim().length&&f.includes(":")&&f.substring(0,1)===f.trim().substring(0,1)?o.push(`* ${f}`):o.push(f),c=c||f.trim().length>0;return}if(l==="options:"){f.startsWith("-")&&f.trim().length&&f.includes(":")&&f.substring(0,1)===f.trim().substring(0,1)?o.push(`* ${f}`):o.push(f),c=c||f.trim().length>0;return}if(l==="returns"){f.trim().length&&f.substring(0,1)===f.trim().substring(0,1)?o.push(`* ${f}`):o.push(f),c=c||f.trim().length>0;return}if(l==="examples"&&!n&&(t+1===h||t+2===h))return i=!1,n=!0,c=c||f.trim().length>0,o.push("```python",f);if(!n&&f.startsWith("class ")&&f.trim().endsWith("):")){n=!0,u=!0,o.push("```python",f),c=c||f.trim().length>0;return}if(n&&u&&f.trim().length>0&&f.substring(0,1)!==" "&&f.substring(0,1)!=="	")return n=!1,u=!1,o.push(f,"```");c=c||f.trim().length>0,o.push(f)}}),!c)return"";let d=o.join(`  
`);return n?new tf.MarkdownString(d+"  \n```"):new tf.MarkdownString(d)}var Zfe=[{section:"Examples:",header:"Examples",nextLine://g},{section:"Usage note",header:"Usage note",nextLine://g},{section:"Note:",header:"\u2502 Note",nextLine:"\u2502"},{section:"Note:",header:"\u2502 Note",nextLine:String.fromCharCode(9474)}];function ehe(r){let e=je(r,{trim:!1,removeEmptyEntries:!1}),t=!1,n=[],i=new Set,o="",s=!1,a=!1;e.every(c=>c.trim().length===0||c.startsWith("  "))&&e.forEach((c,u)=>e[u]=c.trim().length?c.substring(2):c),e.map((c,u)=>{if(c.trim()==="\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500")return a=!1,n.push(c);if(!a)return o="signature",t=!0,a=!0,c.trim().length?(s=!0,n.push("```julia",c)):n.push("```julia");o==="signature"&&c.trim()===""&&(o="",t=!1,s=!1,n.push("```"));let d=Zfe.find(f=>c.trim().toLowerCase().startsWith(f.header.toLowerCase()));if(d&&(typeof d.nextLine=="string"?e[u+1].trim()===d.nextLine.trim():e[u+1].trim().replace(d.nextLine,"").length===0)){e[u+1]="",o=d.section.toLowerCase(),i.add(d.header),t&&n.push("```"),t=!1,n.push(`## ${d.section}`),o==="note:"&&!e.slice(u+1).every(f=>f.trim().length===0||f.trim().startsWith("|")||f.trim().startsWith(String.fromCharCode(9474)))&&(o="");return}if(o==="examples:"&&!t)return t=!0,c.trim().length?(s=!0,n.push("```julia",c)):n.push("```julia");if(o==="note:"){n.push(c.trim()?c.trim().substring(1):"");return}t&&!s&&c.trim().length===0||n.push(c)});let l=n.join(`  
`);return t?new tf.MarkdownString(l+"  \n```"):new tf.MarkdownString(l)}function the(r){let e=je(r,{trim:!1,removeEmptyEntries:!1}),t=[];e.forEach((a,l)=>e[l]=a.indexOf("     ")===0?a.substring(5):a);let n="",i=!1,o=!1;e.map(a=>{let l=a.replace(/_/g,"").trim();if(a.startsWith("_")&&a.includes(String.fromCharCode(8))&&a.split("_").length===a.split(String.fromCharCode(8)).length&&l){i&&t.push("```"),i=!1,n=l.trim().toLowerCase(),t.push(`## ${l}`);return}if((n==="examples"||n==="examples:"||n==="usage"||n==="usage:")&&!i)return i=!0,a.trim().length?(o=!0,t.push("```r",a)):t.push("```r");if(n==="note:"){t.push(a.trim()?a.trim().substring(1):"");return}i&&!o&&a.trim().length===0||t.push(a)});let s=t.join(`  
`);return i?new tf.MarkdownString(s+"  \n```"):new tf.MarkdownString(s)}var rhe=5,nhe=3,E5=Qt.IntellisenseTimeout,oF=new Set,S5=new Map,_T=class extends Error{constructor(){super("Request timed out")}};async function RT(r,e,t,n,i,o,s,a){if(!r.range||!t.session?.kernel||oF.has(n))return r;let l=new $e,c={duration:0,pendingRequests:0,requestDuration:0},u={kernelId:n,kernelConnectionType:t.kernelConnectionMetadata.kind,kernelLanguage:oo(t.kernelConnectionMetadata),monacoLanguage:Ts(oo(t.kernelConnectionMetadata)||""),cancelled:!1,completed:!1,completedWithData:!1,kernelStatusBeforeRequest:t.status,requestSent:!1};if(t.status!=="idle")return R("DATASCIENCE.JUPYTER_KERNEL_CODE_COMPLETION_RESOLVE",c,u),r;u.requestSent=!0;let d=ahe(r,o,s),f=she(d,t.session.kernel,e,u,c,a);try{let h=await OE(E5,new _T,Gt(e,f));if(u.kernelStatusAfterRequest=t.status,u.cancelled=e.isCancellationRequested,u.completed=!e.isCancellationRequested,c.duration=l.elapsedTime,!u.cancelled&&h?.status==="ok"&&h?.found){let v=ihe(h);r.documentation=I5(v,i),u.completedWithData=v.length>0}}catch(h){u.requestTimedout=h instanceof _T,ohe(t,i)}return R("DATASCIENCE.JUPYTER_KERNEL_CODE_COMPLETION_RESOLVE",c,u),r}function ihe(r){return!r||r.status!=="ok"||!r.found?";":!r.data||typeof r.data!="object"?"":"text/plain"in r.data?sc(r.data["text/plain"]):""}function ohe(r,e){let t=r.kernelConnectionMetadata.id;if(oF.has(t))return;let n=S5.get(t)||0;if(n+=1,S5.set(t,n),n>=rhe){J(`Failed to inspect code in kernel ${gt(r.kernelConnectionMetadata)} ${n} times.}`),R("DATASCIENCE.JUPYTER_KERNEL_CODE_COMPLETION_CANNOT_RESOLVE",void 0,{kernelId:t,kernelConnectionType:r.kernelConnectionMetadata.kind,kernelLanguage:e}),oF.add(t);return}}async function she(r,e,t,n,i,o){if(i.pendingRequests=x5(e),sF(e)&&(H(`Too many pending requests ${x5(e)} for kernel ${e.id}, waiting for it to be ready.`),await Gt(t,uhe(e,t))),t.isCancellationRequested)return Promise.resolve({data:{},found:!1,status:"ok",metadata:{}});let s=che(e),a=new $e,l=je(r.code).reverse()[0].slice(-50);w(`Inspecting code ${l}`);let c=e.requestInspect(r).finally(()=>{n.completed=!0,i.requestDuration=a.elapsedTime,n.kernelStatusAfterRequest=e.status,s.dispose()});return lhe(c,a,n,i,o,l),c.then(({content:u})=>(t.isCancellationRequested?w(`Inspected code ${l} in ${a.elapsedTime}ms (but cancelled)`):w(`Inspected code ${l} in ${a.elapsedTime}ms`),u))}function ahe(r,e,t){let n=e.getText(),i=(typeof r.insertText=="string"?r.insertText:r.insertText?.value)||(typeof r.label=="string"?r.label:r.label.label)||"",o=n.substring(0,t.character)+i,s=t.character+i.length;return{code:o,cursor_pos:s,detail_level:0}}function lhe(r,e,t,n,i,o){let s=E5*10,a=setTimeout(()=>{t.requestTimedout=!0,n.requestDuration=e.elapsedTime,R("DATASCIENCE.JUPYTER_KERNEL_CODE_COMPLETION_RESOLVE",n,t),J(`Timeout (after ${s}ms) waiting to inspect code '${o}'`)},s),l=new C5.Disposable(()=>clearTimeout(a));i.add(l),r.finally(()=>{!t.cancelled||!t.requestTimedout||(l.dispose(),t.completed=!0,n.requestDuration=e.elapsedTime,R("DATASCIENCE.JUPYTER_KERNEL_CODE_COMPLETION_RESOLVE",n,t))})}var La=new WeakMap;function sF(r){return La.has(r)||La.set(r,{count:0}),(La.get(r)?.count||0)>=nhe}function x5(r){return La.has(r)||La.set(r,{count:0}),La.get(r)?.count||0}function che(r){let e=La.get(r)||{count:0};return La.set(r,e),e.count+=1,{dispose:()=>{e.count-=1}}}async function uhe(r,e){let t=[];await Gt(e,new Promise(n=>{let i=()=>{sF(r)||(n(),G(t))},o=setInterval(()=>{sF(r)||(n(),G(t))},50);pm(e.onCancellationRequested)(()=>{n(),r.statusChanged.disconnect(i)},void 0,t),r.statusChanged.connect(i),t.push({dispose:()=>{clearInterval(o),r.statusChanged.disconnect(i)}})}))}var NT=class{constructor(e,t,n,i,o){this.kernel=e;this.notebook=o;this.disposables=[];this._visibleExecutionCount=0;this._onPreExecute=new Hs.EventEmitter;this.onPreExecute=this._onPreExecute.event;this._onPostExecute=new Hs.EventEmitter;this.onPostExecute=this._onPostExecute.event;this.documentExecutions=new WeakMap;let s=new kT(t,e.controller,n,i,o);this.disposables.push(s),this.executionFactory=new wT(e.controller,s),Hs.notebooks.onDidChangeNotebookCellExecutionState(a=>{a.cell.notebook===e.notebook&&a.state===Hs.NotebookCellExecutionState.Idle&&a.cell.executionSummary?.executionOrder&&(this._visibleExecutionCount=Math.max(this._visibleExecutionCount,a.cell.executionSummary.executionOrder))}),e.onRestarted(()=>this._visibleExecutionCount=0,this,this.disposables),e.onStarted(()=>this._visibleExecutionCount=0,this,this.disposables),e.addHook("willInterrupt",this.onWillInterrupt,this,this.disposables),e.addHook("willCancel",this.onWillCancel,this,this.disposables),e.addHook("willRestart",a=>this.onWillRestart(a),this,this.disposables),this.disposables.push(this._onPreExecute)}get executionCount(){return this._visibleExecutionCount}get pendingCells(){return this.documentExecutions.get(this.notebook)?.queue||[]}async resumeCellExecution(e,t){if(yt(e,`NotebookKernelExecution.resumeCellExecution (start), ${W(e.notebook.uri)}`),e.kind==Hs.NotebookCellKind.Markup)return"Success";await is(this.kernel.resourceUri,this.kernel.kernelConnectionMetadata),Rt(this.kernel.resourceUri,"DATASCIENCE.RESUME_EXECUTE_CELL");let n=this.kernel.start(new er(!1)),i=this.getOrCreateCellExecutionQueue(e.notebook,n);i.resumeCell(e,t);let o=await i.waitForCompletion([e]);return yt(e,`NotebookKernelExecution.resumeCellExecution (completed), ${W(e.notebook.uri)}`),w(`Cell ${e.index} executed with state ${o[0]}`),o[0]}async executeCell(e,t){yt(e,`NotebookKernelExecution.executeCell (1), ${W(e.notebook.uri)}`);let n=this.kernel.session?.kernel&&La.get(this.kernel.session.kernel)?.count||0,i=new $e;if(e.kind==Hs.NotebookCellKind.Markup)return"Success";yt(e,`NotebookKernelExecution.executeCell, ${W(e.notebook.uri)}`),await is(this.kernel.resourceUri,this.kernel.kernelConnectionMetadata);let o=this.kernel.start(new er(!1));await this.kernel.restarting,yt(e,`NotebookKernelExecution.executeCell (2), ${W(e.notebook.uri)}`);let s=this.getOrCreateCellExecutionQueue(e.notebook,o);s.queueCell(e,t);let a=await s.waitForCompletion([e]);yt(e,`NotebookKernelExecution.executeCell completed (3), ${W(e.notebook.uri)}`),w(`Cell ${e.index} executed with state ${a[0]}`);let l=this.kernel.session?.kernel&&La.get(this.kernel.session.kernel)?.count||0;return Rt(this.kernel.resourceUri,"DATASCIENCE.EXECUTE_CELL",{duration:i.elapsedTime,pendingInspectRequestsAfter:l,pendingInspectRequestsBefore:n}),a[0]}async executeCode(e,t,n){let i=new $e;await is(this.kernel.resourceUri,this.kernel.kernelConnectionMetadata);let o=this.kernel.start(new er(!1));await this.kernel.restarting;let a=this.getOrCreateCellExecutionQueue(this.notebook,o).queueCode(e,t,n);return w(`Queue code ${a.executionId} from ${t} after ${i.elapsedTime}ms:
${e}`),a.result.finally(()=>{!n.isCancellationRequested&&H(`Execution of code ${a.executionId} completed in ${i.elapsedTime}ms`),Rt(this.kernel.resourceUri,"DATASCIENCE.EXECUTE_CODE",{duration:i.elapsedTime},{extensionId:t})}).catch(m),a}executeHidden(e){return this.kernel.start().then(n=>n.kernel?xn(n.kernel,e):Promise.reject(new Sn))}async onWillInterrupt(){let e=this.documentExecutions.get(this.notebook);!e&&this.kernel.kernelConnectionMetadata.kind!=="connectToLiveRemoteKernel"||(H("Interrupt kernel execution"),e&&(await e.cancel(),await e.waitForCompletion()))}async onWillCancel(){let e=this.documentExecutions.get(this.notebook);e&&await e.cancel(!0)}async onWillRestart(e){let t=this.documentExecutions.get(this.notebook),n=e?await e.catch(()=>{}):void 0,i=t?t.cancel(!0).then(()=>t.waitForCompletion()):Promise.resolve();n||(H("No kernel session to interrupt"),await i)}getOrCreateCellExecutionQueue(e,t){let n=this.documentExecutions.get(e);if(n&&!n.isEmpty&&!n.failed)return n;let i=new TT(t,this.executionFactory,this.kernel.kernelConnectionMetadata,this.kernel.resourceUri);return this.disposables.push(i),Hs.workspace.onDidCloseNotebookDocument(async o=>{o===e&&(w(`Cancel executions after closing notebook ${W(o.uri)}`),(!i.failed||!i.isEmpty)&&await i.cancel(!0))},this,this.disposables),i.onPreExecute(o=>this._onPreExecute.fire(o),this,this.disposables),i.onPostExecute(o=>this._onPostExecute.fire(o),this,this.disposables),this.documentExecutions.set(e,i),i}};var by=class extends hT{constructor(t,n,i,o,s,a,l,c,u,d,f){super(t,n,a);this.sessionCreator=i;this.configService=o;this.appShell=s;this.context=l;this.formatters=u;this.startupCodeProviders=d;this.workspaceStorage=f;n.push(c.onDidRemove(this.handleServerRemoval.bind(this)))}getOrCreate(t,n){let i=this.getInternal(t);if(i&&i.options.metadata.id===n.metadata.id)return i.kernel;this.disposeOldKernel(t);let o=t.notebookType===wt?n.resourceUri:t.uri,s=tF(this.configService,o),a=t.uri.path.endsWith(".interactive")||n.resourceUri?.path.endsWith(".interactive")?wt:Ct,l=new ST(o,t,n.metadata,this.sessionCreator,s,this.appShell,n.controller,this.startupCodeProviders.getProviders(a),this.workspaceStorage);return l.onRestarted(()=>this._onDidRestartKernel.fire(l),this,this.disposables),l.onDisposed(()=>{this._onDidDisposeKernel.fire(l)},this,this.disposables),l.onStarted(()=>this._onDidStartKernel.fire(l),this,this.disposables),l.onStatusChanged(c=>this._onKernelStatusChanged.fire({kernel:l,status:c}),this,this.disposables),this.executions.set(l,new NT(l,this.appShell,this.context,this.formatters,t)),this.asyncDisposables.push(l),this.storeKernel(t,n,l),this.deleteMappingIfKernelIsDisposed(l),l}};by=g([(0,jr.injectable)(),p(0,(0,jr.inject)(yi)),p(1,(0,jr.inject)(O)),p(2,(0,jr.inject)(yx)),p(3,(0,jr.inject)(se)),p(4,(0,jr.inject)(ue)),p(5,(0,jr.inject)(qe)),p(6,(0,jr.inject)(dt)),p(7,(0,jr.inject)(cr)),p(8,(0,jr.multiInject)(tg)),p(9,(0,jr.inject)(xa)),p(10,(0,jr.inject)(He)),p(10,(0,jr.named)(vi))],by);var Iy=class extends gT{constructor(t,n,i,o,s,a,l,c){super(t,n,a);this.sessionCreator=i;this.configService=o;this.appShell=s;this.startupCodeProviders=l;this.workspaceStorage=c}getOrCreate(t,n){let i=this.getInternal(t);if(i&&i.options.metadata.id===n.metadata.id)return i.kernel;this.disposeOldKernel(t);let o=t,s=tF(this.configService,o),a=o.path.endsWith(".interactive")?wt:Ct,l=new IT(t,o,n.metadata,this.sessionCreator,this.appShell,s,this.startupCodeProviders.getProviders(a),this.workspaceStorage);return l.onRestarted(()=>this._onDidRestartKernel.fire(l),this,this.disposables),l.onDisposed(()=>{this._onDidDisposeKernel.fire(l)},this,this.disposables),l.onStarted(()=>this._onDidStartKernel.fire(l),this,this.disposables),l.onStatusChanged(c=>this._onKernelStatusChanged.fire({kernel:l,status:c}),this,this.disposables),this.asyncDisposables.push(l),this.storeKernel(t,n,l),this.deleteMappingIfKernelIsDisposed(t,l),l}};Iy=g([(0,jr.injectable)(),p(0,(0,jr.inject)(yi)),p(1,(0,jr.inject)(O)),p(2,(0,jr.inject)(yx)),p(3,(0,jr.inject)(se)),p(4,(0,jr.inject)(ue)),p(5,(0,jr.inject)(qe)),p(6,(0,jr.inject)(xa)),p(7,(0,jr.inject)(He)),p(7,(0,jr.named)(vi))],Iy);var rf=k(A()),du=require("vscode");var Sy=class{constructor(e,t,n,i){this.extensionChecker=t;this.interpreterService=n;this.kernelFinder=i;this.refreshedOnceBefore=!1;this.disposables=[];e.push(this)}dispose(){G(this.disposables)}activate(){this.extensionChecker.isPythonExtensionInstalled?this.startRefreshWithPython():(this.startRefreshWithoutPython(),this.extensionChecker.onPythonExtensionInstallationStatusChanged(()=>{this.extensionChecker.isPythonExtensionInstalled&&this.startRefreshWithPython()},this,this.disposables))}startRefreshWithoutPython(){if(this.refreshedOnceBefore)return;this.refreshedOnceBefore=!0;let e=()=>{let t=Date.now().toString();H(`Start refreshing Kernel Picker (${t})`);let n=du.notebooks.createNotebookControllerDetectionTask(Ct),i=du.notebooks.createNotebookControllerDetectionTask(wt);this.disposables.push(n),this.disposables.push(i),this.kernelFinder.onDidChangeStatus(()=>{this.kernelFinder.status==="idle"&&(H(`End refreshing Kernel Picker (${t})`),n.dispose(),i.dispose())},this,this.disposables)};if(this.kernelFinder.status==="discovering")return e();this.kernelFinder.onDidChangeStatus(()=>{this.kernelFinder.status==="discovering"&&e()},this,this.disposables)}startRefreshWithPython(){if(this.refreshedOnceBefore)return;this.refreshedOnceBefore=!0;let e=!1;du.window.onDidChangeActiveNotebookEditor(o=>{!e&&o&&Dt(o.notebook)&&(e=!0,H("Start refreshing Interpreter Kernel Picker"),this.interpreterService.refreshInterpreters().catch(m))},this,this.disposables),du.workspace.onDidOpenNotebookDocument(o=>{!e&&Dt(o)&&(e=!0,H("Start refreshing Interpreter Kernel Picker"),this.interpreterService.refreshInterpreters().catch(m))},this,this.disposables);let t,n="",i=()=>(t&&!t.isDisposed||(n=Date.now().toString(),H(`Start refreshing Kernel Picker (${n})`),t=new qo(du.notebooks.createNotebookControllerDetectionTask(Ct),du.notebooks.createNotebookControllerDetectionTask(wt)),this.disposables.push(t)),t);this.kernelFinder.status==="idle"?(H(`End refreshing Kernel Picker (${n})`),t?.dispose()):i(),this.kernelFinder.onDidChangeStatus(()=>{this.kernelFinder.status==="idle"?(H(`End refreshing Kernel Picker (${n})`),t?.dispose()):i()},this,this.disposables)}};Sy=g([(0,rf.injectable)(),p(0,(0,rf.inject)(O)),p(1,(0,rf.inject)(ze)),p(2,(0,rf.inject)(it)),p(3,(0,rf.inject)(Wr))],Sy);var w5=k(A());var xy=class{constructor(){this.providers=new Map}getProviders(e){return(this.providers.get(e)||[]).slice()}register(e,t){this.providers.set(t,this.providers.get(t)||[]),this.providers.get(t).push(e)}};xy=g([(0,w5.injectable)()],xy);var DC=k(A());var Cy=class{constructor(e,t){this.kernelProvider=e;this.disposables=t}activate(){this.kernelProvider.onDidCreateKernel(e=>this.addOnStartHooks(e),this,this.disposables)}addOnStartHooks(e){e.addHook("didStart",async t=>{t&&await R8(t,e.resourceUri,e.kernelConnectionMetadata)},this,this.disposables)}};Cy=g([(0,DC.injectable)(),p(0,(0,DC.inject)(Ke)),p(1,(0,DC.inject)(O))],Cy);var TC=k(A());var Ey=class{constructor(e,t){this.kernelProvider=e;this.disposables=[];this.restartProgress=new WeakMap;this.interruptProgress=new WeakMap;t.push(this)}dispose(){G(this.disposables)}activate(){this.kernelProvider.onDidCreateKernel(this.onDidCreateKernel,this,this.disposables),this.kernelProvider.onDidDisposeKernel(e=>{this.restartProgress.get(e)?.dispose(),this.interruptProgress.get(e)?.dispose()},this,this.disposables)}onDidCreateKernel(e){e.addHook("willRestart",async()=>{this.restartProgress.get(e)?.dispose();let t=ft.createProgressReporter(e.resourceUri,y.restartingKernelStatus(`: ${gt(e.kernelConnectionMetadata)}`));this.restartProgress.set(e,t)},this,this.disposables),e.addHook("restartCompleted",async()=>{this.restartProgress.get(e)?.dispose(),this.interruptProgress.get(e)?.dispose()},this,this.disposables),e.addHook("willInterrupt",async()=>{let t=ft.createProgressReporter(e.resourceUri,y.interruptKernelStatus(gt(e.kernelConnectionMetadata)));this.interruptProgress.set(e,t)},this,this.disposables),e.addHook("interruptCompleted",async()=>this.interruptProgress.get(e)?.dispose(),this,this.disposables)}};Ey=g([(0,TC.injectable)(),p(0,(0,TC.inject)(Ke)),p(1,(0,TC.inject)(O))],Ey);var AT=k(A()),k5=require("vscode"),MT=require("vscode");var wy=class{constructor(e){this.disposables=e}activate(){try{this.disposables.push(k5.workspace.registerPortAttributesProvider({},this))}catch(e){C("Failure in registering port attributes",e)}}providePortAttributes(e,t){try{if(No.has(e.port))return new MT.PortAttributes(MT.PortAutoForwardAction.Ignore)}catch(n){C("Failure in returning port attributes",n)}}};wy=g([(0,AT.injectable)(),p(0,(0,AT.inject)(O))],wy);var ac=k(A()),uF=require("vscode");var Gs=k(A()),_C=require("vscode");var Ua=require("vscode");var phe=/python\s\d*.?\d*$/,aF="__old_vscode_kernelspecs",lF=class{constructor(e,t,n){this.fs=e;this.globalState=t;this.jupyterPaths=n;this.findKernelSpecsInPathCache=new Map;this.pathToKernelSpec=new Map;this.disposables=[];this.oldKernelSpecsFolder&&w(`Old kernelSpecs (created by Jupyter Extension) stored in directory ${this.oldKernelSpecsFolder}`)}get oldKernelSpecsFolder(){return this._oldKernelSpecsFolder||this.globalState.get("OLD_KERNEL_SPECS_FOLDER__","")}set oldKernelSpecsFolder(e){this._oldKernelSpecsFolder=e,this.globalState.update("OLD_KERNEL_SPECS_FOLDER__",e).then(m,m)}clearCache(){this.pathToKernelSpec.clear(),this.findKernelSpecsInPathCache.clear()}dispose(){G(this.disposables)}async loadKernelSpec(e,t,n){if(e.fsPath.includes(aF))return;let i=ar(e);if(!this.pathToKernelSpec.has(i)){let o=this.loadKernelSpecImpl(e,t,n).then(async s=>{let a=await this.jupyterPaths.getKernelSpecRootPath(),l=s&&a&&Kn(s)&&s.specFile&&BS(Ua.Uri.file(s.specFile),a);if(s&&!l)return s;s?.specFile&&l&&this.deleteOldKernelSpec(s.specFile).catch(m),this.pathToKernelSpec.get(i)===o&&this.pathToKernelSpec.delete(i),this.cache=this.cache?.filter(c=>Mi(c.kernelSpecFile,e))});this.pathToKernelSpec.set(i,o),o.finally(()=>{t.isCancellationRequested&&this.pathToKernelSpec.get(i)===o&&this.pathToKernelSpec.delete(i)}).catch(m)}return this.pathToKernelSpec.get(i)}async deleteOldKernelSpec(e){let t=Te(pt(e)),n=Ue(pt(pt(e)),aF);this.oldKernelSpecsFolder=n;let i=Ue(n,t,Te(e));await this.fs.createDirectory(Ua.Uri.file(pt(i))),await this.fs.copy(Ua.Uri.file(e),Ua.Uri.file(i)).catch(m),await this.fs.delete(Ua.Uri.file(e)),w(`Old KernelSpec '${e}' deleted and backup stored in ${n}`)}async loadKernelSpecImpl(e,t,n){return dhe(e,this.fs,t,n)}async findKernelSpecsInPaths(e,t){let n=ar(e),i=this.findKernelSpecsInPathCache.get(n);if(i)return i;let o=(async()=>await this.fs.exists(e)?t.isCancellationRequested?[]:(await this.fs.searchLocal("**/kernel.json",e.fsPath,!0)).map(l=>Yt(e,l)):[])();this.findKernelSpecsInPathCache.set(n,o);let s=t.onCancellationRequested(()=>{this.findKernelSpecsInPathCache.get(n)===o&&this.findKernelSpecsInPathCache.delete(n)});return o.finally(()=>{t.isCancellationRequested&&this.findKernelSpecsInPathCache.get(n)===o&&this.findKernelSpecsInPathCache.delete(n),s.dispose()}).catch(m),o.catch(a=>{this.findKernelSpecsInPathCache.get(n)===o&&this.findKernelSpecsInPathCache.delete(n),w(`Failed to search for kernels in ${W(e)} with an error`,a)}),o}},ky=class{constructor(e,t,n,i,o,s,a){this.fs=e;this.workspaceService=t;this.extensionChecker=n;this.memento=i;this.env=s;this.jupyterPaths=a;this.disposables=[];this._status="idle";this.promiseMonitor=new Eo;this._onDidChangeStatus=new Ua.EventEmitter;this.onDidChangeStatus=this._onDidChangeStatus.event;this._onDidChangeKernels=new Ua.EventEmitter;this.onDidChangeKernels=this._onDidChangeKernels.event;o.push(this),this.disposables.push(this.promiseMonitor),this.promiseMonitor.onStateChange(()=>{this.status=this.promiseMonitor.isComplete?"idle":"discovering"}),this.kernelSpecFinder=new lF(e,i,a),this.disposables.push(this.kernelSpecFinder)}get status(){return this._status}set status(e){this._status!==e&&(this._status=e,this._onDidChangeStatus.fire())}clearCache(){this.kernelSpecFinder.clearCache()}async listKernelsFirstTimeFromMemento(e){let t=(async()=>{let n=this.memento.get(e,JSON.stringify({kernels:[],extensionVersion:""})),i=JSON.parse(n),o=[];i&&Array.isArray(i.kernels)&&i.extensionVersion===this.env.extensionVersion&&(o=i.kernels.map(a=>Rs.fromJSON(a)));let s=[];return await Promise.all(o.map(async a=>{await this.isValidCachedKernel(a)&&s.push(a)})),s})();return this.promiseMonitor.push(t),t}async writeToMementoCache(e,t){await this.memento.update(t,JSON.stringify({kernels:e.map(n=>n.toJSON()),extensionVersion:this.env.extensionVersion}))}async isValidCachedKernel(e){switch(e.kind){case"startUsingPythonInterpreter":return this.fs.exists(e.interpreter.uri);case"startUsingLocalKernelSpec":return(e.kernelSpec.specFile?this.fs.exists(Ua.Uri.file(e.kernelSpec.specFile)):Promise.resolve(!0)).then(n=>n&&e.interpreter?this.fs.exists(e.interpreter.uri):Promise.resolve(!0))}}};async function dhe(r,e,t,n){if(r.fsPath.includes(aF))return;let i;try{w(`Loading kernelspec from ${W(r)} ${n?.uri?`for ${W(n.uri)}`:""}`),i=JSON.parse(await e.readFile(r))}catch(c){C(`Failed to parse kernelspec ${r}`,c);return}if(t.isCancellationRequested||(i.name=n?await gA(n):i.name,t.isCancellationRequested))return;if(!i.display_name.toLowerCase().match(phe)&&i.language===xe&&i.argv.length>2){let c=i.argv.slice(1).map(u=>u.toLowerCase()).filter(u=>!["-m","ipykernel","ipykernel_launcher","-f","{connection_file}"].includes(u));c.length&&(i.name=`${i.name}.${c.join("#")}`)}i.metadata=i.metadata||{},i.metadata.vscode=i.metadata.vscode||{},i.metadata.vscode.originalSpecFile||(i.metadata.vscode.originalSpecFile=r.fsPath),i.metadata.vscode.originalDisplayName||(i.metadata.vscode.originalDisplayName=i.display_name),i.metadata.originalSpecFile&&(i.metadata.vscode.originalSpecFile=i.metadata.originalSpecFile,delete i.metadata.originalSpecFile);let s=new dp(i,r.fsPath,n?.uri.fsPath||i?.metadata?.interpreter?.path,Kn(i));s.name=i?.name||Te(pt(r.fsPath));let a=n?.uri.fsPath||i?.metadata?.interpreter?.path,l=!!n?.isCondaEnvWithoutPython;if(!(a&&!l&&!await e.exists(Ua.Uri.file(a))))return i.isRegisteredByVSC=Kn(i),s}function P5(){return`LOCAL_KERNEL_SPECS_CACHE_KEY_V_2023_2:${_C.env.appHost}:${_C.env.remoteName||""}`}var zs=class extends ky{constructor(t,n,i,o,s,a,l){super(t,n,o,s,a,l,i);this._kernels=new Map}activate(){this.listKernelsFirstTimeFromMemento(P5()).then(t=>{this._kernels.size===0&&t.length&&(t.forEach(n=>this._kernels.set(n.id,n)),this._onDidChangeKernels.fire())}).catch(m),this.refresh().then(m,m)}get kernels(){return Array.from(this._kernels.values())}dispose(){this._onDidChangeKernels.dispose()}async refresh(){this.clearCache(),await this.refreshData()}async refreshData(){let t=new _C.CancellationTokenSource;try{await this.listKernelSpecs(t.token)}finally{t.dispose()}}async listKernelSpecs(t){let i=(async()=>{let s=(await this.findKernelSpecs(t)).map(d=>Al.create({kernelSpec:d,interpreter:void 0,id:ci(d)}));if(t.isCancellationRequested)return[];let a=Array.from(this._kernels.values()).sort((d,f)=>d.id.localeCompare(f.id)),l=s.sort((d,f)=>d.id.localeCompare(f.id)),c=new Set(s.map(d=>d.id)),u=a.filter(d=>!c.has(d.id));return this._kernels.clear(),s.forEach(d=>this._kernels.set(d.id,d)),(a.length!==l.length||u.length||JSON.stringify(a)!==JSON.stringify(l))&&(this._onDidChangeKernels.fire(),this.writeToMementoCache(Array.from(this._kernels.values()),P5()).catch(m)),u.length&&w(`Local kernel spec connection deleted ${u.map(d=>`${d.kind}:'${d.id}'`)}`),s})();return this.promiseMonitor.push(i),i}async findKernelSpecs(t){let n=[],i=await this.jupyterPaths.getKernelSpecRootPaths(t);if(t.isCancellationRequested)return[];let o=await Promise.all(i.map(c=>this.kernelSpecFinder.findKernelSpecsInPaths(c,t)));if(t.isCancellationRequested)return[];await Promise.all(o.flat().map(async c=>{try{if(t.isCancellationRequested)return;let u=await this.kernelSpecFinder.loadKernelSpec(c,t);u&&!t.isCancellationRequested&&(tT(u,"local"),n.push(u))}catch(u){C(`Failed to load kernelSpec for ${c}`,u)}}));let s=new Set;n.forEach(c=>{c.metadata?.originalSpecFile&&s.add(c.metadata.originalSpecFile)}),n=n.filter(c=>!c.specFile||!s.has(c.specFile));let a=[],l=new Map;return n.forEach(c=>{let u=l.get(c.display_name);u&&u.executable!==c.executable?a.push(c):u||(a.push(c),l.set(c.display_name,c))}),a}};zs=g([(0,Gs.injectable)(),p(0,(0,Gs.inject)(Or)),p(1,(0,Gs.inject)(ce)),p(2,(0,Gs.inject)(rn)),p(3,(0,Gs.inject)(ze)),p(4,(0,Gs.inject)(He)),p(4,(0,Gs.named)(It)),p(5,(0,Gs.inject)(O)),p(6,(0,Gs.inject)(An))],zs);var fo=k(A()),T5=require("vscode");var cd=Symbol("ITrustedKernelPaths");var Ji=require("vscode");function cF(){return`LOCAL_KERNEL_PYTHON_AND_RELATED_SPECS_CACHE_KEY_V_2023_3:${Ji.env.appHost}:${Ji.env.remoteName||""}`}async function mhe(r,e,t,n){let i=Ji.Uri.file(Ue(r.sysPrefix,D8)),o=await t.getKernelSpecRootPaths(e);if(e.isCancellationRequested)return[];if(o.some(d=>Mi(d,i)))return[];let s=await n.findKernelSpecsInPaths(i,e);if(e.isCancellationRequested)return[];let a=[];if(await Promise.all(s.map(async d=>{if(e.isCancellationRequested)return;let f=await n.loadKernelSpec(d,e,r);f&&a.push(f)})),e.isCancellationRequested)return[];let l=new Set;a.forEach(d=>{d.metadata?.originalSpecFile&&l.add(d.metadata.originalSpecFile)}),a=a.filter(d=>!d.specFile||!l.has(d.specFile)),a.length&&w(`Kernel Specs found in interpreter ${r.id} are ${JSON.stringify(a)}`);let c=[],u=new Map;return a.forEach(d=>{let f=u.get(d.display_name);f&&f.executable!==d.executable?c.push(d):f||(c.push(d),u.set(d.display_name,d))}),c}var OT=class{constructor(e,t,n,i,o){this.interpreter=e;this.interpreterService=t;this.jupyterPaths=n;this.extensionChecker=i;this.kernelSpecFinder=o;this.disposables=[];this.cancelToken=new Ji.CancellationTokenSource;this.interpreterService.onDidChangeInterpreter(this.clearCacheWhenInterpretersChange,this,this.disposables),this.interpreterService.onDidChangeInterpreters(this.clearCacheWhenInterpretersChange,this,this.disposables)}dispose(){G(this.disposables),this.cancelToken.dispose()}async listKernelSpecs(e){return this.extensionChecker.isPythonExtensionInstalled?!e&&this.kernelSpecPromise?this.kernelSpecPromise:(this.cancelToken.cancel(),this.cancelToken=new Ji.CancellationTokenSource,this.kernelSpecPromise=this.listKernelSpecsImpl(),this.kernelSpecPromise.then(t=>{w(`Kernels for interpreter ${this.interpreter.id} are ${t.map(n=>n.id).join(", ")}`)}).catch(m),this.kernelSpecPromise):[]}clearCacheWhenInterpretersChange(){let e=this.interpreterService.resolvedEnvironments.find(t=>t.id===this.interpreter.id);e&&(this.interpreter.envPath!==e.envPath||this.interpreter.version?.raw!==e.version?.raw||this.interpreter.envType!==e.envType||this.interpreter.sysPrefix!==e.sysPrefix)&&this.listKernelSpecs(!0).catch(m)}async listKernelSpecsImpl(){let e=this.cancelToken.token;w(`Search for KernelSpecs in Interpreter ${$r(this.interpreter.uri)}`);let[t,n]=await Promise.all([mhe(this.interpreter,e,this.jupyterPaths,this.kernelSpecFinder),this.jupyterPaths.getKernelSpecTempRegistrationFolder()]);if(e.isCancellationRequested)return[];let i=Ia(this.interpreter,n),o=new Map;for(let l of t){if(l.language===xe&&(!l.env||Object.keys(l.env).length===0)&&mx(l)){w(`Hiding default kernel spec '${l.display_name}', '${l.name}', ${$r(l.argv[0])} for interpreter ${$r(l.interpreterPath)} and spec ${$r(l.specFile)}`);continue}let c=ru(l)?$o.create({kernelSpec:l,interpreter:this.interpreter,id:ci(l,this.interpreter)}):Al.create({kernelSpec:l,interpreter:this.interpreter,id:ci(l,this.interpreter)});c&&!o.has(c.id)&&o.set(c.id,c)}let s=await i;if(e.isCancellationRequested)return[];let a=$o.create({kernelSpec:s,interpreter:this.interpreter,id:ci(s,this.interpreter)});return o.has(a.id)||o.set(a.id,a),Array.from(o.values())}},KT=class r{constructor(e,t,n,i,o){this.interpreterService=e;this.workspaceService=t;this.kernelSpecsFromKnownLocations=n;this.extensionChecker=i;this.trustedKernels=o;this.kernelsPerInterpreter=new Map;this.disposables=[];this.cancelToken=new Ji.CancellationTokenSource;this.lastKnownGlobalPythonKernelSpecs=[];n.onDidChangeKernels(()=>{let s=this.lastKnownGlobalPythonKernelSpecs,a=this.listGlobalPythonKernelSpecs();if(s.length!==a.length||!tl(s,a)){this.kernelSpecPromise=void 0;return}})}static{this.globalPythonKernelSpecsForWhichWeCouldNotFindInterpreterInfo=new Set}dispose(){G(this.disposables),this.cancelToken.dispose()}async listKernelSpecs(e){return this.extensionChecker.isPythonExtensionInstalled?!e&&this.kernelSpecPromise?this.kernelSpecPromise:(this.clear(),this.cancelToken=new Ji.CancellationTokenSource,this.kernelSpecPromise=this.listKernelSpecsImpl(),this.kernelSpecPromise):[]}clear(){this.kernelsPerInterpreter.clear(),this.cancelToken.cancel(),this.cancelToken.dispose(),this.kernelSpecPromise=void 0}async findMatchingInterpreter(e,t){let n=this.extensionChecker.isPythonExtensionInstalled?this.interpreterService.resolvedEnvironments:[],i=e&&Array.isArray(e.argv)&&e.argv.length>0?e.argv[0]:void 0,o=e.language||"",s=e.specFile?await ht(e.specFile):"",a=!!Kn(e);if(e.language&&e.language!==xe){w(`Kernel ${e.name} is not python based so does not have an interpreter.`),!a&&i&&e.specFile&&D5(i)&&R("GLOBAL_PYTHON_KERNELSPEC",void 0,{kernelSpecHash:s,kernelConnectionType:t,pythonPathDefined:Te(i)!==i,argv0:Te(i),language:o,isCreatedByUs:a});return}let l=n.find(c=>e.metadata?.interpreter?.path&&Co(Ji.Uri.file(e.metadata.interpreter.path),c.uri)?(w(`Kernel ${e.name} matches ${c.displayName} based on metadata path.`),!0):!1);if(l)return l;if(i&&Te(i)===i&&e.specFile&&!a&&R("GLOBAL_PYTHON_KERNELSPEC",void 0,{kernelSpecHash:s,kernelConnectionType:t,pythonPathDefined:!1,argv0:Te(i),language:o,isCreatedByUs:a}),i&&Te(i)!==i){let c=Ji.Uri.file(i),u=n.find(d=>Co(c,d.uri)?(w(`Kernel ${e.name} matches ${d.displayName} based on path in argv.`),!0):!1);if(u)return e.specFile&&!a&&R("GLOBAL_PYTHON_KERNELSPEC",void 0,{kernelSpecHash:s,kernelConnectionType:t,pythonPathDefined:!0,argv0:Te(i),pythonEnvFound:"found",language:o,isCreatedByUs:a}),u;if(!e.specFile||this.trustedKernels.isTrusted(Ji.Uri.file(e.specFile))){let d=await this.interpreterService.getInterpreterDetails(c);if(d)return e.specFile&&!a&&R("GLOBAL_PYTHON_KERNELSPEC",void 0,{kernelSpecHash:s,kernelConnectionType:t,pythonPathDefined:!0,argv0:Te(i),pythonEnvFound:"foundViaGetEnvDetails",language:o,isCreatedByUs:a}),d;e.specFile&&!a&&R("GLOBAL_PYTHON_KERNELSPEC",void 0,{kernelSpecHash:s,kernelConnectionType:t,pythonPathDefined:!0,argv0:Te(i),pythonEnvFound:"notFound",language:o,isCreatedByUs:a})}else e.specFile&&!a&&R("GLOBAL_PYTHON_KERNELSPEC",void 0,{kernelSpecHash:s,kernelConnectionType:t,pythonPathDefined:!0,argv0:Te(i),pythonEnvFound:"notTrusted",language:o,isCreatedByUs:a})}if(e.interpreterPath){let c=Ji.Uri.file(e.interpreterPath),u=n.find(d=>e.interpreterPath&&Co(c,d.uri)?(w(`Kernel ${e.name} matches ${d.displayName} based on interpreter path.`),!0):!1);if(u)return u;if(!e.specFile||this.trustedKernels.isTrusted(Ji.Uri.file(e.specFile))){let d=await this.interpreterService.getInterpreterDetails(c);if(d)return d}}return n.find(c=>e.display_name===c.displayName?(w(`Kernel ${e.name} matches ${c.displayName} based on display name.`),!0):!1)}listGlobalPythonKernelSpecs(){return this.lastKnownGlobalPythonKernelSpecs=this.kernelSpecsFromKnownLocations.kernels.filter(e=>e.kernelSpec.language===xe)}warnAboutPythonKernelSpecWithInvalidPythonExec(e){let t=e.specFile||JSON.stringify(e);r.globalPythonKernelSpecsForWhichWeCouldNotFindInterpreterInfo.has(t)||(r.globalPythonKernelSpecsForWhichWeCouldNotFindInterpreterInfo.add(t),J(`Kernel Spec for '${e.display_name}' (${$r(e.specFile)}) hidden, as we cannot find a matching interpreter argv = '${e.argv[0]}'. To resolve this, please change '${e.argv[0]}' to point to the fully qualified Python executable.`))}async listKernelSpecsImpl(){let e=this.cancelToken.token,t=this.listGlobalPythonKernelSpecs(),n=Promise.all((this.workspaceService.workspaceFolders||[]).map(c=>this.interpreterService.getActiveInterpreter(c.uri)));w("Finding Global Python KernelSpecs");let i=await Gt(e,[],n);if(e.isCancellationRequested)return[];let o=t.filter(c=>Kn(c.kernelSpec)),s=c=>{if(c.kernelSpec.language!==xe)return!1;let u=c.kernelSpec.argv.map(h=>h.toLowerCase()),d=u.indexOf("-m");if(d===-1)return!1;let f=u.length-1>=d?u[d+1]:void 0;return f?f!=="ipykernel_launcher":!1},a=new Map,l=new Set;return await Promise.all(t.filter(c=>{let u=Kn(c.kernelSpec);return!!(!u&&(s(c)||Object.keys(c.kernelSpec.env||{}).length>0)||!u&&c.kernelSpec.language===xe&&!mx(c.kernelSpec))}).map(async c=>{let u=await this.findMatchingInterpreter(c.kernelSpec,"startUsingLocalKernelSpec");if(!u){let f=c.kernelSpec.argv.length?c.kernelSpec.argv[0].toLowerCase():"";if(D5(f)){this.warnAboutPythonKernelSpecWithInvalidPythonExec(c.kernelSpec);return}}let d=Al.create({kernelSpec:c.kernelSpec,interpreter:u,id:ci(c.kernelSpec,u)});a.set(d.id,d),d.kernelSpec.specFile&&l.add(d.kernelSpec.specFile)})),e.isCancellationRequested?[]:(await Promise.all(o.map(c=>c.kernelSpec).filter(c=>c.language===xe&&(!c.env||Object.keys(c.env).length===0)&&mx(c)?(w(`Hiding default kernel spec '${c.display_name}', '${c.name}', ${$r(c.argv[0])} for interpreter ${$r(c.interpreterPath)} and spec ${$r(c.specFile)}`),!1):c.specFile&&l.has(c.specFile)?(w(`Global kernel spec ${c.name}${$r(c.specFile)} already found with a matching Python Env`),!1):!0).map(async c=>{let u=await this.findMatchingInterpreter(c,"startUsingPythonInterpreter");if(u&&ru(c)){let d=ru(c)?$o.create({kernelSpec:c,interpreter:u,id:ci(c,u)}):Al.create({kernelSpec:c,interpreter:u,id:ci(c,u)});if(Kn(d.kernelSpec)==="registeredByOldVersionOfExt"){w(`Ignoring Global Python KernelSpec '${c.display_name}', '${c.name}' (${$r(c.specFile)}) registered by an old version of the extension`);return}return H(`Using interpreter ${$r(u.id)} for Global Python kernel '${c.display_name}', ${c.name} (${$r(c.specFile)})`),d}else{let d=i.find(b=>!!b),f=d,h=!1,v=c.metadata?.interpreter?.path?Ji.Uri.file(c.metadata.interpreter.path):void 0;if(v){let b=i.find(D=>Co(v,D?.uri));if(b)f=b,h=!0;else try{f=await this.interpreterService.getInterpreterDetails(v),h=!0}catch(D){C(`Failed to get interpreter details for Kernel Spec '${c.display_name}', '${c.name}' ${Jc(c.specFile)} with interpreter path ${$r(v)}`,D);return}}d&&d===f&&!h?J(`Kernel might not start correctly: Fully qualified Python exe not defined (or not found) in Kernel Spec ${c.id} (${Jc(c.specFile)}, kernelspec.argv[0] = ${Jc(c.argv[0])}), hence falling back to using the Active Interpreter ${Jc(f.id)}`):h||J(`Kernel might not start correctly: Fully qualified Python exe not defined (or not found) in Kernel Spec ${c.id} (${Jc(c.specFile)}, kernelspec.argv[0] = ${Jc(c.argv[0])}).`);let S=Al.create({kernelSpec:c,interpreter:f,id:ci(c,f)});return w(`Interpreter for Local kernel ${S.id} is ${f?.id}`),S}}).map(async c=>{if(e.isCancellationRequested)return[];let u=await c;w(`Found kernel spec at end of discovery ${u?.id}`),u&&!a.has(u.id)&&a.set(u.id,u)})),e.isCancellationRequested?[]:Array.from(a.values()))}};function D5(r){return r=Te(r).trim().toLowerCase(),r==="python"||r==="python3"||r==="python.exe"||r==="python3.exe"}var mu=class extends ky{constructor(t,n,i,o,s,a,l,c,u,d){super(n,i,s,l,c,u,o);this.interpreterService=t;this.kernelSpecsFromKnownLocations=a;this._kernels=new Map;this._kernelsExcludingCachedItems=new Map;this._kernelsFromCache=[];this.cachedInformationForPythonInterpreter=new Map;this.updateCachePromise=Promise.resolve();this.discoveredKernelSpecFiles=new Set;this.lastKnownGlobalPythonKernelSpecs=[];this.interpreterKernelSpecs=new Map;this.globalPythonKernelSpecFinder=new KT(this.interpreterService,this.workspaceService,this.kernelSpecsFromKnownLocations,this.extensionChecker,d),this.disposables.push(this._onDidChangeKernels),t.onDidChangeInterpreters(()=>{this.refreshCancellation?.cancel(),this.refreshData().catch(m)},this,this.disposables),t.onDidRemoveInterpreter(f=>{w(`Interpreter removed ${f.id}`);let h=[];this._kernels.forEach(v=>{v.interpreter?.id===f.id&&(w(`Interpreter ${f.id} deleted, hence deleting corresponding kernel ${v.kind}:'${v.id}`),h.push(v),this._kernels.delete(v.id))}),h.length&&(w(`Local Python connection deleted ${h.map(v=>`${v.kind}:'${v.id}: (interpreter id=${$r(v.interpreter?.id)})'`)}`),this.updateCache().catch(m))},this,this.disposables)}activate(){this.listKernelsFirstTimeFromMemento(cF()).then(t=>{t.length&&(t.filter(n=>!this._kernels.has(n.id)).forEach(n=>{this._kernelsFromCache.push(n),this._kernels.set(n.id,n)}),this._onDidChangeKernels.fire())}).finally(async()=>{this.refreshCancellation?.cancel(),this.refreshData().catch(m),this.kernelSpecsFromKnownLocations.onDidChangeKernels(()=>{let t=this.lastKnownGlobalPythonKernelSpecs,n=this.listGlobalPythonKernelSpecsIncludingThoseRegisteredByUs();(t.length!==n.length||!tl(t,n))&&(this.refreshCancellation?.cancel(),this.refreshData().catch(m))},this,this.disposables)}).catch(m)}get kernels(){return Array.from(this._kernels.values())}dispose(){G(this.disposables)}async refresh(){this.globalPythonKernelSpecFinder.clear(),this.clearCache(),this.cachedInformationForPythonInterpreter.clear(),this.discoveredKernelSpecFiles.clear(),this.interpreterService.refreshInterpreters(!0).catch(m),await this.refreshData(!0)}refreshData(t=!1){if(!t&&this.refreshCancellation&&!this.refreshCancellation.token.isCancellationRequested&&this.previousRefresh)return this.previousRefresh;this.refreshCancellation?.cancel(),this.refreshCancellation?.dispose();let n=this.refreshCancellation=new T5.CancellationTokenSource,i=(async()=>{if(await this.listKernelsImplementation(n.token,t).catch(o=>C("Failure in listKernelsImplementation",o)),!n.token.isCancellationRequested){if(this.interpreterService.status==="idle"){let o=this._kernelsFromCache.filter(c=>!this._kernelsExcludingCachedItems.has(c.id)),s=[];o.length&&(J(`Kernels ${o.map(c=>`${c.kind}:'${c.id}'`).join(", ")} found in cache but not discovered in current session ${Array.from(this._kernelsExcludingCachedItems.values()).map(c=>`${c.kind}:'${c.id}'`).join(", ")}`),o.forEach(c=>{this._kernels.delete(c.id),s.push(c)}));let a=new Set(this.interpreterService.resolvedEnvironments.map(c=>c.id)),l=Array.from(this._kernels.values()).filter(c=>!!(c.interpreter&&!a.has(c.interpreter.id)));l.length&&(J(`The following kernels use interpreters that are no longer valid or not recognized by Python extension, Kernels ${l.map(c=>`${c.kind}:'id=${c.id}'(interpreterId='${$r(c.interpreter?.id)}')`).join(",")} and valid interpreter ids include ${Array.from(a).join(", ")}`),l.forEach(c=>{this._kernels.delete(c.id),s.push(c)})),s.length&&(w(`Local Python connection deleted ${s.map(c=>`${c.kind}:'${c.id}: (interpreter id=${$r(c.interpreter?.id)})'`)}`),await this.updateCache())}t&&(this._kernelsFromCache=[])}})().catch(o=>C("Failed to discover kernels in interpreters",o)).finally(()=>{n===this.refreshCancellation&&(this.refreshCancellation?.cancel(),this.refreshCancellation?.dispose(),this.refreshCancellation=void 0)});return this.previousRefresh=i,this.promiseMonitor.push(i),i}async updateCache(){this._onDidChangeKernels.fire();let t=Array.from(this._kernels.values());this.updateCachePromise=this.updateCachePromise.finally(()=>this.writeToMementoCache(t,cF()).catch(m)),await this.updateCachePromise}async listKernelsImplementation(t,n){let i=this.extensionChecker.isPythonExtensionInstalled?this.interpreterService.resolvedEnvironments:[],o=Promise.all(i.map(async a=>{let l=this.interpreterKernelSpecs.get(a.id);l||(l=new OT(a,this.interpreterService,this.jupyterPaths,this.extensionChecker,this.kernelSpecFinder),this.disposables.push(l),this.interpreterKernelSpecs.set(a.id,l));let c=await Gt(t,[],l.listKernelSpecs(n));await this.appendNewKernels(c)})),s=Gt(t,[],this.globalPythonKernelSpecFinder.listKernelSpecs(n)).then(a=>this.appendNewKernels(a));await Promise.all([o,s])}async appendNewKernels(t){t.length&&(t.forEach(n=>{mt(n)&&n.kernelSpec.specFile?(this._kernelsExcludingCachedItems.set(n.id,n),this._kernels.has(n.id)?this._kernels.set(n.id,n):this._kernels.set(n.id,n)):J(`Found a kernel ${n.kind}:'${n.id}', but excluded as specFile is undefined`)}),await this.updateCache())}listGlobalPythonKernelSpecs(t){return this.kernelSpecsFromKnownLocations.kernels.filter(i=>i.kernelSpec.language===xe).filter(i=>t?!0:!Kn(i.kernelSpec))}listGlobalPythonKernelSpecsIncludingThoseRegisteredByUs(){return this.lastKnownGlobalPythonKernelSpecs=this.listGlobalPythonKernelSpecs(!0)}};mu=g([(0,fo.injectable)(),p(0,(0,fo.inject)(it)),p(1,(0,fo.inject)(Or)),p(2,(0,fo.inject)(ce)),p(3,(0,fo.inject)(rn)),p(4,(0,fo.inject)(ze)),p(5,(0,fo.inject)(zs)),p(6,(0,fo.inject)(He)),p(6,(0,fo.named)(vi)),p(7,(0,fo.inject)(O)),p(8,(0,fo.inject)(An)),p(9,(0,fo.inject)(cd))],mu);var nf=class{constructor(e,t,n,i,o,s,a){this.nonPythonKernelFinder=e;this.pythonKernelFinder=t;this.disposables=i;this.extensionChecker=o;this.interpreters=s;this.extensions=a;this._status="idle";this._onDidChangeStatus=new uF.EventEmitter;this.onDidChangeStatus=this._onDidChangeStatus.event;this.promiseMonitor=new Eo;this.kind="localKernelSpec";this.id="localKernelSpec";this.displayName=y.localKernelSpecs;this._onDidChangeKernels=new uF.EventEmitter;this.onDidChangeKernels=this._onDidChangeKernels.event;this.wasPythonInstalledWhenFetchingControllers=!1;this.cache=[];n.registerKernelFinder(this),this.disposables.push(this._onDidChangeStatus),this.disposables.push(this._onDidChangeKernels),this.disposables.push(this.promiseMonitor)}get status(){return this._status}set status(e){this._status!==e&&(this._status=e,this._onDidChangeStatus.fire())}activate(){this.promiseMonitor.onStateChange(()=>{this.status=this.promiseMonitor.isComplete&&this.interpreters.status==="idle"&&this.nonPythonKernelFinder.status==="idle"&&this.pythonKernelFinder.status==="idle"?"idle":"discovering"}),this.loadData().then(m,m);let e,t=()=>{[this.nonPythonKernelFinder.status,this.pythonKernelFinder.status,this.interpreters.status==="refreshing"?"discovering":"idle"].includes("discovering")?e||(e=pe(),this.promiseMonitor.push(e.promise)):(e?.resolve(),e=void 0)};t(),this.nonPythonKernelFinder.onDidChangeStatus(t,this,this.disposables),this.pythonKernelFinder.onDidChangeStatus(t,this,this.disposables),this.interpreters.onDidChangeStatus(t,this,this.disposables),this.loadData().then(m,m),this.interpreters.onDidChangeInterpreters(async()=>this.loadData().then(m,m),this,this.disposables),this.extensions.onDidChange(()=>{!this.wasPythonInstalledWhenFetchingControllers&&this.extensionChecker.isPythonExtensionInstalled&&this.loadData().then(m,m)},this,this.disposables),this.nonPythonKernelFinder.onDidChangeKernels(()=>this.loadData().then(m,m),this,this.disposables),this.pythonKernelFinder.onDidChangeKernels(()=>this.loadData().then(m,m),this,this.disposables),this.wasPythonInstalledWhenFetchingControllers=this.extensionChecker.isPythonExtensionInstalled}async refresh(){let e=(async()=>{await this.nonPythonKernelFinder.refresh(),await this.pythonKernelFinder.refresh(),await this.updateCache()})();this.promiseMonitor.push(e),await e}async loadData(){let e=this.updateCache();this.promiseMonitor.push(e),await e}async updateCache(){try{let e=[],t=this.nonPythonKernelFinder.kernels.filter(i=>this.extensionChecker.isPythonExtensionInstalled?i.kernelSpec.language!==xe:!0),n=this.pythonKernelFinder.kernels.filter(i=>eg(i));e=e.concat(t).concat(n),await this.writeToCache(e)}catch(e){C("Exception Saving loaded kernels",e)}}get kernels(){let e=new Set,t=[];return this.pythonKernelFinder.kernels.forEach(n=>{let i=Kn(n.kernelSpec);n.kernelSpec.specFile&&i==="registeredByNewVersionOfExtForCustomKernelSpec"&&(e.add(n.kernelSpec.specFile),t.push(n))}),this.cache.forEach(n=>{n.kernelSpec.specFile&&e.has(n.kernelSpec.specFile)||t.push(n)}),t}filterKernels(e){return e.filter(({kernelSpec:t})=>!0)}async writeToCache(e){let t=new Set;e=this.filterKernels(e.filter(c=>t.has(c.id)?!1:(t.add(c.id),!0)));let n=this.cache,i=new Map(n.map(c=>[c.id,c])),o=new Map(e.map(c=>[c.id,c])),s=e.filter(c=>!i.has(c.id)),a=e.filter(c=>i.has(c.id)&&!tl(c,i.get(c.id))),l=n.filter(c=>!o.has(c.id));this.cache=e,(s.length||a.length||l.length)&&this._onDidChangeKernels.fire({removed:l})}};g([vh("List kernels failed")],nf.prototype,"updateCache",1),nf=g([(0,ac.injectable)(),p(0,(0,ac.inject)(zs)),p(1,(0,ac.inject)(mu)),p(2,(0,ac.inject)(Wr)),p(3,(0,ac.inject)(O)),p(4,(0,ac.inject)(ze)),p(5,(0,ac.inject)(it)),p(6,(0,ac.inject)(rr))],nf);var of=k(A());var RC=require("vscode"),R5=require("os");function _5(r){return!!(N5(r)&&(r?.envType==="Unknown"||r?.envType==="Pyenv"||r?.envType==="Conda"))}function N5(r){return(r?.version?.major??3)>=3&&(r?.version?.minor??6)>=6}var fu=class{constructor(e,t,n,i){this.pythonExecutionFactory=e;this.disposableRegistry=t;this.interpreters=n;this.context=i;this.messages=new Map;this.requestCounter=0}async createInterrupter(e,t){try{return await this.createInterrupterImpl(e,t)}catch(n){return C("Failed to create interrupter, trying again",n),this.createInterrupterImpl(e,t)}}async createInterrupterImpl(e,t){let n=await this.sendCommand({command:"INITIALIZE_INTERRUPT"},e,t);if(!n)throw C("Unable to initialize interrupt handle"),new Error("Unable to initialize interrupt handle");return{handle:n,interrupt:async()=>{await this.sendCommand({command:"INTERRUPT",handle:n},e,t)},dispose:async()=>{await this.sendCommand({command:"DISPOSE_INTERRUPT_HANDLE",handle:n},e,t).catch(i=>C(`Failed to dispose interrupt handle for ${e.id}`,i))}}}async getInterpreter(e){if(e&&_5(e))return e;let t=this.interpreters.resolvedEnvironments;return t.length===0?e:t.find(_5)||t.find(N5)||e}async initializeInterrupter(e,t){if(this.startupPromise)return this.startupPromise;let n=(async()=>{let i=await this.getInterpreter(e),o=await this.pythonExecutionFactory.createActivatedEnvironment({interpreter:i,resource:t}),s=RC.Uri.joinPath(this.context.extensionUri,"pythonFiles","vscode_datascience_helpers"),a=RC.Uri.joinPath(s,"kernel_interrupt_daemon.py"),l=o.execObservable([a.fsPath,"--ppid",process.pid.toString()],{cwd:s.fsPath});return await new Promise((c,u)=>{let d=!1,f=l.out.onDidChange(h=>{if(te(`Output from interrupt daemon started = ${d}, output (${h.source}) = ${h.out} ('END)`),h.source==="stdout"&&h.out.trim().includes("DAEMON_STARTED:")&&!d)d=!0,c();else if(h.source==="stderr"&&h.out.includes("INTERRUPT:")&&h.out.includes("ERROR: handling command :INITIALIZE_INTERRUPT:")&&d)je(h.out,{trim:!0,removeEmptyEntries:!0}).filter(v=>v.includes("INTERRUPT:")).forEach(v=>{try{let S=v.split(":"),b=parseInt(S[S.indexOf("INITIALIZE_INTERRUPT")+1],10),D=this.messages.get(b);D&&(C(`Failed to initialize interrupt daemon for ${b}, ${h.out}`),D.deferred.reject(new Error(`Failed to start interrupt daemon ${h.out}`)),this.messages.delete(b))}catch(S){C(`Failed to parse interrupt daemon response, ${h.out}`,S)}});else if(h.source==="stdout"&&h.out.includes("INTERRUPT:")&&d)je(h.out,{trim:!0,removeEmptyEntries:!0}).filter(v=>v.includes("INTERRUPT:")).forEach(v=>{try{let[S,b,D]=v.split(":"),_=this.messages.get(parseInt(b,10));_?(w(`Got a response of ${D} for ${S}:${b}`),_.deferred.resolve(D),this.messages.delete(parseInt(b,10))):C(`Got a response of ${D} for ${S}:${b} but no command entry found in ${h.out}`)}catch(S){C(`Failed to parse interrupt daemon response, ${h.out}`,S)}});else if(h.out.includes("ERROR: handling command")){if(J(`Error output in interrupt daemon response ${h.out} ('END')`),!d)return u(new Error(`Interrupt daemon failed to start, ${h.out}`));try{let v=h.out.split(":")[2],S=this.messages.get(parseInt(v,10));if(S){S.deferred.reject(new Error(h.out)),this.messages.delete(parseInt(v,10));return}}catch(v){C(`Failed to parse interrupt daemon response, ${h.out}`,v)}}});this.disposableRegistry.push(f)}),this.disposableRegistry.push(new RC.Disposable(()=>kn(()=>l.proc?.kill()))),l.proc?.on("close",()=>{te("Interrupt daemon closed"),this.startupPromise=void 0}),l.proc?.on("exit",()=>{te("Interrupt daemon exited"),this.startupPromise=void 0}),l})();return n.catch(i=>C(`Failed to start interrupt daemon for (${e.id})`,i)),this.startupPromise=n,n}async sendCommand(e,t,n){let i=pe(),o=this.requestCounter++;this.messages.set(o,{command:e,deferred:i});let s=e.command==="INITIALIZE_INTERRUPT"?`${e.command}:${o}`:`${e.command}:${o}:${e.handle}`,{proc:a}=await this.initializeInterrupter(t,n);if(!a||!a.stdin)throw C("No process or stdin"),new Error("No process or stdin");a.stdin.write(`${s}${R5.EOL}`),te(`Sending Interrupt Request id=${o}, Command ${e.command} for ${t.id}`);let l=await i.promise;if(te(`Got Interrupt Response id=${o}, Command ${e.command} for ${t.id}`),e.command==="INITIALIZE_INTERRUPT")return parseInt(l,10)}};fu=g([(0,of.injectable)(),p(0,(0,of.inject)(Hr)),p(1,(0,of.inject)(O)),p(2,(0,of.inject)(it)),p(3,(0,of.inject)(dt))],fu);var NC=k(A());var pF=require("vscode");var lc=class{constructor(e,t){this.platform=e;this.workspace=t;this.programData=process.env.PROGRAMDATA?pF.Uri.file(Pn(process.env.PROGRAMDATA)):void 0}get trustedKernelSpecs(){return this.workspace.getConfiguration("jupyter",void 0).get("kernels.trusted",[])}isTrusted(e){let t=this.isTrustedImpl(e);return!t&&!lc.IsKernelSpecHidden.completed&&lc.IsKernelSpecHidden.resolve(!0),t}isTrustedImpl(e){return e.scheme!=="file"||this.trustedKernelSpecs.map(t=>this.platform.isWindows?t.toLowerCase():t).map(t=>pF.Uri.file(t).path).includes(this.platform.isWindows?e.path.toLowerCase():e.path)?!0:this.platform.isWindows&&this.programData?!e.path.toLowerCase().startsWith(this.programData.path.toLowerCase()):!0}};lc.IsKernelSpecHidden=pe(),lc=g([(0,NC.injectable)(),p(0,(0,NC.inject)(Ir)),p(1,(0,NC.inject)(ce))],lc);var QT=k(ql()),ls=k(A()),xF=k(require("os"));var VH=require("util"),BH=k(po()),YT=require("vscode");var wH=require("process"),kH=k(ql()),Ty=k(require("os"));var _y=require("vscode");var PH=k($5());var xH="To connect another client to this kernel, use:",CH=`NOTE: When using the \`ipython kernel\` entry point, Ctrl-C will not work.

To exit, you will have to explicitly quit this process, by either sending
"quit" from a client, or using Ctrl-\\ in UNIX-like environments.

To read more about this, see https://github.com/ipython/ipython/issues/2049


`,Dy=class{constructor(e,t,n,i,o,s,a,l,c,u,d,f,h){this.processExecutionFactory=e;this._connection=t;this.fileSystem=i;this.resource=o;this.extensionChecker=s;this.kernelEnvVarsService=a;this.pythonExecFactory=l;this.outputChannel=c;this.jupyterSettings=u;this.jupyterPaths=d;this.pythonKernelInterruptDaemon=f;this.platform=h;this.exitEvent=new _y.EventEmitter;this._kernelConnectionMetadata=n}get pid(){return this._pid}get exited(){return this.exitEvent.event}get kernelConnectionMetadata(){return this._kernelConnectionMetadata}get connection(){return this._connection}get isPythonKernel(){return Vt(this.kernelConnectionMetadata)&&ru(this.kernelConnectionMetadata)}get canInterrupt(){return this._kernelConnectionMetadata.kernelSpec.interrupt_mode!=="message"}async interrupt(){if(this.canInterrupt)if(this._kernelConnectionMetadata.kernelSpec.interrupt_mode!=="message"&&this._process&&!this.interrupter)H("Interrupting kernel via SIGINT"),this._process.pid&&(0,wH.kill)(this._process.pid,"SIGINT");else{if(this._kernelConnectionMetadata.kernelSpec.interrupt_mode!=="message"&&this._process&&this.interrupter&&Vt(this._kernelConnectionMetadata))return H("Interrupting kernel via custom event (Win32)"),this.interrupter.interrupt();C("No process to interrupt in KernleProcess.ts")}else throw new Error("Kernel interrupt not supported in KernelProcess.ts")}async launch(e,t,n){if(this.launchedOnce)throw new Error("Kernel has already been launched.");this.launchedOnce=!0,await this.updateConnectionArgs(),Cn.throwIfCanceled(n);let i=await this.launchAsObservable(e,n);if(n.isCancellationRequested)throw new _y.CancellationError;let o="",s="",a="",l=!1,c,u=pe();u.promise.catch(m),i.proc.on("exit",f=>{if(f=f||c,this.disposed){w(`KernelProcess Exited, Exit Code - ${f}`);return}w(`KernelProcess Exited, Exit Code - ${f}`,a),l||(this.exitEvent.fire({exitCode:f||void 0,reason:Kh(a)||a}),l=!0),n.isCancellationRequested||(te("KernelProcessExitedError raised",s),u.reject(new Qp(f||-1,s,this.kernelConnectionMetadata)))}),i.proc&&(i.proc.stdout?.on("data",f=>{w(`Kernel output: ${(f||"").toString()}`),this.sendToOutput((f||"").toString())}),i.proc.stderr?.on("data",f=>{let h=EH((f||"").toString());a+=h,h.trim().length&&w(`KernelProcess error: ${h}`),this.sendToOutput(h)}));let d=!1;i.out.onDidChange(f=>{if(f.source==="stderr")f.out=EH(f.out),s+=f.out,f.out.trim().length&&J(`StdErr from Kernel Process ${f.out.trim()}`);else{if(o+=f.out,!d){o=o.replace(CH,""),o=o.replace(CH.split(/\r?\n/).join(Ty.EOL),""),o=o.trimStart();let h=je(o,{trim:!0,removeEmptyEntries:!0});h.length===2&&h[0]===xH&&h[1].startsWith("--existing")&&h[1].endsWith(".json")&&(o=`${h.join(" ")}${Ty.EOL}`)}o.includes(xH)&&(d=!0)}this.sendToOutput(f.out)}),i.out.done.catch(f=>{if(this.disposed){J("Kernel died",f,s);return}C("Kernel died",f,s),u.reject(f)});try{u.rejected&&await u.promise;let f=(await Promise.resolve().then(()=>k(SH()))).default,h=Promise.all([f.waitUntilUsed(this.connection.shell_port,200,t),f.waitUntilUsed(this.connection.iopub_port,200,t)]).catch(v=>{if(!(n.isCancellationRequested||u.rejected))return C("waitUntilUsed timed out",v),Promise.reject(new Uv(this.kernelConnectionMetadata))});await pr(n,h,u.promise)}catch(f){let h=(a||s||"").trim();if(!n?.isCancellationRequested&&!br(f)&&(C("Disposing kernel process due to an error",f),f&&f instanceof Error&&h.length&&f.message.includes(h)||C(h)),await this.dispose(),!n?.isCancellationRequested&&f instanceof tt)throw f;{n?.isCancellationRequested&&w("User cancelled the kernel launch");let v=Ww(h)||h.substring(0,100);throw te("KernelDiedError raised",v,a+`
`+s+`
`),new zp(y.kernelDied(v),a+`
`+s+`
`,f,this.kernelConnectionMetadata)}}}async dispose(){if(this._disposingPromise)return this._disposingPromise;if(this.disposed)return;this.disposed=!0;let e=this._process?.pid;H(`Dispose Kernel process ${e}.`),this._disposingPromise=(async()=>{await Dr(1e3,this.killChildProcesses(this._process?.pid).catch(m));try{this.interrupter?.dispose().catch(m),this._process?.kill(),this.exitEvent.fire({})}catch(t){C(`Error disposing kernel process ${e}`,t)}kn(async()=>{this.connectionFile&&await this.fileSystem.delete(this.connectionFile).catch(t=>J(`Failed to delete connection file ${this.connectionFile} for pid ${e}`,t))}),w(`Disposed Kernel process ${e}.`)})()}async killChildProcesses(e){if(!(!e||!$l.isAlive(e)))try{if(this.platform.isWindows){let t=process.env.WINDIR||"C:\\Windows",n=Ue(t,"System32","taskkill.exe");await new $l().exec(n,["/F","/T","/PID",e.toString()])}else await new Promise(t=>{(0,PH.default)(e,(n,i)=>{n?J(`Failed to kill children for ${e}`,n):i.forEach(o=>$l.kill(o)),t()})})}catch(t){J(`Failed to kill children for ${e}`,t)}}sendToOutput(e){this.outputChannel&&this.outputChannel.append(e)}get launchKernelSpec(){if(this._launchKernelSpec)return this._launchKernelSpec;let e=this._kernelConnectionMetadata.kernelSpec;if(!e)throw new Error("KernelSpec cannot be empty in KernelProcess.ts");return Array.isArray(e.argv)?this._launchKernelSpec={...e,argv:[...e.argv]}:(C("KernelSpec.argv in KernelProcess is undefined"),this._launchKernelSpec=void 0),this._launchKernelSpec}async updateConnectionArgs(){let e=kV(this.launchKernelSpec);if(e===-1)throw new Error(`Connection file not found in kernelspec json args, ${this.launchKernelSpec.argv.join(" ")}`);if(this.isPythonKernel&&e===0&&this.launchKernelSpec.argv[e-1]!=="-f")throw new Error(`Connection file not found in kernelspec json args, ${this.launchKernelSpec.argv.join(" ")}`);if(this.connectionFile=await this.createConnectionFile(),this.isPythonKernel)this.launchKernelSpec.argv.splice(e-1,2),this.launchKernelSpec.argv.push(...this.addPythonConnectionArgs(this.connectionFile)),await this.fileSystem.writeFile(this.connectionFile,JSON.stringify(this._connection));else{await this.fileSystem.writeFile(this.connectionFile,JSON.stringify(this._connection));let t=this.connectionFile.fsPath.includes(" ")?`"${this.connectionFile.fsPath}"`:this.connectionFile.fsPath;this.launchKernelSpec.argv[e].includes("--connection-file")?this.launchKernelSpec.argv[e]=this.launchKernelSpec.argv[e].replace(cm,t):this.launchKernelSpec.argv[e].includes(`=${cm}`)&&!this.launchKernelSpec.argv[e].trim().startsWith("=")?this.launchKernelSpec.argv[e]=this.launchKernelSpec.argv[e].replace(cm,t):this.launchKernelSpec.argv[e]=this.launchKernelSpec.argv[e].replace(cm,this.connectionFile.fsPath)}}async createConnectionFile(){let e=await this.jupyterPaths.getRuntimeDir(),t=await this.fileSystem.createTemporaryLocalFile({fileExtension:".json",prefix:"kernel-v2-"}),n=e?Ue(e.fsPath,Te(t.filePath)):t.filePath;return await t.dispose(),_y.Uri.file(n)}addPythonConnectionArgs(e){let t=[],n=e.fsPath.includes(" ")?`"${e.fsPath}"`:e.fsPath;return t.push(`--f=${n}`),t}async launchAsObservable(e,t){let n;if(w(`Launching kernel ${this.kernelConnectionMetadata.id} for ${W(this.resource)} in ${W(e)} with ports ${this.connection.control_port}, ${this.connection.hb_port}, ${this.connection.iopub_port}, ${this.connection.shell_port}, ${this.connection.stdin_port}`),this.isPythonKernel&&this.extensionChecker.isPythonExtensionInstalled&&this._kernelConnectionMetadata.interpreter){let i=this.pythonExecFactory.createActivatedEnvironment({resource:this.resource,interpreter:this._kernelConnectionMetadata.interpreter}),[o,s,a]=await Promise.all([i,kH.pathExists(e),this.kernelEnvVarsService.getEnvironmentVariables(this.resource,this._kernelConnectionMetadata.interpreter,this._kernelConnectionMetadata.kernelSpec,t)]);if(Cn.throwIfCanceled(t),Ty.platform()==="win32"){a=a||process.env;try{let c=await this.getWin32InterruptHandle();a.JPY_INTERRUPT_EVENT=`${c}`,te(`Got interrupt handle kernel id ${c} for interpreter ${this._kernelConnectionMetadata.interpreter.id}`)}catch(c){C(`Failed to get interrupt handle kernel id ${this._kernelConnectionMetadata.id} for interpreter ${this._kernelConnectionMetadata.interpreter.id}`,c)}}Cn.throwIfCanceled(t);let l=this.launchKernelSpec.argv.slice(1);this.jupyterSettings.enablePythonKernelLogging&&l.push("--debug"),n=o.execObservable(l,{cwd:s?e:process.cwd(),env:a}),Cn.throwIfCanceled(t)}else{let i=this.launchKernelSpec.argv[0];H(`Launching Raw Kernel ${this.launchKernelSpec.display_name} # ${i}`);let[o,s]=await Promise.all([this.processExecutionFactory.create(this.resource,t),this.kernelEnvVarsService.getEnvironmentVariables(this.resource,this._kernelConnectionMetadata.interpreter,this.launchKernelSpec,t)]);Cn.throwIfCanceled(t);let a=this.launchKernelSpec.argv.slice(1);n=o.execObservable(i,a,{env:s,cwd:e})}if(!n.proc)throw new Error("KernelProcess failed to launch");return this._process=n.proc,this._pid=n.proc.pid,n}async getWin32InterruptHandle(){return this.interrupter||(this.interrupter=await this.pythonKernelInterruptDaemon.createInterrupter(this._kernelConnectionMetadata.interpreter,this.resource)),this.interrupter.handle}};g([yr("DS_INTERNAL.RAWKERNEL_PROCESS_LAUNCH")],Dy.prototype,"launch",1),g([p(1,Xu())],Dy.prototype,"launchAsObservable",1);function EH(r){let e=je(r,{trim:!0,removeEmptyEntries:!0});return e.some(t=>t.includes("FutureWarning: Supporting extra quotes around strings is deprecated in traitlets 5.0."))&&e.some(t=>t.trim()==="warn(")&&e.some(t=>t.includes("FutureWarning: Supporting extra quotes around Bytes is deprecated in traitlets 5.0."))?e.filter(t=>!t.endsWith(`FutureWarning: Supporting extra quotes around strings is deprecated in traitlets 5.0. You can use 'hmac-sha256' instead of '"hmac-sha256"' if you require traitlets >=5.`)&&t.trim()!=="warn("&&!t.includes("FutureWarning: Supporting extra quotes around Bytes is deprecated in traitlets 5.0. Use")).join(Ty.EOL):r}var jH="kernelLauncherPortStart_{0}.tmp",Ko=class{constructor(e,t,n,i,o,s,a,l,c,u){this.processExecutionFactory=e;this.fs=t;this.extensionChecker=n;this.kernelEnvVarsService=i;this.disposables=o;this.pythonExecFactory=s;this.configService=a;this.jupyterPaths=l;this.pythonKernelInterruptDaemon=c;this.platformService=u}static async cleanupStartPort(){try{let e=await Ko.startPortPromise;w(`Cleaning up port start file : ${e}`);let t=Ue(xF.tmpdir(),rl(jH,e.toString()));await QT.remove(t)}catch(e){J("Kernel port mutex failed to cleanup: ",e)}}static async computeStartPort(){if(Pr()){let e=9e3,t=0;for(;t===0&&e<65e3;)try{let n=Ue(xF.tmpdir(),rl(jH,e.toString()));await QT.open(n,"wx"),t=e}catch{e+=1e3}return w(`Computed port start for KernelLauncher is : ${t}`),t}else return 9e3}async launch(e,t,n,i,o){let s=new $e,a=(async()=>(this.logIPyKernelPath(n,e,o).catch(m),await this.launchProcess(e,n,i,t,o)))();return a.then(()=>R("DS_INTERNAL.KERNEL_LAUNCHER_PERF",{duration:s.elapsedTime},{resourceType:io(n)})).catch(m),a}async logIPyKernelPath(e,t,n){let i=t.interpreter;if(!mt(t)||!Vt(t)||!i)return;let s=await(await this.pythonExecFactory.createActivatedEnvironment({interpreter:i,resource:e})).exec(["-c",'import ipykernel; print(ipykernel.__version__); print("5dc3a68c-e34e-4080-9c3e-2a532b2ccb4d"); print(ipykernel.__file__)'],{token:n});if(n.isCancellationRequested)return;let a=W(i.uri);if(s.stdout){let l=s.stdout.trim().split("5dc3a68c-e34e-4080-9c3e-2a532b2ccb4d").map(c=>c.trim()).filter(c=>c.length>0);l.length===2?w(`ipykernel version & path ${l[0]}, ${Jc(l[1])} for ${a}`):w(`ipykernel version & path ${s.stdout.trim()} for ${a}`)}if(s.stderr){let l=je(s.stderr.trim(),{removeEmptyEntries:!0,trim:!0}).map((c,u)=>u===0?c:`    ${c}`).join(`
`);J(`Stderr output when getting ipykernel version & path ${l} for ${a}`)}}async launchProcess(e,t,n,i,o){let s=await pr(o,this.getKernelConnection(e)),a=t?Te(t.fsPath):"",l=this.configService.getSettings(t),c=l.logKernelOutputSeparately||l.development?YT.window.createOutputChannel(y.kernelConsoleOutputChannel(a),"log"):void 0;c?.clear();let u=new Dy(this.processExecutionFactory,s,e,this.fs,t,this.extensionChecker,this.kernelEnvVarsService,this.pythonExecFactory,c,l,this.jupyterPaths,this.pythonKernelInterruptDaemon,this.platformService);u.exited(()=>c?.dispose(),this,this.disposables);try{await pr(o,u.launch(n,i,o))}catch(f){throw await u.dispose(),Cn.throwIfCanceled(o),f}let d=u.exited(({exitCode:f,reason:h})=>{Rt(t,"DS_INTERNAL.RAWKERNEL_SESSION_KERNEL_PROCESS_EXITED",f?{exitCode:f}:void 0,{exitReason:Kh(h)}),No.delete(s.control_port),No.delete(s.hb_port),No.delete(s.iopub_port),No.delete(s.shell_port),No.delete(s.stdin_port),d.dispose()},this,this.disposables);if(o?.isCancellationRequested)throw await u.dispose(),new YT.CancellationError;return u}async chainGetConnectionPorts(){return this.portChain&&await this.portChain,this.portChain=this.getConnectionPorts(),this.portChain}static async findNextFreePort(e){let n=await(0,VH.promisify)((await Promise.resolve().then(()=>k(WH()))).getPorts)(5,{host:"127.0.0.1",port:e});if(n.some(i=>No.has(i))){let i=Math.max(...No,...n);return Ko.findNextFreePort(i)}return n.forEach(i=>No.add(i)),n}async getConnectionPorts(){let e=await Ko.startPortPromise;return Ko.findNextFreePort(e)}async getKernelConnection(e){let t=await this.chainGetConnectionPorts();return{key:(0,BH.default)(),signature_scheme:"hmac-sha256",transport:"tcp",ip:"127.0.0.1",hb_port:t[0],control_port:t[1],shell_port:t[2],stdin_port:t[3],iopub_port:t[4],kernel_name:e.kernelSpec?.name||"python"}}};Ko.startPortPromise=Ko.computeStartPort(),g([Br("Failed to capture IPyKernel version and path")],Ko.prototype,"logIPyKernelPath",1),Ko=g([(0,ls.injectable)(),p(0,(0,ls.inject)(Vi)),p(1,(0,ls.inject)(Or)),p(2,(0,ls.inject)(ze)),p(3,(0,ls.inject)(Aa)),p(4,(0,ls.inject)(O)),p(5,(0,ls.inject)(Hr)),p(6,(0,ls.inject)(se)),p(7,(0,ls.inject)(rn)),p(8,(0,ls.inject)(fu)),p(9,(0,ls.inject)(Ir))],Ko);var t4=k(require("vscode")),af=k(A());var XT=class extends dy{constructor(t,n,i){super("localRaw",t);this.resource=n;this.kernelConnectionMetadata=i;this.initializeKernelSocket()}get atleastOneCellExecutedSuccessfully(){return this.session.atleastOneCellExecutedSuccessfully}get status(){return this.terminatingStatus&&!this.isDisposed?this.terminatingStatus:this.isDisposed?"dead":this.session.kernel?this.session.kernel.status:(te(`Real kernel is ${this.session.kernel?"defined":"undefined"}`),"unknown")}dispose(){this.disposeAsync().catch(m)}async disposeAsync(){await this.shutdown().catch(m).finally(()=>this.session.dispose()).finally(()=>super.dispose())}async waitForIdle(t,n){try{await py(this.kernelConnectionMetadata,this.resource,this.session,t,n)}catch(i){throw te("Error waiting for idle",i),await this.shutdown().catch(m),i}}async shutdown(){if(this._isDisposed)return;this._isDisposed=!0,this.terminatingStatus="terminating",this.statusChanged.emit("terminating");let t=`${this.session.kernel?.id}, ${this.kernelConnectionMetadata?.id}`;w(`Shutdown session ${t} - start called from ${new Error("").stack}`),uy(this.session.kernel),await Dr(1e3,this.session.shutdown().catch(m)),this.didShutdown.fire(),super.dispose(),w(`Shutdown session ${t} - shutdown complete`)}};var Va=k(lT()),e4=k(po());var i_=k(po());var n_=k(HH()),ZH=k(po());var hu=k(ql());var e_=k(require("os"));var GH=k(ql()),EF=k(require("os"));var Fge=["AlmaLinux","Alt","Amazon","Arch","ArchLinux","Asahi","Asahi Linux","Asianux","Alpine","Berry","BlackArch","BlackArch Linux","Cent","CentOS","Clear","Clear Linux","Clear","ClearOS","Debian","Elementary","Endeavour","EndeavourOS","Easy","EasyOS","Fedora","Fermi","Fuduntu","FreeBSD","Gecko","Gentoo","Kali","KDE","Knoppix","Kubuntu","Linux","LinuxMint","Mageia","Manjaro","Mint","Miracle","MX","MX Linux","Navy","Navy Linux","Nitrux","NixOS","openSUSE","Oracle","Pop!_OS","RasPiOS","Raspbian","Red Hat Enterprise Linux","Red Hat Linux","Red Hat","Rocks","Rocky","Rocky Linux","Rosa","Scientific","Scientific Linux","Slackware","SmartOS","SUSE","SUSE Linux","SUSE Liberty Linux","Ubuntu","VZLinux","Xubuntu","Zorin"],Lge=new RegExp(/^[0-9 .]*$/);async function zH(){let r={id:"",version_id:""};if(EF.platform()==="darwin"||EF.platform()==="win32")return r;try{let e=await GH.readFile("/etc/os-release","utf-8");je(e).forEach(t=>{let n=t.toUpperCase().trim().startsWith("ID="),i=t.toUpperCase().trim().startsWith("VERSION_ID=");if(n||i){let o=t.substring(t.indexOf("=")+1).replace(/"/g,"").toUpperCase();if(n)r.id=Fge.filter(s=>o.includes(s.toUpperCase())).join(", ");else{let s=parseFloat(o)||"";r.version_id=Lge.test(o)?o:s.toString()}}})}catch(e){C("Failed to read distro info",e)}return r}var Uge="zeromq";function t_(){try{let r=require(Uge);return r.context.blocky=!1,wF(!1).catch(m),r}catch(r){try{let e=require(Ue(Xo,"dist","node_modules","zeromqold"));return H("ZMQ loaded via fallback mechanism."),wF(!1,!0,r.message||r.toString()).catch(m),e}catch(e){throw wF(!0,!0,r.message||r.toString(),e.message||e.toString()).catch(m),J("Exception while attempting zmq :",r.message||r),J("Exception while attempting zmq (fallback) :",e.message||e),e}}}async function Wge(){try{let r=Ue(Xo,"dist","node_modules","zeromq","prebuilds");if(!await hu.pathExists(Ue(Xo,"dist","node_modules")))return;let e=await hu.readdir(r).then(n=>n.map(async i=>{let o=Ue(r,i);return(await hu.stat(o)).isDirectory()?hu.readdir(o).then(a=>a.map(l=>Ue(o,l))):[]}));return(await Promise.all(e.flat())).flat().map(n=>n.substring(n.lastIndexOf("prebuilds")+9+1).replace(/\\/g,"<sep>").replace(/\//g,"<sep>"))}catch(r){return J("Failed to determine local zmq binaries.",r),["Failed to determine local zmq binaries."]}}var QH=!1;async function wF(r,e=!1,t="",n=""){if(QH)return;QH=!0;let[i,o]=await Promise.all([zH().catch(()=>({id:"",version_id:""})),Wge()]),s=jge();R("DS_INTERNAL.JUPYTER_ZMQ_SUPPORT",void 0,{distro_id:i.id,distro_version_id:i.version_id,failed:r,fallbackTried:e,alpine:s.alpine,libc:s.libc,armv:s.armv,zmqarch:s.zmqarch}),R("DS_INTERNAL.JUPYTER_ZMQ_SUPPORT_FAILURE",void 0,{distro_id:i.id,distro_version_id:i.version_id,failed:r,fallbackTried:e,alpine:s.alpine,libc:s.libc,armv:s.armv,zmqarch:s.zmqarch,errorMessage:t,zmqBinaries:o,fallbackErrorMessage:n})}function YH(r){return r==="linux"&&hu.existsSync("/etc/alpine-release")}function jge(){try{let r=process.config&&process.config.variables||{},t=(process.env.npm_config_arch||"").trim()||e_.arch(),n=process.env.npm_config_platform||e_.platform(),i=YH(n),o=process.env.LIBC||(YH(n)?"musl":"glibc"),s=process.env.ARM_VERSION||(t==="arm64"?"8":r.arm_version)||"";return{alpine:i,libc:String(o),armv:String(s),zmqarch:t}}catch(r){return J("Failed to determine platform information used to load zeromq binary.",r),{}}}function Vge(r,e){let t=r.transport==="tcp"?":":"-",n=r[`${e}_port`];if(!n)throw new Error(`Port not found for channel "${e}"`);return`${r.transport}://${r.ip}${t}${n}`}var r_=class{constructor(e,t){this.connection=e;this.serialize=t;this.onopen=m;this.onerror=m;this.onclose=m;this.onmessage=m;this.receiveHooks=[];this.sendHooks=[];this.msgChain=Promise.resolve();this.sendChain=Promise.resolve();this.closed=!1;this.channels=this.generateChannels(e)}dispose(){this.closed||this.close()}close(){this.closed=!0;let e=t=>{try{t.close()}catch(n){C("Error during socket shutdown",n)}};e(this.channels.control),e(this.channels.iopub),e(this.channels.shell),e(this.channels.stdin)}emit(e,...t){switch(e){case"message":this.onmessage({data:t[0],type:"message",target:this});break;case"close":this.onclose({wasClean:!0,code:0,reason:"",target:this});break;case"error":this.onerror({error:"",message:"to do",type:"error",target:this});break;case"open":this.onopen({target:this});break;default:break}return!0}send(e,t){this.sendMessage(e,!1)}addReceiveHook(e){this.receiveHooks.push(e)}removeReceiveHook(e){this.receiveHooks=this.receiveHooks.filter(t=>t!==e)}addSendHook(e){this.sendHooks.push(e)}removeSendHook(e){this.sendHooks=this.sendHooks.filter(t=>t!==e)}generateChannel(e,t,n){let i=n();return i.connect(Vge(e,t)),this.processSocketMessages(t,i).catch(C.bind(`Failed to read messages from channel ${t}`)),i}async processSocketMessages(e,t){for await(let n of t){if(this.closed)break;this.onIncomingMessage(e,n)}}generateChannels(e){let t=t_(),n=(0,ZH.default)(),i={iopub:this.generateChannel(e,"iopub",()=>new t.Subscriber({maxMessageSize:-1,receiveHighWaterMark:0})),shell:this.generateChannel(e,"shell",()=>new t.Dealer({routingId:n,sendHighWaterMark:0,receiveHighWaterMark:0,maxMessageSize:-1})),control:this.generateChannel(e,"control",()=>new t.Dealer({routingId:n,sendHighWaterMark:0,receiveHighWaterMark:0,maxMessageSize:-1})),stdin:this.generateChannel(e,"stdin",()=>new t.Dealer({routingId:n,sendHighWaterMark:0,receiveHighWaterMark:0,maxMessageSize:-1}))};return i.iopub.subscribe(),i}onIncomingMessage(e,t){let n=this.closed?{}:n_.decode(t,this.connection.key,this.connection.signature_scheme);n.channel=e,this.receiveHooks.length?this.msgChain=this.msgChain.then(()=>{let i=this.serialize(n);return Promise.all(this.receiveHooks.map(o=>o(i)))}).then(()=>this.fireOnMessage(n,e)):this.msgChain=this.msgChain.then(()=>this.fireOnMessage(n,e))}fireOnMessage(e,t){if(!this.closed)try{qge(e,t),this.onmessage({data:e,type:"message",target:this})}catch(n){C(`Failed to handle message in Jupyter Kernel package ${JSON.stringify(e)}`,n)}}sendMessage(e,t){let n=n_.encode(e,this.connection.key,this.connection.signature_scheme);if(!t&&this.sendHooks.length){let i=this.serialize(e);this.sendChain=this.sendChain.then(()=>Promise.all(this.sendHooks.map(o=>o(i,m)))).then(()=>this.postToSocket(e.channel,n))}else this.sendChain=this.sendChain.then(()=>{this.postToSocket(e.channel,n)});this.sendChain.catch(m)}postToSocket(e,t){let n=this.channels[e];n?n.send(t).catch(i=>{C("Error communicating with the kernel",i)}):C(`Attempting to send message on invalid channel: ${e}`)}},Bge=["username","version","session","msg_id","msg_type"],XH={stream:{name:"string",text:"string"},display_data:{data:"object",metadata:"object"},execute_input:{code:"string",execution_count:"number"},execute_result:{execution_count:"number",data:"object",metadata:"object"},error:{ename:"string",evalue:"string",traceback:"object"},status:{execution_state:["string",["starting","idle","busy","restarting","dead"]]},clear_output:{wait:"boolean"},comm_open:{comm_id:"string",target_name:"string",data:"object"},comm_msg:{comm_id:"string",data:"object"},comm_close:{comm_id:"string"},shutdown_reply:{restart:"boolean"}};function qge(r,e){let t=r.header;Bge.forEach(n=>{typeof t[n]!="string"&&(t[n]="")}),typeof r.channel!="string"&&(r.channel=e),r.content||(r.content={}),r.metadata||(r.metadata={}),r.channel==="iopub"&&Jge(r)}function Jge(r){if(r.channel!=="iopub")return;let e=r.header.msg_type;if(e in XH){let t=XH[e];if(t===void 0)return;let n=Object.keys(t),i=r.content;for(let o=0;o<n.length;o++){let s=t[n[o]];Array.isArray(s)||(s=[s]);let a=n[o];if(!(a in i)||typeof i[a]!==s[0])switch(s[0]){case"string":i[a]="";break;case"boolean":i[a]=!1;break;case"object":i[a]={};break;case"number":i[a]=0;break}}}}var pd=k(lT()),Ay=require("vscode");var kF,o_=class{constructor(e,t,n,i,o){this.resource=e;this.kernelLauncher=t;this.workingDirectory=n;this.launchTimeout=i;this.kernelConnectionMetadata=o;this.statusChanged=new pd.Signal(this);this.connectionStatusChanged=new pd.Signal(this);this.iopubMessage=new pd.Signal(this);this.unhandledMessage=new pd.Signal(this);this.anyMessage=new pd.Signal(this);this.disposed=new pd.Signal(this);this.id=(0,i_.default)();this.clientId=(0,i_.default)();this.username=(0,i_.default)();this.infoDeferred=pe();this.name=Zh(o)||"python3",this.model={name:this.name,id:this.id}}get connectionStatus(){return this.realKernel?this.realKernel.connectionStatus:"connecting"}get serverSettings(){return this.realKernel.serverSettings}get status(){return this.isDisposed||this.hasShutdown?"dead":this.isRestarting?"restarting":this.isShuttingDown?"terminating":this.realKernel?this.realKernel.status:"starting"}get info(){return this.realKernel?this.realKernel.info:this.infoDeferred.promise}get handleComms(){return this.realKernel.handleComms}get isDisposed(){return this._isDisposed||this.realKernel?.isDisposed===!0}async restart(){this.stopHandlingKernelMessages(),this._isDisposed=!1,this.isShuttingDown=!1,this.hasShutdown=!1,this.isRestarting=!0,this.restartToken=new Ay.CancellationTokenSource;try{this.statusChanged.emit("restarting"),await this.start(this.restartToken.token)}finally{this.restartToken.dispose()}}async start(e){let t=[],n=kk(e);t.push(n);try{let i=this.kernelProcess;this.kernelProcess=void 0,i?.dispose()?.catch(m),kn(()=>this.socket?.dispose()),kn(()=>this.realKernel?.dispose());let o=this.kernelProcess=await ft.wrapAndReportProgress(this.resource,y.connectingToKernel(gt(this.kernelConnectionMetadata)),()=>this.kernelLauncher.launch(this.kernelConnectionMetadata,this.launchTimeout,this.resource,this.workingDirectory.fsPath,e));if(e.isCancellationRequested)throw new Ay.CancellationError;this.hookupKernelProcessExitHandler(o);let s=Hge(this.kernelProcess,this.clientId,this.username,this.model);this.kernelProcess=s.kernelProcess,this.realKernel=s.realKernel,this.socket=s.socket,s.realKernel.info.then(l=>this.infoDeferred.resolve(l),l=>this.infoDeferred.reject(l));let a=setTimeout(()=>n.cancel(),this.launchTimeout);if(t.push({dispose:()=>clearTimeout(a)}),await ft.wrapAndReportProgress(this.resource,y.waitingForJupyterSessionToBeIdle,()=>$ge(n.token,this.launchTimeout,this.resource,this.kernelConnectionMetadata,s.realKernel)),e.isCancellationRequested)throw new Ay.CancellationError;this.startHandleKernelMessages(),this.isRestarting=!1,this.statusChanged.emit(this.status)}catch(i){throw await Promise.all([this.kernelProcess?.dispose().catch(m),this.realKernel?.shutdown().catch(o=>J(`Failed to shutdown kernel, ${this.kernelConnectionMetadata.id}`,o))]),br(i)&&n.token.isCancellationRequested&&!e.isCancellationRequested?new jm(this.kernelConnectionMetadata):(br(i)||e.isCancellationRequested?w("Starting of raw session cancelled by user"):C(`Failed to connect raw kernel session: ${i}`),i)}finally{G(t)}}hookupKernelProcessExitHandler(e){let t=this.exitHandler;this.exitHandler=void 0,t?.dispose(),this.exitHandler=e.exited(n=>{e!==this.kernelProcess||this.isDisposing||!this.kernelProcess||this.status==="dead"||this.status==="terminating"||(C(`Disposing session as kernel process died ExitCode: ${n.exitCode}, Reason: ${n.reason}`),Rt(this.resource,"DS_INTERNAL.RAWKERNEL_SESSION_KERNEL_PROCESS_EXITED",n.exitCode?{exitCode:n.exitCode}:void 0,{exitReason:Kh(n.reason)}),this.shutdown().catch(m))},this)}dispose(){this.isDisposed||this.isDisposing||(this.isDisposing=!0,this.shutdown().finally(()=>{this._isDisposed=!0,this.disposed.emit(),pd.Signal.disconnectAll(this)}).catch(m))}async shutdown(){this.isShuttingDown||this.hasShutdown||(this.isShuttingDown=!0,this.restartToken?.cancel(),this.restartToken?.dispose(),uy(this.realKernel),await this.kernelProcess?.dispose().catch(m),this.socket.dispose(),this.stopHandlingKernelMessages(),this.isShuttingDown=!1,this.hasShutdown=!0,this.isDisposing&&(this._isDisposed=!0),this.statusChanged.emit(this.status),this.connectionStatusChanged.emit("disconnected"))}createComm(e,t){return this.realKernel.createComm(e,t)}hasComm(e){return this.realKernel.hasComm(e)}clone(e){return this}get spec(){if(eg(this.kernelConnectionMetadata)){let e=JSON.parse(JSON.stringify(this.kernelConnectionMetadata.kernelSpec)),t="resources"in e?e.resources:{};return{...e,resources:t}}return C("Fetching kernel spec from raw kernel using JLab API"),this.realKernel.spec}sendShellMessage(e,t,n){return this.realKernel.sendShellMessage(e,t,n)}sendControlMessage(e,t,n){return this.realKernel.sendControlMessage(e,t,n)}reconnect(){throw new Error("Reconnect is not supported for Local Kernels as connections cannot be lost.")}async interrupt(){if(this.kernelProcess?.canInterrupt)return this.kernelProcess?.interrupt();if(this.kernelConnectionMetadata.kernelSpec.interrupt_mode==="message"){H("Interrupting kernel with a shell message");let t=require("@jupyterlab/services").KernelMessage.createMessage({msgType:"interrupt_request",channel:"shell",username:this.realKernel.username,session:this.realKernel.clientId,content:{}});await this.realKernel.sendShellMessage(t,!0,!0).done.catch(n=>C("Failed to interrupt via a message",n))}else C("Kernel interrupt not supported")}requestKernelInfo(){return this.realKernel.requestKernelInfo()}requestComplete(e){return this.realKernel.requestComplete(e)}requestInspect(e){return this.realKernel.requestInspect(e)}requestHistory(e){return this.realKernel.requestHistory(e)}requestExecute(e,t,n){return this.realKernel.requestExecute(e,t,n)}requestDebug(e,t){return this.realKernel.requestDebug(e,t)}requestIsComplete(e){return this.realKernel.requestIsComplete(e)}requestCommInfo(e){return this.realKernel.requestCommInfo(e)}sendInputReply(e){return this.realKernel.sendInputReply(e)}registerCommTarget(e,t){return this.realKernel.registerCommTarget(e,t)}removeCommTarget(e,t){return this.realKernel.removeCommTarget(e,t)}registerMessageHook(e,t){this.realKernel.registerMessageHook(e,t)}removeMessageHook(e,t){this.realKernel.removeMessageHook(e,t)}startHandleKernelMessages(){this.realKernel.anyMessage.connect(this.onAnyMessage,this),this.realKernel.iopubMessage.connect(this.onIOPubMessage,this),this.realKernel.unhandledMessage.connect(this.onUnhandledMessage,this),this.realKernel.statusChanged.connect(this.onStatusChanged,this),this.realKernel.disposed.connect(this.onDisposed,this)}stopHandlingKernelMessages(){this.realKernel.anyMessage.disconnect(this.onAnyMessage,this),this.realKernel.iopubMessage.disconnect(this.onIOPubMessage,this),this.realKernel.unhandledMessage.disconnect(this.onUnhandledMessage,this),this.realKernel.statusChanged.disconnect(this.onStatusChanged,this),this.realKernel.disposed.disconnect(this.onDisposed,this)}onAnyMessage(e,t){this.anyMessage.emit(t)}onIOPubMessage(e,t){this.iopubMessage.emit(t)}onUnhandledMessage(e,t){this.unhandledMessage.emit(t)}onStatusChanged(e,t){this.statusChanged.emit(t)}onDisposed(e){this.disposed.emit()}};async function $ge(r,e,t,n,i){try{w("Waiting for Raw Session to be ready in postStartRawSession"),await pr(r,Gge(i,n,e)),w("Successfully waited for Raw Session to be ready in postStartRawSession")}catch(a){throw C("Failed waiting for Raw Session to be ready",a),br(a)||r.isCancellationRequested?new Ay.CancellationError:a}w(`Kernel status is '${i?.status}' before requesting kernel info and after ready`);let o=pe(),s=()=>o.resolve(!0);i.iopubMessage.connect(s);try{let a=new $e,l=1;for(let c=1;c<=2;c++){try{w("Sending request for kernelInfo"),await pr(r,Promise.all([i.requestKernelInfo(),o.promise]),Vn(Math.min(e,1500)).then(m))}catch(u){throw C("Failed to request kernel info",u),u}if(o.completed){w("Got response for requestKernelInfo");break}else{w("Did not get a response for requestKernelInfo");continue}}o.completed?w("Successfully completed postStartRawSession"):J(`Didn't get response for requestKernelInfo after ${a.elapsedTime}ms.`),Rt(t,"DS_INTERNAL.RAWKERNEL_INFO_RESPONSE",{duration:a.elapsedTime,attempts:l},{timedout:!o.completed})}finally{i.iopubMessage.disconnect(s)}}function Hge(r,e,t,n){let i=require("@jupyterlab/services"),o=require("@jupyterlab/services/lib/kernel/serialize"),s;class a extends r_{constructor(){super(r.connection,o.serialize),s=this}}let l=i.ServerConnection.makeSettings({WebSocket:a,wsUrl:"RAW"});kF||(kF=require("@jupyterlab/services/lib/kernel/nonSerializingKernel"));let c=new kF.KernelConnection({serverSettings:l,clientId:e,handleComms:!0,username:t,model:n});return mo.set(c.id,s),s.emit("open"),{realKernel:c,socket:s,kernelProcess:r}}async function Gge(r,e,t){w(`Waiting for Raw session to be ready, status: ${r.connectionStatus}`);let n=pe(),i=(s,a)=>{a=="connected"?(w("Raw session connected"),n.resolve(a)):w(`Raw session not connected, status: ${a}`)};r.connectionStatusChanged.connect(i),r.connectionStatus==="connected"&&(w("Raw session connected"),n.resolve(r.connectionStatus)),w("Waiting for Raw session to be ready");let o=await Dr(t,n.promise);if(r.connectionStatusChanged.disconnect(i),w(`Waited for Raw session to be ready & got status: ${o}`),o!=="connected")throw new jm(e)}var s_=class{constructor(e,t,n,i,o,s){this.resource=e;this.kernelConnectionMetadata=i;this.type=s;this.isDisposed=!1;this.statusChanged=new Va.Signal(this);this.kernelChanged=new Va.Signal(this);this.terminated=new Va.Signal(this);this.iopubMessage=new Va.Signal(this);this.unhandledMessage=new Va.Signal(this);this.anyMessage=new Va.Signal(this);this.disposed=new Va.Signal(this);this.connectionStatusChanged=new Va.Signal(this);this.propertyChanged=new Va.Signal(this);this._didShutDownOnce=!1;this.id=(0,e4.default)(),this.name=Zh(this.kernelConnectionMetadata)||"python3",this.path=this.resource?.fsPath||this.kernelConnectionMetadata.interpreter?.uri.fsPath||"kernel_path",this._kernel=new o_(e,t,n,o,i),this._kernel.statusChanged.connect(this.onKernelStatus,this),this._kernel.iopubMessage.connect(this.onIOPubMessage,this),this._kernel.connectionStatusChanged.connect(this.onKernelConnectionStatus,this),this._kernel.unhandledMessage.connect(this.onUnhandledMessage,this),this._kernel.anyMessage.connect(this.onAnyMessage,this),this._kernel.disposed.connect(this.onDisposed,this)}get atleastOneCellExecutedSuccessfully(){return this.cellExecutedSuccessfully===!0}get jupyterLabServices(){return this._jupyterLabServices||(this._jupyterLabServices=require("@jupyterlab/services")),this._jupyterLabServices}get connectionStatus(){return this._kernel?.connectionStatus||"disconnected"}get serverSettings(){return require("@jupyterlab/services").ServerConnection.makeSettings({wsUrl:"RAW"})}get model(){return{id:this.id,name:this.name,path:this.path,type:"notebook",kernel:{id:this._kernel?.id,name:this.name}}}get status(){return this.isDisposed?"dead":this.isTerminating?"terminating":this.kernel?.status??"unknown"}get kernel(){return this._kernel}async startKernel(e){await uo(this.resource,{kernelConnection:this.kernelConnectionMetadata}),await this._kernel.start(e.token)}dispose(){this._isDisposing=!0;let e=new Error().stack;Rt(this.resource,"DS_INTERNAL.RAWKERNEL_SESSION_DISPOSED",void 0,{stacktrace:e});try{this._kernel.statusChanged.disconnect(this.onKernelStatus,this),this._kernel.iopubMessage.disconnect(this.onIOPubMessage,this),this._kernel.connectionStatusChanged.disconnect(this.onKernelConnectionStatus,this),this._kernel.unhandledMessage.disconnect(this.onUnhandledMessage,this),this._kernel.anyMessage.disconnect(this.onAnyMessage,this),this._kernel.disposed.disconnect(this.onDisposed,this)}catch{}this.shutdown().catch(m).finally(()=>{this._kernel.dispose(),this.isDisposed=!0,this.disposed.emit(),Va.Signal.disconnectAll(this)})}async shutdown(){this._didShutDownOnce||(this._didShutDownOnce=!0,this.isTerminating=!0,this.statusChanged.emit("terminating"),await this._kernel.shutdown().catch(e=>J(`Failed to shutdown kernel, ${this.kernelConnectionMetadata.id}`,e)),this.isTerminating=!1,this._isDisposing&&(this.isDisposed=!0),this.terminated.emit(),this.statusChanged.emit(this.status))}onKernelStatus(e,t){te(`RawSession status changed to ${t}`),this.statusChanged.emit(t)}setPath(e){throw new Error("Not yet implemented")}setName(e){throw new Error("Not yet implemented")}setType(e){throw new Error("Not yet implemented")}changeKernel(e){throw new Error("Not yet implemented")}onIOPubMessage(e,t){!this.cellExecutedSuccessfully&&t.header.msg_type==="execute_result"&&t.content&&(this.jupyterLabServices.KernelMessage.isExecuteResultMsg(t)||this.jupyterLabServices.KernelMessage.isExecuteInputMsg(t))&&t.content.execution_count&&(this.cellExecutedSuccessfully=!0),this.iopubMessage.emit(t)}onAnyMessage(e,t){this.anyMessage.emit(t)}onUnhandledMessage(e,t){this.unhandledMessage.emit(t)}onKernelConnectionStatus(e,t){this.connectionStatusChanged.emit(t)}onDisposed(e){this.disposed.emit()}};var My=class{constructor(e,t,n,i){this.configService=e;this.workspaceService=t;this.kernelLauncher=n;this.sessions=new Set;this.disposables=[];this.disposed=!1;i.push(this)}dispose(){this.disposed||(this.disposed=!0,Array.from(this.sessions.values()).map(e=>e.shutdown().catch(m).finally(()=>e.dispose())),G(this.disposables))}async create(e){w(`Creating raw notebook for resource '${W(e.resource)}'`);let t,[n]=await Promise.all([pr(e.token,this.workspaceService.computeWorkingDirectory(e.resource).then(s=>t4.Uri.file(s))),pr(e.token,uo(e.resource,{kernelConnection:e.kernelConnection}))]),i=this.configService.getSettings(e.resource).jupyterLaunchTimeout;t=new s_(e.resource,this.kernelLauncher,n,e.kernelConnection,i,(e.resource?.path||"").toLowerCase().endsWith(".ipynb")?"notebook":"console");try{await pr(e.token,t.startKernel(e))}catch(s){throw br(s)||e.token.isCancellationRequested?w("Starting of raw session cancelled by user"):C(`Failed to connect raw kernel session: ${s}`),t?.shutdown().catch(a=>C(`Failed to dispose of raw session on launch error: ${a} `)).finally(()=>t?.dispose()).catch(m),s}let o=new XT(t,e.resource,e.kernelConnection);return o.onDidDispose(()=>this.sessions.delete(o),this,this.disposables),this.sessions.add(o),o}};My=g([(0,af.injectable)(),p(0,(0,af.inject)(se)),p(1,(0,af.inject)(ce)),p(2,(0,af.inject)(_D)),p(3,(0,af.inject)(O))],My);var a_=k(A());var Oy=class{constructor(e){this.configuration=e}get isSupported(){return this.isSupportedForLocalLaunch()}isSupportedForLocalLaunch(){return!this.isZQMDisabled()&&this.zmqSupported()}isZQMDisabled(){return this.configuration.getSettings().disableZMQSupport}zmqSupported(){if(typeof this._isSupported=="boolean")return this._isSupported;if((process.env.VSC_JUPYTER_NON_RAW_NATIVE_TEST||"").toLowerCase()==="true")return!1;try{t_(),this._isSupported=!0}catch{this._isSupported=!1}return this._isSupported}};Oy=g([(0,a_.injectable)(),p(0,(0,a_.inject)(se))],Oy);var gu=k(A()),r4=require("vscode");var pi=Symbol("IJupyterVariables"),l_=Symbol("IKernelVariableRequester");var lf=class{constructor(e,t,n){this.kernelVariables=t;this.debuggerVariables=n;this.refreshEventEmitter=new r4.EventEmitter;e.push(n.refreshRequired(this.fireRefresh.bind(this))),e.push(t.refreshRequired(this.fireRefresh.bind(this)))}get refreshRequired(){return this.refreshEventEmitter.event}async getVariables(e,t){return this.variableHandler.getVariables(e,t)}async getFullVariable(e,t){return this.variableHandler.getFullVariable(e,t)}async getMatchingVariable(e,t,n){return this.variableHandler.getMatchingVariable(e,t,n)}async getDataFrameInfo(e,t,n,i){return this.variableHandler.getDataFrameInfo(e,t,n,i)}async getDataFrameRows(e,t,n,i,o){return this.variableHandler.getDataFrameRows(e,t,n,i,o)}get variableHandler(){return this.debuggerVariables.active?this.debuggerVariables:this.kernelVariables}fireRefresh(){this.refreshEventEmitter.fire()}};g([yr("DS_INTERNAL.VARIABLE_EXPLORER_FETCH_TIME")],lf.prototype,"getVariables",1),lf=g([(0,gu.injectable)(),p(0,(0,gu.inject)(O)),p(1,(0,gu.inject)(pi)),p(1,(0,gu.named)(Le.KERNEL_VARIABLES)),p(2,(0,gu.inject)(pi)),p(2,(0,gu.named)(Le.DEBUGGER_VARIABLES))],lf);var vu=k(A()),c_=require("vscode");var zge=/Type:\s*(\w+)/,Qge=/Value:\s*(.*)/,Yge=/String form:\s*([\s\S]+?)\n/,Xge=/Docstring:\s*(.*)/,Zge=/Length:\s+(.*)/,eve=/^\s+\[(\d+) rows x (\d+) columns\]/m,tve=new Set(["DataFrame","list","dict","ndarray","Series","Tensor","EagerTensor","DataArray"]),Ky=class{constructor(e,t,n,i){this.configService=e;this.disposables=n;this.kernelProvider=i;this.variableRequesters=new Map;this.cachedVariables=new Map;this.refreshEventEmitter=new c_.EventEmitter;this.variableRequesters.set(xe,t)}get refreshRequired(){return this.refreshEventEmitter.event}async getVariables(e,t){return this.getVariablesBasedOnKernel(t,e)}async getMatchingVariable(e,t,n){let i=this.cachedVariables.get(t.uri.toString());if(i){let o=i.variables.find(s=>s.name===e);return o&&!o.value&&(o=await this.getVariableValueFromKernel(o,t,n)),o}else{let o=await this.getVariableNamesAndTypesFromKernel(t,n);if(o){let s=o.find(a=>a.name===e);if(s)return this.getVariableValueFromKernel({name:e,value:void 0,supportsDataExplorer:!1,type:s.type,size:0,count:0,shape:"",truncated:!0},t,n)}}}async getDataFrameInfo(e,t,n,i){if(!t)return e;let o=oo(t?.kernelConnectionMetadata)||xe,s=this.variableRequesters.get(o);if(s){i&&(e=await this.getFullVariable(e,t));let a=e.name;return n&&(a=`${e.name}${n}`),s.getDataFrameInfo(e,t,a)}return e}async getDataFrameRows(e,t,n,i,o){let s=oo(i?.kernelConnectionMetadata)||xe,a=this.variableRequesters.get(s);if(a){let l=e.name;return o&&(l=`${e.name}${o}`),a.getDataFrameRows(t,n,i,l)}return{data:[]}}async getFullVariable(e,t,n){let i=oo(t?.kernelConnectionMetadata)||xe,o=this.variableRequesters.get(i);return o?o.getFullVariable(e,t,n):e}async getVariablesBasedOnKernel(e,t){let n=this.cachedVariables.get(e.uri.toString()),i=this.kernelProvider.getKernelExecution(e).pendingCells.length>0,o=this.kernelProvider.getKernelExecution(e);(!n||!i&&(n.currentExecutionCount!==t.executionCount||n.currentExecutionCount!==o.executionCount))&&(n={currentExecutionCount:o.executionCount,variables:(await this.getVariableNamesAndTypesFromKernel(e)).map(l=>({name:l.name,value:void 0,supportsDataExplorer:!1,type:l.type,size:0,shape:"",count:0,truncated:!0}))});let s=this.configService.getSettings(e.resourceUri).variableExplorerExclude?this.configService.getSettings().variableExplorerExclude?.split(";"):[],a={executionCount:o.executionCount,pageStartIndex:-1,pageResponse:[],totalCount:0,refreshCount:t.refreshCount};if(n){let l=t.sortColumn,c=(f,h)=>{let v=f[l]?f[l]:"",S=h[l]?h[l]:"";return t.sortAscending?v.localeCompare(S,void 0,{sensitivity:"base"}):S.localeCompare(v,void 0,{sensitivity:"base"})};n.variables.sort(c);let u=t.startIndex?t.startIndex:0,d=t.pageSize?t.pageSize:100;a.pageStartIndex=u;for(let f=u;f<u+d&&f<n.variables.length;){if(s&&s.indexOf(n.variables[f].type)>=0){n.variables.splice(f,1);continue}let h=typeof n.variables[f].value=="string"?n.variables[f]:await this.getVariableValueFromKernel(n.variables[f],e);n.variables[f]=h,a.pageResponse.push(h),f+=1}this.cachedVariables.set(e.uri.toString(),n),a.totalCount=n.variables.length}return a}async getVariableProperties(e,t,n){let i=await this.getMatchingVariable(e,t,n),o=oo(t.kernelConnectionMetadata)||xe,s=this.variableRequesters.get(o);return s?s.getVariableProperties(e,n,i):{}}async getVariableNamesAndTypesFromKernel(e,t){let n=oo(e.kernelConnectionMetadata)||xe,i=this.variableRequesters.get(n);return i?i.getVariableNamesAndTypesFromKernel(e,t):[]}inspect(e,t,n=0,i){let o=pe();try{e.requestInspect({code:t,cursor_pos:n,detail_level:0}).then(s=>{s&&s.content.status==="ok"?o.resolve(s.content.data):o.resolve(void 0)}).catch(s=>{o.reject(s)})}catch(s){o.reject(s)}return i&&this.disposables.push(i.onCancellationRequested(()=>o.reject(new c_.CancellationError))),o.promise}async getVariableValueFromKernel(e,t,n){let i={...e};if(!t.disposed&&t.session?.kernel){let o=await this.inspect(t.session.kernel,e.name,0,n);if(o&&o.hasOwnProperty("text/plain")){let s=sc(o["text/plain"].toString()),a=zge.exec(s),l=Zge.exec(s),c=eve.exec(s);a&&(i.type=a[1]),i.value=[Qge,Yge,Xge].reduce((u,d)=>u||d.exec(s)?.[1]||"",""),l&&(i.count=parseInt(l[1],10)),c&&(i.shape=`(${c[1]}, ${c[2]})`)}o&&o.type&&(i.type=o.type.toString()),o&&o.value&&(i.value=o.value.toString()),tve.has(i.type)&&(i.supportsDataExplorer=!0)}return i.type&&i.count&&!i.shape&&Vt(t.kernelConnectionMetadata)&&i.supportsDataExplorer&&i.type!=="list"&&(i=await this.getFullVariable(i,t)),i}};Ky=g([(0,vu.injectable)(),p(0,(0,vu.inject)(se)),p(1,(0,vu.inject)(l_)),p(1,(0,vu.named)(Le.PYTHON_VARIABLES_REQUESTER)),p(2,(0,vu.inject)(O)),p(3,(0,vu.inject)(Ke))],Ky);var uc=k(A());var Fy=class{constructor(e,t,n,i,o,s,a){this.activationService=e;this.jupyterInterpreterService=t;this.disposables=n;this.extensionChecker=i;this.apiProvider=o;this.rawNotebookSupported=s;this.condaService=a}activate(){this.rawNotebookSupported.isSupported||(this.disposables.push(this.jupyterInterpreterService.onDidChangeInterpreter(()=>this.preWarmInterpreterVariables().catch(m))),this.preWarmInterpreterVariables().catch(m),this.apiProvider.onDidActivatePythonExtension(this.preWarmInterpreterVariables,this,this.disposables)),this.extensionChecker.isPythonExtensionInstalled&&(this.condaService.getCondaFile().catch(m),this.condaService.getCondaVersion().catch(m))}async preWarmInterpreterVariables(){if(!this.extensionChecker.isPythonExtensionActive)return;let e=await this.jupyterInterpreterService.getSelectedInterpreter();e&&this.activationService.getActivatedEnvironmentVariables(void 0,e).catch(m)}};Fy=g([(0,uc.injectable)(),p(0,(0,uc.inject)(As)),p(1,(0,uc.inject)(Ei)),p(2,(0,uc.inject)(O)),p(3,(0,uc.inject)(ze)),p(4,(0,uc.inject)(Xt)),p(5,(0,uc.inject)(wi)),p(6,(0,uc.inject)(Ls))],Fy);var OC=k(A());var Ly=class extends tt{constructor(){super("unknown",y.jupyterDataRateExceeded)}};function PF(r){let e=r.index,t=r.columns;return{data:r.data.map((o,s)=>{let a={index:e[s]};return t.forEach((l,c)=>{a[l]=o[c]}),a})}}async function u_(r,{code:e,initializeCode:t,cleanupCode:n},i){if(r.disposed||r.disposing||!r.session?.kernel||!r.session.kernel||r.session.isDisposed)return[];try{return t&&await xn(r.session.kernel,t,i),await xn(r.session.kernel,e,i)}catch(o){if(o instanceof Sn)return[];throw o}finally{n&&await xn(r.session.kernel,n,i)}}var Uy=class{constructor(e,t){this.varScriptGenerator=e;this.dfScriptGenerator=t}async getDataFrameInfo(e,t,n){let{code:i,cleanupCode:o,initializeCode:s}=await this.dfScriptGenerator.generateCodeToGetDataFrameInfo({isDebugging:!1,variableName:n}),a=await u_(t,{code:i,cleanupCode:o,initializeCode:s},{traceErrors:!0,traceErrorsMessage:"Failure in execute_request for getDataFrameInfo",telemetryName:"DATASCIENCE.PYTHON_VARIABLE_FETCHING_CODE_FAILURE"}),l=t.notebook?.uri||t.resourceUri||t.uri;return{...e,...this.deserializeJupyterResult(a),fileName:l}}async getDataFrameRows(e,t,n,i){let{code:o,cleanupCode:s,initializeCode:a}=await this.dfScriptGenerator.generateCodeToGetDataFrameRows({isDebugging:!1,variableName:i,startIndex:e,endIndex:t}),l=await u_(n,{code:o,cleanupCode:s,initializeCode:a},{traceErrors:!0,traceErrorsMessage:"Failure in execute_request for getDataFrameRows",telemetryName:"DATASCIENCE.PYTHON_VARIABLE_FETCHING_CODE_FAILURE"});return PF(this.deserializeJupyterResult(l))}async getVariableProperties(e,t,n){let i={};return n&&n.value&&(i[`${e}`]=n.value),i}async getVariableNamesAndTypesFromKernel(e,t){if(e.session){let{code:n,cleanupCode:i,initializeCode:o}=await this.varScriptGenerator.generateCodeToGetVariableTypes({isDebugging:!1}),s=await u_(e,{code:n,cleanupCode:i,initializeCode:o},{traceErrors:!0,traceErrorsMessage:"Failure in execute_request for getVariableNamesAndTypesFromKernel",telemetryName:"DATASCIENCE.PYTHON_VARIABLE_FETCHING_CODE_FAILURE"});if(e.disposed||e.disposing)return[];let a=this.deserializeJupyterResult(s),l=[];for(let[c,u]of Object.entries(a)){let d={name:c,value:void 0,supportsDataExplorer:!1,type:u||"",size:0,shape:"",count:0,truncated:!0};l.push(d)}return l}return[]}async getFullVariable(e,t,n){let{code:i,cleanupCode:o,initializeCode:s}=await this.varScriptGenerator.generateCodeToGetVariableInfo({isDebugging:!1,variableName:e.name}),a=await u_(t,{code:i,cleanupCode:o,initializeCode:s},{traceErrors:!0,traceErrorsMessage:"Failure in execute_request for getFullVariable",telemetryName:"DATASCIENCE.PYTHON_VARIABLE_FETCHING_CODE_FAILURE"});return{...e,...this.deserializeJupyterResult(a)}}extractJupyterResultText(e){if(e.length>0){let t=e[0];if(t&&t.output_type==="stream"&&t.name==="stderr"&&t.hasOwnProperty("text")){let n=t.text;if(n.includes("iopub_data_rate_limit"))throw new Ly;{let i=y.jupyterGetVariablesExecutionError(n);throw C(i),new Error(i)}}if(t&&t.output_type==="execute_result"){let n=t.data;if(n&&n.hasOwnProperty("text/plain"))return n["text/plain"]}if(t&&t.output_type==="stream"&&t.hasOwnProperty("text"))return t.text;if(t&&t.output_type==="error"&&t.hasOwnProperty("traceback")){let i=t.traceback.map(sc).join(`\r
`),o=y.jupyterGetVariablesExecutionError(i);throw C(o),new Error(o)}}throw new Error(y.jupyterGetVariablesBadResults)}deserializeJupyterResult(e){let t=this.extractJupyterResultText(e);return JSON.parse(t)}};Uy=g([(0,OC.injectable)(),p(0,(0,OC.inject)(_h)),p(1,(0,OC.inject)(Rh))],Uy);var cf=k(A());var i4=require("vscode");var n4=1e3*60*60*24*2,Ba=class extends Mr{constructor(t,n,i,o){super();this.serverStorage=n;this.context=i;this.fs=o;this.executedCells=new WeakMap;this.chainedPromises=Promise.resolve();i.globalStorageUri,t.push(this),this.storageFile=i4.Uri.joinPath(this.context.globalStorageUri,"lastExecutedRemoteCell.json")}activate(){this._register(this.serverStorage.onDidRemove(this.onDidRemoveServers,this))}async getLastTrackedCellExecution(t,n){if(t.isUntitled||!Ft(n.kernelConnectionMetadata)||!n.session?.id)return;if(this.staleState&&this.staleState[t.uri.toString()])return this.staleState[t.uri.toString()];let i=await this.getStorageFile(),o={};try{let s=await this.fs.readFile(i);o=JSON.parse(s.toString()),this.staleState=o}catch{return}return o[t.uri.toString()]}trackCellExecution(t,n){if(!Ft(n.kernelConnectionMetadata)||t.document.isUntitled)return;this.executedCells.delete(t);let i=[],o=(a,l)=>{if(l.direction==="send"){let c=l.msg;if(c.header.msg_type==="execute_request"&&c.metadata&&typeof c.metadata=="object"&&c.metadata&&"cellId"in c.metadata&&typeof c.metadata.cellId=="string"&&c.metadata.cellId===t.document.uri.toString()){let u=c.header.msg_id;this.executedCells.set(t,{msg_id:u,kernelId:n.session?.kernel?.id||"",cellIndex:t.index})}}else if(l.direction==="recv"){let c=l.msg,u=this.executedCells.get(t);if(u?.msg_id&&uu(c)===u.msg_id){if(!u.startTime){u.startTime=new Date().getTime();try{u.startTime=new Date(c.header.date).getTime()}catch{}this.executedCells.set(t,u)}"execution_count"in c.content&&typeof c.content.execution_count=="number"&&!u.executionCount&&u.executionCount!==c.content.execution_count&&(u.executionCount=c.content.execution_count,this.executedCells.set(t,u),this.trackLastExecution(t,n,u),G(i))}}},s=()=>{let a=n.session;a&&(a.anyMessage.connect(o),i.push({dispose:()=>kn(()=>a.anyMessage?.disconnect(o))}))};n.onStarted(()=>s(),i),n.session&&s()}deleteTrackedCellExecution(t,n){t.notebook.isUntitled||!Ft(n.kernelConnectionMetadata)||!n.session?.id||(this.chainedPromises=this.chainedPromises.finally(async()=>{let i={};try{let s=await this.getStorageFile().then(()=>this.fs.readFile(this.storageFile));i=JSON.parse(s.toString())}catch{return}let o=t.notebook.uri.toString();i[o].cellIndex===t.index&&(delete i[o],this.staleState=i,await this.fs.writeFile(this.storageFile,JSON.stringify(i)))}))}getStorageFile(){return this.ensureStorageExistsPromise=this.ensureStorageExistsPromise||(async()=>(await this.fs.createDirectory(this.context.globalStorageUri),this.storageFile))(),this.ensureStorageExistsPromise}trackLastExecution(t,n,i){if(!i.executionCount||!i.msg_id||!i.startTime||!Ft(n.kernelConnectionMetadata)||!n.session?.id)return;let o={cellIndex:t.index,executionCount:i.executionCount,kernelId:n.session?.kernel?.id||"",msg_id:i.msg_id,serverId:$t(n.kernelConnectionMetadata.serverProviderHandle),sessionId:n.session?.id,startTime:i.startTime};this.chainedPromises=this.chainedPromises.finally(async()=>{let s={};try{let l=await this.getStorageFile().then(()=>this.fs.readFile(this.storageFile));s=JSON.parse(l.toString())}catch{}let a=t.notebook.uri.toString();s[a]=o,this.removeOldItems(s),this.staleState=s,await this.fs.writeFile(this.storageFile,JSON.stringify(s))})}onDidRemoveServers(t){t.length!==0&&(this.chainedPromises=this.chainedPromises.finally(async()=>{await this.getStorageFile();let n={};try{let s=await this.fs.readFile(this.storageFile);n=JSON.parse(s.toString())}catch{}let i=!1,o=new Set(t.map(s=>$t(s)));Object.keys(n).forEach(s=>{let a=n[s];(o.has(a.serverId)||Date.now()-a.startTime>n4)&&(delete n[s],i=!0)}),i&&(this.removeOldItems(n),this.staleState=n,await this.fs.writeFile(this.storageFile,JSON.stringify(n)))}))}removeOldItems(t){Object.keys(t).forEach(n=>{let i=t[n];i&&Date.now()-i.startTime>n4&&delete t[n]})}};Ba=g([(0,cf.injectable)(),p(0,(0,cf.inject)(O)),p(1,(0,cf.inject)(cr)),p(2,(0,cf.inject)(dt)),p(3,(0,cf.inject)(Ze))],Ba);var uf=k(A());var o4=require("vscode");var Wy=class{constructor(e,t,n,i){this.commandManager=e;this.serverUriStorage=t;this.registrations=n;this.disposables=i}activate(){this.disposables.push(this.commandManager.registerCommand(V.ClearSavedJupyterUris,async()=>{await this.serverUriStorage.clear().catch(m),await Promise.all(this.registrations.jupyterCollections.filter(e=>e.id.startsWith("_builtin")||e.extensionId===bt).map(async e=>{if(!e.serverProvider||!e.serverProvider.removeJupyterServer)return;let t=new o4.CancellationTokenSource,n=await Promise.resolve(e.serverProvider.provideJupyterServers(t.token));await Promise.all((n||[]).map(i=>e.serverProvider.removeJupyterServer(i).catch(m)))})).catch(m),await this.commandManager.executeCommand("dataScience.ClearUserProviderJupyterServerCache").then(m,m)},this))}};Wy=g([(0,uf.injectable)(),p(0,(0,uf.inject)(Fe)),p(1,(0,uf.inject)(cr)),p(2,(0,uf.inject)(Ut)),p(3,(0,uf.inject)(O))],Wy);var yu=require("vscode");var s4=k(A());var jy=class{activate(){let e=Xe.instance.get(O),t=new qo;e.push(t),e.push(yu.commands.registerCommand("jupyter.manageAccessToKernels",()=>rve(t)))}};jy=g([(0,s4.injectable)()],jy);async function rve(r){let e=await $V(),t=[];Array.from(e.entries()).forEach(([s])=>{let a=yu.extensions.getExtension(s)?.packageJSON?.displayName;a&&t.push({label:a,description:s,extensionId:s})});let n=[];r.add({dispose:()=>{n=G(n)}});let i=yu.window.createQuickPick();i.title=yu.l10n.t("Manage Access To Jupyter Kernels"),i.placeholder=yu.l10n.t("Choose which extensions can access Jupyter Kernels"),i.items=t,i.selectedItems=t.filter(s=>e.get(s.extensionId)===!0),i.canSelectMany=!0,i.ignoreFocusOut=!1;let o=!1;n.push(i),i.show(),await Promise.race([IA(i.onDidAccept,void 0,n).then(()=>o=!0),IA(i.onDidHide,void 0,n)]),o&&(await HV(i.selectedItems.map(s=>s.extensionId)),n=G(n))}function a4(r,e){r.addSingleton(Ie,Ov),r.addSingleton(Ie,Lv),r.addSingleton(Ie,wy),r.addSingleton(wi,Oy),r.addSingleton(rs,rs),r.addSingleton(RD,My),r.addSingleton(_D,Ko),r.addSingleton(Aa,Aa),r.addSingleton(Wr,vy),r.addSingleton(Ie,nf),r.addSingleton(Ie,Kv),r.addSingleton(rn,rn),r.addSingleton(cd,lc),r.addSingleton(zs,zs),r.addBinding(zs,Ie),r.addSingleton(mu,mu),r.addSingleton(Ie,Ey),r.addSingleton(Ie,Fy),r.addSingleton(pi,lf,Le.ALL_VARIABLES),r.addSingleton(pi,Ky,Le.KERNEL_VARIABLES),r.addSingleton(l_,Uy,Le.PYTHON_VARIABLES_REQUESTER),r.addSingleton(Ns,ad),r.addSingleton(Ie,ef),r.addSingleton(Ie,Sy),r.addSingleton(Ie,fy),r.addSingleton(Ie,hy),r.addSingleton(Ie,Cy),r.addSingleton(Ke,by),r.addSingleton(um,Iy),r.addSingleton(Ie,Wy),r.addSingleton(Ba,Ba),r.addBinding(Ba,Ie),r.addSingleton(Ie,jy),u5(r,e),Lh("isInsiderExtension",ES());let t=r.get(ze);Lh("isPythonExtensionInstalled",t.isPythonExtensionInstalled?"true":"false");let n=r.get(wi);Lh("rawKernelSupported",n.isSupported?"true":"false"),r.addSingleton(Ie,cn),r.addSingleton(xa,xy),r.addSingleton(fu,fu)}var pc=k(A()),By=require("vscode");var Vy=class{constructor(e,t,n,i,o,s,a){this.disposables=e;this.commandManager=t;this.appShell=n;this.extensionChecker=i;this.progressReporter=o;this.pythonApi=s;this.errorHandler=a;this.executingCells=new WeakSet}activate(){this.disposables.push(By.notebooks.onDidChangeNotebookCellExecutionState(this.onDidChangeNotebookCellExecutionState,this)),this.disposables.push(this.commandManager.registerCommand(V.InstallPythonExtensionViaKernelPicker,this.installPythonExtensionViaKernelPicker,this)),this.disposables.push(this.commandManager.registerCommand(V.InstallPythonViaKernelPicker,this.installPythonViaKernelPicker,this))}onDidChangeNotebookCellExecutionState(e){e.cell.notebook.notebookType===Ct&&(e.state===By.NotebookCellExecutionState.Pending||e.state===By.NotebookCellExecutionState.Executing?this.executingCells.add(e.cell):e.state===By.NotebookCellExecutionState.Idle&&this.executingCells.delete(e.cell))}async installPythonViaKernelPicker(){R("DS_INTERNAL.PYTHON_NOT_INSTALLED",void 0,{action:"displayed"});let e=this.installedOnceBefore?[ye.install,ye.reload]:[ye.install],t=await this.appShell.showErrorMessage(y.pythonNotInstalled,{modal:!0},...e);t===ye.install?(this.installedOnceBefore=!0,R("DS_INTERNAL.PYTHON_NOT_INSTALLED",void 0,{action:"download"}),await this.commandManager.executeCommand("python.installPython")):t===ye.reload?(R("DS_INTERNAL.PYTHON_NOT_INSTALLED",void 0,{action:"reload"}),await this.commandManager.executeCommand("jupyter.reloadVSCode",y.reloadRequired)):R("DS_INTERNAL.PYTHON_NOT_INSTALLED",void 0,{action:"dismissed"})}async installPythonExtensionViaKernelPicker(){if(!this.extensionChecker.isPythonExtensionInstalled){R("DS_INTERNAL.PYTHON_EXTENSION_NOT_INSTALLED",void 0,{action:"displayed"});let e=this.progressReporter.createProgressIndicator(y.installingPythonExtension);try{await this.extensionChecker.directlyInstallPythonExtension();let t="hooked",n=await Dr(6e4,"timeout",this.pythonApi.pythonExtensionHooked.then(()=>t));if(this.extensionChecker.isPythonExtensionInstalled&&n===t)return w("Python Extension installed via Kernel Picker command"),R("DS_INTERNAL.PYTHON_EXTENSION_INSTALLED_VIA_KERNEL_PICKER",void 0,{action:"success"}),!0;C("Failed to install Python Extension via Kernel Picker command"),R("DS_INTERNAL.PYTHON_EXTENSION_INSTALLED_VIA_KERNEL_PICKER",void 0,{action:"failed"}),this.errorHandler.handleError(new Error(y.failedToInstallPythonExtension)).then(m,m)}finally{e.dispose()}}}};Vy=g([(0,pc.injectable)(),p(0,(0,pc.inject)(O)),p(1,(0,pc.inject)(Fe)),p(2,(0,pc.inject)(ue)),p(3,(0,pc.inject)(ze)),p(4,(0,pc.inject)(es)),p(5,(0,pc.inject)(Xt)),p(6,(0,pc.inject)(an))],Vy);var dd=k(A());var pf=class{constructor(e,t,n,i,o){this.disposables=e;this.vscNotebook=t;this.controllerRegistration=n;this.commandManager=i;this.preferredRemoteKernelIdProvider=o}activate(){this.vscNotebook.onDidOpenNotebookDocument(this.onDidOpenNotebook,this,this.disposables),this.vscNotebook.notebookDocuments.forEach(e=>this.onDidOpenNotebook(e))}async onDidOpenNotebook(e){if(!Dt(e))return;let t=await this.preferredRemoteKernelIdProvider.getPreferredRemoteKernelId(e.uri);if(!t)return;let n=()=>{let o=this.controllerRegistration.getSelected(e),s=this.controllerRegistration.registered.find(a=>a.id===t);return s&&o?.id!==s.id?(this.switchKernel(e,s.connection).catch(m),!0):!1};if(n())return;let i=this.controllerRegistration.onDidChange(o=>{o.added.length&&n()&&i.dispose()},this,this.disposables);this.controllerRegistration.onControllerSelected(o=>{o.notebook===e&&i.dispose()},this,this.disposables)}async switchKernel(e,t){w(`Using notebook.selectKernel to force remote kernel for ${W(e.uri)} to ${t.id}`),await this.commandManager.executeCommand("notebook.selectKernel",{id:t.id,extension:bt}),await uh(async()=>{if(this.vscNotebook.activeNotebookEditor?.notebook===e){let i=this.controllerRegistration.getSelected(e);if(i?.connection.id===t.id)return i.restoreConnection(e).catch(m),!0}return!1},2e3,100)?w(`Successfully switched remote kernel for ${W(e.uri)} to ${t.id}`):J(`Failed to switch remote kernel for ${W(e.uri)} to ${t.id}`)}};g([Br()],pf.prototype,"onDidOpenNotebook",1),pf=g([(0,dd.injectable)(),p(0,(0,dd.inject)(O)),p(1,(0,dd.inject)(qe)),p(2,(0,dd.inject)(xt)),p(3,(0,dd.inject)(Fe)),p(4,(0,dd.inject)(rs))],pf);var df=k(A()),b4=require("vscode");var y4=require("vscode");var KC=k(A()),p4=require("vscode");var DF=k(po()),u4=require("vscode");function l4(r){if(!r||!Array.isArray(r)||r.length===0)return;let e=[];for(let t=0;t<r.length;t+=1){let n=r[t];if("buffer"in n&&"byteOffset"in n){let i=Array.apply(null,new Uint8Array(n.buffer));e.push({...n,byteLength:n.byteLength,byteOffset:n.byteOffset,buffer:i})}else e.push([...new Uint8Array(n)])}return e}function c4(r){if(!Array.isArray(r)||r.length===0)return r;let e=[];for(let t=0;t<r.length;t+=1){let n=r[t];if("buffer"in n&&"byteOffset"in n){let i=new Uint8Array(n.buffer).buffer,o=new DataView(i,n.byteOffset,n.byteLength);e.push(o)}else{let i=new Uint8Array(n).buffer;e.push(i)}}return e}var p_=class{constructor(e,t){this.kernelProvider=e;this.document=t;this.commTargetsRegistered=new Set;this.pendingTargetNames=new Set;this._postMessageEmitter=new u4.EventEmitter;this.messageHooks=new Map;this.pendingHookRemovals=new Map;this.messageHookRequests=new Map;this.disposables=[];this.disposed=!1;this.pendingMessages=[];this.subscribedToKernelSocket=!1;this.waitingMessageIds=new Map;this.totalWaitTime=0;this.totalWaitedMessages=0;this.hookCount=0;this.outputWidgetIds=new Set;this.isUsingIPyWidgets=!1;this.pendingTargetNames.add("jupyter.widget"),e.onDidStartKernel(i=>{i.notebook===t&&this.initialize()},this,this.disposables),this.mirrorSend=this.mirrorSend.bind(this),this.onKernelSocketMessage=this.onKernelSocketMessage.bind(this);let n=require("@jupyterlab/services/lib/kernel/serialize");this.deserialize=n.deserialize}get postMessage(){return this._postMessageEmitter.event}dispose(){for(this.sendOverheadTelemetry(),this.disposed=!0;this.disposables.length;)this.disposables.shift()?.dispose()}receiveMessage(e){switch(e.message){case"IPyWidgets_logMessage":{let t=e.payload;t.category==="error"?C(`Widget Error: ${t.message}`):w(`Widget Message: ${t.message}`);break}case"IPyWidgets_Ready":this.sendKernelOptions(),this.initialize();break;case"IPyWidgets_msg":this.sendRawPayloadToKernelSocket(e.payload);break;case"IPyWidgets_binary_msg":this.sendRawPayloadToKernelSocket(c4(e.payload)[0]);break;case"IPyWidgets_msg_received":this.onKernelSocketResponse(e.payload);break;case"IPyWidgets_registerCommTarget":this.registerCommTarget(e.payload);break;case"IPyWidgets_RegisterMessageHook":this.registerMessageHook(e.payload);break;case"IPyWidgets_RemoveMessageHook":this.possiblyRemoveMessageHook(e.payload);break;case"IPyWidgets_MessageHookResult":this.handleMessageHookResponse(e.payload);break;case"IPyWidgets_iopub_msg_handled":this.iopubMessageHandled(e.payload);break;default:break}}sendRawPayloadToKernelSocket(e){this.pendingMessages.push(e),this.sendPendingMessages()}registerCommTarget(e){this.pendingTargetNames.add(e),this.initialize()}initialize(){this.jupyterLab||(this.jupyterLab=require("@jupyterlab/services"));let e=this.getKernel();e&&(this.subscribeToKernelSocket(e),this.registerCommTargets(e)),w("IPyWidgetMessageDispatcher.initialize")}raisePostMessage(e,t){this._postMessageEmitter.fire({message:e,payload:t})}subscribeToKernelSocket(e){if(this.subscribedToKernelSocket||!e.session)return;this.subscribedToKernelSocket=!0,this.subscribeToKernelSocketImpl(e);let t=e.session.kernel?.id;e.session.onDidKernelSocketChange(()=>{this.subscribeToKernelSocketImpl(e,t),t=e.session?.kernel?.id||""})}subscribeToKernelSocketImpl(e,t){let n=t?mo.get(t):void 0;if(n?.removeReceiveHook(this.onKernelSocketMessage),n?.removeSendHook(this.mirrorSend),this.kernelWasConnectedAtLeastOnce){for(;this.pendingMessages.length;)this.pendingMessages.shift();this.waitingMessageIds.forEach(s=>s.resultPromise.resolve()),this.waitingMessageIds.clear(),this.messageHookRequests.forEach(s=>s.resolve(!1)),this.messageHookRequests.clear(),this.messageHooks.clear(),this.sendRestartKernel()}if(!e.session?.kernel?.id||!mo.get(e.session?.kernel?.id))return;this.kernelWasConnectedAtLeastOnce=!0;let i=e.session.kernel?.id,o=i?mo.get(i):void 0;o?.addReceiveHook(this.onKernelSocketMessage),o?.addSendHook(this.mirrorSend),this.sendKernelOptions(),this.registerCommTargets(e),this.sendPendingMessages()}sendKernelOptions(){this.kernel?.session?.kernel&&this.raisePostMessage("IPyWidgets_kernelOptions",{id:this.kernel?.session?.kernel?.id||"",clientId:this.kernel?.session?.kernel?.clientId||"",userName:this.kernel?.session?.kernel?.username||"",model:this.kernel?.session?.kernel?.model||{id:"",name:""}})}async mirrorSend(e,t){if(typeof e=="string"&&e.includes("shell")&&e.includes("execute_request")){let n=Date.now(),i=this.deserialize(e);if(i.channel==="shell"&&i.header.msg_type==="execute_request"){if(!xT(i))return;let o=this.mirrorExecuteRequest(i);this.isUsingIPyWidgets&&await o,this.totalWaitTime=Date.now()-n,this.totalWaitedMessages+=1}}}sendRestartKernel(){this.raisePostMessage("IPyWidgets_onRestartKernel",void 0)}mirrorExecuteRequest(e){let t=pe();return this.waitingMessageIds.set(e.header.msg_id,{startTime:Date.now(),resultPromise:t}),this.raisePostMessage("IPyWidgets_mirror_execute",{id:e.header.msg_id,msg:e}),t.promise}messageNeedsFullHandle(e){return e.channel==="iopub"&&e.header?.msg_type==="comm_msg"&&e.content?.data?.method==="update"&&this.outputWidgetIds.has(e.content?.comm_id)}iopubMessageHandled(e){let t=e.id;this.fullHandleMessage&&this.fullHandleMessage.id===t&&(this.fullHandleMessage.promise.resolve(),this.fullHandleMessage=void 0)}async onKernelSocketMessage(e){let t=(0,DF.default)(),n=pe();if(this.waitingMessageIds.set(t,{startTime:Date.now(),resultPromise:n}),typeof e=="string"?xT(e)&&this.raisePostMessage("IPyWidgets_msg",{id:t,data:e}):this.raisePostMessage("IPyWidgets_binary_msg",{id:t,data:l4([e])}),typeof e!="string"||e.includes(Xi)||e.includes(Le.DefaultCommTarget)||e.includes("comm_open")||e.includes("comm_close")||e.includes("comm_msg")){let o=this.deserialize(e);if(!xT(o))return;o&&o.content&&o.content.data&&(o.content.data[Xi]||o.content.target_name===Le.DefaultCommTarget)&&(this.isUsingIPyWidgets=!0);let s=o.header?.msg_type==="comm_open"&&o.content?.data?.state?._model_module==="@jupyter-widgets/output"&&o.content?.data?.state?._model_name==="OutputModel",a=o.header?.msg_type==="comm_close"&&this.outputWidgetIds.has(o.content?.comm_id);s?this.outputWidgetIds.add(o.content.comm_id):a?this.outputWidgetIds.delete(o.content.comm_id):this.messageNeedsFullHandle(o)&&(this.fullHandleMessage={id:o.header.msg_id,promise:pe()},await n.promise,await this.fullHandleMessage.promise.promise,this.fullHandleMessage=void 0)}}onKernelSocketResponse(e){let t=this.waitingMessageIds.get(e.id);t&&(this.waitingMessageIds.delete(e.id),this.totalWaitTime+=Date.now()-t.startTime,this.totalWaitedMessages+=1,t.resultPromise.resolve())}sendPendingMessages(){if(this.kernel?.session?.kernel)for(;this.pendingMessages.length;)try{let e=JSON.parse(this.pendingMessages[0]);e.channel==="control"?this.kernel.session.kernel.sendControlMessage(e):this.kernel.session.kernel.sendShellMessage(e),this.pendingMessages.shift()}catch(e){C("Failed to send message to Kernel",e);return}}registerCommTargets(e){for(;this.pendingTargetNames.size>0;){let n=Array.from([...this.pendingTargetNames.values()]).shift();if(n){if(this.commTargetsRegistered.has(n))return;w(`Registering commtarget ${n}`),this.commTargetsRegistered.add(n),this.pendingTargetNames.delete(n),n!==Le.DefaultCommTarget&&e.session?.kernel?.registerCommTarget(n,m)}}}getKernel(){return this.document&&!this.kernel?.session&&(this.kernel=this.kernelProvider.get(this.document),this.kernel?.onDisposed(()=>this.kernel=void 0)),this.kernel&&!this.kernelRestartHandlerAttached&&(this.kernelRestartHandlerAttached=!0,this.disposables.push(this.kernel.onRestarted(this.handleKernelRestarts,this))),this.kernel}async handleKernelRestarts(){this.disposed||this.commTargetsRegistered.size===0||!this.kernel?.session||(Array.from(this.commTargetsRegistered.keys()).forEach(e=>{this.commTargetsRegistered.delete(e),this.pendingTargetNames.add(e)}),this.subscribeToKernelSocket(this.kernel),this.registerCommTargets(this.kernel))}registerMessageHook(e){try{if(this.kernel?.session?.kernel&&!this.messageHooks.has(e)){this.hookCount+=1;let t=this.messageHookCallback.bind(this);this.messageHooks.set(e,t),this.kernel.session.kernel.registerMessageHook(e,t)}}finally{this.raisePostMessage("IPyWidgets_ExtensionOperationHandled",{id:e,type:"IPyWidgets_RegisterMessageHook"})}}possiblyRemoveMessageHook(e){try{e.lastHookedMsgId?this.pendingHookRemovals.set(e.lastHookedMsgId,e.hookMsgId):this.removeMessageHook(e.hookMsgId)}finally{this.raisePostMessage("IPyWidgets_ExtensionOperationHandled",{id:e.hookMsgId,type:"IPyWidgets_RemoveMessageHook"})}}removeMessageHook(e){if(this.kernel?.session?.kernel&&this.messageHooks.has(e)){let t=this.messageHooks.get(e);this.messageHooks.delete(e),this.kernel.session.kernel.removeMessageHook(e,t)}}async messageHookCallback(e){let t=pe(),n=(0,DF.default)(),i=e.parent_header.msg_id;if(this.messageHooks.has(i)?(this.messageHookRequests.set(n,t),this.raisePostMessage("IPyWidgets_MessageHookCall",{requestId:n,parentId:i,msg:e})):t.resolve(!0),this.pendingHookRemovals.has(e.header.msg_id)){let o=this.pendingHookRemovals.get(e.header.msg_id);this.pendingHookRemovals.delete(e.header.msg_id),this.removeMessageHook(o)}return t.promise}handleMessageHookResponse(e){let t=this.messageHookRequests.get(e.requestId);t&&(this.messageHookRequests.delete(e.requestId),t.resolve(e.msgType.includes("comm")?!0:e.result))}sendOverheadTelemetry(){R("DS_INTERNAL.IPYWIDGET_OVERHEAD",{totalOverheadInMs:this.totalWaitTime,numberOfMessagesWaitedOn:this.totalWaitedMessages,averageWaitTime:this.totalWaitTime/this.totalWaitedMessages,numberOfRegisteredHooks:this.hookCount})}};var TF=class{constructor(e,t){this.baseMulticaster=e;this.oldMessages=t;this._postMessageEmitter=new p4.EventEmitter;this.disposables=[];e.postMessage(this.raisePostMessage,this,this.disposables)}get postMessage(){return this._postMessageEmitter.event}dispose(){for(;this.disposables.length;)this.disposables.shift()?.dispose()}initialize(){return this.baseMulticaster.initialize()}receiveMessage(e){this.baseMulticaster.receiveMessage(e)}raisePostMessage(e){this.oldMessages.forEach(t=>{this._postMessageEmitter.fire(t)}),this.oldMessages=[],this._postMessageEmitter.fire(e)}},bu=class{constructor(e,t){this.kernelProvider=t;this.messageDispatchers=new WeakMap;this.messagesPerNotebook=new WeakMap;this.disposed=!1;this.disposables=[];e.push(this),t.onDidDisposeKernel(this.trackDisposingOfKernels,this,e)}dispose(){for(this.disposed=!0;this.disposables.length;)this.disposables.shift()?.dispose()}create(e){let t=this.messageDispatchers.get(e);t||(t=new p_(this.kernelProvider,e),this.messageDispatchers.set(e,t),this.disposables.push(t.postMessage(o=>this.onMessage(o,e),this)));let n=[];e&&this.messagesPerNotebook.get(e)&&(n=this.messagesPerNotebook.get(e)||[]);let i=new TF(t,n);return this.disposables.push(i),i}trackDisposingOfKernels(e){if(this.disposed)return;let t=e.notebook,n=this.messageDispatchers.get(t);this.messageDispatchers.delete(t),n?.dispose()}onMessage(e,t){t&&(this.messagesPerNotebook.set(t,this.messagesPerNotebook.get(t)||[]),(e.message==="IPyWidgets_kernelOptions"||e.message==="IPyWidgets_registerCommTarget")&&this.messagesPerNotebook.get(t).push(e))}};bu=g([(0,KC.injectable)(),p(0,(0,KC.inject)(O)),p(1,(0,KC.inject)(Ke))],bu);var m4=require("vscode");var d4=require("vscode");var qy=class qy{constructor(e,t,n,i,o,s,a){this.kernel=e;this.localResourceUriConverter=t;this.configurationSettings=n;this.httpClient=i;this.sourceProviderFactory=o;this.isWebViewOnline=s;this.cdnScriptProvider=a;this.disposables=[];this.scriptProviders=this.sourceProviderFactory.getProviders(this.kernel,this.localResourceUriConverter,this.httpClient),this.monitorKernel()}get configuredScriptSources(){return this.configurationSettings.getSettings(void 0).widgetScriptSources}static{this.trackedWidgetModuleNames=new Set}dispose(){G(this.disposables),this.disposeScriptProviders()}async getBaseUrl(){let e=this.scriptProviders.find(t=>t.getBaseUrl);if(e)return e.getBaseUrl()}async getWidgetScriptSources(){let e=[];return await Promise.all(this.scriptProviders.map(async t=>{t.getWidgetScriptSources&&e.push(...await t.getWidgetScriptSources())})),e}async getWidgetScriptSource(e,t){let n=await this.isWebViewOnline,i=(this.scriptProviders||[]).slice(),o={moduleName:e};for(;i.length;){let s=i.shift();if(!s)continue;let a=await s.getWidgetScriptSource(e,t,n);if(a.scriptUri){o=a;break}}return this.sendTelemetryForWidgetModule(e,t,"",o.source).catch(m),o.scriptUri?H(`Script source for Widget ${e}@${t} was found from source ${o.source}`):C(`Script source for Widget ${e}@${t} not found`),o}async sendTelemetryForWidgetModule(e,t,n,i){let o=`${e}.${e}@${t}`;if(qy.trackedWidgetModuleNames.has(o))return;qy.trackedWidgetModuleNames.add(o);let s=e.toLowerCase().startsWith("@jupyter-widgets"),a=i==="cdn"||s||await this.cdnScriptProvider.isOnCDN(e),l=a?e.replace(/\//g,"_").replace(/\\/g,"_").replace(/@/g,"_at_"):void 0,c=a?n.replace(/\//g,"_").replace(/\\/g,"_").replace(/@/g,"_at_"):void 0;R("DS_INTERNAL.IPYWIDGET_USED_BY_USER",void 0,{hashedName:await ht(e),moduleName:l,modelName:c,source:i,moduleVersion:a?t:void 0,cdnSearched:this.configuredScriptSources.length>0})}disposeScriptProviders(){for(;this.scriptProviders&&this.scriptProviders.length;){let e=this.scriptProviders.shift();e&&e.dispose()}}monitorKernel(){this.hookKernelEvents(),this.kernel.onStarted(this.hookKernelEvents,this,this.disposables),this.kernel.onRestarted(this.hookKernelEvents,this,this.disposables),this.kernel.onDidKernelSocketChange(()=>this.hookKernelEvents(),this,this.disposables)}hookKernelEvents(){let e=this.kernel.session?.kernel;e&&(e.anyMessage.connect(this.onAnyMessage,this),this.disposables.push(new d4.Disposable(()=>e.anyMessage.disconnect(this.onAnyMessage,this))))}onAnyMessage(e,t){if(t.direction==="recv"&&t.msg.header.msg_type==="comm_open"){let i=t.msg.content.data;i.state?._model_module&&i.state._model_name&&this.sendTelemetryForWidgetModule(i.state?._model_module,i.state?._model_module_version||"",i.state?._model_name).catch(m)}}};g([Br()],qy.prototype,"sendTelemetryForWidgetModule",1),g([Br()],qy.prototype,"onAnyMessage",1);var m_=qy;var f_=class{constructor(e,t){this.isWebExtension=e;this.converter=t}async asWebviewUri(e){return this.isWebExtension?e:this.converter(e)}};var h_=class{constructor(e,t,n,i,o,s,a,l){this.document=e;this.kernelProvider=t;this.configurationSettings=i;this.httpClient=o;this.sourceProviderFactory=s;this.cdnScriptProvider=l;this.postEmitter=new m4.EventEmitter;this.disposables=[];this.isWebViewOnline=pe();this.widgetSources=new Map;this.pendingModuleRequests=new Map;this.uriTranslationRequests=new Bs;this.uriConverter=new f_(a,c=>(this.uriTranslationRequests.has(c)||this.uriTranslationRequests.set(c,pe()),this.postEmitter.fire({message:"ConvertUriForUseInWebViewRequest",payload:c}),this.uriTranslationRequests.get(c).promise)),this.isWebViewOnline.promise.catch(m),n.push(this),this.kernelProvider.onDidStartKernel(c=>{c.notebook===this.document&&this.initialize()},this,this.disposables)}get postMessage(){return this.postEmitter.event}dispose(){for(;this.disposables.length;)this.disposables.shift()?.dispose()}onMessage(e,t){if(e==="ConvertUriForUseInWebViewResponse"){let n=t;n&&this.uriTranslationRequests.has(n.request)&&this.uriTranslationRequests.get(n.request).resolve(n.response)}else if(e==="IPyWidgets_Ready")this.sendBaseUrl(),this.sendWidgetScriptSources().catch(m);else if(e==="IPyWidgets_IsOnline"){let n=t.isOnline;this.isWebViewOnline.resolve(n)}else e==="IPyWidgets_WidgetScriptSourceRequest"&&t&&this.onRequestWidgetScript(t).catch(m)}initialize(){this.jupyterLab||(this.jupyterLab=require("@jupyterlab/services")),this.kernel||(this.kernel=this.kernelProvider.get(this.document)),this.kernel?.session&&(this.scriptProvider||(this.scriptProvider=new m_(this.kernel,this.uriConverter,this.configurationSettings,this.httpClient,this.sourceProviderFactory,this.isWebViewOnline.promise,this.cdnScriptProvider),this.kernel.onDisposed(()=>this.dispose()),this.handlePendingRequests(),this.sendBaseUrl(),w("IPyWidgetScriptSource.initialize")))}sendBaseUrl(){this.scriptProvider&&this.scriptProvider.getBaseUrl().then(e=>{e&&this.postEmitter.fire({message:"IPyWidgets_BaseUrl_Response",payload:e.toString()})}).catch(e=>C("Failed to get baseUrl",e))}async sendWidgetScriptSources(){if(this.scriptProvider&&!this.allWidgetScriptsSent)try{(await this.scriptProvider.getWidgetScriptSources()).forEach(t=>{this.widgetSources.get(t.moduleName)?.source!=="cdn"&&this.widgetSources.set(t.moduleName,t),this.postEmitter.fire({message:"IPyWidgets_WidgetScriptSource_Response",payload:t})})}catch(e){J("Failed to fetch script sources",e)}finally{this.allWidgetScriptsSent=!0}}async onRequestWidgetScript(e){let{moduleName:t,moduleVersion:n,requestId:i}=e;if(H(`\x1B[32mFetch Script for ${JSON.stringify(e)}`),await this.sendWidgetSource(t,n,i).catch(o=>C("Failed to send widget sources upon ready",o)),this.scriptProvider&&!this.allWidgetScriptsSent)try{await this.sendWidgetScriptSources()}finally{this.sendWidgetSource(t,n,i).catch(C.bind(void 0,"Failed to send widget sources upon ready"))}}async sendWidgetSource(e,t="*",n){if(!e||e.startsWith("@jupyter"))return;if(!this.kernel||!this.scriptProvider){this.pendingModuleRequests.set(e,{moduleVersion:t,requestId:n});return}let i={moduleName:e,requestId:n};try{H(`\x1B[32mFetch Script for ${e}`),i=await this.scriptProvider.getWidgetScriptSource(e,t),this.widgetSources.get(i.moduleName)?.source!=="cdn"&&this.widgetSources.set(i.moduleName,i)}catch(o){C("Failed to get widget source due to an error",o),R("DS_INTERNAL.IPYWIDGET_DISCOVERY_ERRORED")}finally{H(`\x1B[32mScript for ${e}, is ${i.scriptUri} from ${i.source}`),this.postEmitter.fire({message:"IPyWidgets_WidgetScriptSource_Response",payload:i})}}handlePendingRequests(){let e=Array.from(this.pendingModuleRequests.keys());for(;e.length;){let t=e.shift();if(t){let{moduleVersion:n,requestId:i}=this.pendingModuleRequests.get(t);this.pendingModuleRequests.delete(t),this.sendWidgetSource(t,n,i).catch(C.bind(`Failed to send WidgetScript for ${t}`))}}}};var v_=Symbol("IWidgetScriptSourceProviderFactory"),y_=Symbol("INbExtensionsPathProvider"),b_=Symbol("IIPyWidgetScriptManagerFactory"),Yat=Symbol("IIPyWidgetScriptManager");var Iu=k(A()),g4=require("vscode");var v4="https://unpkg.com/",RF="https://cdn.jsdelivr.net/npm/",I_="IPYWidgetCDNConfigured",f4="IPYWidgetNotFoundOnCDN",h4="IPYWidgetNoNetWorkAccess";function nve(r,e,t){let n=e,i="index",o=e.indexOf("/");return o!==-1&&e[0]==="@"&&(o=e.indexOf("/",o+1)),o!==-1&&(i=e.substr(o+1),n=e.substr(0,o)),r===RF&&(t.startsWith("^")&&(t=t.slice(1)),i.endsWith(".js")||(i=i.concat(".js"))),`${r}${n}@${t}/dist/${i}`}function ive(r){switch(r){case"unpkg.com":return v4;case"jsdelivr.com":return RF;default:break}}var qa=class{constructor(e,t,n,i){this.appShell=e;this.globalMemento=t;this.configurationSettings=n;this.httpClient=i;this.cache=new Map;this.isOnCDNCache=new Map;this.notifiedUserAboutWidgetScriptNotFound=new Set}get cdnProviders(){return this.configurationSettings.getSettings(void 0).widgetScriptSources}dispose(){this.cache.clear()}async isOnCDN(e){let t=`MODULE_VERSION_ON_CDN_${e}`;if(this.isOnCDNCache.has(t))return this.isOnCDNCache.get(t);if(this.globalMemento.get(t,!1))return!0;let n=(async()=>{let i=Vu(this.httpClient.exists(`${v4}${e}`)),o=Vu(this.httpClient.exists(`${RF}${e}`));return await Promise.race([i.promise,o.promise]),i.value||o.value?!0:(await Promise.all([i.promise,o.promise]),!!(i.value||o.value))})();return n.then(i=>{if(i)return this.globalMemento.update(t,!0)}).then(m,m),this.isOnCDNCache.set(t,n),n}async getWidgetScriptSource(e,t,n){if(n===!1)return this.warnIfNoAccessToInternetFromWebView(e).catch(m),{moduleName:e};if(this.cdnProviders.length===0&&this.globalMemento.get(I_,!1))return{moduleName:e};let i=this.getModuleKey(e,t);return this.cache.get(i)||this.cache.set(i,this.getWidgetScriptSourceImplementation(e,t)),this.cache.get(i)}async generateDownloadUri(e,t,n){let i=ive(n);if(i)return nve(i,e,t)}getModuleKey(e,t){return`${e}${t}`}async getWidgetScriptSourceImplementation(e,t){if(H(`\x1B[32mSearching for Widget Script ${e}#${t} using cdns ${this.cdnProviders.join(" ")}`),await this.configureWidgets(),this.cdnProviders.length===0)return{moduleName:e};let i=(await Promise.all(this.cdnProviders.map(o=>this.getValidUri(e,t,o)))).find(o=>o);return i?(H(`\x1B[32mWidget Script ${e}#${t} found at URI: ${i}`),{moduleName:e,scriptUri:i,source:"cdn"}):(C(`Widget Script ${e}#${t} was not found on on any cdn`),this.handleWidgetSourceNotFound(e,t).catch(m),{moduleName:e})}async getValidUri(e,t,n){try{let i=await this.generateDownloadUri(e,t,n);if(i&&await this.httpClient.exists(i))return i}catch{w(`Failed downloading ${e}:${t} from ${n}`);return}}async warnIfNoAccessToInternetFromWebView(e){if(this.globalMemento.get(h4,!1)||this.notifiedUserAboutWidgetScriptNotFound.has(e)||this.cdnProviders.length===0)return;switch(this.notifiedUserAboutWidgetScriptNotFound.add(e),await this.appShell.showWarningMessage(y.cdnWidgetScriptNotAccessibleWarningMessage(e,JSON.stringify(this.cdnProviders)),ye.ok,ye.doNotShowAgain,ye.moreInfo)){case ye.doNotShowAgain:return this.globalMemento.update(h4,!0);case ye.moreInfo:return this.appShell.openUrl("https://aka.ms/PVSCIPyWidgets");default:}}async configureWidgets(){if(this.cdnProviders.length!==0||this.globalMemento.get(I_,!1))return;if(this.configurationPromise)return this.configurationPromise.promise;this.configurationPromise=pe(),R("DS_INTERNAL.IPYWIDGET_PROMPT_TO_USE_CDN");let e=await this.appShell.showInformationMessage(y.useCDNForWidgetsNoInformation,{modal:!0},ye.ok,ye.doNotShowAgain,ye.moreInfo),t="dismissed";switch(e){case ye.ok:{t="ok",await Promise.all([this.updateScriptSources(["jsdelivr.com","unpkg.com"]),this.globalMemento.update(I_,!0)]);break}case ye.doNotShowAgain:{t="doNotShowAgain",await Promise.all([this.updateScriptSources([]),this.globalMemento.update(I_,!0)]);break}case ye.moreInfo:{this.appShell.openUrl("https://aka.ms/PVSCIPyWidgets");break}default:t=e===ye.cancel?"cancel":"dismissed";break}R("DS_INTERNAL.IPYWIDGET_PROMPT_TO_USE_CDN_SELECTION",void 0,{selection:t}),this.configurationPromise.resolve()}async updateScriptSources(e){let t="widgetScriptSources";await this.configurationSettings.updateSetting(t,e,void 0,g4.ConfigurationTarget.Global)}async handleWidgetSourceNotFound(e,t){if(this.globalMemento.get(f4,!1)||this.notifiedUserAboutWidgetScriptNotFound.has(e)||this.cdnProviders.length===0)return;switch(this.notifiedUserAboutWidgetScriptNotFound.add(e),await this.appShell.showWarningMessage(y.widgetScriptNotFoundOnCDNWidgetMightNotWork(e,t,JSON.stringify(this.cdnProviders)),ye.ok,ye.doNotShowAgain,ye.reportThisIssue)){case ye.doNotShowAgain:return this.globalMemento.update(f4,!0);case ye.reportThisIssue:return this.appShell.openUrl("https://aka.ms/CreatePVSCDataScienceIssue");default:}}};qa=g([(0,Iu.injectable)(),p(0,(0,Iu.inject)(ue)),p(1,(0,Iu.inject)(He)),p(1,(0,Iu.named)(It)),p(2,(0,Iu.inject)(se)),p(3,(0,Iu.inject)(ws))],qa);var FC=class{constructor(e,t){this.document=e;this.serviceContainer=t;this.cachedMessages=[];this.postEmitter=new y4.EventEmitter;this.attachedWebviews=new WeakSet;this.modulesForWhichWeHaveDisplayedWidgetErrorMessage=new Set;this.queuedMessages=[];this.disposables=this.serviceContainer.get(O),this.jupyterOutput=this.serviceContainer.get(Wo,Wu),this.appShell=this.serviceContainer.get(ue,ue),this.commandManager=this.serviceContainer.get(Fe),this.configService=this.serviceContainer.get(se),this.initialize()}get postMessage(){return this.listeningToPostMessageEvent=!0,this.postEmitter.event}dispose(){this.cachedMessages=[],this.ipyWidgetMessageDispatcher?.dispose(),this.ipyWidgetScriptSource?.dispose()}attach(e){if(this.attachedWebviews.has(e))return;this.attachedWebviews.add(e),this.postMessage(i=>{if(te(`\x1B[32mWidget Coordinator sent ${i.message}`),i.message==="ConvertUriForUseInWebViewRequest")this.onMessage(e,"ConvertUriForUseInWebViewResponse",{request:i.payload,response:e.asWebviewUri(i.payload)});else{if(!this.readyMessageReceived){this.queuedMessages.push({type:i.message,payload:i.payload});return}this.sendPendingWebViewMessages(e),e.postMessage({type:i.message,payload:i.payload}).then(m,m)}},this,this.disposables);let t=pe(),n=async()=>{let i=new $e;if(!t.completed){w("Attempting to determine version of IPyWidgets");let s=[],a=this.serviceContainer.get(Ke),l=pe();a.get(this.document)?l.resolve(a.get(this.document)):a.onDidCreateKernel(u=>{u.notebook===this.document&&l.resolve(u)},this,s);let c=await l.promise;c&&(Vt(c.kernelConnectionMetadata)?c.ipywidgetsVersion?t.completed||t.resolve(c.ipywidgetsVersion):(w("Waiting for IPyWidgets version"),c.onIPyWidgetVersionResolved(()=>{c.ipywidgetsVersion&&(t.completed||t.resolve(c.ipywidgetsVersion),G(s))},this,s)):t.completed||t.resolve(NS)),s.length&&this.disposables.push(...s),w("Waiting for IPyWidgets version promise")}let o=await t.promise;w(`Version of IPyWidgets ${o} determined after ${i.elapsedTime/1e3}s`),e.postMessage({type:"IPyWidgets_Reply_Widget_Version",payload:o}).then(m,m)};e.onDidReceiveMessage(async i=>{te(`\x1B[32mWidget Coordinator received ${i.type}`),this.onMessage(e,i.type,i.payload),i.type==="IPyWidgets_Request_Widget_Version"&&await n(),i.type==="IPyWidgets_Ready"&&(w("Web view is ready to receive widget messages"),this.readyMessageReceived=!0,this.sendPendingWebViewMessages(e))},this,this.disposables),e.postMessage({type:"IPyWidgets_IsReadyRequest",payload:void 0}).then(m,m),n().catch(m)}onMessage(e,t,n){t==="ipywidget_load_success"?this.sendLoadSucceededTelemetry(n).catch(m):t==="ipywidget_load_failure"?this.handleWidgetLoadFailure(e,n).catch(m):t==="ipywidget_widget_version_not_supported"?this.sendUnsupportedWidgetVersionFailureTelemetry(n).catch(m):t==="ipywidget_render_failure"?this.sendRenderFailureTelemetry(n):t==="ipywidget_unhandled_kernel_message"&&this.handleUnhandledMessage(n),this.getIPyWidgetMessageDispatcher().receiveMessage({message:t,payload:n}),this.getIPyWidgetScriptSource().onMessage(t,n)}sendPendingWebViewMessages(e){if(this.readyMessageReceived)for(;this.queuedMessages.length;)e.postMessage(this.queuedMessages.shift()).then(m,m)}initialize(){w("initialize CommonMessageCoordinator"),this.getIPyWidgetScriptSource().initialize(),this.getIPyWidgetMessageDispatcher().initialize()}async sendLoadSucceededTelemetry(e){try{R("DS_INTERNAL.IPYWIDGET_LOAD_SUCCESS",0,{moduleHash:await ht(e.moduleName),moduleVersion:e.moduleVersion})}catch{}}async handleWidgetLoadFailure(e,t){try{let n=t.error.toString(),i=this.configService.getSettings(void 0).widgetScriptSources.length>0,o=`${t.moduleName}:${t.moduleVersion}`;if(!t.isOnline)n=y.loadClassFailedWithNoInternet(t.moduleName,t.moduleVersion),this.appShell.showErrorMessage(n).then(m,m);else if(!i&&!this.modulesForWhichWeHaveDisplayedWidgetErrorMessage.has(o)){this.modulesForWhichWeHaveDisplayedWidgetErrorMessage.add(o);let s=ye.moreInfo,a=y.enableCDNForWidgetsButton;n=y.enableCDNForWidgetsSetting(t.moduleName,t.moduleVersion),this.appShell.showErrorMessage(n,{modal:!0},a,s).then(l=>{switch(l){case s:this.appShell.openUrl("https://aka.ms/PVSCIPyWidgets");break;case a:this.enableCDNForWidgets(e).catch(m);break;default:break}},m)}C(`Widget load failure ${n}`,t),R("DS_INTERNAL.IPYWIDGET_LOAD_FAILURE",0,{isOnline:t.isOnline,moduleHash:await ht(t.moduleName),moduleVersion:t.moduleVersion,timedout:t.timedout})}catch{}}async enableCDNForWidgets(e){await this.commandManager.executeCommand(V.EnableLoadingWidgetsFrom3rdPartySource),await e.postMessage({type:"IPyWidgets_AttemptToDownloadFailedWidgetsAgain"})}async sendUnsupportedWidgetVersionFailureTelemetry(e){try{R("DS_INTERNAL.IPYWIDGET_WIDGET_VERSION_NOT_SUPPORTED_LOAD_FAILURE",0,{moduleHash:await ht(e.moduleName),moduleVersion:e.moduleVersion})}catch{}}sendRenderFailureTelemetry(e){try{C("Error rendering a widget: ",e),R("DS_INTERNAL.IPYWIDGET_RENDER_FAILURE")}catch{}}handleUnhandledMessage(e){if(e.header.msg_type!=="status")try{if(e.header.msg_type==="error"){let t=e;t.content.traceback=t.content.traceback.map(sc)}H(`Unhandled widget kernel message: ${e.header.msg_type} ${e.content}`),this.jupyterOutput.appendLine(y.unhandledMessage(e.header.msg_type,JSON.stringify(e.content))),R("DS_INTERNAL.IPYWIDGET_UNHANDLED_MESSAGE",void 0,{msg_type:e.header.msg_type})}catch{}}getIPyWidgetMessageDispatcher(){return this.ipyWidgetMessageDispatcher||(this.ipyWidgetMessageDispatcher=this.serviceContainer.get(bu).create(this.document),this.disposables.push(this.ipyWidgetMessageDispatcher.postMessage(this.cacheOrSend,this))),this.ipyWidgetMessageDispatcher}getIPyWidgetScriptSource(){return this.ipyWidgetScriptSource||(this.ipyWidgetScriptSource=new h_(this.document,this.serviceContainer.get(Ke),this.serviceContainer.get(O),this.serviceContainer.get(se),this.serviceContainer.get(ws),this.serviceContainer.get(v_),this.serviceContainer.get(on),this.serviceContainer.get(qa)),this.disposables.push(this.ipyWidgetScriptSource.postMessage(this.cacheOrSend,this))),this.ipyWidgetScriptSource}cacheOrSend(e){if(!this.listeningToPostMessageEvent){te("\x1B[32mQueuing messages (no listeners)"),this.cachedMessages.push(e);return}this.cachedMessages.forEach(t=>this.postEmitter.fire(t)),this.cachedMessages=[],this.postEmitter.fire(e)}};g([Br()],FC.prototype,"enableCDNForWidgets",1);var NF=class{constructor(e,t){this.editor=e;this.pendingMessages=[];this.disposables=[];this._onDidReceiveMessage=new b4.EventEmitter;this.changeController(t)}get controller(){if(!this._controller)throw new Error("No controller defined");return this._controller.controller}changeController(e){this._controller?.id!==e.id&&(this.controllerMessageHandler?.dispose(),this._controller=e,this.controllerMessageHandler=e.onDidReceiveMessage(t=>{t.editor===this.editor&&this.controller?.id===e.id&&(this.eventHandlerListening?(this.sendPendingMessages(),this._onDidReceiveMessage.fire(t.message)):this.pendingMessages.push(t.message))},this,this.disposables))}dispose(){G(this.disposables)}get onDidReceiveMessage(){return this.eventHandlerListening=!0,setTimeout(()=>this.sendPendingMessages(),0),this._onDidReceiveMessage.event}postMessage(e){return this.controller.postMessage(e,this.editor)}asWebviewUri(e){return this.controller.asWebviewUri(e)}sendPendingMessages(){if(this.pendingMessages.length){let e=this.pendingMessages.shift();for(;e;)this._onDidReceiveMessage.fire(e),e=this.pendingMessages.shift()}}},md=class{constructor(e,t,n,i){this.serviceContainer=e;this.disposableRegistry=t;this.notebook=n;this.controllerManager=i;this.messageCoordinators=new WeakMap;this.notebookDisposables=new WeakMap;this.notebookCommunications=new WeakMap;this.notebookEditors=new WeakMap}activate(){this.notebook.onDidChangeVisibleNotebookEditors(this.onDidChangeVisibleNotebookEditors,this,this.disposableRegistry),this.notebook.onDidCloseNotebookDocument(this.onDidCloseNotebookDocument,this,this.disposableRegistry),this.controllerManager.onControllerSelected(this.onDidSelectController,this,this.disposableRegistry)}onDidSelectController(e){let t=this.messageCoordinators.get(e.notebook);t&&(this.messageCoordinators.delete(e.notebook),this.notebook.notebookEditors.filter(n=>n.notebook===e.notebook).forEach(n=>{let i=this.notebookCommunications.get(n);this.notebookCommunications.delete(n),i&&i.controller!==e.controller.controller&&(this.notebookCommunications.delete(n),i&&i.dispose())}),t?.dispose()),this.notebook.notebookEditors.filter(n=>n.notebook===e.notebook).forEach(n=>this.initializeNotebookCommunication(n,e.controller))}initializeNotebookCommunication(e,t){if(e.notebook.isClosed||!Dt(e.notebook))return;let n=e.notebook;if(!t){w(`No controller, hence notebook communications cannot be initialized for editor ${W(e.notebook.uri)}`);return}if(this.notebookCommunications.has(e)){w(`notebook communications already initialized for editor ${W(e.notebook.uri)}`);return}w(`Initialize notebook communications for editor ${W(e.notebook.uri)}`);let i=new NF(e,t);this.addNotebookDisposables(n,[i]),this.notebookCommunications.set(e,i),w(`Resolving notebook UI Comms (resolve) for ${W(n.uri)}`);let o=this.messageCoordinators.get(n);o||(o=new FC(n,this.serviceContainer),this.messageCoordinators.set(n,o)),o.attach(i)}addNotebookDisposables(e,t){let n=this.notebookDisposables.get(e)||[];n.push(...t),this.notebookDisposables.set(e,n)}async onDidChangeVisibleNotebookEditors(e){e.forEach(t=>{let n=this.controllerManager.getSelected(t.notebook);this.initializeNotebookCommunication(t,n)})}onDidCloseNotebookDocument(e){let t=this.notebookEditors.get(e)||[];G(this.notebookDisposables.get(e)||[]),t.forEach(n=>this.notebookCommunications.get(n)?.dispose()),this.messageCoordinators.get(e)?.dispose(),this.messageCoordinators.delete(e)}};md=g([(0,df.injectable)(),p(0,(0,df.inject)(ct)),p(1,(0,df.inject)(O)),p(2,(0,df.inject)(qe)),p(3,(0,df.inject)(xt))],md);var fd=k(A());var Jy=class{constructor(e,t,n,i,o){this.disposables=e;this.kernelProvider=t;this.controllers=n;this.liveKernelTracker=i;this.preferredRemoteKernelIdProvider=o}activate(){this.kernelProvider.onDidStartKernel(this.onDidStartKernel,this,this.disposables),this.controllers.onControllerSelectionChanged(this.onNotebookControllerSelectionChanged,this,this.disposables)}onNotebookControllerSelectionChanged({selected:e,notebook:t,controller:n}){t.isClosed||(n.connection.kind==="connectToLiveRemoteKernel"&&n.connection.kernelModel.id&&(e?this.liveKernelTracker.trackKernelIdAsUsed(t.uri,n.connection.serverProviderHandle,n.connection.kernelModel.id):this.liveKernelTracker.trackKernelIdAsNotUsed(t.uri,n.connection.serverProviderHandle,n.connection.kernelModel.id)),mt(n.connection)&&this.preferredRemoteKernelIdProvider.clearPreferredRemoteKernelId(t.uri).catch(m))}onDidStartKernel(e){if(!e.resourceUri)return;let t=e.resourceUri;if(e.kernelConnectionMetadata.kind!=="startUsingRemoteKernelSpec")return;let n=e.kernelConnectionMetadata.serverProviderHandle,i=()=>{let o=e.session?.kernel?.id;!e.disposed&&!e.disposing&&o&&(w(`Updating preferred kernel for remote notebook ${o}`),this.preferredRemoteKernelIdProvider.storePreferredRemoteKernelId(t,o).catch(m),this.liveKernelTracker.trackKernelIdAsUsed(t,n,o))};i(),e.onDidKernelSocketChange(i,this,this.disposables)}};Jy=g([(0,fd.injectable)(),p(0,(0,fd.inject)(O)),p(1,(0,fd.inject)(Ke)),p(2,(0,fd.inject)(xt)),p(3,(0,fd.inject)(em)),p(4,(0,fd.inject)(rs))],Jy);var ff=k(A());var I4=require("vscode");var mf=class{constructor(e,t,n,i){this.disposables=e;this.uriStorage=t;this.controllers=n;this.serverProviderRegistry=i;this.handledServerProviderChanges=new WeakSet}activate(){this.serverProviderRegistry.jupyterCollections.forEach(e=>this.checkExpiredServersInJupyterCollection(e)),this.serverProviderRegistry.onDidChangeCollections(({added:e,removed:t})=>{e.forEach(n=>this.checkExpiredServersInJupyterCollection(n)),t.forEach(n=>this.removeControllersBelongingToDisposedProvider(n.extensionId,n.id))},this,this.disposables)}async checkExpiredServersInJupyterCollection(e){!this.handledServerProviderChanges.has(e.serverProvider)&&e.serverProvider.onDidChangeServers&&(this.handledServerProviderChanges.add(e.serverProvider),e.serverProvider.onDidChangeServers(()=>this.checkExpiredServersInJupyterCollection(e).catch(m),this,this.disposables));let t=new I4.CancellationTokenSource;this.disposables.push(t);try{let n=await Promise.resolve(e.serverProvider.provideJupyterServers(t.token));await this.removeControllersAndUriStorageBelongingToInvalidServers(e.extensionId,e.id,(n||[]).map(i=>i.id))}finally{t.dispose()}}async removeControllersAndUriStorageBelongingToInvalidServers(e,t,n){let i=await this.uriStorage.getAll();await Promise.all(i.filter(o=>o.provider.extensionId===e&&o.provider.id===t).map(async o=>{n.includes(o.provider.handle)||await this.uriStorage.remove(o.provider)})),this.controllers.registered.forEach(o=>{let s=o.connection;mt(s)||s.serverProviderHandle.extensionId!==e||s.serverProviderHandle.id!==t||n.includes(s.serverProviderHandle.handle)||(J(`Deleting controller ${o.id} as it is associated with a server Id that has been removed`),o.dispose())})}removeControllersBelongingToDisposedProvider(e,t){this.controllers.registered.forEach(n=>{let i=n.connection;mt(i)||i.serverProviderHandle.extensionId!==e||i.serverProviderHandle.id!==t||(J(`Deleting controller ${n.id} as it is associated with a Provider Id that has been removed`),n.dispose())})}};g([Br("Failed to check what servers were shutdown in Controller Watcher")],mf.prototype,"checkExpiredServersInJupyterCollection",1),mf=g([(0,ff.injectable)(),p(0,(0,ff.inject)(O)),p(1,(0,ff.inject)(cr)),p(2,(0,ff.inject)(xt)),p(3,(0,ff.inject)(Ut))],mf);var hd=k(A());var S4=require("vscode");var S_=class{constructor(e,t,n,i,o,s){this.label=e;this._description=t;this.detail=n;this.category=i;this.serverDisplayName=o;this.getDescription=s;this._onDidChange=new S4.EventEmitter;this.onDidChange=this._onDidChange.event}get description(){return this.getDescription?.()||this._description}set description(e){this._description=e}dispose(){this._onDidChange.dispose()}triggerChange(){this._onDidChange.fire(this)}};function x4(r){switch(r.kind){case"connectToLiveRemoteKernel":return y.kernelCategoryForJupyterSession;case"startUsingRemoteKernelSpec":return y.kernelCategoryForRemoteJupyterKernel;default:return x_(r)}}function x_(r){switch(r.kind){case"startUsingLocalKernelSpec":return y.kernelCategoryForJupyterKernel;case"startUsingPythonInterpreter":{if(Kn(r.kernelSpec)==="registeredByNewVersionOfExtForCustomKernelSpec")return y.kernelCategoryForJupyterKernel;switch(r.interpreter.envType){case"Conda":return r.interpreter.isCondaEnvWithoutPython?y.kernelCategoryForCondaWithoutPython:y.kernelCategoryForConda;case"PipEnv":return y.kernelCategoryForPipEnv;case"Poetry":return y.kernelCategoryForPoetry;case"Pyenv":return y.kernelCategoryForPyEnv;case"Venv":case"VirtualEnv":case"VirtualEnvWrapper":return y.kernelCategoryForVirtual;default:return y.kernelCategoryForGlobal}}default:return""}}var $y=class{constructor(e,t,n,i,o){this.workspace=e;this.platform=t;this.jupyterUriProviderRegistration=n;this.disposables=i;this.interpreters=o;this.details=new Map}getDisplayData(e){if(!this.details.get(e.id)){let i=gt(e),o=hA(e,this.workspace,this.platform);e.kind==="connectToLiveRemoteKernel"&&(o=fA(e));let s=x_(e),a=e.kind==="connectToLiveRemoteKernel"?()=>fA(e):void 0,l=new S_(i,o,"",s,void 0,a);if(this.disposables.push(l),this.details.set(e.id,l),e.kind==="startUsingPythonInterpreter"&&e.interpreter.isCondaEnvWithoutPython){let c=u=>{let d=u.find(h=>h.id===e.interpreter?.id),f=this.interpreters.resolvedEnvironments.find(h=>h.id===d?.id);if(e.kind==="startUsingPythonInterpreter"&&f){e.updateInterpreter(f);let h=gt(e),v=hA(e,this.workspace,this.platform),S=x_(e),b=!1;h!==l.label&&(l.label=h,b=!0),v!==l.description&&(l.description=v,b=!0),S!==l.category&&(l.category=S,b=!0),b&&l.triggerChange()}};this.interpreters.onDidChangeInterpreter(u=>u?c([u]):void 0,this,this.disposables)}}let t=this.details.get(e.id);if(this.details.set(e.id,t),e.kind==="connectToLiveRemoteKernel"||e.kind==="startUsingRemoteKernelSpec"){let i=ng(e.serverProviderHandle,this.jupyterUriProviderRegistration,y.kernelDefaultRemoteDisplayName);t.serverDisplayName!==i&&(t.serverDisplayName=i,t.triggerChange())}let n=x4(e);return t.category!==n&&(t.category=n,t.triggerChange()),t}};$y=g([(0,hd.injectable)(),p(0,(0,hd.inject)(ce)),p(1,(0,hd.inject)(Ir)),p(2,(0,hd.inject)(Ut)),p(3,(0,hd.inject)(O)),p(4,(0,hd.inject)(it))],$y);var Ja=k(A()),D_=require("vscode");var Su=k(A());var C4=require("vscode");function C_(r){try{return yk(wo(r))||r.getCells().find(t=>t.kind===C4.NotebookCellKind.Code)?.document.languageId}catch(e){J("Failed to determine language of first cell",e)}}var E4="DATASCIENCE.LAST_SAVED_CELL_LANGUAGE",cs=class{constructor(e,t,n,i){this.vscNotebook=e;this.disposables=t;this.globalMemento=n;this.pythonExtensionChecker=i}getPreferredLanguage(e){let t=e?.language_info?.name||e?.kernelspec?.language||this.lastSavedNotebookCellLanguage,n=this.pythonExtensionChecker.isPythonExtensionInstalled?xe:"plaintext";return Ts(t||n)}activate(){this.vscNotebook.onDidSaveNotebookDocument(this.onDidSaveNotebookDocument,this,this.disposables)}getSupportedLanguages(e){if(Vt(e))return oW;{let t=Ts(oo(e)||"");return t&&RS.includes(t.toLowerCase())?[t,"raw"]:[]}}get lastSavedNotebookCellLanguage(){return this.globalMemento.get(E4)}async onDidSaveNotebookDocument(e){if(!Dt(e))return;let t=C_(e);t&&t!==this.lastSavedNotebookCellLanguage&&await this.globalMemento.update(E4,t)}};g([Br("Saving last saved cell language")],cs.prototype,"onDidSaveNotebookDocument",1),cs=g([(0,Su.injectable)(),p(0,(0,Su.inject)(qe)),p(1,(0,Su.inject)(O)),p(2,(0,Su.inject)(He)),p(2,(0,Su.named)(It)),p(3,(0,Su.inject)(ze))],cs);function w4(r){let e={kernelSpecCount:0,localKernelSpecCount:0,remoteKernelSpecCount:0,kernelInterpreterCount:0,kernelLiveCount:0};r.forEach(t=>{switch(t.kind){case"connectToLiveRemoteKernel":e.kernelLiveCount+=1;break;case"startUsingRemoteKernelSpec":e.localKernelSpecCount+=1,e.kernelSpecCount+=1;break;case"startUsingLocalKernelSpec":e.remoteKernelSpecCount+=1,e.kernelSpecCount+=1;break;case"startUsingPythonInterpreter":{e.kernelInterpreterCount+=1;break}default:break}}),R("DS_INTERNAL.KERNEL_COUNT",{...e})}var Er=require("vscode");var Gy=require("vscode");var Hy=Symbol("INotebookCompletionProvider"),Tn=Symbol("INotebookEditorProvider");async function k4(r,e,t){let n=e?.findNotebookEditor(r);return n?t.executeCommand("notebook.selectKernel",{notebookEditor:n}):(C("Unable to select kernel as the Notebook document could not be identified"),!1)}var P4=require("vscode");var E_=class extends El{constructor(e){super(y.failedToStartAnUntrustedKernelSpec(gt(e),e.kernelSpec.specFile?W(P4.Uri.file(e.kernelSpec.specFile)):""),void 0,e)}};var Ys=class r{static async switchController(e,t){let n=t.get(Fe),o=t.get(Tn).findNotebookEditor(e),s=t.get(xt),a,l=pe(),c=s.onControllerSelected(d=>l.resolve(d.controller));return await k4(e,t.get(Tn),n)&&o&&(a=await l.promise),c.dispose(),a?{controller:a.controller,metadata:a.connection}:void 0}static async notifyAndRestartDeadKernel(e,t){let n=t.get(ue),i=t.get(Fe),o=await n.showErrorMessage(y.cannotRunCellKernelIsDead(gt(e.kernelConnectionMetadata)),{modal:!0},y.showJupyterLogs,y.restartKernel),s=!1;switch(o){case y.restartKernel:{await e.restart(),s=!0;break}case y.showJupyterLogs:i.executeCommand(V.ViewJupyterOutput).then(m,m)}return s}static async handleKernelError(e,t,n,i,o,s,a,l){let c=e.get(He,It),u=e.get(an);a.interpreter&&n==="start"&&x6(c,19,a.interpreter.uri).catch(m);let d=await u.handleKernelError(t,n,a,i,l),f=mt(a);switch(e.tryGet(wi)?.isSupported&&f&&n==="start"&&Rt(i,"DS_INTERNAL.RAWKERNEL_SESSION_NO_IPYKERNEL",{reason:d}),o.dispose().catch(m),d){case 1:case 2:throw t;case 3:{let S=await r.switchController(i,e);if(!S)throw t;s=S.controller,a=S.metadata;break}}return{controller:s,metadata:a}}static convertContextToFunction(e,t){switch(e){case"start":case"execution":return n=>n.start(t);case"interrupt":return n=>n.interrupt();case"restart":return n=>n.restart()}}static{this.connectionsByNotebook=new WeakMap}static{this.connectionsByUri=new Map}static async verifyKernelState(e,t,n,i,o,s,a){let{kernel:l,deadKernelAction:c}=await i;if(CT(l)){if(this.deleteKernelInfo(t,i),c==="deadKernelWasNoRestarted")throw new Yp(l.kernelConnectionMetadata);return c==="deadKernelWasRestarted"?l:r.wrapKernelMethod(l.kernelConnectionMetadata,"start",o,e,t,n,a,s)}return l}static async wrapKernelMethod(e,t,n,i,o,s,a,l=()=>void 0){let c=this.getKernelInfo(o);if(!s.disableUI&&c?.options.disableUI&&(c.options.disableUI=!1),!s.disableUI&&c?.kernel.resolved&&(c?.kernel.value?.kernel?.disposed||c?.kernel.value?.kernel?.disposing)&&(this.deleteKernelInfo(o),c=void 0),c&&t!=="restart"&&t!=="interrupt")return r.verifyKernelState(i,o,s,c.kernel.promise,n,l,a);w(`${t} the kernel, options.disableUI=${s.disableUI} for ${W("notebook"in o?o.notebook.uri:o.resource)}`);let u=r.wrapKernelMethodImpl(e,t,i,o,s,n,l),d=Vu(u);return d.promise.catch(m),u.then(f=>{f.kernel.onDisposed(()=>{this.deleteKernelInfo(o,d.promise)},void 0,a)}).catch(()=>{this.deleteKernelInfo(o,d.promise)}),this.setKernelInfo(o,d,s),r.verifyKernelState(i,o,s,d.promise,n,l,a)}static getKernelInfo(e){return"notebook"in e?r.connectionsByNotebook.get(e.notebook):r.connectionsByUri.get(e.resource.toString())}static setKernelInfo(e,t,n){"notebook"in e?r.connectionsByNotebook.set(e.notebook,{kernel:t,options:n}):r.connectionsByUri.set(e.resource.toString(),{kernel:t,options:n})}static deleteKernelInfo(e,t){if(!t){"notebook"in e?r.connectionsByNotebook.delete(e.notebook):r.connectionsByUri.delete(e.resource.toString());return}"notebook"in e&&r.connectionsByNotebook.get(e.notebook)?.kernel.promise===t?r.connectionsByNotebook.delete(e.notebook):e.resource&&r.connectionsByUri.get(e.resource.toString())?.kernel.promise===t&&r.connectionsByUri.delete(e.resource.toString())}static verifyWeCanStartKernel(e,t){if(!mt(e)||!e.kernelSpec.specFile)return;if(!t.get(cd).isTrusted(Gy.Uri.file(e.kernelSpec.specFile)))throw new E_(e)}static async wrapKernelMethodImpl(e,t,n,i,o,s,a){let l=n.get(Ke),c=n.get(um),u,d=r.convertContextToFunction(t,o),f=t,h="controller"in i?i.controller:void 0;for(t==="start"&&r.verifyWeCanStartKernel(e,n);u===void 0;){if("notebook"in i&&i.notebook.isClosed)throw new Gy.CancellationError;u="notebook"in i?l.getOrCreate(i.notebook,{metadata:e,controller:h||i.controller,resourceUri:i.resource}):c.getOrCreate(i.resource,{metadata:e,resourceUri:i.resource});try{if(t!=="restart"&&CT(u)&&!o.disableUI){let v=await r.notifyAndRestartDeadKernel(u,n);return{kernel:u,deadKernelAction:v?"deadKernelWasRestarted":"deadKernelWasNoRestarted"}}else{if(a(f,u),await d(u),"notebook"in i&&i.notebook.isClosed)throw new Gy.CancellationError;CT(u)&&!o.disableUI&&await r.notifyAndRestartDeadKernel(u,n)}}catch(v){if(br(v)||J(`Error occurred while trying to ${f} the kernel, options.disableUI=${o.disableUI}`,v),o.disableUI)throw v;if("notebook"in i&&i.notebook.isClosed)throw new Gy.CancellationError;let S=await r.handleKernelError(n,v,f,i.resource,u,h,e,s);if(h=S.controller,e=S.metadata,d=b=>b.start(o),f="start",s==="3rdPartyExtension")throw v;u=void 0}}return{kernel:u}}static async connectToNotebookKernel(e,t,n,i,o,s="jupyterExtension",a=()=>void 0){return r.wrapKernelMethod(e,"start",s,t,n,i,o,a)}static async connectToKernel(e,t,n,i,o,s="jupyterExtension",a=()=>void 0){return r.wrapKernelMethod(e,"start",s,t,n,i,o,a)}};var hf=class{constructor(e){this.controller=e}get id(){return this.controller.id}createNotebookCellExecution(e){return this.controller.createNotebookCellExecution(e)}};var k_=require("vscode");var w_=class extends Mr{constructor(t,n,i){super();this.kernel=t;this.controller=n;this.notebook=i}initialize(){let t=this.kernel,n=this.controller,i=this.notebook;if(t.kernelConnectionMetadata.kind!=="connectToLiveRemoteKernel"||t.status!=="busy"&&t.status!=="unknown"||!n.createNotebookExecution)return;this._register(k_.workspace.onDidCloseNotebookDocument(s=>{s===i&&this.dispose()},this)),this._register(n.onDidChangeSelectedNotebooks(s=>{s.notebook===i&&s.selected===!1&&this.dispose()},this)),this._register(t.onStatusChanged(s=>{s!=="busy"&&s!=="unknown"&&this.dispose()},this));let o=n.createNotebookExecution(i);o.start(),this._register(new k_.Disposable(()=>o.end()))}};var P_=class r{constructor(e,t,n,i,o,s,a,l,c,u,d,f,h,v,S,b,D){this.kernelConnection=e;this._viewType=n;this.notebookApi=i;this.commandManager=o;this.kernelProvider=s;this.context=a;this.languageService=c;this.workspace=u;this.configuration=d;this.documentManager=f;this.appShell=h;this.browser=v;this.extensionChecker=S;this.serviceContainer=b;this.displayDataProvider=D;this._onNotebookControllerSelectionChanged=new Er.EventEmitter;this._onConnecting=new Er.EventEmitter;this.pendingCellAdditions=new Map;this._onDidDispose=new Er.EventEmitter;this.disposables=[];this.notebookKernels=new WeakMap;this.isDisposed=!1;this.runningCellExecutions=new Map;this.associatedDocuments=new WeakMap;this.restoredConnections=new WeakSet;l.push(this),this._onNotebookControllerSelected=new Er.EventEmitter,this.displayData=this.displayDataProvider.getDisplayData(this.connection),this.controller=this.notebookApi.createNotebookController(t,n,this.displayData.label,this.handleExecution.bind(this),this.getRendererScripts(),[]),this.displayData.onDidChange(this.updateDisplayData,this,this.disposables),this.updateDisplayData(),this.controller.interruptHandler=this.handleInterrupt.bind(this),this.controller.supportsExecutionOrder=!0,this.controller.supportedLanguages=this.languageService.getSupportedLanguages(e),this.controller.onDidChangeSelectedNotebooks(this.onDidChangeSelectedNotebooks,this,this.disposables),this.notebookApi.onDidCloseNotebookDocument(_=>{this.associatedDocuments.delete(_)},this,this.disposables)}get id(){return this.controller.id}get label(){return this.controller.label}get connection(){return this.kernelConnection}get viewType(){return this._viewType}get onNotebookControllerSelected(){return this._onNotebookControllerSelected.event}get onNotebookControllerSelectionChanged(){return this._onNotebookControllerSelectionChanged.event}get onConnecting(){return this._onConnecting.event}get onDidReceiveMessage(){return this.controller.onDidReceiveMessage}get onDidDispose(){return this._onDidDispose.event}isAssociatedWithDocument(e){return this.associatedDocuments.has(e)}static create(e,t,n,i,o,s,a,l,c,u,d,f,h,v,S,b,D){return new r(e,t,n,i,o,s,a,l,c,u,d,f,h,v,S,b,D)}async restoreConnection(e){if(this.restoredConnections.has(e))return;this.restoredConnections.add(e);let t=await this.connectToKernel(e,new er(!0));if(this.kernelConnection.kind==="connectToLiveRemoteKernel"){let u=new w_(t,this.controller,e);this.disposables.push(u),u.initialize()}let n=this.kernelProvider.getKernelExecution(t),o=await this.serviceContainer.get(Ba).getLastTrackedCellExecution(e,t);if(!t.session?.kernel||n.pendingCells.length||!o||e.cellCount<o.cellIndex||e.cellAt(o.cellIndex).kind!==Er.NotebookCellKind.Code)return;let s=!1,a=[],l,c=(u,d)=>{if(!(d.direction==="send"||s)&&uu(d.msg)===o.msg_id){if("msg_type"in d.msg&&d.msg.msg_type==="status"&&"execution_state"in d.msg.content&&d.msg.content.execution_state==="idle")return;s=!0,n.resumeCellExecution(e.cellAt(o.cellIndex),{msg_id:o.msg_id,startTime:o.startTime,executionCount:o.executionCount}).catch(m),G(a)}};t.session.kernel.anyMessage.connect(c),l=new Er.Disposable(()=>{kn(()=>t.session?.kernel?.anyMessage.disconnect(c))}),a.push(l),this.disposables.push(l)}updateConnection(e){e.kind!=="connectToLiveRemoteKernel"&&(this.controller.label=gt(e))}asWebviewUri(e){return this.controller.asWebviewUri(e)}postMessage(e,t){let n=e&&"message"in e?e.message:"";return te(`\x1B[32mPosting message to Notebook UI ${n}`),this.controller.postMessage(e,t)}setPendingCellAddition(e,t){if(this.viewType!==wt)throw new Error("setPendingCellAddition only applies to the Interactive Window");this.pendingCellAdditions.set(e,t)}dispose(){if(this.isDisposed)return;let e=this.notebookApi.notebookDocuments.filter(t=>this.associatedDocuments.has(t)).map(t=>t.uri.toString());w(`Disposing controller ${this.id} associated with connection ${this.connection.id} ${e.length?"and documents "+e.join(", "):""}`),te(`Disposing controller ${this.id} associated with connection ${this.connection.id} ${e.length?"and documents "+e.join(", "):""} called from ${new Error("").stack}`),this.isDisposed=!0,this._onNotebookControllerSelected.dispose(),this._onNotebookControllerSelectionChanged.dispose(),this._onConnecting.dispose(),this.controller.dispose(),this._onDidDispose.fire(),this._onDidDispose.dispose(),G(this.disposables)}updateDisplayData(){this.controller.label=this.displayData.label;let e=this.connection.kind==="connectToLiveRemoteKernel"?"":this.displayData.description;this.controller.description=e,this.displayData.serverDisplayName&&(this.controller.description=e?`${e} (${this.displayData.serverDisplayName})`:this.displayData.serverDisplayName)}async handleExecution(e,t){e.length<1||(this.pendingCellAdditions.has(t)&&await this.pendingCellAdditions.get(t),e=e.filter(n=>n.index<0?(J(`Attempting to run a cell with index ${n.index}, kind ${n.kind}, text = ${n.document.getText()}`),!1):!0),this.workspace.isTrusted&&(H(`Handle Execution of Cells ${e.map(n=>n.index)} for ${W(t.uri)}`),await is(t.uri,this.connection),await Promise.all(e.map(n=>this.executeCell(t,n)))))}warnWhenUsingOutdatedPython(){let e=this.kernelConnection.interpreter?.version;!e||e.major>=4||this.kernelConnection.kind!=="startUsingLocalKernelSpec"&&this.kernelConnection.kind!=="startUsingPythonInterpreter"||(e.major<3||e.major===3&&e.minor<=5)&&this.appShell.showWarningMessage(y.warnWhenSelectingKernelWithUnSupportedPythonVersion,ye.learnMore).then(t=>{if(t===ye.learnMore)return this.browser.launch("https://aka.ms/jupyterUnSupportedPythonKernelVersions")},m)}async onDidChangeSelectedNotebooks(e){if(te(`NotebookController selection event called for notebook ${e.notebook.uri.toString()} & controller ${this.connection.kind}:${this.id}. Selected ${e.selected} `),this.associatedDocuments.has(e.notebook)&&e.selected)return;if(!e.selected){let n=this.kernelProvider.get(e.notebook);n?.kernelConnectionMetadata.id===this.kernelConnection.id&&(H(`Disposing kernel ${this.kernelConnection.id} for notebook ${W(e.notebook.uri)} due to selection of another kernel or closing of the notebook`),n.dispose().catch(m)),this.associatedDocuments.delete(e.notebook),this._onNotebookControllerSelectionChanged.fire(e);return}if(!Dt(e.notebook)&&e.notebook.notebookType!==wt||!this.workspace.isTrusted)return;this.warnWhenUsingOutdatedPython();let t=pe();te(`Controller ${this.connection.kind}:${this.id} associated with nb ${W(e.notebook.uri)}`),this.associatedDocuments.set(e.notebook,t.promise),await this.onDidSelectController(e.notebook),await this.updateCellLanguages(e.notebook),this._onNotebookControllerSelected.fire({notebook:e.notebook,controller:this}),this._onNotebookControllerSelectionChanged.fire(e),w("Controller selection change completed"),t.resolve()}async updateCellLanguages(e){let t=this.controller.supportedLanguages;if(!t||t?.length===0)return;let i=Vt(this.kernelConnection)?xe:t[0];await Promise.all(e.getCells().filter(o=>o.kind===Er.NotebookCellKind.Code).map(async o=>{t.includes(o.document.languageId)||await Er.languages.setTextDocumentLanguage(o.document,i).then(m,m)}))}getRendererScripts(){return this.context.extensionMode===Er.ExtensionMode.Development||this.context.extensionMode===Er.ExtensionMode.Test?[new Er.NotebookRendererScript(Er.Uri.joinPath(this.context.extensionUri,"dist","webviews","webview-side","widgetTester","widgetTester.js"))]:[]}handleInterrupt(e){w(`VS Code interrupted kernel for ${W(e.uri)}`),e.getCells().forEach(t=>yt(t,"Cell cancellation requested")),this.commandManager.executeCommand(V.InterruptKernel,{notebookEditor:{notebookUri:e.uri}}).then(m,t=>C("Failed to interrupt",t))}createCellExecutionIfNecessary(e,t){let n=this.runningCellExecutions.get(e.notebook);if(!n||n.cell===e){n?.end(void 0,void 0),n=Bo.getOrCreate(e,t,!0),this.runningCellExecutions.set(e.notebook,n);let i=n.end.bind(n);n.end=(o,s)=>{this.runningCellExecutions.delete(e.notebook),i(o,s)}}return n}async executeCell(e,t,n){let i=new qo,o=i.add(new Er.CancellationTokenSource);i.add(Er.workspace.onDidCloseNotebookDocument(f=>f===e?o.cancel():void 0));let s=this.createCellExecutionIfNecessary(t,new hf(this.controller)),a="start",l,c=new hf(this.controller),u=!1,d=this.serviceContainer.get(Ba);try{if(l=await this.connectToKernel(e,new er(!1)),l.disposing)throw new Er.CancellationError;u=!0,l&&l.controller.id!==c.id&&(c=l.controller,s=this.createCellExecutionIfNecessary(t,l.controller)),a="execution",l.controller.id===this.id&&this.updateKernelInfoInNotebookWhenAvailable(l,e),d.trackCellExecution(t,l);let f=this.kernelProvider.getKernelExecution(l).executeCell(t,n);return f.then(h=>{if(l&&!wS.isExiting&&h!=="Idle")return d.deleteTrackedCellExecution(t,l)}).catch(m),await f}catch(f){br(f)||C("Error in execution",f),u||(s.start(),s.clearOutput(t).then(m,m));let h=this.serviceContainer.get(an);f=hn.unwrap(f);let v=br(f)||f instanceof Yp;await fp(t,c,await h.getErrorMessageForDisplayInCell(f,a,e.uri),v)}}async connectToKernel(e,t){return this._onConnecting.fire(),Ys.connectToNotebookKernel(this.kernelConnection,this.serviceContainer,{resource:e.uri,notebook:e,controller:this.controller},t,this.disposables)}updateKernelInfoInNotebookWhenAvailable(e,t){if(this.notebookKernels.get(t)===e)return;this.notebookKernels.set(t,e);let n=[];this.notebookApi.onDidCloseNotebookDocument(s=>{s===t&&G(n)},this,n);let i=e.onDisposed(()=>G(n)),o=e.onStatusChanged(async()=>{e.disposed||!e.info||this.associatedDocuments.has(t)&&(await D4(t,this.documentManager,e.kernelConnectionMetadata,e.info),e.info.status==="ok"&&G(n))});n.push({dispose:()=>o.dispose()}),n.push({dispose:()=>i?.dispose()})}async onDidSelectController(e){let t=this.connection,n=this.kernelProvider.get(e);if(n&&TV(n.kernelConnectionMetadata,t)){H("Switch kernel did not change kernel.");return}if(Rt(e.uri,"DS_INTERNAL.SWITCH_KERNEL"),n&&this.notebookApi.notebookEditors.filter(s=>s.notebook===e).forEach(s=>this.postMessage({message:"IPyWidgets_onKernelChanged",payload:void 0},s)),await D4(e,this.documentManager,t),e.notebookType===wt)return;let i=this.kernelProvider.getOrCreate(e,{metadata:t,controller:this.controller,resourceUri:e.uri});if(w(`KernelProvider switched kernel to id = ${i.kernelConnectionMetadata.id}`),Vt(this.kernelConnection)&&!this.extensionChecker.isPythonExtensionInstalled)return;let o=this.serviceContainer.get(cd);!this.configuration.getSettings(void 0).disableJupyterAutoStart&&mt(this.kernelConnection)&&this.kernelConnection.kernelSpec.specFile&&o.isTrusted(Er.Uri.file(this.kernelConnection.kernelSpec.specFile))&&this.connectToKernel(e,new er(!0)).catch(m)}};async function D4(r,e,t,n){let i=wo(r)||{},{changed:o}=await fk(i,t,n);if(o){let s=new Er.WorkspaceEdit,a=JSON.parse(JSON.stringify(r.metadata||{custom:{}}));a.custom=a.custom||{},a.custom.metadata=i,s.set(r.uri,[Er.NotebookEdit.updateNotebookMetadata({...r.metadata||{},custom:a.custom})]),await e.applyEdit(s)}}var zy=class{constructor(e,t,n,i,o,s,a,l){this.notebook=e;this.disposables=t;this.pythonEnvFilter=n;this.workspace=i;this.extensionChecker=o;this.serviceContainer=s;this.serverUriStorage=a;this.kernelFinder=l;this.registeredControllers=new Map;this.changeEmitter=new D_.EventEmitter;this.registeredMetadatas=new Map;this.selectedEmitter=new D_.EventEmitter;this.selectionChangedEmitter=new D_.EventEmitter;this.selectedControllers=new Map;this._activeInterpreterControllerIds=new Set}get onDidChange(){return this.changeEmitter.event}get registered(){return[...this.registeredControllers.values()]}get all(){return this.metadatas}get metadatas(){return[...this.registeredMetadatas.values()]}get onControllerSelected(){return this.selectedEmitter.event}get onControllerSelectionChanged(){return this.selectionChangedEmitter.event}activate(){this.kernelFinder.onDidChangeKernels(()=>this.loadControllers(),this,this.disposables),this.kernelFinder.registered.forEach(e=>this.monitorDeletionOfConnections(e)),this.kernelFinder.onDidChangeRegistrations(e=>e.added.forEach(t=>this.monitorDeletionOfConnections(t)),this,this.disposables),this.pythonEnvFilter.onDidChange(this.onDidChangeFilter,this,this.disposables),this.serverUriStorage.onDidChange(this.onDidChangeFilter,this,this.disposables),this.serverUriStorage.onDidChange(this.onDidChangeUri,this,this.disposables),this.serverUriStorage.onDidRemove(this.onDidRemoveServers,this,this.disposables),this.onDidChange(({added:e})=>{e.forEach(t=>{t.onNotebookControllerSelectionChanged(n=>{!n.selected&&this.isFiltered(t.connection)&&this.canControllerBeDisposed(t)&&(J(`Removing controller ${t.id} for ${t.connection.kind} from kernel list`),t.dispose())},this,this.disposables)})},this,this.disposables),this.notebook.onDidOpenNotebookDocument(this.onDidOpenNotebookDocument,this,this.disposables),this.notebook.notebookDocuments.forEach(e=>this.onDidOpenNotebookDocument(e).catch(m)),this.loadControllers()}loadControllers(){this.controllersPromise=this.loadControllersImpl(),w4(this.registered.map(e=>e.connection)),te(`Providing notebook controllers with length ${this.registered.length}.`)}get loaded(){return this.controllersPromise}async onDidOpenNotebookDocument(e){e.notebookType!==Ct&&e.notebookType!==wt||this.workspace.isTrusted}async loadControllersImpl(){let e=this.kernelFinder.kernels;this.createNotebookControllers(e),Array.from(this.registered).filter(n=>{let i=e.some(o=>o.id===n.connection.id)||fi&&this._activeInterpreterControllerIds.has(n.id);return!i&&n.connection.kind==="connectToLiveRemoteKernel"?!0:this.canControllerBeDisposed(n)?(i||w(`Controller ${n.connection.kind}:'${n.id}' for view = '${n.viewType}' is no longer a valid`),!i):!1}).forEach(n=>{J(`Disposing old controller ${n.connection.kind}:'${n.id}' for view = '${n.viewType}'`),n.dispose()})}createNotebookControllers(e){if(e.length!==0)try{this.batchAdd(e,[Ct,wt])}catch(t){if(!br(t,!0))throw t}}async monitorDeletionOfConnections(e){let t=e.onDidChangeKernels(({removed:n})=>{let i=new Set((n||[]).map(o=>o.id));this.registered.filter(o=>i.has(o.connection.id)).forEach(o=>{J(`Deleting controller ${o.id} as it is associated with a connection that has been deleted ${o.connection.kind}:${o.id}`),o.dispose()})},this,this.disposables);this.kernelFinder.onDidChangeRegistrations(n=>{n.removed.includes(e)&&t.dispose()})}onDidChangeUri(){this.onDidChangeFilter()}async onDidRemoveServers(e){e.forEach(t=>{this.registered.forEach(n=>{Ft(n.connection)&&n.connection.serverProviderHandle.id===t.id&&n.connection.serverProviderHandle.handle===t.handle&&(J(`Deleting controller ${n.id} as it is associated with a connection that has been removed`),n.dispose())})}),this.onDidChangeFilter()}onDidChangeFilter(){this.all.filter(t=>!this.isFiltered(t)).forEach(t=>this.addOrUpdate(t,[Ct,wt])),this.registered.forEach(t=>{this.isFiltered(t.connection)&&this.canControllerBeDisposed(t)&&(J(`Deleting controller ${t.id} as it is associated with a connection that has been hidden`),t.dispose())})}batchAdd(e,t){let n=[];e.forEach(i=>{let{added:o}=this.addImpl(i,t,!1);n.push(...o)}),n.length&&this.changeEmitter.fire({added:n,removed:[]})}trackActiveInterpreterControllers(e){e.forEach(t=>this._activeInterpreterControllerIds.add(t.id))}canControllerBeDisposed(e){return!this._activeInterpreterControllerIds.has(e.id)&&!this.isControllerAttachedToADocument(e)}getSelected(e){return this.selectedControllers.get(e.uri.toString())}addOrUpdate(e,t){let{added:n,existing:i}=this.addImpl(e,t,!0);return n.concat(i)}addImpl(e,t,n){let i=[],o=[];te(`Create Controller for ${e.kind} and id '${e.id}' for view ${t.join(", ")}`);try{t.map(s=>{let a=this.getControllerId(e,s);return this.registeredMetadatas.set(e.id,e),[a,s]}).filter(([s])=>{let a=this.registeredControllers.get(s);return a?(a.updateConnection(e),o.push(a),te(`Found existing controller '${a.id}', not creating a new one just updating it`),!1):this.isFiltered(e)?(te(`Existing controller '${s}' will be excluded as it is filtered`),!1):(te(`Existing controller not found for '${s}', hence creating a new one`),!0)}).forEach(([s,a])=>{let l=P_.create(e,s,a,this.notebook,this.serviceContainer.get(Fe),this.serviceContainer.get(Ke),this.serviceContainer.get(dt),this.disposables,this.serviceContainer.get(cs),this.workspace,this.serviceContainer.get(se),this.serviceContainer.get(lr),this.serviceContainer.get(ue),this.serviceContainer.get(ks),this.extensionChecker,this.serviceContainer,this.serviceContainer.get(vp)),c=[];l.onDidDispose(()=>{te(`Deleting controller '${l.id}' associated with view ${a} from registration as it was disposed`),this.registeredControllers.delete(l.id),c.forEach(u=>u.dispose())},this,this.disposables),this.disposables.push(l),this.registeredControllers.set(l.id,l),i.push(l),l.onNotebookControllerSelected(u=>{te(`Controller ${u.controller?.id} selected for ${u.notebook.uri.toString()}`),this.selectedControllers.set(u.notebook.uri.toString(),u.controller),this.selectedEmitter.fire(u)},this,c),l.onNotebookControllerSelectionChanged(u=>this.selectionChangedEmitter.fire({...u,controller:l}),this,c)}),n&&i.length&&this.changeEmitter.fire({added:i,removed:[]})}catch(s){if(br(s,!0))return{added:i,existing:o};C(`Failed to create notebook controller for ${e.id}`,s)}return{added:i,existing:o}}get(e,t){let n=this.getControllerId(e,t);return this.registeredControllers.get(n)}isFiltered(e){return!1}getControllerId(e,t){return t===Ct?e.id:`${e.id}${LV}`}isControllerAttachedToADocument(e){return this.notebook.notebookDocuments.some(t=>e.isAssociatedWithDocument(t))}};zy=g([(0,Ja.injectable)(),p(0,(0,Ja.inject)(qe)),p(1,(0,Ja.inject)(O)),p(2,(0,Ja.inject)(xi)),p(3,(0,Ja.inject)(ce)),p(4,(0,Ja.inject)(ze)),p(5,(0,Ja.inject)(ct)),p(6,(0,Ja.inject)(cr)),p(7,(0,Ja.inject)(Wr))],zy);var xu=k(A());var T_=class{constructor(e,t,n){this.kernel=e;this.localResourceUriConverter=t;this.scriptManagerFactory=n}async getWidgetScriptSource(e){return(await this.getWidgetScriptSources()).find(i=>i.moduleName.toLowerCase()===e.toLowerCase())||{moduleName:e}}dispose(){}async getWidgetScriptSources(){let t=await this.scriptManagerFactory.getOrCreate(this.kernel).getWidgetModuleMappings();return t&&Object.keys(t).length?await Promise.all(Object.keys(t).map(async i=>{let o=(await this.localResourceUriConverter.asWebviewUri(t[i])).toString();return{moduleName:i,scriptUri:o,source:"local"}})):[]}async getBaseUrl(){let e=this.scriptManagerFactory.getOrCreate(this.kernel);if(!e.getBaseUrl)return;let t=await e.getBaseUrl();if(t)return this.localResourceUriConverter.asWebviewUri(t)}};var T4=require("vscode"),__=class{static{this.validUrls=new Map}constructor(e,t){if(e.kernelConnectionMetadata.kind!=="connectToLiveRemoteKernel"&&e.kernelConnectionMetadata.kind!=="startUsingRemoteKernelSpec")throw new Error("Invalid usage of this class, can only be used with remtoe kernels");this.kernelConnection=e.kernelConnectionMetadata,this.scriptManager=t.getOrCreate(e)}dispose(){}async getBaseUrl(){return T4.Uri.parse(this.kernelConnection.baseUrl)}async getWidgetScriptSource(e){let n=(await this.getWidgetScriptSources()).find(i=>i.moduleName.toLowerCase()===e.toLowerCase());if(!n&&e.includes("/")){let i=await this.getBaseUrl();return{moduleName:e,scriptUri:`${i.toString()}${e}`,source:"remote"}}return n||{moduleName:e}}async getWidgetScriptSources(){let e=await this.scriptManager.getWidgetModuleMappings();return e&&Object.keys(e).length?await Promise.all(Object.keys(e).map(async n=>({moduleName:n,scriptUri:e[n].toString(),source:"remote"}))):[]}};var Qy=class{constructor(e,t,n,i){this.configurationSettings=e;this.widgetScriptManagerFactory=t;this.appShell=n;this.globalMemento=i}getProviders(e,t,n){let i=[];switch(i.push(new qa(this.appShell,this.globalMemento,this.configurationSettings,n)),e.kernelConnectionMetadata.kind){case"connectToLiveRemoteKernel":case"startUsingRemoteKernelSpec":i.push(new __(e,this.widgetScriptManagerFactory));break;default:i.push(new T_(e,t,this.widgetScriptManagerFactory))}return i}};Qy=g([(0,xu.injectable)(),p(0,(0,xu.inject)(se)),p(1,(0,xu.inject)(b_)),p(2,(0,xu.inject)(ue)),p(3,(0,xu.inject)(He)),p(3,(0,xu.named)(It))],Qy);var _4=k(A()),R_=require("vscode");var Yy=class{async getNbExtensionsParentPath(e){switch(e.kernelConnectionMetadata.kind){case"connectToLiveRemoteKernel":case"startUsingRemoteKernelSpec":return R_.Uri.parse(e.kernelConnectionMetadata.baseUrl);case"startUsingPythonInterpreter":return R_.Uri.joinPath(R_.Uri.file(e.kernelConnectionMetadata.interpreter.sysPrefix),"share","jupyter");default:return}}};Yy=g([(0,_4.injectable)()],Yy);var Cu=k(A());var gf=require("vscode");var OF=require("vscode");var B4=k(j4());var V4=["require.config({","requirejs?.config({","window.requirejs?.config({","requirejs.config({",'["require"].config({',"['require'].config({",'["requirejs"].config({',"['requirejs'].config({",'["require"]["config"]({',"['require']['config']({",'["requirejs"]["config"]({',"['requirejs']['config']({"];async function lve(r,e,t){let n=[...V4],i=await ht(e),o=0,s;for(;o<=0&&n.length&&(s=n.pop(),!!s);)o=t.indexOf(s);if(o<0){let f=[...V4].map(h=>h.substring(0,h.length-2));for(;o<=0&&f.length&&(s=f.pop(),!!s);)o=t.indexOf(s)}if(o<0){R("DS_INTERNAL.IPYWIDGET_EXTENSIONJS_INFO",void 0,{widgetFolderNameHash:i,failed:!0,patternUsedToRegisterRequireConfig:s,failure:"couldNotLocateRequireConfigStart"});return}let a=t.indexOf(")",o);if(a<=0||!s){R("DS_INTERNAL.IPYWIDGET_EXTENSIONJS_INFO",void 0,{widgetFolderNameHash:i,failed:!0,patternUsedToRegisterRequireConfig:s,failure:"couldNotLocateRequireConfigEnd"});return}let l=t.indexOf("{",o),c=t.substring(l,a);c=(0,B4.default)(c,{language:"javascript"}),c=je(c,{trim:!0,removeEmptyEntries:!0}).join("");let u=c.split("{")[c.split("{").length-1].split("}")[0].split(",").map(f=>f.trim()).filter(f=>f.length&&f.includes(":")),d={};if(u.forEach(f=>{let h=f.split(":"),v=Hd(h[0].replace(/\\r/g,"").replace(/\\n/g,"").trim()).trim(),S=Hd(f.substring(f.indexOf(":")+1).replace(/\\r/g,"").replace(/\\n/g,"").trim()).trim();d[v]=S.startsWith("http")?OF.Uri.parse(S):OF.Uri.joinPath(r,S)}),!d||!Object.keys(d).length){R("DS_INTERNAL.IPYWIDGET_EXTENSIONJS_INFO",void 0,{widgetFolderNameHash:i,failed:!0,patternUsedToRegisterRequireConfig:s,failure:"noRequireConfigEntries"});return}return R("DS_INTERNAL.IPYWIDGET_EXTENSIONJS_INFO",{requireEntryPointCount:Object.keys(d).length},{widgetFolderNameHash:i,patternUsedToRegisterRequireConfig:s}),d}var Xy=class{constructor(e){this.kernel=e;this.disposables=[];e.onRestarted(this.onKernelRestarted,this,this.disposables)}dispose(){G(this.disposables)}async getWidgetModuleMappings(){return this.widgetModuleMappings||(this.widgetModuleMappings=this.getWidgetModuleMappingsImpl()),this.widgetModuleMappings}onKernelRestarted(){this.widgetModuleMappings=void 0}async getConfigFromWidget(e,t,n){let i=await this.getWidgetScriptSource(t);try{let o=await lve(e,n,i);if(!o){let s=`Failed to extract require.config from widget for ${n} from ${W(t)}`;fi&&(s+=`with contents ${i}`),J(s)}return o}catch(o){C(`Failed to extract require.config entry for ${n} from ${W(t)}`,o)}}async getWidgetModuleMappingsImpl(){let e=new $e,[t,n]=await Promise.all([this.getWidgetEntryPoints(),this.getNbExtensionsParentPath()]);if(!n)return;let i=await Promise.all(t.map(s=>this.getConfigFromWidget(n,s.uri,s.widgetFolderName))),o=i.reduce((s,a)=>Object.assign(s||{},a),{});return o&&Object.keys(o).length?(delete o["jupyter-js-widgets"],delete o["@jupyter-widgets/base"],delete o["@jupyter-widgets/controls"],delete o["@jupyter-widgets/output"]):te(`No config, entryPoints = ${JSON.stringify(t)}, widgetConfigs = ${JSON.stringify(i)}`),R("DS_INTERNAL.IPYWIDGET_DISCOVER_WIDGETS_NB_EXTENSIONS",{duration:e.elapsedTime},{type:mt(this.kernel.kernelConnectionMetadata)?"local":"remote"}),o&&Object.keys(o).length?o:void 0}};var O_=class extends Xy{constructor(t,n,i,o){super(t);this.httpClient=n;this.context=i;this.fs=o;if(t.kernelConnectionMetadata.kind!=="connectToLiveRemoteKernel"&&t.kernelConnectionMetadata.kind!=="startUsingRemoteKernelSpec")throw new Error("Invalid usage, can only be used for remote kernels");this.kernelConnection=t.kernelConnectionMetadata,this.getWidgetEntryPoints().catch(m)}getBaseUrl(){return this.getNbExtensionsParentPath()}async getNbExtensionsParentPath(){return gf.Uri.parse(this.kernelConnection.baseUrl)}onKernelRestarted(){this.widgetEntryPointsPromise=void 0,super.onKernelRestarted()}async getWidgetEntryPoints(){return this.widgetEntryPointsPromise||(this.widgetEntryPointsPromise=this.getWidgetEntryPointsImpl()),this.widgetEntryPointsPromise}getCodeToExecute(){return this.code||(this.code=this.fs.readFile(gf.Uri.joinPath(this.context.extensionUri,"pythonFiles","printJupyWidgetEntryPoints.py"))),this.code}async getWidgetEntryPointsImpl(){if(!Vt(this.kernelConnection))return[];let t=await this.getCodeToExecute();if(!this.kernel.session?.kernel)return te("No Kernel session to get list of widget entry points"),[];let n=[];n.push(xn(this.kernel.session.kernel,t,{traceErrors:!0,traceErrorsMessage:"Failed to get widget entry points from remote kernel"})),!fi&&this.context.extensionMode===gf.ExtensionMode.Production&&n.push(Vn(1e4).then(()=>[])),n.forEach(s=>s.catch(m));let i=await Promise.race(n);if(i.length===0)return te("Unable to get widget entry points, no outputs after running the code"),[];let o=i[0];if(o.output_type!=="stream"||o.name!=="stdout")return te("Unable to get widget entry points, no stream/stdout outputs after running the code"),[];try{return o.text.trim().substring(1).slice(0,-1).split(",").map(a=>Hd(a.trim())).map(a=>({uri:gf.Uri.joinPath(gf.Uri.parse(this.kernelConnection.baseUrl),"nbextensions",a),widgetFolderName:pt(a)}))}catch(s){return C(`Failed to parse output to get list of IPyWidgets, output is ${o.text}`,s),[]}}async getWidgetScriptSource(t){let n=t.toString(),i=await this.httpClient.downloadFile(n);if(i.status===200)return i.text();throw C(`Error downloading from ${n}: ${i.statusText}`),new Error(`Error downloading from ${n}: ${i.statusText}`)}};var Zy=require("vscode");var K_=class r extends Xy{constructor(t,n,i,o,s){super(t);this.fs=n;this.nbExtensionsPathProvider=i;this.context=o;this.jupyterPaths=s;this.overwriteExistingFiles=!0;this.overwriteExistingFiles=!r.nbExtensionsCopiedKernelConnectionList.has(t.kernelConnectionMetadata.id)}static{this.nbExtensionsCopiedKernelConnectionList=new Set}getBaseUrl(){return this.getNbExtensionsParentPath()}onKernelRestarted(){this.nbExtensionsParentPath=void 0,this.overwriteExistingFiles=!0,super.onKernelRestarted()}async getNbExtensionsParentPath(){return this.nbExtensionsParentPath||(this.nbExtensionsParentPath=this.getNbExtensionsParentPathImpl()),this.nbExtensionsParentPath}async getNbExtensionsParentPathImpl(){let t=this.overwriteExistingFiles;try{let n=new $e;if(this.sourceNbExtensionsPath=await this.nbExtensionsPathProvider.getNbExtensionsParentPath(this.kernel),!this.sourceNbExtensionsPath)return;let i=await ht(this.kernel.kernelConnectionMetadata.id),o=Zy.Uri.joinPath(this.context.extensionUri,"temp","scripts",i,"jupyter"),s=Zy.Uri.joinPath(o,"nbextensions"),[a]=await Promise.all([this.jupyterPaths.getDataDirs({resource:this.kernel.resourceUri,interpreter:this.kernel.kernelConnectionMetadata.interpreter}),this.fs.createDirectory(s)]),l=a.map(c=>Zy.Uri.joinPath(c,"nbextensions"));l.reverse();for(let c of l)await this.fs.exists(c)&&await this.fs.copy(c,s,{overwrite:t});return this.overwriteExistingFiles=!1,r.nbExtensionsCopiedKernelConnectionList.add(this.kernel.kernelConnectionMetadata.id),R("DS_INTERNAL.IPYWIDGET_TIME_TO_COPY_NBEXTENSIONS_DIR",{duration:n.elapsedTime}),o}catch(n){throw R("DS_INTERNAL.IPYWIDGET_TIME_TO_COPY_NBEXTENSIONS_DIR",void 0,void 0,n),n}}async getWidgetEntryPoints(){let t=await this.getNbExtensionsParentPath();if(!t)return[];let n=Zy.Uri.joinPath(t,"nbextensions");return(await this.fs.searchLocal("*/extension.js",n.fsPath,!0)).map(o=>({uri:Zy.Uri.joinPath(n,o),widgetFolderName:pt(o)}))}getWidgetScriptSource(t){return this.fs.readFile(t)}};var eb=class{constructor(e,t,n,i,o,s){this.nbExtensionsPathProvider=e;this.fs=t;this.context=n;this.httpClient=i;this.jupyterPaths=o;this.disposables=s;this.managers=new WeakMap}getOrCreate(e){if(!this.managers.has(e))if(e.kernelConnectionMetadata.kind==="connectToLiveRemoteKernel"||e.kernelConnectionMetadata.kind==="startUsingRemoteKernelSpec"){let t=new O_(e,this.httpClient,this.context,this.fs);this.managers.set(e,t),e.onDisposed(()=>t.dispose(),this,this.disposables)}else{let t=new K_(e,this.fs,this.nbExtensionsPathProvider,this.context,this.jupyterPaths);this.managers.set(e,t),e.onDisposed(()=>t.dispose(),this,this.disposables)}return this.managers.get(e)}};eb=g([(0,Cu.injectable)(),p(0,(0,Cu.inject)(y_)),p(1,(0,Cu.inject)(Or)),p(2,(0,Cu.inject)(dt)),p(3,(0,Cu.inject)(ws)),p(4,(0,Cu.inject)(rn)),p(5,(0,Cu.inject)(O))],eb);var UC=k(A()),vd=require("vscode");var Xs=class{constructor(e,t){this.appShell=t;this.disposables=[];e.push(this)}dispose(){G(this.disposables)}activate(){vd.workspace.onDidChangeNotebookDocument(this.onDidChangeNotebookDocument,this,this.disposables)}onDidChangeNotebookDocument(e){Dt(e.notebook)&&e.cellChanges.some(t=>t.outputs&&t.outputs.some(n=>n.items&&n.items.some(i=>i.mime===Xi)))&&this.checkRendererExtensionVersion()}checkRendererExtensionVersion(){if(!vd.workspace.isTrusted)return;let e=vd.extensions.getExtension(lh);if(!e){this.displayNotInstalledMessage();return}let t=e.packageJSON.version;if(!t){this.displayUpdateMessage();return}let n=t.split("."),i=parseInt(n[0],10),o=parseInt(n[1],10),s=parseInt(n[2],10);(i<1||i===1&&o===0&&s<15)&&this.displayUpdateMessage()}displayNotInstalledMessage(){Xs.messageDisplayed||(Xs.messageDisplayed=!0,this.appShell.showInformationMessage(y.rendererExtensionRequired,{modal:!0},ye.bannerLabelYes).then(e=>{e===ye.bannerLabelYes&&vd.commands.executeCommand("extension.open",lh).then(m,m)}).then(m,m))}displayUpdateMessage(){Xs.messageDisplayed||(Xs.messageDisplayed=!0,this.appShell.showInformationMessage(y.rendererExtension1015Required,{modal:!0},ye.bannerLabelYes).then(e=>{e===ye.bannerLabelYes&&vd.commands.executeCommand("extension.open",lh).then(m,m)}).then(m,m))}};Xs.messageDisplayed=!1,Xs=g([(0,UC.injectable)(),p(0,(0,UC.inject)(O)),p(1,(0,UC.inject)(ue))],Xs);function q4(r,e){r.addSingleton(bu,bu),r.addSingleton(v_,Qy),r.addSingleton(b_,eb),r.addSingleton(y_,Yy),r.addSingleton(qa,qa),r.addSingleton(Ie,Xs)}var Eu=k(A()),Qr=require("vscode");var tb=class{constructor(e,t,n,i,o,s){this.controllerRegistration=e;this.isWebExtension=t;this.kernelFinder=n;this.notebookEditorProvider=i;this.kernelDependency=o;this.localDisposables=[];this.providerMappings=new Map;this.kernelSpecsSourceRegistered=!1;s.push(this)}dispose(){G(this.localDisposables)}activate(){if(!this.isWebExtension){this.localDisposables.push(Qr.notebooks.registerKernelSourceActionProvider(Ct,{provideNotebookKernelSourceActions:()=>[{label:y.localPythonEnvironments,documentation:Qr.Uri.parse("https://aka.ms/vscodeJupyterExtKernelPickerPythonEnv"),command:"jupyter.kernel.selectLocalPythonEnvironment"}]})),this.localDisposables.push(Qr.notebooks.registerKernelSourceActionProvider(wt,{provideNotebookKernelSourceActions:()=>[{label:y.localPythonEnvironments,documentation:Qr.Uri.parse("https://aka.ms/vscodeJupyterExtKernelPickerPythonEnv"),command:"jupyter.kernel.selectLocalPythonEnvironment"}]}));let t=[],n=new Qr.EventEmitter;this.localDisposables.push(Qr.notebooks.registerKernelSourceActionProvider(Ct,{onDidChangeNotebookKernelSourceActions:n.event,provideNotebookKernelSourceActions:()=>t})),this.localDisposables.push(Qr.notebooks.registerKernelSourceActionProvider(wt,{onDidChangeNotebookKernelSourceActions:n.event,provideNotebookKernelSourceActions:()=>t}));let i=()=>{this.kernelSpecsSourceRegistered||this.kernelFinder.kernels.some(o=>eg(o))&&(this.kernelSpecsSourceRegistered=!0,t=[{label:y.localKernelSpecs,documentation:Qr.Uri.parse("https://aka.ms/vscodeJupyterExtKernelPickerJupyterKernels"),command:"jupyter.kernel.selectLocalKernelSpec"}],n.fire())};i(),this.kernelFinder.onDidChangeKernels(()=>i(),this,this.localDisposables),this.localDisposables.push(Qr.commands.registerCommand("jupyter.kernel.selectLocalKernelSpec",this.onSelectLocalKernel.bind(this,"localKernelSpec"),this)),this.localDisposables.push(Qr.commands.registerCommand("jupyter.kernel.selectLocalPythonEnvironment",this.onSelectLocalKernel.bind(this,"localPythonEnvironment"),this))}this.localDisposables.push(Qr.commands.registerCommand("jupyter.kernel.selectJupyterServerKernel",this.onSelectRemoteKernel,this)),Xe.instance.get(Ut).onDidChangeCollections(this.registerUriCommands,this,this.localDisposables),this.registerUriCommands()}registerUriCommands(){let e=Xe.instance.get(Ut),t=new Set;e.jupyterCollections.map(n=>{let i=`${n.extensionId}:${n.id}`;if(n.id===jd||(t.add(i),this.providerMappings.has(i)))return;let o=Qr.notebooks.registerKernelSourceActionProvider(Ct,{provideNotebookKernelSourceActions:()=>[{get label(){return n.label},get documentation(){return n.documentation},command:{command:"jupyter.kernel.selectJupyterServerKernel",arguments:[n.extensionId,n.id],title:n.label}}]}),s=Qr.notebooks.registerKernelSourceActionProvider(wt,{provideNotebookKernelSourceActions:()=>[{get label(){return n.label},get documentation(){return n.documentation},command:{command:"jupyter.kernel.selectJupyterServerKernel",arguments:[n.extensionId,n.id],title:n.label}}]});this.localDisposables.push(o),this.localDisposables.push(s),this.providerMappings.set(i,{disposables:[o,s],provider:n})}),this.providerMappings.forEach(({disposables:n},i)=>{t.has(i)||(G(n),this.providerMappings.delete(i))})}async onSelectLocalKernel(e,t){if(t=t||Qr.window.activeNotebookEditor?.notebook,!!t)if(e==="localPythonEnvironment"){let i=await Xe.instance.get(hx).selectLocalKernel(t);return this.getSelectedController(t,i)}else{let i=await Xe.instance.get(xk).selectLocalKernel(t);return this.getSelectedController(t,i)}}async onSelectRemoteKernel(e,t,n){if(n=n||Qr.window.activeNotebookEditor?.notebook,!n&&Qr.window.activeTextEditor&&(n=this.notebookEditorProvider.findNotebookEditor(Qr.window.activeTextEditor.document.uri)?.notebook),!n)return;let i=`${e}:${t}`,o=this.providerMappings.get(i)?.provider;if(!o)return;let a=await Xe.instance.get(Sk).selectRemoteKernel(n,o);return this.getSelectedController(n,a)}async getSelectedController(e,t){if(!t)return;let n=this.controllerRegistration.addOrUpdate(t,[e.notebookType]);if(!Array.isArray(n)||n.length===0){J(`No controller created for selected kernel connection ${t.kind}:${t.id}`);return}is(e.uri,t).finally(()=>Rt(e.uri,"DS_INTERNAL.SWITCH_KERNEL",void 0,{newKernelPicker:!0})).catch(m),n.find(o=>o.viewType===e.notebookType)?.controller.updateNotebookAffinity(e,Qr.NotebookControllerAffinity.Preferred);let i=n[0];return await this.onControllerSelected(e,i),i.controller.id}async onControllerSelected(e,t){if(mt(t.connection)&&Vt(t.connection)&&t.connection.interpreter?.isCondaEnvWithoutPython&&!this.isWebExtension){let n=[];try{let i=new Qr.CancellationTokenSource;n.push(i);let o=new er(!1);n.push(o),await this.kernelDependency.installMissingDependencies({resource:e.uri,kernelConnection:t.connection,token:i.token,ui:o,cannotChangeKernels:!0,ignoreCache:!0,installWithoutPrompting:!0})}catch(i){C(`Failed to install missing dependencies for Conda kernel ${t.connection.id}`,i)}finally{G(n)}}}};tb=g([(0,Eu.injectable)(),p(0,(0,Eu.inject)(xt)),p(1,(0,Eu.inject)(on)),p(2,(0,Eu.inject)(Wr)),p(3,(0,Eu.inject)(Tn)),p(4,(0,Eu.inject)(Ns)),p(5,(0,Eu.inject)(O))],tb);var vf=k(A()),W_=require("vscode");var dc=require("vscode");var F_=require("vscode");var yd=class{constructor(e){this.jupyterConnection=e;this.disposables=[]}dispose(){G(this.disposables)}async findPreferredRemoteKernelConnection(e,t,n){return this.findPreferredRemoteKernelConnectionImpl(e,t,n,!1)}async findPreferredRemoteKernelConnectionImpl(e,t,n,i){let o=await Xe.instance.get(rs).getPreferredRemoteKernelId(e.uri),s=async()=>{let l=t.kernels.find(u=>u.kind==="connectToLiveRemoteKernel"&&u.id===o);if(l)return l;if(t.status==="idle")return;let c=await new Promise(u=>t.onDidChangeKernels(()=>{let d=t.kernels.find(f=>f.kind==="connectToLiveRemoteKernel"&&f.id===o);d&&u(d),(t.status==="idle"||n.isCancellationRequested)&&u(void 0)},this,this.disposables));if(c)return c};if(o){let l=await s();if(l||i)return l}let a=t.kernels.find(l=>Ft(l))?.serverProviderHandle;if(a){let l=await this.jupyterConnection.createConnectionInfo(a),c=(e.uri,void 0),u=c&&t.kernels.find(d=>Ft(d)&&d.kind==="connectToLiveRemoteKernel"&&d.kernelModel.model&&d.kernelModel.model.path===c.path&&d.kernelModel.model.name===c.name);if(u)return u}return this.findPreferredKernelSpecConnection(e,t,n,i)}async findPreferredLocalKernelSpecConnection(e,t,n){return this.findPreferredKernelSpecConnection(e,t,n,!1)}async findPreferredKernelSpecConnection(e,t,n,i){let s=wo(e)?.kernelspec?.name,a=()=>{let u=s?t.kernels.filter(f=>(f.kind==="startUsingLocalKernelSpec"||f.kind==="startUsingRemoteKernelSpec")&&f.kernelSpec.name===s):[];if(u.length||i)return u;let d=C_(e);if(d)return t.kernels.filter(f=>(f.kind==="startUsingLocalKernelSpec"||f.kind==="startUsingRemoteKernelSpec")&&f.kernelSpec.language&&(f.kernelSpec.language===d||Ts(f.kernelSpec.language)===Ts(d)))},l=a();if(Array.isArray(l)&&l.length)return i&&l.length>1?void 0:l[0];if(t.status==="idle")return;let c=[];return new Promise(u=>t.onDidChangeKernels(()=>{if(n.isCancellationRequested)return u(void 0);let d=a();if(Array.isArray(d)&&d.length)return i&&d.length>1?u(void 0):u(d[0]);t.status==="idle"&&u(void 0)},this,this.disposables)).finally(()=>G(c))}async findPreferredPythonKernelConnection(e,t,n){return this.findPreferredPythonKernelConnectionImpl(e,t,n)}async findPreferredPythonKernelConnectionImpl(e,t,n){t=t||Xe.instance.get(Wr).registered.find(c=>c.kind==="localPythonEnvironment");let i=Xe.instance.get(it),o=KF(e,t);if(o)return o;let s=await i.getActiveInterpreter(e.uri);if(!s)return;let a=()=>{if(!n.isCancellationRequested)return t.kernels.filter(c=>c.kind==="startUsingPythonInterpreter").map(c=>c).find(c=>c.interpreter.id===s.id)},l=a();if(l)return l;if(t.status==="discovering")return await new Promise(c=>{t.onDidChangeStatus(()=>t.status==="idle"&&c(),this,this.disposables),t.onDidChangeKernels(()=>(KF(e,t)||a())&&c(),this,this.disposables)}),KF(e,t)||a()}};function KF(r,e){let t=F_.workspace.getWorkspaceFolder(r.uri)?.uri||(F_.workspace.workspaceFolders?.length===1?F_.workspace.workspaceFolders[0].uri:void 0),n=J4(oi(r.uri),e);if(n)return n;if(t)return J4(t,e)}function J4(r,e){let n=e.kernels.filter(a=>a.kind==="startUsingPythonInterpreter").map(a=>a).filter(a=>Fg(a.interpreter.envPath?.fsPath||a.interpreter.uri.fsPath,r.fsPath)),i=n.find(a=>a.interpreter.envType==="Venv"&&a.interpreter.envName?.toLowerCase()===".venv");if(i)return i;let o=n.find(a=>a.interpreter.envType==="Venv"&&a.interpreter.envName?.toLowerCase()===".venv");if(o)return o;let s=n.find(a=>a.interpreter.envType==="Venv"&&a.interpreter.envName?.toLowerCase()===".venv");return s||(n.length?n[0]:void 0)}var L_=class{constructor(e,t,n,i,o){this.notebook=e;this.pythonEnvFilter=i;this.connection=o;this._onDidRefresh=new dc.EventEmitter;this.onDidRefresh=this._onDidRefresh.event;this._onDidChange=new dc.EventEmitter;this.onDidChange=this._onDidChange.event;this.kernels=[];this._onDidChangeStatus=new dc.EventEmitter;this.onDidChangeStatus=this._onDidChangeStatus.event;this._onDidChangeRecommended=new dc.EventEmitter;this.onDidChangeRecommended=this._onDidChangeRecommended.event;this._onDidFailToListKernels=new dc.EventEmitter;this.onDidFailToListKernels=this._onDidFailToListKernels.event;this.status="idle";this.disposables=[];this.refresh=async()=>{this.refreshInvoked=!0},this.title=y.kernelPickerSelectKernelTitle,this.kind=t,this.disposables.push(this._onDidRefresh),$d(n)?n.then(s=>this.setupFinder(s)).catch(s=>C(`Failed to setup finder for ${this.title}`,s)):this.setupFinder(n)}dispose(){G(this.disposables)}setupFinder(e){switch(this.refresh=async()=>e.refresh(),this.status!==e.status&&!this.refreshInvoked&&(this.status=e.status,this._onDidChangeStatus.fire()),this.refreshInvoked?e.refresh().catch(i=>C(`Failed to refresh finder for ${this.title}`,i)):e.kind==="remote"&&e.status==="idle"&&this.filteredKernels(e.kernels).length===0&&e.refresh().catch(i=>C(`Failed to refresh finder for ${this.title}`,i)),e.kind){case"localKernelSpec":this.title=y.kernelPickerSelectLocalKernelSpecTitle;break;case"localPythonEnvironment":this.title=y.quickPickSelectPythonEnvironmentTitle;break;default:this.title=y.kernelPickerSelectKernelFromRemoteTitle(e.displayName);break}e.onDidChangeKernels(()=>{this.kernels.length=0,this.kernels.push(...this.filteredKernels(e.kernels)),this._onDidChange.fire()},this,this.disposables),e.onDidChangeStatus(()=>{this.status=e.status,this._onDidChangeStatus.fire(),this.status==="idle"&&e.lastError&&this.filteredKernels(e.kernels).length===0&&(this.kernels.length=0,this._onDidFailToListKernels.fire(e.lastError))}),this.kernels.length=0,this.kernels.push(...this.filteredKernels(e.kernels)),this._onDidChange.fire(),this._onDidChangeStatus.fire();let t=new dc.CancellationTokenSource;this.disposables.push(new dc.Disposable(()=>t.cancel())),this.disposables.push(t);let n=new yd(this.connection);this.disposables.push(n),e.kind==="remote"?this.computePreferredRemoteKernel(e,n,t.token):this.computePreferredLocalKernel(e,n,t.token)}filteredKernels(e){let t=this.pythonEnvFilter;return t?e.filter(n=>n.kind!=="startUsingPythonInterpreter"||!t.isPythonEnvironmentExcluded(n.interpreter)):e}computePreferredRemoteKernel(e,t,n){t.findPreferredRemoteKernelConnection(this.notebook,e,n).then(i=>{this.recommended=i,this._onDidChangeRecommended.fire()}).catch(i=>C(`Preferred connection failure ${W(this.notebook.uri)}`,i))}computePreferredLocalKernel(e,t,n){let i=()=>{this.recommended&&!this.kernels.find(s=>s.id===this.recommended?.id)&&(this.recommended=void 0),(e.kind==="localKernelSpec"?t.findPreferredLocalKernelSpecConnection.bind(t):t.findPreferredPythonKernelConnection.bind(t))(this.notebook,e,n).then(s=>{this.recommended?.id!==s?.id&&(this.recommended=s,this._onDidChangeRecommended.fire())}).catch(s=>C(`Preferred connection failure ${W(this.notebook?.uri)}`,s))};i(),e.onDidChangeKernels(i,this,this.disposables)}};var bd=require("vscode");function mc(r){return"connection"in r}function cve(r){return"command"in r}function uve(r,e,t){let n=t?[t]:r.activeItems.length?[r.activeItems[0]]:[];if(n.length&&!e.includes(n[0])){let i=n[0],o=mc(i)&&e.find(s=>mc(s)&&s.connection.id===i.connection.id);o?n[0]=o:n.length=0}r.items=e,r.activeItems=n}var FF=class extends Error{},U_=class extends Mr{constructor(t,n){super();this.provider=t;this.token=n;this.recommendedItems=[];this.existingItems=new Set;this.quickPickItems=[];this.displayDataProvider=Xe.instance.get(vp)}async selectKernel(t){return this.selectKernelImpl(t,{quickPick:void 0})}async selectKernelImpl(t,n){if(this.token.isCancellationRequested)return;let i=this.provider.kernels.map(o=>this.connectionToQuickPick(o));return this.quickPickItems.push({kind:bd.QuickPickItemKind.Separator,label:y.kernelCategoryForJupyterKernel}),i.sort((o,s)=>o.label.localeCompare(s.label)),this.quickPickItems.push(...i),this.existingItems=new Set(i),this.selectKernelImplInternal(t,n)}async selectKernelImplInternal(t,n){let i={iconPath:new bd.ThemeIcon("refresh"),tooltip:ye.refresh},o={iconPath:new bd.ThemeIcon("loading~spin"),tooltip:ye.refreshing},{quickPick:s,selection:a}=t({title:this.provider.title,items:this.quickPickItems,buttons:[i],onDidTriggerButton:async u=>{if(u===i){let d=s.buttons;s.buttons=d.filter(f=>f!==i).concat(o),await this.provider.refresh().catch(m),s.buttons=d}}});n.quickPick=s,this.provider.status==="discovering"&&(s.busy=!0);let l;this._register(this.provider.onDidChangeStatus(()=>{switch(l&&clearTimeout(l),this.provider.status){case"discovering":s.busy=!0;break;case"idle":l=setTimeout(()=>s.busy=!1,500),this._register(new bd.Disposable(()=>l&&clearTimeout(l)));break}},this)),this.updateRecommended(s),this.updateQuickPickItems(s),this._register(this.provider.onDidChangeRecommended(()=>this.updateRecommended(s),this)),this._register(this.provider.onDidChange(()=>this.updateQuickPickItems(s),this));let c=await a;if(!this.token.isCancellationRequested){if(cve(c))try{let u=await c.command();return u?{selection:"controller",connection:u}:void 0}catch(u){if(u instanceof FF)return{selection:"userPerformedSomeOtherAction"};if(u===Ae.back)return this.selectKernelImplInternal(t,n);throw u}if(c&&"connection"in c)return{selection:"controller",connection:c.connection};if(c&&"error"in c)throw Ae.back}}updateQuickPickItems(t){t.title=this.provider.title;let n=new Set(t.items.filter(u=>mc(u)).map(u=>u).map(u=>u.connection.id)),i=this.provider.kernels.filter(u=>!n.has(u.id)).map(u=>this.connectionToQuickPick(u));this.updateQuickPickWithLatestConnection(t),this.removeMissingKernels(t),this.updateRecommended(t),i.sort((u,d)=>u.label.localeCompare(d.label));let o=0,s=this.existingItems,a=new Map(Array.from(s).map(u=>[u.connection.id,u])),l=s.size;i.forEach(u=>{let d=a.get(u.connection.id);d&&s.delete(d),s.add(u)});let c=Array.from(s);c.sort((u,d)=>u.label.localeCompare(d.label)),this.quickPickItems.splice(o+1,l,...c),this.rebuildQuickPickItems(t)}rebuildQuickPickItems(t){let n=this.recommendedItems.find(a=>mc(a)),i=new Set(this.recommendedItems.filter(mc).map(a=>a.connection.id)),o=this.quickPickItems.filter(a=>!mc(a)||!i.has(a.connection.id)),s=t.activeItems.length?t.activeItems[0]:void 0;n&&mc(n)&&s&&(mc(s)?s.connection.id!==n.connection.id&&(n=void 0):n=void 0),uve(t,this.recommendedItems.concat(o),n)}removeMissingKernels(t){let n=t.items.filter(s=>mc(s)).map(s=>s).map(s=>s.connection.id),i=new Map(this.provider.kernels.map(s=>[s.id,s])),o=n.filter(s=>!i.has(s));if(o.length){let s=[];this.existingItems.forEach(a=>{o.includes(a.connection.id)&&(this.existingItems.delete(a),s.push(a))}),this.quickPickItems=this.quickPickItems.filter(a=>!s.includes(a)),this.rebuildQuickPickItems(t)}}updateRecommended(t){if(!this.provider.recommended){this.recommendedItems.length=0;return}this.recommendedItems.length||this.recommendedItems.push({label:y.recommendedItemCategoryInQuickPick,kind:bd.QuickPickItemKind.Separator});let n=this.connectionToQuickPick(this.provider.recommended,!0);this.recommendedItems.length===2?this.recommendedItems[1]=n:this.recommendedItems.push(n),this.rebuildQuickPickItems(t)}updateQuickPickWithLatestConnection(t){let n=new Map(this.provider.kernels.map(i=>[i.id,i]));this.recommendedItems.concat(this.quickPickItems).forEach(i=>{if(!mc(i)||!n.has(i.connection.id))return;let o=n.get(i.connection.id);o&&(i.label=this.connectionToQuickPick(o,i.isRecommended).label,i.tooltip=this.connectionToQuickPick(o,i.isRecommended).tooltip,i.detail=this.connectionToQuickPick(o,i.isRecommended).detail,i.description=this.connectionToQuickPick(o,i.isRecommended).description,i.isRecommended=this.connectionToQuickPick(o,i.isRecommended).isRecommended,i.connection=o)}),this.rebuildQuickPickItems(t)}connectionToQuickPick(t,n=!1){let i=n?"$(star-full) ":"",o=(l,c,u)=>{l.label=`${i}${c.label}`,l.detail=c.detail,l.description=c.description,this.quickPickItems.forEach(d=>{"connection"in d&&d.connection.id===u.id&&(d.label=c.label,d.detail=c.detail,d.description=c.description)})},s=this.displayDataProvider.getDisplayData(t),a={label:"",detail:"",description:"",isRecommended:n,connection:t};return o(a,s,t),this._register(s.onDidChange(l=>o(a,l,t),this)),a}};var rb=class{constructor(e,t,n,i){this.kernelFinder=e;this.multiStepFactory=t;this.pythonEnvFilter=n;this.jupyterConnection=i;this.localDisposables=[]}async selectLocalKernel(e){if(e.notebookType!==Ct&&e.notebookType!==wt)return;this.localDisposables.forEach(o=>o.dispose()),this.localDisposables=[],this.cancellationTokenSource?.cancel(),this.cancellationTokenSource?.dispose(),this.cancellationTokenSource=new W_.CancellationTokenSource;let t=this.multiStepFactory.create(),n={disposables:[],notebook:e},i=this.kernelFinder.registered.find(o=>o.id==="localKernelSpec");try{if(await t.run(this.selectKernelFromKernelFinder.bind(this,i,this.cancellationTokenSource.token,t,n),n)===Ae.cancel||n.selection?.type==="userPerformedSomeOtherAction")throw new W_.CancellationError;if(this.cancellationTokenSource.token.isCancellationRequested){G(n.disposables);return}if(n.selection?.type==="connection")return n.selection.connection}finally{G(n.disposables)}}selectKernelFromKernelFinder(e,t,n,i){let o=new L_(i.notebook,e.kind,e,this.pythonEnvFilter,this.jupyterConnection);return i.disposables.push(o),this.selectKernel(o,t,n,i)}async selectKernel(e,t,n,i){if(t.isCancellationRequested)return;let o=new U_(e,t);i.disposables.push(o);let s=l=>{let{quickPick:c,selection:u}=n.showLazyLoadQuickPick({...l,placeholder:"",matchOnDescription:!0,matchOnDetail:!0,supportBackInFirstStep:!0,activeItem:void 0,ignoreFocusOut:!1});return{quickPick:c,selection:u}},a=await o.selectKernel(s);a?.selection==="controller"?i.selection={type:"connection",connection:a.connection}:a?.selection==="userPerformedSomeOtherAction"&&(i.selection={type:"userPerformedSomeOtherAction"})}};rb=g([(0,vf.injectable)(),p(0,(0,vf.inject)(Wr)),p(1,(0,vf.inject)(Rg)),p(2,(0,vf.inject)(xi)),p(3,(0,vf.inject)(Dn))],rb);var wu=k(A()),bf=require("vscode");var yf=require("vscode");var nb=require("vscode");var j_=class{constructor(e,t){this.notebook=e;this.disposables=[];Xe.instance.get(xt).onControllerSelected(i=>{i.notebook===this.notebook&&(i.controller.connection.kind!=="startUsingPythonInterpreter"||!i.controller.connection.interpreter||i.controller.connection.interpreter.id!==this.createdEnvId)&&this.cancelTokeSource.cancel()},this,this.disposables),this.cancelTokeSource=kk(t)}dispose(){this.cancelTokeSource.dispose(),G(this.disposables)}async createPythonEnvFromKernelPicker(){let e,t=await this.createPythonEnvironment();if(this.cancelTokeSource.token.isCancellationRequested||t.action)return R("DATASCIENCE.CREATE_PYTHON_ENVIRONMENT",void 0,{failed:!0,reason:"cancelled"}),{action:t.action||"Cancel"};if(!t.interpreter)return R("DATASCIENCE.CREATE_PYTHON_ENVIRONMENT",void 0,{failed:!0,reason:"cancelled"}),{action:"Cancel"};e=t.interpreter,w(`Python Environment created ${e.id}`);let n=await this.waitForPythonKernel(t.interpreter);if(this.cancelTokeSource.token.isCancellationRequested)return R("DATASCIENCE.CREATE_PYTHON_ENVIRONMENT",void 0,{failed:!0,reason:"cancelled"}),{action:"Cancel"};if(!n)return R("DATASCIENCE.CREATE_PYTHON_ENVIRONMENT",void 0,{failed:!0,reason:"kernelConnectionNotCreated"}),w(`Python Environment ${e.id} not found as a kernel`),{action:"Cancel"};w(`Python Environment ${e.id} found as a kernel ${n.kind}:${n.id}`);let o=await Xe.instance.get(Ns).installMissingDependencies({resource:this.notebook.uri,kernelConnection:n,ui:new er(!1),token:this.cancelTokeSource.token,ignoreCache:!0,cannotChangeKernels:!0,installWithoutPrompting:!0}),s=!0;return o!==0&&(s=!1,J(`Dependencies not installed for new Python Env ${W(e.uri)} for notebook ${W(this.notebook.uri)}`)),R("DATASCIENCE.CREATE_PYTHON_ENVIRONMENT",void 0,{dependenciesInstalled:s,envType:t.interpreter.envType}),{kernelConnection:n}}async waitForPythonKernel(e){let n=Xe.instance.get(Wr).registered.find(i=>i.kind==="localPythonEnvironment");if(n)return this.waitForPythonKernelFromFinder(e,n)}async waitForPythonKernelFromFinder(e,t){let n=t.kernels.find(i=>i.interpreter.id===e.id);return n||new Promise(i=>{let o=[];o.push(t.onDidChangeKernels(()=>{if(this.cancelTokeSource.token.isCancellationRequested)return;let s=t.kernels.find(a=>a.interpreter.id===e.id);if(s)return G(o),i(s)},this,this.disposables)),o.push(this.cancelTokeSource.token.onCancellationRequested(()=>{G(o)}))}).then(i=>{if(!this.cancelTokeSource.token.isCancellationRequested)return i||J(`New Python Environment ${W(e.uri)} not found as a kernel`),i})}async createPythonEnvironment(){let e=Xe.instance.get(it),t=new nb.CancellationTokenSource;e.pauseInterpreterDetection(t.token);try{let n=await nb.commands.executeCommand("python.createEnvironment",{showBackButton:!0,selectEnvironment:!0});if(n?.action==="Cancel")return{action:"Cancel"};if(n?.action==="Back")return{action:"Back"};let i=n?.path;if(this.cancelTokeSource.token.isCancellationRequested)return{action:"Cancel"};if(!i)return J("Python Environment not created, either user cancelled the creation or there was an error in the Python Extension"),{action:"Cancel"};this.createdEnvId=i,w(`Python Environment created ${i}`);let o=await e.getInterpreterDetails({path:i});return this.cancelTokeSource.token.isCancellationRequested?{action:"Cancel"}:(o||J(`No interpreter details for New Python Environment ${W(nb.Uri.file(i))}`),this.createdEnvId=o?.id,{interpreter:o})}finally{t.cancel(),t.dispose()}}};var V_=require("vscode");function H4(r,e){let t=pve(r,e.environments.known);return t||(()=>{let i=e.environments.getActiveEnvironmentPath(r.uri);return i&&e.environments.known.find(o=>o.id===i.id)})()}function pve(r,e){let t=V_.workspace.getWorkspaceFolder(r.uri)?.uri||(V_.workspace.workspaceFolders?.length===1?V_.workspace.workspaceFolders[0].uri:void 0),n=$4(oi(r.uri),e);if(n)return n;if(t)return $4(t,e)}function $4(r,e){let t=e.filter(n=>Fg(n.environment?.folderUri?.fsPath||n.executable.uri?.fsPath||n.path,r.fsPath));return t.find(n=>tn(n)==="Venv"&&n.environment?.name?.toLowerCase()===".venv")||t.find(n=>tn(n)==="Conda"&&n.environment?.name?.toLowerCase()===".conda")||t.find(n=>["VirtualEnv","VirtualEnvWrapper"].includes(tn(n))&&n.environment?.name?.toLowerCase()===".venv")||t.find(n=>n.environment?.name?.toLowerCase()===".venv"||n.environment?.name?.toLowerCase()===".conda")||t.length?t[0]:void 0}var B_=class extends Mr{constructor(t,n){super();this.notebook=t;this.token=n;let i=Xe.instance.get(xi),o=Xe.instance.get(ze),s=Xe.instance.get(Xt);this.provider=Xe.instance.get(Ws).withFilter(h=>!i.isPythonEnvironmentExcluded(h)),this.pythonEnvPicker=this._register(new Hp(Promise.resolve(this.provider),ED,wD,{supportsBack:!0},void 0,y.quickPickSelectPythonEnvironmentTitle));let a=!1,l=()=>{a||(a=!0,this.pythonEnvPicker.addCommand({label:`$(add) ${y.createPythonEnvironmentInQuickPick}`},this.createNewEnvironment.bind(this)))};this.provider.items.length&&l();let c={dispose:m},u=this._register(this.provider.onDidChange(()=>{this.provider.items.length&&(l(),c.dispose(),u.dispose())}));this.provider.refresh().finally(()=>{this.provider.items.length||(c=this.pythonEnvPicker.addCommand({label:y.installPythonQuickPickTitle,tooltip:y.installPythonQuickPickToolTip,description:y.pleaseReloadVSCodeOncePythonHasBeenInstalled},()=>{throw setTimeout(()=>yf.commands.executeCommand(V.InstallPythonViaKernelPicker).then(m,m)),new yf.CancellationError}))}).catch(m);let d=()=>{!this.pythonApi||n.isCancellationRequested||(this.pythonEnvPicker.recommended=H4(this.notebook,this.pythonApi))},f=h=>{h&&(this.pythonApi=h,d(),this._register(h.environments.onDidChangeActiveEnvironmentPath(d)),this._register(h.environments.onDidChangeEnvironments(d)))};o.isPythonExtensionInstalled?s.getNewApi().then(f).catch(m):this._register(o.onPythonExtensionInstallationStatusChanged(()=>s.getNewApi().then(f),this)),d()}async selectKernel(){let t=pe();yf.extensions.getExtension(hi)||yf.commands.executeCommand(V.InstallPythonExtensionViaKernelPicker).then(l=>{l===!0?this.provider.refresh().catch(m):t.resolve()},l=>{C("Failed to install the Python extension",l),t.resolve()});let n=await Promise.race([this.pythonEnvPicker.selectItem(this.token),t.promise]);if(!n||n instanceof Ae)return n||Ae.cancel;let i=Xe.instance.get(it),o=Xe.instance.get(rn),s=await i.getInterpreterDetails(n.path);if(!s)return Ae.cancel;let a=await Ia(s,await o.getKernelSpecTempRegistrationFolder());return $o.create({kernelSpec:a,interpreter:s,id:ci(a,s)})}async createNewEnvironment(){let t=Xe.instance.get(Xt);if(!Xe.instance.get(ze).isPythonExtensionInstalled)return;let o=await this._register(new j_(this.notebook,this.token)).createPythonEnvFromKernelPicker();return o?"action"in o?o.action==="Back"?Ae.back:Ae.cancel:(await t.getNewApi())?.environments.known.find(a=>a.id===o.kernelConnection.interpreter.id):Ae.cancel}};var ib=class extends Mr{constructor(t,n,i,o,s,a){super();this.pythonApi=n;this.filter=i;this.jupyterPaths=o;this.checker=s;this.kind="localPythonEnvironment";this.id="localPythonEnvironment";this.displayName=y.localPythonEnvironments;this._onDidChangeKernels=this._register(new bf.EventEmitter);this.onDidChangeKernels=this._onDidChangeKernels.event;this._kernels=new Map;this._onDidChangeStatus=this._register(new bf.EventEmitter);this._status="idle";this.promiseMonitor=new Eo;this.onDidChangeStatus=this._onDidChangeStatus.event;this.previousCancellationTokens=[];this.apiHooked=!1;t.push(this),a.registerKernelFinder(this)}get status(){return this._status}set status(t){this._status=t,this._onDidChangeStatus.fire()}get kernels(){return Array.from(this._kernels.values())}activate(){this._register(this.promiseMonitor.onStateChange(()=>this.status=this.promiseMonitor.isComplete?"idle":"discovering",this)),this.checker.isPythonExtensionInstalled?(this.getKernelSpecsDir().catch(m),this.hookupPythonApi().catch(m)):this._register(this.checker.onPythonExtensionInstallationStatusChanged(()=>{this.checker.isPythonExtensionInstalled&&(this.getKernelSpecsDir().catch(m),this.hookupPythonApi().catch(m))},this))}async selectLocalKernel(t){let n=new bf.CancellationTokenSource,i=[n];try{let o=new B_(t,n.token);i.push(o);let s=await o.selectKernel();if(s instanceof Error){if(s instanceof Ae&&s===Ae.back)return;throw new bf.CancellationError}return this.addUpdateKernel(s),s}finally{G(i)}}addUpdateKernel(t){let n=this._kernels.get(t.id);n?(n.updateInterpreter(t.interpreter),this._kernels.set(t.id,Object.assign(n,t)),this._onDidChangeKernels.fire({})):(this._kernels.set(t.id,t),this._onDidChangeKernels.fire({}))}async refresh(){this.previousCancellationTokens.forEach(t=>t.cancel()),G(this.previousCancellationTokens),this.previousCancellationTokens=[],this._kernels.clear(),this.pythonApi.getNewApi().then(t=>{t&&(this.promiseMonitor.push(t.environments.refreshEnvironments({forceRefresh:!0}).catch(m)),t.environments.known.forEach(n=>this.buildDummyEnvironment(n).catch(m)))}).catch(m)}getKernelSpecsDir(){return this.tempDirForKernelSpecs||this.jupyterPaths.getKernelSpecTempRegistrationFolder()}async hookupPythonApi(){if(this.apiHooked)return;this.apiHooked=!0;let t=await this.pythonApi.getNewApi();t&&(t.environments.known.map(n=>this.buildDummyEnvironment(n).catch(m)),this._register(t.environments.onDidChangeEnvironments(n=>{if(n.type==="remove"){let i=this._kernels.get(n.env.id);i&&(this._kernels.delete(n.env.id),this._onDidChangeKernels.fire({removed:[i]}))}else this.buildDummyEnvironment(n.env).catch(m)},this)))}async buildDummyEnvironment(t){let n=this.pythonApi.pythonExtensionVersion&&this.pythonApi.pythonExtensionVersion.compare("2023.3.10341119")>=0,i=sk(t,n===!0);if(!i||this.filter.isPythonEnvironmentExcluded(i))return;let o=await Ia(i,await this.getKernelSpecsDir()),s=$o.create({kernelSpec:o,interpreter:i,id:ci(o,i)}),a=this._kernels.get(t.id);a?(a.updateInterpreter(s.interpreter),this._kernels.set(t.id,Object.assign(a,s)),this._onDidChangeKernels.fire({})):(this._kernels.set(t.id,s),this._onDidChangeKernels.fire({}))}};ib=g([(0,wu.injectable)(),p(0,(0,wu.inject)(O)),p(1,(0,wu.inject)(Xt)),p(2,(0,wu.inject)(xi)),p(3,(0,wu.inject)(rn)),p(4,(0,wu.inject)(ze)),p(5,(0,wu.inject)(Wr))],ib);var fc=k(A()),zn=require("vscode");function q_(r){return r===bt||r===sh}var ob=class{constructor(e,t,n,i,o,s,a){this.kernelFinder=e;this.serverUriStorage=t;this.serverSelector=n;this.jupyterConnection=i;this.displayDataProvider=o;this.kernelFinderController=s;this.jupyterServerRegistry=a;this.localDisposables=[]}async selectRemoteKernel(e,t){if(e.notebookType!==Ct&&e.notebookType!==wt)return;this.localDisposables.forEach(s=>s.dispose()),this.localDisposables=[],this.cancellationTokenSource?.cancel(),this.cancellationTokenSource?.dispose(),this.cancellationTokenSource=new zn.CancellationTokenSource;let n=Xe.instance.get(ue),i=new Ox(n),o={disposables:[],notebook:e};try{if(await i.run(this.getRemoteServersFromProvider.bind(this,t,this.cancellationTokenSource.token),o)===Ae.cancel||o.selection?.type==="userPerformedSomeOtherAction")throw new zn.CancellationError;if(this.cancellationTokenSource.token.isCancellationRequested){G(o.disposables);return}if(o.selection?.type==="connection")return o.selection.connection}finally{G(o.disposables)}}async getRemoteServersFromProvider(e,t,n,i){let o=this.kernelFinder.registered.filter(_=>_.kind==="remote"),s=[],a=[],l=[],c=this.jupyterServerRegistry.jupyterCollections.find(_=>_.extensionId===e.extensionId&&_.id===e.id)?.serverProvider,u=c?.provideJupyterServers?Promise.resolve(c.provideJupyterServers.bind(c)(t)).then(_=>_||[]):Promise.resolve([]),d=new Set,[f]=await Promise.all([u,Promise.all(o.filter(_=>_.serverProviderHandle.id===e.id).map(async _=>{let L=(await this.serverUriStorage.getAll()).find(Z=>$t(Z.provider)===$t(_.serverProviderHandle));t.isCancellationRequested||(d.add($t(_.serverProviderHandle)),l.push({server:_,time:L?.time}))}))]);if(l.sort((_,L)=>!_.time&&!L.time?_.server.displayName.localeCompare(L.server.displayName):!_.time&&L.time?1:_.time&&!L.time||(_.time||0)>(L.time||0)?-1:1),l.filter(({time:_})=>(_||0)>0).forEach(({server:_,time:L})=>{s.push({type:"finder",kernelFinderInfo:_,idAndHandle:_.serverProviderHandle,label:_.displayName,description:L?y.jupyterServerLastConnectionForQuickPickDescription(new Date(L)):void 0,buttons:c?.removeJupyterServer&&q_(e.extensionId)?[{iconPath:new zn.ThemeIcon("close"),tooltip:y.removeRemoteJupyterServerEntryInQuickPick}]:[]})}),l.filter(({time:_})=>!_).forEach(({server:_})=>{s.push({type:"finder",kernelFinderInfo:_,idAndHandle:_.serverProviderHandle,label:_.displayName,buttons:c?.removeJupyterServer&&q_(e.extensionId)?[{iconPath:new zn.ThemeIcon("close"),tooltip:y.removeRemoteJupyterServerEntryInQuickPick}]:[]})}),f.sort((_,L)=>_.label.localeCompare(L.label)).forEach(_=>{let L=$t({extensionId:e.extensionId,id:e.id,handle:_.id});d.has(L)||s.push({type:"jupyterServer",label:_.label,idAndHandle:{extensionId:e.extensionId,id:e.id,handle:_.id},server:_,buttons:c?.removeJupyterServer&&q_(e.extensionId)?[{iconPath:new zn.ThemeIcon("close"),tooltip:y.removeRemoteJupyterServerEntryInQuickPick}]:[]})}),e.commandProvider){let _=(await Promise.resolve(e.commandProvider.provideCommands(void 0,t))||[]).map(L=>({...L,provider:e,type:"uriProviderQuickPick",command:L}));s.length>0&&_.length&&a.push({label:"",kind:zn.QuickPickItemKind.Separator}),a.push(..._)}let h=s.concat(a),v=new zn.EventEmitter,S=h.length===1&&"command"in h[0]&&h[0].command.canBeAutoSelected?h[0]:void 0;if(c){let _=h.filter(L=>"type"in L);_.length===1&&_.every(L=>L.type!=="uriProviderQuickPick")?S=_[0]:_.every(L=>L.type==="uriProviderQuickPick")&&_.filter(L=>L.picked).length===1&&(S=h.filter(L=>L.picked)[0])}let b,D;if(S)D=S;else{let{quickPick:_,selection:L}=n.showLazyLoadQuickPick({items:h,placeholder:e.extensionId===bt||e.extensionId===sh?y.enterOrSelectRemoteJupyterPlaceholder:y.selectRemoteJupyterPlaceholder,title:y.quickPickTitleForSelectionOfJupyterServer,supportBackInFirstStep:!0,onDidTriggerItemButton:async Z=>{if("type"in Z.item&&(Z.item.type==="finder"||Z.item.type==="jupyterServer")){let Se=Z.item.idAndHandle.handle,ie=f.find(fe=>fe.id===Se);c?.removeJupyterServer&&ie&&q_(e.extensionId)&&(_.busy=!0,this.serverUriStorage.remove({extensionId:e.extensionId,id:e.id,handle:Se}).catch(m),await c.removeJupyterServer(ie),_.busy=!1,h.splice(h.indexOf(Z.item),1),v.fire(h.concat([])))}},onDidChangeItems:v.event});_.onDidChangeValue(async Z=>{if(!e.commandProvider?.provideCommands)return;let Se=[];s.length>0&&Se.push({label:"",kind:zn.QuickPickItemKind.Separator});let fe=(await Promise.resolve(e.commandProvider.provideCommands(Z,t))||[]).map(de=>({...de,provider:e,type:"uriProviderQuickPick",command:de}));_.items=s.concat(Se).concat(fe)},this),b=_,D=await L}if(!t.isCancellationRequested&&D&&"type"in D)switch(D.type){case"finder":{let _=await this.selectRemoteKernelFromPicker(i.notebook,Promise.resolve(D.kernelFinderInfo),t).catch(L=>C("Failed to select a kernel",L));if(_&&_===Ae.back){if(D===S)throw Ae.back;return this.getRemoteServersFromProvider(e,t,n,i)}if(!_||_ instanceof Ae)throw new zn.CancellationError;i.selection={type:"connection",connection:_};return}case"jupyterServer":{let _=(async()=>{let Z={id:e.id,handle:D.server.id,extensionId:e.extensionId};return await pr(t,this.serverSelector.addJupyterServer(Z)),this.kernelFinderController.getOrCreateRemoteKernelFinder(Z,D.server.label)})(),L=await this.selectRemoteKernelFromPicker(i.notebook,_,t).catch(Z=>C("Failed to select a kernel",Z));if(L&&L===Ae.back){if(D===S)throw Ae.back;return this.getRemoteServersFromProvider(e,t,n,i)}if(!L||L instanceof Ae)throw new zn.CancellationError;i.selection={type:"connection",connection:L};return}case"uriProviderQuickPick":{let _=zn.notebooks.createNotebookControllerDetectionTask(Ct);try{b&&(b.busy=!0);let L=await this.selectRemoteServerFromRemoteKernelFinder(D,i,t);return b&&(b.busy=!1),L}catch(L){if(L===Ae.back&&!S)return this.getRemoteServersFromProvider(e,t,n,i);throw L}finally{_.dispose()}}default:break}}async selectRemoteServerFromRemoteKernelFinder(e,t,n){if(!e.provider.commandProvider?.handleCommand||n.isCancellationRequested)return;let i=await Promise.resolve(e.provider.commandProvider.handleCommand(e.command,n));if(!i)throw Ae.back;if(n.isCancellationRequested)throw new zn.CancellationError;let o=(async()=>{let a={id:e.provider.id,handle:i.id,extensionId:e.provider.extensionId};return await pr(n,this.serverSelector.addJupyterServer(a)),this.kernelFinderController.getOrCreateRemoteKernelFinder(a,i.label)})(),s=await this.selectRemoteKernelFromPicker(t.notebook,o,n).catch(a=>C("Failed to select a kernel",a));if(s&&s===Ae.back)throw Ae.back;if(!s||s instanceof Ae)throw new zn.CancellationError;t.selection={type:"connection",connection:s}}async selectRemoteKernelFromPicker(e,t,n){let i,o=u=>{let d=this.displayDataProvider.getDisplayData(u);return{label:`${u===i?"$(star-full) ":""}${d.label}`,description:d.description,detail:d.detail}},s=u=>({label:this.displayDataProvider.getDisplayData(u).category||"Other"}),a=u=>({label:y.failedToFetchKernelSpecsRemoteErrorMessageForQuickPickLabel,detail:y.failedToFetchKernelSpecsRemoteErrorMessageForQuickPickDetail}),l=new Hp(t,o,s,{supportsBack:!0},a),c=new yd(this.jupyterConnection);return t.then(u=>c.findPreferredRemoteKernelConnection(e,u,n)).then(u=>{i=u,u?.kind==="startUsingRemoteKernelSpec"&&(l.recommended=u),l.selected=u}).catch(u=>C("Failed to determine preferred remote kernel",u)),l.selectItem(n)}};ob=g([(0,fc.injectable)(),p(0,(0,fc.inject)(Wr)),p(1,(0,fc.inject)(cr)),p(2,(0,fc.inject)(Jo)),p(3,(0,fc.inject)(Dn)),p(4,(0,fc.inject)(vp)),p(5,(0,fc.inject)(EC)),p(6,(0,fc.inject)(Ut))],ob);function G4(r,e){r.addSingleton(xt,zy),r.addBinding(xt,Ie),r.addSingleton(vp,$y),r.addSingleton(Sk,ob),r.addSingleton(xk,rb),r.addSingleton(hx,ib),r.addBinding(hx,Ie),r.addSingleton(Ie,tb),q4(r,e)}var If=k(A());var $a=Symbol("IJupyterDebugService"),Id=Symbol("INotebookDebuggingManager");var J_=Symbol("IDebugLocationTrackerFactory"),$_=Symbol("IDebugLocationTracker");var sb=class{constructor(e,t,n,i){this.debuggingManager=e;this.vscNotebook=t;this.disposables=n;this.commandManager=i}activate(){this.disposables.push(this.commandManager.registerCommand(V.RunByLine,this.runByLine,this)),this.disposables.push(this.commandManager.registerCommand(V.RunByLineNext,this.runByLineNext,this)),this.disposables.push(this.commandManager.registerCommand(V.RunByLineStop,this.runByLineStop,this)),this.disposables.push(this.commandManager.registerCommand(V.RunAndDebugCell,this.runAndDebugCell,this))}async runByLine(e){R("DATASCIENCE.DEBUGGING.CLICKED_RUNBYLINE"),e??=this.getCellFromActiveEditor(),e&&await this.debuggingManager.tryToStartDebugging(0,e)}async runByLineNext(e){e??=this.getCellFromActiveEditor(),e&&this.debuggingManager.runByLineNext(e)}async runByLineStop(e){e??=this.getCellFromActiveEditor(),e&&this.debuggingManager.runByLineStop(e)}async runAndDebugCell(e){R("DATASCIENCE.DEBUGGING.CLICKED_RUN_AND_DEBUG_CELL"),e??=this.getCellFromActiveEditor(),e&&await this.debuggingManager.tryToStartDebugging(1,e)}getCellFromActiveEditor(){let e=this.vscNotebook.activeNotebookEditor;if(e){let t=e.selections[0];if(t)return e.notebook.cellAt(t.start)}}dispose(){this.disposables.forEach(e=>e.dispose())}};sb=g([(0,If.injectable)(),p(0,(0,If.inject)(Id)),p(1,(0,If.inject)(qe)),p(2,(0,If.inject)(O)),p(3,(0,If.inject)(Fe))],sb);var ku=k(A());var ab=class{constructor(e,t,n){this.debugService=e;this.disposables=t;this.debugVariables=n}activate(){this.disposables.push(this.debugService.registerDebugAdapterTrackerFactory(xe,this)),this.disposables.push(this.debugService.registerDebugAdapterTrackerFactory(YS,this)),this.disposables.push(this.debugService.registerDebugAdapterTrackerFactory(XS,this))}createDebugAdapterTracker(e){return this.debugVariables}};ab=g([(0,ku.injectable)(),p(0,(0,ku.inject)($a)),p(0,(0,ku.named)(Le.MULTIPLEXING_DEBUGSERVICE)),p(1,(0,ku.inject)(O)),p(2,(0,ku.inject)(pi)),p(2,(0,ku.named)(Le.DEBUGGER_VARIABLES))],ab);var Zs=k(A());var z4=require("vscode");var LF=new Set(["DataFrame","list","dict","ndarray","Series","Tensor","EagerTensor","DataArray"]);function G_(r){return{name:r.evaluateName??r.name,type:r.type,count:0,shape:"",size:0,supportsDataExplorer:LF.has(r.type||""),value:r.value,truncated:!0,frameId:r.variablesReference}}var UF=require("vscode"),lb=class{constructor(e){this._sessionId=e;this.topMostFrameId=0;this.sequenceNumbersOfRequestsPendingResponses=new Set;this.waitingForStackTrace=!1;this.debugLocationUpdatedEvent=new UF.EventEmitter;this.sessionEndedEmitter=new UF.EventEmitter;this.DebugLocation=void 0}get sessionId(){return this._sessionId}get sessionEnded(){return this.sessionEndedEmitter.event}get debugLocationUpdated(){return this.debugLocationUpdatedEvent.event}get debugLocation(){return this._debugLocation}onDidSendMessage(e){if(this.isResponseForRequestToFetchAllFrames(e)){let t=e.body?.stackFrames[0];this.topMostFrameId=t?.id,this.sequenceNumbersOfRequestsPendingResponses.delete(e.request_seq),this.waitingForStackTrace&&(this.DebugLocation={lineNumber:t?.line,fileName:this.normalizeFilePath(t?.source?.path),column:t.column},this.waitingForStackTrace=!1)}this.isStopEvent(e)&&(this.waitingForStackTrace=!0),this.isContinueEvent(e)&&(this.DebugLocation=void 0,this.waitingForStackTrace=!1)}onWillStopSession(){this.sessionEndedEmitter.fire(this)}onWillReceiveMessage(e){this.isRequestToFetchAllFrames(e)&&this.sequenceNumbersOfRequestsPendingResponses.add(e.seq)}set DebugLocation(e){let t=this._debugLocation;this._debugLocation=e,this._debugLocation!==t&&this.debugLocationUpdatedEvent.fire()}normalizeFilePath(e){return process.platform!=="win32"?e.replace(/\\/g,"/"):e}isStopEvent(e){return e.type==="event"&&e.event==="stopped"}isContinueEvent(e){if(e.type==="event"){if(e.event==="continue")return!0}else if(e.type==="response"&&e.command==="continue")return!0;return!1}isResponseForRequestToFetchAllFrames(e){return e.type==="response"&&e.command==="stackTrace"&&e.body?.stackFrames[0]&&this.sequenceNumbersOfRequestsPendingResponses.has(e.request_seq)}isRequestToFetchAllFrames(e){return e.type==="request"&&e.command==="stackTrace"&&(e.arguments.startFrame===0||e.arguments.startFrame===void 0)}};var dve=new Set(["In","Out","exit","quit"]),z_=100,cb=class extends lb{constructor(t,n,i,o,s,a,l){super(void 0);this.debugService=t;this.debuggingManager=n;this.configService=i;this.vscNotebook=o;this.varScriptGenerator=s;this.dfScriptGenerator=a;this.kernelProvider=l;this.refreshEventEmitter=new z4.EventEmitter;this.lastKnownVariables=[];this.importedGetVariableInfoScriptsIntoKernel=new Set;this.watchedNotebooks=new Map;this.debuggingStarted=!1;this.currentVariablesReference=0;this.currentSeqNumsForVariables=new Set;this.debuggingManager.onDoneDebugging(()=>this.refreshEventEmitter.fire(),this)}get refreshRequired(){return this.refreshEventEmitter.event}get active(){return(this.debugService.activeDebugSession!==void 0||this.activeNotebookIsDebugging())&&this.debuggingStarted}async getVariables(t,n){n&&this.watchKernel(n);let i=n&&this.kernelProvider.getKernelExecution(n),o={executionCount:i?i.executionCount:t.executionCount,pageStartIndex:0,pageResponse:[],totalCount:0,refreshCount:t.refreshCount};if(this.active){let s=t.sortColumn,a=(u,d)=>{let f=u[s]?u[s]:"",h=d[s]?d[s]:"";return t.sortAscending?f.localeCompare(h,void 0,{sensitivity:"base"}):h.localeCompare(f,void 0,{sensitivity:"base"})};this.lastKnownVariables.sort(a);let l=t.startIndex?t.startIndex:0,c=t.pageSize?t.pageSize:z_;o.pageStartIndex=l;for(let u=l;u<l+c&&u<this.lastKnownVariables.length;u+=1){let d=this.lastKnownVariables[u].truncated?await this.getFullVariable(this.lastKnownVariables[u]):this.lastKnownVariables[u];this.lastKnownVariables[u]=d,o.pageResponse.push(d)}o.totalCount=this.lastKnownVariables.length}return o}async getMatchingVariable(t,n){if(this.active){let i=this.lastKnownVariables.find(o=>o.name===t);return i&&n?.resourceUri&&Yu(n?.resourceUri).toLowerCase()===".ipynb"&&R("DATASCIENCE.RUN_BY_LINE_VARIABLE_HOVER"),i}}async getDataFrameInfo(t,n,i,o){if(!this.active)return t;o&&(t=await this.getFullVariable(t)),n&&this.watchKernel(n);let s=t.name;i&&(s=`${t.name}${i}`);let{cleanupCode:a,initializeCode:l,code:c}=await this.dfScriptGenerator.generateCodeToGetDataFrameInfo({isDebugging:!0,variableName:s}),u=await this.evaluate({code:c,cleanupCode:a,initializeCode:l,frameId:t.frameId}),d=n?.notebook,f=d?Te(d.uri.path):"";return!f&&this.debugLocation?.fileName&&(f=Te(this.debugLocation.fileName)),u?{...t,...JSON.parse(u.result),maximumRowChunkSize:z_,fileName:f}:t}async getDataFrameRows(t,n,i,o,s){if(i-n>z_)throw new Error(`Debugger cannot provide more than ${z_} rows at once`);if(!this.debugService.activeDebugSession||t.columns===void 0)return{data:[]};o&&this.watchKernel(o);let a=t.name;s&&(a=`${t.name}${s}`);let{cleanupCode:l,initializeCode:c,code:u}=await this.dfScriptGenerator.generateCodeToGetDataFrameRows({isDebugging:!0,variableName:a,startIndex:n,endIndex:i}),d=await this.evaluate({code:u,cleanupCode:l,initializeCode:c,frameId:t.frameId});return PF(JSON.parse(d.result))}onWillReceiveMessage(t){super.onWillReceiveMessage(t),t.type==="request"&&t.command==="variables"&&t.arguments&&this.currentVariablesReference===t.arguments.variablesReference&&this.currentSeqNumsForVariables.add(t.seq)}onDidSendMessage(t){if(super.onDidSendMessage(t),t.type==="response"&&t.command==="initialize")this.debuggingStarted=!0;else if(t.type==="event"&&t.event==="stopped"&&this.activeNotebookIsDebugging())this.handleNotebookVariables(t).catch(m);else if(t.type==="response"&&t.command==="scopes"&&t.body&&t.body.scopes){let i=t.body.scopes[0].variablesReference;i!==this.currentVariablesReference&&(this.currentVariablesReference=i,this.currentSeqNumsForVariables.clear())}else if(t.type==="response"&&t.command==="variables"&&t.body)this.currentSeqNumsForVariables.has(t.request_seq)&&this.updateVariables(void 0,t),this.monkeyPatchDataViewableVariables(t);else if(t.type==="event"&&t.event==="terminated"){this.lastKnownVariables=[],this.topMostFrameId=0,this.debuggingStarted=!1,this.refreshEventEmitter.fire();let n=this.debugService.activeDebugSession?.id;n&&this.importedGetVariableInfoScriptsIntoKernel.delete(n)}}watchKernel(t){let n=t.notebook?.uri.toString();if(n&&!this.watchedNotebooks.has(n)){let i=[];i.push(t.onRestarted(this.resetImport.bind(this,n))),i.push(t.onDisposed(()=>{this.resetImport(n),i.forEach(o=>o.dispose()),this.watchedNotebooks.delete(n)})),this.watchedNotebooks.set(n,i)}}resetImport(t){this.importedGetVariableInfoScriptsIntoKernel.delete(t)}async evaluate({code:t,cleanupCode:n,frameId:i,initializeCode:o}){if(this.debugService.activeDebugSession){i=this.topMostFrameId||i;let s={frameId:i,context:"repl",format:{rawString:!0}};w(`Evaluating in debugger : ${this.debugService.activeDebugSession.id}: ${t}`);try{o&&await this.debugService.activeDebugSession.customRequest("evaluate",{...s,expression:o});let a=await this.debugService.activeDebugSession.customRequest("evaluate",{...s,expression:t});if(a&&a.result!=="None")return a;C(`Cannot evaluate ${t}`);return}finally{n&&await this.debugService.activeDebugSession.customRequest("evaluate",{...s,expression:n})}}throw Error("Debugger is not active, cannot evaluate.")}async getFullVariable(t){let{initializeCode:n,code:i,cleanupCode:o}=await this.varScriptGenerator.generateCodeToGetVariableInfo({isDebugging:!0,variableName:t.name}),s=await this.evaluate({code:i,initializeCode:n,cleanupCode:o,frameId:t.frameId});return s&&s.result?{...t,truncated:!1,...JSON.parse(s.result)}:t}monkeyPatchDataViewableVariables(t){t.body.variables.forEach(n=>{n.type&&LF.has(n.type)&&(n.__vscodeVariableMenuContext="viewableInDataViewer")})}updateVariables(t,n){let i=this.configService.getSettings(t).variableExplorerExclude?this.configService.getSettings().variableExplorerExclude?.split(";"):[],o=n.body.variables.filter(s=>!(!s.name||!s.type||!s.value||i&&i.includes(s.type)||s.name.startsWith("_")||dve.has(s.name)||s.type==="NoneType"));this.lastKnownVariables=o.map(s=>G_(s)),this.refreshEventEmitter.fire()}activeNotebookIsDebugging(){let t=this.vscNotebook.activeNotebookEditor;return!!t&&this.debuggingManager.isDebugging(t.notebook)}async handleNotebookVariables(t){let n=this.vscNotebook.activeNotebookEditor?.notebook,i=t.body.threadId;if(n){let o=this.debuggingManager.getDebugSession(n);if(o){let s=await o.customRequest("stackTrace",{threadId:i,startFrame:0,levels:1});if(s&&s.stackFrames[0]){let a=s.stackFrames[0],l=this.debuggingManager.getDebugMode(n),c;if(l===0){let u=this.debuggingManager.getDebugCell(n);a.source&&u&&a.source.path===u.document.uri.toString()&&(c=await o.customRequest("scopes",{frameId:a.id}))}else{let u=Te(n.uri.toString());a.source&&a.source.path&&a.source.path.includes(u)&&(c=await o.customRequest("scopes",{frameId:a.id}))}c&&(c.scopes.forEach(u=>{o.customRequest("variables",{variablesReference:u.variablesReference}).then(m,m)}),this.refreshEventEmitter.fire())}}}}};cb=g([(0,Zs.injectable)(),p(0,(0,Zs.inject)($a)),p(0,(0,Zs.named)(Le.MULTIPLEXING_DEBUGSERVICE)),p(1,(0,Zs.inject)(Id)),p(2,(0,Zs.inject)(se)),p(3,(0,Zs.inject)(qe)),p(4,(0,Zs.inject)(_h)),p(5,(0,Zs.inject)(Rh)),p(6,(0,Zs.inject)(Ke))],cb);var ea=k(A()),t0=require("vscode");var nr=class{constructor(e,t){this.name=e;this.commandManager=t}get value(){return this.lastValue}async set(e){this.lastValue!==e&&(this.lastValue=e,await this.commandManager.executeCommand("setContext",this.name,this.lastValue))}};var WC=(o=>(o[o.Unknown=0]="Unknown",o[o.Ok=1]="Ok",o[o.Outdated=2]="Outdated",o[o.NotInstalled=3]="NotInstalled",o[o.ControllerNotSelected=4]="ControllerNotSelected",o))(WC||{});async function Q4(r){let e=`import builtins
import ipykernel
builtins.print(ipykernel.__version__)`,t=await r.executeHidden(e),n=/^(\d+)\.\d+\.\d+$/;for(let i of t){if(i.output_type!=="stream")continue;let s=(i.text?.toString().trim()??"").match(n);if(s){let a=s[1];return Number(a)>=6?1:2}}return 0}function jC(r){let e=r;if(typeof e.__notebookUri>"u"||typeof e.__mode>"u"||(e.__mode===1||e.__mode===2||e.__mode===0)&&typeof e.__cellIndex>"u")throw new Error("Invalid launch configuration")}function Y4(r){if(jC(r),r.__mode!==2)throw new Error("Invalid launch configuration")}function Q_(r,e){switch(r.type){case"event":let t=r;switch(t.event){case"output":e(t.body);break;case"loadedSource":e(t.body);break;case"breakpoint":e(t.body.breakpoint);break;default:break}break;case"request":let n=r;switch(n.command){case"setBreakpoints":let o=n.arguments,s=o.breakpoints;if(s&&s.length){let a=s[0].line;s.forEach(c=>{e(c,{...o.source})});let l={source:o.source,line:a};e(l),o.source=l.source}break;case"breakpointLocations":e(n.arguments);break;case"source":e(n.arguments);break;case"gotoTargets":e(n.arguments);break;default:break}break;case"response":let i=r;if(i.success&&i.body)switch(i.command){case"stackTrace":i.body.stackFrames.forEach(o=>{e(o)});break;case"loadedSources":i.body.sources.forEach(o=>{let s={source:o};e(s),o.path=s.source.path});break;case"scopes":i.body.scopes.forEach(o=>{e(o)});break;case"setFunctionBreakpoints":i.body.breakpoints.forEach(o=>{e(o)});break;case"setBreakpoints":i.body.breakpoints.forEach(o=>{e(o)});break;default:break}break}}function X4(r){return/~\d+\\/.test(r)}function Z4(r,e){return new RegExp(r.replace(/\\/g,"\\\\").replace(/~\d+\\\\/g,"[^\\\\]+\\\\"),"i").test(e)}async function Sf(r,e){let t=`import debugpy
debugpy.debug_this_thread()`;await r.executeHidden(t),await e.dumpAllCells()}function eG(r){return!!r.header&&r.header.msg_type==="debug_event"}function VC(r){return r.includes("Frame skipped from debugging during step-in")}function WF(r){return r.event==="debugpyAttach"}var Y_=class{constructor(e,t,n,i){this.debugAdapter=e;this.debugCell=t;this.execution=n;this.commandManager=i;R("DATASCIENCE.DEBUGGING.SUCCESSFULLY_STARTED_RUN_AND_DEBUG_CELL")}trace(e,t){w(`[Debug-Cell] ${e}: ${t}`)}async willSendEvent(e){return WF(e)?(this.trace("intercept","debugpyAttach request for subprocess, not supported"),!0):e.event==="output"&&VC(e.body.output)?(this.trace("intercept","justMyCode notification"),!0):!1}async willSendRequest(e){e.command==="configurationDone"&&(await Sf(this.execution,this.debugAdapter),this.commandManager.executeCommand("notebook.cell.execute",{ranges:[{start:this.debugCell.index,end:this.debugCell.index+1}],document:this.debugCell.notebook.uri}).then(m,m))}};var BC=class{constructor(e,t,n,i){this.mode=e;this.debugAdapter=t;this.debugCell=n;this.serviceContainer=i;this.debuggingManager=this.serviceContainer.get(Id)}trace(e,t){w(`[Debug-Restart] ${e}: ${t}`)}error(e,t){C(`[Debug-Restart] ${e}: ${t}`)}async willSendResponse(e){e.command==="initialize"&&e.body&&(e.body.supportsRestartRequest=!0)}async willSendRequest(e){if(e.command==="restart")return this.trace("restart","Handling restart request"),setTimeout(()=>{this.debugAdapter.disconnect().then(()=>(this.trace("restart","doRestart"),this.debuggingManager.tryToStartDebugging(this.mode,this.debugCell,!0))).catch(t=>{this.error("restart",`Error restarting: ${t}`)})},0),{command:e.command,request_seq:e.seq,seq:e.seq,success:!0,type:"response"}}};var tG=require("vscode");var X_=class{constructor(e,t,n,i,o){this.debugAdapter=e;this.debugCell=t;this.commandManager=n;this.execution=i;this.settings=o;R("DATASCIENCE.DEBUGGING.SUCCESSFULLY_STARTED_RUNBYLINE")}continue(){if(typeof this.lastPausedThreadId!="number"){w("No paused thread, can't do RBL"),this.stop();return}this.debugAdapter.stepIn(this.lastPausedThreadId).then(m,m)}stop(){te("RunbylineController::stop()"),this.execution.executeHidden("pass").then(m,m),this.debugAdapter.disconnect().then(m,m)}getMode(){return this.debugAdapter.getConfiguration().__mode}async willSendEvent(e){return e.event==="stopped"&&(this.lastPausedThreadId=e.body.threadId,await this.handleStoppedEvent(this.lastPausedThreadId))?(this.trace("intercepted","handled stop event"),!0):e.event==="output"&&VC(e.body.output)?(this.trace("intercept","justMyCode notification"),!0):!1}async willSendRequest(e){te(`willSendRequest: ${e.command}`),e.command==="configurationDone"&&await this.initializeExecute()}async handleStoppedEvent(e){return await this.shouldStepIn(e)?(this.debugAdapter.stepIn(e).then(m,m),!0):!1}async shouldStepIn(e){let t=await this.debugAdapter.stackTrace({threadId:e,startFrame:0,levels:1});if(t&&t.stackFrames[0]){let n=t.stackFrames[0],i=new tG.Position(n.line,n.column);return this.lastPausePosition?.isEqual(i)?(this.trace("intercept","working around duplicate stop event"),!0):(this.lastPausePosition=i,!!n.source&&n.source.path!==this.debugCell.document.uri.toString())}return!1}trace(e,t){w(`[Debug-RBL] ${e}: ${t}`)}async initializeExecute(){await Sf(this.execution,this.debugAdapter);let e=je(this.debugCell.document.getText(),{trim:!1,removeEmptyEntries:!1}),t=[];if(am(e,()=>void 0,(n,i)=>{n.trim().length!==0&&t.push(i)}),t.sort(),t.length!==0){let n={line:t[0]+1};await this.debugAdapter.setBreakpoints({source:{name:Te(this.debugCell.notebook.uri.path),path:this.debugCell.document.uri.toString()},breakpoints:[n],sourceModified:!1}),this.settings.getSettings(this.debugCell.notebook.uri).showVariableViewWhenDebugging&&this.commandManager.executeCommand(V.OpenVariableView).then(m,m)}this.commandManager.executeCommand("notebook.cell.execute",{ranges:[{start:this.debugCell.index,end:this.debugCell.index+1}],document:this.debugCell.notebook.uri}).then(m,m)}};var ub=class{constructor(e,t,n){this.document=e;this.config=t;this.session=n}};var hc=require("vscode");var pb=class{constructor(e,t,n,i,o,s){this.kernelProvider=e;this.controllerRegistration=t;this.commandManager=n;this.appShell=i;this.vscNotebook=o;this.serviceContainer=s;this.notebookToDebugger=new Map;this.notebookToDebugAdapter=new Map;this.notebookInProgress=new Set;this.disposables=[];this._doneDebugging=new hc.EventEmitter}activate(){this.disposables.push(hc.debug.onDidTerminateDebugSession(this.endSession.bind(this)),hc.workspace.onDidCloseNotebookDocument(async e=>{let t=this.notebookToDebugger.get(e);t&&(await hc.debug.stopDebugging(t.session),this.onDidStopDebugging(e))}))}getDebugCell(e){return this.notebookToDebugAdapter.get(e)?.debugCell}get onDoneDebugging(){return this._doneDebugging.event}dispose(){this.disposables.forEach(e=>e.dispose())}isDebugging(e){return this.notebookToDebugger.has(e)}getDebugSession(e){let t=this.notebookToDebugger.get(e);if(t)return t.session}getDebugAdapter(e){return this.notebookToDebugAdapter.get(e)}onDidStopDebugging(e){}async startDebuggingConfig(e,t){te(`Attempting to start debugging with config ${JSON.stringify(e)}`);try{await hc.debug.startDebugging(void 0,e,t)}catch(n){C(`Can't start debugging (${n})`),this.appShell.showErrorMessage(y.cantStartDebugging).then(m,m)}}trackDebugAdapter(e,t){this.notebookToDebugAdapter.set(e,t),this.disposables.push(t.onDidEndSession(this.endSession.bind(this)))}async endSession(e){H(`Ending debug session ${e.id}`),this._doneDebugging.fire();for(let[t,n]of this.notebookToDebugger.entries())if(n&&e.id===n.session.id){this.notebookToDebugger.delete(t),this.notebookToDebugAdapter.delete(t),this.onDidStopDebugging(t);break}}getDebuggerByUri(e){for(let[t,n]of this.notebookToDebugger.entries())if(e===t)return n}async ensureKernelIsRunning(e){let t=this.controllerRegistration.getSelected(e),n=this.kernelProvider.get(e);return t&&(!n||n&&n.status==="unknown")&&(n=await Ys.connectToNotebookKernel(t.connection,this.serviceContainer,{notebook:e,controller:t.controller,resource:e.uri},new er(!1),this.disposables,"jupyterExtension")),n}findEditorForCell(e){let t=e.notebook.uri.toString();return hc.window.visibleNotebookEditors.find(n=>n.notebook.uri.toString()===t)}async checkIpykernelAndPrompt(e,t=!0){let n=this.findEditorForCell(e);if(!n)return this.appShell.showErrorMessage(y.noNotebookToDebug).then(m,m),0;let i=await this.checkForIpykernel6(n.notebook);switch(i){case 3:break;case 2:case 0:{this.promptInstallIpykernel6().then(m,m);break}case 4:if(t)return await this.commandManager.executeCommand("notebook.selectKernel",{notebookEditor:n}),await this.checkIpykernelAndPrompt(e,!1)}return i}async checkForIpykernel6(e){try{let t=this.kernelProvider.get(e);if(!t){let o=this.controllerRegistration.getSelected(e);if(!o)return 4;t=this.kernelProvider.getOrCreate(e,{metadata:o.connection,controller:o?.controller,resourceUri:e.uri})}let n=this.kernelProvider.getKernelExecution(t),i=await Q4(n);return R("DATASCIENCE.DEBUGGING.IPYKERNEL6_STATUS",void 0,{status:i===1?"installed":"notInstalled"}),i}catch(t){C("Debugging: Could not check for ipykernel 6",t)}return 0}async promptInstallIpykernel6(){await this.appShell.showInformationMessage(y.needIpykernel6,{modal:!0},y.setup)===y.setup?(R("DATASCIENCE.DEBUGGING.CLICKED_ON_SETUP"),this.appShell.openUrl("https://github.com/microsoft/vscode-jupyter/wiki/Setting-Up-Run-by-Line-and-Debugging-for-Notebooks")):R("DATASCIENCE.DEBUGGING.CLOSED_MODAL")}};var ho=require("vscode");var Z_=class{constructor(e){this.debugAdapter=e}trace(e,t){w(`[Debug-Reset] ${e}: ${t}`)}async willSendRequest(e){e.command==="attach"&&(this.trace("attach","Continuing paused kernel threads if needed"),(await this.debugAdapter.debugInfo()).stoppedThreads.forEach(n=>this.debugAdapter.continueDirect(n)))}};var db=class{constructor(e,t,n,i,o,s){this.session=e;this.notebookDocument=t;this.jupyterSession=n;this.kernel=i;this.platformService=o;this.debugService=s;this.fileToCell=new Map;this.sendMessage=new ho.EventEmitter;this.endSession=new ho.EventEmitter;this.disposables=[];this.delegates=[];this.onDidSendMessage=this.sendMessage.event;this.onDidEndSession=this.endSession.event;this.disconnected=!1;te("Creating kernel debug adapter for debugging notebooks");let a=this.session.configuration;jC(a),this.configuration=a,this.debugCell=t.cellAt(a.__cellIndex),this.addDebuggingDelegates([new Z_(this)]),this.jupyterSession.kernel?.iopubMessage.connect(this.onIOPubMessage,this),this.disposables.push(new ho.Disposable(()=>this.jupyterSession.kernel?.iopubMessage.disconnect(this.onIOPubMessage,this))),this.kernel&&(this.kernel.addHook("willRestart",()=>this.disconnect(),this,this.disposables),this.kernel.addHook("interruptCompleted",()=>this.disconnect(),this,this.disposables),this.disposables.push(this.kernel.onDisposed(()=>{this.disconnected||(ho.debug.stopDebugging(this.session).then(m,m),this.disconnect().catch(m),R("DATASCIENCE.DEBUGGING.ENDED_SESSION",void 0,{reason:"onKernelDisposed"}))}))),this.disposables.push(ho.notebooks.onDidChangeNotebookCellExecutionState(l=>{this.configuration.__cellIndex===l.cell.index&&l.state===ho.NotebookCellExecutionState.Idle&&!this.disconnected&&(R("DATASCIENCE.DEBUGGING.ENDED_SESSION",void 0,{reason:"normally"}),this.disconnect().catch(m))},this,this.disposables)),this.disposables.push(ho.workspace.onDidChangeNotebookDocument(l=>{l.contentChanges.forEach(c=>{c.removedCells.forEach(u=>{u===this.debugCell&&this.disconnect().catch(m)})})},this,this.disposables)),this.disposables.push(this.debugService.onDidTerminateDebugSession(l=>{l===this.session&&this.disconnect().catch(m)}))}addDebuggingDelegates(e){this.delegates.push(...e)}trace(e,t){w(`[Debug] ${e}: ${t}`)}async onIOPubMessage(e,t){if(te(`Debug IO Pub message: ${JSON.stringify(t)}`),eG(t)){this.trace("event",JSON.stringify(t));for(let n of this.delegates??[])if(await n?.willSendEvent?.(t.content))return;this.sendMessage.fire(t.content)}}handleMessage(e){this.handleClientMessageAsync(e).catch(m)}async handleClientMessageAsync(e){try{if(te(`KernelDebugAdapter::handleMessage ${JSON.stringify(e,void 0," ")}`),e.type==="request"&&e.command==="setBreakpoints"){let t=e.arguments;if(t.source&&t.source.path&&t.source.path.indexOf("vscode-notebook-cell:")===0){let n=this.notebookDocument.getCells().find(i=>i.document.uri.toString()===t.source.path);n&&await this.dumpCell(n.index)}}if(e.type==="request")for(let t of this.delegates??[]){let n=await t?.willSendRequest?.(e);if(n){this.trace("response",JSON.stringify(n)),this.sendMessage.fire(n);return}}await this.sendMessageToJupyterSession(e)}catch(t){C(`KernelDebugAdapter::handleMessage failure: ${t}`)}}getConfiguration(){return this.configuration}stepIn(e){return this.session.customRequest("stepIn",{threadId:e})}async debugInfo(){return await this.session.customRequest("debugInfo")}continueDirect(e){if(!this.jupyterSession.kernel)throw new Sn;this.jupyterSession.kernel.requestDebug({seq:0,type:"request",command:"continue",arguments:{threadId:e}})}async disconnect(){if(!this.disconnected){if(this.disconnected=!0,this.debugService.activeDebugSession===this.session)try{await Promise.all([this.deleteDumpedFiles().catch(e=>J("Error deleting temporary debug files.",e)),this.session.customRequest("disconnect",{restart:!1})])}catch(e){C("Failed to disconnect debug session",e)}this.endSession.fire(this.session)}}dispose(){this.disposables.forEach(e=>e.dispose())}stackTrace(e){return this.session.customRequest("stackTrace",e)}setBreakpoints(e){return this.session.customRequest("setBreakpoints",e)}async dumpAllCells(){await Promise.all(this.notebookDocument.getCells().map(async e=>{e.kind===ho.NotebookCellKind.Code&&await this.dumpCell(e.index)}))}lookupCellByLongName(e){if(this.platformService.isWindows){e=Pn(e);for(let[t,n]of this.fileToCell.entries())if(X4(t)&&Z4(t,e))return n}}async sendMessageToJupyterSession(e){if(this.jupyterSession.isDisposed||this.jupyterSession.status==="dead"||!this.jupyterSession.kernel){H(`Skipping sending message ${e.type} because session is disposed`);return}if(this.trace("to kernel",JSON.stringify(e)),e.type==="request"){let t=await this.sendRequestToJupyterSession(e);t&&this.sendMessage.fire(t)}else if(e.type==="response"){Q_(e,this.translateRealLocationToDebuggerLocation.bind(this));let t=e;return this.jupyterSession.kernel.requestDebug({seq:t.seq,type:"request",command:t.command},!0).done}else C(`Unknown message type to send ${e.type}`)}async sendRequestToJupyterSession(e){if(Q_(e,this.translateRealLocationToDebuggerLocation.bind(this)),!this.jupyterSession.kernel)throw new Sn;this.trace("to kernel, mapped",JSON.stringify(e));let t=e,o=(await this.jupyterSession.kernel.requestDebug({seq:t.seq,type:"request",command:t.command,arguments:t.arguments},!0).done).content;Q_(o,this.translateDebuggerLocationToRealLocation.bind(this));for(let s of this.delegates??[])await s?.willSendResponse?.(o);return this.trace("response",JSON.stringify(o)),o}translateDebuggerLocationToRealLocation(e,t){if(t=e?.source??t,t&&t.path){let n=this.fileToCell.get(t.path)??this.lookupCellByLongName(t.path);n&&(t.name=Te(n.path),t.path=n.toString())}}async deleteDumpedFiles(){let e=this.getDumpFilesForDeletion();if(this.jupyterSession.kernel&&e.length){let n=`import os as _VSCODE_os
_VSCODE_fileList = [${e.map(i=>'"'+i.replace(/\\/g,"\\\\")+'"').join(",")}]
for file in _VSCODE_fileList:
    try:
        _VSCODE_os.remove(file)
    except:
        pass
del _VSCODE_fileList
del _VSCODE_os`;await xn(this.jupyterSession.kernel,n,{traceErrors:!0,traceErrorsMessage:"Error deleting temporary debugging files"})}}};var e0=class extends db{constructor(){super(...arguments);this.cellToFile=new Map}async dumpCell(t){let n=this.notebookDocument.cellAt(t);try{let i=await this.session.customRequest("dumpCell",{code:n.document.getText().replace(/\r\n/g,`
`)}),o=Pn(i.sourcePath);this.fileToCell.set(o,n.document.uri),this.cellToFile.set(n.document.uri.toString(),o)}catch(i){C(i)}}translateRealLocationToDebuggerLocation(t){let n=t.source;if(n&&n.path){let i=this.cellToFile.get(n.path);i&&(n.path=i)}}getDumpFilesForDeletion(){return Array.from(this.cellToFile.values())}};var mb=class extends pb{constructor(t,n,i,o,s,a,l,c,u){super(t,n,i,o,s,u);this.configurationService=a;this.platform=l;this.debugService=c;this.notebookToRunByLineController=new Map;this.runByLineCells=new nr(fr.RunByLineCells,i),this.runByLineDocuments=new nr(fr.RunByLineDocuments,i),this.debugDocuments=new nr(fr.DebugDocuments,i)}activate(){super.activate(),this.disposables.push(t0.debug.registerDebugAdapterDescriptorFactory(YS,{createDebugAdapterDescriptor:async t=>this.createDebugAdapterDescriptor(t)}))}getDebugMode(t){return this.notebookToRunByLineController.get(t)?.getMode()}onDidStopDebugging(t){super.onDidStopDebugging(t),this.notebookToRunByLineController.delete(t),this.updateRunByLineContextKeys(),this.updateDebugContextKey()}updateRunByLineContextKeys(){let t=[],n=[];this.notebookToRunByLineController.forEach(i=>{t.push(i.debugCell.document.uri),n.push(i.debugCell.notebook.uri)}),this.runByLineCells.set(t).catch(m),this.runByLineDocuments.set(n).catch(m)}updateDebugContextKey(){let t=new Zl;this.notebookToDebugAdapter.forEach((n,i)=>t.add(i.uri)),this.notebookInProgress.forEach(n=>t.add(n.uri)),this.debugDocuments.set(Array.from(t.values())).catch(m)}async tryToStartDebugging(t,n,i=!1){if(H(`Starting debugging with mode ${t}`),!i){let o=await this.checkIpykernelAndPrompt(n);if(o!==1){H(`Ipykernel check failed: ${WC[o]}`);return}}(t===0||t===1)&&await this.startDebuggingCell(t,n)}runByLineNext(t){let n=this.notebookToRunByLineController.get(t.notebook);n&&n.debugCell.document.uri.toString()===t.document.uri.toString()&&n.continue()}runByLineStop(t){let n=this.notebookToRunByLineController.get(t.notebook);n&&(R("DATASCIENCE.DEBUGGING.ENDED_SESSION",void 0,{reason:"withKeybinding"}),n.stop())}async startDebuggingCell(t,n){let i=n.notebook,o=this.configurationService.getSettings(i.uri),s={type:YS,name:Te(i.uri.toString()),request:"attach",justMyCode:t===1?o.debugJustMyCode:!0,__mode:t,__cellIndex:n.index,__notebookUri:i.uri.toString()},a=t===0?{suppressDebugStatusbar:!0,suppressDebugToolbar:!0,suppressDebugView:!0,suppressSaveBeforeStart:!0}:{suppressSaveBeforeStart:!0};return this.startDebuggingConfig(s,a)}async createDebugAdapterDescriptor(t){let n=t.configuration;jC(n);let i=n.__notebookUri,o=this.vscNotebook.notebookDocuments.find(s=>s.uri.toString()===i);if(!o){H(`Cannot start debugging. Notebook ${i} not found.`);return}if(this.notebookInProgress.has(o)){H("Cannot start debugging. Already debugging this notebook");return}if(this.isDebugging(o)){H("Cannot start debugging. Already debugging this notebook document.");return}this.notebookToDebugger.set(o,new ub(o,n,t));try{return this.notebookInProgress.add(o),this.updateDebugContextKey(),await this.doCreateDebugAdapterDescriptor(n,t,o)}finally{this.notebookInProgress.delete(o),this.updateDebugContextKey()}}async doCreateDebugAdapterDescriptor(t,n,i){let o=await this.ensureKernelIsRunning(i);if(o?.session){let s=new e0(n,i,o.session,o,this.platform,this.debugService);if(t.__mode===0&&typeof t.__cellIndex=="number"){let a=i.cellAt(t.__cellIndex),l=new X_(s,a,this.commandManager,this.kernelProvider.getKernelExecution(o),this.configurationService);s.addDebuggingDelegates([l,new BC(0,s,a,this.serviceContainer)]),this.notebookToRunByLineController.set(i,l),this.updateRunByLineContextKeys()}else if(t.__mode===1&&typeof t.__cellIndex=="number"){let a=i.cellAt(t.__cellIndex),l=new Y_(s,a,this.kernelProvider.getKernelExecution(o),this.commandManager);s.addDebuggingDelegates([l,new BC(1,s,a,this.serviceContainer)])}return this.trackDebugAdapter(i,s),this.updateDebugContextKey(),new t0.DebugAdapterInlineImplementation(s)}else this.appShell.showInformationMessage(y.kernelWasNotStarted).then(m,m)}};mb=g([(0,ea.injectable)(),p(0,(0,ea.inject)(Ke)),p(1,(0,ea.inject)(xt)),p(2,(0,ea.inject)(Fe)),p(3,(0,ea.inject)(ue)),p(4,(0,ea.inject)(qe)),p(5,(0,ea.inject)(se)),p(6,(0,ea.inject)(Ir)),p(7,(0,ea.inject)(Ui)),p(8,(0,ea.inject)(ct))],mb);var qC=k(A()),rG=require("vscode");var fb=class{constructor(e,t){this.disposableRegistry=t;this.activeTrackers=new WeakMap;this.updatedEmitter=new rG.EventEmitter;t.push(e.registerDebugAdapterTrackerFactory("python",this))}createDebugAdapterTracker(e){let t=new lb(e.id);return this.activeTrackers.set(e,t),t.sessionEnded(()=>this.activeTrackers.delete(e),this,this.disposableRegistry),t.debugLocationUpdated(this.onLocationUpdated,this,this.disposableRegistry),this.onLocationUpdated(),t}get updated(){return this.updatedEmitter.event}getLocation(e){let t=this.activeTrackers.get(e);if(t)return t.debugLocation}onLocationUpdated(){this.updatedEmitter.fire()}};fb=g([(0,qC.injectable)(),p(0,(0,qC.inject)(Ui)),p(1,(0,qC.inject)(O))],fb);var n0=k(A()),oG=k(require("net"));var sG=k(po()),xf=require("vscode");var iG=require("events"),nG=`\r
\r
`,r0=class{constructor(){this.rawData=Buffer.concat([]);this.contentLength=-1;this.disposed=!1;this.dataCallbackHandler=e=>{this.handleData(e)};this.events=new iG.EventEmitter}dispose(){this.stream&&(this.stream.removeListener("data",this.dataCallbackHandler),this.stream=void 0)}connect(e){this.stream=e,e.addListener("data",this.dataCallbackHandler)}on(e,t){return this.events.on(e,t),this}once(e,t){return this.events.once(e,t),this}dispatch(e){let t=JSON.parse(e);switch(t.type){case"event":{let n=t;typeof n.event=="string"&&this.events.emit(`${t.type}_${n.event}`,n);break}case"request":{let n=t;typeof n.command=="string"&&this.events.emit(`${t.type}_${n.command}`,n);break}case"response":{let n=t;typeof n.command=="string"&&this.events.emit(`${t.type}_${n.command}`,n);break}default:this.events.emit(`${t.type}`,t)}this.events.emit("data",t)}handleData(e){if(!this.disposed)for(this.rawData=Buffer.concat([this.rawData,e]);;){if(this.contentLength>=0){if(this.rawData.length>=this.contentLength){let t=this.rawData.toString("utf8",0,this.contentLength);this.rawData=this.rawData.slice(this.contentLength),this.contentLength=-1,t.length>0&&this.dispatch(t);continue}}else{let t=this.rawData.indexOf(nG);if(t!==-1){let i=this.rawData.toString("utf8",0,t).split(`\r
`);for(let o of i){let s=o.split(/: +/);s[0]==="Content-Length"&&(this.contentLength=+s[1])}this.rawData=this.rawData.slice(t+nG.length);continue}}break}}};var jF=class{constructor(e,t,n){this._id=e;this._configuration=t;this.customRequestHandler=n;this._name="JupyterDebugSession";}get id(){return this._id}get type(){return"python"}get name(){return this._name}get workspaceFolder(){}get configuration(){return this._configuration}customRequest(e,t){return this.customRequestHandler(e,t)}getDebugProtocolBreakpoint(e){return Promise.resolve(void 0)}},hb=class{constructor(e){this.sequence=1;this.breakpointEmitter=new xf.EventEmitter;this.debugAdapterTrackerFactories=[];this.debugAdapterTrackers=[];this.sessionChangedEvent=new xf.EventEmitter;this.sessionStartedEvent=new xf.EventEmitter;this.sessionTerminatedEvent=new xf.EventEmitter;this.sessionCustomEvent=new xf.EventEmitter;this.breakpointsChangedEvent=new xf.EventEmitter;this._breakpoints=[];e.push(this),this.protocolParser=new r0}dispose(){this.socket&&(this.socket.end(),this.socket=void 0)}get activeDebugSession(){return this.session}get activeDebugConsole(){return{append(e){},appendLine(e){}}}get breakpoints(){return this._breakpoints}get onDidChangeActiveDebugSession(){return this.sessionChangedEvent.event}get onDidStartDebugSession(){return this.sessionStartedEvent.event}get onDidReceiveDebugSessionCustomEvent(){return this.sessionCustomEvent.event}get onDidTerminateDebugSession(){return this.sessionTerminatedEvent.event}get onDidChangeBreakpoints(){return this.breakpointsChangedEvent.event}registerDebugConfigurationProvider(e,t){return{dispose:()=>{}}}registerDebugAdapterTrackerFactory(e,t){return this.debugAdapterTrackerFactories.push(t),{dispose:()=>{this.debugAdapterTrackerFactories=this.debugAdapterTrackerFactories.filter(n=>n!==t)}}}startRunByLine(e){return this.startDebugging(void 0,e)}startDebugging(e,t,n){let i=t;return i.port?(this.session=new jF((0,sG.default)(),i,this.sendCustomRequest.bind(this)),this.sessionChangedEvent.fire(this.session),this.debugAdapterTrackers=this.debugAdapterTrackerFactories.map(o=>o.createDebugAdapterTracker(this.session)),this.socket=oG.createConnection(i.port),this.protocolParser.connect(this.socket),this.protocolParser.on("event_stopped",this.onBreakpoint.bind(this)),this.protocolParser.on("event_output",this.onOutput.bind(this)),this.protocolParser.on("event_terminated",this.sendToTrackers.bind(this)),this.socket.on("error",this.onError.bind(this)),this.socket.on("close",this.onClose.bind(this)),this.sendStartSequence(i,this.session.id).then(()=>!0)):Promise.resolve(!0)}addBreakpoints(e){this._breakpoints=this._breakpoints.concat(e)}removeBreakpoints(e){}get onBreakpointHit(){return this.breakpointEmitter.event}async continue(){await this.sendMessage("continue",{threadId:0}),this.sendToTrackers({type:"event",event:"continue"})}async step(){await this.sendMessage("stepIn",{threadId:this._stoppedThreadId?this._stoppedThreadId:1}),this.sendToTrackers({type:"event",event:"stepIn"})}async getStack(){let e=pe();return this.protocolParser.once("response_stackTrace",t=>{this.sendToTrackers(t);let n=t,i=n.body.stackFrames?n.body.stackFrames:[];e.resolve(i),this._topFrameId=i[0]?.id}),await this.emitMessage("stackTrace",{threadId:this._stoppedThreadId?this._stoppedThreadId:1,startFrame:0,levels:1}),e.promise}async requestVariables(){await this.getStack();let e=pe(),t=0;return this.protocolParser.once("response_scopes",n=>{this.sendToTrackers(n);let i=n;i&&(t=i.body.scopes[0].variablesReference),this.emitMessage("variables",{threadId:this._stoppedThreadId?this._stoppedThreadId:1,variablesReference:t}).catch(m)}),this.protocolParser.once("response_variables",n=>{this.sendToTrackers(n),e.resolve()}),await this.emitMessage("scopes",{frameId:this._topFrameId?this._topFrameId:1}),e.promise}stop(){this.onClose()}sendToTrackers(e){switch(e.type){case"request":this.debugAdapterTrackers.forEach(t=>{t.onWillReceiveMessage&&t.onWillReceiveMessage(e)});break;default:this.debugAdapterTrackers.forEach(t=>t.onDidSendMessage(e));break}}sendCustomRequest(e,t){return this.sendMessage(e,t)}async sendStartSequence(e,t){H("Sending debugger initialize..."),await this.sendInitialize(),this._breakpoints.length>0&&(H("Sending breakpoints"),await this.sendBreakpoints()),H("Sending debugger attach...");let n=this.sendAttach(e,t);return H("Sending configuration done"),await this.sendConfigurationDone(),H("Session started."),n.then(()=>{this.sessionStartedEvent.fire(this.session)})}sendBreakpoints(){let e=this._breakpoints.map(n=>n),t=e[0].location.uri.fsPath;return this.sendMessage("setBreakpoints",{source:{name:Te(t),path:t},lines:e.map(n=>n.location.range.start.line),breakpoints:e.map(n=>({line:n.location.range.start.line})),sourceModified:!0})}sendAttach(e,t){return this.sendMessage("attach",{debugOptions:["RedirectOutput","FixFilePathCase","WindowsClient","ShowReturnValue"],workspaceFolder:Xo,__sessionId:t,...e})}sendConfigurationDone(){return this.sendMessage("configurationDone")}sendInitialize(){return this.sendMessage("initialize",{clientID:"vscode",clientName:"Visual Studio Code",adapterID:"python",pathFormat:"path",linesStartAt1:!0,columnsStartAt1:!0,supportsVariableType:!0,supportsVariablePaging:!0,supportsRunInTerminalRequest:!0,locale:"en-us"})}sendDisconnect(){return this.sendMessage("disconnect",{})}sendMessage(e,t){let n=pe(),i=this.sessionTerminatedEvent.event(()=>{n.resolve({body:{}})}),o=this.sequence;return this.protocolParser.on(`response_${e}`,s=>{s.request_seq===o&&(this.sendToTrackers(s),H(`Received response from debugger: ${JSON.stringify(t)}`),i.dispose(),n.resolve(s.body))}),this.socket?.on("error",s=>n.reject(s)),this.emitMessage(e,t).catch(s=>{C(`Exception attempting to emit ${e} to debugger: `,s)}),n.promise}emitMessage(e,t){return new Promise((n,i)=>{try{if(this.socket){let o={command:e,arguments:t,type:"request",seq:this.sequence};this.sequence+=1;let s=JSON.stringify(o);H(`Sending request to debugger: ${s}`);let a=`Content-Length: ${s.length}\r
\r
${s}`;this.socket.write(a,l=>{this.sendToTrackers(o),n()})}}catch(o){i(o)}})}onBreakpoint(e){this._stoppedThreadId=e.body.threadId,this.sendToTrackers(e),this.breakpointEmitter.fire()}onOutput(e){this.sendToTrackers(e),H(JSON.stringify(e))}onError(e){this.sendToTrackers(e),H(JSON.stringify(e))}onClose(){this.socket&&(this.sessionTerminatedEvent.fire(this.activeDebugSession),this.session=void 0,this.sessionChangedEvent.fire(void 0),this.debugAdapterTrackers.forEach(e=>e.onExit?e.onExit(0,void 0):void 0),this.debugAdapterTrackers=[],this.sendDisconnect().catch(m),this.socket.destroy(),this.socket=void 0)}};hb=g([(0,n0.injectable)(),p(0,(0,n0.inject)(O))],hb);var Ha=k(A()),JC=require("vscode");var gb=class{constructor(e,t,n,i){this.commandManager=t;this.vscodeDebugService=n;this.jupyterDebugService=i;this.sessionChangedEvent=new JC.EventEmitter;this.sessionStartedEvent=new JC.EventEmitter;this.sessionTerminatedEvent=new JC.EventEmitter;this.sessionCustomEvent=new JC.EventEmitter;e.push(n.onDidTerminateDebugSession(this.endedDebugSession.bind(this))),e.push(n.onDidStartDebugSession(this.startedDebugSession.bind(this))),e.push(n.onDidChangeActiveDebugSession(this.changedDebugSession.bind(this))),e.push(n.onDidReceiveDebugSessionCustomEvent(this.gotCustomEvent.bind(this))),i&&(e.push(i.onDidTerminateDebugSession(this.endedDebugSession.bind(this))),e.push(i.onDidStartDebugSession(this.startedDebugSession.bind(this))),e.push(i.onDidChangeActiveDebugSession(this.changedDebugSession.bind(this))),e.push(i.onDidReceiveDebugSessionCustomEvent(this.gotCustomEvent.bind(this))))}get activeDebugSession(){return this.activeService.activeDebugSession}get activeDebugConsole(){return this.activeService.activeDebugConsole}get breakpoints(){return this.activeService.breakpoints}get onDidChangeActiveDebugSession(){return this.sessionChangedEvent.event}get onDidStartDebugSession(){return this.sessionStartedEvent.event}get onDidReceiveDebugSessionCustomEvent(){return this.sessionCustomEvent.event}get onDidTerminateDebugSession(){return this.sessionTerminatedEvent.event}get onDidChangeBreakpoints(){return this.activeService.onDidChangeBreakpoints}get onBreakpointHit(){if(!this.jupyterDebugService)throw new Error("No jupyter debugger service");return this.jupyterDebugService.onBreakpointHit}startRunByLine(e){if(this.lastStartedService=this.jupyterDebugService,!this.jupyterDebugService)throw new Error("No jupyter debugger service");return this.jupyterDebugService.startRunByLine(e)}registerDebugConfigurationProvider(e,t){let n=this.vscodeDebugService.registerDebugConfigurationProvider(e,t);if(this.jupyterDebugService){let i=this.jupyterDebugService.registerDebugConfigurationProvider(e,t);return this.combineDisposables(n,i)}return n}registerDebugAdapterTrackerFactory(e,t){let n=this.vscodeDebugService.registerDebugAdapterTrackerFactory(e,t);if(this.jupyterDebugService){let i=this.jupyterDebugService.registerDebugAdapterTrackerFactory(e,t);return this.combineDisposables(n,i)}return n}startDebugging(e,t,n){return this.lastStartedService=this.vscodeDebugService,this.vscodeDebugService.startDebugging(e,t,n)}addBreakpoints(e){return this.activeService.addBreakpoints(e)}removeBreakpoints(e){return this.activeService.removeBreakpoints(e)}getStack(){if(!this.jupyterDebugService)throw new Error("No jupyter debugger service");if(this.lastStartedService===this.jupyterDebugService)return this.jupyterDebugService.getStack();throw new Error("Requesting jupyter specific stack when not debugging.")}step(){if(!this.jupyterDebugService)throw new Error("No jupyter debugger service");if(this.lastStartedService===this.jupyterDebugService)return this.jupyterDebugService.step();throw new Error("Requesting jupyter specific step when not debugging.")}continue(){if(!this.jupyterDebugService)throw new Error("No jupyter debugger service");if(this.lastStartedService===this.jupyterDebugService)return this.jupyterDebugService.continue();throw new Error("Requesting jupyter specific step when not debugging.")}requestVariables(){if(!this.jupyterDebugService)throw new Error("No jupyter debugger service");if(this.lastStartedService===this.jupyterDebugService)return this.jupyterDebugService.requestVariables();throw new Error("Requesting jupyter specific variables when not debugging.")}stop(){this.jupyterDebugService&&this.lastStartedService===this.jupyterDebugService?this.jupyterDebugService.stop():this.commandManager.executeCommand("workbench.action.debug.stop").then(m,m)}get activeService(){return this.lastStartedService?this.lastStartedService:this.vscodeDebugService}combineDisposables(e,t){return{dispose:()=>{e.dispose(),t.dispose()}}}endedDebugSession(e){this.sessionTerminatedEvent.fire(e),this.lastStartedService=void 0}startedDebugSession(e){this.sessionStartedEvent.fire(e)}changedDebugSession(e){this.sessionChangedEvent.fire(e)}gotCustomEvent(e){this.sessionCustomEvent.fire(e)}};gb=g([(0,Ha.injectable)(),p(0,(0,Ha.inject)(O)),p(1,(0,Ha.inject)(Fe)),p(2,(0,Ha.inject)(Ui)),p(3,(0,Ha.optional)()),p(3,(0,Ha.inject)($a)),p(3,(0,Ha.named)(Le.RUN_BY_LINE_DEBUGSERVICE))],gb);var gc=k(A());var s0=require("vscode");var vb=Symbol("IFileConverter"),us=Symbol("INbConvertExport"),Sd=Symbol("IExportBase"),yb=Symbol("IExport"),Hi=Symbol("IExportDialog");var bb=k(A()),aG=k(require("os"));var lG=k(po());var $C=k(A()),i0=require("vscode");var Ga=class{constructor(e,t){this.extensions=e;this.filePicker=t}async getContent(e){let t=this.extensions.getExtension("vscode.ipynb");if(!t)throw new Error("Unable to export notebook as the built-in vscode.ipynb extension is currently unavailable.");t.isActive||await t.activate();let i=e.getCells().map(s=>{let a=new i0.NotebookCellData(s.kind,s.document.getText(),s.document.languageId);return a.metadata=s.metadata,a.mime=s.mime,a.outputs=[...s.outputs],a}),o=new i0.NotebookData(i);return o.metadata=e.metadata,t.exports.exportNotebook(o)}async getTargetFile(e,t,n){return await this.filePicker.showDialog(e,t,n)}};Ga=g([(0,$C.injectable)(),p(0,(0,$C.inject)(rr)),p(1,(0,$C.inject)(Hi))],Ga);var o0=require("vscode");var za=class extends Ga{constructor(t,n,i){super(n,i);this.fs=t}async generateTempDir(){let t=o0.Uri.file(Ue(aG.tmpdir(),(0,lG.default)()));return await this.fs.createDirectory(t),{path:we(t),dispose:async()=>{let n=0;for(;n<10;)try{await this.fs.delete(t),n=10}catch{await Vn(3e3),n+=1}}}}async getTargetFile(t,n,i){let o;return t!=="python"?o=await this.filePicker.showDialog(t,n,i):o=o0.Uri.file((await this.fs.createTemporaryLocalFile(".py")).filePath),o}async makeFileInDirectory(t,n,i){let o=Ue(i,n);return await this.fs.writeFile(o0.Uri.file(o),t),o}async removeSvgs(t){let n=JSON.parse(t);for(let i of n.cells){let o="outputs"in i?i.outputs:void 0;o&&Array.isArray(o)&&this.removeSvgFromOutputs(o)}return JSON.stringify(n,void 0,4)}removeSvgFromOutputs(t){let n="image/svg+xml",i="image/png";for(let o of t)if("data"in o){let s=o.data;if(!(n in s))continue;i in s&&delete s[n]}}};za=g([(0,bb.injectable)(),p(0,(0,bb.inject)(Or)),p(1,(0,bb.inject)(rr)),p(2,(0,bb.inject)(Hi))],za);var Ib=k(A());var Pu=class{constructor(e,t,n){this.dependencyManager=e;this.nbConvertDependencyChecker=t;this.jupyterInterpreterService=n}async getExportInterpreter(e){if(e&&await this.checkNotebookInterpreter(e))return e;let t=await this.jupyterInterpreterService.getSelectedInterpreter();if(t||await this.jupyterInterpreterService.selectInterpreter(),t){if(await this.checkNotebookInterpreter(t))return t;if(await this.dependencyManager.installMissingDependencies(),await this.checkNotebookInterpreter(t))return t}throw new Error(y.jupyterNbConvertNotSupported)}async checkNotebookInterpreter(e){return this.nbConvertDependencyChecker.isNbConvertInstalled(e)}};Pu=g([(0,Ib.injectable)(),p(0,(0,Ib.inject)(np)),p(1,(0,Ib.inject)(kh)),p(2,(0,Ib.inject)(Ei))],Pu);var xd=class{constructor(e,t,n,i,o,s,a){this.pythonExecutionFactory=e;this.jupyterService=t;this.fs=n;this.filePicker=i;this.exportUtil=o;this.importer=s;this.exportInterpreterFinder=a}async export(e,t,n,i){}async executeCommand(e,t,n,i,o){if(o.isCancellationRequested)return;if(i=await this.exportInterpreterFinder.getExportInterpreter(i),n==="python"){let h=await this.importer.importFromFile(e.uri,i);await this.fs.writeFile(t,h);return}let s=await this.exportUtil.getContent(e);n==="pdf"&&(s=await this.exportUtil.removeSvgs(s));let a=await this.exportUtil.generateTempDir(),l=await this.makeSourceFile(t,s,a),c=await this.getExecutionService(l,i);if(!c||o.isCancellationRequested)return;let u=await this.fs.createTemporaryLocalFile(Zi(t.fsPath)),d=[l.fsPath,"--to",n,"--output",Te(u.filePath),"--output-dir",pt(u.filePath),"--debug"],f=await c.execModule("jupyter",["nbconvert"].concat(d),{throwOnStdErr:!1,encoding:"utf8",token:o});if(o.isCancellationRequested){u.dispose();return}try{if((await this.fs.stat(s0.Uri.file(u.filePath))).size>1)await this.fs.copy(s0.Uri.file(u.filePath),t);else throw new Error("File size is zero during conversion. Outputting error.")}catch{throw new Error(f.stderr)}finally{u.dispose()}}async makeSourceFile(e,t,n){let i=Te(e.fsPath,Zi(e.fsPath)),o=await this.exportUtil.makeFileInDirectory(t,`${i}.ipynb`,n.path);return s0.Uri.file(o)}async getExecutionService(e,t){return this.pythonExecutionFactory.createActivatedEnvironment({resource:e,interpreter:t})}};g([gv("PerformingExport")],xd.prototype,"executeCommand",1),xd=g([(0,gc.injectable)(),p(0,(0,gc.inject)(Hr)),p(1,(0,gc.inject)($p)),p(2,(0,gc.inject)(Or)),p(3,(0,gc.inject)(Hi)),p(4,(0,gc.inject)(za)),p(5,(0,gc.inject)(Tw)),p(6,(0,gc.inject)(Pu))],xd);var xb=k(A());var VF=require("vscode");var mve={PDF:["pdf"]},fve={HTML:["html","htm"]},hve={Python:["py"]},Sb=class{constructor(e,t,n){this.applicationShell=e;this.workspaceService=t;this.isWebExtension=n}async showDialog(e,t,n){let i={},o;switch(e){case"python":i=hve,o=".py";break;case"pdf":o=".pdf",i=mve;break;case"html":o=".html",i=fve;break;case"ipynb":o=".ipynb";let l=y.exportDialogFilter;i[l]=["ipynb"];break;default:return}let s=n||!t?n||"":`${Te(t.path,Zi(t.path))}${o}`,a={defaultUri:await this.getDefaultUri(t,s),saveLabel:y.exportButtonTitle,filters:i};return this.applicationShell.showSaveDialog(a)}async getDefaultUri(e,t){if(e&&e.scheme==="untitled"&&this.isWebExtension)return;if(!e||e.scheme==="file"||e.scheme==="untitled"||e.scheme==="vscode-interactive")return VF.Uri.file(Ue(await this.workspaceService.computeWorkingDirectory(e),t));let n=Ue(pt(e.path),t);return VF.Uri.parse(`${e.scheme}://${n}`).with({authority:e.authority})}};Sb=g([(0,xb.injectable)(),p(0,(0,xb.inject)(ue)),p(1,(0,xb.inject)(ce)),p(2,(0,xb.inject)(on))],Sb);var Cf=k(A()),cG=require("vscode");var Qa=class{constructor(e,t,n,i){this.documentManager=e;this.fs=t;this.applicationShell=n;this.browserService=i}async openFile(e,t,n=!1){if(e==="python")await this.openPythonFile(t,n),R("DATASCIENCE.EXPORT_NOTEBOOK_AS",void 0,{format:e,successful:!0,opened:!0});else{let i=await this.askOpenFile(t,n);R("DATASCIENCE.EXPORT_NOTEBOOK_AS",void 0,{format:e,successful:!0,opened:i})}}async openPythonFile(e,t){let n;if(t)n=await this.documentManager.showTextDocument(e);else{let i=await this.fs.readFile(e);await this.fs.delete(e);let o=await this.documentManager.openTextDocument({language:xe,content:i});n=await this.documentManager.showTextDocument(o)}await n.edit(i=>{i.insert(new cG.Position(n.document.lineCount,0),`
`)})}async askOpenFile(e,t){let n=y.openExportFileYes,i=y.openExportFileNo,o=[n,i];return await this.applicationShell.showInformationMessage(y.openExportedFileMessage,...o).then(a=>a)===n?(t?this.documentManager.showTextDocument(e).then(m,m):this.browserService.launch(e.toString()),!0):!1}};Qa=g([(0,Cf.injectable)(),p(0,(0,Cf.inject)(lr)),p(1,(0,Cf.inject)(Ze)),p(2,(0,Cf.inject)(ue)),p(3,(0,Cf.inject)(ks))],Qa);var a0=k(A());var Cb=class{constructor(e){this.exportBase=e}async export(e,t,n,i){await this.exportBase.executeCommand(e,t,"html",n,i)}};Cb=g([(0,a0.injectable)(),p(0,(0,a0.inject)(Sd))],Cb);var l0=k(A());var Eb=class{constructor(e){this.exportBase=e}async export(e,t,n,i){await this.exportBase.executeCommand(e,t,"pdf",n,i)}};Eb=g([(0,l0.injectable)(),p(0,(0,l0.inject)(Sd))],Eb);var c0=k(A());var wb=class{constructor(e){this.exportBase=e}async export(e,t,n,i){await this.exportBase.executeCommand(e,t,"python",n,i)}};wb=g([(0,c0.injectable)(),p(0,(0,c0.inject)(Sd))],wb);var Pb=k(A()),BF=require("vscode");var kb=class{constructor(e,t,n){this.fs=e;this.configuration=t;this.platform=n}async writeFile(e,t){await this.fs.writeFile(e,t)}getEOL(){return this.platform.isWindows?`\r
`:`
`}async export(e,t,n){if(n.isCancellationRequested)return;let i=this.exportDocument(e);await this.writeFile(t,i)}exportDocument(e){return e.getCells().filter(t=>!t.metadata.custom?.metadata?.isInteractiveWindowMessageCell).reduce((t,n)=>t+this.exportCell(n),"")}exportCell(e){if(e.document.lineCount){let t=this.cellMarker(e),n=this.getEOL();switch(e.kind){case BF.NotebookCellKind.Code:return`${t}${n}${this.exportCodeCell(e)}${n}${n}`;case BF.NotebookCellKind.Markup:return`${t} [markdown]${n}${this.exportMarkdownCell(e)}${n}${n}`}}return""}exportCodeCell(e){let t=je(e.document.getText(),{trim:!1,removeEmptyEntries:!1}),n=this.configuration.getSettings(e.notebook.uri).pythonExportMethod==="commentMagics";return Rl(t,this.getEOL(),n?gve:void 0).join("")}exportMarkdownCell(e){let t=je(e.document.getText(),{trim:!1,removeEmptyEntries:!1});return Rl(t,this.getEOL(),vve).join("")}cellMarker(e){let t=this.configuration.getSettings(e.notebook.uri);return e.metadata.interactiveWindowCellMarker??t.defaultCellMarker}};kb=g([(0,Pb.injectable)(),p(0,(0,Pb.inject)(Ze)),p(1,(0,Pb.inject)(se)),p(2,(0,Pb.inject)(Ir))],kb);function gve(r){return/^\s*!/.test(r)||/^\s*%/.test(r)?`# ${r}`:r}function vve(r){return`# ${r}`}var Qn=k(A());var di=k(A()),uG=require("vscode");var Db=class{constructor(e,t,n,i,o,s,a,l,c,u){this.exportToPythonPlain=e;this.exportToPDF=t;this.exportToHTML=n;this.exportToPython=i;this.filePicker=o;this.exportUtil=s;this.progressReporter=a;this.applicationShell=l;this.exportFileOpener=c;this.configuration=u}async importIpynb(e){let t=this.progressReporter.createProgressIndicator(y.importingIpynb,!0);try{let n=await uG.workspace.openNotebookDocument(e);await this.exportImpl("python",n,void 0,t.token)}finally{t.dispose()}}async export(e,t,n,i){let o=this.progressReporter.createProgressIndicator(y.exportingToFormat(e.toString()),!0);try{await this.exportImpl(e,t,n,o.token,i)}finally{o.dispose()}if(o.token.isCancellationRequested){R("DATASCIENCE.EXPORT_NOTEBOOK_AS",void 0,{format:e,cancelled:!0});return}}async exportImpl(e,t,n,i,o){try{let s=await this.exportUtil.getTargetFile(e,t.uri,n);if(!s)return;await this.performExport(e,t,s,i,o)}catch(s){C("Export failed",s),R("DATASCIENCE.EXPORT_NOTEBOOK_AS_FAILED",void 0,{format:e}),e==="pdf"&&C(y.exportToPDFDependencyMessage),this.showExportFailed(y.exportFailedGeneralMessage)}}async performExport(e,t,n,i,o){e==="python"&&this.configuration.getSettings(t.uri).pythonExportMethod!=="nbconvert"?await this.performPlainExport(e,t,n,i):await this.performNbConvertExport(t,e,n,o,i),n&&this.openExportedFile(e,n).catch(m)}async openExportedFile(e,t){await this.exportFileOpener.openFile(e,t,!0).catch(m)}async performPlainExport(e,t,n,i){if(n)switch(e){case"python":await this.exportToPythonPlain.export(t,n,i);break}return n}async performNbConvertExport(e,t,n,i,o){try{return await this.exportToFormat(e,n,t,i,o)}finally{}}async exportToFormat(e,t,n,i,o){switch(n){case"python":return await this.exportToPython.export(e,t,i,o);case"pdf":return await this.exportToPDF.export(e,t,i,o);case"html":return await this.exportToHTML.export(e,t,i,o);default:break}}showExportFailed(e){this.applicationShell.showErrorMessage(`${y.failedExportMessage} ${e}`).then}};Db=g([(0,di.injectable)(),p(0,(0,di.inject)(yb)),p(0,(0,di.named)("python")),p(1,(0,di.inject)(us)),p(1,(0,di.named)("pdf")),p(2,(0,di.inject)(us)),p(2,(0,di.named)("html")),p(3,(0,di.inject)(us)),p(3,(0,di.named)("python")),p(4,(0,di.inject)(Hi)),p(5,(0,di.inject)(Ga)),p(6,(0,di.inject)(es)),p(7,(0,di.inject)(ue)),p(8,(0,di.inject)(Qa)),p(9,(0,di.inject)(se))],Db);var Tb=class extends Db{constructor(t,n,i,o,s,a,l,c,u,d,f){super(o,t,n,i,l,s,c,u,d,f);this.exportUtil=s;this.fs=a}async openExportedFile(t,n){await this.exportFileOpener.openFile(t,n).catch(m)}};Tb=g([(0,Qn.injectable)(),p(0,(0,Qn.inject)(us)),p(0,(0,Qn.named)("pdf")),p(1,(0,Qn.inject)(us)),p(1,(0,Qn.named)("html")),p(2,(0,Qn.inject)(us)),p(2,(0,Qn.named)("python")),p(3,(0,Qn.inject)(yb)),p(3,(0,Qn.named)("python")),p(4,(0,Qn.inject)(za)),p(5,(0,Qn.inject)(Or)),p(6,(0,Qn.inject)(Hi)),p(7,(0,Qn.inject)(es)),p(8,(0,Qn.inject)(ue)),p(9,(0,Qn.inject)(Qa)),p(10,(0,Qn.inject)(se))],Tb);var Ef=k(A());var u0=require("vscode");var _b=class{constructor(e,t,n,i){this.configService=e;this.fs=t;this.workspace=n;this.registry=i;this.priority=0}activate(){this.registry.register(this,Ct)}async getCode(e){let t=await this.getWorkingDirectory(e);return t?je(rl(da.UpdateCWDAndPath,we(t)),{trim:!1}):[]}async getWorkingDirectory(e){if(!mt(e.kernelConnectionMetadata)&&!bk(e.kernelConnectionMetadata)||!Vt(e.kernelConnectionMetadata))return;let t=await this.calculateWorkingDirectory(e.resourceUri);if(t&&await this.fs.exists(t))return t;if(e.resourceUri&&e.resourceUri.scheme!=="untitled"&&await this.fs.exists(e.resourceUri)&&(t=u0.Uri.file(Uh(we(t),e.resourceUri,this.workspace,this.configService.getSettings(e.resourceUri))),t&&await this.fs.exists(t)))return t}async calculateWorkingDirectory(e){let t,n=this.configService.getSettings(e),i=NP(n.notebookFileRoot);if(i&&this.workspace.hasWorkspaceFolders){let o=u0.Uri.file(i),s=this.workspace.workspaceFolders[0].uri;if(mh(i))await this.fs.exists(o)?t=o:t=s;else if(i.includes("${"))t=o;else{let a=u0.Uri.joinPath(s,i);await this.fs.exists(a)?t=a:t=s}}return t}};_b=g([(0,Ef.injectable)(),p(0,(0,Ef.inject)(se)),p(1,(0,Ef.inject)(Ze)),p(2,(0,Ef.inject)(ce)),p(3,(0,Ef.inject)(xa))],_b);var Nb=k(A()),GC=require("vscode");var HC=require("vscode");var qF=new WeakMap;async function ra(r,e){let t=r;if(r.isClosed)return!0;let n=qF.has(t)?qF.get(t):Promise.resolve(),i=pe(),o=n.finally(async()=>{let s=new HC.WorkspaceEdit,a=e(s);$d(a)&&await a,await HC.workspace.applyEdit(s).then(l=>i.resolve(l),l=>i.reject(l))}).catch(m);return qF.set(t,o),i.promise}var Rb=class{constructor(e,t,n){this.notebook=e;this.disposables=t;this.controllerRegistration=n}activate(){this.controllerRegistration.onControllerSelected(this.onDidChangeNotebookController,this,this.disposables)}async onDidChangeNotebookController(e){let t=e.notebook,n=e.controller.connection;if(!Dt(t))return;let i=this.notebook.notebookEditors.find(u=>u.notebook===t);if(!i)return;let o=t.getCells().filter(u=>u.kind===GC.NotebookCellKind.Code&&u.document.getText().trim().length===0),s=t.getCells().filter(u=>u.kind===GC.NotebookCellKind.Code).length;if(o.length===0||o.length!==s)return;let a,l=n.kind;switch(n.kind){case"connectToLiveRemoteKernel":{a=n.kernelModel.language;break}case"startUsingRemoteKernelSpec":case"startUsingLocalKernelSpec":{a=n.kernelSpec.language;break}case"startUsingPythonInterpreter":{a=xe;break}default:{C(`Unsupported kernel kind encountered ${l}`);return}}if(!a)return;let c=Ts(a);ra(i.notebook,async()=>{await o.map(async u=>{if(c.toLowerCase()!==u.document.languageId)return GC.languages.setTextDocumentLanguage(u.document,c).then(m,m)})}).then(m,m)}};Rb=g([(0,Nb.injectable)(),p(0,(0,Nb.inject)(qe)),p(1,(0,Nb.inject)(O)),p(2,(0,Nb.inject)(xt))],Rb);var Fo=k(A()),go=require("vscode");var Ab=class{constructor(e,t,n,i,o,s,a,l,c,u,d){this.disposableRegistry=e;this.notebooks=t;this.commandManager=n;this.languageService=i;this.applicationShell=o;this.configurationService=s;this.kernelProvider=a;this.controllerRegistration=l;this.errorHandler=c;this.notebookEditorProvider=u;this.serviceContainer=d;this.kernelInterruptedDontAskToRestart=!1;this.pendingRestartInterrupt=new WeakMap}register(e){this.disposableRegistry.push(e.registerCommand(V.NotebookEditorRemoveAllCells,()=>this.removeAllCells())),this.disposableRegistry.push(e.registerCommand(V.NotebookEditorRunAllCells,()=>this.runAllCells())),this.disposableRegistry.push(e.registerCommand(V.NotebookEditorAddCellBelow,()=>this.addCellBelow())),this.disposableRegistry.push(this.commandManager.registerCommand(V.NotebookEditorCollapseAllCells,()=>this.collapseAll())),this.disposableRegistry.push(this.commandManager.registerCommand(V.NotebookEditorExpandAllCells,()=>this.expandAll())),this.disposableRegistry.push(this.commandManager.registerCommand(V.RestartKernelAndRunUpToSelectedCell,()=>this.restartKernelAndRunUpToSelectedCell())),this.disposableRegistry.push(e.registerCommand(V.RestartKernel,t=>t&&"notebookEditor"in t?this.restartKernel(t?.notebookEditor?.notebookUri).catch(m):this.restartKernel(t).catch(m))),this.disposableRegistry.push(e.registerCommand(V.InterruptKernel,t=>this.interruptKernel(t?.notebookEditor?.notebookUri))),this.disposableRegistry.push(e.registerCommand(V.RestartKernelAndRunAllCells,t=>{t&&"notebookEditor"in t?this.restartKernelAndRunAllCells(t?.notebookEditor?.notebookUri).catch(m):this.restartKernelAndRunAllCells(t).catch(m)}))}runAllCells(){this.notebooks.activeNotebookEditor&&this.commandManager.executeCommand("notebook.execute").then(m,m)}addCellBelow(){this.notebooks.activeNotebookEditor&&this.commandManager.executeCommand("notebook.cell.insertCodeCellBelow").then(m,m)}removeAllCells(){let e=this.notebooks.activeNotebookEditor?.notebook;if(!e)return;let t=this.languageService.getPreferredLanguage(wo(e));ra(e,n=>{let i=go.NotebookEdit.replaceCells(new go.NotebookRange(0,e.cellCount),[new go.NotebookCellData(go.NotebookCellKind.Code,"",t)]);n.set(e.uri,[i])}).then(m,m)}collapseAll(){let e=this.notebooks.activeNotebookEditor?.notebook;e&&ra(e,t=>{e.getCells().forEach((n,i)=>{let o={...n.metadata||{},inputCollapsed:!0,outputCollapsed:!0};t.set(e.uri,[go.NotebookEdit.updateCellMetadata(i,o)])})}).then(m,m)}expandAll(){let e=this.notebooks.activeNotebookEditor?.notebook;e&&ra(e,t=>{e.getCells().forEach((n,i)=>{let o={...n.metadata||{},inputCollapsed:!1,outputCollapsed:!0};t.set(e.uri,[go.NotebookEdit.updateCellMetadata(i,o)])})}).then(m,m)}async interruptKernel(e){let t=e??this.notebookEditorProvider.activeNotebookEditor?.notebook.uri,n=go.workspace.notebookDocuments.find(o=>o.uri.toString()===t?.toString());if(n===void 0)return;w(`Command interrupted kernel for ${W(n.uri)}`);let i=this.kernelProvider.get(n);if(!i){H("Interrupt requested & no kernel.");return}await this.wrapKernelMethod("interrupt",i)}async restartKernelAndRunAllCells(e){await this.restartKernel(e),this.runAllCells()}async restartKernelAndRunUpToSelectedCell(){let e=this.notebookEditorProvider.activeNotebookEditor;e&&(await this.restartKernel(e.notebook.uri),this.commandManager.executeCommand("notebook.cell.execute",{ranges:[{start:0,end:e.selection.end}],document:e.notebook.uri}).then(m,m))}async restartKernel(e){let t=e??this.notebookEditorProvider.activeNotebookEditor?.notebook.uri,n=go.workspace.notebookDocuments.find(o=>o.uri.toString()===t?.toString());if(n===void 0)return;let i=this.kernelProvider.get(n);if(i)if(w(`Restart kernel command handler for ${W(n.uri)}`),await this.shouldAskForRestart(n.uri)){let o=y.restartKernelMessage,s=y.restartKernelMessageYes,a=y.restartKernelMessageDontAskAgain,l=await this.applicationShell.showInformationMessage(o,{modal:!0},s,a);l===a?(await this.disableAskForRestart(n.uri),this.wrapKernelMethod("restart",i).catch(m)):l===s&&this.wrapKernelMethod("restart",i).catch(m)}else this.wrapKernelMethod("restart",i).catch(m)}async wrapKernelMethod(e,t){let n=t.notebook,i=this.pendingRestartInterrupt.get(t);if(i)return i;let o=(async()=>{let s=this.kernelProvider.getKernelExecution(t).pendingCells[0],a=this.controllerRegistration.getSelected(n);try{if(!a)throw new Error("No kernel associated with the notebook");await Ys.wrapKernelMethod(a.connection,e,t.creator,this.serviceContainer,{resource:t.resourceUri,notebook:n,controller:a.controller},new er(!1),this.disposableRegistry)}catch(l){s?await fp(s,t.controller,await this.errorHandler.getErrorMessageForDisplayInCell(l,e,t.resourceUri),!1):this.applicationShell.showErrorMessage(l.toString()).then(m,m)}})();return o.finally(()=>{this.pendingRestartInterrupt.get(t)===o&&this.pendingRestartInterrupt.delete(t)}).catch(m),this.pendingRestartInterrupt.set(t,o),o}async shouldAskForRestart(e){if(this.kernelInterruptedDontAskToRestart)return!1;let t=this.configurationService.getSettings(e);return t&&t.askForKernelRestart===!0}async disableAskForRestart(e){this.configurationService.getSettings(e)&&this.configurationService.updateSetting("askForKernelRestart",!1,void 0,go.ConfigurationTarget.Global).catch(m)}};Ab=g([(0,Fo.injectable)(),p(0,(0,Fo.inject)(O)),p(1,(0,Fo.inject)(qe)),p(2,(0,Fo.inject)(Fe)),p(3,(0,Fo.inject)(cs)),p(4,(0,Fo.inject)(ue)),p(5,(0,Fo.inject)(se)),p(6,(0,Fo.inject)(Ke)),p(7,(0,Fo.inject)(xt)),p(8,(0,Fo.inject)(an)),p(9,(0,Fo.inject)(Tn)),p(10,(0,Fo.inject)(ct))],Ab);var p0=k(A()),JF=require("vscode");var Mb=class{constructor(e){this.vscodeNotebook=e;this.providers=new Set}registerEmbedNotebookProvider(e){this.providers.add(e)}findNotebookEditor(e){let t=e?ar(e,!0):"false",n=io(e)==="notebook"?this.vscodeNotebook.notebookDocuments.find(o=>ar(o.uri,!0)===t):void 0,i=n&&this.vscodeNotebook.activeNotebookEditor?.notebook===n?this.vscodeNotebook.activeNotebookEditor:void 0;if(i)return i;for(let o of this.providers){let s=o.findNotebookEditor(e);if(s)return s}}get activeNotebookEditor(){return this.findNotebookEditor(JF.window.activeNotebookEditor?.notebook.uri)||this.findNotebookEditor(JF.window.activeTextEditor?.document.uri)}findAssociatedNotebookDocument(e){let t=en()==="Windows",n=this.vscodeNotebook.notebookDocuments.find(i=>t?i.uri.path.toLowerCase()===e.path.toLowerCase():i.uri.path===e.path);if(n)return n;for(let i of this.providers){let o=i.findAssociatedNotebookDocument(e);if(o)return o}}};Mb=g([(0,p0.injectable)(),p(0,(0,p0.inject)(qe))],Mb);var Kb=k(A()),dG=require("vscode");var Ob=class{constructor(e,t,n){this.vscNotebook=e;this.workspace=n;this.sentMimeTypes=new Set;this.disposables=[];t.push(this)}get isTelemetryDisabled(){return Bw(this.workspace)}activate(){this.vscNotebook.onDidOpenNotebookDocument(this.onDidOpenCloseDocument,this,this.disposables),this.vscNotebook.onDidCloseNotebookDocument(this.onDidOpenCloseDocument,this,this.disposables),this.vscNotebook.onDidSaveNotebookDocument(this.onDidOpenCloseDocument,this,this.disposables),this.vscNotebook.onDidChangeNotebookCellExecutionState(this.onDidChangeNotebookCellExecutionState,this,this.disposables)}dispose(){G(this.disposables)}async onDidChangeNotebookCellExecutionState(e){!Dt(e.cell.notebook)||this.isTelemetryDisabled||this.checkCell(e.cell,"onExecution")}onDidOpenCloseDocument(e){!Dt(e)||this.isTelemetryDisabled||e.getCells().forEach(t=>this.checkCell(t,"onOpenCloseOrSave"))}checkCell(e,t){if(e.kind===dG.NotebookCellKind.Markup||e.document.languageId==="raw")return;let n=e.notebook.notebookType===Ct?"notebook":"interactive";e.outputs.map(i=>i.items.map(o=>o.mime)).flat().map(i=>this.sendTelemetry(i,t,n))}sendTelemetry(e,t,n){let i=`${e}-${t}`;this.sentMimeTypes.has(i)||(this.sentMimeTypes.add(i),e=e.replace(/\//g,"_").replace(/\\/g,"_"),R("DS_INTERNAL.CELL_OUTPUT_MIME_TYPE",void 0,{mimeType:e,when:t,resourceType:n}))}};Ob=g([(0,Kb.injectable)(),p(0,(0,Kb.inject)(qe)),p(1,(0,Kb.inject)(O)),p(2,(0,Kb.inject)(ce))],Ob);var d0=k(A());var yve=/(;32m[ ->]*?)(\d+)(.*)/g,Fb=class{constructor(e){this.configurationService=e}format(e,t){return e.notebook.notebookType!==Ct?t:t.map(n=>this.modifyTracebackFrameIPython(e,n))}modifyTracebackFrameIPython(e,t){return(this.configurationService.getSettings(e.document.uri)?.formatStackTraces??!0)&&/^[Cell|Input|File].*?\n.*/.test(t)?this.modifyTracebackFrameIPython8(e,t):t}modifyTracebackFrameIPython8(e,t){t=t.replace(/\u001b\[4\dm/g,""),t=t.replace(/\u001b\[38;.*?\d+m/g,"\x1B[39m"),t=t.replace(/(;32m[ ->]*?)(\d+)(.*)\n/g,(s,a,l,c)=>(c=c.replace(/\u001b\[3\d+m/g,"\x1B[39m"),`${a}${l}${c}
`)),te(`Trace frame to match: ${t}`);let n=(s,a)=>{let l=s.replace(yve,(u,d,f,h)=>{let v=parseInt(f,10);return`${d}<a href='${e.document.uri.toString()}?line=${v-1}'>${v}</a>${h}`}),c=y.cellAtFormat(we(e.document.uri),e.index+1);return l.replace(/.*?\n/,`\x1B[1;32m${c}\x1B[0m line \x1B[0;36m${a}
`)},i=/^Input.*?\[.*32mIn\s+\[(\d+).*?0;36m(.*?)\n.*/.exec(t);if(i&&i.length>1)return n(t,i[2]);let o=/Cell.*?\[.*32mIn\s*\[(\d+)\]\,\s+line\s+([(\d+)])(.*?)\n.*/gm.exec(t);return o&&o.length>1?n(t,o[2]):t}};Fb=g([(0,d0.injectable)(),p(0,(0,d0.inject)(se))],Fb);var Lo=k(A());var Lb=class{constructor(e,t,n,i,o,s,a,l,c){this.packages=e;this.installer=t;this.extensions=n;this.pythonExtensionChecker=i;this.disposables=o;this.interpreterService=s;this.apiProvider=a;this.notebookControllerManager=l;this.webExtension=c}activate(){this.notebookControllerManager.onControllerSelected(this.onNotebookControllerSelected,this,this.disposables),this.webExtension||this.interpreterService.onDidChangeInterpreter(this.trackPackagesOfActiveInterpreter,this,this.disposables),this.installer?.onInstalled(this.onDidInstallPackage,this,this.disposables),this.extensions.onDidChange(this.trackUponActivation,this,this.disposables),this.trackUponActivation().catch(m),this.apiProvider.onDidActivatePythonExtension(this.trackUponActivation,this,this.disposables)}async onNotebookControllerSelected(e){e.controller.connection.interpreter&&(await uo(e.notebook.uri,{kernelConnection:e.controller.connection}),await this.packages.trackPackages(e.controller.connection.interpreter))}async trackUponActivation(){this.activeInterpreterTrackedUponActivation||this.pythonExtensionChecker.isPythonExtensionActive&&(this.activeInterpreterTrackedUponActivation=!0,await this.trackPackagesOfActiveInterpreter())}async trackPackagesOfActiveInterpreter(){if(!this.pythonExtensionChecker.isPythonExtensionActive)return;let e=await this.interpreterService.getActiveInterpreter(void 0);e&&await this.packages.trackPackages(e)}async onDidInstallPackage(e){if(this.pythonExtensionChecker.isPythonExtensionActive)if(Bu(e.resource)){let t=await this.interpreterService.getActiveInterpreter(e.resource);await this.packages.trackPackages(t,!0)}else await this.packages.trackPackages(e.resource,!0)}};Lb=g([(0,Lo.injectable)(),p(0,(0,Lo.inject)(Lp)),p(1,(0,Lo.inject)(qi)),p(1,(0,Lo.optional)()),p(2,(0,Lo.inject)(rr)),p(3,(0,Lo.inject)(ze)),p(4,(0,Lo.inject)(O)),p(5,(0,Lo.inject)(it)),p(6,(0,Lo.inject)(Xt)),p(7,(0,Lo.inject)(xt)),p(8,(0,Lo.inject)(on))],Lb);function mG(r,e){G4(r,e),r.addSingleton(Ie,pf),r.addSingleton(Th,Ab),r.addSingleton(Tn,Mb),r.addBinding(Hy,Ie),r.addSingleton(Ie,mf),r.addSingleton(tg,Fb),r.addSingleton($a,hb,Le.RUN_BY_LINE_DEBUGSERVICE),r.addSingleton(md,md),r.addBinding(md,Ie),r.addSingleton(Ie,Jy),r.addSingleton(Ie,Lb),r.addSingleton(Ie,Vy),r.addSingleton(cs,cs),r.addBinding(cs,Ie),r.addSingleton(Ie,Rb),r.addSingleton(Id,mb,void 0,[Ie]),r.addSingleton(Ie,ab),r.addSingleton(pi,cb,Le.DEBUGGER_VARIABLES),r.addSingleton($a,gb,Le.MULTIPLEXING_DEBUGSERVICE),r.addSingleton($_,fb,void 0,[J_]),r.addSingleton(Ie,sb),r.addSingleton(Ie,Ob),r.addSingleton(Ie,_b),r.addSingleton(vb,Tb),r.addSingleton(Pu,Pu),r.addSingleton(Qa,Qa),r.addSingleton(Sd,xd),r.addSingleton(us,Eb,"pdf"),r.addSingleton(us,Cb,"html"),r.addSingleton(us,wb,"python"),r.addSingleton(us,xd,"Export Base"),r.addSingleton(yb,kb,"python"),r.addSingleton(Ga,Ga),r.addSingleton(za,za),r.addSingleton(Hi,Sb)}var Nr=k(A()),gr=require("vscode");var Cd=Symbol("IDataScienceCodeLensProvider"),m0=Symbol("ICodeWatcher"),f0=Symbol("ICodeLensFactory"),bwt=Symbol("IGeneratedCodeStore"),na=Symbol("IGeneratedCodeStorageFactory"),Ub=Symbol("ICodeGeneratorFactory");var h0=Symbol("IInteractiveWindowDebugger"),Gi=Symbol("IInteractiveWindowProvider"),g0=Symbol("IInteractiveControllerHelper"),v0=Symbol("IInteractiveWindowDebuggingManager");var y0=require("vscode");async function b0(r){let e=await y0.workspace.openNotebookDocument(r);await y0.window.showNotebookDocument(e)}var QC=require("vscode");var Ti=class{constructor(e){this.codeMatchRegEx=this.createRegExp(e?e.codeRegularExpression:void 0,qd.PythonCellMarker),this.markdownMatchRegEx=this.createRegExp(e?e.markdownRegularExpression:void 0,qd.PythonMarkdownCellMarker),this.codeExecRegEx=new RegExp(`${this.codeMatchRegEx.source}(.*)`),this.markdownExecRegEx=new RegExp(`${this.markdownMatchRegEx.source}(.*)`),this.defaultCellMarker=e?.defaultCellMarker?e.defaultCellMarker:"# %%"}isCell(e){return this.isCode(e)||this.isMarkdown(e)}isMarkdown(e){return this.markdownMatchRegEx.test(e.trim())}isCode(e){return this.codeMatchRegEx.test(e.trim())||e.trim()===this.defaultCellMarker}getCellType(e){return this.isMarkdown(e)?"markdown":"code"}isEmptyCell(e){return this.stripFirstMarker(e).trim().length===0}stripFirstMarker(e){let t=je(e,{trim:!1,removeEmptyEntries:!1});return t.length>0&&(this.isCode(t[0])||this.isMarkdown(t[0]))?t.slice(1).join(`
`):e}stripFirstMarkerNoConcat(e){return e.length>0&&(this.isCode(e[0])||this.isMarkdown(e[0]))?e.slice(1):e}getFirstMarker(e){let t=je(e,{trim:!1,removeEmptyEntries:!1});if(t.length>0&&(this.isCode(t[0])||this.isMarkdown(t[0])))return t[0]}createRegExp(e,t){try{if(e)return new RegExp(e)}catch{}return t}};var ps=require("vscode");function fG(r,e){let t=gt(r);return t?e==1?y.restartingKernelCustomHeader(t):y.startingNewKernelCustomHeader(t):e==1?y.restartingKernelHeader:y.startingNewKernelHeader}function hG(r,e){let t=gt(r);return e==1?y.restartedKernelHeader(t||""):y.connectedKernelHeader(t||"")}function zC(r){return r.kind===ps.NotebookCellKind.Markup&&r.metadata.custom?.metadata&&r.metadata.custom.metadata.isInteractiveWindowMessageCell}var I0=class{constructor(e,t){this.notebookDocument=e;this.isDeleted=!1;if(e.cellCount){let n=e.cellAt(e.cellCount);zC(n)&&(this.sysInfoCellPromise=Promise.resolve(n),this.sysInfoCellPromise=this.updateMessage(t))}this.sysInfoCellPromise===void 0&&(this.sysInfoCellPromise=this.createCell(t))}async createCell(e){let t;return await ra(this.notebookDocument,n=>{let i=new ps.NotebookCellData(ps.NotebookCellKind.Markup,e,PS);i.metadata={custom:{metadata:{isInteractiveWindowMessageCell:!0}}},t=this.notebookDocument.cellCount;let o=ps.NotebookEdit.insertCells(t,[i]);n.set(this.notebookDocument.uri,[o])}),t=t??this.notebookDocument.cellCount-1,this.notebookDocument.cellAt(t)}async updateMessage(e){let t=await this.sysInfoCellPromise;return await ra(this.notebookDocument,n=>{if(t.index>=0&&!this.isDeleted&&zC(t)){n.replace(t.document.uri,new ps.Range(0,0,t.document.lineCount,0),e),n.set(this.notebookDocument.uri,[ps.NotebookEdit.updateCellMetadata(t.index,{custom:{metadata:{isInteractiveWindowMessageCell:!0}}})]);return}}),t}async deleteCell(){this.isDeleted=!0;let e=await this.sysInfoCellPromise;await ra(this.notebookDocument,t=>{if(e.index>=0&&zC(e)){let n=ps.NotebookEdit.deleteCells(new ps.NotebookRange(e.index,e.index+1));t.set(this.notebookDocument.uri,[n]);return}})}};function Ive(r,e){let t=typeof e=="boolean"?e:!1,n=typeof e=="boolean"?[]:e||[];r=r||"";let i=Array.isArray(r)?Rl(r,`
`,t?Wb:void 0):r;return{cell_type:"code",execution_count:null,metadata:{},outputs:n,source:i}}function Sve(r,e=!1){return r=Array.isArray(r)?r:[r],{cell_type:"markdown",metadata:{},source:e?r:ck(r)}}function Wb(r){return/^#\s*!/.test(r)?/^#\s*!\s*%%?/.test(r)?r.replace(/^#\s*!\s*/,""):r.replace(/^#\s*/,""):r}function gG(r,e,t){return{data:Ive(r,t),uri:e}}function vG(r,e,t=!1){return{uri:e,data:Sve(r,t)}}function xve(r,e,t,n){let i=je(e,{trim:!1}),o=i[0],s=new Ti(r),{magicCommandsAsComments:a=!1}=r||{};if(s.isMarkdown(o)){let l=-1;return am(i,(c,u)=>void 0,(c,u)=>{c&&c.length>0&&l===-1&&(l=n?u:-1)}),l>=0?[vG(i.slice(0,l),t),gG(i.slice(l),t,a)]:[vG(i,t)]}else return[gG(i,t,a)]}function yG(r,e){let t=new Ti(e);for(let n=0;n<r.lineCount;n+=1){let i=r.lineAt(n);if(t.isCell(i.text))return!0}return!1}function YC(r,e){let t=new Ti(e),n=[];for(let i=0;i<r.lineCount;i+=1){let o=r.lineAt(i);if(t.isCell(o.text)){if(n.length>0){let s=n[n.length-1];s.range=new QC.Range(s.range.start,r.lineAt(i-1).range.end)}n.push({range:o.range,cell_type:t.getCellType(o.text)})}}if(n.length>=1){let i=r.lineAt(r.lineCount-1),o=n[n.length-1];o.range=new QC.Range(o.range.start,i.range.end)}return n}function $F(r,e){let t=YC(r,e);return Array.prototype.concat(...t.map(n=>{let i=r.getText(n.range);return xve(e,i,r.uri,!1)}))}function bG(r,e){return r.getCells().filter(t=>!zC(t)).map(t=>{let n=je(t.document.getText(),{trim:!1,removeEmptyEntries:!1});t.metadata.interactiveWindowCellMarker!==void 0&&n.unshift(t.metadata.interactiveWindowCellMarker+`
`);let i=xV(t);return i.source=t.kind===QC.NotebookCellKind.Code?Rl(n,`
`,e?Wb:void 0):Rl(n),{data:i,file:""}})}var HF=require("vscode");var GF=class{constructor(e,t,n){this.disposed=!1;this.dispose=()=>{this.disposed||(this.disposed=!0,this.timeout&&(clearTimeout(this.timeout),this.timeout=void 0),this.disposeCallback(),this.deferred.completed||this.deferred.resolve())};this.promise=()=>this.deferred.promise;this.reject=()=>{this.deferred.reject(),this.dispose()};this.deferred=pe(),this.disposeCallback=t,n&&(this.timeout=setTimeout(this.dispose,n))}},S0=class{constructor(e){this.applicationShell=e;this.statusCount=0;this.incrementCount=()=>{this.statusCount+=1};this.decrementCount=()=>{let e=this.statusCount-1;this.statusCount=Math.max(e,0)}}set(e,t,n){this.incrementCount();let i=new GF(e,()=>this.decrementCount(),t),o={location:n?HF.ProgressLocation.Notification:HF.ProgressLocation.Window,title:e,cancellable:n!==void 0};return this.applicationShell.withProgress(o,(s,a)=>(a&&n&&a.onCancellationRequested(()=>{n(),i.reject()}),i.promise())).then(m,m),i}async waitWithStatus(e,t,n,i){let o=this.set(t,n,i),s;try{s=await e()}finally{o.dispose()}return s}};var Uo=class{constructor(e,t,n,i,o,s,a,l,c,u,d,f,h,v,S,b,D,_,L,Z,Se){this.disposables=e;this.jupyterExporter=t;this.jupyterServerHelper=n;this.documentManager=i;this.applicationShell=o;this.fileSystem=s;this.configuration=a;this.dataScienceCodeLensProvider=l;this.commandManager=c;this.debugService=u;this.configService=d;this.appShell=f;this.workspace=h;this.interactiveWindowProvider=v;this.kernelProvider=S;this.dataScienceErrorHandler=b;this.ipynbProvider=D;this.fileConverter=_;this.exportDialog=L;this.clipboard=Z;this.notebook=Se;this.statusProvider=new S0(o),this.workspace.isTrusted||this.workspace.onDidGrantWorkspaceTrust(this.registerCommandsIfTrusted,this,this.disposables)}activate(){this.registerCommandsIfTrusted(),this.registerCommand(V.InsertCellBelowPosition,this.insertCellBelowPosition),this.registerCommand(V.InsertCellBelow,this.insertCellBelow),this.registerCommand(V.InsertCellAbove,this.insertCellAbove),this.registerCommand(V.DeleteCells,this.deleteCells),this.registerCommand(V.SelectCell,this.selectCell),this.registerCommand(V.SelectCellContents,this.selectCellContents),this.registerCommand(V.ExtendSelectionByCellAbove,this.extendSelectionByCellAbove),this.registerCommand(V.ExtendSelectionByCellBelow,this.extendSelectionByCellBelow),this.registerCommand(V.MoveCellsUp,this.moveCellsUp),this.registerCommand(V.MoveCellsDown,this.moveCellsDown),this.registerCommand(V.ChangeCellToMarkdown,this.changeCellToMarkdown),this.registerCommand(V.ChangeCellToCode,this.changeCellToCode),this.registerCommand(V.GotoNextCellInFile,this.gotoNextCellInFile),this.registerCommand(V.GotoPrevCellInFile,this.gotoPrevCellInFile),this.registerCommand(V.AddCellBelow,this.addCellBelow),this.registerCommand(V.CreateNewNotebook,this.createNewNotebook),this.registerCommand(V.LatestExtension,this.openPythonExtensionPage),this.registerCommand(V.EnableDebugLogging,this.enableDebugLogging),this.registerCommand(V.ResetLoggingLevel,this.resetLoggingLevel),this.registerCommand(V.EnableLoadingWidgetsFrom3rdPartySource,this.enableLoadingWidgetScriptsFromThirdParty),this.registerCommand(V.CreateNewInteractive,e=>this.createNewInteractiveWindow(e)),this.registerCommand(V.ImportNotebook,(e,t="commandpalette")=>this.listenForErrors(()=>e?this.importNotebookOnFile(e):this.importNotebook())),this.registerCommand(V.ImportNotebookFile,(e,t="commandpalette")=>this.listenForErrors(()=>e?this.importNotebookOnFile(e):this.importNotebook())),this.commandManager.registerCommand(V.ExportFileAsNotebook,(e,t="commandpalette")=>this.listenForErrors(()=>{if(e)return this.exportFile(e);{let n=this.documentManager.activeTextEditor;if(n&&n.document.languageId===xe)return this.exportFile(n.document.uri)}return Promise.resolve()})),this.registerCommand(V.ExportFileAndOutputAsNotebook,(e,t="commandpalette")=>this.listenForErrors(()=>{if(e)return this.exportFileAndOutput(e);{let n=this.documentManager.activeTextEditor;if(n&&n.document.languageId===xe)return this.exportFileAndOutput(n.document.uri)}return Promise.resolve()})),this.registerCommand(V.ExpandAllCells,async e=>this.expandAllCells(e?.notebookEditor?.notebookUri)),this.registerCommand(V.CollapseAllCells,async e=>this.collapseAllCells(e?.notebookEditor?.notebookUri)),this.registerCommand(V.ExportOutputAsNotebook,()=>this.exportCells()),this.registerCommand(V.InteractiveExportAsNotebook,e=>this.export(e?.notebookEditor?.notebookUri)),this.registerCommand(V.InteractiveExportAs,e=>this.exportAs(e?.notebookEditor?.notebookUri)),this.registerCommand(V.ScrollToCell,(e,t)=>this.scrollToCell(e,t)),this.registerCommand(V.InteractiveClearAll,this.clearAllCellsInInteractiveWindow),this.registerCommand(V.InteractiveGoToCode,this.goToCodeInInteractiveWindow),this.commandManager.registerCommand(V.InteractiveCopyCell,this.copyCellInInteractiveWindow)}dispose(){this.disposables.forEach(e=>e.dispose())}registerCommandsIfTrusted(){this.workspace.isTrusted&&(this.registerCommand(V.RunAllCells,this.runAllCells),this.registerCommand(V.RunCell,this.runCell),this.registerCommand(V.RunCurrentCell,this.runCurrentCell),this.registerCommand(V.RunCurrentCellAdvance,this.runCurrentCellAndAdvance),this.registerCommand(V.ExecSelectionInInteractiveWindow,e=>{this.runSelectionOrLine(e).catch(m)}),this.registerCommand(V.RunAllCellsAbove,this.runAllCellsAbove),this.registerCommand(V.RunCellAndAllBelow,this.runCellAndAllBelow),this.registerCommand(V.RunAllCellsAbovePalette,this.runAllCellsAboveFromCursor),this.registerCommand(V.RunCellAndAllBelowPalette,this.runCellAndAllBelowFromCursor),this.registerCommand(V.RunCurrentCellAndAddBelow,this.runCurrentCellAndAddBelow),this.registerCommand(V.DebugCell,this.debugCell),this.registerCommand(V.DebugStepOver,this.debugStepOver),this.registerCommand(V.DebugContinue,this.debugContinue),this.registerCommand(V.DebugStop,this.debugStop),this.registerCommand(V.DebugCurrentCellPalette,this.debugCurrentCellFromCursor),this.registerCommand(V.OpenVariableView,this.openVariableView),this.registerCommand(V.OpenOutlineView,this.openOutlineView),this.registerCommand(V.RunToLine,this.runToLine),this.registerCommand(V.RunFromLine,this.runFromLine),this.registerCommand(V.RunFileInInteractiveWindows,this.runFileInteractive),this.registerCommand(V.DebugFileInInteractiveWindows,this.debugFileInteractive))}registerCommand(e,t){let n=this.commandManager.registerCommand(e,t,this);this.disposables.push(n)}getCodeWatcher(e){if(e&&this.dataScienceCodeLensProvider){let t=this.documentManager.textDocuments.filter(n=>Mi(n.uri,e));if(t&&t.length===1)return this.dataScienceCodeLensProvider.getCodeWatcher(t[0]);if(t&&t.length>1)throw new Error(y.documentMismatch(we(e)))}}async enableDebugLogging(){this.configService.getSettings().logging.level!=="debug"&&(await this.configService.updateSetting("logging.level","debug",void 0,gr.ConfigurationTarget.Global),this.commandManager.executeCommand("jupyter.reloadVSCode",y.reloadRequired).then(m,m))}async resetLoggingLevel(){this.configService.getSettings().logging.level!=="error"&&(await this.configService.updateSetting("logging.level","error",void 0,gr.ConfigurationTarget.Global),this.commandManager.executeCommand("jupyter.reloadVSCode",y.reloadRequired).then(m,m))}async enableLoadingWidgetScriptsFromThirdParty(){this.configService.getSettings(void 0).widgetScriptSources.length>0||await this.configService.updateSetting("widgetScriptSources",["jsdelivr.com","unpkg.com"],void 0,gr.ConfigurationTarget.Global).catch(m)}async runAllCells(e){let t=this.getCodeWatcher(e);if(t||(t=this.getCurrentCodeWatcher()),t)return t.runAllCells()}async runFileInteractive(e){let t=this.getCodeWatcher(e);if(t||(t=this.getCurrentCodeWatcher()),t)return t.runFileInteractive()}async debugFileInteractive(e){let t=this.getCodeWatcher(e);if(t||(t=this.getCurrentCodeWatcher()),t)return t.debugFileInteractive()}async runCell(e,t,n,i,o){let s=this.getCodeWatcher(e);if(s)return s.runCell(new gr.Range(t,n,i,o))}async runAllCellsAbove(e,t,n){if(e){let i=this.getCodeWatcher(e);if(i)return i.runAllCellsAbove(t,n)}}async runCellAndAllBelow(e,t,n){if(e){let i=this.getCodeWatcher(e);if(i)return i.runCellAndAllBelow(t,n)}}async runToLine(){let e=this.getCurrentCodeWatcher(),t=this.documentManager.activeTextEditor;if(e&&t&&t.selection)return e.runToLine(t.selection.start.line)}async runFromLine(){let e=this.getCurrentCodeWatcher(),t=this.documentManager.activeTextEditor;if(e&&t&&t.selection)return e.runFromLine(t.selection.start.line)}async runCurrentCell(){let e=this.getCurrentCodeWatcher();if(e)return e.runCurrentCell()}async runCurrentCellAndAdvance(){let e=this.getCurrentCodeWatcher();if(e)return e.runCurrentCellAndAdvance()}async runSelectionOrLine(e){let t=this.getCurrentCodeWatcher();if(t)return t.runSelectionOrLine(this.documentManager.activeTextEditor,ti(e)?void 0:e)}async debugCell(e,t,n,i,o){if(e){let s=this.getCodeWatcher(e);if(s)return s.debugCell(new gr.Range(t,n,i,o))}}async debugStepOver(){this.debugService?.activeDebugSession&&this.commandManager.executeCommand("workbench.action.debug.stepOver").then(m,m)}async debugStop(e){if(this.debugService?.activeDebugSession&&this.interactiveWindowProvider){let t=this.interactiveWindowProvider.get(e);if(t&&t.notebookDocument){let n=this.kernelProvider.get(t.notebookDocument);n&&(w(`Interrupt kernel due to debug stop of IW ${e.toString()}`),await n.interrupt())}this.commandManager.executeCommand("workbench.action.debug.stop").then(m,m)}}async debugContinue(){this.debugService?.activeDebugSession&&this.commandManager.executeCommand("workbench.action.debug.continue").then(m,m)}async addCellBelow(){await this.getCurrentCodeWatcher()?.addEmptyCellToBottom()}async runCurrentCellAndAddBelow(){this.getCurrentCodeWatcher()?.runCurrentCellAndAddBelow()}async insertCellBelowPosition(){this.getCurrentCodeWatcher()?.insertCellBelowPosition()}async insertCellBelow(){this.getCurrentCodeWatcher()?.insertCellBelow()}async insertCellAbove(){this.getCurrentCodeWatcher()?.insertCellAbove()}async deleteCells(){this.getCurrentCodeWatcher()?.deleteCells()}async selectCell(){this.getCurrentCodeWatcher()?.selectCell()}async selectCellContents(){this.getCurrentCodeWatcher()?.selectCellContents()}async extendSelectionByCellAbove(){this.getCurrentCodeWatcher()?.extendSelectionByCellAbove()}async extendSelectionByCellBelow(){this.getCurrentCodeWatcher()?.extendSelectionByCellBelow()}async moveCellsUp(){this.getCurrentCodeWatcher()?.moveCellsUp()}async moveCellsDown(){this.getCurrentCodeWatcher()?.moveCellsDown()}async changeCellToMarkdown(){this.getCurrentCodeWatcher()?.changeCellToMarkdown()}async changeCellToCode(){this.getCurrentCodeWatcher()?.changeCellToCode()}async gotoNextCellInFile(){this.getCurrentCodeWatcher()?.gotoNextCell()}async gotoPrevCellInFile(){this.getCurrentCodeWatcher()?.gotoPreviousCell()}async runAllCellsAboveFromCursor(){let e=this.getCurrentCodeLens();if(e){let t=this.getCurrentCodeWatcher();if(t)return t.runAllCellsAbove(e.range.start.line,e.range.start.character)}else return}async runCellAndAllBelowFromCursor(){let e=this.getCurrentCodeLens();if(e){let t=this.getCurrentCodeWatcher();if(t)return t.runCellAndAllBelow(e.range.start.line,e.range.start.character)}else return}async debugCurrentCellFromCursor(){if(this.getCurrentCodeLens()){let t=this.getCurrentCodeWatcher();if(t)return t.debugCurrentCell()}else return}async createNewNotebook(){this.appShell.showInformationMessage('This command has been deprecated and will eventually be removed, please use ["Create: New Jupyter Notebook"](command:workbench.action.openGlobalKeybindings?%5B%22@command:ipynb.newUntitledIpynb%22%5D) instead.').then(m,m),await gr.commands.executeCommand("ipynb.newUntitledIpynb")}getCurrentCodeLens(){let e=this.documentManager.activeTextEditor,t=this.getCurrentCodeWatcher();if(e&&t)return t.getCodeLenses().find(n=>n.range.end.line>=e.selection.anchor.line&&n.range.start.line<=e.selection.anchor.line)}getCurrentCodeWatcher(){let e=this.documentManager.activeTextEditor;if(!(!e||!e.document||!this.dataScienceCodeLensProvider))return this.dataScienceCodeLensProvider.getCodeWatcher(e.document)}openPythonExtensionPage(){gr.env.openExternal(gr.Uri.parse("https://marketplace.visualstudio.com/items?itemName=ms-toolsai.jupyter")).then(m,m)}async openVariableView(){return this.commandManager.executeCommand("jupyterViewVariables.focus")}async openOutlineView(){return this.commandManager.executeCommand("outline.focus")}async listenForErrors(e){let t;try{return t=await e(),t}catch(n){C("listenForErrors",n),this.dataScienceErrorHandler.handleError(n).then(m,m)}return t}async exportFile(e){let t=we(e);if(t&&t.length>0&&this.jupyterExporter){let n=this.documentManager.activeTextEditor;if(n&&this.fileSystem.arePathsSame(n.document.uri,e)){let i=$F(n.document,this.configuration.getSettings(n.document.uri));if(i){let o=await this.exportDialog.showDialog("ipynb",e);if(await this.waitForStatus(async()=>{if(o){let s=await this.jupyterExporter?.translateToNotebook(i);await this.fileSystem.writeFile(o,JSON.stringify(s,void 0,1))}},y.exportingFormat,W(e)),o&&t){let s=y.exportOpenQuestion1;await this.applicationShell.showInformationMessage(y.exportDialogComplete(W(e)),s)===s&&await b0(o)}}}}}async exportFileAndOutput(e){let t=we(e);if(t&&t.length>0&&this.jupyterExporter&&this.jupyterServerHelper&&await this.jupyterServerHelper.isJupyterServerSupported()){let n=this.documentManager.activeTextEditor;if(n&&n.document&&this.fileSystem.arePathsSame(n.document.uri,e)){let i=$F(n.document,this.configuration.getSettings(n.document.uri));if(i){let o=await this.exportDialog.showDialog("ipynb",e);return o?(await this.waitForStatus(async()=>{if(o){let s=await this.jupyterExporter?.translateToNotebook(i);await this.fileSystem.writeFile(o,JSON.stringify(s,void 0,1))}},y.exportingFormat,W(e)),await this.notebook.openNotebookDocument(o).then(s=>this.notebook.showNotebookDocument(s)),await this.commandManager.executeCommand("notebook.execute"),o):void 0}}}else this.jupyterServerHelper&&await this.dataScienceErrorHandler.handleError(new co(y.jupyterNotSupported(await this.jupyterServerHelper.getJupyterServerError())))}async expandAllCells(e){let t=this.interactiveWindowProvider.getInteractiveWindowWithNotebook(e);H(`Expanding all cells in interactive window with uri ${t?.notebookUri}`),t&&await t.expandAllCells()}async collapseAllCells(e){let t=this.interactiveWindowProvider.getInteractiveWindowWithNotebook(e);H(`Collapsing all cells in interactive window with uri ${t?.notebookUri}`),t&&await t.collapseAllCells()}exportCells(){let e=this.interactiveWindowProvider?.activeWindow;e&&e.export()}exportAs(e){let t=this.interactiveWindowProvider.getInteractiveWindowWithNotebook(e);t&&t.exportAs()}export(e){let t=this.interactiveWindowProvider.getInteractiveWindowWithNotebook(e);t&&t.export()}async createNewInteractiveWindow(e){await this.interactiveWindowProvider?.getOrCreate(void 0,e)}waitForStatus(e,t,n,i){let o=t(n||"");return this.statusProvider.waitWithStatus(e,o,void 0,i)}async importNotebook(){let e=y.importDialogFilter,t={};t[e]=["ipynb"];let n=await this.applicationShell.showOpenDialog({openLabel:y.importDialogTitle,filters:t});n&&n.length>0&&await this.waitForStatus(async()=>{await this.fileConverter.importIpynb(n[0])},y.importingFormat,W(n[0]))}async importNotebookOnFile(e){let t=we(e);t&&t.length>0&&await this.waitForStatus(async()=>{await this.fileConverter.importIpynb(e)},y.importingFormat,W(e))}async scrollToCell(e,t){if(t&&e){let n=this.interactiveWindowProvider.getInteractiveWindowsWithSubmitter(e);for(let i=0;i<n.length;i+=1)if(await n[i].hasCell(t)){n[i].scrollToCell(t);break}}}async clearAllCellsInInteractiveWindow(e){let t=this.interactiveWindowProvider.getInteractiveWindowWithNotebook(e?.notebookEditor?.notebookUri)?.notebookUri;if(!t)return;let n=gr.workspace.notebookDocuments.find(s=>s.uri.toString()===t.toString());if(!n)return;let i=new gr.WorkspaceEdit,o=gr.NotebookEdit.deleteCells(new gr.NotebookRange(0,n.cellCount));i.set(n.uri,[o]),await gr.workspace.applyEdit(i)}async goToCodeInInteractiveWindow(e){if(e&&e.metadata?.interactive){let t=gr.Uri.parse(e.metadata.interactive.uristring),n=e.metadata.interactive.lineIndex,i=await this.documentManager.showTextDocument(t,{viewColumn:gr.ViewColumn.One});i&&(i.revealRange(new gr.Range(n,0,n,0)),i.selection=new gr.Selection(new gr.Position(n,0),new gr.Position(n,0)))}}async copyCellInInteractiveWindow(e){if(e){let t=this.configuration.getSettings(e.notebook.uri),n=[e.metadata.interactiveWindowCellMarker??t.defaultCellMarker,e.document.getText()].join(`
`);await this.clipboard.writeText(n)}}};g([sn("DATASCIENCE.DEBUG_STEP_OVER")],Uo.prototype,"debugStepOver",1),g([sn("DATASCIENCE.DEBUG_STOP")],Uo.prototype,"debugStop",1),g([sn("DATASCIENCE.DEBUG_CONTINUE")],Uo.prototype,"debugContinue",1),g([yr("DATASCIENCE.ADD_CELL_BELOW")],Uo.prototype,"addCellBelow",1),g([sn("DATASCIENCE.EXPORT_PYTHON_FILE")],Uo.prototype,"exportFile",1),g([sn("DATASCIENCE.EXPORT_PYTHON_FILE_AND_OUTPUT")],Uo.prototype,"exportFileAndOutput",1),g([sn("DATASCIENCE.IMPORT_NOTEBOOK",{scope:"command"})],Uo.prototype,"importNotebook",1),g([sn("DATASCIENCE.IMPORT_NOTEBOOK",{scope:"file"})],Uo.prototype,"importNotebookOnFile",1),Uo=g([(0,Nr.injectable)(),p(0,(0,Nr.inject)(O)),p(1,(0,Nr.inject)(wh)),p(1,(0,Nr.optional)()),p(2,(0,Nr.inject)(rp)),p(2,(0,Nr.optional)()),p(3,(0,Nr.inject)(lr)),p(4,(0,Nr.inject)(ue)),p(5,(0,Nr.inject)(Ze)),p(6,(0,Nr.inject)(se)),p(7,(0,Nr.inject)(Cd)),p(7,(0,Nr.optional)()),p(8,(0,Nr.inject)(Fe)),p(9,(0,Nr.inject)(Ui)),p(9,(0,Nr.optional)()),p(10,(0,Nr.inject)(se)),p(11,(0,Nr.inject)(ue)),p(12,(0,Nr.inject)(ce)),p(13,(0,Nr.inject)(Gi)),p(14,(0,Nr.inject)(Ke)),p(15,(0,Nr.inject)(an)),p(16,(0,Nr.inject)(Tn)),p(17,(0,Nr.inject)(vb)),p(18,(0,Nr.inject)(Hi)),p(19,(0,Nr.inject)(Zd)),p(20,(0,Nr.inject)(qe))],Uo);var Ed=k(A());var wf=require("vscode");var x0=class{constructor(e,t,n,i,o,s){this.documentManager=e;this.configService=t;this.storage=n;this.notebook=i;this.executionCount=0;this.cellIndexesCounted={};this.disposables=[];s.push(this),this.documentManager.onDidChangeTextDocument(this.onChangedDocument,this,this.disposables),o.onDidChangeNotebookCellExecutionState(this.onDidCellStateChange,this,this.disposables)}dispose(){this.disposed||(this.disposed=!0,this.storage.clear(),this.disposables.forEach(e=>e.dispose()))}reset(){this.storage.clear(),this.executionCount=0}async generateCode(e,t,n,i){let{executableLines:o}=this.extractExecutableLines(e);if(this.executionCount+=1,this.cellIndexesCounted[t]=!0,o.length>0&&o.find(s=>s.trim().length>0))return this.generateCodeImpl(e,this.executionCount,n,i)}extractExecutableLines(e){let t=e.interactive.originalSource,n=this.configService.getSettings(this.notebook.uri),i=new Ti(n),o=_l(t);if(n.magicCommandsAsComments&&o.forEach((s,a)=>o[a]=Wb(s)),e.interactiveWindowCellMarker&&o.length&&o[0].trim()===e.interactiveWindowCellMarker.trim()){let s=o.slice(1).filter(a=>a.trim().length>0);if(s.length>0&&s[0].trim().startsWith("%%")){let a=o.slice(o.indexOf(s[0]));return{lines:a,executableLines:a}}}return o.length>0&&(i.isCode(o[0])||i.isMarkdown(o[0]))?{lines:o,executableLines:o.slice(1)}:{lines:o,executableLines:o}}onDidCellStateChange(e){e.cell.notebook!==this.notebook||!e.cell.executionSummary?.executionOrder||this.cellIndexesCounted[e.cell.index]||(this.executionCount+=1,this.cellIndexesCounted[e.cell.index]=!0)}async generateCodeImpl(e,t,n,i){let{lineIndex:o,uristring:s}=e.interactive,a=this.documentManager.textDocuments.find(ae=>ae.uri.toString()===s);if(!a)return;let{stripped:l,trueStartLine:c}=this.extractStrippedLines(e),u=a.lineAt(c),d=a.lineAt(Math.min(c+l.length-1,a.lineCount-1)),f=0;for(;f<l.length&&l[f].trim().length===0;)f+=1;let h=f+c,v=a.offsetAt(new wf.Position(o,0)),S=a.offsetAt(d.rangeIncludingLineBreak.end),b=(e.interactiveWindowCellMarker||"").length>0,{runtimeLine:D,debuggerStartLine:_}=this.addHiddenLines(n,l,c,h,b,i),L=l.join(""),Z=a.getText(new wf.Range(new wf.Position(o,0),d.rangeIncludingLineBreak.end)),Se=(await va(L,"SHA-1")).substring(0,12),ie=this.getRuntimeFile(Se,t),fe=n?-1:0,de={line:u?u.lineNumber+1:1,endLine:d?d.lineNumber+1:1,firstNonBlankLineIndex:h,debuggerStartLine:_,executionCount:t,startOffset:v,endOffset:S,deleted:!1,code:L,trimmedRightCode:l.map(ae=>ae.replace(/[ \t\r]+\n$/g,`
`)).join(""),realCode:Z,runtimeLine:D,runtimeFile:ie,id:e.id,timestamp:Date.now(),lineOffsetRelativeToIndexOfFirstLineInCell:fe,hasCellMarker:b};return H(`Generated code for ${t} = ${ie} with ${l.length} lines`),this.storage.store(wf.Uri.parse(e.interactive.uristring),de),de}getRuntimeFile(e,t){return`<ipython-input-${t}-${e}>`}onChangedDocument(e){let t=this.storage.getFileGeneratedCode(e.document.uri);if(t){let n=e.document.getText();e.contentChanges.forEach(i=>{this.handleContentChange(n,i,t)})}}extractStrippedLines(e){let t=_l(e.interactive.originalSource),{lines:n}=this.extractExecutableLines(e),i=e.interactive.lineIndex+1;if(!e.interactiveWindowCellMarker){i=e.interactive.lineIndex;for(let l=0;l<n.length;l+=1)if(n[l]!==t[l]){i+=l+1;break}}let o=0;for(;o<n.length&&n[o].trim().length===0;)o+=1;let s=n.length-1,a=n.length-2;for(;a>0;){let l=n[s],c=n[a];if((l.length===0||l===`
`)&&(c.length===0||c===`
`))n.splice(s,1),s-=1,a-=1;else break}!n[s].endsWith(`
`)&&n[s].length>0&&(n[s]=`${n[s]}
`);for(let l=0;l<n.length;l++)n[l]=n[l].replace(/\r\n/g,`
`);return{stripped:n,trueStartLine:i}}handleContentChange(e,t,n){let i=t.range.start.line-t.range.end.line+t.text.split(`
`).length-1,o=t.text.length-t.rangeLength,s=t.rangeLength<=0?t.rangeOffset:t.rangeOffset+t.rangeLength-1;n.forEach(a=>{a.endOffset<t.rangeOffset||(a.startOffset>s?(a.line+=i,a.endLine+=i,a.startOffset+=o,a.endOffset+=o):a.startOffset===s?a.deleted||t.rangeLength>0||i===0?a.deleted=e.substr(a.startOffset,a.endOffset-a.startOffset)!==a.realCode:(a.line+=i,a.endLine+=i,a.startOffset+=o,a.endOffset+=o):a.deleted=e.substr(a.startOffset,a.endOffset-a.startOffset)!==a.realCode)})}addHiddenLines(e,t,n,i,o,s){let a=s||this.configService.getSettings(void 0).forceIPyKernelDebugger===!0;return e&&this.configService.getSettings(this.notebook.uri).stopOnFirstLineWhileDebugging?a?(t.splice(0,0,`breakpoint()
`),{runtimeLine:1,debuggerStartLine:n+1}):(t.splice(0,0,`breakpoint()
`),{runtimeLine:2,debuggerStartLine:n}):{runtimeLine:1,debuggerStartLine:o?i:i+1}}};var jb=class{constructor(e,t,n,i,o){this.documentManager=e;this.configService=t;this.storageFactory=n;this.disposables=i;this.notebooks=o;this.codeGenerators=new WeakMap}activate(){this.notebooks.onDidCloseNotebookDocument(this.onDidCloseNotebook,this,this.disposables)}getOrCreate(e){let t=this.get(e);if(t)return t;let n=new x0(this.documentManager,this.configService,this.storageFactory.getOrCreate(e),e,this.notebooks,this.disposables);return this.codeGenerators.set(e,n),n}get(e){return this.codeGenerators.get(e)}onDidCloseNotebook(e){this.codeGenerators.get(e)?.dispose(),this.codeGenerators.delete(e)}};jb=g([(0,Ed.injectable)(),p(0,(0,Ed.inject)(lr)),p(1,(0,Ed.inject)(se)),p(2,(0,Ed.inject)(na)),p(3,(0,Ed.inject)(O)),p(4,(0,Ed.inject)(qe))],jb);var vc=k(A()),Bb=require("vscode");function ds(r){if(r.metadata.interactive!==void 0)return r.metadata}function IG(r,e,t){let n=je(r,{trim:!1,removeEmptyEntries:!1}),i=t.stripFirstMarkerNoConcat(n),o=gV(i);return Rl(o,`
`,e.magicCommandsAsComments?Wb:void 0).join("")}function kf(r){let e=r;return e&&e.input&&ti(e.input.uri)&&ti(e.input.inputBoxUri)}var Cve=y.runCurrentCellAndAddBelow,Eve=y.addCellBelowCommandTitle,wve=y.debugCellCommandTitle,kve=y.debugCellCommandTitle,Pve=y.debugStepOverCommandTitle,Dve=y.debugContinueCommandTitle,Tve=y.debugStopCommandTitle,_ve=y.runCellLensCommandTitle,Rve=y.runAllCellsLensCommandTitle,Nve=y.runAllCellsAboveLensCommandTitle,SG=y.runCellAndAllBelowLensCommandTitle,Ave=y.scrollToCellTitleFormatMessage,Vb=class{constructor(e,t,n,i,o,s,a){this.configService=e;this.documentManager=t;this.workspace=n;this.generatedCodeStorageFactory=s;this.updateEvent=new Bb.EventEmitter;this.notebookData=new Map;this.codeLensCache=new Map;this.totalCodeLensUpdateTimeInMs=0;this.codeLensUpdateCount=0;this.maxCellCount=0;this.documentManager.onDidCloseTextDocument(this.onClosedDocument,this,o),this.workspace.onDidGrantWorkspaceTrust(()=>this.codeLensCache.clear(),this,o),this.configService.getSettings(void 0).onDidChange(this.onChangedSettings,this,o),i.onDidChangeNotebookCellExecutionState(this.onDidChangeNotebookCellExecutionState,this,o),a.onDidDisposeKernel(l=>{this.notebookData.delete(l.notebook.uri.toString())},this,o)}getPerfMeasures(){return{totalCodeLensUpdateTimeInMs:this.totalCodeLensUpdateTimeInMs,codeLensUpdateCount:this.codeLensUpdateCount,maxCellCount:this.maxCellCount}}get updateRequired(){return this.updateEvent.event}createCodeLenses(e){let t=this.getCodeLensCacheData(e);return[...t.documentLenses,...t.gotoCellLens]}getCellRanges(e){return this.getCodeLensCacheData(e).cellRanges}getCodeLensCacheData(e){let t=new $e,n=!1,i=e.uri.toString(),o=this.codeLensCache.get(i),s=!1;o||(o={cachedDocumentVersion:void 0,cachedExecutionCounts:new Set,documentLenses:[],cellRanges:[],gotoCellLens:[]},s=!0,this.codeLensCache.set(i,o)),o.cachedDocumentVersion!==e.version&&(o.cellRanges=YC(e,this.configService.getSettings(e.uri)),o.documentLenses=[],o.gotoCellLens=[],o.cachedDocumentVersion=e.version,s=!0);let a=this.getDocumentExecutionCounts(i);if((a.length!==o.cachedExecutionCounts.size||a.find(l=>!o?.cachedExecutionCounts.has(l)))&&(o.gotoCellLens=[],o.cachedExecutionCounts=new Set(a),s=!0),o.documentLenses.length===0&&s&&o.cellRanges.length){n=!0;let l=this.enumerateCommands(e.uri);w(`CodeLensFactory: Generating new code lenses for version ${e.version} of document ${e.uri} for commands ${l.join(", ")}`);let c=!0;o.cellRanges.forEach(u=>{l.forEach(d=>{let f=this.createCodeLens(e,u,d,c);f&&o.documentLenses.push(f)}),c=!1})}else te(`NOT Generating new code lenses for version ${e.version} of document ${e.uri} - needUpdate: ${s}, cellRanges.length: ${o.cellRanges.length}`);if(s&&o.gotoCellLens.length===0&&o.cellRanges.length&&this.configService.getSettings(e.uri).addGotoCodeLenses){let l=this.generatedCodeStorageFactory.get({fileUri:e.uri}),c=l?l.all.find(u=>u.uri.toString()===e.uri.toString())?.generatedCodes:void 0;c&&c.length&&o.cellRanges.forEach(u=>{let d=this.createExecutionLens(e,u.range,c);d&&o?.gotoCellLens.push(d)})}return n&&(this.totalCodeLensUpdateTimeInMs+=t.elapsedTime,this.codeLensUpdateCount+=1,this.maxCellCount=Math.max(this.maxCellCount,o.cellRanges.length)),o}getDocumentExecutionCounts(e){return[...this.notebookData.values()].map(t=>t.documentExecutionCounts.get(e)).filter(t=>t!==void 0)}onDidChangeNotebookCellExecutionState(e){if(e.cell.notebook.notebookType!==wt||e.state!==Bb.NotebookCellExecutionState.Idle||!e.cell.executionSummary?.executionOrder)return;let t=ds(e.cell),n=this.notebookData.get(e.cell.notebook.uri.toString());n||(n={cellExecutionCounts:new Map,documentExecutionCounts:new Map},this.notebookData.set(e.cell.notebook.uri.toString(),n)),n!==void 0&&t!==void 0&&(n.cellExecutionCounts.set(t.id,e.cell.executionSummary.executionOrder),n.documentExecutionCounts.set(t.interactive.uristring,e.cell.executionSummary.executionOrder),this.updateEvent.fire())}onClosedDocument(e){this.codeLensCache.delete(e.uri.toString())}onChangedSettings(){this.codeLensCache.clear(),this.updateEvent.fire()}enumerateCommands(e){let t,n=this.configService.getSettings(e).codeLenses;n?t=n.split(",").map(s=>s.trim()):t=ju.DefaultDesignLenses;let i=this.configService.getSettings(e).debugCodeLenses;i?t=t.concat(i.split(",").map(s=>s.trim())):t=t.concat(ju.DefaultDebuggingLenses);let o=[];return this.workspace.isTrusted||(o=[...ju.DebuggerCommands,...ju.DebuggerCommands,V.RunAllCells,V.RunAllCellsAbove,V.RunAllCellsAbovePalette,V.RunCellAndAllBelowPalette,V.RunCurrentCell,V.RunCurrentCellAdvance,V.RunCurrentCellAndAddBelow,V.RunFileInInteractiveWindows,V.InterruptKernel,V.RunToLine,V.RunCell,V.DebugCell,V.DebugContinue,V.DebugStepOver,V.DebugStop,V.RunCellAndAllBelowPalette]),o&&(t=t.filter(s=>!o.includes(s))),t}createCodeLens(e,t,n,i){let{range:o,cell_type:s}=t;switch(n){case V.RunCurrentCellAndAddBelow:return this.generateCodeLens(o,V.RunCurrentCellAndAddBelow,Cve);case V.AddCellBelow:return this.generateCodeLens(o,V.AddCellBelow,Eve,[e.uri,o.start.line]);case V.DebugCurrentCellPalette:return this.generateCodeLens(o,V.DebugCurrentCellPalette,wve);case V.DebugCell:if(s!=="code")break;return this.generateCodeLens(o,V.DebugCell,kve,[e.uri,o.start.line,o.start.character,o.end.line,o.end.character]);case V.DebugStepOver:if(s!=="code")break;return this.generateCodeLens(o,V.DebugStepOver,Pve,[e.uri]);case V.DebugContinue:if(s!=="code")break;return this.generateCodeLens(o,V.DebugContinue,Dve,[e.uri]);case V.DebugStop:if(s!=="code")break;return this.generateCodeLens(o,V.DebugStop,Tve,[e.uri]);case V.RunCurrentCell:case V.RunCell:return this.generateCodeLens(o,V.RunCell,_ve,[e.uri,o.start.line,o.start.character,o.end.line,o.end.character]);case V.RunAllCells:return this.generateCodeLens(o,V.RunAllCells,Rve,[e.uri,o.start.line,o.start.character]);case V.RunAllCellsAbovePalette:case V.RunAllCellsAbove:return i?this.generateCodeLens(o,V.RunCellAndAllBelow,SG,[e.uri,o.start.line,o.start.character]):this.generateCodeLens(o,V.RunAllCellsAbove,Nve,[e.uri,o.start.line,o.start.character]);case V.RunCellAndAllBelowPalette:case V.RunCellAndAllBelow:return this.generateCodeLens(o,V.RunCellAndAllBelow,SG,[e.uri,o.start.line,o.start.character]);default:J(`Invalid command for code lens ${n}`);break}}findMatchingCellExecutionCount(e){return[...this.notebookData.values()].find(n=>n.cellExecutionCounts.get(e))?.cellExecutionCounts.get(e)}createExecutionLens(e,t,n){if(n){let i=n.filter(o=>o.line-2===t.start.line).sort((o,s)=>o.timestamp-s.timestamp);if(i&&i.length){let o=i[i.length-1],s=this.findMatchingCellExecutionCount(o.id);if(s!==void 0)return this.generateCodeLens(t,V.ScrollToCell,Ave(s),[e.uri,o.id])}}}generateCodeLens(e,t,n,i){return new Bb.CodeLens(e,Mve(t,n,i))}};Vb=g([(0,vc.injectable)(),p(0,(0,vc.inject)(se)),p(1,(0,vc.inject)(lr)),p(2,(0,vc.inject)(ce)),p(3,(0,vc.inject)(qe)),p(4,(0,vc.inject)(O)),p(5,(0,vc.inject)(na)),p(6,(0,vc.inject)(Ke))],Vb);function Mve(r,e,t){return{arguments:t,title:e,command:r}}var ms=k(A()),Pf=k(require("vscode"));var qb=class{constructor(e,t,n,i,o,s,a,l){this.serviceContainer=e;this.debugLocationTracker=t;this.documentManager=n;this.configuration=i;this.commandManager=o;this.debugService=a;this.totalExecutionTimeInMs=0;this.totalGetCodeLensCalls=0;this.activeCodeWatchers=[];this.didChangeCodeLenses=new Pf.EventEmitter;s.push(this),s.push(l.onDidGrantWorkspaceTrust(()=>{this.activeCodeWatchers=G(this.activeCodeWatchers),this.didChangeCodeLenses.fire()})),s.push(this.debugService.onDidChangeActiveDebugSession(this.onChangeDebugSession.bind(this))),s.push(this.documentManager.onDidCloseTextDocument(this.onDidCloseTextDocument.bind(this))),this.debugLocationTracker&&s.push(this.debugLocationTracker.updated(this.onDebugLocationUpdated.bind(this)))}dispose(){this.totalGetCodeLensCalls>0&&R("DS_INTERNAL.CODE_LENS_ACQ_TIME",{duration:this.totalExecutionTimeInMs/this.totalGetCodeLensCalls}),G(this.activeCodeWatchers)}get onDidChangeCodeLenses(){return this.didChangeCodeLenses.event}provideCodeLenses(e,t){return[el,DS].includes(e.uri.scheme)?[]:this.getCodeLensTimed(e)}getCodeWatcher(e){return this.matchWatcher(e.uri)}onDebugLocationUpdated(){this.didChangeCodeLenses.fire()}onChangeDebugSession(e){this.didChangeCodeLenses.fire()}onDidCloseTextDocument(e){let t=this.activeCodeWatchers.findIndex(n=>n.uri&&n.uri.toString()===e.uri.toString());t>=0&&this.activeCodeWatchers.splice(t,1)[0].dispose()}getCodeLensTimed(e){let t=new $e,n=this.getCodeLens(e);return this.totalExecutionTimeInMs+=t.elapsedTime,this.totalGetCodeLensCalls+=1,new nr(fr.HasCodeCells,this.commandManager).set(n&&n.length>0).catch(m),this.configuration.getSettings(e.uri).enableCellCodeLens?this.adjustDebuggingLenses(e,n):[]}adjustDebuggingLenses(e,t){let n=ju.DebuggerCommands;if(this.debugLocationTracker&&this.debugService.activeDebugSession){let i=this.debugLocationTracker.getLocation(this.debugService.activeDebugSession),o;try{o=i?Pf.Uri.parse(i.fileName):void 0}catch{}if(i&&(Mi(Pf.Uri.file(i.fileName),e.uri,!0)||o&&Mi(o,e.uri,!0)))return t.filter(a=>{let l=new Pf.Position(i.lineNumber-1,i.column-1);return a.range.contains(l)}).filter(a=>a.command?n.includes(a.command.command):!1);te(`Detected debugging context because activeDebugSession is name:"${this.debugService.activeDebugSession.name}", type: "${this.debugService.activeDebugSession.type}", but fell through with debugLocation: ${JSON.stringify(i)}, and document.uri: ${e.uri.toString()}`)}else return t.filter(i=>i.command?!n.includes(i.command.command):!1);return[]}getCodeLens(e){let t=this.matchWatcher(e.uri);return t?t.getCodeLenses():(w(`Creating a new watcher for document ${e.uri}`),this.createNewCodeWatcher(e).getCodeLenses())}matchWatcher(e){let t=this.activeCodeWatchers.findIndex(i=>i.uri&&i.uri.toString()==e.toString());if(t>=0)return this.activeCodeWatchers[t];let n=this.documentManager.textDocuments.filter(i=>i.uri.toString()===e.toString());if(n&&n.length>0)return w(`creating new code watcher with matching document ${e}`),this.createNewCodeWatcher(n[0])}createNewCodeWatcher(e){let t=this.serviceContainer.get(m0);return t.setDocument(e),t.codeLensUpdated(this.onWatcherUpdated.bind(this)),this.activeCodeWatchers.push(t),t}onWatcherUpdated(){this.didChangeCodeLenses.fire()}};qb=g([(0,ms.injectable)(),p(0,(0,ms.inject)(ct)),p(1,(0,ms.inject)($_)),p(1,(0,ms.optional)()),p(2,(0,ms.inject)(lr)),p(3,(0,ms.inject)(se)),p(4,(0,ms.inject)(Fe)),p(5,(0,ms.inject)(O)),p(6,(0,ms.inject)(Ui)),p(7,(0,ms.inject)(ce))],qb);var Du=k(A()),ut=require("vscode");var Df=class extends Error{constructor(t){super("Cell failed to execute");this.cell=t}};function Ove(r,e){if(e<=0)throw new RangeError(`Length must be > 0 not ${e}`);return r<0&&(r+=e),r<0?0:r>=e?e-1:r}var ir=class{constructor(e,t,n,i,o,s){this.interactiveWindowProvider=e;this.configService=t;this.documentManager=n;this.executionHelper=i;this.dataScienceErrorHandler=o;this.codeLensFactory=s;this.version=-1;this.codeLenses=[];this.cells=[];this.codeLensUpdatedEvent=new ut.EventEmitter}setDocument(e){this.document=e,this.version=e.version,this.codeLenses=this.codeLensFactory.createCodeLenses(e),this.cells=this.codeLensFactory.getCellRanges(e),this.updateRequiredDisposable=this.codeLensFactory.updateRequired(this.onCodeLensFactoryUpdated.bind(this)),this.closeDocumentDisposable=this.documentManager.onDidCloseTextDocument(this.onDocumentClosed.bind(this))}get codeLensUpdated(){return this.codeLensUpdatedEvent.event}get uri(){return this.document?.uri}getVersion(){return this.version}getCodeLenses(){let e=this.document;return e&&e.version!=this.version&&(this.codeLenses=this.codeLensFactory.createCodeLenses(e),this.cells=this.codeLensFactory.getCellRanges(e),this.version=e.version),this.codeLenses}async debugCurrentCell(){if(!(!this.documentManager.activeTextEditor||!this.documentManager.activeTextEditor.document))return this.runMatchingCell(this.documentManager.activeTextEditor.selection,!1,!0)}dispose(){let e=this.codeLensFactory.getPerfMeasures();e&&e.codeLensUpdateCount>0&&R("DS_INTERNAL.DOCUMENT_WITH_CODE_CELLS",{codeLensUpdateTime:e.totalCodeLensUpdateTimeInMs/e.codeLensUpdateCount,maxCellCount:e.maxCellCount}),this.codeLensUpdatedEvent.dispose(),this.closeDocumentDisposable?.dispose(),this.updateRequiredDisposable?.dispose()}async runAllCells(e){let t=await this.getActiveInteractiveWindow(),n=this.codeLenses.filter(s=>s.command&&s.command.command===V.RunCell&&s.command.arguments&&s.command.arguments.length>=5),i=n.length,o=Promise.resolve(!0);for(let s of n){let a=new ut.Range(s.command.arguments[1],s.command.arguments[2],s.command.arguments[3],s.command.arguments[4]);if(this.document){i===n.length&&(a=new ut.Range(new ut.Position(0,0),a.end));let l=this.document.getText(a);i-=1,o=this.addCode(t,l,this.document.uri,a.start.line,e)}}if(await o,n.length===0)return this.runFileAsOneCell(e??!1)}async runFileInteractive(){if(this.document&&this.configService.getSettings(this.document?.uri).splitRunFileIntoCells)return this.runAllCells();if(this.document)return this.runFileAsOneCell(!1)}async debugFileInteractive(){if(this.document&&this.configService.getSettings(this.document?.uri).splitRunFileIntoCells)return this.runAllCells(!0);if(this.document)return this.runFileAsOneCell(!0)}async runAllCellsAbove(e,t){let n=await this.getActiveInteractiveWindow(),i=this.codeLenses.filter(l=>l.command&&l.command.command===V.RunCell),o=i.findIndex(l=>l.range.start.line>=e&&l.range.start.character>=t);o<0&&(o=i.length);let s=o,a=Promise.resolve(!0);for(let l of i)if(o>0&&this.document){let c=new ut.Range(l.range.start,l.range.end);o===s&&(c=new ut.Range(new ut.Position(0,0),c.end)),o-=1;let u=this.document.getText(c);a=this.addCode(n,u,this.document.uri,l.range.start.line)}else break;await a}async runCellAndAllBelow(e,t){let n=await this.getActiveInteractiveWindow(),i=this.codeLenses.filter(l=>l.command&&l.command.command===V.RunCell),o=i.findIndex(l=>l.range.start.line>=e&&l.range.start.character>=t),s=o>0?i.length-o:i.length,a=Promise.resolve(!0);for(let l=o;l>=0&&l<i.length;l+=1)if(s>0&&this.document){let c=i[l];s-=1;let u=this.document.getText(c.range);a=this.addCode(n,u,this.document.uri,c.range.start.line)}await a}async runSelectionOrLine(e,t){if(this.document&&e&&Mi(e.document.uri,this.document.uri)){let n=await this.getActiveInteractiveWindow(),i;if(t===void 0||ti(t)?i=this.executionHelper.getSelectedTextToExecute(e):i=t,!i)return;let s=this.configService.getSettings(e.document.uri).normalizeSelectionForInteractiveWindow??!0?await this.executionHelper.normalizeLines(i):i;if(!s||s.trim().length===0)return;await this.addCode(n,s,this.document.uri,e.selection.start.line)}}async runToLine(e){if(this.document&&e>0){let t=await this.getActiveInteractiveWindow(),n=this.document.lineAt(e-1),i=this.document.getText(new ut.Range(0,0,n.range.end.line,n.range.end.character));i&&i.trim().length&&await this.addCode(t,i,this.document.uri,0)}}async runFromLine(e){if(this.document&&e<this.document.lineCount){let t=await this.getActiveInteractiveWindow(),n=this.document.lineAt(this.document.lineCount-1),i=this.document.getText(new ut.Range(e,0,n.range.end.line,n.range.end.character));i&&i.trim().length&&await this.addCode(t,i,this.document.uri,e)}}async runCell(e){if(!this.documentManager.activeTextEditor||!this.documentManager.activeTextEditor.document)return;let t=e.contains(this.documentManager.activeTextEditor.selection.start)&&this.configService.getSettings(this.documentManager.activeTextEditor.document.uri).enableAutoMoveToNextCell;return this.runMatchingCell(e,t)}async debugCell(e){if(!(!this.documentManager.activeTextEditor||!this.documentManager.activeTextEditor.document))return this.runMatchingCell(e,!1,!0)}async runCurrentCell(){if(!(!this.documentManager.activeTextEditor||!this.documentManager.activeTextEditor.document))return this.runMatchingCell(this.documentManager.activeTextEditor.selection,!1)}async runCurrentCellAndAdvance(){if(!(!this.documentManager.activeTextEditor||!this.documentManager.activeTextEditor.document))return this.runMatchingCell(this.documentManager.activeTextEditor.selection,!0)}async addEmptyCellToBottom(){let e=this.documentManager.activeTextEditor;e&&this.insertCell(e,e.document.lineCount+1)}async runCurrentCellAndAddBelow(){if(!this.documentManager.activeTextEditor||!this.documentManager.activeTextEditor.document)return;let e=this.documentManager.activeTextEditor,t=new Ti(this.configService.getSettings(e.document.uri)),n=0,i=this.getDefaultCellMarker(e.document.uri);e&&e.edit(s=>{let a=!0;for(let l=e.selection.end.line+1;l<e.document.lineCount;l+=1)if(t.isCell(e.document.lineAt(l).text)){a=!1,n=l,s.insert(new ut.Position(l,0),`${i}

`);break}a&&(n=e.document.lineCount,s.insert(new ut.Position(e.document.lineCount,0),`
${i}
`))}).then(m,m);let o=new ut.Position(n+1,0);return this.runMatchingCell(e.selection,!1).then(()=>this.advanceToRange(new ut.Range(o,o)))}insertCellBelowPosition(){let e=this.documentManager.activeTextEditor;e&&e.selection&&this.insertCell(e,e.selection.end.line+1)}insertCellBelow(){let e=this.documentManager.activeTextEditor;if(e&&e.selection){let t=this.getCellFromPosition(e.selection.end);t?this.insertCell(e,t.range.end.line+1):this.insertCell(e,e.selection.end.line+1)}}insertCellAbove(){let e=this.documentManager.activeTextEditor;if(e&&e.selection){let t=this.getCellFromPosition(e.selection.start);t?this.insertCell(e,t.range.start.line):this.insertCell(e,e.selection.start.line)}}deleteCells(){let e=this.documentManager.activeTextEditor;if(!e||!e.selection)return;let t=this.getStartEndCells(e.selection);if(!t)return;let n=t[0],i=t[1],o=0,s=0,a=i.range.end.line+1,l=0;n.range.start.line>0&&(o=n.range.start.line-1,s=e.document.lineAt(o).range.end.character,a=i.range.end.line,l=i.range.end.character);let c=new ut.Range(new ut.Position(o,s),new ut.Position(a,l));e.edit(u=>{u.replace(c,""),this.codeLensUpdatedEvent.fire()}).then(m,m)}selectCell(){let e=this.documentManager.activeTextEditor;if(e&&e.selection){let t=this.getStartEndCells(e.selection);if(t){let n=t[0],i=t[1];e.selection.anchor.isBeforeOrEqual(e.selection.active)?e.selection=new ut.Selection(n.range.start,i.range.end):e.selection=new ut.Selection(i.range.end,n.range.start)}}}selectCellContents(){let e=this.documentManager.activeTextEditor;if(!e||!e.selection)return;let t=this.getStartEndCellIndex(e.selection);if(!t)return;let n=t[0],i=t[1],o=e.selection.anchor.isBeforeOrEqual(e.selection.active),s=this.cells,a=[];for(let l=n;l<=i;l+=1){let c=s[l],u=c.range.start.line+1,d=0,f=c.range.end.line,h=c.range.end.character;c.range.start.line===c.range.end.line&&(u=c.range.start.line,d=e.document.lineAt(u).range.end.character,f=u,h=d),o?a.push(new ut.Selection(u,d,f,h)):a.push(new ut.Selection(f,h,u,d))}e.selections=a}extendSelectionByCellAbove(){let e=this.documentManager.activeTextEditor;if(!e||!e.selection)return;let t=e.selection,n=this.getStartEndCellIndex(e.selection);if(!n)return;let i=e.selection.anchor.isBefore(e.selection.active),o=this.cells,s=n[0],a=n[1],l=o[s],c=o[a];if(!l.range.start.isEqual(t.start)||!c.range.end.isEqual(t.end)){let u;i?s<a?u=new ut.Selection(l.range.start,o[a-1].range.end):u=new ut.Selection(l.range.end,l.range.start):u=new ut.Selection(c.range.end,l.range.start),e.selection=u}else{let u;i&&s<a?(u=o[a-1],e.selection=new ut.Selection(l.range.start,u.range.end)):s>0&&(u=o[s-1],e.selection=new ut.Selection(c.range.end,u.range.start)),u&&e.revealRange(u.range,ut.TextEditorRevealType.Default)}}extendSelectionByCellBelow(){let e=this.documentManager.activeTextEditor;if(!e||!e.selection)return;let t=e.selection,n=this.getStartEndCellIndex(e.selection);if(!n)return;let i=e.selection.anchor.isBeforeOrEqual(e.selection.active),o=this.cells,s=n[0],a=n[1],l=o[s],c=o[a];if(!l.range.start.isEqual(t.start)||!c.range.end.isEqual(t.end)){let u;i?u=new ut.Selection(l.range.start,c.range.end):s<a?u=new ut.Selection(o[s+1].range.start,c.range.end):u=new ut.Selection(c.range.start,c.range.end),e.selection=u}else{let u;i||s===a?a<o.length-1&&(u=o[a+1],e.selection=new ut.Selection(l.range.start,u.range.end)):s<a&&(u=o[s+1],e.selection=new ut.Selection(c.range.end,u.range.start)),u&&e.revealRange(u.range,ut.TextEditorRevealType.Default)}}async moveCellsUp(){await this.moveCellsDirection(!0)}async moveCellsDown(){await this.moveCellsDirection(!1)}changeCellToMarkdown(){this.applyToCells((e,t,n)=>this.changeCellTo(e,t,"markdown"))}changeCellToCode(){this.applyToCells((e,t,n)=>this.changeCellTo(e,t,"code"))}gotoNextCell(){let e=this.documentManager.activeTextEditor;if(!e||!e.selection)return;let t=e.selection,n=this.getCurrentCellLens(t.start),i=this.getNextCellLens(t.start);n&&i&&this.advanceToRange(i.range)}gotoPreviousCell(){let e=this.documentManager.activeTextEditor;if(!e||!e.selection)return;let t=e.selection,n=this.getCurrentCellLens(t.start),i=this.getPreviousCellLens(t.start);n&&i&&this.advanceToRange(i.range)}applyToCells(e){let t=this.documentManager.activeTextEditor,n=this.getStartEndCellIndex(t?.selection);if(!t||!n)return;let i=this.cells,o=n[0],s=n[1];for(let a=o;a<=s;a+=1)e(t,i[a],a)}changeCellTo(e,t,n){if(n==="raw")throw Error("Cell Type raw not implemented");if(t.cell_type===n)return;let i=new Ti(this.configService.getSettings(e.document.uri)),o=e.document.lineAt(t.range.start.line),s=e.document.getText(o.range),a=this.getDefaultCellMarker(e.document.uri),l=n==="markdown"?i.codeExecRegEx.exec(s):i.markdownExecRegEx.exec(s);if(!l)return;let c=l[l.length-1],u=n==="markdown"?`${a} [markdown]${c}`:`${a}${c}`;e.edit(async d=>{d.replace(o.range,u),t.cell_type=n,t.range.start.line<t.range.end.line&&(e.selection=new ut.Selection(t.range.start.line+1,0,t.range.end.line,t.range.end.character),ut.commands.executeCommand("editor.action.removeCommentLine").then(m,m),n==="markdown"&&ut.commands.executeCommand("editor.action.addCommentLine").then(m,m))}).then(m,m)}async moveCellsDirection(e){let t=this.documentManager.activeTextEditor;if(!t||!t.selection)return!1;let n=this.getStartEndCellIndex(t.selection);if(!n)return!1;let i=n[0],o=n[1],s=this.cells,a=s[i],l=s[o];if(!a||!l)return!1;let c=new ut.Range(a.range.start,l.range.end),u=new ut.Range(t.selection.start.line-c.start.line,t.selection.start.character,t.selection.end.line-c.start.line,t.selection.end.character),d=t.selection.active.isBefore(t.selection.anchor),f;if(e){if(i===0)return!1;{let h=s[i-1];f=this.exchangeTextLines(t,h.range,c).then(S=>(S&&(t.selection=new ut.Selection(h.range.start.line+u.start.line,u.start.character,h.range.start.line+u.end.line,u.end.character)),S))}}else{if(o===s.length-1)return!1;{let h=s[o+1],v=this.exchangeTextLines(t,c,h.range),S=h.range.end.line-h.range.start.line,b=c.end.line-c.start.line,D=S-b;f=v.then(_=>(_&&(t.selection=new ut.Selection(h.range.start.line+D+u.start.line,u.start.character,h.range.start.line+D+u.end.line,u.end.character)),_))}}return f.then(h=>(h&&d&&(t.selection=new ut.Selection(t.selection.active,t.selection.anchor)),!0))}exchangeTextLines(e,t,n){let i=t.start.line,o=t.end.line,s=n.start.line,a=n.end.line;if(o>=s)throw RangeError(`Above lines must be fully above not ${o} <= ${s}`);let l=new ut.Range(i,0,o,e.document.lineAt(o).range.end.character),c=e.document.getText(l),u=new ut.Range(s,0,a,e.document.lineAt(a).range.end.character),d=e.document.getText(u),f="";if(o+1<s){let S=o+1,b=s-1,D=new ut.Range(S,0,b,e.document.lineAt(b).range.end.character);f=`${e.document.getText(D)}
`}let h=`${d}
${f}${c}`,v=new ut.Range(l.start,u.end);return e.edit(S=>{S.replace(v,h),this.codeLensUpdatedEvent.fire()})}getStartEndCells(e){let t=this.getStartEndCellIndex(e);if(t){let n=this.getCellFromIndex(t[0]),i=this.getCellFromIndex(t[1]);return[n,i]}}getStartEndCellIndex(e){if(!e)return;let t=this.getCellIndex(e.start),n=t;if(e.start.line!==e.end.line&&(n=this.getCellIndex(e.end)),t===-1){if(n===-1)return;{t=0;let i=this.getCellFromIndex(0);if(e.start.line>i.range.start.line)throw RangeError(`Should not be able to pick a range with an end in a cell and start after a cell. ${e.start.line} > ${i.range.end.line}`)}}if(t>=0&&n>=0)return[t,n]}insertCell(e,t){let n=this.getDefaultCellMarker(e.document.uri),i=t>=e.document.lineCount?`
${n}
`:`${n}

`,o=new ut.Position(t,0),s=new ut.Position(t+1,0);e.edit(a=>{a.insert(o,i),this.codeLensUpdatedEvent.fire()}).then(m,m),e.selection=new ut.Selection(s,s)}getDefaultCellMarker(e){return this.configService.getSettings(e).defaultCellMarker||Le.DefaultCodeCellMarker}onCodeLensFactoryUpdated(){this.document&&(this.codeLenses=this.codeLensFactory.createCodeLenses(this.document),this.cells=this.codeLensFactory.getCellRanges(this.document)),this.codeLensUpdatedEvent.fire()}onDocumentClosed(e){this.document&&Mi(e.uri,this.document.uri)&&(this.codeLensUpdatedEvent.dispose(),this.closeDocumentDisposable?.dispose(),this.updateRequiredDisposable?.dispose())}getActiveInteractiveWindow(){return this.interactiveWindowProvider.getOrCreate(this.document?.uri)}async addCode(e,t,n,i,o){let s=!1;try{o?s=await e.debugCode(t,n,i):s=await e.addCode(t,n,i)}catch(a){a instanceof Df||await this.dataScienceErrorHandler.handleError(a)}return s}async runMatchingCell(e,t,n){let i=this.getCurrentCellLens(e.start),o=this.getNextCellLens(e.start);if(i&&this.document){let s=this.document.getText(i.range);if(t){let l=this.documentManager.activeTextEditor,{newCellOnRunLast:c}=this.configService.getSettings(this.document.uri),u=new Ti(this.configService.getSettings(this.document.uri));o?this.advanceToRange(o.range):c&&l&&!u.isEmptyCell(s)&&this.insertCell(l,i.range.end.line+1)}let a=await this.getActiveInteractiveWindow();await this.addCode(a,s,this.document.uri,i.range.start.line,n)}}getCellIndex(e){return this.cells.findIndex(t=>e&&t.range.contains(e))}getCellFromIndex(e){let t=this.cells,n=Ove(e,t.length);return t[n]}getCellFromPosition(e){if(!e){let t=this.documentManager.activeTextEditor;t&&t.selection&&(e=t.selection.active)}if(e){let t=this.getCellIndex(e);if(t>=0)return this.cells[t]}}getCurrentCellLens(e){return this.codeLenses.find(t=>t.range.contains(e)&&t.command!==void 0&&t.command.command===V.RunCell)}getNextCellLens(e){let t=this.codeLenses.findIndex(n=>n.range.contains(e)&&n.command!==void 0&&n.command.command===V.RunCell);if(t>=0)return this.codeLenses.find((n,i)=>n.command!==void 0&&n.command.command===V.RunCell&&i>t)}getPreviousCellLens(e){let t=this.codeLenses.findIndex(n=>n.range.contains(e)&&n.command!==void 0&&n.command.command===V.RunCell);if(t>=1)return this.codeLenses.find((n,i)=>n.command!==void 0&&i<t&&i+1===t)}async runFileAsOneCell(e){if(this.document){let t=await this.getActiveInteractiveWindow(),n=this.document.getText();await this.addCode(t,n,this.document.uri,0,e)}}advanceToRange(e){let t=this.documentManager.activeTextEditor,n=new ut.Selection(e.start,e.start);t&&(t.selection=n,t.revealRange(e,ut.TextEditorRevealType.Default))}};g([sn("DATASCIENCE.DEBUG_CURRENT_CELL")],ir.prototype,"debugCurrentCell",1),g([sn("DATASCIENCE.RUN_ALL_CELLS")],ir.prototype,"runAllCells",1),g([sn("DATASCIENCE.RUN_FILE_INTERACTIVE")],ir.prototype,"runFileInteractive",1),g([sn("DATASCIENCE.DEBUG_FILE_INTERACTIVE")],ir.prototype,"debugFileInteractive",1),g([sn("DATASCIENCE.RUN_ALL_CELLS_ABOVE")],ir.prototype,"runAllCellsAbove",1),g([sn("DATASCIENCE.RUN_CELL_AND_ALL_BELOW")],ir.prototype,"runCellAndAllBelow",1),g([sn("DATASCIENCE.RUN_SELECTION_OR_LINE")],ir.prototype,"runSelectionOrLine",1),g([sn("DATASCIENCE.RUN_TO_LINE")],ir.prototype,"runToLine",1),g([sn("DATASCIENCE.RUN_FROM_LINE")],ir.prototype,"runFromLine",1),g([gi("CodeWatcher::runCell",4)],ir.prototype,"runCell",1),g([sn("DATASCIENCE.DEBUG_CURRENT_CELL")],ir.prototype,"debugCell",1),g([sn("DATASCIENCE.RUN_CURRENT_CELL")],ir.prototype,"runCurrentCell",1),g([sn("DATASCIENCE.RUN_CURRENT_CELL_AND_ADVANCE")],ir.prototype,"runCurrentCellAndAdvance",1),g([yr("DATASCIENCE.RUN_CURRENT_CELL_AND_ADD_BELOW")],ir.prototype,"runCurrentCellAndAddBelow",1),g([yr("DATASCIENCE.RUN_INSERT_CELL_BELOW_POSITION")],ir.prototype,"insertCellBelowPosition",1),g([yr("DATASCIENCE.RUN_INSERT_CELL_BELOW")],ir.prototype,"insertCellBelow",1),g([yr("DATASCIENCE.RUN_INSERT_CELL_ABOVE")],ir.prototype,"insertCellAbove",1),g([yr("DATASCIENCE.RUN_DELETE_CELLS")],ir.prototype,"deleteCells",1),g([yr("DATASCIENCE.RUN_SELECT_CELL")],ir.prototype,"selectCell",1),g([yr("DATASCIENCE.RUN_SELECT_CELL_CONTENTS")],ir.prototype,"selectCellContents",1),g([yr("DATASCIENCE.RUN_EXTEND_SELECTION_BY_CELL_ABOVE")],ir.prototype,"extendSelectionByCellAbove",1),g([yr("DATASCIENCE.RUN_EXTEND_SELECTION_BY_CELL_BELOW")],ir.prototype,"extendSelectionByCellBelow",1),g([yr("DATASCIENCE.RUN_MOVE_CELLS_UP")],ir.prototype,"moveCellsUp",1),g([yr("DATASCIENCE.RUN_MOVE_CELLS_DOWN")],ir.prototype,"moveCellsDown",1),g([yr("DATASCIENCE.RUN_CHANGE_CELL_TO_MARKDOWN")],ir.prototype,"changeCellToMarkdown",1),g([yr("DATASCIENCE.RUN_CHANGE_CELL_TO_CODE")],ir.prototype,"changeCellToCode",1),g([yr("DATASCIENCE.GOTO_NEXT_CELL_IN_FILE")],ir.prototype,"gotoNextCell",1),g([yr("DATASCIENCE.GOTO_PREV_CELL_IN_FILE")],ir.prototype,"gotoPreviousCell",1),ir=g([(0,Du.injectable)(),p(0,(0,Du.inject)(Gi)),p(1,(0,Du.inject)(se)),p(2,(0,Du.inject)(lr)),p(3,(0,Du.inject)(qP)),p(4,(0,Du.inject)(an)),p(5,(0,Du.inject)(f0))],ir);var Tf=k(A()),Tu=k(require("vscode"));var Jb=class{constructor(e,t,n,i){this.documentManager=e;this.configuration=n;this.extensionChecker=i;this.computeDecorations(),t.push(this),t.push(this.configuration.getSettings(void 0).onDidChange(this.settingsChanged,this)),t.push(this.documentManager.onDidChangeActiveTextEditor(this.changedEditor,this)),t.push(this.documentManager.onDidChangeTextEditorSelection(this.changedSelection,this)),t.push(this.documentManager.onDidChangeTextDocument(this.changedDocument,this)),this.settingsChanged()}activate(){}dispose(){this.timer&&clearTimeout(this.timer)}settingsChanged(){this.documentManager.activeTextEditor&&this.triggerUpdate(this.documentManager.activeTextEditor)}changedEditor(){this.triggerUpdate(void 0)}changedDocument(e){this.documentManager.activeTextEditor&&e.document===this.documentManager.activeTextEditor.document&&this.triggerUpdate(this.documentManager.activeTextEditor)}changedSelection(e){e.textEditor&&e.textEditor.selection.anchor&&this.triggerUpdate(e.textEditor)}triggerUpdate(e){this.timer&&clearTimeout(this.timer),this.timer=setTimeout(()=>this.update(e),100)}computeDecorations(){this.currentCellTopUnfocused=this.documentManager.createTextEditorDecorationType({borderColor:new Tu.ThemeColor("interactive.inactiveCodeBorder"),borderWidth:"2px 0px 0px 0px",borderStyle:"solid",isWholeLine:!0}),this.currentCellBottomUnfocused=this.documentManager.createTextEditorDecorationType({borderColor:new Tu.ThemeColor("interactive.inactiveCodeBorder"),borderWidth:"0px 0px 1px 0px",borderStyle:"solid",isWholeLine:!0}),this.currentCellTop=this.documentManager.createTextEditorDecorationType({borderColor:new Tu.ThemeColor("interactive.activeCodeBorder"),borderWidth:"2px 0px 0px 0px",borderStyle:"solid",isWholeLine:!0}),this.currentCellBottom=this.documentManager.createTextEditorDecorationType({borderColor:new Tu.ThemeColor("interactive.activeCodeBorder"),borderWidth:"0px 0px 1px 0px",borderStyle:"solid",isWholeLine:!0})}cellDecorationEnabled(e){return e.decorateCells===!1?!1:e.decorateCells==="currentCell"||e.decorateCells==="allCells"}update(e){let t=e===void 0?this.documentManager.visibleTextEditors:[e];for(let n of t)if(n&&n.document&&n.document.languageId===xe&&!mp(n.document)&&this.currentCellTop&&this.currentCellBottom&&this.currentCellTopUnfocused&&this.currentCellBottomUnfocused&&this.extensionChecker.isPythonExtensionInstalled){let i=this.configuration.getSettings(n.document.uri);if(this.cellDecorationEnabled(i)){let o=YC(n.document,i),s=o.map(u=>u.range).filter(u=>u.contains(n.selection.anchor)),a=s.length>0?[new Tu.Range(s[0].start,s[0].start)]:[],l=i.decorateCells!=="allCells"&&s.length>0?[new Tu.Range(s[0].end,s[0].end)]:[],c=[];i.decorateCells==="allCells"&&o.forEach(u=>{let d=u.range.start;d!==s[0].start&&c.push(new Tu.Range(d,d))}),this.documentManager.activeTextEditor===n?(n.setDecorations(this.currentCellTop,a),n.setDecorations(this.currentCellBottom,l),n.setDecorations(this.currentCellTopUnfocused,c),n.setDecorations(this.currentCellBottomUnfocused,[])):(n.setDecorations(this.currentCellTop,[]),n.setDecorations(this.currentCellBottom,[]),n.setDecorations(this.currentCellTopUnfocused,[...c,...a]),n.setDecorations(this.currentCellBottomUnfocused,l))}else n.setDecorations(this.currentCellTop,[]),n.setDecorations(this.currentCellBottom,[]),n.setDecorations(this.currentCellTopUnfocused,[]),n.setDecorations(this.currentCellBottomUnfocused,[])}}};Jb=g([(0,Tf.injectable)(),p(0,(0,Tf.inject)(lr)),p(1,(0,Tf.inject)(O)),p(2,(0,Tf.inject)(se)),p(3,(0,Tf.inject)(ze))],Jb);var E0=k(A());var C0=class{constructor(){this.codeGeneratorsByFile=new Bs}clear(){this.codeGeneratorsByFile.clear()}get all(){return[...this.codeGeneratorsByFile.entries()].map(e=>({uri:e[0],generatedCodes:e[1].filter(t=>!t.deleted)})).filter(e=>e.generatedCodes.length>0)}getFileGeneratedCode(e){return this.codeGeneratorsByFile.get(e)||[]}store(e,t){let n=this.codeGeneratorsByFile.get(e)||[],i=!1;for(let o=0;o<n.length&&!i;o+=1){let s=n[o];t.line>=s.line&&t.line<=s.endLine?(n.splice(o,1,t),i=!0):s.line>t.line&&(n.splice(o,0,t),i=!0)}i||n.push(t),this.codeGeneratorsByFile.set(e,n)}};var $b=class{constructor(e){this.notebook=e;this.storages=new WeakMap}getOrCreate(e){return this.storages.has(e)||this.storages.set(e,new C0),this.storages.get(e)}get(e){if("notebook"in e)return this.storages.get(e.notebook);{let t=this.notebook.notebookDocuments.find(n=>this.storages.get(n)?.all.find(o=>o.uri.toString()===e.fileUri.toString()));return t?this.storages.get(t):void 0}}};$b=g([(0,E0.injectable)(),p(0,(0,E0.inject)(qe))],$b);var yc=k(A()),w0=k(require("vscode"));var Hb=class{constructor(e,t,n,i,o){this.variableProvider=e;this.interactiveProvider=t;this.notebook=n;this.disposables=i;this.kernelProvider=o;this.runFiles=new Set;this.stopWatch=new $e}activate(){this.notebook.onDidChangeNotebookCellExecutionState(this.onDidChangeNotebookCellExecutionState,this,this.disposables),this.kernelProvider.onDidRestartKernel(()=>this.runFiles.clear(),this,this.disposables)}dispose(){this.hoverProviderRegistration&&this.hoverProviderRegistration.dispose()}async onDidChangeNotebookCellExecutionState(e){try{if(e.cell.notebook.notebookType!==wt)return;let t=this.runFiles.size,n=ds(e.cell);n!==void 0&&this.runFiles.add(n.interactive.uristring),t!==this.runFiles.size&&await this.initializeHoverProvider()}catch(t){C(t)}}async provideHover(e,t,n){this.stopWatch.reset();let i=await Dr(300,this.getVariableHover(e,t,n));return R("DS_INTERNAL.INTERACTIVE_FILE_TOOLTIPS_PERF",{duration:this.stopWatch.elapsedTime},{isResultNull:!!i}),i}async initializeHoverProvider(){this.hoverProviderRegistration||(this.hoverProviderRegistration=w0.languages.registerHoverProvider(nW,this))}async getVariableHover(e,t,n){let i=e.getWordRangeAtPosition(t);if(i){let o=e.getText(i);if(o){let s=this.getMatchingKernels(e);if(s.length){let a=await Gt(n,{},...s.map(c=>this.variableProvider.getVariableProperties(o,c,n))),l=Object.entries(a||{});if(l.length>0){let c=l.reduce((d,f)=>d+`${f[0]}: ${f[1]}
`,"```\n")+"```";return{contents:[new w0.MarkdownString(c)]}}}}}}getMatchingKernels(e){let t=this.interactiveProvider.get(e.uri)?.notebookUri;if(!t)return[];let n=new Set;return this.notebook.notebookDocuments.filter(i=>t?.toString()===i.uri.toString()).forEach(i=>{let o=this.kernelProvider.get(i);o&&n.add(o)}),Array.from(n)}};Hb=g([(0,yc.injectable)(),p(0,(0,yc.inject)(pi)),p(0,(0,yc.named)(Le.KERNEL_VARIABLES)),p(1,(0,yc.inject)(Gi)),p(2,(0,yc.inject)(qe)),p(3,(0,yc.inject)(O)),p(4,(0,yc.inject)(Ke))],Hb);var zi=k(A()),jn=require("vscode");var wr=require("vscode");var xG=k(po());var _f=class{constructor(e,t,n,i,o){this.serviceContainer=e;this._owner=t;this.controllerFactory=n;this.inputUri=o;this._onDidChangeViewState=new wr.EventEmitter;this.closedEvent=new wr.EventEmitter;this._submitters=[];this.internalDisposables=[];this.documentManager=this.serviceContainer.get(lr),this.commandManager=this.serviceContainer.get(Fe),this.fs=this.serviceContainer.get(Ze),this.configuration=this.serviceContainer.get(se),this.jupyterExporter=this.serviceContainer.get(wh),this.workspaceService=this.serviceContainer.get(ce),this.exportDialog=this.serviceContainer.get(Hi),this.interactiveWindowDebugger=this.serviceContainer.tryGet(h0),this.errorHandler=this.serviceContainer.get(an),this.codeGeneratorFactory=this.serviceContainer.get(Ub),this.storageFactory=this.serviceContainer.get(na),this.kernelProvider=this.serviceContainer.get(Ke),this.debuggingManager=this.serviceContainer.get(v0),this.isWebExtension=this.serviceContainer.get(on),this.notebookUri=kf(i)?i.input.uri:i.notebook.uri,this._owner&&this._submitters.push(this._owner),wr.window.onDidChangeActiveNotebookEditor(s=>{s?.notebook.uri.toString()===this.notebookUri.toString()&&this._onDidChangeViewState.fire()},this.internalDisposables),wr.workspace.onDidCloseNotebookDocument(s=>{s.uri.toString()===this.notebookUri.toString()&&this.closedEvent.fire()},this.internalDisposables),wr.window.activeNotebookEditor?.notebook.uri.toString()===this.notebookUri.toString()&&this._onDidChangeViewState.fire(),this.cellMatcher=new Ti(this.configuration.getSettings(this.owningResource)),this.notebookDocument&&this.codeGeneratorFactory.getOrCreate(this.notebookDocument)}get onDidChangeViewState(){return this._onDidChangeViewState.event}get closed(){return this.closedEvent.event}get owner(){return this._owner}get submitters(){return this._submitters}get notebookDocument(){return this._notebookDocument||(this._notebookDocument=wr.workspace.notebookDocuments.find(e=>e.uri.toString()===this.notebookUri.toString())),this._notebookDocument}get kernelConnectionMetadata(){return this.controller?.metadata}notifyConnectionReset(){if(this.notebookDocument)this.controller||(this.controller=this.initController(this.notebookDocument)),this.controller.setInfoMessageCell(y.noKernelConnected);else{let e=wr.workspace.onDidOpenNotebookDocument(t=>{t.uri.toString()===this.notebookUri.toString()&&(this._notebookDocument=t,this.controller=this.initController(t),this.internalDisposables.push(this.controller.listenForControllerSelection()),this.controller.setInfoMessageCell(y.noKernelConnected),e.dispose())})}}initController(e){let t=this.controllerFactory.create(e,this.errorHandler,this.kernelProvider,this._owner);return this.internalDisposables.push(t.listenForControllerSelection()),t}async ensureInitialized(){if(!this.notebookDocument&&(w("Showing Interactive editor to initialize codeGenerator from notebook document"),await this.showInteractiveEditor(),!this.notebookDocument))throw new Error("Could not open notebook document for Interactive Window");this.codeGeneratorFactory.get(this.notebookDocument)||this.codeGeneratorFactory.getOrCreate(this.notebookDocument),this.controller||(this.controller=this.initController(this.notebookDocument)),this.controller.controller?this.controller.startKernel().catch(m):(H("No controller selected for Interactive Window initilization"),this.controller.setInfoMessageCell(y.selectKernelForEditor))}async showInteractiveEditor(){let e;wr.window.tabGroups.all.find(i=>{i.tabs.find(o=>{kf(o)&&o.input.uri.toString()==this.notebookUri.toString()&&(e=o)})});let t=this.notebookDocument||await this.openNotebookDocument();return await wr.window.showNotebookDocument(t,{preserveFocus:!0,viewColumn:e?.group.viewColumn})}async openNotebookDocument(){return w(`Opening notebook document ${this.notebookUri}`),await wr.workspace.openNotebookDocument(this.notebookUri)}dispose(){this.internalDisposables.forEach(e=>e.dispose()),this.controller?.disconnect()}async showErrorForCell(e,t){let n=this.controller?.controller,i=Fh(e);if(n&&i&&t){let o=Bo.getOrCreate(t,new hf(n));try{await o.appendOutput(i)}catch(s){J(`Could not append error message "${i}" to cell: ${s}`)}finally{o.end(!1,t.executionSummary?.timing?.endTime)}}else H(`Could not append error message to cell "${i}"`)}changeMode(e){this.controller?.updateMode(e)}async addCode(e,t,n){return this.submitCode(e,t,n,!1)}useNewDebugMode(){return!!(this.configuration.getSettings(this.owner).forceIPyKernelDebugger||this.controller?.metadata&&!mt(this.controller.metadata))}async debugCode(e,t,n){let i=!0,o=this.documentManager.textDocuments.find(a=>this.fs.arePathsSame(a.uri,t));if(!this.useNewDebugMode()&&o&&o.isUntitled){let a=[...this.documentManager.textDocuments];if(i=await o.save(),i){let l=this.documentManager.textDocuments.filter(c=>a.indexOf(c)===-1);l&&l.length>0&&(t=(l.find(u=>u.languageId==="python")||l.find(u=>!u.fileName.endsWith(".interactive"))||l[0]).uri,await this.documentManager.openTextDocument(t))}}let s=!0;return i?this.submitCode(e,t,n,!0):s}async submitCode(e,t,n,i){if(this.cellMatcher.isEmptyCell(e)||!this.controller?.controller)return!0;this.updateOwners(t);let o=je(e,{trim:!1}),s=new Ti(this.configuration.getSettings(t)),a=-1;s.isMarkdown(o[0])&&am(o,(u,d)=>void 0,(u,d)=>{u&&u.length>0&&a===-1&&(a=d)});let c=(a>0?[o.slice(0,a).join(`
`),o.slice(a).join(`
`)]:[e]).map(u=>{let d=pe();this.controller.setPendingCellAdd(d.promise);let f=this.addNotebookCell(u,t,n),h=this.createExecutionPromise(f,i);return h.catch(v=>{v instanceof Df?f.then(S=>{v.cell!==S&&this.showErrorForCell(y.cellStopOnErrorMessage,S).then(m,m)}).catch(m):f.then(S=>this.errorHandler.getErrorMessageForDisplayInCell(v,"execution",this.owningResource).then(b=>this.showErrorForCell(b,S))).catch(m)}).finally(()=>{d?.resolve()}),h});return c[c.length-1]}async createExecutionPromise(e,t){if(!this.controller||!this.notebookDocument)return!1;te("InteractiveWindow.ts.createExecutionPromise.start");let n=this.controller.startKernel(),i=await e,o=!0,s=async()=>void 0;try{let a=await n;await this.generateCodeAndAddMetadata(i,t,a),t&&this.useNewDebugMode()?await this.debuggingManager.start(this.notebookDocument,i):t&&mt(a.kernelConnectionMetadata)&&this.interactiveWindowDebugger&&(s=async()=>this.interactiveWindowDebugger?.detach(a),await this.interactiveWindowDebugger.attach(a),await this.interactiveWindowDebugger.updateSourceMaps(this.storageFactory.get({notebook:i.notebook})?.all||[]),this.interactiveWindowDebugger.enable(a)),te("InteractiveWindow.ts.createExecutionPromise.kernel.executeCell");let l=ds(i);o=await this.kernelProvider.getKernelExecution(a).executeCell(i,l?.generatedCode?.code)!=="Error",te("InteractiveWindow.ts.createExecutionPromise.kernel.executeCell.finished")}finally{await s(),te("InteractiveWindow.ts.createExecutionPromise.end")}if(!o)throw new Df(i);return o}async expandAllCells(){this.notebookDocument&&await Promise.all(this.notebookDocument.getCells().map(async(e,t)=>{await this.commandManager.executeCommand("notebook.cell.expandCellInput",{ranges:[{start:t,end:t+1}],document:this.notebookUri})}))}async collapseAllCells(){this.notebookDocument&&await Promise.all(this.notebookDocument.getCells().map(async(e,t)=>{e.kind===wr.NotebookCellKind.Code&&await this.commandManager.executeCommand("notebook.cell.collapseCellInput",{ranges:[{start:t,end:t+1}],document:this.notebookUri})}))}async scrollToCell(e){let t=await this.showInteractiveEditor(),n=t.notebook.getCells().find(i=>ds(i)?.id===e);if(n){let i=new wr.NotebookRange(n.index,n.index+1);t.revealRange(i,wr.NotebookEditorRevealType.Default),t.selection=i}}async hasCell(e){let t=this.notebookDocument;return!!t&&t.getCells().some(n=>ds(n)?.id===e)}get owningResource(){if(this.owner)return this.owner;let e=this.workspaceService.rootFolder;if(e)return e}updateOwners(e){this._owner||(this._owner=e,this.controller?.updateOwners(e)),this._submitters.find(t=>t.toString()==e.toString())||this._submitters.push(e)}async addNotebookCell(e,t,n){let i=this.notebookDocument;if(!i)throw new Error("No notebook document");let o=this.configuration.getSettings(this.owningResource),s=this.cellMatcher.getCellType(e)===PS,a=s?ck(je(e)).join(""):IG(e,o,this.cellMatcher),l=this.cellMatcher.getFirstMarker(e),c=wr.workspace.textDocuments.find(v=>v.uri.toString()===this.owner?.toString())?.languageId??xe,u=new wr.NotebookCellData(s?wr.NotebookCellKind.Markup:wr.NotebookCellKind.Code,a,s?PS:c),d={uristring:t.toString(),lineIndex:n,originalSource:e},f={interactiveWindowCellMarker:l,interactive:d,id:(0,xG.default)()};u.metadata=f,await ra(i,v=>{let S=wr.NotebookEdit.insertCells(i.cellCount,[u]);v.set(i.uri,[S])});let h=i.cellCount-1;return i.cellAt(h)}async generateCodeAndAddMetadata(e,t,n){let i=ds(e);if(!i)return;let o=!mt(n.kernelConnectionMetadata)||this.configuration.getSettings(void 0).forceIPyKernelDebugger,s=await this.codeGeneratorFactory.getOrCreate(this.notebookDocument).generateCode(i,e.index,t,o),a={...i,generatedCode:s},l=new wr.WorkspaceEdit,c=wr.NotebookEdit.updateCellMetadata(e.index,a);l.set(e.notebook.uri,[c]),await wr.workspace.applyEdit(l)}async export(){if(!this.notebookDocument)throw new Error("no notebook to export.");let{magicCommandsAsComments:e}=this.configuration.getSettings(this.owningResource),t=bG(this.notebookDocument,e);if(t&&this.exportDialog){let n=await this.exportDialog.showDialog("ipynb",this.owningResource);n&&await this.jupyterExporter?.exportToFile(t,we(n))}}async exportAs(){if(await this.ensureInitialized(),!this.controller)throw new Error("An active kernel is required to export the notebook.");let e=this.controller.kernel?.value;e&&await fk({},e.kernelConnectionMetadata);let n;if(this.submitters&&this.submitters.length){let i=this.submitters[this.submitters.length-1];n=Te(i.path,Zi(i.path))}this.isWebExtension?this.commandManager.executeCommand(V.ExportAsPythonScript,this.notebookDocument,e?.kernelConnectionMetadata.interpreter).then(m,m):this.commandManager.executeCommand(V.Export,this.notebookDocument,n,e?.kernelConnectionMetadata.interpreter).then(m,m)}};g([OR()],_f.prototype,"showErrorForCell",1),g([OR()],_f.prototype,"createExecutionPromise",1);function CG(r){return y.interactiveWindowTitleFormat(Te(r.path))}var zF=class{constructor(e,t,n,i,o,s,a){this.controllerService=e;this.mode=t;this.notebook=n;this.errorHandler=i;this.kernelProvider=o;this.owner=s;this.disposables=[];this.controller=a?.controller,this.metadata=a?.connection}updateMode(e){this.mode=e}updateOwners(e){this.owner=e}async startKernel(){if(this.connectingListener?.dispose(),this.kernel)return this.kernel.promise;if(!this.controller||!this.metadata)throw new Error("Interactive Window kernel not selected");this.setInfoMessage(this.metadata,0);try{let e=await this.createKernel(),t=async()=>{this.notebook&&this.metadata&&(this.systemInfoCell=void 0,this.setInfoMessage(this.metadata,1))};return this.disposables.push(e.addHook("willRestart",t)),e.onRestarted(async()=>{w("Restart event handled in IW"),this.fileInKernel=void 0;try{await this.setFileInKernel(e)}catch{C("Failed to run initialization after restarting")}finally{this.finishSysInfoMessage(e,1)}},this,this.disposables),this.fileInKernel=void 0,await this.setFileInKernel(e),this.finishSysInfoMessage(e,0),e}catch(e){throw this.owner?this.deleteSysInfoCell():await this.finishSysInfoWithFailureMessage(e),e}}async createKernel(){if(this.kernel)return this.kernel.promise;if(!this.controller||!this.metadata)throw new Error("Controller not selected");let e=pe();e.promise.catch(m),this.kernel=e;try{let{kernel:t,actualController:n}=await this.controllerService.createKernel(this.metadata,this.controller,this.owner,this.notebook,this.disposables);return this.metadata=t.kernelConnectionMetadata,this.controller=n,this.disposables.push(t),e.resolve(t),t}catch(t){throw e.reject(t),this.disconnect(),t}}async setFileInKernel(e){let t=this.owner;if(!t){te("Unable to run initialization for IW");return}let n=we(t),i=this.kernelProvider.getKernelExecution(e);this.mode==="perFile"&&!this.fileInKernel?(w(`Initializing __file__ in setFileInKernel with ${t} for mode ${this.mode}`),this.fileInKernel=t,await i.executeHidden(`__file__ = '${n.replace(/\\/g,"\\\\")}'`)):(!this.fileInKernel||this.fileInKernel.toString()!==t.toString())&&this.mode!=="perFile"?(w(`Initializing __file__ in setFileInKernel with ${t} for mode ${this.mode}`),this.fileInKernel=t,await i.executeHidden(`__file__ = '${n.replace(/\\/g,"\\\\")}'`)):w(`Not Initializing __file__ in setFileInKernel with ${n} for mode ${this.mode} currently ${this.fileInKernel}`)}setPendingCellAdd(e){this.metadata&&this.notebook&&this.controllerService.getRegisteredController(this.metadata)?.setPendingCellAddition(this.notebook,e)}listenForControllerSelection(){return this.controllerService.onControllerSelected(e=>{if(!(!this.notebook||e.notebook.uri.toString()!==this.notebook?.uri?.toString())&&e.controller.id!==this.controller?.id){let t=!!this.kernel;this.disconnect(),this.controller=e.controller.controller,this.metadata=e.controller.connection,t?this.startKernel().catch(m):(this.connectingListener?.dispose(),this.connectingListener=e.controller.onConnecting(()=>{this.startKernel().catch(m)}),this.disposables.push(this.connectingListener))}},this)}setInfoMessageCell(e){this.systemInfoCell?this.systemInfoCell.updateMessage(e).catch(t=>J(`could not update info cell with message: "${e}", error: ${t}`)):this.systemInfoCell=new I0(this.notebook,e)}setInfoMessage(e,t){let n=fG(e,t);this.setInfoMessageCell(n)}finishSysInfoMessage(e,t){let n=hG(e.kernelConnectionMetadata,t);this.systemInfoCell?.updateMessage(n).catch(i=>J(`System info message was not updated: "${n}" because of error: ${i}`)),this.systemInfoCell=void 0}async finishSysInfoWithFailureMessage(e){let t=await this.errorHandler.getErrorMessageForDisplayInCell(e,"start",this.owner);t=t.split(`
`).join(`  
`),this.systemInfoCell?.updateMessage(t).catch(n=>J(`System info message was not updated: "${t}" because of error: ${n}`)),this.systemInfoCell=void 0}deleteSysInfoCell(){this.systemInfoCell?.deleteCell().then(m,m),this.systemInfoCell=void 0}disconnect(){this.disposables.forEach(e=>e.dispose()),this.disposables=[],this.kernel=void 0}},XC=class{constructor(e,t,n){this.controllerService=e;this.mode=t;this.initialController=n}create(e,t,n,i){let o=this.initialController,s=this.controllerService.getSelectedController(e);return s&&(o=s),new zF(this.controllerService,this.mode,e,t,n,i,o)}};var EG="ds_asked_per_file_interactive",wG="ds_interactive_window_cache",Gb=class{constructor(e,t,n,i,o,s,a,l,c,u){this.serviceContainer=e;this.disposables=t;this.fs=n;this.configService=i;this.globalMemento=o;this.workspaceMemento=s;this.appShell=a;this.workspaceService=l;this.notebookEditorProvider=c;this.controllerHelper=u;this._onDidChangeActiveInteractiveWindow=new jn.EventEmitter;this._windows=[];this.notebookEditorProvider.registerEmbedNotebookProvider(this),this.restoreWindows()}get onDidChangeActiveInteractiveWindow(){return this._onDidChangeActiveInteractiveWindow.event}get activeWindow(){let e=jn.window.activeNotebookEditor?.notebook.uri.toString();return e?this._windows.find(t=>t.notebookUri?.toString()===e):void 0}restoreWindows(){let e=new Map;jn.window.tabGroups.all.forEach(t=>{t.tabs.forEach(n=>{kf(n)&&n.input.uri&&e.set(n.input.uri.toString(),n)})}),this.workspaceMemento.get(wG,[]).forEach(t=>{if(!t.uriString||!e.get(t.uriString))return;let n=e.get(t.uriString);if(!n)return;let i=this.configService.getSettings(n.input.uri).interactiveWindowMode,o=new _f(this.serviceContainer,jn.Uri.parse(t.owner),new XC(this.controllerHelper,i),n,jn.Uri.parse(t.inputBoxUriString));o.notifyConnectionReset(),this._windows.push(o),R("DS_INTERNAL.CREATED_INTERACTIVE_WINDOW",{windowCount:this._windows.length},{hasKernel:!1,hasOwner:!!t.owner,mode:i,restored:!0});let s=o.closed(this.onInteractiveWindowClosed.bind(this,o));this.disposables.push(o),this.disposables.push(s),this.disposables.push(o.onDidChangeViewState(this.raiseOnDidChangeActiveInteractiveWindow.bind(this)))}),this._updateWindowCache()}async getOrCreate(e,t){if(!this.workspaceService.isTrusted)throw new Error("Workspace not trusted");let n=await this.getInteractiveMode(e);this.pendingCreations&&await this.pendingCreations.catch(m);let i=this.getExisting(e,n,t);return i||(i=await this.create(e,n,t)),await i.ensureInitialized(),i}get(e){let t=this.configService.getSettings(e).interactiveWindowMode;return this.getExisting(e,t)}async create(e,t,n){let i=pe();this.pendingCreations=i.promise;try{let o=await this.controllerHelper.getInitialController(e,n);H(`Starting interactive window for resource '${W(e)}' with controller '${o?.id}'`);let s=this.serviceContainer.get(Fe),[a,l]=await this.createEditor(o,e,t,s);o&&o.controller.updateNotebookAffinity(l.notebook,jn.NotebookControllerAffinity.Preferred),w(`Interactive Window Editor Created: ${l.notebook.uri.toString()} with input box: ${a.toString()}`);let c=new _f(this.serviceContainer,e,new XC(this.controllerHelper,t,o),l,a);this._windows.push(c),R("DS_INTERNAL.CREATED_INTERACTIVE_WINDOW",{windowCount:this._windows.length},{hasKernel:!!o,hasOwner:!!e,mode:t,restored:!1}),this._updateWindowCache(),this.lastActiveInteractiveWindow=c;let u=c.closed(this.onInteractiveWindowClosed.bind(this,c));return this.disposables.push(c),this.disposables.push(u),this.disposables.push(c.onDidChangeViewState(this.raiseOnDidChangeActiveInteractiveWindow.bind(this))),c}finally{i.resolve()}}async createEditor(e,t,n,i){let o=e?`${bt}/${e.id}`:void 0,s=t!==void 0,a=this.getInteractiveViewColumn(t),{inputUri:l,notebookEditor:c}=await i.executeCommand("interactive.open",{viewColumn:a,preserveFocus:s},void 0,o,t&&n==="perFile"?CG(t):void 0);if(!c)throw new Error("Failed to request creation of interactive window from VS Code.");return[l,c]}getInteractiveViewColumn(e){if(e)return jn.ViewColumn.Beside;let t=this.configService.getSettings(e).interactiveWindowViewColumn;return t==="secondGroup"?jn.ViewColumn.One:t==="active"?jn.ViewColumn.Active:jn.ViewColumn.Beside}async getInteractiveMode(e){let t=this.configService.getSettings(e).interactiveWindowMode;if(t==="multiple"&&e&&!this.globalMemento.get(EG)&&this._windows.length===1&&(!this._windows[0].owner||!this.fs.arePathsSame(this._windows[0].owner,e))){this.globalMemento.update(EG,!0).then(m,m);let n=[y.interactiveWindowModeBannerSwitchYes,y.interactiveWindowModeBannerSwitchNo];await this.appShell.showInformationMessage(y.interactiveWindowModeBannerTitle,...n)===n[0]&&(t="perFile",this._windows[0].changeMode(t),await this.configService.updateSetting("interactiveWindow.creationMode",t,e,jn.ConfigurationTarget.Global))}return t}_updateWindowCache(){let e=this._windows.map(t=>({owner:t.owner?.toString(),uriString:t.notebookUri.toString(),inputBoxUriString:t.inputUri.toString()}));this.workspaceMemento.update(wG,e).then(m,m)}getExisting(e,t,n){return t==="single"?this._windows.length>0?this._windows[0]:void 0:t==="multiple"?e?this.activeWindow||this.lastActiveInteractiveWindow||this._windows[0]:void 0:this._windows.find(i=>!e&&!i.owner&&!n?!0:e&&i.owner&&this.fs.arePathsSame(e,i.owner)?!n||i.kernelConnectionMetadata?.id===n.id:!1)}raiseOnDidChangeActiveInteractiveWindow(){this.lastActiveInteractiveWindow=this.activeWindow?this.activeWindow:this.lastActiveInteractiveWindow,this._onDidChangeActiveInteractiveWindow.fire(this.activeWindow)}onInteractiveWindowClosed(e){w(`Closing interactive window: ${e.notebookUri?.toString()}`),e.dispose(),this._windows=this._windows.filter(t=>t!==e),this._updateWindowCache(),this.lastActiveInteractiveWindow===e&&(this.lastActiveInteractiveWindow=this._windows[0]),this.raiseOnDidChangeActiveInteractiveWindow()}getActiveOrAssociatedInteractiveWindow(){if(this.activeWindow)return this.activeWindow;if(jn.window.activeTextEditor===void 0)return;let e=jn.window.activeTextEditor.document.uri;if(e.scheme!==el)return this.get(e)}findNotebookEditor(e){let t;if(e&&e.path.endsWith(".interactive"))t=this.get(e)?.notebookDocument;else{let n=this.configService.getSettings(e).interactiveWindowMode;t=this.getExisting(e,n)?.notebookDocument}return t?jn.window.visibleNotebookEditors.find(n=>n.notebook===t):void 0}findAssociatedNotebookDocument(e){return this._windows.find(i=>i.inputUri?.toString()===e.toString())?.notebookDocument}getInteractiveWindowWithNotebook(e){let t;return e!==void 0?t=this._windows.find(n=>n.notebookUri?.toString()===e.toString()):t=this.getActiveOrAssociatedInteractiveWindow(),t}getInteractiveWindowsWithSubmitter(e){return this._windows.filter(t=>t.submitters.find(n=>this.fs.arePathsSame(e,n)))}};Gb=g([(0,zi.injectable)(),p(0,(0,zi.inject)(ct)),p(1,(0,zi.inject)(O)),p(2,(0,zi.inject)(Ze)),p(3,(0,zi.inject)(se)),p(4,(0,zi.inject)(He)),p(4,(0,zi.named)(It)),p(5,(0,zi.inject)(He)),p(5,(0,zi.named)(vi)),p(6,(0,zi.inject)(ue)),p(7,(0,zi.inject)(ce)),p(8,(0,zi.inject)(Tn)),p(9,(0,zi.inject)(g0))],Gb);var wd=k(A());var zb=class{constructor(e,t,n,i,o){this.kernelProvider=e;this.codeGeneratorFactory=n;this.storageFactory=i;this.controllers=o;this.disposables=[];t.push(this)}dispose(){G(this.disposables)}activate(){this.kernelProvider.onDidCreateKernel(this.onDidCreateKernel,this,this.disposables),this.controllers.onControllerSelected(this.onNotebookControllerSelected,this,this.disposables)}onNotebookControllerSelected({notebook:e}){this.storageFactory.get({notebook:e})?.clear(),this.codeGeneratorFactory.get(e)?.reset()}onDidCreateKernel(e){let t=e.notebook;e.creator!=="jupyterExtension"||t.notebookType!==wt||(this.storageFactory.get({notebook:t})?.clear(),e.onRestarted(()=>{this.storageFactory.get({notebook:t})?.clear(),this.codeGeneratorFactory.getOrCreate(t).reset()},this,this.disposables))}};zb=g([(0,wd.injectable)(),p(0,(0,wd.inject)(Ke)),p(1,(0,wd.inject)(O)),p(2,(0,wd.inject)(Ub)),p(3,(0,wd.inject)(na)),p(4,(0,wd.inject)(xt))],zb);var eE=k(A()),az=require("vscode");var sz=oz(),P0=/(;32m[ ->]*?)(\d+)(.*)/g,Qb=class{constructor(e,t){this.storageFactory=e;this.platformService=t}format(e,t){if(e.notebook.notebookType!==wt)return t;let n=this.storageFactory.get({notebook:e.notebook}),i=t.some(o=>/^[Input|Cell|File].*?\n.*/.test(o));return!i&&!n?t:t.map(o=>i?this.modifyTracebackFrameIPython8(o,n?.all):this.modifyTracebackFrameIPython7(o,n.all))}modifyTracebackFrameIPython8(e,t){e=e.replace(/\u001b\[4\dm/g,""),e=e.replace(/\u001b\[38;.*?\d+m/g,"\x1B[39m"),e=e.replace(/(;32m[ ->]*?)(\d+)(.*)\n/g,(l,c,u,d)=>(d=d.replace(/\u001b\[3\d+m/g,"\x1B[39m"),`${c}${u}${d}
`)),te(`Trace frame to match: ${e}`);let n,i,o=/^Input.*?\[.*32mIn\s+\[(\d+).*?0;36m(.*?)\n.*/.exec(e),s=/^Cell.*?\[.*32mIn\s*\[(\d+)\], (.*).\[0m\n/.exec(e);if(o&&o.length>1?(n=parseInt(o[1]),i=o[2]):s&&s.length>1&&(n=parseInt(s[1]),i=s[2]),t&&n){let l,c;for(let u of t)if(c=u.generatedCodes.find(d=>d.executionCount===n),c){l=u.uri;break}if(c&&l)return e.replace(P0,(d,f,h,v)=>{let S=parseInt(h,10),_=(c.hasCellMarker?c.line-1:c.line)-1+c.lineOffsetRelativeToIndexOfFirstLineInCell+S;return`${f}<a href='${l?.toString()}?line=${_-1}'>${_}</a>${v}`}).replace(/.*?\n/,`\x1B[1;32m${we(l)}\x1B[0m in \x1B[0;36m${i}
`)}let a=/^File.*?\[\d;32m(.*):\d+.*\u001b.*\n/.exec(e);if(a&&a.length>1){let l=fh(a[1],we(this.platformService.homeDir)),c=az.Uri.file(l);return e.replace(P0,(u,d,f,h)=>{let v=parseInt(f,10);return`${d}<a href='${c?.toString()}?line=${v-1}'>${v}</a>${h}`})}return e}modifyTracebackFrameIPython7(e,t){return t.map(i=>i.uri).forEach(i=>{let o=we(i),s=W(i),a=this.storageFactory.get({fileUri:i});if(a){if(e.includes(o)&&new RegExp(`\\[.*?;32m${sz(o)}`).test(e)||e.includes(s)&&new RegExp(`\\[.*?;32m${sz(s)}`).test(e)){let l="",c=/(;32m[ ->]*?)(\d+)(.*)/g;for(let d=c.exec(e);d&&d.length>3;d=c.exec(e)){let f=sc(d[3]).substr(1);l=`${l}${f}
`}let u=this.findCellOffset(a.getFileGeneratedCode(i),l);u!==void 0&&(e=e.replace(P0,(d,f,h,v)=>{let S=parseInt(h,10),b=u+S-1;return`${f}<a href='${i.toString()}?line=${b}'>${b+1}</a>${v}`}))}if(e.includes(o)){let l=this.findCellOffset(a.getFileGeneratedCode(i),e);if(l)return e.replace(P0,(c,u,d,f)=>{let h=parseInt(d,10),v=l+h-1;return`${u}<a href='${i.toString()}?line=${v}'>${v+1}</a>${f}`})}}}),e}findCellOffset(e,t){if(e){for(let n of e)if(n.trimmedRightCode.indexOf(t)>=0)return n.firstNonBlankLineIndex}}};Qb=g([(0,eE.injectable)(),p(0,(0,eE.inject)(na)),p(1,(0,eE.inject)(Ir))],Qb);var _u=k(A());var tE=class extends On{constructor(e,t,n){let i=t||y.jupyterDebuggerNotInstalledError(e);super("notinstalled",i,n)}};function D0(r){let e={source:{path:we(r.uri)},pydevdSourceMaps:[]};return e.pydevdSourceMaps=r.generatedCodes.map(t=>({line:t.debuggerStartLine,endLine:t.endLine,runtimeSource:{path:t.runtimeFile},runtimeLine:t.runtimeLine})),e}var Yb=class{constructor(e,t,n,i){this.apiProvider=e;this.configService=t;this.debugService=n;this.platform=i;this.configs=new WeakMap;this.debuggingActive=!1;this.debuggerPackage="debugpy",this.enableDebuggerCode="import debugpy;debugpy.listen(('localhost', 0))",this.waitForDebugClientCode="import debugpy;debugpy.wait_for_client()",this.tracingEnableCode="from debugpy import trace_this_thread;trace_this_thread(True)",this.tracingDisableCode="from debugpy import trace_this_thread;trace_this_thread(False)"}async attach(e){if(!e.session)throw new Error("Notebook not initialized");let t=this.configService.getSettings(e.resourceUri),n=e.kernelConnectionMetadata.interpreter?.uri;return this.startDebugSession(i=>this.debugService.startDebugging(void 0,i),e,{justMyCode:t.debugJustMyCode,python:n})}async detach(e){if(!e.session)return;let t=e.notebook;this.configs.get(t)&&(H("stop debugging"),this.debuggingActive=!1,this.debugService.stop(),e.status!=="dead"&&e.status!=="unknown"&&this.disable(e))}async updateSourceMaps(e){this.debugService.activeDebugSession&&this.debuggingActive&&(te("Sending debug request for source map"),await Promise.all(e.map(async t=>{if(this.debuggingActive)return this.debugService.activeDebugSession.customRequest("setPydevdSourceMap",D0(t))})))}enable(e){e.session?.kernel&&xn(e.session.kernel,this.tracingEnableCode,{traceErrors:!0,traceErrorsMessage:"Execute_request failure enabling tracing code for IW",telemetryName:"DATASCIENCE.INTERACTIVE_WINDOW_DEBUG_SETUP_CODE_FAILURE"}).catch(m)}disable(e){e.session?.kernel&&xn(e.session.kernel,this.tracingDisableCode,{traceErrors:!0,traceErrorsMessage:"Execute_request failure disabling tracing code for IW",telemetryName:"DATASCIENCE.INTERACTIVE_WINDOW_DEBUG_SETUP_CODE_FAILURE"}).catch(m)}async startDebugSession(e,t,n){if(H("start debugging"),!t.session?.kernel)return;let i=await this.connect(t,n);if(i&&(H("connected to notebook during debugging"),this.debuggingActive=await e(i),this.debuggingActive)){this.debugService.removeBreakpoints([]);let o=await xn(t.session.kernel,this.waitForDebugClientCode,{traceErrors:!0,traceErrorsMessage:"Execute_request failure starting debug session for IW",telemetryName:"DATASCIENCE.INTERACTIVE_WINDOW_DEBUG_SETUP_CODE_FAILURE"});o.some(s=>s.output_type==="error")?J(`${this.debuggerPackage} not found in path.`):H(`import startup: ${ET(o)}`),await this.disable(t)}}async connect(e,t){let n=e.notebook,i=n,o=this.configs.get(i);if(o)return{...o,...t};H("enable debugger attach"),await this.appendDebuggerPaths(e),o={type:"python",name:"IPython",request:"attach",...t};let{host:s,port:a}=await this.connectToLocal(e);if(o.host=s,o.port=a,o.port){this.configs.set(n,o);let l=[],c=()=>{this.configs.delete(i),l.forEach(u=>u.dispose())};l.push(e.onDisposed(c)),l.push(e.onRestarted(c))}return o}async calculateDebuggerPathList(e){let t=[],n=this.configService.getSettings(e.resourceUri).debugpyDistPath;if(n&&(this.platform.isWindows&&(n=n.replace(/\\/g,"\\\\")),t.push(n)),mt(e.kernelConnectionMetadata)){let i=await this.getDebuggerPath();this.platform.isWindows&&(i=i.replace(/\\/g,"\\\\")),t.push(i)}if(t&&t.length>0)return t.reduce((i,o)=>(i.length===0?i=`'${o}'`:i=`${i}, '${o}'`,i),"")}getDebuggerPath(){return this.apiProvider.getApi().then(e=>e.getDebuggerPath())}async appendDebuggerPaths(e){let t=await this.calculateDebuggerPathList(e);if(t&&t.length>0){let n=e.session?.kernel?await xn(e.session.kernel,`import sys as _VSCODE_sys\r
_VSCODE_sys.path.extend([${t}])\r
_VSCODE_sys.path\r
del _VSCODE_sys`,{traceErrors:!0,traceErrorsMessage:"Execute_request failure appending debugger paths for IW",telemetryName:"DATASCIENCE.INTERACTIVE_WINDOW_DEBUG_SETUP_CODE_FAILURE"}):[];H(`Appending paths: ${ET(n)}`)}}async connectToLocal(e){let t=e.session?.kernel?await xn(e.session.kernel,this.enableDebuggerCode,{traceErrors:!0,traceErrorsMessage:"Execute_request failure enabling debugging for IW",telemetryName:"DATASCIENCE.INTERACTIVE_WINDOW_DEBUG_SETUP_CODE_FAILURE"}):[];if(t.length>0){let n=ET(t);if(n){n=Hd(n);let o=/\('(.*?)', ([0-9]*)\)/.exec(n);if(o)return{port:parseInt(o[2],10),host:o[1]}}}if(t.length>0&&t[0].output_type==="error"){let n=t[0];throw new tE(this.debuggerPackage,n.ename,e.kernelConnectionMetadata)}throw new tE(y.jupyterDebuggerOutputParseError(this.debuggerPackage),void 0,e.kernelConnectionMetadata)}};Yb=g([(0,_u.injectable)(),p(0,(0,_u.inject)(Xt)),p(1,(0,_u.inject)(se)),p(2,(0,_u.inject)($a)),p(2,(0,_u.named)(Le.MULTIPLEXING_DEBUGSERVICE)),p(3,(0,_u.inject)(Ir))],Yb);var fs=k(A()),A0=require("vscode");var T0=class{constructor(e,t,n){this.debugAdapter=e;this.debugCell=t;this.execution=n;this._ready=pe();this.ready=this._ready.promise;R("DATASCIENCE.DEBUGGING.SUCCESSFULLY_STARTED_RUN_AND_DEBUG_CELL")}trace(e,t){w(`[Debug-IW] ${e}: ${t}`)}async willSendEvent(e){return WF(e)?(this.trace("intercept","debugpyAttach request for subprocess, not supported"),!0):e.event==="output"&&VC(e.body.output)?(this.trace("intercept","justMyCode notification"),!0):!1}async willSendRequest(e){let t=ds(this.debugCell);e.command==="setBreakpoints"&&t&&t.generatedCode&&!this.cellDumpInvoked&&(this.debugCellDumped||(this.debugCellDumped=Sf(this.execution,this.debugAdapter)),await this.debugCellDumped),e.command==="configurationDone"&&t&&t.generatedCode&&(this.debugCellDumped||(this.debugCellDumped=Sf(this.execution,this.debugAdapter)),await this.debugCellDumped,this._ready.resolve())}};var _0=class extends ub{constructor(){super(...arguments);this._ready=pe();this.ready=this._ready.promise}resolve(){this._ready.resolve()}};var QF=require("vscode");var R0=class extends db{constructor(t,n,i,o,s,a,l){super(t,n,i,o,s,a);this.cellToDebugFileSortedInReverseOrderByLineNumber=[];l&&(this.debugLocationTracker=l.createDebugAdapterTracker(t),this.debugLocationTracker.onWillStartSession&&this.debugLocationTracker.onWillStartSession(),this.onDidSendMessage(c=>{this.debugLocationTracker?.onDidSendMessage&&this.debugLocationTracker.onDidSendMessage(c)},this,this.disposables),this.onDidEndSession(()=>{this.debugLocationTracker?.onWillStopSession&&this.debugLocationTracker.onWillStopSession()},this,this.disposables))}handleClientMessageAsync(t){return te(`KernelDebugAdapter::handleMessage ${JSON.stringify(t,void 0," ")}`),t.type==="request"&&this.debugLocationTracker?.onWillReceiveMessage&&this.debugLocationTracker.onWillReceiveMessage(t),t.type==="response"&&this.debugLocationTracker?.onDidSendMessage&&this.debugLocationTracker.onDidSendMessage(t),super.handleClientMessageAsync(t)}async dumpCell(t){let n=this.notebookDocument.cellAt(t),i=ds(n);if(!i)throw new Error("Not an interactive window cell");try{let o=(i.generatedCode?.code||n.document.getText()).replace(/\r\n/g,`
`),s=await this.session.customRequest("dumpCell",{code:o}),a=Pn(s.sourcePath);this.fileToCell.set(a,QF.Uri.parse(i.interactive.uristring));let l=0;i.generatedCode&&!i.generatedCode.hasCellMarker&&(l=i.generatedCode.firstNonBlankLineIndex),this.cellToDebugFileSortedInReverseOrderByLineNumber.push({debugFilePath:a,interactiveWindow:QF.Uri.parse(i.interactive.uristring),metadata:i,lineOffset:l+i.interactive.lineIndex+(i.generatedCode?.lineOffsetRelativeToIndexOfFirstLineInCell||0)}),this.cellToDebugFileSortedInReverseOrderByLineNumber.sort((c,u)=>u.metadata.interactive.lineIndex-c.metadata.interactive.lineIndex)}catch(o){C(`Failed to dump cell for ${n.index} with code ${i.interactive.originalSource}`,o)}}translateDebuggerLocationToRealLocation(t,n){if(n=t?.source??n,!n||!n.path)return;let i=this.cellToDebugFileSortedInReverseOrderByLineNumber.find(o=>o.debugFilePath===n.path);i&&(n.name=Te(i.interactiveWindow.path),n.path=i.interactiveWindow.toString(),typeof t?.endLine=="number"&&(t.endLine=t.endLine+(i.lineOffset||0)),typeof t?.line=="number"&&(t.line=t.line+(i.lineOffset||0)))}translateRealLocationToDebuggerLocation(t,n){let i=t.line;if(n=t?.source??n,!n||!n.path||typeof i!="number")return;let o=this.cellToDebugFileSortedInReverseOrderByLineNumber.find(s=>i>=s.metadata.interactive.lineIndex+1);!o||o.interactiveWindow.path!==n.path||(n.path=o.debugFilePath,typeof t?.endLine=="number"&&(t.endLine=t.endLine-(o.lineOffset||0)),typeof t?.line=="number"&&(t.line=t.line-(o.lineOffset||0)))}async sendRequestToJupyterSession(t){if(t.command==="setBreakpoints"){let n=t.arguments;if(delete n.lines,n.source.path!==this.cellToDebugFileSortedInReverseOrderByLineNumber[0]?.interactiveWindow.path)return super.sendRequestToJupyterSession(t);let i,o=[],s=[],a=()=>{if(o.length){let u=JSON.parse(JSON.stringify(t));u.arguments.breakpoints=o,s.push(super.sendRequestToJupyterSession(u))}};for(let u of t.arguments.breakpoints??[]){let d=this.cellToDebugFileSortedInReverseOrderByLineNumber.find(f=>u.line>=f.metadata.generatedCode.line&&u.line<=f.metadata.generatedCode.endLine);if(d&&d.metadata.interactive.lineIndex!==i)a(),i=d.metadata.interactive.lineIndex,o=[u];else if(d)o.push(u);else{let f={...u,verified:!0};s.push(Promise.resolve({body:{breakpoints:[f]}}))}}a();let l=await Promise.all(s),c=JSON.parse(JSON.stringify(l[0]));return l.slice(1).forEach(u=>{c.body.breakpoints=c.body.breakpoints.concat(u.body.breakpoints??[])}),c.command="setBreakpoints",c.type="response",c.success=!0,c.request_seq=t.seq,c}return super.sendRequestToJupyterSession(t)}getDumpFilesForDeletion(){return this.cellToDebugFileSortedInReverseOrderByLineNumber.map(t=>t.debugFilePath)}};var N0=class{constructor(e,t){this.debugCell=e;this.applicationShell=t.get(ue)}trace(e,t){w(`[Debug-IWRestart] ${e}: ${t}`)}async willSendResponse(e){e.command==="initialize"&&e.body&&(e.body.supportsRestartRequest=!0)}async willSendRequest(e){if(e.command==="restart")return this.trace("restart","Showing warning for unsupported restart request"),this.applicationShell.showWarningMessage(y.restartNotSupported,{modal:!0}).then(m,m),{command:e.command,request_seq:e.seq,seq:e.seq,success:!0,type:"response"}}};var Xb=class extends pb{constructor(t,n,i,o,s,a,l,c,u,d){super(t,n,i,o,s,d);this.platform=a;this.debugLocationTrackerFactory=l;this.configService=c;this.debugService=u}activate(){super.activate(),this.disposables.push(A0.debug.registerDebugAdapterDescriptorFactory(XS,{createDebugAdapterDescriptor:async t=>this.createDebugAdapterDescriptor(t)}))}getDebugMode(t){return 2}async start(t,n){te("Starting debugging IW"),await this.checkIpykernelAndPrompt(n)===1&&await this.startDebuggingCell(t,n)}async startDebuggingCell(t,n){let i=this.configService.getSettings(t.uri),o={type:XS,name:Te(t.uri.toString()),request:"attach",justMyCode:i.debugJustMyCode,__notebookUri:t.uri.toString(),__mode:2,__cellIndex:n.index},s={suppressSaveBeforeStart:!0};await this.startDebuggingConfig(o,s);let a=this.notebookToDebugger.get(t);if(!a){C("Debugger not found, could not start debugging.");return}await a.ready}async createDebugAdapterDescriptor(t){let n=t.configuration;Y4(n);let i=this.vscNotebook.notebookDocuments.find(s=>s.uri.toString()===n.__notebookUri);if(!i||typeof n.__cellIndex!="number"){C("Invalid debug session for debugging of IW using Jupyter Protocol");return}if(this.notebookInProgress.has(i)){H("Cannot start debugging. Already debugging this notebook");return}if(this.isDebugging(i)){H("Cannot start debugging. Already debugging this notebook document. Toolbar should update");return}let o=new _0(i,n,t);this.notebookToDebugger.set(i,o);try{return this.notebookInProgress.add(i),await this.doCreateDebugAdapterDescriptor(n,t,i,o)}finally{this.notebookInProgress.delete(i)}}async doCreateDebugAdapterDescriptor(t,n,i,o){let s=await this.ensureKernelIsRunning(i);if(!s?.session){this.appShell.showInformationMessage(y.kernelWasNotStarted).then(m,m);return}let a=new R0(n,i,s.session,s,this.platform,this.debugService,this.debugLocationTrackerFactory);this.disposables.push(a.onDidEndSession(this.endSession.bind(this)));let l=i.cellAt(t.__cellIndex),c=new T0(a,l,this.kernelProvider.getKernelExecution(s));return a.addDebuggingDelegates([c,new N0(l,this.serviceContainer)]),c.ready.then(()=>o.resolve()).catch(u=>console.error("Failed waiting for controller to be ready",u)),this.trackDebugAdapter(i,a),new A0.DebugAdapterInlineImplementation(a)}async updateSourceMaps(t,n){let i=this.getDebugSession(t.notebook);i&&(te("Sending debug request for source map"),await Promise.all(n.map(async o=>{if(i)return i.customRequest("setPydevdSourceMap",D0(o))})))}};Xb=g([(0,fs.injectable)(),p(0,(0,fs.inject)(Ke)),p(1,(0,fs.inject)(xt)),p(2,(0,fs.inject)(Fe)),p(3,(0,fs.inject)(ue)),p(4,(0,fs.inject)(qe)),p(5,(0,fs.inject)(Ir)),p(6,(0,fs.inject)(J_)),p(7,(0,fs.inject)(se)),p(8,(0,fs.inject)(Ui)),p(9,(0,fs.inject)(ct))],Xb);var Zb=k(A()),YF=require("vscode");var lz="InteractiveShiftEnterBanner";var kd=class{constructor(e,t,n){this.appShell=e;this.persistentState=t;this.configuration=n;this.disabledInCurrentSession=!1;this.bannerMessage=ON.bannerMessage;this.bannerLabels=[ye.bannerLabelYes,ye.bannerLabelNo];this.initialize()}initialize(){this.initialized||(this.initialized=!0,this.isEnabled())}isEnabled(){return this.persistentState.createGlobalPersistentState("InteractiveShiftEnterBanner",!0).value}async showBanner(){if(!this.isEnabled()||!await this.shouldShowBanner())return;switch(R("DS_INTERNAL.SHIFTENTER_BANNER_SHOWN"),await this.appShell.showInformationMessage(this.bannerMessage,...this.bannerLabels)){case this.bannerLabels[0]:{await this.enableInteractiveShiftEnter();break}case this.bannerLabels[1]:{await this.disableInteractiveShiftEnter();break}default:this.disabledInCurrentSession=!0}}async shouldShowBanner(){let e=this.configuration.getSettings();return Promise.resolve(this.isEnabled()&&!this.disabledInCurrentSession&&!e.sendSelectionToInteractiveWindow)}async disableInteractiveShiftEnter(){await this.configuration.updateSetting("interactiveWindow.textEditor.executeSelection",!1,void 0,YF.ConfigurationTarget.Global),await this.disableBanner()}async enableInteractiveShiftEnter(){await this.configuration.updateSetting("interactiveWindow.textEditor.executeSelection",!0,void 0,YF.ConfigurationTarget.Global),await this.disableBanner()}async disableBanner(){await this.persistentState.createGlobalPersistentState("InteractiveShiftEnterBanner",!1).updateValue(!1)}};g([sn("DATASCIENCE.DISABLE_INTERACTIVE_SHIFT_ENTER")],kd.prototype,"disableInteractiveShiftEnter",1),g([sn("DATASCIENCE.ENABLE_INTERACTIVE_SHIFT_ENTER")],kd.prototype,"enableInteractiveShiftEnter",1),kd=g([(0,Zb.injectable)(),p(0,(0,Zb.inject)(ue)),p(1,(0,Zb.inject)(Sl)),p(2,(0,Zb.inject)(se))],kd);var Pd=k(A()),cz=require("vscode");var eI=class{constructor(e,t,n,i,o){this.configService=e;this.fs=t;this.context=n;this.isWebExtension=i;this.registry=o;this.priority=5}activate(){this.registry.register(this,wt)}async getCode(e){if(!Vt(e.kernelConnectionMetadata))return[];if(!this.isWebExtension){if(this.configService.getSettings(void 0).forceIPyKernelDebugger===!0)return[];if(!mt(e.kernelConnectionMetadata))return[]}if(e.notebook?.notebookType===wt){if(!mt(e.kernelConnectionMetadata))return[];this.addRunCellHookContents||(this.addRunCellHookContents=this.fs.readFile(cz.Uri.joinPath(this.context.extensionUri,"pythonFiles","vscode_datascience_helpers","kernel","addRunCellHook.py")));let t=await this.addRunCellHookContents;return je(t,{trim:!1})}return[]}};eI=g([(0,Pd.injectable)(),p(0,(0,Pd.inject)(se)),p(1,(0,Pd.inject)(Ze)),p(2,(0,Pd.inject)(dt)),p(3,(0,Pd.inject)(on)),p(4,(0,Pd.inject)(xa))],eI);var rI=k(A()),nI=require("vscode");var tI=class{constructor(e,t,n){this.dataScienceCodeLensProvider=e;this.extensionContext=t;this.configurationService=n}activate(){this.configurationService.getSettings().pythonCellFolding&&this.extensionContext.subscriptions.push(nI.languages.registerFoldingRangeProvider([AE],this))}provideFoldingRanges(e,t,n){if([el,DS].includes(e.uri.scheme))return;let i=this.dataScienceCodeLensProvider.getCodeWatcher(e);if(i){let o=i.getCodeLenses();return n.isCancellationRequested||o.length==0?void 0:o.map(s=>new nI.FoldingRange(s.range.start.line,s.range.end.line,nI.FoldingRangeKind.Region))}}};tI=g([(0,rI.injectable)(),p(0,(0,rI.inject)(Cd)),p(1,(0,rI.inject)(dt)),p(2,(0,rI.inject)(se))],tI);var rE=k(A());var uz=require("vscode");var iI=class{constructor(e,t){this.dataScienceCodeLensProvider=e;this.extensionContext=t}activate(){this.extensionContext.subscriptions.push(uz.languages.registerCodeLensProvider([AE],this.dataScienceCodeLensProvider))}};iI=g([(0,rE.injectable)(),p(0,(0,rE.inject)(Cd)),p(1,(0,rE.inject)(dt))],iI);var ia=k(A());var XF="LastInteractiveKernelSelected",oI=class{constructor(e,t,n,i,o){this.controllerRegistration=e;this.interpreterService=t;this.disposables=n;this.workspaceMemento=i;this.serviceContainer=o;this.onControllerSelected=this.controllerRegistration.onControllerSelected}async getInitialController(e,t){if(t){let n=this.controllerRegistration.get(t,wt);if(n)return n}if(this.workspaceMemento.get(XF)){let n=this.workspaceMemento.get(XF),i=n?this.controllerRegistration.get(n,wt):void 0;if(i)return i}if(this.interpreterService)return await hye(wt,e,this.interpreterService,this.controllerRegistration)}getSelectedController(e){return this.controllerRegistration.getSelected(e)}getRegisteredController(e){return this.controllerRegistration.get(e,"interactive")}async createKernel(e,t,n,i,o){await is(n,e);let s=(u,d)=>{u!=="start"&&u!=="restart"||te(`(onStart) Looking for controller ${d.controller.id} in ${this.controllerRegistration.all.map(f=>`${f.kind}:${f.id}`).join(", ")}`)},a=await Ys.connectToNotebookKernel(e,this.serviceContainer,{resource:n||i.uri,notebook:i,controller:t},new er(!1),o,"jupyterExtension",s),l=this.controllerRegistration.registered.find(u=>u.id===a.controller.id);if(!l)throw Error(`Controller ${a.controller.id} not found or not yet created`);let c=l.controller;return this.interpreterService&&gye(a.kernelConnectionMetadata,n,this.interpreterService).then(async u=>{await this.workspaceMemento.update(XF,u?void 0:a.kernelConnectionMetadata)}).catch(u=>{J("Failed to store kernel connection metadata",u)}),{kernel:a,actualController:c}}};oI=g([(0,ia.injectable)(),p(0,(0,ia.inject)(xt)),p(1,(0,ia.inject)(it)),p(1,(0,ia.optional)()),p(2,(0,ia.inject)(O)),p(3,(0,ia.inject)(He)),p(3,(0,ia.named)(vi)),p(4,(0,ia.inject)(ct))],oI);async function hye(r,e,t,n){let i=await t.getActiveInterpreter(e);if(i){let o=await Ia(i),s=$o.create({kernelSpec:o,interpreter:i,id:ci(o,i)}),a=n.addOrUpdate(s,[r]),l=a[0];return n.trackActiveInterpreterControllers(a),te(`Active Interpreter Controller ${l.connection.kind}:${l.id} created for View ${r} with resource ${W(e)}`),l}}async function gye(r,e,t){return(await t.getActiveInterpreter(e))?.id===r.interpreter?.id}var Rf=k(A());var nE=require("vscode");var sI=class{constructor(e,t,n,i){this.configService=e;this.fs=t;this.workspace=n;this.registry=i;this.priority=0}activate(){this.registry.register(this,wt)}async getCode(e){let t=await this.getWorkingDirectory(e);return t?je(rl(da.UpdateCWDAndPath,we(t)),{trim:!1}):[]}async getWorkingDirectory(e){if(!mt(e.kernelConnectionMetadata)&&!bk(e.kernelConnectionMetadata)||!Vt(e.kernelConnectionMetadata))return;let t=e.resourceUri?.path.endsWith(".interactive")&&this.workspace.rootFolder?nE.Uri.joinPath(this.workspace.rootFolder,e.resourceUri.path):e.resourceUri,n=await this.calculateWorkingDirectory(e.resourceUri);if(n&&await this.fs.exists(n))return n;if(e.resourceUri&&e.resourceUri.scheme!=="untitled"&&await this.fs.exists(e.resourceUri)&&(n=nE.Uri.file(Uh(we(n),t,this.workspace,this.configService.getSettings(t))),n&&await this.fs.exists(n)))return n}async calculateWorkingDirectory(e){let t,n=this.configService.getSettings(e),i=NP(n.notebookFileRoot);if(i&&this.workspace.hasWorkspaceFolders){let o=nE.Uri.file(i),s=this.workspace.workspaceFolders[0].uri;if(mh(i))await this.fs.exists(o)?t=o:t=s;else if(i.includes("${"))t=o;else{let a=nE.Uri.joinPath(s,i);await this.fs.exists(a)?t=a:t=s}}return t}};sI=g([(0,Rf.injectable)(),p(0,(0,Rf.inject)(se)),p(1,(0,Rf.inject)(Ze)),p(2,(0,Rf.inject)(ce)),p(3,(0,Rf.inject)(xa))],sI);function pz(r){r.addSingleton(Gi,Gb),r.addSingleton(g0,oI),r.addSingleton(Ie,Uo),r.addSingleton(Ie,Hb),r.add(m0,ir),r.addSingleton(f0,Vb),r.addSingleton(Cd,qb),r.addSingleton(Ie,iI),r.addSingleton(Ie,tI),r.addSingleton(Ie,Jb),r.addSingleton(Ie,zb),r.addSingleton(Ie,sI),r.addSingleton(Ie,eI),r.addSingleton(Ub,jb,void 0,[Ie]),r.addSingleton(na,$b),r.addSingleton(tg,Qb),r.addSingleton(h0,Yb),r.addSingleton(v0,Xb,void 0,[Ie]),r.addSingleton(d2,kd,lz)}var bc=k(A()),ZF=require("vscode");var aI=class{constructor(e,t,n,i,o){this.jupyterServerHelper=e;this.configService=t;this.fileSystem=n;this.applicationShell=i;this.errorHandler=o;this.pruneCells=(e,t)=>e.map(i=>this.pruneCell(i,t));this.pruneCell=(e,t)=>{let n=mV({...e.data});return n.source=this.pruneSource(e.data.source,t),n};this.pruneSource=(e,t)=>{if(Array.isArray(e)&&e.length>0){if(t.isCell(e[0]))return e.slice(1)}else{let n=e.toString().split(`
`).map(i=>`${i}
`);if(n.length>0&&t.isCell(n[0]))return n.slice(1)}return e};this.extractPythonMainVersion=async()=>{if(!this.jupyterServerHelper)return 3;let e=await this.jupyterServerHelper.getUsableJupyterPython();return e&&e.version?e.version.major:3}}dispose(){}async exportToFile(e,t,n=!0){let i=await this.translateToNotebook(e);try{let o=JSON.stringify(i,void 0,1);if(await this.fileSystem.writeFile(ZF.Uri.file(t),o),!n)return;let s=y.exportOpenQuestion1;this.applicationShell.showInformationMessage(y.exportDialogComplete(t),s).then(async a=>{try{a===s&&await b0(ZF.Uri.file(t))}catch(l){await this.errorHandler.handleError(l)}},m)}catch(o){C("Error in exporting notebook file"),this.applicationShell.showInformationMessage(y.exportDialogFailed(o)).then(m,m)}}async translateToNotebook(e,t){let n=await this.extractPythonMainVersion(),i={language_info:{codemirror_mode:{name:"ipython",version:n},file_extension:".py",mimetype:"text/x-python",name:"python",nbconvert_exporter:"python",pygments_lexer:`ipython${n}`,version:n},kernelspec:t},o=new Ti(this.configService.getSettings());return{cells:this.pruneCells(e,o),nbformat:RR.major,nbformat_minor:RR.minor,metadata:i}}};aI=g([(0,bc.injectable)(),p(0,(0,bc.inject)(rp)),p(0,(0,bc.optional)()),p(1,(0,bc.inject)(se)),p(2,(0,bc.inject)(Ze)),p(3,(0,bc.inject)(ue)),p(4,(0,bc.inject)(an))],aI);var Dd=k(A()),dz=require("vscode");var lI=class{constructor(e,t,n,i,o){this.fs=e;this.disposableRegistry=t;this.configuration=n;this.nbConvertDependencyChecker=i;this.exportToPythonService=o;this.isDisposed=!1;this.nbconvertBaseTemplateFormat=`{%- extends '{0}' -%}
{% block codecell %}
{1}
{{ super() }}
{% endblock codecell %}
{% block in_prompt %}{% endblock in_prompt %}
{% block input %}{{ cell.source | ipython2python }}{% endblock input %}
{% block markdowncell scoped %}{1} [markdown]
{{ cell.source | comment_lines }}
{% endblock markdowncell %}`;this.nbconvert5Null="null.tpl";this.nbconvert6Null="base/null.j2";this.dispose=()=>{this.isDisposed=!0};this.addInstructionComments=e=>y.instructionComments(this.defaultCellMarker).concat(e);this.addIPythonImport=e=>rl(da.ImportIPython,this.defaultCellMarker,e)}async importFromFile(e,t){let n=await this.nbConvertDependencyChecker.getNbConvertVersion(t);if(n){let i;n.major>=6?(this.template6Promise||(this.template6Promise=this.createTemplateFile(!0)),i=await this.template6Promise):(this.template5Promise||(this.template5Promise=this.createTemplateFile(!1)),i=await this.template5Promise);let o=await this.exportToPythonService.exportNotebookToPython(e,t,i);return o.includes("get_ipython()")&&(o=this.addIPythonImport(o)),this.addInstructionComments(o)}throw new Error(y.jupyterNbConvertNotSupported)}get defaultCellMarker(){return this.configuration.getSettings().defaultCellMarker||Le.DefaultCodeCellMarker}async createTemplateFile(e){let t=await this.fs.createTemporaryLocalFile(".tpl");if(t)try{return this.disposableRegistry.push(t),await this.fs.writeFile(dz.Uri.file(t.filePath),rl(this.nbconvertBaseTemplateFormat,e?this.nbconvert6Null:this.nbconvert5Null,this.defaultCellMarker)),t.filePath}catch{}}};lI=g([(0,Dd.injectable)(),p(0,(0,Dd.inject)(Or)),p(1,(0,Dd.inject)(O)),p(2,(0,Dd.inject)(se)),p(3,(0,Dd.inject)(kh)),p(4,(0,Dd.inject)(_w))],lI);var Qi=k(A());var mz=require("vscode");var M0=class{constructor(e,t,n,i,o,s,a,l,c){this.commandManager=e;this.fileConverter=t;this.applicationShell=n;this.fs=i;this.notebooks=o;this.interactiveProvider=s;this.controllerRegistration=a;this.preferredKernel=l;this.kernelFinder=c;this.disposables=[]}register(){this.registerCommand(V.ExportAsPythonScript,(e,t)=>this.export(e,"python",void 0,t)),this.registerCommand(V.ExportToHTML,(e,t,n)=>this.export(e,"html",t,n)),this.registerCommand(V.ExportToPDF,(e,t,n)=>this.export(e,"pdf",t,n)),this.registerCommand(V.Export,(e,t,n)=>this.export(e,void 0,t,n)),this.registerCommand(V.NativeNotebookExport,e=>this.nativeNotebookExport(e))}dispose(){this.disposables.forEach(e=>e.dispose())}registerCommand(e,t){let n=this.commandManager.registerCommand(e,t,this);this.disposables.push(n)}async nativeNotebookExport(e){let t=ti(e)?e:e?.notebookEditor?.notebookUri,n=t?this.notebooks.notebookDocuments.find(i=>this.fs.arePathsSame(i.uri,t)):this.notebooks.activeNotebookEditor?.notebook;if(n){let i,o=this.kernelFinder.registered.find(l=>l.kind==="localPythonEnvironment"),s=new mz.CancellationTokenSource;try{i=o?await this.preferredKernel.findPreferredLocalKernelSpecConnection(n,o,s.token).then(l=>l?.interpreter):void 0}finally{s.dispose()}let a=this.controllerRegistration.getSelected(n)?.connection.interpreter||i;return this.export(n,void 0,void 0,a)}else return this.export(void 0,void 0,void 0,void 0)}async export(e,t,n,i){if(!e){if(e=this.notebooks.activeNotebookEditor?.notebook||this.interactiveProvider?.getActiveOrAssociatedInteractiveWindow()?.notebookDocument,!e){H("Export called without a valid exportable document active");return}i=i||this.controllerRegistration.getSelected(e)?.connection.interpreter,t&&R("DATASCIENCE.EXPORT_NOTEBOOK_AS_COMMAND",void 0,{format:t})}if(t)await this.fileConverter.export(t,e,n,i);else{let o=await this.showExportQuickPickMenu(e,n,i).then(s=>s);o!==void 0?o.handler():R("DATASCIENCE.CLICKED_EXPORT_NOTEBOOK_AS_QUICK_PICK")}}getExportQuickPickItems(e,t,n){let i=[];return(n||e.metadata&&gk(wo(e)))&&i.push({label:y.exportPythonQuickPickLabel,picked:!0,handler:()=>{R("DATASCIENCE.CLICKED_EXPORT_NOTEBOOK_AS_QUICK_PICK",void 0,{format:"python"}),this.commandManager.executeCommand(V.ExportAsPythonScript,e,n).then(m,m)}}),i.push({label:y.exportHTMLQuickPickLabel,picked:!1,handler:()=>{R("DATASCIENCE.CLICKED_EXPORT_NOTEBOOK_AS_QUICK_PICK",void 0,{format:"html"}),this.commandManager.executeCommand(V.ExportToHTML,e,t,n).then(m,m)}},{label:y.exportPDFQuickPickLabel,picked:!1,handler:()=>{R("DATASCIENCE.CLICKED_EXPORT_NOTEBOOK_AS_QUICK_PICK",void 0,{format:"pdf"}),this.commandManager.executeCommand(V.ExportToPDF,e,t,n).then(m,m)}}),i}async showExportQuickPickMenu(e,t,n){let i=this.getExportQuickPickItems(e,t,n),o={ignoreFocusOut:!1,matchOnDescription:!0,matchOnDetail:!0,placeHolder:y.exportAsQuickPickPlaceholder};return this.applicationShell.showQuickPick(i,o)}};var cI=class{constructor(e,t,n,i,o,s,a,l,c,u,d){this.disposables=e;this.workspace=t;this.commandManager=n;this.fileConverter=i;this.applicationShell=o;this.fs=s;this.notebooks=a;this.interactiveProvider=l;this.controllerSelection=c;this.kernelFinder=u;this.jupyterConnection=d;this.exportCommand=new M0(this.commandManager,this.fileConverter,this.applicationShell,this.fs,this.notebooks,this.interactiveProvider,c,new yd(d),u),this.workspace.isTrusted||this.workspace.onDidGrantWorkspaceTrust(this.registerCommandsIfTrusted,this,this.disposables)}activate(){this.registerCommandsIfTrusted()}registerCommandsIfTrusted(){this.workspace.isTrusted&&this.exportCommand?.register()}};cI=g([(0,Qi.injectable)(),p(0,(0,Qi.inject)(O)),p(1,(0,Qi.inject)(ce)),p(2,(0,Qi.inject)(Fe)),p(3,(0,Qi.inject)(vb)),p(4,(0,Qi.inject)(ue)),p(5,(0,Qi.inject)(Ze)),p(6,(0,Qi.inject)(qe)),p(7,(0,Qi.inject)(Gi)),p(7,(0,Qi.optional)()),p(8,(0,Qi.inject)(xt)),p(9,(0,Qi.inject)(Wr)),p(10,(0,Qi.inject)(Dn))],cI);var oa=k(A());var eL="JVSC_NEVER_PROMPT_EXTENSIONS_LIST",vye=new Map([["ms-dotnettools.dotnet-interactive-vscode",{displayName:".NET Interactive Notebooks Preview",extensionLink:"https://marketplace.visualstudio.com/items?itemName=ms-dotnettools.dotnet-interactive-vscode"}]]),yye=new Map([["c#","ms-dotnettools.dotnet-interactive-vscode"],["csharp","ms-dotnettools.dotnet-interactive-vscode"],["f#","ms-dotnettools.dotnet-interactive-vscode"],["fsharp","ms-dotnettools.dotnet-interactive-vscode"],["powershell","ms-dotnettools.dotnet-interactive-vscode"]]),uI=class{constructor(e,t,n,i,o,s,a){this.notebook=e;this.controllerManager=t;this.globalMemento=i;this.appShell=o;this.extensions=s;this.commandManager=a;this.disposables=[];this.recommendedInSession=new Set;n.push(this)}dispose(){G(this.disposables)}activate(){this.notebook.onDidOpenNotebookDocument(this.onDidOpenNotebookDocument,this,this.disposables),this.controllerManager.onControllerSelected(this.onNotebookControllerSelected,this,this.disposables)}onDidOpenNotebookDocument(e){if(!Dt(e))return;let t=yk(wo(e));t&&this.recommendExtensionForLanguage(t).catch(m)}onNotebookControllerSelected({controller:e}){if(e.connection.kind!=="startUsingLocalKernelSpec"&&e.connection.kind!=="startUsingRemoteKernelSpec"||Vt(e.connection))return;let t=oo(e.connection);t&&this.recommendExtensionForLanguage(t).catch(m)}async recommendExtensionForLanguage(e){let t=yye.get(e.toLowerCase());if(!t||this.extensions.getExtension(t))return;let n=vye.get(t);if(!n||this.globalMemento.get(eL,[]).includes(t)||this.recommendedInSession.has(t))return;this.recommendedInSession.add(t);let i=y.recommendExtensionForNotebookLanguage(`[${n.displayName}](${n.extensionLink})`,e);switch(R("DATASCIENCE.RECOMMENT_EXTENSION",void 0,{extensionId:t,action:"displayed"}),await this.appShell.showInformationMessage(i,ye.bannerLabelYes,ye.bannerLabelNo,ye.doNotShowAgain)){case ye.bannerLabelYes:{R("DATASCIENCE.RECOMMENT_EXTENSION",void 0,{extensionId:t,action:"ok"}),this.commandManager.executeCommand("extension.open",t).then(m,m);break}case ye.bannerLabelNo:{R("DATASCIENCE.RECOMMENT_EXTENSION",void 0,{extensionId:t,action:"cancel"});break}case ye.doNotShowAgain:{R("DATASCIENCE.RECOMMENT_EXTENSION",void 0,{extensionId:t,action:"doNotShowAgain"});let s=this.globalMemento.get(eL,[]);s.includes(t)||(s.push(t),await this.globalMemento.update(eL,s));break}default:R("DATASCIENCE.RECOMMENT_EXTENSION",void 0,{extensionId:t,action:"dismissed"})}}};uI=g([(0,oa.injectable)(),p(0,(0,oa.inject)(qe)),p(1,(0,oa.inject)(xt)),p(2,(0,oa.inject)(O)),p(3,(0,oa.inject)(He)),p(3,(0,oa.named)(It)),p(4,(0,oa.inject)(ue)),p(5,(0,oa.inject)(rr)),p(6,(0,oa.inject)(Fe))],uI);var hs=k(A());var pI=class{constructor(e,t,n,i,o,s,a,l){this.interactiveProvider=e;this.docManager=t;this.commandManager=n;this.vscNotebook=o;this.kernelProvider=s;this.controllers=a;this.jupyterUriProviderRegistration=l;this.disposables=[];this.isPythonFileActive=!1;i.push(this),this.nativeContext=new nr(fr.IsNativeActive,this.commandManager),this.canRestartNotebookKernelContext=new nr(fr.CanRestartNotebookKernel,this.commandManager),this.canInterruptNotebookKernelContext=new nr(fr.CanInterruptNotebookKernel,this.commandManager),this.canRestartInteractiveWindowKernelContext=new nr(fr.CanRestartInteractiveWindowKernel,this.commandManager),this.canInterruptInteractiveWindowKernelContext=new nr(fr.CanInterruptInteractiveWindowKernel,this.commandManager),this.interactiveContext=new nr(fr.IsInteractiveActive,this.commandManager),this.interactiveOrNativeContext=new nr(fr.IsInteractiveOrNativeActive,this.commandManager),this.pythonOrNativeContext=new nr(fr.IsPythonOrNativeActive,this.commandManager),this.pythonOrInteractiveContext=new nr(fr.IsPythonOrInteractiveActive,this.commandManager),this.pythonOrInteractiveOrNativeContext=new nr(fr.IsPythonOrInteractiveOrNativeActive,this.commandManager),this.hasNativeNotebookCells=new nr(fr.HaveNativeCells,this.commandManager),this.isPythonNotebook=new nr(fr.IsPythonNotebook,this.commandManager),this.isJupyterKernelSelected=new nr(fr.IsJupyterKernelSelected,this.commandManager),this.hasNativeNotebookOrInteractiveWindowOpen=new nr(fr.HasNativeNotebookOrInteractiveWindowOpen,this.commandManager),this.kernelSourceContext=new nr(fr.KernelSource,this.commandManager)}dispose(){this.disposables.forEach(e=>e.dispose())}activate(){this.docManager.onDidChangeActiveTextEditor(this.onDidChangeActiveTextEditor,this,this.disposables),this.kernelProvider.onKernelStatusChanged(this.onDidKernelStatusChange,this,this.disposables),this.interactiveProvider&&(this.interactiveProvider.onDidChangeActiveInteractiveWindow(this.onDidChangeActiveInteractiveWindow,this,this.disposables),this.interactiveProvider.activeWindow&&this.onDidChangeActiveInteractiveWindow()),this.vscNotebook.activeNotebookEditor&&this.onDidChangeActiveNotebookEditor(this.vscNotebook.activeNotebookEditor),this.vscNotebook.onDidChangeActiveNotebookEditor(this.onDidChangeActiveNotebookEditor,this,this.disposables),this.docManager.activeTextEditor?.document.languageId===xe&&this.onDidChangeActiveTextEditor(this.docManager.activeTextEditor),this.vscNotebook.onDidChangeNotebookEditorSelection(this.updateNativeNotebookInteractiveWindowOpenContext,this,this.disposables),this.vscNotebook.onDidOpenNotebookDocument(this.updateNativeNotebookInteractiveWindowOpenContext,this,this.disposables),this.vscNotebook.onDidCloseNotebookDocument(this.updateNativeNotebookInteractiveWindowOpenContext,this,this.disposables),this.controllers.onControllerSelectionChanged(()=>this.updateSelectedKernelContext(),this,this.disposables),this.updateSelectedKernelContext()}updateNativeNotebookCellContext(){let e=(this.vscNotebook.activeNotebookEditor?.notebook.cellCount||0)>0;this.hasNativeNotebookCells.set(e).catch(m)}onDidChangeActiveInteractiveWindow(e){this.interactiveContext.set(!!e).catch(m),this.updateNativeNotebookInteractiveWindowOpenContext(),this.updateMergedContexts(),this.updateContextOfActiveInteractiveWindowKernel()}onDidChangeActiveNotebookEditor(e){let t=e?e.notebook.notebookType===Ct:!1;this.nativeContext.set(t).catch(m),this.isPythonNotebook.set(e&&t?gk(wo(e.notebook)):!1).catch(m),this.updateContextOfActiveNotebookKernel(e),this.updateContextOfActiveInteractiveWindowKernel(),this.updateNativeNotebookInteractiveWindowOpenContext(),this.updateNativeNotebookCellContext(),this.updateMergedContexts()}updateNativeNotebookInteractiveWindowOpenContext(){this.hasNativeNotebookOrInteractiveWindowOpen.set(this.vscNotebook.notebookDocuments.some(e=>e.notebookType===Ct||e.notebookType===wt)).catch(m)}updateContextOfActiveNotebookKernel(e){let t=e&&e.notebook.notebookType===Ct?this.kernelProvider.get(e.notebook):void 0;if(t){let n=t.status!=="unknown";this.canRestartNotebookKernelContext.set(!!n).catch(m);let i=t.status==="busy";this.canInterruptNotebookKernelContext.set(!!i).catch(m)}else this.canRestartNotebookKernelContext.set(!1).catch(m),this.canInterruptNotebookKernelContext.set(!1).catch(m);this.updateKernelSourceContext(t).catch(m),this.updateSelectedKernelContext()}async updateKernelSourceContext(e){if(!e||!Ft(e.kernelConnectionMetadata)){this.kernelSourceContext.set("").catch(m);return}let t=e.kernelConnectionMetadata,n=await this.jupyterUriProviderRegistration.jupyterCollections.find(i=>i.extensionId===t.serverProviderHandle.extensionId&&i.id===t.serverProviderHandle.id);if(!n){this.kernelSourceContext.set("").catch(m);return}this.kernelSourceContext.set(n.id).catch(m)}updateSelectedKernelContext(){let e=this.vscNotebook.activeNotebookEditor?.notebook||this.interactiveProvider?.getActiveOrAssociatedInteractiveWindow()?.notebookDocument;e&&Dt(e)&&this.controllers.getSelected(e)?this.isJupyterKernelSelected.set(!0).catch(m):this.isJupyterKernelSelected.set(!1).catch(m)}updateContextOfActiveInteractiveWindowKernel(){let e=this.interactiveProvider?.getActiveOrAssociatedInteractiveWindow()?.notebookDocument,t=e?this.kernelProvider.get(e):void 0;if(t){let n=t.status!=="unknown";this.canRestartInteractiveWindowKernelContext.set(!!n).catch(m);let i=t.status==="busy";this.canInterruptInteractiveWindowKernelContext.set(!!i).catch(m)}else this.canRestartInteractiveWindowKernelContext.set(!1).catch(m),this.canInterruptInteractiveWindowKernelContext.set(!1).catch(m);this.updateSelectedKernelContext()}onDidKernelStatusChange({kernel:e}){let t=e.notebook;t.notebookType===wt?this.updateContextOfActiveInteractiveWindowKernel():t.notebookType===Ct&&t===this.vscNotebook.activeNotebookEditor?.notebook&&this.updateContextOfActiveNotebookKernel(this.vscNotebook.activeNotebookEditor)}onDidChangeActiveTextEditor(e){this.isPythonFileActive=e?.document.languageId===xe&&!KE(e.document.uri),this.updateNativeNotebookCellContext(),this.updateMergedContexts(),this.updateContextOfActiveInteractiveWindowKernel()}updateMergedContexts(){this.interactiveOrNativeContext.set(this.nativeContext.value===!0||this.interactiveContext.value===!0).catch(m),this.pythonOrNativeContext.set(this.nativeContext.value===!0||this.isPythonFileActive===!0).catch(m),this.pythonOrInteractiveContext.set(this.interactiveContext.value===!0||this.isPythonFileActive===!0).catch(m),this.pythonOrInteractiveOrNativeContext.set(this.nativeContext.value===!0||this.interactiveContext.value===!0&&this.isPythonFileActive===!0).catch(m)}};pI=g([(0,hs.injectable)(),p(0,(0,hs.inject)(Gi)),p(0,(0,hs.optional)()),p(1,(0,hs.inject)(lr)),p(2,(0,hs.inject)(Fe)),p(3,(0,hs.inject)(O)),p(4,(0,hs.inject)(qe)),p(5,(0,hs.inject)(Ke)),p(6,(0,hs.inject)(xt)),p(7,(0,hs.inject)(Ut))],pI);var dI=k(A()),O0=require("vscode");var bye=/^\s*(from (?<fromImport>\w+)(?:\.\w+)* import \w+(?:, \w+)*(?: as \w+)?|import (?<importImport>\w+(?:, \w+)*)(?: as \w+)?)$/,Iye=1e3,Sye=Pr(),fz=Symbol("IImportTracker"),Nf=class{constructor(e,t,n){this.vscNotebook=e;this.workspace=n;this.pendingChecks=new Bs;this.disposables=[];this.sentMatches=new Set;t.push(this),this.vscNotebook.onDidOpenNotebookDocument(i=>this.onOpenedOrClosedNotebookDocument(i,"onOpenCloseOrSave"),this.disposables),this.vscNotebook.onDidCloseNotebookDocument(i=>this.onOpenedOrClosedNotebookDocument(i,"onOpenCloseOrSave"),this.disposables),this.vscNotebook.onDidSaveNotebookDocument(i=>this.onOpenedOrClosedNotebookDocument(i,"onOpenCloseOrSave"),this.disposables),this.vscNotebook.onDidChangeNotebookCellExecutionState(i=>{i.state==O0.NotebookCellExecutionState.Pending&&!this.isTelemetryDisabled&&this.checkNotebookCell(i.cell,"onExecution").catch(m)},this,t)}get isTelemetryDisabled(){return Bw(this.workspace)}dispose(){G(this.disposables),this.pendingChecks.clear()}activate(){this.vscNotebook.notebookDocuments.forEach(e=>this.checkNotebookDocument(e,"onOpenCloseOrSave"))}getDocumentLines(e){let t=[];for(let n=0;n<Math.min(Iye,e.lineCount);n++){let i=e.lineAt(n);i.isEmptyOrWhitespace||t.push(i.text.trim())}return t}onOpenedOrClosedNotebookDocument(e,t){!Dt(e)||this.isTelemetryDisabled||this.scheduleCheck(e.uri,this.checkNotebookDocument.bind(this,e,t))}scheduleCheck(e,t){let n=this.pendingChecks.get(e);n&&(clearTimeout(n),this.pendingChecks.delete(e)),Sye?t():this.pendingChecks.set(e,setTimeout(t,5e3))}async checkNotebookDocument(e,t){!Dt(e)||this.isTelemetryDisabled||await Promise.all(e.getCells().map(async n=>this.checkNotebookCell(n,t)))}async checkNotebookCell(e,t){if(!(!Dt(e.notebook)||e.kind!==O0.NotebookCellKind.Code||e.document.languageId!==xe))try{let n=e.notebook.notebookType===Ct?"notebook":"interactive";await this.sendTelemetryForImports(this.getDocumentLines(e.document),n,t)}catch(n){if(!fi)throw n}}lookForImports(e){let t=[];try{for(let n of e){if(!n.includes("import")&&!n.includes("from"))continue;let i=n?bye.exec(n):null;i!==null&&i.groups!==void 0&&(i.groups.fromImport!==void 0?t.push(i.groups.fromImport):i.groups.importImport!==void 0&&t.push(...i.groups.importImport.split(",").map(o=>o.trim())))}}catch{}return t}async sendTelemetryForImports(e,t,n){await Promise.all(this.lookForImports(e).map(async i=>{let o=`${i}_${t||""}_${n}`;if(this.sentMatches.has(o))return;this.sentMatches.add(o);let s=await ht(i);R("HASHED_PACKAGE_NAME",void 0,{hashedNamev2:s,resourceType:t,when:n})}))}};Nf=g([(0,dI.injectable)(),p(0,(0,dI.inject)(qe)),p(1,(0,dI.inject)(O)),p(2,(0,dI.inject)(ce))],Nf);var sa=k(A());var mI=class{constructor(e,t,n,i,o,s){this.commandManager=e;this.disposableRegistry=t;this.configuration=n;this.documentManager=i;this.rawSupported=o;this.commandListeners=s;this.isDisposed=!1;this.startTime=Date.now();this.onSettingsChanged=()=>{let t=this.configuration.getSettings(void 0).sendSelectionToInteractiveWindow;new nr(fr.OwnsSelection,this.commandManager).set(t).catch(m)}}get activationStartTime(){return this.startTime}activate(){this.onSettingsChanged(),this.changeHandler=this.configuration.getSettings(void 0).onDidChange(this.onSettingsChanged.bind(this)),this.disposableRegistry.push(this),this.disposableRegistry.push(this.documentManager.onDidChangeActiveTextEditor(()=>this.onChangedActiveTextEditor())),this.onChangedActiveTextEditor(),this.computeZmqAvailable(),this.commandListeners&&this.commandListeners.forEach(e=>e.register(this.commandManager))}async dispose(){this.changeHandler&&(this.changeHandler.dispose(),this.changeHandler=void 0)}computeZmqAvailable(){new nr(fr.ZmqAvailable,this.commandManager).set(this.rawSupported?this.rawSupported.isSupported:!1).then(m,m)}onChangedActiveTextEditor(){let e=new nr(fr.HasCodeCells,this.commandManager),t=this.documentManager.activeTextEditor;t&&t.document.languageId===xe?e.set(yG(t.document,this.configuration.getSettings())).catch(m):e.set(!1).catch(m)}};mI=g([(0,sa.injectable)(),p(0,(0,sa.inject)(Fe)),p(1,(0,sa.inject)(O)),p(2,(0,sa.inject)(se)),p(3,(0,sa.inject)(lr)),p(4,(0,sa.inject)(wi)),p(4,(0,sa.optional)()),p(5,(0,sa.multiInject)(Th))],mI);var _i=k(A()),K0=require("vscode");var Ic=k(A()),nL=require("vscode");var tL="JUPYTER_API_ACCESS_INFORMATION",hz=new Set([bt.split(".")[0],"rchiodo","donjayamanne","SynapseVSCode"]),rL=new Set(["rchiodo","nuant"]),Ru=class{constructor(e,t,n,i,o){this.globalState=e;this.appShell=t;this.context=n;this.env=i;this.extensions=o;this.extensionAccess=new Map;this.promiseChain=new ch}async getAccessInformation(e){let t=!e.extensionId||e.extensionId===AS?"":e.extensionId.split(".")[0]||"";if(this.context.extensionMode===nL.ExtensionMode.Test||!t||this.env.channel==="insiders"){if(!hz.has(t)&&!rL.has(t)){J(`Publisher ${t} is allowed to access the Kernel API with a message.`);let s=this.extensions.getExtension(e.extensionId)?.packageJSON?.displayName||"",a=s&&e.extensionId?`${s} (${e.extensionId})`:e.extensionId||t;this.appShell.showErrorMessage(y.thanksForUsingJupyterKernelApiPleaseRegisterWithUs(a)).then(m,m)}if(!rL.has(t)||!t||this.context.extensionMode===nL.ExtensionMode.Test)return{extensionId:e.extensionId,accessAllowed:!0}}if(hz.has(t))return{extensionId:e.extensionId,accessAllowed:!0};if(!rL.has(t))return this.appShell.showErrorMessage(`Please contact the Jupyter Extension to get access to the Kernel API. Publisher ${t}`).then(m,m),C(`Publisher ${t} is not allowed to access the Kernel API.`),{extensionId:e.extensionId,accessAllowed:!1};let i=this.globalState.get(tL)?.find(s=>s.extensionId===e.extensionId);if(i)return R("DATASCIENCE.JUPYTER_KERNEL_API_ACCESS",void 0,{extensionId:e.extensionId,allowed:i.allowed}),{extensionId:e.extensionId,accessAllowed:i.allowed==="yes"};if(this.extensionAccess.get(e.extensionId))return this.extensionAccess.get(e.extensionId);let o=(async()=>{let s=y.allowExtensionToUseJupyterKernelApi(`${e.displayName} (${e.extensionId})`,ye.bannerLabelYes),l=await this.appShell.showInformationMessage(s,{modal:!0},ye.bannerLabelYes,ye.bannerLabelNo)===ye.bannerLabelYes;return this.promiseChain.chainFinally(async()=>{let c=[...this.globalState.get(tL,[])];return c=c.filter(u=>u.extensionId!==e.extensionId),c.push({allowed:l?"yes":"no",extensionId:e.extensionId}),this.globalState.update(tL,c)}).then(m,m),R("DATASCIENCE.JUPYTER_KERNEL_API_ACCESS",void 0,{extensionId:e.extensionId,allowed:l?"yes":"no"}),{extensionId:e.extensionId,accessAllowed:l}})();return this.extensionAccess.set(e.extensionId,o),o}};Ru=g([(0,Ic.injectable)(),p(0,(0,Ic.inject)(He)),p(0,(0,Ic.named)(It)),p(1,(0,Ic.inject)(ue)),p(2,(0,Ic.inject)(dt)),p(3,(0,Ic.inject)(An)),p(4,(0,Ic.inject)(rr))],Ru);var fI=class{constructor(e,t,n,i,o,s,a,l){this.kernelProvider=e;this.kernelFinder=t;this.thirdPartyKernelProvider=n;this.disposables=i;this.controllerRegistration=o;this.apiAccess=s;this.extensions=a;this.serviceContainer=l;this.chainedApiAccess=new ch;this.extensionApi=new Map}async getService(){let e=this.extensions.determineExtensionFromCallStack(),t=await this.chainedApiAccess.chainFinally(()=>this.apiAccess.getAccessInformation(e));if(!t.accessAllowed)return;if(this.extensionApi.get(t.extensionId))return this.extensionApi.get(t.extensionId);let n=new iE(t.extensionId,this.kernelProvider,this.kernelFinder,this.thirdPartyKernelProvider,this.disposables,this.controllerRegistration,this.serviceContainer);return this.extensionApi.set(t.extensionId,n),n}};fI=g([(0,_i.injectable)(),p(0,(0,_i.inject)(Ke)),p(1,(0,_i.inject)(Wr)),p(2,(0,_i.inject)(um)),p(3,(0,_i.inject)(O)),p(4,(0,_i.inject)(xt)),p(5,(0,_i.inject)(Ru)),p(6,(0,_i.inject)(rr)),p(7,(0,_i.inject)(ct))],fI);var iE=class{constructor(e,t,n,i,o,s,a){this.callingExtensionId=e;this.kernelProvider=t;this.kernelFinder=n;this.thirdPartyKernelProvider=i;this.disposables=o;this.controllerRegistration=s;this.serviceContainer=a;this._onDidChangeKernelSpecifications=new K0.EventEmitter;this._onDidChangeKernels=new K0.EventEmitter;this.translatedConnections=new WeakMap;this._onDidChangeStatus=new K0.EventEmitter;this._status=this.kernelFinder.status,this.kernelFinder.onDidChangeStatus(()=>{this._status=this.kernelFinder.status,this._onDidChangeStatus.fire()},this,o),this.kernelProvider.onDidDisposeKernel(l=>{te(`Kernel ${l.kernelConnectionMetadata.id}, ${l.kernelConnectionMetadata.interpreter?.uri.toString()} disposed`),this._onDidChangeKernels.fire()},this,o),this.kernelProvider.onDidStartKernel(l=>{te(`Kernel ${l.kernelConnectionMetadata.id}, ${l.kernelConnectionMetadata.interpreter?.uri.toString()} started`),this._onDidChangeKernels.fire()},this,o),this.thirdPartyKernelProvider.onDidDisposeKernel(l=>{te(`Third party Kernel ${l.kernelConnectionMetadata.id}, ${l.kernelConnectionMetadata.interpreter?.uri.toString()} disposed`),this._onDidChangeKernels.fire()},this,o),this.thirdPartyKernelProvider.onDidStartKernel(l=>{te(`Third party Kernel ${l.kernelConnectionMetadata.id}, ${l.kernelConnectionMetadata.interpreter?.uri.toString()} started`),this._onDidChangeKernels.fire()},this,o),this.controllerRegistration.onDidChange(()=>this._onDidChangeKernelSpecifications.fire(),this,o)}get onDidChangeKernelSpecifications(){return R("DATASCIENCE.JUPYTER_KERNEL_API_USAGE",void 0,{extensionId:this.callingExtensionId,pemUsed:"onDidChangeKernelSpecifications"}),w(`API called from ${this.callingExtensionId}`),this._onDidChangeKernelSpecifications.event}get onDidChangeKernels(){return R("DATASCIENCE.JUPYTER_KERNEL_API_USAGE",void 0,{extensionId:this.callingExtensionId,pemUsed:"onDidChangeKernels"}),this._onDidChangeKernels.event}get status(){return this._status}get onDidChangeStatus(){return this._onDidChangeStatus.event}async getKernelSpecifications(){return R("DATASCIENCE.JUPYTER_KERNEL_API_USAGE",void 0,{extensionId:this.callingExtensionId,pemUsed:"getKernelSpecifications"}),this.kernelFinder.kernels.map(e=>this.translateKernelConnectionMetadataToExportedType(e))}getActiveKernels(){R("DATASCIENCE.JUPYTER_KERNEL_API_USAGE",void 0,{extensionId:this.callingExtensionId,pemUsed:"getActiveKernels"});let e=[],t=new Set;return this.kernelProvider.kernels.filter(n=>n.startedAtLeastOnce||n.kernelConnectionMetadata.kind==="connectToLiveRemoteKernel").forEach(n=>{let i=this.kernelProvider.get(n.notebook);i&&i.session?.kernel?.id&&t.add(i.session.kernel.id),e.push({metadata:this.translateKernelConnectionMetadataToExportedType(n.kernelConnectionMetadata),uri:n.uri,id:n.id})}),this.thirdPartyKernelProvider.kernels.filter(n=>n.startedAtLeastOnce||n.kernelConnectionMetadata.kind==="connectToLiveRemoteKernel").forEach(n=>{let i=this.thirdPartyKernelProvider.get(n.uri);i&&i.session?.kernel?.id&&t.add(i.session.kernel.id),e.push({metadata:this.translateKernelConnectionMetadataToExportedType(n.kernelConnectionMetadata),uri:n.uri,id:n.id})}),this.controllerRegistration.registered.forEach(n=>{n.controller.notebookType===Ct&&n.connection.kind==="connectToLiveRemoteKernel"&&(!n.connection.kernelModel.id||t.has(n.connection.kernelModel.id)||e.push({metadata:n.connection,uri:void 0,id:n.id}))}),e}getKernel(e){R("DATASCIENCE.JUPYTER_KERNEL_API_USAGE",void 0,{extensionId:this.callingExtensionId,pemUsed:"getKernel"});let t=this.thirdPartyKernelProvider.get(e)??this.kernelProvider.get(e);if(t?.session)return{metadata:this.translateKernelConnectionMetadataToExportedType(t.kernelConnectionMetadata),connection:t.session}}async startKernel(e,t){return R("DATASCIENCE.JUPYTER_KERNEL_API_USAGE",void 0,{extensionId:this.callingExtensionId,pemUsed:"startKernel"}),this.startOrConnect(e,t)}async connect(e,t){return R("DATASCIENCE.JUPYTER_KERNEL_API_USAGE",void 0,{extensionId:this.callingExtensionId,pemUsed:"connect"}),this.startOrConnect(e,t)}async startOrConnect(e,t){let n=this.kernelFinder.kernels.find(o=>o.id===e.id);if(!n)throw new Error("Not found");let i=await Ys.connectToKernel(n,this.serviceContainer,{resource:t},new er(!1),this.disposables,"3rdPartyExtension");if(!i?.session)throw new Error("Not found");return i.session}translateKernelConnectionMetadataToExportedType(e){if(!this.translatedConnections.has(e)){let t=Object.freeze(Rs.fromJSON(e.toJSON()));this.translatedConnections.set(e,t)}return this.translatedConnections.get(e)}};iE=g([p(1,(0,_i.inject)(Ke)),p(2,(0,_i.inject)(Wr)),p(3,(0,_i.inject)(um)),p(4,(0,_i.inject)(O)),p(5,(0,_i.inject)(xt)),p(6,(0,_i.inject)(ct))],iE);var hI=k(A());var Af=class{constructor(e,t,n){this.documentManager=e;this.workspaceService=t;this.fileSystem=n;this.activatedWorkspaces=new Set;this.disposables=[]}activate(){this.addHandlers(),this.addRemoveDocOpenedHandlers(),this.activateWorkspace(this.getActiveResource()).catch(m)}getActiveResource(){let e=this.documentManager.activeTextEditor;return e&&!e.document.isUntitled?e.document.uri:Array.isArray(this.workspaceService.workspaceFolders)&&this.workspaceService.workspaceFolders.length>0?this.workspaceService.workspaceFolders[0].uri:void 0}async activateWorkspace(e){let t=this.getWorkspaceKey(e);this.activatedWorkspaces.has(t)||(this.activatedWorkspaces.add(t),await QJ(this.fileSystem,this.workspaceService,e))}onDocOpened(e){if(e.languageId!==xe)return;let t=this.getWorkspaceKey(e.uri);if(t===""&&this.workspaceService.hasWorkspaceFolders||this.activatedWorkspaces.has(t))return;let n=this.workspaceService.getWorkspaceFolder(e.uri);this.activateWorkspace(n?n.uri:void 0).catch(m)}addHandlers(){this.disposables.push(this.workspaceService.onDidChangeWorkspaceFolders(this.onWorkspaceFoldersChanged,this))}addRemoveDocOpenedHandlers(){if(this.hasMultipleWorkspaces()){this.docOpenedHandler||(this.docOpenedHandler=this.documentManager.onDidOpenTextDocument(this.onDocOpened,this));return}this.docOpenedHandler&&(this.docOpenedHandler.dispose(),this.docOpenedHandler=void 0)}onWorkspaceFoldersChanged(){let e=this.workspaceService.workspaceFolders.map(i=>this.getWorkspaceKey(i.uri)),n=Array.from(this.activatedWorkspaces.keys()).filter(i=>e.indexOf(i)<0);if(n.length>0)for(let i of n)this.activatedWorkspaces.delete(i);this.addRemoveDocOpenedHandlers()}hasMultipleWorkspaces(){return this.workspaceService.hasWorkspaceFolders&&this.workspaceService.workspaceFolders.length>1}getWorkspaceKey(e){return this.workspaceService.getWorkspaceFolderIdentifier(e,"")}};g([vh("Failed to activate a workspace")],Af.prototype,"activateWorkspace",1),Af=g([(0,hI.injectable)(),p(0,(0,hI.inject)(lr)),p(1,(0,hI.inject)(ce)),p(2,(0,hI.inject)(Ze))],Af);var vI=k(A());var gI=class{constructor(e){this.syncActivationServices=e}activate(){this.syncActivationServices.map(e=>{try{e.activate()}catch(t){C(`Error in activating extension, failed in ${e.constructor.name}`,t)}})}};gI=g([(0,vI.injectable)(),p(0,(0,vI.optional)()),p(0,(0,vI.multiInject)(Ie))],gI);var Sc=k(A()),F0=require("vscode");var iL=Symbol("ISurveyBanner");var xc=class{constructor(e,t,n,i,o,s,a){this.appShell=e;this.persistentState=t;this.browserService=n;this.applicationEnvironment=i;this.vscodeNotebook=o;this.isCodeSpace=s;this.disposables=a;this.disabledInCurrentSession=!1;this.bannerLabels=[Kw.bannerLabelYes,Kw.bannerLabelNo];this.showBannerState=new Map;this.NotebookExecutionThreshold=250;this.setPersistentState(0,"ShowInsidersNotebookSurveyBanner"),this.setPersistentState(1,"ShowExperimentNotebookSurveyBanner"),setTimeout(()=>{xc.surveyDelay=!0},10*60*1e3)}isEnabled(e){switch(e){case 0:if(this.applicationEnvironment.channel==="insiders")return this.isEnabledInternal(e);break;case 1:if(this.applicationEnvironment.channel==="stable")return this.isEnabledInternal(e);break;default:return C("Invalid Banner Type"),!1}return!1}isEnabledInternal(e){return this.applicationEnvironment.uiKind!==F0.UIKind.Desktop?!1:this.showBannerState.get(e).value.expiry?this.showBannerState.get(e).value.expiry<Date.now():!0}activate(){this.vscodeNotebook.onDidChangeNotebookCellExecutionState(this.onDidChangeNotebookCellExecutionState,this,this.disposables)}async showBanner(e){if(!this.shouldShowBanner(e))return;switch(this.disabledInCurrentSession=!0,await this.appShell.showInformationMessage(this.getBannerMessage(e),...this.bannerLabels)){case this.bannerLabels[0]:{await this.launchSurvey(e),await this.disable(0,e);break}default:{await this.disable(1,e);break}}}shouldShowBanner(e){return this.isCodeSpace||!this.isEnabled(e)||this.disabledInCurrentSession||!xc.surveyDelay?!1:this.getExecutionCount(e)>=this.NotebookExecutionThreshold}setPersistentState(e,t){this.showBannerState.set(e,this.persistentState.createGlobalPersistentState(t,{data:!0}))}async launchSurvey(e){this.browserService.launch(this.getSurveyLink(e))}async disable(e,t){let n=e===0?6:4;n&&await this.showBannerState.get(t).updateValue({expiry:n*31*864e5+Date.now(),data:!0})}getExecutionCount(e){switch(e){case 0:return this.getPersistentState("DS_InsidersNotebookExecutionCount");case 1:return this.getPersistentState("DS_ExperimentNotebookExecutionCount");default:return C("Invalid Banner type"),-1}}getPersistentState(e){return this.persistentState.createGlobalPersistentState(e,0).value}async onDidChangeNotebookCellExecutionState(e){Dt(e.cell.notebook)&&e.state===F0.NotebookCellExecutionState.Executing&&(this.updateStateAndShowBanner("DS_InsidersNotebookExecutionCount",0).catch(m),this.updateStateAndShowBanner("DS_ExperimentNotebookExecutionCount",1).catch(m))}async updateStateAndShowBanner(e,t){let n=this.persistentState.createGlobalPersistentState(e,0);await n.updateValue(n.value+1),this.showBanner(t).catch(m)}getBannerMessage(e){switch(e){case 0:case 1:return KN.bannerMessage;default:return C("Invalid Banner type"),""}}getSurveyLink(e){switch(e){case 0:return"https://aka.ms/vscjupyternb";case 1:return"https://aka.ms/vscnbexp";default:return C("Invalid Banner type"),""}}};xc.surveyDelay=!1,xc=g([(0,Sc.injectable)(),p(0,(0,Sc.inject)(ue)),p(1,(0,Sc.inject)(Sl)),p(2,(0,Sc.inject)(ks)),p(3,(0,Sc.inject)(An)),p(4,(0,Sc.inject)(qe)),p(5,(0,Sc.inject)(op)),p(6,(0,Sc.inject)(O))],xc);var Ya=require("vscode");function gz(r,e){e&&Ya.commands.registerCommand("dataScience.ClearCache",async()=>{let t=[];for(let n of r.globalState.keys())t.push(r.globalState.update(n,void 0).then(m,m));for(let n of r.workspaceState.keys())t.push(r.workspaceState.update(n,void 0).then(m,m));t.push(Ya.commands.executeCommand(V.ClearSavedJupyterUris).then(m,m)),await Promise.all(t).catch(m),await Promise.all([Ya.workspace.fs.delete(Ya.Uri.joinPath(r.globalStorageUri,"lastExecutedRemoteCell.json")).then(m,m),Ya.workspace.fs.delete(Ya.Uri.joinPath(r.globalStorageUri,"remoteServersMRUList.json")).then(m,m),Ya.workspace.fs.delete(Ya.Uri.joinPath(r.globalStorageUri,ly)).then(m,m)]),H("Cache cleared")})}function vz(r,e){gz(r,e)}var bI=k(A()),dr=require("vscode");var L0=y.percentPipCondaInstallInsteadOfBang("pip"),oL=y.percentPipCondaInstallInsteadOfBang("conda"),yz=y.matplotlibWidgetInsteadOfOther,U0="Jupyter",yI=class{constructor(e,t,n){this.notebooks=e;this.documents=n;this.disposables=[];this.notebooksProcessed=new WeakMap;this.cellsToProcess=new Set;this.problems=dr.languages.createDiagnosticCollection(U0),this.disposables.push(this.problems),t.push(this)}dispose(){G(this.disposables),this.problems.dispose()}activate(){this.disposables.push(dr.languages.registerCodeActionsProvider(xe,this)),this.disposables.push(dr.languages.registerHoverProvider(xe,this)),this.documents.onDidChangeTextDocument(e=>{let t=mp(e.document);if(!t)return;let n=t.getCells().find(i=>i.document===e.document);n&&this.analyzeNotebookCell(n)},this,this.disposables),this.notebooks.onDidCloseNotebookDocument(e=>{this.problems.delete(e.uri);let t=this.notebooksProcessed.get(e);this.notebooksProcessed.delete(e),t&&t.forEach((n,i)=>this.problems.delete(dr.Uri.parse(i)))},this,this.disposables),this.notebooks.onDidOpenNotebookDocument(e=>this.analyzeNotebook(e),this,this.disposables),dr.workspace.onDidChangeNotebookDocument(e=>{let t=this.notebooksProcessed.get(e.notebook);e.contentChanges.forEach(n=>{n.removedCells.forEach(i=>{t?.delete(i.document.uri.toString())}),n.addedCells.forEach(i=>this.queueCellForProcessing(i))}),e.cellChanges.forEach(n=>this.queueCellForProcessing(n.cell))},this,this.disposables),this.notebooks.notebookDocuments.map(e=>this.analyzeNotebook(e))}provideHover(e,t,n){if(mp(e)?.notebookType!==Ct)return;let o=this.problems.get(e.uri);if(!o)return;let s=o.find(l=>l.message===L0||l.message===oL);if(!s||!s.range.contains(t))return;let a=s.message===L0?"pip":"conda";return new dr.Hover(y.pipCondaInstallHoverWarning(a,"https://aka.ms/jupyterCellMagicBangInstall"),s.range)}provideCodeActions(e,t,n,i){if(!mp(e))return[];let o=[];return n.diagnostics.forEach(s=>{switch(s.message){case L0:o.push(this.createReplaceCodeAction(e,"pip",s));break;case oL:o.push(this.createReplaceCodeAction(e,"conda",s));break;case yz:o.push(this.createGotoWikiAction(e,dr.Uri.parse("https://aka.ms/vscodejupytermatplotlibwidget"),s));break;default:break}}),o}createReplaceCodeAction(e,t,n){let i=new dr.CodeAction(y.replacePipCondaInstallCodeAction(t),dr.CodeActionKind.QuickFix);i.isPreferred=!0,i.diagnostics=[n];let o=new dr.WorkspaceEdit;return o.replace(e.uri,new dr.Range(n.range.start,new dr.Position(n.range.start.line,n.range.start.character+1)),"%"),i.edit=o,i}createGotoWikiAction(e,t,n){let i=new dr.CodeAction(y.matplotlibWidgetCodeActionTitle,dr.CodeActionKind.QuickFix);return i.isPreferred=!0,i.diagnostics=[n],i.command={title:y.matplotlibWidgetCodeActionTitle,command:"vscode.open",arguments:[t]},i}analyzeNotebook(e){e.notebookType===Ct&&e.getCells().forEach((t,n)=>n<100?this.queueCellForProcessing(t):void 0)}queueCellForProcessing(e){this.cellsToProcess.add(e),this.analyzeNotebookCells()}analyzeNotebookCells(){if(this.cellsToProcess.size===0)return;let e=this.cellsToProcess.values().next().value;this.cellsToProcess.delete(e),this.analyzeNotebookCell(e),setTimeout(()=>this.analyzeNotebookCells(),0)}analyzeNotebookCell(e){if(e.kind!==dr.NotebookCellKind.Code||e.document.languageId!==xe||e.notebook.isClosed||e.document.isClosed||this.notebooksProcessed.get(e.notebook)?.get(e.document.uri.toString())===e.document.version)return;this.problems.delete(e.document.uri);let t=this.notebooksProcessed.get(e.notebook)||new Map;t.set(e.document.uri.toString(),e.document.version),this.notebooksProcessed.set(e.notebook,t);for(let n=0;n<Math.min(e.document.lineCount,50);n++){let i=e.document.lineAt(n),o=i.text;if(o.trim().startsWith("!pip install")){let s=o.indexOf("!"),a=o.indexOf("l"),l=new dr.Range(i.lineNumber,s,i.lineNumber,a+2);this.problems.set(e.document.uri,[{message:L0,range:l,severity:dr.DiagnosticSeverity.Error,source:U0}])}else if(o.trim().startsWith("!conda install")){let s=o.indexOf("!"),a=o.indexOf("l"),l=new dr.Range(i.lineNumber,s,i.lineNumber,a+2);this.problems.set(e.document.uri,[{message:oL,range:l,severity:dr.DiagnosticSeverity.Error,source:U0}])}else if(o.trim().startsWith("%matplotlib")&&!o.trim().endsWith("widget")&&!o.trim().endsWith("inline")){let s=o.indexOf("%"),a=o.length,l=new dr.Range(i.lineNumber,s,i.lineNumber,a);this.problems.set(e.document.uri,[{message:yz,range:l,severity:dr.DiagnosticSeverity.Warning,source:U0}])}}}};yI=g([(0,bI.injectable)(),p(0,(0,bI.inject)(qe)),p(1,(0,bI.inject)(O)),p(2,(0,bI.inject)(lr))],yI);var aa=k(A());var II=require("vscode");var Iz=k(ql()),Sz=k(po());function bz(r,e){return r[e]===void 0&&(r[e]={}),r[e]}var sL=class{constructor(e){this.executeCommandRequest=e;this._id=(0,Sz.default)();this._commands=new Map;this.fillInitializeParams=void 0;this.preInitialize=void 0}getState(){return{kind:"workspace",id:this._id,registrations:!0}}get registrationType(){return this.executeCommandRequest.type}fillClientCapabilities(e){bz(bz(e,"workspace"),"executeCommand").dynamicRegistration=!0}initialize(e){e.executeCommandProvider&&this.register({id:this._id,registerOptions:Object.assign({},e.executeCommandProvider)})}register(e){H("Registering dummy command feature")}unregister(e){let t=this._commands.get(e);t&&t.forEach(n=>n.dispose())}dispose(){this._commands.forEach(e=>{e.forEach(t=>t.dispose())}),this._commands.clear()}},W0=class r{constructor(e,t,n,i){this.interpreter=t;this.middleware=n;this.disposables=i;this._client=e,this._interpreterId=ar(t.uri),II.workspace.onDidChangeNotebookDocument(this.onDidChangeNotebookDocument,this,i)}async dispose(){if(!this._client)return;te(`Disposing Language Server for ${W(this.interpreter.id)}`);let e=this._client;this._client=void 0,this.disposables.forEach(t=>t.dispose()),this.middleware.dispose(),await e.stop(),await e.dispose()}get client(){return this._client}get interpreterId(){return this._interpreterId}stopWatching(e){try{this.middleware.stopWatching(e)}catch(t){te("Error shutting down the LS.",t)}}startWatching(e){this.middleware.startWatching(e)}static async createLanguageServer(e,t,n){let i=await r.createServerOptions(e);if(i){let o,s=II.window.createOutputChannel(`${e.displayName||"notebook"}-languageserver`),a=ar(e.uri),{createNotebookMiddleware:l}=await import("@vscode/jupyter-lsp-middleware"),c=l(()=>o,()=>m,Vd,we(e.uri),D=>t(D,a,e.uri),n),{RevealOutputChannelOn:u,ExecuteCommandRequest:d,LanguageClient:f}=await import("vscode-languageclient/node"),h={documentSelector:Vd,workspaceFolder:void 0,synchronize:{configurationSection:xe},outputChannel:s,revealOutputChannelOn:u.Never,middleware:c,initializationOptions:{notebookServer:!0}},v=new f("notebook-intellisense",i,h),b=v._features.filter(D=>D.registrationType?.method!="workspace/executeCommand");return b.push(new sL(d)),v._features=b,await v.start(),o=v,new r(v,e,c,[s])}}onDidChangeNotebookDocument(e){e.notebook&&e.contentChanges.length&&this.middleware.refresh(e.notebook)}static async createServerOptions(e){return r.createJediLSPServerOptions(e)}static async createJediLSPServerOptions(e){let t=II.extensions.getExtension("ms-python.python");if(t){let n=Ue(t.extensionPath,"pythonFiles","run-jedi-language-server.py");if(await Iz.pathExists(n)){let i=we(e.uri);return{command:i.length>0?i:"python",args:[n]}}}}};var Mf=k(A()),Td=require("vscode");var Cc=class{constructor(e,t,n,i){this.apiProvider=e;this.extensionChecker=t;this.notebookEditorProvider=n;this.controllerRegistration=i;this._isPylanceExtensionInstalled()||(this.extensionChangeHandler=Td.extensions.onDidChange(this.extensionsChangeHandler.bind(this)))}activate(){!this.isUsingPylance()||!this.extensionChecker.isPythonExtensionInstalled||this.apiProvider.getApi().then(e=>{e.registerJupyterPythonPathFunction!==void 0&&e.registerJupyterPythonPathFunction(t=>this._jupyterPythonPathFunction(t)),e.registerGetNotebookUriForTextDocumentUriFunction!==void 0&&e.registerGetNotebookUriForTextDocumentUriFunction(t=>this._getNotebookUriForTextDocumentUri(t))}).catch(m)}async reset(){this._isEnabled=void 0,await this.activate()}_isPylanceExtensionInstalled(){return Td.extensions.getExtension(Bd)!==void 0}async extensionsChangeHandler(){this._isPylanceExtensionInstalled()&&this.extensionChangeHandler&&(this.extensionChangeHandler.dispose(),this.extensionChangeHandler=void 0,await this.reset())}isUsingPylance(){if(this._isEnabled===void 0){let t=Td.workspace.getConfiguration("python")?.get("languageServer");this._isEnabled=!1,t!=="Pylance"&&t!=="Default"?H("Not using Pylance"):(this._isEnabled=!0,H("Using Pylance"))}return this._isEnabled}async _jupyterPythonPathFunction(e){let t=this.notebookEditorProvider.findAssociatedNotebookDocument(e);if(!t)return;let n=this.controllerRegistration.getSelected(t);if(n&&Ft(n.connection))return"";let i=n?.connection?.interpreter;return i?we(i.uri):(J(`No interpreter for Pylance for Notebook URI "${W(t.uri)}"`),"")}_getNotebookUriForTextDocumentUri(e){let t=Cye(e);if(!t)return;let n;return Td.window.tabGroups.all.find(i=>{i.tabs.find(o=>{if(kf(o)){let s=o.input.uri.toString();o.input.uri.toString().endsWith(t.path)&&(n=s)}})}),n}};Cc=g([(0,Mf.injectable)(),p(0,(0,Mf.inject)(Xt)),p(1,(0,Mf.inject)(ze)),p(2,(0,Mf.inject)(Tn)),p(3,(0,Mf.inject)(xt))],Cc);function Cye(r){if(r.scheme!=="vscode-interactive-input")return;let e=`${r.path.replace("InteractiveInput-","Interactive-")}.interactive`;return Td.workspace.notebookDocuments.find(t=>t.uri.path===e)?.uri}var Eye="",SI=class{constructor(e,t,n,i,o,s,a,l,c){this.disposables=e;this.controllerRegistration=t;this.notebookEditorProvider=n;this.notebooks=i;this.interpreterService=o;this.workspaceService=s;this.extensionChecker=a;this.configService=l;this.notebookPythonPathService=c;this.servers=new Map;this.activeInterpreterCache=new Map;this.knownControllers=new WeakMap}activate(){this.controllerRegistration.onControllerSelected(this.controllerChanged,this,this.disposables),this.notebooks.onDidOpenNotebookDocument(this.openedNotebook,this,this.disposables),this.notebooks.onDidCloseNotebookDocument(this.closedNotebook,this,this.disposables),this.notebooks.notebookDocuments.forEach(e=>this.openedNotebook(e).catch(m)),this.getActiveInterpreterSync(void 0),this.interpreterService.onDidChangeInterpreter(this.handleInterpreterChange,this,this.disposables),this.workspaceService.onDidChangeConfiguration(this.onDidChangeConfiguration,this,this.disposables)}async getLanguageClient(e){let t=this.controllerRegistration.getSelected(e),n=t?t.connection.interpreter:await this.interpreterService.getActiveInterpreter(e.uri),i=n?ar(n.uri):void 0;return(i?await this.servers.get(i):void 0)?.client}async getCompletions(e,t,n,i,o){let s=await this.getLanguageClient(e);if(s){let l=s.getFeature("textDocument/completion").getProvider(t);if(l){let c=await l.provideCompletionItems(t,n,o,i);return c&&"items"in c?c.items:c}}}handleInterpreterChange(){this.activeInterpreterCache.clear(),this.getActiveInterpreterSync(void 0)}getActiveInterpreterSync(e){if(!this.extensionChecker.isPythonExtensionInstalled)return;let t=this.workspaceService.getWorkspaceFolder(e)?.uri||(this.workspaceService.rootFolder?this.workspaceService.rootFolder:void 0),n=t?ar(t):Eye;return this.activeInterpreterCache.has(n)||this.interpreterService.getActiveInterpreter(t).then(i=>{this.activeInterpreterCache.set(n,i)}).catch(m),this.activeInterpreterCache.get(n)}async controllerChanged(e){if(!this.notebookPythonPathService.isUsingPylance()){let t=await this.ensureLanguageServer(e.controller.connection.interpreter,e.notebook),n=this.knownControllers.get(e.notebook),i=n?n.connection.interpreter:this.getActiveInterpreterSync(e.notebook.uri),o=i?ar(i.uri):void 0,s=o?await this.servers.get(o):void 0;s&&t?.interpreterId!=s.interpreterId&&s.stopWatching(e.notebook),t&&t.startWatching(e.notebook)}this.knownControllers.set(e.notebook,e.controller)}async openedNotebook(e){if(Dt(e)&&this.extensionChecker.isPythonExtensionInstalled&&!this.notebookPythonPathService.isUsingPylance()){let t=this.controllerRegistration.getSelected(e);t&&this.knownControllers.set(e,t),this.getActiveInterpreterSync(e.uri);let n=t?.connection.interpreter||await this.interpreterService.getActiveInterpreter(e.uri),i=await this.ensureLanguageServer(n,e);i&&i.startWatching(e)}}closedNotebook(e){this.knownControllers.delete(e)}shouldAllowIntellisense(e,t,n){let i=this.notebookEditorProvider.findAssociatedNotebookDocument(e),o=i?this.controllerRegistration.getSelected(i):void 0,s=o?o.connection.interpreter:this.getActiveInterpreterSync(e),a=s?ar(s.uri):void 0;if(t!==a&&(o?.connection.kind==="startUsingRemoteKernelSpec"||o?.connection.kind==="connectToLiveRemoteKernel")){let c=this.getActiveInterpreterSync(e);a=c?ar(c.uri):void 0}let l=i?.getCells().find(c=>c.document.uri.toString()===e.toString());return t==a&&(!l||l.document.languageId==="python")}getNotebookHeader(e){let n=this.configService.getSettings(e).runStartupCommands;return Array.isArray(n)&&(n=n.join(`
`)),n?n.replace(/\\n/g,`
`).replace(/\\r/g,"\r"):""}async ensureLanguageServer(e,t){let n=e?ar(e.uri):void 0;if(n&&!this.servers.has(n)&&e){let i=W0.createLanguageServer(e,this.shouldAllowIntellisense.bind(this),this.getNotebookHeader.bind(this)).then(o=>(o?.startWatching(t),o));this.servers.set(n,i)}return n?this.servers.get(n):void 0}onDidChangeConfiguration(e){e.affectsConfiguration("python.languageServer")&&(te("Dispose all language servers due to changes in configuration"),this.servers.forEach(t=>t.then(n=>n?.dispose())),this.servers.clear(),this.notebooks.notebookDocuments.forEach(t=>this.openedNotebook(t).catch(m)))}};SI=g([(0,aa.injectable)(),p(0,(0,aa.inject)(O)),p(1,(0,aa.inject)(xt)),p(2,(0,aa.inject)(Tn)),p(3,(0,aa.inject)(qe)),p(4,(0,aa.inject)(it)),p(5,(0,aa.inject)(ce)),p(6,(0,aa.inject)(ze)),p(7,(0,aa.inject)(se)),p(8,(0,aa.inject)(Cc))],SI);var _d=k(A()),xz=k(require("os")),Wt=k(require("vscode"));var xI=class{constructor(e,t,n,i,o){this.commandService=e;this.disposableRegistry=t;this.appShell=n;this.fs=i;this.configService=o;this.steps=[];this.index=-1}activate(){this.disposableRegistry.push(this.commandService.registerCommand(V.ReplayPylanceLog,this.replayPylanceLog,this)),this.disposableRegistry.push(this.commandService.registerCommand(V.ReplayPylanceLogStep,this.step,this)),this.isLogActive=new nr(fr.ReplayLogLoaded,this.commandService),this.isLogActive.set(!1).then(m,m)}async replayPylanceLog(){if(Wt.window.activeNotebookEditor){let e=await this.appShell.showOpenDialog({title:"Open Pylance Output Log"});e&&e.length===1&&(this.activeNotebook=Wt.window.activeNotebookEditor.notebook,this.steps=await this.parsePylanceLogSteps(e[0].fsPath),this.index=-1,this.isLogActive?.set(!0))}else this.appShell.showErrorMessage("Command should be run with a jupyter notebook open").then(m,m)}async step(){if(this.steps.length-1>this.index&&this.steps.length>0&&this.activeNotebook===Wt.window.activeNotebookEditor?.notebook&&this.activeNotebook){this.appShell.showInformationMessage(`Replaying step ${this.index+2} of ${this.steps.length}`).then(m,m),this.index+=1;let e=this.steps[this.index],t=e.contentChanges[0];if(e.textDocument.uri.includes("_NotebookConcat_")&&this.activeNotebook){let s=await this.getConverter();if(e.textDocument.uri=s.getConcatDocument(this.activeNotebook.cellAt(0).document.uri.toString()).concatUri?.toString(),s){let a={textDocument:{version:e.textDocument.version,uri:s.toNotebookUri(e.textDocument.uri,t.range)},contentChanges:[{text:t.text,range:s.toNotebookRange(e.textDocument.uri,t.range),rangeLength:t.rangeLength}]};if(t.text.startsWith(`import IPython
IPython.get_ipython()
`)){let l=t.text.slice(37).replace(" # type: ignore",""),c=this.activeNotebook.getCells().find(u=>a.textDocument.uri===u.document.uri.toString());c&&(a.contentChanges=[{text:l,range:new Wt.Range(new Wt.Position(0,0),new Wt.Position(c.document.lineCount,0)),rangeLength:c.document.getText().length}])}s.handleChange(a),e=a,t=a.contentChanges[0]}}else{let s=/(#ch\d+)/.exec(e.textDocument.uri),a=s!=null&&s.length>1?this.activeNotebook.cellAt(0).document.uri.toString().replace(/(#ch\d+)/,s[1]):e.textDocument.uri;e.textDocument.uri=a}H(`*** Replaying step: ${JSON.stringify(e,void 0,"  ")}`);let n=this.activeNotebook?.getCells().find(s=>s.document.uri.toString()===e.textDocument.uri);if(!n){let s=this.activeNotebook.cellCount,a=new Wt.WorkspaceEdit,l=new Wt.NotebookCellData(Wt.NotebookCellKind.Code,"",xe);l.outputs=[],l.metadata={};let c=Wt.NotebookEdit.insertCells(s,[l]);a.set(this.activeNotebook.uri,[c]),await Wt.workspace.applyEdit(a),n=this.activeNotebook.cellAt(this.activeNotebook.cellCount-1)}let i=new Wt.NotebookRange(n.index,n.index+1);Wt.window.activeNotebookEditor?.revealRange(i,Wt.NotebookEditorRevealType.InCenterIfOutsideViewport),await uh(async()=>Wt.window.visibleTextEditors.find(s=>s.document===n.document)!==void 0,3e3,10);let o=Wt.window.visibleTextEditors.find(s=>s.document===n.document);if(o){let s=new Wt.Range(new Wt.Position(t.range.start.line,t.range.start.character),new Wt.Position(t.range.end.line,t.range.end.character));o.revealRange(s,Wt.TextEditorRevealType.InCenterIfOutsideViewport),o.selection=new Wt.Selection(s.start,s.start),await Vn(100),await o.edit(a=>{t.text==""?a.delete(s):t.rangeLength>0?a.replace(s,t.text):a.insert(s.start,t.text)})}this.steps.length===this.index&&(kn(()=>this.isLogActive?.set(!1)),this.steps=[],this.index=-1)}else this.activeNotebook?.toString()!==Wt.window.activeNotebookEditor?.notebook.uri.toString()&&this.index<this.steps.length-1&&this.appShell.showErrorMessage("You changed the notebook editor in the middle of stepping through the log").then(m,m)}async parsePylanceLogSteps(e){let t=await this.fs.readFile(Wt.Uri.file(e)),n=[],i=/textDocument\/didChange'[\s\S]*?Params:\s(?<json_event>[\s\S]*?\n\})/g,o=null;for(;(o=i.exec(t))!=null;)if(o.index===i.lastIndex&&i.lastIndex++,o.groups&&o.groups.json_event){let s=JSON.parse(o.groups.json_event);n.push(s)}return n}getNotebookHeader(e){let n=this.configService.getSettings(e).runStartupCommands;return Array.isArray(n)&&(n=n.join(`
`)),n?n.replace(/\\n/g,`
`).replace(/\\r/g,"\r"):""}async getConverter(){if(!this.converter&&this.activeNotebook){let{createConverter:e}=await import("@vscode/lsp-notebook-concat"),t=e(n=>this.getNotebookHeader(this.activeNotebook.uri),()=>xz.platform());this.activeNotebook.getCells().filter(n=>Wt.languages.match(Vd,n.document)>0).forEach(n=>{t.handleOpen({textDocument:{uri:n.document.uri.toString(),text:n.document.getText(),languageId:n.document.languageId,version:n.document.version}})}),this.converter=t}return this.converter}};xI=g([(0,_d.injectable)(),p(0,(0,_d.inject)(Fe)),p(1,(0,_d.inject)(O)),p(2,(0,_d.inject)(ue)),p(3,(0,_d.inject)(Ze)),p(4,(0,_d.inject)(se))],xI);var V0=k(A()),Yn=require("vscode");var j0=new Map([["method",0],["function",1],["constructor",2],["field",3],["variable",4],["class",5],["struct",6],["interface",7],["module",8],["property",9],["event",10],["operator",11],["unit",12],["value",13],["constant",14],["enum",15],["enumMember",16],["keyword",17],["text",18],["color",19],["file",20],["reference",21],["customcolor",22],["folder",23],["typeParameter",24],["snippet",25],["<unknown>",3]]);function Of(r){if(r>=300)return"ZZZZZZZ";if(r<=25)return`A${String.fromCharCode(65+r)}`;let e=String.fromCharCode(65+Math.ceil(r/25)),t=String.fromCharCode(65+r%25);return`${e}${t}`}var aL=class{constructor(e,t,n,i){this.kernelId=e;this.kernel=t;this.monacoLanguage=n;this.toDispose=i;this.pendingCompletionRequest=new WeakMap;this.previousCompletionItems=new WeakMap}async provideCompletionItems(e,t,n,i){if(!this.kernel.session?.kernel)return[];if(this.pendingCompletionRequest.get(e)?.position.isEqual(t)&&this.pendingCompletionRequest.get(e)?.version===e.version)return[];this.pendingCompletionRequest.set(e,{position:t,version:e.version});try{let o=Gt(n,Promise.resolve(Yn.commands.executeCommand("vscode.executeCompletionItemProvider",e.uri,t)).then(c=>c?.items||[]));if(await Vn(100),n.isCancellationRequested)return[];let s=await this.provideCompletionItemsFromKernel(e,t,n);if(n.isCancellationRequested)return[];let a=await Dr(0,o),l=new Set((a||[]).map(c=>typeof c.label=="string"?c.label:c.label.label));return s.filter(c=>!l.has(typeof c.label=="string"?c.label:c.label.label))}finally{this.pendingCompletionRequest.get(e)?.position.isEqual(t)&&this.pendingCompletionRequest.get(e)?.version===e.version&&this.pendingCompletionRequest.delete(e)}}async provideCompletionItemsFromKernel(e,t,n){if(n.isCancellationRequested||!this.kernel.session?.kernel)return[];let i=new $e,o={duration:0,requestDuration:0,completionItems:0},s={kernelId:this.kernelId,kernelConnectionType:this.kernel.kernelConnectionMetadata.kind,kernelLanguage:q0(this.kernel),monacoLanguage:this.monacoLanguage,cancelled:!1,kernelStatusBeforeRequest:this.kernel.status,completed:!1,requestSent:!1};if(this.kernel.status!=="idle")return R("DATASCIENCE.JUPYTER_KERNEL_CODE_COMPLETION",o,s),[];let a=e.getText(),l=e.offsetAt(t);s.requestSent=!0;let c=await Gt(n,this.kernel.session.kernel.requestComplete({code:a,cursor_pos:l}));if(w(`Jupyter completion time: ${i.elapsedTime}`),s.cancelled=n.isCancellationRequested,s.completed=!n.isCancellationRequested,s.kernelStatusAfterRequest=this.kernel.status,o.requestDuration=n.isCancellationRequested?0:i.elapsedTime,n.isCancellationRequested||c?.content?.status!=="ok"||(c?.content?.matches?.length??0)===0)return R("DATASCIENCE.JUPYTER_KERNEL_CODE_COMPLETION",o,s),[];let u={matches:c.content.matches,cursor:{start:c.content.cursor_start,end:c.content.cursor_end},metadata:c.content.metadata},d=u.metadata?u.metadata._jupyter_types_experimental:[];o.completionItems=u.matches.length,R("DATASCIENCE.JUPYTER_KERNEL_CODE_COMPLETION",o,s);let f={code:a,cursor:u.cursor,documentRef:new WeakRef(e),position:e.positionAt(u.cursor.start)},h=new Yn.Range(e.positionAt(u.cursor.start),e.positionAt(u.cursor.end));return Array.isArray(d)&&d.length>=u.matches.length&&d.every(v=>v&&typeof v.text=="string")?c.content.matches.map((v,S)=>{let b=d[S],D=b.type?j0.get(b.type):Yn.CompletionItemKind.Field,_=new Yn.CompletionItem(v,D);return typeof b.start=="number"&&typeof b.end=="number"?_.range=new Yn.Range(e.positionAt(b.start),e.positionAt(b.end)):_.range=h,_.insertText=b.text,_.sortText=Of(S),this.previousCompletionItems.set(_,f),_}):u.matches.map((v,S)=>{let b=new Yn.CompletionItem(v);return b.range=h,b.sortText=Of(S),this.previousCompletionItems.set(b,f),b})}async resolveCompletionItem(e,t){if(!e.range||!this.kernel.session?.kernel)return e;let n=this.previousCompletionItems.get(e);if(!n)return e;let{documentRef:i,position:o}=n,s=i.deref();return s?RT(e,t,this.kernel,this.kernelId,this.monacoLanguage,s,o,this.toDispose):e}},lL=class extends Mr{constructor(t,n){super();this.kernel=t;this.notebookEditorProvider=n;this.cellCompletionProviders=new WeakMap;this.completionItemsSent=new WeakMap;this.monacoLanguage=B0(this.kernel);this.toDispose=this._register(new qo);this.registerCompletionProvider(),this._register(Yn.workspace.onDidChangeConfiguration(i=>{if(i.affectsConfiguration("jupyter.enableKernelCompletions"))if(Cz(this.kernel.notebook.uri))this.completionProvider||this.registerCompletionProvider();else{this.completionProvider?.dispose(),this.completionProvider=void 0;return}i.affectsConfiguration("jupyter.completionTriggerCharacters")&&(this.completionProvider?.dispose(),this.completionProvider=void 0,this.registerCompletionProvider())}))}registerCompletionProvider(){if(!Cz(this.kernel.notebook.uri))return;let t=wye(this.kernel);if(t.length===0){kye(this.kernel);return}H(`Registering Kernel Completion Provider from kernel ${gt(this.kernel.kernelConnectionMetadata)} for language ${this.monacoLanguage}`),this.completionProvider=Yn.languages.registerCompletionItemProvider(this.monacoLanguage,this,...t)}dispose(){super.dispose(),this.completionProvider?.dispose()}async provideCompletionItems(t,n,i,o){if(this.notebookEditorProvider.findAssociatedNotebookDocument(t.uri)!==this.kernel.notebook)return[];let s=this.cellCompletionProviders.get(t);if(!s){let a=await ht(this.kernel.kernelConnectionMetadata.id);s=new aL(a,this.kernel,this.monacoLanguage,this.toDispose),this.cellCompletionProviders.set(t,s)}return s.provideCompletionItems(t,n,i,o).then(a=>(a.forEach(l=>this.completionItemsSent.set(l,s)),a))}async resolveCompletionItem(t,n){let i=this.completionItemsSent.get(t);return i?i.resolveCompletionItem(t,n):t}},CI=class extends Mr{constructor(t){super();this.kernelCompletionProviders=new WeakMap;t.push(this)}activate(){let t=Xe.instance.get(Ke);this._register(t.onDidStartKernel(async n=>{if(!Xe.instance.get(sp).inExperiment("KernelCompletions"))return;let o=B0(n);if(!o||o.toLowerCase()===xe.toLowerCase()||this.kernelCompletionProviders.has(n))return;let s=Xe.instance.get(Tn),a=this._register(new lL(n,s));this.kernelCompletionProviders.set(n,a)})),this._register(t.onDidDisposeKernel(n=>{this.kernelCompletionProviders.get(n)?.dispose()}))}};CI=g([(0,V0.injectable)(),p(0,(0,V0.inject)(O))],CI);function B0(r){return Ts(q0(r))}function q0(r){let e="";switch(r.kernelConnectionMetadata.kind){case"connectToLiveRemoteKernel":e=r.kernelConnectionMetadata.kernelModel.language;break;case"startUsingRemoteKernelSpec":e=r.kernelConnectionMetadata.kernelSpec.language;break;case"startUsingLocalKernelSpec":e=r.kernelConnectionMetadata.kernelSpec.language;break;default:e=r.kernelConnectionMetadata.kernelSpec.language;break}return(e||"").toLowerCase()}function Cz(r){return Yn.workspace.getConfiguration("jupyter",r).get("enableKernelCompletions",!1)}function wye(r){let e=Yn.workspace.getConfiguration("jupyter",r.notebook.uri).get("completionTriggerCharacters");if(!e||typeof e!="object")return[];let t=q0(r),n=B0(r);return t in e?Array.isArray(e[t])?e[t]:[]:n in e?Array.isArray(e[n])?e[n]:[]:[]}function kye(r){let e=q0(r),t=B0(r);e.toLowerCase()===t.toLowerCase()?J(Yn.l10n.t(`Kernel completions not enabled for '{0}'. 
To enable Kernel completion for this language please add the following setting 
jupyter.completionTriggerCharacters = {1}: [<List of characters that will trigger completions>]}. 
For more information please see https://aka.ms/vscodeJupyterCompletion`,gt(r.kernelConnectionMetadata),`{${e}`)):J(Yn.l10n.t(`Kernel completions not enabled for '{0}'. 
To enable Kernel completion for this language please add the following setting 
jupyter.completionTriggerCharacters = {1}: [<List of characters that will trigger completions>]}. 
 or the following: 
jupyter.completionTriggerCharacters = {2}: [<List of characters that will trigger completions>]}. 
For more information please see https://aka.ms/vscodeJupyterCompletion`,gt(r.kernelConnectionMetadata),`{${e}`,`{${t}`))}var Ec=k(A()),gs=require("vscode");var Ez=Qt.IntellisenseTimeout;var Nu=class{constructor(e,t,n,i,o){this.kernelProvider=e;this.notebookEditorProvider=t;this.notebookCompletionProvider=n;this.allowStringFilter=!1;this.toDispose=new qo;this.completionItemsSent=new WeakMap;o.push(this.toDispose),this.kernelProvider.onDidStartKernel(a=>{a.session?.kernel&&Vt(a.kernelConnectionMetadata)&&a.session.kernel.requestComplete({code:"__file__.",cursor_pos:9}).catch(m)},this,o);let s=i.getSettings().pythonCompletionTriggerCharacters;this.allowStringFilter=s!=null&&(s.includes("'")||s.includes('"')),gs.workspace.onDidChangeConfiguration(a=>{if(a.affectsConfiguration("jupyter.pythonCompletionTriggerCharacters")){let l=i.getSettings().pythonCompletionTriggerCharacters;this.allowStringFilter=l!=null&&(l.includes("'")||l.includes('"'))}},this,o)}async provideCompletionItems(e,t,n,i){let o=new $e;if(!KE(e))return[];let s=this.notebookEditorProvider.findAssociatedNotebookDocument(e.uri);if(!s)return C(`Notebook not found for Cell ${W(e.uri)}`),[];let a=this.kernelProvider.get(s);if(!a||!a.session||!a.session.kernel)return w(`Live Notebook not available for ${W(s.uri)}`),[];te(`Notebook completion request for ${e.getText()}, ${e.offsetAt(t)}`);let[l,c,u]=await Promise.all([Dr(Ez,this.getJupyterCompletion(a.session,e.getText(),e.offsetAt(t),n)),Dr(Ez,this.getPylanceCompletions(e,t,i,n)),ht(a.kernelConnectionMetadata.id)]);if(l)te(`Completions found, filtering the list: ${JSON.stringify(l)}.`);else return te("Notebook completions not found."),[];let d=[],f=l.metadata?l.metadata._jupyter_types_experimental:[];Array.isArray(f)&&f.length>=l.matches.length&&f.every(b=>typeof b.start=="number"&&typeof b.end=="number"&&typeof b.text=="string")?d=f.map((b,D)=>({label:b.text,itemText:b.text,range:new gs.Range(e.positionAt(b.start),e.positionAt(b.end)),kind:b.type?j0.get(b.type):gs.CompletionItemKind.Field,sortText:Of(D)})):d=l.matches.map((b,D)=>({label:b,itemText:b,sortText:Of(D)})),d=Dye(i.triggerCharacter,this.allowStringFilter,d,c,e,t);let h=new WeakRef(e),v=new WeakRef(a),S=o.elapsedTime;return d.forEach(b=>this.completionItemsSent.set(b,{documentRef:h,kernelRef:v,duration:S,kernelId:u,position:t})),R("DATASCIENCE.JUPYTER_KERNEL_CODE_COMPLETION",{duration:S,completionItems:d.length,requestDuration:S},{kernelId:u,kernelConnectionType:a.kernelConnectionMetadata.kind,kernelLanguage:xe,monacoLanguage:xe,cancelled:n.isCancellationRequested,completed:!0,requestSent:!0,kernelStatusAfterRequest:a.status}),d}async resolveCompletionItem(e,t){let n=this.completionItemsSent.get(e);if(!n)return e;let{kernelId:i,kernelRef:o,documentRef:s,position:a}=n,l=s.deref(),c=o.deref();return!l||!c||!c.session?.kernel?e:RT(e,t,c,i,xe,l,a,this.toDispose)}async getJupyterCompletion(e,t,n,i){let o=new $e;if(!e.kernel)return{matches:[],cursor:{start:0,end:0},metadata:{}};if(e.status==="busy"&&!Pr())return{matches:[],cursor:{start:0,end:0},metadata:{}};let s=await Gt(i,e.kernel.requestComplete({code:t,cursor_pos:n}));return te(`Got jupyter notebook completions. Is cancel? ${i?.isCancellationRequested}: ${s?JSON.stringify(s):"empty"}`),w(`Jupyter completion time: ${o.elapsedTime}`),s&&s.content&&"matches"in s.content?{matches:s.content.matches,cursor:{start:s.content.cursor_start,end:s.content.cursor_end},metadata:s.content.metadata}:{matches:[],cursor:{start:0,end:0},metadata:{}}}async getPylanceCompletions(e,t,n,i){let o=mp(e);if(o&&this.notebookCompletionProvider)return this.notebookCompletionProvider.getCompletions(o,e,t,n,i)}};Nu=g([(0,Ec.injectable)(),p(0,(0,Ec.inject)(Ke)),p(1,(0,Ec.inject)(Tn)),p(2,(0,Ec.inject)(Hy)),p(2,(0,Ec.optional)()),p(3,(0,Ec.inject)(se)),p(4,(0,Ec.inject)(O))],Nu);function Pye(r,e){let t=r.indexOf('"'),n=r.indexOf("'"),i=r.lastIndexOf('"'),o=r.lastIndexOf("'"),s=t>=0?t:n,a=i>=0?i:o;return s>=0&&e.character>s&&e.character<=a}function Dye(r,e,t,n,i,o){let s=t,a=o.character===0?void 0:new gs.Range(o.line,o.character-1,o.line,o.character),c=(a?i.getText(a):void 0)===".",u=i.getWordRangeAtPosition(c||r==="."?new gs.Position(o.line,o.character-1):o),d=u&&a?u.union(a):void 0,f=i.lineAt(o.line).text,h=d?i.getText(d):f,v=h.endsWith(".")||c,S=e&&(r=="'"||r=='"'||Pye(f,o));if(te(`Jupyter completions filtering applied: ${S} on ${f}`),s=s.map((b,D)=>{if(b.itemText.startsWith("%")||b.itemText.startsWith("!"))return{...b,sortText:`ZZZ${b.sortText}`};if(S)return b;let _=h?b.itemText.indexOf(h):-1,L,Z,Se;if(h&&v&&b.itemText.includes(h)){L=b.itemText.substring(b.itemText.indexOf(h)+(v?h.length:0)),Z=b.itemText.substring(b.itemText.indexOf(h)+h.length);let ie=(typeof b.label=="string"?b.label.length:b.label.label.length)-Z.length;Se=b.range&&"start"in b.range?new gs.Range(new gs.Position(b.range.start.line,b.range.start.character+ie),b.range.end):b.range}if(!Z&&_>0){L=b.itemText.substring(b.itemText.indexOf(h)+(v?h.length:0)),Z=b.itemText.substring(b.itemText.indexOf(h)+h.length);let ie=(typeof b.label=="string"?b.label.length:b.label.label.length)-Z.length;Se=b.range&&"start"in b.range?new gs.Range(new gs.Position(b.range.start.line,b.range.start.character+ie),b.range.end):b.range}return L&&Z&&Se&&(b.label=L,b.itemText=Z,b.insertText=Z,b.filterText=v?`.${Z}`:Z,b.range=Se,b.sortText=Of(D)),b}),S?s=s.map(b=>b.itemText.endsWith("/")?{...b,command:{command:"editor.action.triggerSuggest",title:""}}:(b.itemText.includes(" ")&&(b.itemText=b.itemText.replace(/\\ /g," "),typeof b.label=="string"?b.label=b.label.replace(/\\ /g," "):b.label.label=b.label.label.replace(/\\ /g," ")),b)):s=s.filter(b=>!b.itemText.includes(".")&&!b.itemText.endsWith("/")),n){let b=new Set(n.map(D=>D.label.toString()));s=s.filter(D=>!b.has(D.itemText))}return te(`Jupyter completions for ${h} at pos ${o.line}:${o.character} with trigger: ${r}
   ${t.map(b=>b.label).join(",")}`),te(`Jupyter results for ${h} at pos ${o.line}:${o.character} with trigger: ${r}
   ${s.map(b=>b.label).join(",")}`),s}var wI=k(A()),wz=require("vscode");var Tye=[".","%"],EI=class{constructor(e,t,n){this.disposables=e;this.config=t;this.completionProvider=n}activate(){let e=this.config.getSettings().pythonCompletionTriggerCharacters?.split("")||Tye;(e.includes('"')||e.includes("'"))&&(e=[...e,"/"]),this.registerCompletionItemProvider(e)}registerCompletionItemProvider(e){let t=wz.languages.registerCompletionItemProvider(Vd,this.completionProvider,...e);this.disposables.push(t)}};EI=g([(0,wI.injectable)(),p(0,(0,wI.inject)(O)),p(1,(0,wI.inject)(se)),p(2,(0,wI.inject)(Nu))],EI);function kz(r,e){e&&r.addSingleton(Ie,xI),r.addSingleton(Nu,Nu),r.addSingleton(Ie,EI),r.addSingleton(Ie,yI),r.addSingleton(Ie,CI),r.addSingleton(Cc,Cc),r.addBinding(Cc,Ie),r.addSingleton(Hy,SI)}var Kf=k(A());var kI=class{constructor(e,t,n,i){this.extensionChecker=e;this.disposables=t;this.applicationShell=n;this.kernelProvider=i}activate(){this.extensionChecker.onPythonExtensionInstallationStatusChanged(this.onPythonExtensionInstallationStatusChanged,this,this.disposables)}async onPythonExtensionInstallationStatusChanged(e){e==="installed"&&this.anyKernelsAreActive()&&this.applicationShell.showInformationMessage(y.pythonExtensionInstalled,ye.ok).then(m,m)}anyKernelsAreActive(){return this.kernelProvider.kernels.length>0}};kI=g([(0,Kf.injectable)(),p(0,(0,Kf.inject)(ze)),p(1,(0,Kf.inject)(O)),p(2,(0,Kf.inject)(ue)),p(3,(0,Kf.inject)(Ke))],kI);var Bt=k(A()),uL=k(po()),At=require("vscode");var Ff=require("vscode");var J0=class{constructor(e,t,n,i,o,s){this.appShell=e;this.configService=t;this.agentCreator=n;this.requestCreator=i;this.serverUriStorage=o;this.disposables=s;this.savedConnectInfo=new Map;this.serverUriStorage.onDidRemove(this.onDidRemoveServers,this,this.disposables)}getPasswordConnectionInfo(e){if(!e.url||e.url.length<1)throw new Error("Invalid URL");let t=oE(e.url),n=e.disposables||[],i=!Array.isArray(e.disposables),o=this.savedConnectInfo.get(e.handle);return o||(o=this.getJupyterConnectionInfo({url:t,isTokenEmpty:e.isTokenEmpty,disposables:n,validationErrorMessage:e.validationErrorMessage}).then(s=>((!s||s.requiresPassword&&Object.keys(s).length===1)&&(J(`Password for ${t} was invalid.`),this.savedConnectInfo.delete(e.handle)),s)),o.catch(()=>this.savedConnectInfo.delete(e.handle)),o.finally(()=>{i&&G(n)}).catch(m),this.savedConnectInfo.set(e.handle,o)),o}async getJupyterConnectionInfo(e){let t,n,i,o,s=await this.needPassword(e.url);if(s||e.isTokenEmpty){if(s&&e.isTokenEmpty){let a=this.appShell.createInputBox();e.disposables.push(a),a.title=y.jupyterSelectPasswordTitle,a.placeholder=y.jupyterSelectPasswordPrompt,a.ignoreFocusOut=!0,a.password=!0,a.validationMessage=e.validationErrorMessage||"",a.show(),a.buttons=[Ff.QuickInputButtons.Back],o=await new Promise((l,c)=>{a.onDidTriggerButton(u=>{u===Ff.QuickInputButtons.Back&&c(Ae.back)},this,e.disposables),a.onDidChangeValue(()=>a.validationMessage="",this,e.disposables),a.onDidAccept(()=>l(a.value),this,e.disposables),a.onDidHide(()=>c(Ae.cancel),this,e.disposables)})}if(typeof o===void 0&&!o&&e.isTokenEmpty)throw new Ff.CancellationError;if(o||e.isTokenEmpty)if(t=await this.getXSRFToken(e.url,""),t){let a=await this.getSessionCookie(e.url,t,o||"");n=a.sessionCookieName,i=a.sessionCookieValue}else n="authservice_session",i=o,t=await this.getXSRFToken(e.url,`${n}=${i}`);else return{requiresPassword:s}}else return{requiresPassword:s};return t&&n&&(i||e.isTokenEmpty)?(R("DS_INTERNAL.GET_PASSWORD_SUCCESS"),{requestHeaders:{Cookie:`_xsrf=${t}; ${n}=${i||""}`,"X-XSRFToken":t},requiresPassword:s}):(R("DS_INTERNAL.GET_PASSWORD_FAILURE"),{requiresPassword:s})}addAllowUnauthorized(e,t,n){if(e.startsWith("https")&&t&&this.agentCreator){let i=this.agentCreator.createHttpRequestAgent();return{...n,agent:i}}return n}async getXSRFToken(e,t){let n,i,o=new URL("login?",oE(e)).toString();t!=""?(o=new URL("tree",oE(e)).toString(),i={Connection:"keep-alive",Cookie:t}):i={Connection:"keep-alive"};let s=await this.makeRequest(o,{method:"get",redirect:"manual",headers:i});if(s!==void 0&&s.ok){let a=this.getCookies(s);a.has("_xsrf")&&(n=a.get("_xsrf")?.split(";")[0])}return n}async needPassword(e){return(await this.makeRequest(new URL("tree?",oE(e)).toString(),{method:"get",redirect:"manual",headers:{Connection:"keep-alive"}})).status!==200}async makeRequest(e,t){let n=this.configService.getSettings(void 0).allowUnauthorizedRemoteConnection;try{return await this.requestCreator.getFetchMethod()(e,this.addAllowUnauthorized(e,!!n,t))}catch(i){if(i.message.indexOf("reason: self signed certificate")>=0){let o=y.jupyterSelfCertEnable,s=y.jupyterSelfCertClose,a=await this.appShell.showErrorMessage(y.jupyterSelfCertFail(i.message),{modal:!0},o,s);if(a===o)return R("DATASCIENCE.SELFCERTSMESSAGEENABLED"),await this.configService.updateSetting("allowUnauthorizedRemoteConnection",!0,void 0,Ff.ConfigurationTarget.Workspace),this.requestCreator.getFetchMethod()(e,this.addAllowUnauthorized(e,!0,t));a===s&&R("DATASCIENCE.SELFCERTSMESSAGECLOSE")}throw i}}async getSessionCookie(e,t,n){let i,o,s=new URLSearchParams;s.append("_xsrf",t),s.append("password",n);let a=await this.makeRequest(new URL("login?",oE(e)).toString(),{method:"post",headers:{Cookie:`_xsrf=${t}`,Connection:"keep-alive","content-type":"application/x-www-form-urlencoded;charset=UTF-8"},body:s.toString(),redirect:"manual"});if(a.status===302){let l=this.getCookies(a);l.size>0&&(i=l.entries().next().value[0],o=l.entries().next().value[1])}return{sessionCookieName:i,sessionCookieValue:o}}getCookies(e){let t=new Map,i=(e.headers.raw?e.headers.raw():e.headers)["set-cookie"];return i&&i.forEach(o=>{let s=o.substring(0,o.indexOf("=")),a=o.substring(o.indexOf("=")+1);t.set(s,a)}),t}onDidRemoveServers(e){e.forEach(t=>{t.id.startsWith("_builtin")&&this.savedConnectInfo.delete(t.handle)})}};function oE(r){let e=r;return e[e.length-1]!=="/"&&(e=`${e}/`),e}var Dz=require("vscode");var $0=class{constructor(e,t,n,i,o,s,a,l){this.appShell=e;this.multiStepFactory=t;this.asyncDisposableRegistry=n;this.configService=i;this.agentCreator=o;this.requestCreator=s;this.serverUriStorage=a;this.disposables=l;this.savedConnectInfo=new Map;this.serverUriStorage.onDidRemove(this.onDidRemoveServers,this,this.disposables)}async getPasswordConnectionInfo(e){if(!e.url||e.url.length<1)throw new Error("Invalid URL");if(!await this.isJupyterHub(e.url))throw new Error("Not a Jupyter Hub Url");let t=Pz(e.url),n=e.disposables||[],i=!Array.isArray(e.disposables),o=this.savedConnectInfo.get(e.handle);return o||(o=this.getJupyterHubConnectionInfo(t,e.validationErrorMessage).then(s=>((!s||s.requiresPassword&&Object.keys(s).length===1)&&(J(`Password for ${t} was invalid.`),this.savedConnectInfo.delete(e.handle)),s)),o.catch(()=>this.savedConnectInfo.delete(e.handle)),o.finally(()=>{i&&G(n)}).catch(m),this.savedConnectInfo.set(e.handle,o)),o}async isJupyterHub(e){try{if(e.toLowerCase().includes("/user/")&&e.includes("token="))return!1;if(e.toLowerCase().includes("/user/")&&!e.includes("token="))return!0;let t=await this.makeRequest(new URL("hub/api",Pz(e)).toString(),{method:"get"});if(t.status!==200)return!1;try{let n=await t.json();return w(`JupyterHub version is ${n&&n.version} for url ${e}`),n&&n.version}catch{}return!1}catch(t){return w(`Error in detecting whether url is isJupyterHub: ${t}`),!1}}async getJupyterHubConnectionInfo(e,t){try{let n=await this.getUserNameAndPassword(t);if(n.username||n.password){let i=await this.getJupyterHubConnectionInfoFromLogin(e,n.username,n.password);if(i){let o=Object.keys(i||{}).length===0,s=o?"emptyResponseFromLogin":"gotResponseFromLogin";R("DS_INTERNAL.JUPYTER_HUB_PASSWORD",void 0,{failed:o,info:s})}else{R("DS_INTERNAL.JUPYTER_HUB_PASSWORD",void 0,{failed:!0,info:"emptyResponseFromLogin"}),i=await this.getJupyterHubConnectionInfoFromApi(e,n.username,n.password);let o=Object.keys(i||{}).length===0,s=o?"emptyResponseFromApi":"gotResponseFromApi";R("DS_INTERNAL.JUPYTER_HUB_PASSWORD",void 0,{failed:o,info:s})}return i}return R("DS_INTERNAL.JUPYTER_HUB_PASSWORD",void 0,{failed:!1,info:"passwordNotRequired"}),{requiresPassword:!1}}catch(n){throw R("DS_INTERNAL.JUPYTER_HUB_PASSWORD",void 0,{failed:!0,info:"failure"}),n}}async getJupyterHubConnectionInfoFromLogin(e,t,n){let i=new URL(e),o=`${i.protocol}//${i.host}`,s=new URLSearchParams;s.append("username",t||""),s.append("password",n||"");let a=await this.makeRequest(`${o}/hub/login?next=`,{method:"POST",headers:{Connection:"keep-alive",Referer:`${o}/hub/login`,"content-type":"application/x-www-form-urlencoded;charset=UTF-8"},body:s.toString(),redirect:"manual"});if(a&&a.status===302){let c=[...this.getCookies(a).entries()].reduce((u,d)=>`${u};${d[0]}=${d[1]}`,"");if(a=await this.makeRequest(`${o}/hub/api/users/${t}/tokens`,{method:"POST",headers:{Connection:"keep-alive",Cookie:c,Referer:`${o}/hub/login`}}),a.ok&&a.status===200){let u=await a.json();if(u&&u.token&&u.id)return await this.makeRequest(`${o}/hub/api/users/${t}/server`,{method:"POST",headers:{Connection:"keep-alive",Cookie:c,Referer:`${o}/hub/login`}}),this.asyncDisposableRegistry.push({dispose:async()=>{this.makeRequest(`${o}/hub/api/users/${t}/tokens/${u.id}`,{method:"DELETE",headers:{Connection:"keep-alive",Cookie:c,Referer:`${o}/hub/login`}}).catch(m)}}),{requestHeaders:{},remappedBaseUrl:`${o}/user/${t}`,remappedToken:u.token,requiresPassword:!0}}}}async getJupyterHubConnectionInfoFromApi(e,t,n){let i=new URL(e),o=`${i.protocol}//${i.host}`,s=await this.makeRequest(`${o}/hub/api/authorizations/token`,{method:"POST",headers:{Connection:"keep-alive","content-type":"application/json;charset=UTF-8"},body:`{ "username": "${t||""}", "password": "${n||""}"  }`,redirect:"manual"});if(s.ok&&s.status===200){let a=await s.json();if(a&&a.user&&a.user.server&&a.token)return{requestHeaders:{},remappedBaseUrl:`${o}${a.user.server}`,remappedToken:a.token,requiresPassword:!0}}return{requiresPassword:!1}}addAllowUnauthorized(e,t,n){if(e.startsWith("https")&&t&&this.agentCreator){let i=this.agentCreator.createHttpRequestAgent();return{...n,agent:i}}return n}async getUserNameAndPassword(e){let t=this.multiStepFactory.create(),n={username:"",password:"",validationMessage:e};return await t.run(this.getUserNameMultiStep.bind(this),n),n}async getUserNameMultiStep(e,t){if(t.username=await e.showInputBox({title:y.jupyterSelectUserAndPasswordTitle,prompt:y.jupyterSelectUserPrompt,validate:this.validateUserNameOrPassword,validationMessage:t.validationMessage,value:""}),t.username)return this.getPasswordMultiStep.bind(this)}async validateUserNameOrPassword(e){}async getPasswordMultiStep(e,t){t.password=await e.showInputBox({title:y.jupyterSelectUserAndPasswordTitle,prompt:y.jupyterSelectPasswordPrompt,validate:this.validateUserNameOrPassword,value:"",password:!0})}async makeRequest(e,t){let n=this.configService.getSettings(void 0).allowUnauthorizedRemoteConnection;try{return await this.requestCreator.getFetchMethod()(e,this.addAllowUnauthorized(e,!!n,t))}catch(i){if(i.message.indexOf("reason: self signed certificate")>=0){let o=y.jupyterSelfCertEnable,s=y.jupyterSelfCertClose,a=await this.appShell.showErrorMessage(y.jupyterSelfCertFail(i.message),{modal:!0},o,s);if(a===o)return R("DATASCIENCE.SELFCERTSMESSAGEENABLED"),await this.configService.updateSetting("allowUnauthorizedRemoteConnection",!0,void 0,Dz.ConfigurationTarget.Workspace),this.requestCreator.getFetchMethod()(e,this.addAllowUnauthorized(e,!0,t));a===s&&R("DATASCIENCE.SELFCERTSMESSAGECLOSE")}throw i}}getCookies(e){let t=new Map,i=(e.headers.raw?e.headers.raw():e.headers)["set-cookie"];return i&&i.forEach(o=>{let s=o.substring(0,o.indexOf("=")),a=o.substring(o.indexOf("=")+1);t.set(s,a)}),t}onDidRemoveServers(e){e.forEach(t=>{t.id.startsWith("_builtin")&&this.savedConnectInfo.delete(t.handle)})}};function Pz(r){let e=r;return e[e.length-1]!=="/"&&(e=`${e}/`),e}var Tz="user-jupyter-server-uri-list",Lf="user-jupyter-server-uri-list-version2",_z="_builtin.jupyterServerUrlProvider.uriList",_ye="DataScienceAllowInsecureConnections",PI=class extends Mr{constructor(t,n,i,o,s,a,l,c,u,d,f,h,v,S,b,D,_,L=kS){super();this.applicationShell=n;this.jupyterConnection=o;this.isWebExtension=s;this.encryptedStorage=a;this.serverUriStorage=l;this.globalMemento=c;this.commandManager=h;this.context=b;this.fs=D;this.jupyterServerProviderRegistry=_;this.id=L;this.extensionId=bt;this.documentation=At.Uri.parse("https://aka.ms/vscodeJuptyerExtKernelPickerExistingServer");this.displayName=y.UserJupyterServerUrlProviderDisplayName;this.detail=y.UserJupyterServerUrlProviderDetail;this._onDidChangeHandles=this._register(new At.EventEmitter);this.onDidChangeHandles=this._onDidChangeHandles.event;this._onDidChangeServers=this._register(new At.EventEmitter);this.onDidChangeServers=this._onDidChangeServers.event;u.push(this),this.oldStorage=new cE(a,c),this.newStorage=new uE(a),this.secureConnectionValidator=new lE(n,c),this.jupyterServerUriInput=new sE(t,n,S),this.jupyterServerUriDisplayName=new aE(n),this.jupyterPasswordConnect=new J0(n,i,v,S,l,u),this.jupyterHubPasswordConnect=new $0(n,d,f,i,v,S,l,u)}activate(){let t=this._register(this.jupyterServerProviderRegistry.createJupyterServerCollection(bt,this.id,this.displayName,this));t.commandProvider=this,t.documentation=this.documentation,this._register(this.onDidChangeHandles(()=>this._onDidChangeServers.fire(),this)),this._register(this.commandManager.registerCommand("dataScience.ClearUserProviderJupyterServerCache",async()=>{await Promise.all([this.oldStorage.clear().catch(m),this.newStorage.clear().catch(m),this.fs.delete(At.Uri.joinPath(this.context.globalStorageUri,ly)).catch(m)]),this._onDidChangeHandles.fire()})),this.initializeServers().catch(m)}async resolveJupyterServer(t,n){let i=await this.getServerUri(t.id);return{...t,connectionInformation:{id:t.id,label:t.label,baseUrl:At.Uri.parse(i.baseUrl),token:i.token,headers:i.authorizationHeader,mappedRemoteNotebookDir:i.mappedRemoteNotebookDir?At.Uri.file(i.mappedRemoteNotebookDir):void 0,webSocketProtocols:i.webSocketProtocols}}}async handleCommand(t,n){let i=new At.CancellationTokenSource;this._register(new At.Disposable(()=>{i.cancel(),i.dispose()}));try{let o="url"in t?t.url:void 0,s=await this.captureRemoteJupyterUrl(i.token,o);if(!s||s===Ae.cancel)throw new At.CancellationError;if(s&&s instanceof Ae)return;let l=(await this.provideJupyterServers(i.token)).find(c=>c.id===s);if(!l)throw new Error(`Server ${s} not found`);return l}catch(o){if(o instanceof At.CancellationError)throw o;C("Failed to select a Jupyter Server",o);return}finally{i.cancel(),i.dispose()}}async provideCommands(t,n){let i="";try{t=(t||"").trim(),["http:","https:"].includes(new URL(t.trim()).protocol.toLowerCase())&&(i=t)}catch{}return i?[{label:y.connectToToTheJupyterServer(i),url:i}]:[{label:y.jupyterSelectUriCommandLabel,canBeAutoSelected:!0}]}async provideJupyterServers(t){return await this.initializeServers(),(await this.newStorage.getServers(!1)).map(i=>({id:i.handle,label:i.serverInfo.displayName}))}async removeJupyterServer(t){await this.initializeServers(),await this.newStorage.remove(t.id),this._onDidChangeHandles.fire()}migrateOldServers(){return this.migratedOldServers||(this.migratedOldServers=this.oldStorage.getServers().then(async t=>{await this.newStorage.migrate(t,this.serverUriStorage);let n=this.globalMemento.get(Qt.JupyterServerUriList);if(!Array.isArray(n)||n.length===0)return;let i=await this.encryptedStorage.retrieve(Qt.JupyterServerRemoteLaunchService,Qt.JupyterServerRemoteLaunchUriListKey);if(!i)return;let o=[],s=i.split(Qt.JupyterServerRemoteLaunchUriSeparator);s.slice(0,Math.min(s.length,n.length)).forEach((a,l)=>{try{let c=a.split(Qt.JupyterServerRemoteLaunchNameSeparator),u=c[0];if(u===Qt.JupyterServerLocalLaunch||u.startsWith(Le.REMOTE_URI))return;let d=pE(u,c[1]||u);if(d&&t.every(f=>f.uri!==u)){let f=(0,uL.default)();o.push({time:n[l].time,handle:f,uri:u,serverInfo:d})}}catch{}}),o.length>0&&await Promise.all(o.map(async a=>{try{await this.addNewServer(a),await this.serverUriStorage.add({id:this.id,handle:a.handle,extensionId:bt},{time:a.time})}catch{}}))}).catch(m)),this.migratedOldServers}initializeServers(){if(this._cachedServerInfoInitialized)return this._cachedServerInfoInitialized;let t=pe();return this._cachedServerInfoInitialized=t.promise,(async()=>{let n="NewUserUriMigrationCompleted";this.globalMemento.get(n)!==At.env.machineId&&(await Promise.all([this.migrateOldServers().catch(m),this.newStorage.migrationDone]),await this.globalMemento.update(n,At.env.machineId)),this.newStorage.getServers(!1).catch(m),t.resolve()})().then(()=>t.resolve(),n=>t.reject(n)).catch(m),this._cachedServerInfoInitialized}recommendInstallingJupyterHubExtension(){if(!At.workspace.getConfiguration("jupyter").get("bypassJupyterHubExtensionCheck"))throw At.extensions.getExtension(sh)?this.applicationShell.showInformationMessage(y.useJupyterHubExtension,{modal:!0,detail:y.useJupyterHubExtensionDetail}).then(()=>{At.commands.executeCommand("notebook.selectKernel",{notebookEditor:At.window.activeNotebookEditor}).then(m,m)},m):this.applicationShell.showInformationMessage(y.installJupyterHub,{modal:!0,detail:y.installJupyterHubDetail},ye.install,ye.moreInfo).then(t=>{t===ye.install?At.commands.executeCommand("workbench.extensions.installExtension",sh,{context:{skipWalkthrough:!0}}).then(m,m):t===ye.moreInfo&&At.env.openExternal(At.Uri.parse("https://marketplace.visualstudio.com/items?itemName=ms-toolsai.jupyter-hub")).then(m,m)},m),new At.CancellationError}async captureRemoteJupyterUrl(t,n=""){await this.initializeServers();let i=[],o={baseUrl:"",displayName:"",token:""},s="",a=!1,l=!1,c,u="Get Url",d="Get Url",f=n,h=!1;if(n){let v=await this.jupyterServerUriInput.parseUserUriAndGetValidationError(n);typeof v.validationError=="string"?(s=v.validationError,u="Get Url"):(h=!0,o=v.jupyterServerUri,u="Check Passwords")}try{let v=!1,S=!1;for(;;)try{if(c=(0,uL.default)(),u==="Get Url"){h=!1,u="Check Passwords",d=void 0;let D=s;s="";let _=await this.jupyterServerUriInput.getUrlFromUser(f||n,D,i);o=_.jupyterServerUri,f=_.url}if(t.isCancellationRequested)return Ae.cancel;let b=[];if(u==="Check Passwords"){u="Check Insecure Connections",d=h&&n?void 0:"Get Url";try{let D=s;s="",v=await this.jupyterHubPasswordConnect.isJupyterHub(o.baseUrl),v&&this.recommendInstallingJupyterHubExtension();let _=v?await this.jupyterHubPasswordConnect.getPasswordConnectionInfo({url:o.baseUrl,handle:c,displayName:o.displayName,validationErrorMessage:D,disposables:b}):await this.jupyterPasswordConnect.getPasswordConnectionInfo({url:o.baseUrl,isTokenEmpty:o.token.length===0,handle:c,validationErrorMessage:D,disposables:b});a=_.requiresPassword,o.authorizationHeader=_.requestHeaders,S=!1}catch(D){if(S=!1,D instanceof At.CancellationError||D==Ae.back||D==Ae.cancel)throw D;if(!Vo.isSelfCertsError(D)){if(!Cl.isSelfCertsExpiredError(D)){Uf(c,o.baseUrl,v,"ConnectionFailure");let _=/(https?:\/\/[^\s]+)/g,L=(D.message||D.toString()).replace(_,Z=>`[${Z}](${Z})`);if(s=(this.isWebExtension?y.remoteJupyterConnectionFailedWithoutServerWithErrorWeb:y.remoteJupyterConnectionFailedWithoutServerWithError)(L),o.token.length>0&&(D.message||"").toLowerCase()==="Failed to fetch".toLowerCase())S=!0;else{u="Get Url";continue}}}}finally{b.forEach(D=>this._register(D))}}if(t.isCancellationRequested)return Ae.cancel;if(u==="Check Insecure Connections"&&(u="Verify Connection",d=a&&o.token.length===0?"Check Passwords":"Get Url",d==="Get Url"&&(d=h&&n?void 0:"Get Url"),!a&&o.token.length===0&&new URL(o.baseUrl).protocol.toLowerCase()==="http:"&&(l=!0,G(b),!await this.secureConnectionValidator.promptToUseInsecureConnections())))return Uf(c,o.baseUrl,v,"InsecureHTTP"),Ae.cancel;if(t.isCancellationRequested)return Ae.cancel;if(u==="Verify Connection")try{u="Get Display Name",await this.jupyterConnection.validateRemoteUri({id:this.id,handle:c,extensionId:bt},o,!0)}catch(D){if(J("Uri verification error",D),S&&s){u="Get Url";continue}if(D instanceof At.CancellationError||D==Ae.back||D==Ae.cancel)throw D;if(Vo.isSelfCertsError(D)){s=y.jupyterSelfCertFailErrorMessageOnly,u="Get Url",Uf(c,o.baseUrl,v,"SelfCert");continue}else if(Cl.isSelfCertsExpiredError(D)){s=y.jupyterSelfCertExpiredErrorMessageOnly,u="Get Url",Uf(c,o.baseUrl,v,"ExpiredCert");continue}else if(a&&o.token.length===0){s=y.passwordFailure,u="Check Passwords",Uf(c,o.baseUrl,v,"AuthFailure");continue}else{Uf(c,o.baseUrl,v,"ConnectionFailure");let _=/(https?:\/\/[^\s]+)/g,L=(D.message||D.toString()).replace(_,Z=>`[${Z}](${Z})`);s=(this.isWebExtension,y.remoteJupyterConnectionFailedWithoutServerWithErrorWeb)(L),u="Get Url";continue}}finally{G(b)}if(t.isCancellationRequested)return Ae.cancel;if(u==="Get Display Name"){G(b),d=l?"Check Insecure Connections":a&&o.token.length===0?"Check Passwords":"Get Url",d==="Get Url"&&(d=h&&n?void 0:"Get Url"),o.displayName=await this.jupyterServerUriDisplayName.getDisplayName(c,o.displayName||new URL(o.baseUrl).hostname);break}}catch(b){if(b instanceof At.CancellationError||b===Ae.cancel)return Ae.cancel;if(b===Ae.back){if(!d)return Ae.back;u=d;continue}throw b}return t.isCancellationRequested?Ae.cancel:(await this.addNewServer({handle:c,uri:f,serverInfo:o}),Uf(c,o.baseUrl,v),c)}catch(v){if(v instanceof At.CancellationError)return Ae.cancel;throw v}finally{G(i)}}async addNewServer(t){await this.newStorage.add(t),this._onDidChangeHandles.fire()}async getServerUri(t){let i=(await this.newStorage.getServers(!1)).find(c=>c.handle===t);if(!i)throw new Error("Server not found");let o=i.serverInfo,s=this.jupyterServerUriDisplayName.displayNamesOfHandles.get(t);s&&(o.displayName=s);let a=await this.jupyterHubPasswordConnect.isJupyterHub(o.baseUrl),l=Object.assign({},o);try{let c=a?await this.jupyterHubPasswordConnect.getPasswordConnectionInfo({url:o.baseUrl,handle:t,displayName:o.displayName}):await this.jupyterPasswordConnect.getPasswordConnectionInfo({url:o.baseUrl,isTokenEmpty:o.token.length===0,handle:t});l=Object.assign({},o,{authorizationHeader:c.requestHeaders||o.authorizationHeader}),a&&c.remappedBaseUrl&&(l.baseUrl=c.remappedBaseUrl),a&&c.remappedToken&&(l.token=c.remappedToken)}catch(c){C("Failed to validate Password info",c)}return l}};PI=g([(0,Bt.injectable)(),p(0,(0,Bt.inject)(Zd)),p(1,(0,Bt.inject)(ue)),p(2,(0,Bt.inject)(se)),p(3,(0,Bt.inject)(Dn)),p(4,(0,Bt.inject)(on)),p(5,(0,Bt.inject)(Oc)),p(6,(0,Bt.inject)(cr)),p(7,(0,Bt.inject)(He)),p(7,(0,Bt.named)(It)),p(8,(0,Bt.inject)(O)),p(9,(0,Bt.inject)(Rg)),p(10,(0,Bt.inject)(yi)),p(11,(0,Bt.inject)(Fe)),p(12,(0,Bt.inject)(ip)),p(12,(0,Bt.optional)()),p(13,(0,Bt.inject)(Kc)),p(14,(0,Bt.inject)(dt)),p(15,(0,Bt.inject)(Ze)),p(16,(0,Bt.inject)(Ut)),p(17,(0,Bt.optional)()),p(17,(0,Bt.inject)(Date.now().toString()))],PI);var sE=class{constructor(e,t,n){this.clipboard=e;this.applicationShell=t;this.requestCreator=n}async getUrlFromUser(e,t="",n){if(!e&&!BE)try{let s=await this.clipboard.readText().catch(()=>""),a=s.trim().startsWith("https://github.com/")?void 0:At.Uri.parse(s.trim(),!0);e=s&&a&&a.scheme.toLowerCase().startsWith("http")?s:""}catch{}let i=this.applicationShell.createInputBox();n.push(i),i.title=y.jupyterSelectUriInputTitle,i.placeholder=y.jupyterSelectUriInputPlaceholder,i.value=e,i.validationMessage=t,i.buttons=[At.QuickInputButtons.Back],i.ignoreFocusOut=!0,i.show();let o=pe();return i.onDidChangeValue(()=>i.validationMessage="",this,n),i.onDidHide(()=>o.reject(Ae.cancel),this,n),i.onDidTriggerButton(s=>{s===At.QuickInputButtons.Back&&o.reject(Ae.back)},this,n),i.onDidAccept(async()=>{let s=await this.parseUserUriAndGetValidationError(i.value);if(typeof s.validationError=="string"){i.validationMessage=s.validationError;return}o.resolve(s)}),o.promise}async parseUserUriAndGetValidationError(e){let t=e.trim().replace(/\/(lab|tree)(\??)$/,""),n=pE(t,"");return n?(n.baseUrl=await Rye(t,this.requestCreator)||n.baseUrl,!t.toLowerCase().startsWith("http:")&&!t.toLowerCase().startsWith("https:")?{validationError:y.jupyterSelectURIMustBeHttpOrHttps}:{jupyterServerUri:n,url:t,validationError:void 0}):{validationError:y.jupyterSelectURIInvalidURI}}};sE=g([p(0,(0,Bt.inject)(Zd)),p(1,(0,Bt.inject)(ue)),p(2,(0,Bt.inject)(Kc))],sE);async function Rye(r,e){try{if(r=pE(r,"")?.baseUrl||r,new URL(r).pathname==="/")return r;let t=r.indexOf("token=")>0?r.substring(0,r.indexOf("token=")):r,o=(await e.getFetchMethod()(t,{method:"GET",redirect:"manual"})).headers.get("location");if(o&&o.includes("login?"))return o.substring(0,o.indexOf("login?"))}catch(t){w("Unable to identify the baseUrl of the Jupyter Server",t)}}function Uf(r,e,t,n){e=e.trim().toLowerCase();let i=$t({handle:r,extensionId:bt,id:kS});Promise.all([ht(e.toLowerCase()),ht(i.toLowerCase())]).then(([o,s])=>{R("DATASCIENCE.ENTER_REMOTE_JUPYTER_URL",void 0,{serverIdHash:s,failed:!!n,baseUrlHash:o,isJupyterHub:t,isLocalHost:["localhost","127.0.0.1","::1"].includes(new URL(e).hostname),reason:n})}).catch(o=>C(`Failed to hash remote url ${e}`,o))}var aE=class{constructor(e){this.applicationShell=e;this.displayNamesOfHandles=new Map}async getDisplayName(e,t){let n=[];try{let i=this.applicationShell.createInputBox();n.push(i),i.ignoreFocusOut=!0,i.title=y.jupyterRenameServer,i.value=t,i.placeholder=y.jupyterServerUriDisplayNameInputPlaceholder,i.buttons=[At.QuickInputButtons.Back],i.show();let o=pe();return n.push(i.onDidHide(()=>o.reject(Ae.cancel))),i.onDidTriggerButton(s=>{s===At.QuickInputButtons.Back&&o.reject(Ae.back)},this,n),i.onDidAccept(()=>{let s=i.value.trim()||t;this.displayNamesOfHandles.set(e,s),o.resolve(s)},this,n),await o.promise}finally{G(n)}}};aE=g([p(0,(0,Bt.inject)(ue))],aE);var lE=class{constructor(e,t){this.applicationShell=e;this.globalMemento=t}async promptToUseInsecureConnections(){if(this.globalMemento.get(_ye,!1))return!0;let e=[],t=pe();try{let n=this.applicationShell.createQuickPick();e.push(n),n.canSelectMany=!1,n.ignoreFocusOut=!0,n.title=y.insecureSessionMessage,n.buttons=[At.QuickInputButtons.Back],n.items=[{label:ye.bannerLabelYes},{label:ye.bannerLabelNo}],n.show(),e.push(n.onDidHide(()=>t.reject(Ae.cancel))),n.onDidTriggerButton(i=>{i===At.QuickInputButtons.Back&&t.reject(Ae.back)},this,e),n.onDidAccept(()=>t.resolve(n.selectedItems.some(i=>i.label===ye.bannerLabelYes)),this,e)}finally{G(e)}return t.promise}};lE=g([p(0,(0,Bt.inject)(ue)),p(1,(0,Bt.inject)(He)),p(1,(0,Bt.named)(It))],lE);function pE(r,e){if(!r.startsWith(Le.REMOTE_URI))try{let t=new URL(r);return{baseUrl:`${t.protocol}//${t.host}${t.pathname==="/lab"||t.pathname==="/tree"?"":t.pathname}`,token:t.searchParams.get("token")||"",displayName:e||t.hostname}}catch(t){C(`Failed to parse URI ${r}`,t);return}}var cE=class{constructor(e,t){this.encryptedStorage=e;this.globalMemento=t}async getServers(){let e=this.globalMemento.get(_z),t=await this.encryptedStorage.retrieve(Qt.JupyterServerRemoteLaunchService,Tz);if(!t||!e||e.length===0)return[];let n=t.split(Qt.JupyterServerRemoteLaunchUriSeparator);if(n.length===0||n.length!==e.length)return C("Invalid server list, unable to retrieve server info"),[];let i=[];for(let o=0;o<n.length;o+=1){if(n[o].startsWith(Le.REMOTE_URI))continue;let s=pE(n[o]);s?i.push({handle:e[o].handle,uri:n[o],serverInfo:s}):C("Unable to parse server info",n[o])}return i}async clear(){await this.encryptedStorage.store(Qt.JupyterServerRemoteLaunchService,Tz,"").catch(m),await this.globalMemento.update(_z,[]).then(m,m)}};cE=g([p(0,(0,Bt.inject)(Oc)),p(1,(0,Bt.inject)(He)),p(1,(0,Bt.named)(It))],cE);function cL(r){return r.map(e=>({handle:e.handle,uri:e.uri,displayName:e.serverInfo.displayName}))}function Rz(r){let e=[];return r.forEach(t=>{let n=pE(t.uri,t.displayName);n&&e.push({handle:t.handle,uri:t.uri,serverInfo:n})}),e}var uE=class{constructor(e){this.encryptedStorage=e;this.updatePromise=Promise.resolve();this._migrationDone=pe()}get migrationDone(){return this._migrationDone.promise}async migrate(e,t){let n=await this.encryptedStorage.retrieve(Qt.JupyterServerRemoteLaunchService,Lf);if(typeof n=="string"){let i=[],o=!1;try{let s=JSON.parse(n||"[]");o=s.some(a=>a.displayName),i=Rz(s)}catch{return}return o||await this.migrateDisplayNames(i,t),this._migrationDone.resolve()}this.encryptedStorage.store(Qt.JupyterServerRemoteLaunchService,"user-jupyter-server-uri-list-v2",void 0).catch(m),await this.migrateDisplayNames(e,t),await this.encryptedStorage.store(Qt.JupyterServerRemoteLaunchService,Lf,JSON.stringify(e)),this._migrationDone.resolve()}async migrateDisplayNames(e,t){if(e.length===0)return;let n=await t.getAll().catch(o=>(C("Failed to get all servers from storage",o),[])),i=new Map(n.filter(o=>o.provider.extensionId===bt&&o.provider.id===kS).map(o=>[o.provider.handle,o.displayName]));e.forEach(o=>{o.serverInfo.displayName=i.get(o.handle)||o.uri}),await this.encryptedStorage.store(Qt.JupyterServerRemoteLaunchService,Lf,JSON.stringify(cL(e)))}async getServers(e){if(this.servers&&!e)return this.servers;let t=await this.encryptedStorage.retrieve(Qt.JupyterServerRemoteLaunchService,Lf);if(!t||t==="[]")return[];try{return this.servers=Rz(JSON.parse(t))}catch{return[]}}async add(e){this.servers&&(this.servers=this.servers.filter(t=>t.handle!==e.handle).concat(e)),await(this.updatePromise=this.updatePromise.then(async()=>{let t=(await this.getServers(!0)).concat(e);this.servers=t,await this.encryptedStorage.store(Qt.JupyterServerRemoteLaunchService,Lf,JSON.stringify(cL(t)))}).catch(m))}async remove(e){this.servers&&(this.servers=this.servers.filter(t=>t.handle!==e)),await(this.updatePromise=this.updatePromise.then(async()=>{let t=(await this.getServers(!0)).filter(n=>n.handle!==e);return this.servers=t,this.encryptedStorage.store(Qt.JupyterServerRemoteLaunchService,Lf,JSON.stringify(cL(t)))}).catch(m))}async clear(){this.servers=[],await(this.updatePromise=this.updatePromise.then(async()=>{this.servers=[],await this.encryptedStorage.store(Qt.JupyterServerRemoteLaunchService,Lf,void 0)}).catch(m))}};uE=g([p(0,(0,Bt.inject)(Oc))],uE);var dE=k(A()),TI=require("vscode");var DI=class extends Mr{constructor(t,n){super();this.serverSelector=t;this.uriProviderRegistration=n;this.handleMappings=new Map;this._onDidChangeHandles=this._register(new TI.EventEmitter);this.extensionId=bt;this.id=jd;this.displayName="Jupyter Server for Testing";this.onDidChangeServers=this._onDidChangeHandles.event}async provideJupyterServers(t){return Array.from(this.handleMappings.values()).map(n=>n.server)}async resolveJupyterServer(t,n){return t}activate(){this._register(this.uriProviderRegistration.createJupyterServerCollection(bt,this.id,this.displayName,this)),this._register(TI.commands.registerCommand("jupyter.selectjupyteruri",this.selectJupyterUri,this))}async selectJupyterUri(t){H(`Setting Jupyter Server URI to remote: ${t}`);let n=t.toString(!0),i=new URL(n),o=TI.Uri.parse(`${i.protocol}//${i.host}${i.pathname==="/lab"?"":i.pathname}`),s=i.searchParams.get("token")??"",a=await va(t.toString(!0),"SHA-1"),l={label:this.displayName,id:a,connectionInformation:{baseUrl:o,token:s}};this.handleMappings.set(a,{uri:t,server:l}),await this.serverSelector.addJupyterServer({id:this.id,handle:a,extensionId:bt}),this._onDidChangeHandles.fire()}};DI=g([(0,dE.injectable)(),p(0,(0,dE.inject)(Jo)),p(1,(0,dE.inject)(Ut))],DI);var RI=k(A());var Nz=require("vscode");var _I=class{constructor(e,t,n){this.disposables=e;this.workspace=t;this.commandManager=n}activate(){this.registerCommandsIfTrusted()}dispose(){this.disposables.forEach(e=>e.dispose())}registerCommandsIfTrusted(){this.workspace.isTrusted&&this.registerCommand(V.ContinueEditSessionInCodespace,this.continueEditSessionInCodespace)}registerCommand(e,t){let n=this.commandManager.registerCommand(e,t,this);this.disposables.push(n)}async continueEditSessionInCodespace(){await Nz.commands.executeCommand("_workbench.editSessions.actions.continueEditSession.github.codespaces.continueEditSessionInCodespaceWithJupyterServer")}};_I=g([(0,RI.injectable)(),p(0,(0,RI.inject)(O)),p(1,(0,RI.inject)(ce)),p(2,(0,RI.inject)(Fe))],_I);var H0=k(A());var NI=class{constructor(e){this.extensions=e}activate(){this.eagerlyActivateOtherExtensions().catch(m)}async eagerlyActivateOtherExtensions(){await Promise.all(this.extensions.all.filter(e=>e.packageJSON?.contributes?.pythonRemoteServerProvider).map(e=>e.isActive?Promise.resolve():e.activate().then(m,m)))}};NI=g([(0,H0.injectable)(),p(0,(0,H0.inject)(rr))],NI);var Wf=k(A());var Az=require("vscode");var AI=class{constructor(e,t,n,i){this.kernelProvider=e;this.disposables=t;this.extensions=n;this.serverProviders=i}activate(){this.kernelProvider.onDidCreateKernel(e=>this.addOnStartHooks(e),this,this.disposables)}addOnStartHooks(e){let t=e.kernelConnectionMetadata;!Ft(t)||t.serverProviderHandle.extensionId===bt||t.kind!=="startUsingRemoteKernelSpec"||e.addHook("didStart",async(n,i)=>{if(!n)return;let o=this.serverProviders.jupyterCollections.find(u=>u.extensionId===t.serverProviderHandle.extensionId&&u.id===t.serverProviderHandle.id);if(!o){C(`Unable to find Jupyter Server Provider for ${t.id} with provider ${t.serverProviderHandle.extensionId}$${t.serverProviderHandle.id}`);return}if(!o.serverProvider?.onStartKernel)return;let a=(await Promise.resolve(o.serverProvider.provideJupyterServers(i)))?.find(u=>u.id===t.serverProviderHandle.handle);if(!a){C(`Unable to find servers for kernel ${t.id} with provider ${t.serverProviderHandle.extensionId}$${t.serverProviderHandle.id}`);return}let l=o.serverProvider.onStartKernel.bind(o.serverProvider),c=Date.now();try{let u=this.extensions.getExtension(o.extensionId),d=y.runningKernelStartupHooksFor(u?.packageJSON?.displayName||o.extensionId);await ft.wrapAndReportProgress(e.resourceUri,d,()=>Gt(i,l({uri:e.uri,server:a,session:n},i)))}catch(u){if(u instanceof Az.CancellationError)return;J(`Startup hook for ${t.serverProviderHandle.extensionId}$${t.serverProviderHandle.id} failed`,u)}finally{let u=Date.now()-c;R("DATASCIENCE.JUPYTER_KERNEL_STARTUP_HOOK",{duration:u},{extensionId:t.serverProviderHandle.extensionId,providerId:t.serverProviderHandle.id}),u>1e3&&w(`Kernel Startup hook for ${$t(t.serverProviderHandle)} took ${u}ms`)}},this,this.disposables)}};AI=g([(0,Wf.injectable)(),p(0,(0,Wf.inject)(Ke)),p(1,(0,Wf.inject)(O)),p(2,(0,Wf.inject)(rr)),p(3,(0,Wf.inject)(Ut))],AI);var mE=k(A());var MI=class{constructor(e,t){this.commands=e;this.uriStorage=t}activate(){this.commands.registerCommand("jupyter.getUsedAzMLServerHandles",async()=>{let e=[];return(await this.uriStorage.getAll()).forEach(n=>{n.provider.extensionId.toLowerCase()==="ms-toolsai.vscode-ai".toLowerCase()&&e.push(n.provider)}),e})}};MI=g([(0,mE.injectable)(),p(0,(0,mE.inject)(Fe)),p(1,(0,mE.inject)(cr))],MI);function Mz(r,e,t){e.addSingleton(Ie,mI),e.addSingleton(Ie,Af),e.addSingleton(Ie,uI),e.addSingleton(Ie,pI),e.addSingleton(fz,Nf),e.addSingleton(Ie,Nf),e.addSingleton(Ie,NI),e.addSingleton(Ie,DI),e.add(wh,aI),e.add(Tw,lI),e.addSingleton(Ie,cI),e.addSingleton(Ie,_I),e.addSingleton(iL,xc),e.addBinding(iL,Ie),e.add(Tk,gI),e.addSingleton(wA,fI),e.addSingleton(Ru,Ru),e.addSingleton(Ie,kI),kz(e,t),vz(r,t),e.addSingleton(Ie,PI),e.addSingleton(Ie,AI),e.addSingleton(Ie,MI)}var ca=k(A()),Vf=require("vscode");var G0=class{constructor(e,t,n){this.disposedCallback=n,this.callback=e,this.viewChanged=t}async dispose(){this.disposedCallback()}onMessage(e,t){this.callback(e,t)}onChangeViewState(e){this.viewChanged(e)}};var Oz=1e3,Nye;(t=>(t.Fetching="fetching",t.Skipped="skipped"))(Nye||={});var la;(d=>(d.Started="started",d.UpdateSettings="update_settings",d.InitializeData="init",d.GetAllRowsRequest="get_all_rows_request",d.GetAllRowsResponse="get_all_rows_response",d.GetRowsRequest="get_rows_request",d.GetRowsResponse="get_rows_response",d.CompletedData="complete",d.GetSliceRequest="get_slice_request",d.RefreshDataViewer="refresh_data_viewer",d.SliceEnablementStateChanged="slice_enablement_state_changed"))(la||={});var OI=Symbol("IDataViewerFactory"),z0=Symbol("IDataViewer"),Q0=Symbol("IJupyterVariableDataProvider"),Y0=Symbol("IJupyterVariableDataProviderFactory"),KI=Symbol("IDataViewerDependencyService");var dL;function mL(r,e){return dL&&dL.hasOwnProperty(r)?dL[r]:e}function fL(r,...e){return r.replace(/{(\d+)}/g,(t,n)=>e[n]===void 0?t:e[n])}var Aye=/^\s*((?<StartRange>-?\d+:)|(?<StopRange>-?:\d+)|(?:(?<Start>-?\d+)(?::(?<Stop>-?\d+))?(?::(?<Step>-?\d+))?))\s*$/;function hL(r){let e=r.length-2;return"["+r.map(()=>e>0?(e-=1,"0"):":").join(", ")+"]"}function Mye(r,e){if(r.startsWith("[")&&r.endsWith("]")){let t,n=r.substring(1,r.length-1).split(",").map((i,o)=>{let s=Aye.exec(i);if(s?.groups?.Start&&!s.groups.Stop){let a=parseInt(s.groups.Start),l=e[o];return(a>=0&&a>=l||a<0&&a<-l)&&(t={shapeIndex:o,value:a}),a}});if(t){let{shapeIndex:i,value:o}=t,s=mL("sliceIndexError","Index {0} out of range for axis {1} with {2} elements");return fL(s,o.toString(),i.toString(),e[i].toString())}else if(n&&n.length!==e.length){let i=mL("sliceMismatchedAxesError","Expected {0} axes, got {1} in slice expression");return fL(i,e.length.toString(),n.length.toString())}}return""}function Kz(r,e){return Mye(r,e)===""}var X0=require("vscode");var Au=class{constructor(e,t,n,i){this.configService=e;this.workspaceService=t;this.rootPath=n;this.scripts=i;this.disposed=!1;this.themeIsDarkPromise=pe();this.webviewInit=pe();this._disposables=[];this.onMessageListeners=[];this._onDidDisposeWebviewPanel=new X0.EventEmitter;this.onDataScienceSettingsChanged=async()=>{let e=JSON.stringify(await this.generateDataScienceExtraSettings());this.postMessageInternal("update_settings",e).catch(m)};this.onWebViewLoadFailed=async()=>{this.dispose()};this.onPossibleSettingsChange=async e=>{if(e.affectsConfiguration("workbench.colorTheme")||e.affectsConfiguration("editor.fontSize")||e.affectsConfiguration("editor.fontFamily")||e.affectsConfiguration("editor.cursorStyle")||e.affectsConfiguration("editor.cursorBlinking")||e.affectsConfiguration("editor.autoClosingBrackets")||e.affectsConfiguration("editor.autoClosingQuotes")||e.affectsConfiguration("editor.autoSurround")||e.affectsConfiguration("editor.autoIndent")||e.affectsConfiguration("editor.scrollBeyondLastLine")||e.affectsConfiguration("editor.fontLigatures")||e.affectsConfiguration("editor.scrollbar.verticalScrollbarSize")||e.affectsConfiguration("editor.scrollbar.horizontalScrollbarSize")||e.affectsConfiguration("files.autoSave")||e.affectsConfiguration("files.autoSaveDelay")||e.affectsConfiguration("jupyter.widgetScriptSources")){let t=await this.generateDataScienceExtraSettings();if(t){let n=JSON.stringify(t);this.postMessageInternal("update_settings",n).catch(m)}}};this._disposables.push(this.workspaceService.onDidChangeConfiguration(this.onPossibleSettingsChange,this)),this._disposables.push(this.configService.getSettings(void 0).onDidChange(this.onDataScienceSettingsChanged.bind(this)))}get onDidDispose(){return this._onDidDisposeWebviewPanel.event}dispose(){this.disposed||(this.disposed=!0,this._disposables.forEach(e=>e.dispose())),this.webviewInit=void 0,this._onDidDisposeWebviewPanel.fire()}getHTMLById(e){if(!this.activeHTMLRequest)this.activeHTMLRequest=pe(),this.postMessageInternal("get_html_by_id_request",e).catch(m);else throw new Error("getHTMLById request already in progress");return this.activeHTMLRequest.promise}addMessageListener(e){this.onMessageListeners.push(e)}removeMessageListener(e){let t=this.onMessageListeners.indexOf(e);t>=0&&this.onMessageListeners.splice(t,1)}asWebviewUri(e){if(!this.webview)throw new Error("asWebViewUri called too early");return this.webview?.asWebviewUri(e)}postMessage(e,t){return this.postMessageInternal(e.toString(),t)}onMessage(e,t){switch(e){case"started":this.webViewRendered();break;case"get_html_by_id_response":this.activeHTMLRequest&&(this.activeHTMLRequest.resolve(t),this.activeHTMLRequest=void 0);break;default:break}this.onMessageListeners.forEach(n=>{n(e,t)})}async loadWebview(e,t){if(this.disposed=!1,this.webviewInit=this.webviewInit||pe(),this.webview===void 0){let n=await this.generateDataScienceExtraSettings(),i=this.workspaceService.getWorkspaceFolder(e)?.uri;this.webview=await this.provideWebview(e,n,i,t),this._disposables.push(this.webview.loadFailed(this.onWebViewLoadFailed,this))}this.onDataScienceSettingsChanged().catch(m),this.sendLocStrings().catch(m)}async generateDataScienceExtraSettings(){let e=this.owningResource,t=this.workspaceService.getConfiguration("editor"),n=this.workspaceService.getConfiguration("workbench"),i=n?n.get("colorTheme",_R):_R,o=X0.extensions.getExtension(hi);return{...JSON.parse(JSON.stringify(this.configService.getSettings(e))),extraSettings:{editor:{cursor:this.getValue(t,"cursorStyle","line"),cursorBlink:this.getValue(t,"cursorBlinking","blink"),autoClosingBrackets:this.getValue(t,"autoClosingBrackets","languageDefined"),autoClosingQuotes:this.getValue(t,"autoClosingQuotes","languageDefined"),autoSurround:this.getValue(t,"autoSurround","languageDefined"),autoIndent:this.getValue(t,"autoIndent",!1),fontLigatures:this.getValue(t,"fontLigatures",!1),scrollBeyondLastLine:this.getValue(t,"scrollBeyondLastLine",!0),verticalScrollbarSize:this.getValue(t,"scrollbar.verticalScrollbarSize",14),horizontalScrollbarSize:this.getValue(t,"scrollbar.horizontalScrollbarSize",10),fontSize:this.getValue(t,"fontSize",14),fontFamily:this.getValue(t,"fontFamily","Consolas, 'Courier New', monospace")},theme:i,hasPythonExtension:o!==void 0,isWeb:en()==="Unknown"}}}async sendLocStrings(){let e={collapseSingle:Jt.collapseSingle,expandSingle:Jt.expandSingle,openExportFileYes:y.openExportFileYes,openExportFileNo:y.openExportFileNo,noRowsInDataViewer:Jt.noRowsInDataViewer,sliceIndexError:Jt.sliceIndexError,sliceMismatchedAxesError:Jt.sliceMismatchedAxesError,filterRowsTooltip:Jt.sliceMismatchedAxesError,fetchingDataViewer:Jt.fetchingDataViewer,dataViewerHideFilters:Jt.dataViewerHideFilters,dataViewerShowFilters:Jt.dataViewerShowFilters,refreshDataViewer:Jt.refreshDataViewer,clearFilters:Jt.refreshDataViewer,sliceSummaryTitle:Jt.sliceSummaryTitle,sliceData:Jt.sliceData,sliceSubmitButton:Jt.sliceSubmitButton,sliceDropdownAxisLabel:Jt.sliceDropdownAxisLabel,sliceDropdownIndexLabel:Jt.sliceDropdownIndexLabel,variableExplorerNameColumn:Jt.variableExplorerNameColumn,variableExplorerTypeColumn:Jt.variableExplorerTypeColumn,variableExplorerCountColumn:Jt.variableExplorerCountColumn,variableExplorerValueColumn:Jt.variableExplorerValueColumn,collapseVariableExplorerLabel:Jt.collapseVariableExplorerLabel,variableLoadingValue:Jt.variableLoadingValue,showDataExplorerTooltip:Jt.showDataExplorerTooltip,noRowsInVariableExplorer:Jt.noRowsInVariableExplorer,loadingRowsInVariableExplorer:Jt.loadingRowsInVariableExplorer,previousPlot:Jt.previousPlot,nextPlot:Jt.nextPlot,panPlot:Jt.panPlot,zoomInPlot:Jt.zoomInPlot,zoomOutPlot:Jt.zoomOutPlot,exportPlot:Jt.exportPlot,deletePlot:Jt.deletePlot,selectedImageListLabel:Jt.selectedImageListLabel,selectedImageLabel:Jt.selectedImageLabel};this.postMessageInternal("loc_init",JSON.stringify(e)).catch(m)}async postMessageInternal(e,t){this.webviewInit&&(await this.webviewInit.promise,this.webview?.postMessage({type:e.toString(),payload:t}))}webViewRendered(){this.webviewInit&&!this.webviewInit.resolved&&this.webviewInit.resolve(),this.sendLocStrings().catch(m),this.onDataScienceSettingsChanged().catch(m)}getValue(e,t,n){return e?e.get(t,n):n}};g([qu()],Au.prototype,"getHTMLById",1),g([qu()],Au.prototype,"addMessageListener",1),g([qu()],Au.prototype,"removeMessageListener",1);var FI=class extends Au{constructor(t,n,i,o,s,a,l,c){super(t,i,s,a);this.configService=t;this.provider=n;this.workspaceService=i;this._title=l;this.viewColumn=c;this.viewState={visible:!1,active:!1};this.webPanelViewStateChanged=t=>{let n=t.isVisible(),i=t.isActive(),o={visible:n,active:i},s={visible:this.viewState.visible,active:this.viewState.active};this.viewState.visible=n,this.viewState.active=i,this.onViewStateChanged({current:o,previous:s})};this.messageListener=o(this.onMessage.bind(this),this.webPanelViewStateChanged.bind(this),this.dispose.bind(this))}get isDisposed(){return this.disposed}get webPanel(){if(this.webview)return this.webview}async show(t){this.isDisposed||this.webPanel&&await this.webPanel.show(t)}dispose(){this.isDisposed||this.webPanel&&this.webPanel.close(),super.dispose()}get title(){return this._title}setTitle(t){this._title=t,!this.isDisposed&&this.webPanel&&this.webPanel.setTitle(t)}onViewStateChanged(t){}async provideWebview(t,n,i,o){return this.provider.create({viewColumn:this.viewColumn,listener:this.messageListener,title:this.title,rootPath:this.rootPath,scripts:this.scripts,settings:n,cwd:t,webviewHost:o,additionalPaths:i?[i]:[]})}};var Fz="JupyterDataViewerPreferredViewColumn",jf=class extends FI{constructor(t,n,i,o,s,a,l){let c=Yt(l.extensionUri,"dist","webviews","webview-side","viewers");super(n,t,i,(u,d,f)=>new G0(u,d,f),c,[Yt(c,"dataExplorer.js")],y.dataExplorerTitle,s.get(Fz)??Vf.ViewColumn.One);this.applicationShell=o;this.globalMemento=s;this.errorHandler=a;this.context=l;this.pendingRowsCount=0;this.sentDataViewerSliceDimensionalityTelemetry=!1;this._onDidDisposeDataViewer=new Vf.EventEmitter;this._onDidChangeDataViewerViewState=new Vf.EventEmitter;this.onDidDispose(this.dataViewerDisposed,this)}get active(){return!!this.webPanel?.isActive()}get refreshPending(){return this.pendingRowsCount>0}get onDidDisposeDataViewer(){return this._onDidDisposeDataViewer.event}get onDidChangeDataViewerViewState(){return this._onDidChangeDataViewerViewState.event}async showData(t,n){if(!this.isDisposed){this.dataProvider=t,await super.loadWebview(Vf.Uri.file(process.cwd())).catch(C),super.setTitle(n),await super.show(!0);let i=await this.prepDataFrameInfo();if(i.shape&&i.shape.length>2){this.maybeSendSliceDataDimensionalityTelemetry(i.shape.length);let o=hL(i.shape);i=await this.getDataFrameInfo(o)}this.postMessage(la.InitializeData,i).catch(m)}}get kernel(){if(this.dataProvider&&"kernel"in this.dataProvider)return this.dataProvider.kernel}dataViewerDisposed(){this._onDidDisposeDataViewer.fire(this)}async refreshData(){let t=this.currentSliceExpression;this.dataFrameInfoPromise=void 0;let n=await this.getDataFrameInfo(void 0,!0);if(t!==void 0&&n.shape!==void 0)if(Kz(t,n.shape))n=await this.getDataFrameInfo(t);else{let i=hL(n.shape);n=await this.getDataFrameInfo(i)}H(`Refreshing data viewer for variable ${n.name}`),this.postMessage(la.InitializeData,n).catch(m)}dispose(){super.dispose(),this.dataProvider&&(this.dataProvider.dispose(),this.dataProvider=void 0)}async onViewStateChanged(t){t.current.active&&t.current.visible&&t.previous.active&&t.current.visible&&await this.globalMemento.update(Fz,this.webPanel?.viewColumn),this._onDidChangeDataViewerViewState.fire()}get owningResource(){}onMessage(t,n){switch(t){case la.GetAllRowsRequest:this.getAllRows(n).catch(m);break;case la.GetRowsRequest:this.getRowChunk(n).catch(m);break;case la.GetSliceRequest:this.getSlice(n).catch(m);break;case la.RefreshDataViewer:this.refreshData().catch(m),R("DATASCIENCE.REFRESH_DATA_VIEWER");break;case la.SliceEnablementStateChanged:R("DATASCIENCE.DATA_VIEWER_SLICE_ENABLEMENT_STATE_CHANGED",void 0,{newState:n.newState?"checked":"unchecked"});break;default:break}super.onMessage(t,n)}getDataFrameInfo(t,n){return(!this.dataFrameInfoPromise||t!==this.currentSliceExpression)&&(this.dataFrameInfoPromise=this.dataProvider?this.dataProvider.getDataFrameInfo(t,n):Promise.resolve({}),this.currentSliceExpression=t),this.dataFrameInfoPromise}async prepDataFrameInfo(){this.rowsTimer=new $e;let t=await this.getDataFrameInfo();try{R("DATASCIENCE.SHOW_DATA_EXPLORER",void 0,{rows:t.rowCount?t.rowCount:0,columns:t.columns?t.columns.length:0}),this.pendingRowsCount=t.rowCount?t.rowCount:0}catch{}return t}async getAllRows(t){return this.wrapRequest(async()=>{if(this.dataProvider){let n=await this.dataProvider.getAllRows(t);return this.pendingRowsCount=0,this.postMessage(la.GetAllRowsResponse,n)}})}getSlice(t){return this.wrapRequest(async()=>{if(this.dataProvider){let n=await this.getDataFrameInfo(t.slice);return n.shape?.length&&this.maybeSendSliceDataDimensionalityTelemetry(n.shape.length),R("DATASCIENCE.DATA_VIEWER_SLICE_OPERATION",void 0,{source:t.source}),this.postMessage(la.InitializeData,n)}})}getRowChunk(t){return this.wrapRequest(async()=>{if(this.dataProvider){let n=await this.getDataFrameInfo(t.sliceExpression),i=await this.dataProvider.getRows(t.start,Math.min(t.end,n.rowCount?n.rowCount:0),t.sliceExpression);return this.pendingRowsCount=Math.max(0,this.pendingRowsCount-i.length),this.postMessage(la.GetRowsResponse,{rows:i,start:t.start,end:t.end})}})}async wrapRequest(t){try{return await t()}catch(n){if(n instanceof Ly){C(n.message);let i=y.pythonInteractiveHelpLink;this.applicationShell.showErrorMessage(y.jupyterDataRateExceeded,i).then(o=>{o===i&&this.applicationShell.openUrl(TS.JupyterDataRateHelpLink)},m),this.dispose()}C(n),this.errorHandler.handleError(n).then(m,m)}finally{this.sendElapsedTimeTelemetry()}}sendElapsedTimeTelemetry(){this.rowsTimer&&this.pendingRowsCount===0&&R("DATASCIENCE.SHOW_DATA_EXPLORER_ROWS_LOADED",void 0,{rowsTimer:this.rowsTimer.elapsedTime})}maybeSendSliceDataDimensionalityTelemetry(t){this.sentDataViewerSliceDimensionalityTelemetry||(R("DATASCIENCE.DATA_VIEWER_DATA_DIMENSIONALITY",{numberOfDimensions:t}),this.sentDataViewerSliceDimensionalityTelemetry=!0)}};g([yr("DATAVIEWER.WEBVIEW_LOADED")],jf.prototype,"showData",1),jf=g([(0,ca.injectable)(),p(0,(0,ca.inject)(tp)),p(1,(0,ca.inject)(se)),p(2,(0,ca.inject)(ce)),p(3,(0,ca.inject)(ue)),p(4,(0,ca.inject)(He)),p(4,(0,ca.named)(It)),p(5,(0,ca.inject)(an)),p(6,(0,ca.inject)(dt))],jf);var Fr=k(A()),Uz=require("vscode");var Lz=require("vscode");var Z0=class{constructor(e,t){this.configuration=e;this.applicationShell=t}async isRequestedColumnSizeAllowed(e,t){if(e>Oz&&await this.shouldAskForLargeData(t)){let n=y.tooManyColumnsMessage,i=y.tooManyColumnsYes,o=y.tooManyColumnsNo,s=y.tooManyColumnsDontAskAgain,a=await this.applicationShell.showWarningMessage(n,i,o,s);return a===s&&await this.disableAskForLargeData(),a===i}return!0}async shouldAskForLargeData(e){let t=e?this.configuration.getSettings(e):this.configuration.getSettings();return t&&t.askForLargeDataFrames===!0}async disableAskForLargeData(e){let t=e?this.configuration.getSettings(e):this.configuration.getSettings();t&&(t.askForLargeDataFrames=!1,this.configuration.updateSetting("askForLargeDataFrames",!1,void 0,Lz.ConfigurationTarget.Global).catch(m))}};var LI=class{constructor(e,t,n,i,o,s,a,l,c,u,d,f,h,v,S,b){this.disposables=e;this.commandManager=t;this.debugService=n;this.appShell=o;this.jupyterVariableDataProviderFactory=s;this.dataViewerFactory=a;this.variableProvider=l;this.workspace=c;this.errorHandler=u;this.dataViewerDependencyService=d;this.interpreterService=f;this.platformService=h;this.notebooks=v;this.kernelProvider=S;this.interactiveWindowProvider=b;this.dataViewerChecker=new Z0(i,o),this.workspace.isTrusted||this.workspace.onDidGrantWorkspaceTrust(this.registerCommandsIfTrusted,this,this.disposables)}activate(){this.registerCommandsIfTrusted()}registerCommandsIfTrusted(){this.workspace.isTrusted&&this.registerCommand(V.ShowDataViewer,this.onVariablePanelShowDataViewerRequest)}registerCommand(e,t){let n=this.commandManager.registerCommand(e,t,this);this.disposables.push(n)}async onVariablePanelShowDataViewerRequest(e){if(R("OPEN_DATAVIEWER_FROM_VARIABLE_WINDOW_REQUEST_EX"),this.debugService?.activeDebugSession&&this.variableProvider&&this.jupyterVariableDataProviderFactory&&this.dataViewerFactory)try{if(this.debugService.activeDebugSession.configuration&&this.dataViewerDependencyService&&this.interpreterService){let a=await this.getDebugAdapterPython(this.debugService.activeDebugSession.configuration);a&&await this.dataViewerDependencyService.checkAndInstallMissingDependencies(a)}let t=G_(e.variable),n=await this.variableProvider.getFullVariable(t),i=await this.jupyterVariableDataProviderFactory.create(n),s=(await i.getDataFrameInfo())?.columns?.length;if(s&&await this.dataViewerChecker.isRequestedColumnSizeAllowed(s)){let a=`${y.dataExplorerTitle} - ${n.name}`,l=await this.dataViewerFactory.create(i,a);return R("OPEN_DATAVIEWER_FROM_VARIABLE_WINDOW_SUCCESS_EX"),l}}catch(t){R("OPEN_DATAVIEWER_FROM_VARIABLE_WINDOW_ERROR_EX",void 0,void 0,t),C(t),this.errorHandler.handleError(t).then(m,m)}else try{let t=this.getActiveKernel();if(t&&this.jupyterVariableDataProviderFactory&&this.dataViewerFactory){let n=await this.jupyterVariableDataProviderFactory.create(e.variable,t),i=`${y.dataExplorerTitle} - ${e.variable.name}`;return await this.dataViewerFactory.create(n,i)}}catch(t){C(t),R("DATASCIENCE.FAILED_SHOW_DATA_EXPLORER"),this.appShell.showErrorMessage(y.showDataViewerFail).then(m,m)}}getActiveKernel(){let e=this.notebooks.activeNotebookEditor?.notebook,t=e?.notebookType==Ct?this.kernelProvider.get(e):void 0;if(t)return t;let n=this.getActiveInteractiveWindowDocument(),i=n?this.kernelProvider.get(n):void 0;if(i)return i;let o=this.dataViewerFactory?.activeViewer;return o?this.kernelProvider.kernels.find(s=>s===o.kernel):void 0}getActiveInteractiveWindowDocument(){let e=this.interactiveWindowProvider.getActiveOrAssociatedInteractiveWindow();if(e)return this.notebooks.notebookDocuments.find(t=>t===e?.notebookDocument)}async getDebugAdapterPython(e){if(!this.interpreterService){H("Interpreter Service missing when trying getDebugAdapterPython");return}let t="";if(e.debugAdapterPython!==void 0?(H("Found debugAdapterPython on Debug Configuration to use"),t=e.debugAdapterPython):e.pythonPath&&(H("Found pythonPath on Debug Configuration to use"),t=e.pythonPath),t){let n=t;return n.startsWith("~")&&this.platformService.homeDir&&(n=fh(n,this.platformService.homeDir.path)),this.interpreterService.getInterpreterDetails(Uz.Uri.file(n))}else return this.interpreterService.getActiveInterpreter()}};LI=g([(0,Fr.injectable)(),p(0,(0,Fr.inject)(O)),p(1,(0,Fr.inject)(Fe)),p(2,(0,Fr.inject)(Ui)),p(2,(0,Fr.optional)()),p(3,(0,Fr.inject)(se)),p(4,(0,Fr.inject)(ue)),p(5,(0,Fr.inject)(Y0)),p(5,(0,Fr.optional)()),p(6,(0,Fr.inject)(OI)),p(6,(0,Fr.optional)()),p(7,(0,Fr.inject)(pi)),p(7,(0,Fr.optional)()),p(7,(0,Fr.named)(Le.DEBUGGER_VARIABLES)),p(8,(0,Fr.inject)(ce)),p(9,(0,Fr.inject)(an)),p(10,(0,Fr.inject)(KI)),p(10,(0,Fr.optional)()),p(11,(0,Fr.inject)(it)),p(11,(0,Fr.optional)()),p(12,(0,Fr.inject)(Ir)),p(13,(0,Fr.inject)(qe)),p(14,(0,Fr.inject)(Ke)),p(15,(0,Fr.inject)(Gi))],LI);var Rd=k(A());var e1="0.20.0";var Wz=require("vscode");var Bf=class{constructor(e,t){this.applicationShell=e;this.isCodeSpace=t}async getVersion(e,t){try{let n=await this._getVersion(e,t);return typeof n=="string"?uk(n):n}catch(n){J(y.failedToGetVersionOfPandas,n.message);return}}async promptInstall(e,t,n){let i=n?y.pandasTooOldForViewingFormat(n,e1):y.pandasRequiredForViewing(e1);if((this.isCodeSpace?ye.install:await this.applicationShell.showErrorMessage(i,{modal:!0},ye.install))===ye.install)await this._doInstall(e,t);else throw R("DATASCIENCE.USER_DID_NOT_INSTALL_PANDAS"),new Error(i)}async checkOrInstall(e){let t=new Wz.CancellationTokenSource;try{let n=await this.getVersion(e,t.token);if(t.token.isCancellationRequested){R("DS_INTERNAL.SHOW_DATA_PANDAS_INSTALL_CANCELED");return}if(n){if(n.compare(e1)>0){R("DS_INTERNAL.SHOW_DATA_PANDAS_OK");return}R("DS_INTERNAL.SHOW_DATA_PANDAS_TOO_OLD");let i=`${n.major}.${n.minor}.${n.build}`;await this.promptInstall(e,t,i)}R("DS_INTERNAL.SHOW_DATA_NO_PANDAS"),await this.promptInstall(e,t)}finally{t.dispose()}}};g([yr("DS_INTERNAL.PYTHON_MODULE_INSTALL",{action:"displayed",moduleName:Sr.get(23)})],Bf.prototype,"promptInstall",1);var t1=class extends Bf{constructor(t,n,i,o,s){super(o,s);this.installer=t;this.pythonFactory=n;this.interpreterService=i}async _getVersion(t,n){return(await(await this.pythonFactory.createActivatedEnvironment({resource:void 0,interpreter:t})).exec(["-c","import pandas;print(pandas.__version__)"],{throwOnStdErr:!0,token:n})).stdout}async _doInstall(t,n){let i=t||await this.interpreterService.getActiveInterpreter();if(n.token.isCancellationRequested)return;await Gt(n.token,2,this.installer.install(23,i,n))===0&&R("DATASCIENCE.USER_INSTALLED_PANDAS")}async checkAndInstallMissingDependencies(t){R("DATAVIEWER.USING_INTERPRETER"),await this.checkOrInstall(t)}};var Oye="import pandas as _VSCODE_pandas;print(_VSCODE_pandas.__version__);del _VSCODE_pandas";function Kye(r){return r.kernelConnectionMetadata.interpreter?.envType==="Conda"?"%conda":"%pip"}var r1=class extends Bf{async execute(e,t){if(!t.session?.kernel)throw new Sn;let n=await xn(t.session.kernel,e),i=n.find(o=>o.output_type==="error");return i&&J(y.failedToGetVersionOfPandas,i.message),n.map(o=>o.text?.toString())}async _getVersion(e){return(await this.execute(Oye,e)).map(n=>n?n.toString():void 0).find(n=>n)}async _doInstall(e){let t=`${Kye(e)} install pandas`;try{await this.execute(t,e),R("DATASCIENCE.USER_INSTALLED_PANDAS")}catch(n){throw R("DATASCIENCE.USER_INSTALLED_PANDAS",void 0,void 0,n),new Error(y.failedToInstallPandas)}}async checkAndInstallMissingDependencies(e){if(R("DATAVIEWER.USING_KERNEL"),!e.session?.kernel)throw R("DATASCIENCE.NO_ACTIVE_KERNEL_SESSION"),new Error("No no active kernel session.");await this.checkOrInstall(e)}};function Fye(r){return"sysPrefix"in r&&typeof r.sysPrefix=="string"}var UI=class{constructor(e,t,n,i,o){this.withKernel=new r1(i,o),this.withInterpreter=new t1(e,t,n,i,o)}async checkAndInstallMissingDependencies(e){return Fye(e)?this.withInterpreter.checkAndInstallMissingDependencies(e):this.withKernel.checkAndInstallMissingDependencies(e)}};UI=g([(0,Rd.injectable)(),p(0,(0,Rd.inject)(qi)),p(1,(0,Rd.inject)(Hr)),p(2,(0,Rd.inject)(it)),p(3,(0,Rd.inject)(ue)),p(4,(0,Rd.inject)(op))],UI);var qf=k(A());var Nd=class{constructor(e,t,n,i){this.serviceContainer=e;this.disposables=n;this.commandManager=i;this.knownViewers=new Set;t.push(this),this.viewContext=new nr(fr.IsDataViewerActive,this.commandManager),this.disposables.push(this.commandManager.registerCommand(V.RefreshDataViewer,this.refreshDataViewer,this))}async dispose(){for(let e of this.knownViewers)e.dispose()}async create(e,t){let n,i=this.serviceContainer.get(z0);try{this.knownViewers.add(i),i.onDidDisposeDataViewer(this.updateOpenDataViewers,this,this.disposables),i.onDidChangeDataViewerViewState(this.updateViewStateContext,this,this.disposables),await i.showData(e,t),n=i}finally{n||i.dispose()}return n}get activeViewer(){return[...this.knownViewers.values()].find(e=>e.active)}updateOpenDataViewers(e){this.knownViewers.delete(e)}async updateViewStateContext(){let e=!1;this.knownViewers.forEach(t=>{t.active&&(e=!0)}),await this.viewContext.set(e)}refreshDataViewer(){for(let e of this.knownViewers)e.active&&e.refreshData().then(m,m)}};g([yr("DATASCIENCE.START_SHOW_DATA_EXPLORER")],Nd.prototype,"create",1),g([dD(1e3)],Nd.prototype,"refreshDataViewer",1),Nd=g([(0,qf.injectable)(),p(0,(0,qf.inject)(ct)),p(1,(0,qf.inject)(yi)),p(2,(0,qf.inject)(O)),p(3,(0,qf.inject)(Fe))],Nd);var Ou=k(A());var Mu=class{constructor(e,t){this.variableManager=e;this.dependencyService=t;this.initialized=!1}get kernel(){return this._kernel}static getNormalizedColumns(e){return e.map(t=>{let n;switch(t.type){case"bool":n="bool";break;case"integer":case"int32":case"int64":case"float":case"float32":case"float64":case"number":n="number";break;default:n="string"}return{key:t.key,type:n}})}static parseShape(e){try{if(e.startsWith("(")&&e.endsWith(")"))return e.substring(1,e.length-1).split(",").map(t=>parseInt(t))}catch{C(`Could not parse IJupyterVariable with malformed shape: ${e}`)}}dispose(){}setDependencies(e,t){this._kernel=t,this.variable=e}async getDataFrameInfo(e,t){let n={};await this.ensureInitialized();let i=this.variable;return i&&((e||t)&&(i=await this.variableManager.getDataFrameInfo(i,this._kernel,e,t)),n={columns:i.columns?Mu.getNormalizedColumns(i.columns):i.columns,indexColumn:i.indexColumn,rowCount:i.rowCount,dataDimensionality:i.dataDimensionality,shape:Mu.parseShape(i.shape),sliceExpression:e,type:i.type,maximumRowChunkSize:i.maximumRowChunkSize,name:i.name,fileName:we(i.fileName)}),t&&(this.variable=i),n}async getAllRows(e){let t=[];return await this.ensureInitialized(),this.variable&&this.variable.rowCount&&(t=(await this.variableManager.getDataFrameRows(this.variable,0,this.variable.rowCount,this._kernel,e)).data),t}async getRows(e,t,n){let i=[];return await this.ensureInitialized(),this.variable&&this.variable.rowCount&&(i=(await this.variableManager.getDataFrameRows(this.variable,e,t,this._kernel,n)).data),i}async ensureInitialized(){!this.initialized&&this.variable&&(this.initialized=!0,this._kernel?.kernelConnectionMetadata&&this.dependencyService&&await this.dependencyService.checkAndInstallMissingDependencies(ph()?this._kernel:this._kernel?.kernelConnectionMetadata.interpreter||this._kernel),this.variable=await this.variableManager.getDataFrameInfo(this.variable,this._kernel))}};Mu=g([(0,Ou.injectable)(),p(0,(0,Ou.inject)(pi)),p(0,(0,Ou.named)(Le.ALL_VARIABLES)),p(1,(0,Ou.inject)(KI)),p(1,(0,Ou.optional)())],Mu);var n1=k(A());var WI=class{constructor(e){this.serviceContainer=e}async create(e,t){let n=this.serviceContainer.get(Q0);return n.setDependencies(e,t),n}};WI=g([(0,n1.injectable)(),p(0,(0,n1.inject)(ct))],WI);var fE=k(A()),i1=require("vscode");var jI=class{constructor(e,t){this.kernelProvider=e;this.controllers=t;this.disposables=[];this.widgetOutputsPerNotebook=new WeakMap}dispose(){G(this.disposables)}activate(){let e=i1.notebooks.createRendererMessaging("jupyter-ipywidget-renderer");e.onDidReceiveMessage(this.onDidReceiveMessage.bind(this,e),this,this.disposables),this.kernelProvider.onDidStartKernel(this.onDidStartKernel,this,this.disposables)}onDidStartKernel(e){this.hookupKernel(e),e.onStarted(()=>this.hookupKernel(e),this,this.disposables),e.onRestarted(()=>this.hookupKernel(e),this,this.disposables)}hookupKernel(e){this.widgetOutputsPerNotebook.delete(e.notebook);let t=e.session?.kernel,n=e.session?.kernel?.iopubMessage;if(!n)return;let i=require("@jupyterlab/services"),o=(s,a)=>{s===t&&(i.KernelMessage.isDisplayDataMsg(a)||i.KernelMessage.isUpdateDisplayDataMsg(a)||i.KernelMessage.isExecuteReplyMsg(a)||i.KernelMessage.isExecuteResultMsg(a))&&this.trackModelId(e.notebook,a)};n.connect(o),this.disposables.push(new i1.Disposable(()=>n.disconnect(o)))}trackModelId(e,t){let n=t.content;if(n.data&&typeof n.data=="object"&&Xi in n.data){let i=n.data[Xi];if(i&&"model_id"in i){let o=this.widgetOutputsPerNotebook.get(e)||new Set;o.add(i.model_id),this.widgetOutputsPerNotebook.set(e,o)}}}onDidReceiveMessage(e,{editor:t,message:n}){n&&typeof n=="object"&&n.command==="query-widget-state"&&this.queryWidgetState(e,t,n),n&&typeof n=="object"&&n.command==="ipywidget-renderer-loaded"&&this.sendWidgetVersionAndState(e,t)}queryWidgetState(e,t,n){let i=this.widgetOutputsPerNotebook.get(t.notebook),o=!!this.controllers.getSelected(t.notebook),s=!!i?.has(n.model_id);e.postMessage({command:"query-widget-state",model_id:n.model_id,hasWidgetState:s,kernelSelected:o},t).then(m,m)}sendWidgetVersionAndState(e,t){let n=this.kernelProvider.get(t.notebook),i=n?.ipywidgetsVersion;n?.ipywidgetsVersion&&w(`IPyWidget version in Kernel is ${n?.ipywidgetsVersion}.`);let o=!!this.controllers.getSelected(t.notebook);e.postMessage({command:"ipywidget-renderer-init",version:i,widgetState:void 0,kernelSelected:o},t).then(m,m)}};jI=g([(0,fE.injectable)(),p(0,(0,fE.inject)(Ke)),p(1,(0,fE.inject)(xt))],jI);var Fu=k(A());var Ku=k(A());var Jf=require("vscode");var o1=class{constructor(e,t,n){this.disposedCallback=n,this.callback=e,this.viewChanged=t}async dispose(){this.disposedCallback()}onMessage(e,t){this.callback(e,t)}onChangeViewState(e){this.viewChanged&&this.viewChanged(e)}};var ua;(s=>(s.Started="started",s.UpdateSettings="update_settings",s.SendPlot="send_plot",s.CopyPlot="copy_plot",s.ExportPlot="export_plot",s.RemovePlot="remove_plot"))(ua||={});var jz=class{static{ua.Started,ua.UpdateSettings,ua.SendPlot,ua.CopyPlot,ua.ExportPlot,ua.RemovePlot}},s1=Symbol("IPlotViewerProvider"),a1=Symbol("IPlotViewer");var VI=class extends FI{constructor(t,n,i,o,s,a){let l=new $e,c=Yt(a.extensionUri,"dist","webviews","webview-side","viewers");super(n,t,i,(u,d,f)=>new o1(u,d,f),c,[Yt(c,"plotViewer.js")],y.plotViewerTitle,Jf.ViewColumn.One);this.applicationShell=o;this.fs=s;this.context=a;this.closedEvent=new Jf.EventEmitter;this.removedEvent=new Jf.EventEmitter;this.addPlot=async t=>{this.isDisposed||(await super.show(!1),this.postMessage(ua.SendPlot,t).catch(m))};super.loadWebview(Jf.Uri.file(process.cwd())).catch(C).finally(()=>{R("PLOTVIEWER.WEBVIEW_LOADED",{duration:l.elapsedTime})})}get closed(){return this.closedEvent.event}get removed(){return this.removedEvent.event}async show(){if(!this.isDisposed)return super.show(!0)}dispose(){super.dispose(),this.removedEvent.dispose(),this.closedEvent&&this.closedEvent.fire(this)}get owningResource(){}onMessage(t,n){switch(t){case ua.CopyPlot:this.copyPlot(n.toString()).catch(m);break;case ua.ExportPlot:this.exportPlot(n).catch(m);break;case ua.RemovePlot:this.removePlot(n);break;default:break}super.onMessage(t,n)}removePlot(t){this.removedEvent.fire(t)}copyPlot(t){return Promise.resolve()}async exportPlot(t){H("exporting plot...");let n={};n[y.pngFilter]=["png"],n[y.svgFilter]=["svg"];let i=await this.applicationShell.showSaveDialog({saveLabel:y.exportPlotTitle,filters:n});try{if(i)switch(Zi(i.path).toLowerCase()){case".png":let s=Buffer.from(t.png.replace("data:image/png;base64",""),"base64");await this.fs.writeFile(i,s);break;default:case".svg":await this.fs.writeFile(i,t.svg);break}}catch(o){C(o),this.applicationShell.showErrorMessage(y.exportImageFailed(o.toString())).then(m,m)}}};VI=g([(0,Ku.injectable)(),p(0,(0,Ku.inject)(tp)),p(1,(0,Ku.inject)(se)),p(2,(0,Ku.inject)(ce)),p(3,(0,Ku.inject)(ue)),p(4,(0,Ku.inject)(Ze)),p(5,(0,Ku.inject)(dt))],VI);var BI=class extends VI{constructor(t,n,i,o,s,a){super(t,n,i,o,s,a);this.fsNode=s}async exportPlot(t){H("exporting plot...");let n={};n[y.pdfFilter]=["pdf"],n[y.pngFilter]=["png"],n[y.svgFilter]=["svg"];let i=await this.applicationShell.showSaveDialog({saveLabel:y.exportPlotTitle,filters:n});try{if(i)switch(Zi(i.fsPath).toLowerCase()){case".pdf":await gL(t.svg,this.fsNode,i);break;case".png":let s=Buffer.from(t.png.replace("data:image/png;base64",""),"base64");await this.fs.writeFile(i,s);break;default:case".svg":await this.fs.writeFile(i,t.svg);break}}catch(o){C(o),this.applicationShell.showErrorMessage(y.exportImageFailed(o)).then(m,m)}}};BI=g([(0,Fu.injectable)(),p(0,(0,Fu.inject)(tp)),p(1,(0,Fu.inject)(se)),p(2,(0,Fu.inject)(ce)),p(3,(0,Fu.inject)(ue)),p(4,(0,Fu.inject)(Or)),p(5,(0,Fu.inject)(dt))],BI);async function gL(r,e,t){H("Attempting pdf write...");let n=(await import("svg-to-pdfkit")).default,i=pe(),o=require("pdfkit/js/pdfkit.standalone"),s=new o,a=e.createLocalWriteStream(t.fsPath);H(`Writing pdf to ${t.fsPath}`),a.on("finish",()=>i.resolve),n(s,r,0,0,{preserveAspectRatio:"xMinYMin meet"}),s.pipe(a),s.end(),H(`Finishing pdf to ${t.fsPath}`),await i.promise,H(`Completed pdf to ${t.fsPath}`)}var hE=k(A());var qI=class{constructor(e,t){this.serviceContainer=e;this.imageList=[];this.closedViewer=()=>{this.currentViewer&&(this.currentViewer=void 0),this.currentViewerClosed&&(this.currentViewerClosed.dispose(),this.currentViewerClosed=void 0)};this.removedPlot=e=>{this.imageList.splice(e,1)};t.push(this)}async dispose(){this.currentViewer&&this.currentViewer.dispose()}async showPlot(e){this.imageList.push(e);let t=this.currentViewer?[e]:this.imageList,n=await this.getOrCreate();await Promise.all(t.map(n.addPlot))}async getOrCreate(){return this.currentViewer||(this.currentViewer=this.serviceContainer.get(a1),this.currentViewerClosed=this.currentViewer.closed(this.closedViewer),this.currentViewer.removed(this.removedPlot),R("DATASCIENCE.OPEN_PLOT_VIEWER"),await this.currentViewer.show()),this.currentViewer}};qI=g([(0,hE.injectable)(),p(0,(0,hE.inject)(ct)),p(1,(0,hE.inject)(yi))],qI);var GI=k(A());var $I=k(A()),vL=require("vscode");var c1="image/svg+xml",l1={"image/png":"png","image/jpeg":"jpeg","image/gif":"gif",[c1]:"svg"},JI=class{constructor(e,t,n){this.shell=e;this.fs=t;this.workspace=n}async savePlot(e,t,n){if(e.isClosed)return;let i=Lye(e,t,n);if(!i)return C(`No plot to save ${W(e.uri)}, id: ${t} for ${n}`);if(!(n.toLowerCase()in l1))return C(`Unsupported MimeType ${W(e.uri)}, id: ${t} for ${n}`);let o=await this.getSaveTarget(i,n);o&&(o.path.toLowerCase().endsWith("pdf")?await this.saveAsPdf(i,o):await this.saveAsImage(i,o))}getSaveTarget(e,t){let n=l1[t.toLowerCase()],i={};e.items.find(l=>l.mime.toLowerCase()===c1)&&(i[y.pdfFilter]=["pdf"],i[y.svgFilter]=["svg"]),n==="png"&&(i[y.pngFilter]=["png"]),Object.keys(i).length===0&&(i.Images=[n]);let o=(this.workspace.workspaceFolders?.length||0)>0?this.workspace.workspaceFolders[0].uri:void 0,s=`output.${n}`,a=o?vL.Uri.joinPath(o,s):vL.Uri.file(s);return this.shell.showSaveDialog({defaultUri:a,saveLabel:y.exportPlotTitle,filters:i})}async saveAsImage(e,t){let n=Zi(t.path).substring(1),i=Object.keys(l1).find(s=>l1[s]===n),o=e.items.find(s=>s.mime===i);if(!o)throw new Error(`Unsupported MimeType ${t.toString()}, available mime Types: ${e.items.map(s=>s.mime).join(", ")}`);await this.fs.writeFile(t,Buffer.from(o.data))}async saveAsPdf(e,t){return C("Save as PDF is not yet supported on the web.")}};JI=g([(0,$I.injectable)(),p(0,(0,$I.inject)(ue)),p(1,(0,$I.inject)(Ze)),p(2,(0,$I.inject)(ce))],JI);function Lye(r,e,t){for(let n of r.getCells())for(let i of n.outputs)if(i.id===e&&i.items.find(o=>o.mime===t))return i}var HI=class extends JI{constructor(t,n,i){super(t,n,i);this.fsNode=n}async saveAsPdf(t,n){let i=Buffer.from(t.items.find(o=>o.mime===c1).data).toString();await gL(i,this.fsNode,n)}};HI=g([(0,GI.injectable)(),p(0,(0,GI.inject)(ue)),p(1,(0,GI.inject)(Or)),p(2,(0,GI.inject)(ce))],HI);var u1=k(A());var Uye="image/svg+xml",Wye="image/png",Lu=class{constructor(e){this.plotViewProvider=e}async openPlot(e,t){if(e.isClosed)return;let n=Vz(e,t,Uye),i;if(n)i=new TextDecoder().decode(n.data);else{let o=Vz(e,t,Wye);if(!o)return C(`No SVG or PNG Plot to open ${W(e.uri)}, id: ${t}`);i=jye(o)}i&&await this.plotViewProvider.showPlot(i)}};Lu=g([(0,u1.injectable)(),p(0,(0,u1.inject)(s1))],Lu);function Vz(r,e,t){for(let n of r.getCells())for(let i of n.outputs)if(i.id===e)return i.items.find(o=>o.mime===t)}function jye(r){let e=Buffer.from(r.data),t=e.toString("base64"),n=Vye(e);return`<?xml version="1.0" encoding="utf-8" standalone="no"?>
<svg height="${n.height}" width="${n.width}" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
    <g>
        <image xmlns="http://www.w3.org/2000/svg" x="0" y="0" height="100%" width="100%" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="data:image/png;base64,${t}"/>
    </g>
</svg>`}function Vye(r){if(!Bye(r))throw new Error("The buffer is not a valid png");return{width:r.readUInt32BE(16),height:r.readUInt32BE(20)}}function Bye(r){return r[0]===137&&r[1]===80&&r[2]===78&&r[3]===71&&r[4]===13&&r[5]===10&&r[6]===26&&r[7]===10&&r.length>8+21}var gE=k(A()),d1=require("vscode");var p1=Symbol("IPlotSaveHandler");var zI=class{constructor(e,t){this.plotSaveHandler=e;this.plotViewHandler=t;this.disposables=[]}dispose(){G(this.disposables)}activate(){this.activateImpl().catch(m)}async activateImpl(){let e=d1.extensions.getExtension(lh);if(!e)return;e.isActive||await e.activate(),e.exports.onDidReceiveMessage(({editor:n,message:i})=>{let o=n.notebook||d1.window.activeNotebookEditor?.notebook;o&&(i.type==="saveImageAs"?this.plotSaveHandler.savePlot(o,i.outputId,i.mimeType).catch(m):i.type==="openImageInPlotViewer"&&this.plotViewHandler.openPlot(o,i.outputId).catch(m))},this,this.disposables)}};zI=g([(0,gE.injectable)(),p(0,(0,gE.inject)(p1)),p(1,(0,gE.inject)(Lu))],zI);var Ad=k(A()),YI=require("vscode");var QI=class{constructor(e,t,n,i,o){this.interactiveWindowProvider=e;this.kernelProvider=t;this.dataViewerFactory=n;this.disposables=i;this.notebooks=o;this._onDidFinisheExecutingActiveNotebook=new YI.EventEmitter;this._onDidChangeActiveNotebook=new YI.EventEmitter;this._onDidRestartActiveNotebook=new YI.EventEmitter;this._executionCountTracker=new WeakMap;this.notebooks.onDidChangeActiveNotebookEditor(this.activeEditorChanged,this,this.disposables),this.notebooks.onDidCloseNotebookDocument(this.notebookEditorClosed,this,this.disposables),this.kernelProvider.onDidRestartKernel(s=>{this.handleRestart({state:1,notebook:s.notebook})},this,this.disposables),o.onDidChangeNotebookCellExecutionState(this.onDidChangeNotebookCellExecutionState,this,this.disposables)}get onDidChangeActiveNotebook(){return this._onDidChangeActiveNotebook.event}get onDidFinishExecutingActiveNotebook(){return this._onDidFinisheExecutingActiveNotebook.event}get onDidRestartActiveNotebook(){return this._onDidRestartActiveNotebook.event}get activeKernel(){let e=this.notebooks.activeNotebookEditor?.notebook,t=e?.notebookType==Ct?this.kernelProvider.get(e):void 0;if(t)return t;let n=this.getActiveInteractiveWindowDocument(),i=n?this.kernelProvider.get(n):void 0;if(i)return i;let o=this.dataViewerFactory.activeViewer;return o?this.kernelProvider.kernels.find(s=>s===o.kernel):void 0}get activeNotebookExecutionCount(){let e=this.activeKernel?.notebook;return e?this._executionCountTracker.get(e):void 0}getActiveInteractiveWindowDocument(){let e=this.interactiveWindowProvider.getActiveOrAssociatedInteractiveWindow();if(e)return this.notebooks.notebookDocuments.find(t=>t===e?.notebookDocument)}onDidChangeNotebookCellExecutionState(e){Dt(e.cell.notebook)&&e.state===YI.NotebookCellExecutionState.Idle&&this.handleExecute({notebook:e.cell.notebook,state:0,cell:e.cell})}handleExecute(e){this.isNonSilentExecution(e)&&(e.cell?.executionSummary?.executionOrder!==void 0&&this._executionCountTracker.set(e.notebook,e.cell.executionSummary?.executionOrder),this.isActiveNotebookEvent(e)&&e.cell?.executionSummary?.executionOrder!==void 0&&this.activeKernel&&this.kernelProvider.getKernelExecution(this.activeKernel).pendingCells.length===0&&this._onDidFinisheExecutingActiveNotebook.fire({executionCount:e.cell.executionSummary?.executionOrder}))}handleRestart(e){this._executionCountTracker.delete(e.notebook),this.isActiveNotebookEvent(e)&&this._onDidRestartActiveNotebook.fire()}notebookEditorClosed(e){this._executionCountTracker.delete(e)}activeEditorChanged(e){let t={};if(e&&Dt(e.notebook)){let n=this._executionCountTracker.get(e.notebook);n&&(t.executionCount=n)}this._onDidChangeActiveNotebook.fire(t)}isNonSilentExecution(e){return!!(e.state===0&&e.cell&&e.cell.executionSummary?.executionOrder)}isActiveNotebookEvent(e){return this.activeKernel?.notebook===e.notebook}};QI=g([(0,Ad.injectable)(),p(0,(0,Ad.inject)(Gi)),p(1,(0,Ad.inject)(Ke)),p(2,(0,Ad.inject)(OI)),p(3,(0,Ad.inject)(O)),p(4,(0,Ad.inject)(qe))],QI);var Bz=class{static{"force_variable_refresh","settings_updated","activate","show_data_explorer","get_variables_request","get_variables_response","variable_explorer_toggle","set_variable_explorer_height","variable_explorer_height_response","open_link","variables_complete","update_settings","loc_init","finish_cell","update_variable_view_execution_count","get_html_by_id_request","get_html_by_id_response","restart_kernel"}},m1=Symbol("INotebookWatcher"),f1=Symbol("IVariableViewProvider");var vE=k(A()),qz=require("vscode");var XI=class{constructor(e,t){this.extensionContext=e;this.variableViewProvider=t}activate(){this.extensionContext.subscriptions.push(qz.window.registerWebviewViewProvider(this.variableViewProvider.viewType,this.variableViewProvider,{webviewOptions:{retainContextWhenHidden:!1}}))}};XI=g([(0,vE.injectable)(),p(0,(0,vE.inject)(dt)),p(1,(0,vE.inject)(f1))],XI);var Ri=k(A());var Jz=require("vscode");var h1=class{constructor(e,t){this.disposedCallback=t,this.callback=e}async dispose(){this.disposedCallback()}onMessage(e,t){this.callback(e,t)}};var g1=class extends Au{constructor(t,n,i,o,s,a){super(t,n,s,a);this.configService=t;this.workspaceService=n;this.provider=o;this.messageListener=i(this.onMessage.bind(this),this.dispose.bind(this))}get isDisposed(){return this.disposed}get webviewView(){return this.webview&&this.webview}async provideWebview(t,n,i,o){if(!o)throw new Error("WebviewViews must be passed an initial VS Code Webview");return this.provider.create({additionalPaths:i?[i]:[],rootPath:this.rootPath,cwd:t,listener:this.messageListener,scripts:this.scripts,settings:n,webviewHost:o})}};var $f=class extends g1{constructor(t,n,i,o,s,a,l,c,u,d,f,h){let v=Yt(o.extensionUri,"dist","webviews","webview-side","viewers");super(t,n,(S,b)=>new h1(S,b),i,v,[Yt(v,"variableView.js")]);this.variables=s;this.disposables=a;this.appShell=l;this.notebookWatcher=c;this.commandManager=u;this.documentManager=d;this.extensions=f;this.experiments=h;this.notebookWatcher.onDidFinishExecutingActiveNotebook(this.activeNotebookExecuted,this,this.disposables),this.notebookWatcher.onDidChangeActiveNotebook(this.activeNotebookChanged,this,this.disposables),this.notebookWatcher.onDidRestartActiveNotebook(this.activeNotebookRestarted,this,this.disposables),this.variables.refreshRequired(this.sendRefreshMessage,this,this.disposables),this.documentManager.onDidChangeActiveTextEditor(this.activeTextEditorChanged,this,this.disposables)}get owningResource(){}async load(t){await super.loadWebview(Jz.Uri.file(process.cwd()),t).catch(C),this.webviewView&&this.disposables.push(this.webviewView.onDidChangeVisibility(()=>{this.handleVisibilityChanged()})),this.handleVisibilityChanged()}get title(){return"variableView"}onMessage(t,n){switch(t){case"get_variables_request":this.handleMessage(t,n,this.requestVariables);break;case"show_data_explorer":this.handleMessage(t,n,this.showDataViewer);break;default:break}super.onMessage(t,n)}handleMessage(t,n,i){let o=n;i.bind(this)(o)}handleVisibilityChanged(){let t=new nr("jupyter.variableViewVisible",this.commandManager),n=!1;this.webviewView&&(n=this.webviewView.visible),t.set(n).catch(m),n&&(R("DS_INTERNAL.NATIVE_VARIABLE_VIEW_MADE_VISIBLE"),this.notebookWatcher.activeNotebookExecutionCount!==void 0?this.postMessage("update_variable_view_execution_count",{executionCount:this.notebookWatcher.activeNotebookExecutionCount}).catch(m):this.postMessage("force_variable_refresh").catch(m))}async showDataViewer(t){try{if(this.experiments.inExperiment("DataViewerContribution")){let n=this.getMatchingVariableViewers(t.variable);if(n.length===0){await this.commandManager.executeCommand("workbench.extensions.search","@tag:jupyterVariableViewers");return}else if(n.length===1){let i=n[0].jupyterVariableViewers.command;return this.commandManager.executeCommand(i,{container:{},variable:t.variable})}else{let i=this.appShell.createQuickPick();i.title="Select DataFrame Viewer",i.items=n.map(o=>({label:o.jupyterVariableViewers.title,detail:o.extension.packageJSON?.displayName??o.extension.id,command:o.jupyterVariableViewers.command})),i.onDidAccept(()=>{let o=i.selectedItems[0];o&&(i.hide(),this.commandManager.executeCommand(o.command,{container:{},variable:t.variable}).then(m,m))}),i.show()}}else return this.commandManager.executeCommand(V.ShowDataViewer,{container:{},variable:t.variable})}catch(n){C(n),R("DATASCIENCE.FAILED_SHOW_DATA_EXPLORER"),this.appShell.showErrorMessage(y.showDataViewerFail).then(m,m)}}getMatchingVariableViewers(t){return this.getVariableViewers().filter(i=>i.jupyterVariableViewers.dataTypes.includes(t.type))}getVariableViewers(){return this.extensions.all.filter(i=>i.packageJSON?.contributes?.jupyterVariableViewers&&i.packageJSON?.contributes?.jupyterVariableViewers.length).filter(i=>i.id!==bt).map(i=>{let o=i.packageJSON?.contributes;return o?.jupyterVariableViewers?o.jupyterVariableViewers.map(s=>({extension:i,jupyterVariableViewers:s})):[]}).flat()}postProcessSupportsDataExplorer(t){let n=this.getVariableViewers();return t.pageResponse.forEach(i=>{this.experiments.inExperiment("DataViewerContribution")&&(i.supportsDataExplorer=n.some(o=>o.jupyterVariableViewers.dataTypes.includes(i.type)))}),t}async requestVariables(t){let n=this.notebookWatcher.activeKernel;if(n){let i=await this.variables.getVariables(t,n);this.postMessage("get_variables_response",this.postProcessSupportsDataExplorer(i)).catch(m),R("DS_INTERNAL.VARIABLE_EXPLORER_VARIABLE_COUNT",{variableCount:i.totalCount})}else{let i={executionCount:t.executionCount,pageStartIndex:-1,pageResponse:[],totalCount:0,refreshCount:t.refreshCount};this.postMessage("get_variables_response",i).catch(m)}}async activeNotebookExecuted(t){this.postMessage("update_variable_view_execution_count",{executionCount:t.executionCount}).catch(m)}async activeNotebookChanged(t){t.executionCount?this.postMessage("update_variable_view_execution_count",{executionCount:t.executionCount}).catch(m):this.postMessage("update_variable_view_execution_count",{executionCount:0}).catch(m),this.postMessage("force_variable_refresh").catch(m)}activeTextEditorChanged(){this.postMessage("force_variable_refresh").catch(m)}async activeNotebookRestarted(){this.postMessage("restart_kernel").catch(m)}async sendRefreshMessage(){this.postMessage("force_variable_refresh").catch(m)}};g([yr("DS_INTERNAL.NATIVE_VARIABLE_VIEW_LOADED")],$f.prototype,"load",1),g([Br()],$f.prototype,"showDataViewer",1),g([Br()],$f.prototype,"requestVariables",1);var ZI=class{constructor(e,t,n,i,o,s,a,l,c,u,d,f){this.configuration=e;this.workspaceService=t;this.webviewViewProvider=n;this.context=i;this.variables=o;this.disposables=s;this.appShell=a;this.notebookWatcher=l;this.commandManager=c;this.documentManager=u;this.extensions=d;this.experiments=f;this.viewType="jupyterViewVariables"}get activeVariableView(){if(!Pr())throw new Error("activeVariableView only for test code");return this.variableView?Promise.resolve(this.variableView):(this.activeVariableViewPromise=pe(),this.activeVariableViewPromise.promise)}async resolveWebviewView(e,t,n){e.webview.options={enableScripts:!0},this.variableView=new $f(this.configuration,this.workspaceService,this.webviewViewProvider,this.context,this.variables,this.disposables,this.appShell,this.notebookWatcher,this.commandManager,this.documentManager,this.extensions,this.experiments),this.activeVariableViewPromise&&this.activeVariableViewPromise.resolve(this.variableView),await this.variableView.load(e)}};ZI=g([(0,Ri.injectable)(),p(0,(0,Ri.inject)(se)),p(1,(0,Ri.inject)(ce)),p(2,(0,Ri.inject)(Dw)),p(3,(0,Ri.inject)(dt)),p(4,(0,Ri.inject)(pi)),p(4,(0,Ri.named)(Le.ALL_VARIABLES)),p(5,(0,Ri.inject)(O)),p(6,(0,Ri.inject)(ue)),p(7,(0,Ri.inject)(m1)),p(8,(0,Ri.inject)(Fe)),p(9,(0,Ri.inject)(lr)),p(10,(0,Ri.inject)(rr)),p(11,(0,Ri.inject)(sp))],ZI);function $z(r){r.addSingleton(Ie,zI),r.add(z0,jf),r.addSingleton(OI,Nd),r.addSingleton(KI,UI),r.addSingleton(Ie,LI),r.add(a1,BI),r.addSingleton(s1,qI),r.addSingleton(p1,HI),r.addSingleton(Lu,Lu),r.addSingleton(m1,QI),r.addSingleton(Ie,XI),r.addSingleton(Ie,jI),r.addSingleton(f1,ZI),r.add(Q0,Mu),r.addSingleton(Y0,WI)}var Gz=require("vscode");function zz(r){let e=Gz.window.createOutputChannel(y.jupyterServerConsoleOutputChannel,"log");r.push(e);let t={get(n,i){let o=n[i];if(typeof o=="function"){if(i==="append")return(...s)=>{e.append(...s),Hz(...s)};if(i==="appendLine")return(...s)=>{e.appendLine(...s),Hz(...s)}}return o}};return new Proxy(e,t)}function Hz(...r){r.length===1?w(je(r[0]).map((e,t)=>t===0?e:`    ${e}`).join(`
`)):w(...r)}var nQ=k(EN());var Qz=k(A());var Hf=class{constructor(e){this.container=e}getContainer(){return this.container}add(e,t,n,i){n?this.container.bind(e).to(t).whenTargetNamed(n):this.container.bind(e).to(t),i&&i.forEach(o=>{this.addBinding(e,o)})}addFactory(e,t){this.container.bind(e).toFactory(t)}addBinding(e,t){this.container.bind(t).toService(e)}addSingleton(e,t,n,i){n?this.container.bind(e).to(t).inSingletonScope().whenTargetNamed(n):this.container.bind(e).to(t).inSingletonScope(),i&&i.forEach(o=>{this.addBinding(e,o)})}addSingletonInstance(e,t,n){n?this.container.bind(e).toConstantValue(t).whenTargetNamed(n):this.container.bind(e).toConstantValue(t)}get(e,t){return t?this.container.getNamed(e,t):this.container.get(e)}tryGet(e,t){try{return t?this.container.getNamed(e,t):this.container.get(e)}catch{}}getAll(e,t){return t?this.container.getAllNamed(e,t):this.container.getAll(e)}rebind(e,t,n){n?this.container.rebind(e).to(t).whenTargetNamed(n):this.container.rebind(e).to(t)}rebindSingleton(e,t,n){n?this.container.rebind(e).to(t).inSingletonScope().whenTargetNamed(n):this.container.rebind(e).to(t).inSingletonScope()}rebindInstance(e,t,n){n?this.container.rebind(e).toConstantValue(t).whenTargetNamed(n):this.container.rebind(e).toConstantValue(t)}dispose(){this.container.unbindAll(),this.container.unload()}};g([qu()],Hf.prototype,"getContainer",1),Hf=g([(0,Qz.injectable)()],Hf);var Xz=yL(),v1=class{constructor(e,t,n){this.channel=e;this.homeReplaceRegEx=t,this.userNameReplaceRegEx=n}format(e,t,...n){let i=e?`${FE()} [${e}] ${Xz(t,...n)}`:Xz(t,...n);return this.homeReplaceRegEx&&(i=i.replace(this.homeReplaceRegEx,"~")),this.userNameReplaceRegEx&&(i=i.replace(this.userNameReplaceRegEx,"<username>")),i}traceLog(e,...t){this.channel.appendLine(this.format("",e,...t))}traceError(e,...t){this.channel.appendLine(this.format("error",e,...t))}traceWarn(e,...t){this.channel.appendLine(this.format("warn",e,...t))}traceInfo(e,...t){this.channel.appendLine(this.format("info",e,...t))}traceVerbose(e,...t){this.channel.appendLine(this.format("debug",e,...t))}};var bL=yL();function y1(r,e,...t){let i=[...t].length===0?bL(e):bL(e,...t);return r?`${r} ${FE()}: ${i}`:i}var b1=class{constructor(e){this.prefix=e}traceLog(e,...t){console.log(bL(`${this.prefix||""} ${e}`,...t))}traceError(e,...t){console.error(y1("error",`${this.prefix||""} ${e}`,...t))}traceWarn(e,...t){console.warn(y1("warn",`${this.prefix||""} ${e}`,...t))}traceInfo(e,...t){console.info(y1("info",`${this.prefix||""} ${e}`,...t))}traceVerbose(e,...t){console.log(y1("verbose",`${this.prefix||""} ${e}`,...t))}};var Md=require("os");var wc=k(require("vscode"));var I1=k(require("vscode"));var Gf=k(require("vscode"));function eS(r){r.sort((t,n)=>t-n);let e=r.shift();return e===void 0?[]:r.reduce(function(t,n){return n<=t[0][1]?t[0][1]=n+1:t.unshift([n,n+1]),t},[[e,e+1]]).reverse().map(t=>new Gf.NotebookRange(t[0],t[1]))}function qye(r){return Gf.workspace.notebookDocuments.find(e=>e.uri.authority===r.uri.authority&&e.uri.path===r.uri.path)}function yE(r){let e=Gf.workspace.textDocuments.find(o=>o.uri.toString()===r?.document.uri.toString())??Gf.window.activeTextEditor?.document;if(!e)return;let t=qye(e);if(!t)return;let i=t.getCells().find(o=>o.document.uri.toString()===e.uri.toString());if(i)return{notebook:t,cell:i}}function IL(r,e){return r.start.line===e.start.line&&r.start.character===e.start.character&&r.end.line===e.end.line&&r.end.character===e.end.character}function Xn(){}var Zz="ms-python.vscode-pylance";async function Jye(r){return await r.activate()}var SL;async function eQ(){let r=I1.extensions.getExtension(Zz);if(r&&r.isActive)return SL||new Promise((e,t)=>{Jye(r).then(async n=>{if(!n){I1.window.showErrorMessage("Could not start Pylance").then(Xn,Xn),t();return}n.client&&await n.client.start(),SL=n.notebook,e(n.notebook)}).then(Xn,Xn)})}var Lr=k(require("vscode"));var $ye=Lr.window.createTextEditorDecorationType({after:{contentText:"write",margin:"0 0 0 1em",backgroundColor:"red"}}),Hye=Lr.window.createTextEditorDecorationType({after:{contentText:"read",margin:"0 0 0 1em",backgroundColor:"green"}}),tS=class{constructor(e,t,n){this._notebookDocument=e;this._cellExecution=t;this._cellRefs=n}_getVirtualCellList(e){return this._cellExecution.findIndex(n=>n.cell.document.uri.toString()===e.document.uri.toString())===-1?this._notebookDocument.getCells():this._cellExecution.map(n=>n.cell)}getPredecessorCells(e,t=!1){let n=t?this._notebookDocument.getCells():this._getVirtualCellList(e);var i;for(i=n.length-1;i>=0&&n[i].document.uri.toString()!==e.document.uri.toString();i--);if(i===-1)return[];let o=i,s=n.slice(0,o+1),a=new Array(s.length).fill(!1);a[o]=!0;let l=new Map;for(let[d,f]of this._cellRefs.entries()){let h=f.filter(v=>v.kind==="write").map(v=>v.uri.fragment);f.forEach(v=>{let S=v.uri.fragment;l.has(S)?l.get(S)?.push(d):l.set(S,[d])}),f.forEach(v=>{let S=v.uri.fragment;l.has(S)?l.get(S)?.push(...h):l.set(S,h)})}let c=e.document.uri.fragment;this._resolveDependencies(l,a,c,s);let u=[];for(let d=0;d<a.length;d++)a[d]&&u.push(s[d]);return u}getSuccessorCells(e){let t=this._getVirtualCellList(e),n=t.findIndex(a=>a.document.uri.fragment===e.document.uri.fragment);if(n===-1)return[];let i=new Array(t.length).fill(!1);i[n]=!0;let o=new Map;this._cellRefs.forEach(a=>{a.forEach(l=>{if(l.kind==="write"){let c=l.uri.fragment,u=o.get(c)??[];u.push(...a.filter(d=>d!==l)),o.set(c,u)}})});for(let a=n;a<t.length;a++)if(i[a]){let l=this._cellRefs.get(t[a].document.uri.fragment)||[],c=o.get(t[a].document.uri.fragment)||[];[...l,...c].forEach(d=>{let f=t.findIndex(h=>h.document.uri.fragment===d.uri.fragment);f!==-1&&f>=a&&(i[f]=!0)})}let s=[];for(let a=0;a<i.length;a++)i[a]&&s.push(t[a]);return s}_resolveDependencies(e,t,n,i){if(e.has(n))for(let o of e.get(n)){let s=i.findIndex(a=>a.document.uri.fragment===o);if(s===-1)throw new Error(`Dependency ${o} is not in the execution list.`);t[s]||(t[s]=!0,this._resolveDependencies(e,t,o,i))}}};var S1=class{constructor(e,t){this._notebookEditor=e;this._client=t;this._pendingRequests=new Map;this._cellRefs=new Map;this._staleCellRefs=new Map;this._cellExecution=[];this._disposables=[];this._notebookEditor.notebook.getCells().forEach(n=>{this._requestCellSymbols(n,!1).then(Xn,Xn)}),this._disposables.push(Lr.workspace.onDidChangeNotebookDocument(n=>{n.notebook===this._notebookEditor.notebook&&(n.contentChanges.forEach(i=>{i.removedCells.forEach(o=>{this._pendingRequests.delete(o.document.uri.fragment),this._cellRefs.delete(o.document.uri.fragment)}),i.addedCells.forEach(o=>{this._requestCellSymbols(o,!1).then(Xn,Xn)})}),n.cellChanges.forEach(i=>{this._requestCellSymbols(i.cell,!1).then(Xn,Xn),this._updateCellStatus(i.cell,0)}))})),this._disposables.push(Lr.notebooks.onDidChangeNotebookCellExecutionState(n=>{n.state===Lr.NotebookCellExecutionState.Executing&&n.cell.document.languageId==="python"&&this._updateCellStatus(n.cell,1),n.state===Lr.NotebookCellExecutionState.Idle&&n.cell.document.languageId==="python"&&(this._cellExecution.push({cell:n.cell,executionCount:n.cell.executionSummary?.executionOrder??0}),this._updateCellStatus(n.cell,2))}))}_updateCellStatus(e,t){this._staleCellRefs.set(e.document.uri.fragment,t)}async requestCellSymbolsSync(){let e=[...this._pendingRequests.keys()];this._pendingRequests.forEach(t=>t.cancel()),this._pendingRequests.clear();for(let t of e){let n=this._notebookEditor.notebook.getCells().find(i=>i.document.uri.fragment===t);n&&await this._requestCellSymbols(n,!0)}}async selectPrecedentCells(e){await this.requestCellSymbolsSync();let t=new tS(this._notebookEditor.notebook,this._cellExecution,this._cellRefs);try{let n=t.getPredecessorCells(e);this._notebookEditor.selections=eS(n.map(i=>i.index));return}catch{}try{let n=t.getPredecessorCells(e,!0);this._notebookEditor.selections=eS(n.map(i=>i.index));return}catch{}}async selectSuccessorCells(e){await this.requestCellSymbolsSync();let n=new tS(this._notebookEditor.notebook,this._cellExecution,this._cellRefs).getSuccessorCells(e),i=eS(n.map(o=>o.index));this._notebookEditor.selections=i}async runPrecedentCells(e){await this.requestCellSymbolsSync();let t=new tS(this._notebookEditor.notebook,this._cellExecution,this._cellRefs),n=[];try{n=t.getPredecessorCells(e)}catch{try{n=t.getPredecessorCells(e,!0)}catch{throw new Error("No precedent cells found")}}let i=n.findIndex(s=>(this._staleCellRefs.get(s.document.uri.fragment)??0)===0),o=eS((i===-1?n:n.slice(i)).map(s=>s.index));await Lr.commands.executeCommand("notebook.cell.execute",{ranges:o.map(s=>({start:s.start,end:s.end})),document:this._notebookEditor.notebook.uri}).then(Xn,Xn)}async runSuccessorCells(e){await this.requestCellSymbolsSync();let n=new tS(this._notebookEditor.notebook,this._cellExecution,this._cellRefs).getSuccessorCells(e),i=eS(n.map(o=>o.index));await Lr.commands.executeCommand("notebook.cell.execute",{ranges:i.map(o=>({start:o.start,end:o.end})),document:this._notebookEditor.notebook.uri}).then(Xn,Xn)}async debugSymbols(){let e=[];await this.requestCellSymbolsSync(),console.log(JSON.stringify(Array.from(this._cellRefs.entries())));for(let n of Lr.window.visibleTextEditors){let i=n.document;if(i.uri.scheme==="vscode-notebook-cell"&&i.uri.path===this._notebookEditor.notebook.uri.path){let o=this._cellRefs.get(i.uri.fragment);o&&e.push(...o)}}let t=new Map;e.forEach(n=>{let i=n.uri.fragment;t.has(i)||t.set(i,[]),t.get(i)?.push(n)}),t.forEach((n,i)=>{let o=Lr.window.visibleTextEditors.find(s=>s.document.uri.path===this._notebookEditor.notebook.uri.path&&s.document.uri.fragment===i);if(o){let s=[],a=[];n.reduce((c,u)=>c.find(f=>IL(f.range,u.range))?c:c.concat([u]),[]).forEach(c=>{let u=new Lr.Position(c.range.end.line,c.range.end.character),d=new Lr.Range(u,u);c.kind==="write"?s.push(d):c.kind==="read"&&a.push(d)}),o.setDecorations($ye,s),o.setDecorations(Hye,a)}})}async _requestCellSymbols(e,t){let n=this._pendingRequests.get(e.document.uri.fragment);if(n&&n.cancel(),t){let o=new Lr.CancellationTokenSource;await this._doRequestCellSymbols(e,o.token),o.dispose();return}let i=new Lr.CancellationTokenSource;this._pendingRequests.set(e.document.uri.fragment,i),setTimeout(()=>{this._pendingRequests.get(e.document.uri.fragment)===i&&(this._pendingRequests.delete(e.document.uri.fragment),!i.token.isCancellationRequested&&this._doRequestCellSymbols(e,i.token).then(Xn,Xn))},500)}async _getDocumentSymbols(e){return Lr.commands.executeCommand("vscode.executeDocumentSymbolProvider",e.document.uri)}async _doRequestCellSymbols(e,t){let n=await this._getDocumentSymbols(e);if(!n)return;let i=[];for(let o of n){let s=await this._client.getReferences(e.document,o.selectionRange.start,{includeDeclaration:!0},t);s&&i.push(...s.map(a=>({...a,associatedSymbol:o})))}i.length&&this._cellRefs.set(e.document.uri.fragment,i.map(o=>({range:o.range,uri:Lr.Uri.parse(o.uri),kind:IL(o.range,o.associatedSymbol.selectionRange)?"write":o.kind,associatedSymbol:o.associatedSymbol})))}dispose(){this._pendingRequests.forEach(e=>e.cancel()),this._pendingRequests.clear(),this._disposables.forEach(e=>e.dispose()),this._disposables=[]}},x1=class{constructor(e){this._client=e;this._disposables=[];this._notebookDocumentSymbolTrackers=new Map;Lr.window.visibleNotebookEditors.forEach(t=>{this._notebookDocumentSymbolTrackers.set(t.notebook.uri.toString(),new S1(t,this._client))}),this._disposables.push(Lr.window.onDidChangeVisibleNotebookEditors(t=>{t.forEach(n=>{this._notebookDocumentSymbolTrackers.has(n.notebook.uri.toString())||this._notebookDocumentSymbolTrackers.set(n.notebook.uri.toString(),new S1(n,this._client))}),this._notebookDocumentSymbolTrackers.forEach((n,i)=>{Lr.window.visibleNotebookEditors.find(o=>o.notebook.uri.toString()===i)||(n.dispose(),this._notebookDocumentSymbolTrackers.delete(i))})}))}async debugSymbols(e){let t=this._notebookDocumentSymbolTrackers.get(e.uri.toString());t&&await t.debugSymbols()}async runSuccessorCells(e,t){let n=this._notebookDocumentSymbolTrackers.get(e.uri.toString());n&&await n.runSuccessorCells(t)}async runPrecedentCells(e,t){let n=this._notebookDocumentSymbolTrackers.get(e.uri.toString());n&&await n.runPrecedentCells(t)}async selectSuccessorCells(e,t){let n=this._notebookDocumentSymbolTrackers.get(e.uri.toString());n&&await n.selectSuccessorCells(t)}async selectPrecedentCells(e,t){let n=this._notebookDocumentSymbolTrackers.get(e.uri.toString());n&&await n.selectPrecedentCells(t)}dispose(){this._disposables.forEach(e=>e.dispose()),this._disposables=[]}};async function tQ(r){if(!wc.workspace.getConfiguration("jupyter").get("executionAnalysis.enabled"))return;let t=await eQ();if(!t)return;let n=new x1(t);r.subscriptions.push(n),r.subscriptions.push(wc.commands.registerCommand("jupyter.selectDependentCells",async i=>{let o=yE(i);if(!o)return;let{notebook:s,cell:a}=o;await n.selectSuccessorCells(s,a)})),r.subscriptions.push(wc.commands.registerCommand("jupyter.runPrecedentCells",async i=>{let o=yE(i);if(!o)return;let{notebook:s,cell:a}=o;await n.runPrecedentCells(s,a)})),r.subscriptions.push(wc.commands.registerCommand("jupyter.runDependentCells",async i=>{let o=yE(i);if(!o)return;let{notebook:s,cell:a}=o;await n.runSuccessorCells(s,a)})),r.subscriptions.push(wc.commands.registerCommand("jupyter.selectPrecedentCells",async i=>{let o=yE(i);if(!o)return;let{notebook:s,cell:a}=o;await n.selectPrecedentCells(s,a)})),r.subscriptions.push(wc.commands.registerCommand("jupyter.debugCellSymbols",async()=>{let i=wc.window.activeNotebookEditor;i&&await n.debugSymbols(i.notebook)}))}function rQ(){}var C1={totalActivateTime:0,codeLoadingTime:0,startActivateTime:0,endActivateTime:0,workspaceFolderCount:0},xL=new $e;C1.codeLoadingTime=xL.elapsedTime;var E1;async function Gye(r){OV(r.subscriptions),r.subscriptions.push({dispose:()=>wS.isExiting=!0});try{let e,t,n;return[e,t,n]=await Qye(r,xL,C1),XV(t,C1,xL,n).catch(m),await t,e}catch(e){return await Xye(e,C1),C("Failed to active the Jupyter Extension",e),{ready:Promise.resolve(),registerPythonApi:m,registerRemoteServerProvider:()=>({dispose:m}),getKernelService:()=>Promise.resolve(void 0),addRemoteJupyterServer:()=>Promise.resolve(void 0),openNotebook:()=>Promise.reject(),createJupyterServerCollection:()=>{throw new Error("Not Implemented")},kernels:{getKernel:()=>Promise.resolve(void 0)}}}}function zye(){if(wS.isExiting=!0,E1){let r=E1.get(yi);if(r)return r.dispose()}return rQ(),Promise.resolve()}async function Qye(r,e,t){let n=pe();try{Yye(n.promise),t.startActivateTime=e.elapsedTime;let[i,o]=sbe(r);E1=o,S8(l=>o.get(Lp).getPackageVersions(l));let s=ebe(r,i,o);return t.endActivateTime=e.elapsedTime,n.resolve(),tQ(r).then(m,m),[QV(s,i,o,r),s,o]}finally{n.completed||n.reject()}}function Yye(r){let e={location:kr.ProgressLocation.Window,title:ye.loadingExtension};kr.window.withProgress(e,()=>r).then(m,m)}async function Xye(r,e){Zye(ye.handleExtensionActivationError),console.error("extension activation failed",r),C("extension activation failed",r),await ZV(r,e,E1)}function Zye(r){try{kr.window.showErrorMessage(r).then(m,m)}catch(e){C("failed to notify user",e)}}async function ebe(r,e,t){return obe(r,e,t)}function tbe(){if(process.env.VSC_JUPYTER_FORCE_LOGGING){let r;fi||(r="Jupyter Extension:"),QR(new b1(r))}}function iQ(r){return r.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&")}function rbe(){try{let r=iQ((0,Md.userInfo)().username);return new RegExp(r,"ig")}catch(r){console.info(`jupyter extension failed to get username info with ${r}
 username will not be obfuscated in local logs`)}}function nbe(){try{let r=iQ(Sp().fsPath);return new RegExp(r,"ig")}catch(r){console.info(`jupyter extension failed to get home directory path with ${r}
 home Path will not be obfuscated in local logs`)}}function ibe(r,e){let t=kr.window.createOutputChannel(AN.jupyter,"log");QR(new v1(t,nbe(),rbe())),e.addSingletonInstance(Wo,t,Wu),e.addSingletonInstance(Wo,zz(r.subscriptions),ah),e.addSingletonInstance(op,kr.env.uiKind==kr.UIKind.Web),t.appendLine(`${kr.env.appName} (${kr.version}, ${kr.env.remoteName}, ${kr.env.appHost})`),t.appendLine(`Jupyter Extension Version: ${r.extension.packageJSON.version}.`);let n=kr.extensions.getExtension(hi);n?t.appendLine(`Python Extension Version: ${n.packageJSON.version}.`):t.appendLine("Python Extension not installed.");let i=kr.extensions.getExtension(Bd);i?t.appendLine(`Pylance Extension Version: ${i.packageJSON.version}.`):t.appendLine("Pylance Extension not installed."),t.appendLine(`Platform: ${(0,Md.platform)()} (${(0,Md.arch)()}).`),!kr.workspace.workspaceFolders||kr.workspace.workspaceFolders.length===0?t.appendLine("No workspace folder opened."):kr.workspace.workspaceFolders.length===1?t.appendLine(`Workspace folder ${W(kr.workspace.workspaceFolders[0].uri)}, Home = ${MP.fsPath}`):t.appendLine(`Multiple Workspace folders opened ${kr.workspace.workspaceFolders.map(o=>W(o.uri)).join(", ")}`)}async function obe(r,e,t){let n=!Pr()&&(r.extensionMode===kr.ExtensionMode.Development||kr.workspace.getConfiguration("jupyter").get("development",!1));e.addSingletonInstance(u2,n),e.addSingletonInstance(on,!1),n&&kr.commands.executeCommand("setContext","jupyter.development",!0).then(m,m),kr.commands.executeCommand("setContext","jupyter.webExtension",!1).then(m,m),MW((0,Md.homedir)()),tbe(),ibe(r,e),c8(e),a4(e,n),mG(e,n),pz(e),Mz(r,e,n),$z(e);let i=t.get(sp),o=new $e;await i.activate();let s=o.elapsedTime;R("DS_INTERNAL.EXPERIMENT_LOAD",{duration:s});let a=e.get(An),c=e.get(se).getSettings();YR(c.logging.level),c.onDidChange(()=>{YR(c.logging.level)}),t.get(Fe).executeCommand("setContext","jupyter.vscode.channel",a.channel).then(m,m),t.get(Tk).activate();let d=t.get(Mw);d.initialize(),r.subscriptions.push(d)}function sbe(r){let e=new nQ.Container({skipBaseClassChecks:!0}),t=new Hf(e),n=new Xe(e);return t.addSingletonInstance(ct,n),t.addSingletonInstance(YV,t),t.addSingletonInstance(O,r.subscriptions),t.addSingletonInstance(He,r.globalState,It),t.addSingletonInstance(He,r.workspaceState,vi),t.addSingletonInstance(dt,r),[t,n]}0&&(module.exports={activate,deactivate});
/*! Bundled license information:

reflect-metadata/Reflect.js:
  (*! *****************************************************************************
  Copyright (C) Microsoft. All rights reserved.
  Licensed under the Apache License, Version 2.0 (the "License"); you may not use
  this file except in compliance with the License. You may obtain a copy of the
  License at http://www.apache.org/licenses/LICENSE-2.0
  
  THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
  KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
  WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
  MERCHANTABLITY OR NON-INFRINGEMENT.
  
  See the Apache Version 2.0 License for specific language governing permissions
  and limitations under the License.
  ***************************************************************************** *)

mime-db/index.js:
  (*!
   * mime-db
   * Copyright(c) 2014 Jonathan Ong
   * Copyright(c) 2015-2022 Douglas Christopher Wilson
   * MIT Licensed
   *)

mime-types/index.js:
  (*!
   * mime-types
   * Copyright(c) 2014 Jonathan Ong
   * Copyright(c) 2015 Douglas Christopher Wilson
   * MIT Licensed
   *)

tmp/lib/tmp.js:
  (*!
   * Tmp
   *
   * Copyright (c) 2011-2015 KARASZI Istvan <github@spam.raszi.hu>
   *
   * MIT Licensed
   *)

strip-comments/index.js:
  (*!
   * strip-comments <https://github.com/jonschlinkert/strip-comments>
   * Copyright (c) 2014-present, Jon Schlinkert.
   * Released under the MIT License.
   *)
*/
